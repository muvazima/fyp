@&#MAIN-TITLE@&#Stronger multi-commodity flow formulations of the (capacitated) sequential ordering problem

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           We present several new formulations for the classical “Sequential Ordering Problem”.


                        
                        
                           
                           Two interesting families of equations are useful to strengthen the linear programming relaxations.


                        
                        
                           
                           We prove that the linear programming relaxations of the new formulations give good bounds.


                        
                        
                           
                           We analyse computational results to compare the known and new formulations.


                        
                        
                           
                           The paper also addresses the capacitated variant of the problem.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Sequential ordering

Travelling salesman problem with precedence constraints

Multi-commodity flows

Metrics

Polyhedral combinatorics

@&#ABSTRACT@&#


               
               
                  The sequential ordering problem (SOP) is the generalisation of the asymmetric travelling salesman problem in which there are precedence relations between pairs of nodes. Hernández & Salazar introduced a multi-commodity flow (MCF) formulation for a generalisation of the SOP in which the vehicle has a limited capacity. We strengthen this MCF formulation by fixing variables and adding valid equations. We then use polyhedral projection, together with some known results on flows, cuts and metrics, to derive new families of strong valid inequalities for both problems. Finally, we give computational results, which show that our findings yield good lower bounds in practice.
               
            

@&#INTRODUCTION@&#

The sequential ordering problem (SOP), also called the asymmetric traveling salesman problem with precedence constraints, is defined as follows (Escudero, 1988). We are given a directed graph 
                        
                           G
                           =
                           (
                           V
                           ,
                           A
                           )
                        
                      with 
                        
                           V
                           =
                           {
                           1
                           ,
                           …
                           ,
                           n
                           }
                           ,
                        
                      and a cost ca
                      for each arc a ∈ A. Node 1 is the start node and node n is the end node. We are also given an acyclic precedence digraph, 
                        
                           H
                           =
                           (
                           V
                           ,
                           B
                           )
                        
                     . The task is to find a minimum-cost Hamiltonian path, starting at node 1 and ending at node n, which obeys the precedences. That is, if (i, j) ∈ B then i must be visited before j along the path.

The SOP can be used to model vehicle routing problems with pickups and deliveries, and also single-machine scheduling problems with set-up costs and precedences between jobs.

The standard integer programming formulation of the SOP uses binary variables xa
                      for each a ∈ A, taking the value 1 if and only if arc a is used in the path. For this formulation, many classes of strong valid linear inequalities have been discovered, which have formed the basis of successful exact algorithms for the SOP (e.g., Ascheuer, Escudero, Grötschel, & Stoer, 1993; Ascheuer, Jünger, & Reinelt, 2000; Balas, Fischetti, & Pulleyblank, 1995; Escudero, Guignard, & Malik, 1994). There are also a few papers that discuss alternative formulations that use additional variables, together with appropriate linking constraints (Gouveia & Pesneau, 2006; Gouveia & Ruthmair, 2015; Hernández-Pérez & Salazar-González, 2009).

The present paper was inspired by two existing papers:

                        
                           •
                           
                              Hernández-Pérez and Salazar-González (2009) presented a multi-commodity flow
(MCF) formulation for the SOP, and also for a capacitated version of the SOP, called the multi-commodity one-to-one pickup-and-delivery traveling salesman problem. (For brevity, we just call it the CSOP.)


                              Letchford and Salazar-González (2015) presented some new MCF formulations for the so-called capacitated vehicle routing problem (CVRP), and showed that they dominate all existing ones, in the sense that their continuous relaxations yield stronger lower bounds.

This paper is concerned with MCF formulations for the SOP and CSOP. As well as presenting new and stronger MCF formulations for both problems, we use some known results on flows, cuts and metrics to project the continuous relaxations of our formulations onto the space of the x variables mentioned above. This yields huge new families of strong valid inequalities for both problems, which include some known inequalities as special cases. We also present computational results, showing that the strengthened MCF formulations yield tight lower bounds in practice as well as in theory.

The paper is structured as follows. Section 2 contains a literature review. Section 3 presents and analyses two simple MCF formulations of the SOP, and Section 4 does the same for two stronger MCF formulations. Section 5 extends the results to the CSOP. Computational results are given in Section 6, and some concluding remarks are given in Section 7.

We use the following notation and conventions in the paper. We assume without loss of generality that the arcs (1, i) and (i, n) are in B for all i ∈ V∖{1, n}. These arcs are called dummy precedences while the other arcs in B are called genuine precedences. For any i ∈ V, π(i) and σ(i) denote the predecessors and successors of i, respectively. That is, π(i) and σ(i) denote the set of nodes that must be visited before or after i, respectively. We let 
                        
                           
                              H
                              +
                           
                           =
                           
                              (
                              V
                              ,
                              
                                 B
                                 +
                              
                              )
                           
                        
                      denote the transitive closure of H. That is, 
                        
                           
                              (
                              i
                              ,
                              j
                              )
                           
                           ∈
                           
                              B
                              +
                           
                        
                      if and only if i ∈ π(j). We also let 
                        
                           
                              H
                              −
                           
                           =
                           
                              (
                              V
                              ,
                              
                                 B
                                 −
                              
                              )
                           
                        
                      denote the graph obtained from 
                        
                           H
                           +
                        
                      by deleting all arcs that can be inferred from transitivity. That is, 
                        
                           
                              (
                              i
                              ,
                              j
                              )
                           
                           ∈
                           
                              B
                              −
                           
                        
                      if and only if 
                        
                           
                              (
                              i
                              ,
                              j
                              )
                           
                           ∈
                           
                              B
                              +
                           
                        
                      and 
                        
                           σ
                           (
                           i
                           )
                           ∩
                           π
                           (
                           j
                           )
                           =
                           ∅
                        
                     . Given disjoint sets 
                        
                           
                              S
                              1
                           
                           ,
                           …
                           
                              S
                              k
                           
                           ⊂
                           V
                           ,
                        
                      we let 
                        
                           A
                           (
                           
                              S
                              1
                           
                           ,
                           …
                           
                              S
                              k
                           
                           )
                        
                      denote the set of arcs (i, j) ∈ A such that there exist integers r, s, with 1 ≤ r < s ≤ k, such that i ∈ Sr
                      and j ∈ Ss
                     . We define 
                        
                           
                              B
                              −
                           
                           
                              (
                              
                                 S
                                 1
                              
                              ,
                              …
                              
                                 S
                                 k
                              
                              )
                           
                        
                      and 
                        
                           
                              B
                              +
                           
                           
                              (
                              
                                 S
                                 1
                              
                              ,
                              …
                              
                                 S
                                 k
                              
                              )
                           
                        
                      similarly. Given a set A′ ⊂ A, x(A′) denotes 
                        
                           
                              ∑
                              
                                 a
                                 ∈
                                 
                                    A
                                    ′
                                 
                              
                           
                           
                              x
                              a
                           
                           ,
                        
                      and similarly for u(A′), ℓ(A′), etc. Finally, directed graphs, cuts and paths are called digraphs, dicuts and dipaths, respectively.

@&#LITERATURE REVIEW@&#

We now review the relevant literature. The SOP and CSOP are covered in Sections 2.1 and 2.2, respectively. In Section 2.3, we recall some relevant facts about flows, cuts and metrics.

Many formulations and algorithms have been proposed for the SOP (e.g., Ascheuer et al., 1993; Ascheuer et al., 2000; Balas et al., 1995; Bianco, Mingozzi, & Ricciardelli, 1994; Escudero, 1988; Escudero et al., 1994; Gouveia & Pesneau, 2006; Hernández-Pérez & Salazar-González, 2009). The standard integer programming formulation (Ascheuer et al., 1993; Balas et al., 1995; Escudero et al., 1994) uses one binary variable xa
                         for each arc a ∈ A, taking the value 1 if and only if arc a is traversed in the solution. The formulation takes the form:

                           
                              (1)
                              
                                 
                                    min
                                    
                                       ∑
                                       
                                          a
                                          ∈
                                          A
                                       
                                    
                                    
                                       c
                                       a
                                    
                                    
                                       x
                                       a
                                    
                                 
                              
                           
                        
                        
                           
                              (2)
                              
                                 
                                    
                                       
                                          s.t.
                                       
                                       
                                          
                                             x
                                             (
                                             A
                                             (
                                             {
                                             i
                                             }
                                             ,
                                             V
                                             ∖
                                             {
                                             i
                                             }
                                             )
                                             )
                                             =
                                             1
                                             
                                          
                                       
                                       
                                          
                                             ∀
                                             i
                                             ∈
                                             V
                                             ∖
                                             {
                                             n
                                             }
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (3)
                              
                                 
                                    
                                       
                                          
                                             x
                                             (
                                             A
                                             (
                                             V
                                             ∖
                                             {
                                             i
                                             }
                                             ,
                                             {
                                             i
                                             }
                                             )
                                             )
                                             =
                                             1
                                             
                                             ∀
                                             i
                                             ∈
                                             V
                                             ∖
                                             {
                                             1
                                             }
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (4)
                              
                                 
                                    
                                       
                                          
                                             x
                                             (
                                             A
                                             (
                                             S
                                             ,
                                             V
                                             ∖
                                             S
                                             )
                                             )
                                             ≥
                                             1
                                             
                                             ∀
                                             S
                                             ⊂
                                             V
                                             ∖
                                             {
                                             1
                                             ,
                                             n
                                             }
                                             :
                                             S
                                             ≠
                                             ∅
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (5)
                              
                                 
                                    
                                       
                                       
                                       
                                          
                                             x
                                             (
                                             A
                                             (
                                             S
                                             ,
                                             V
                                             ∖
                                             S
                                             )
                                             )
                                             ≥
                                             x
                                             (
                                             A
                                             (
                                             {
                                             p
                                             }
                                             ,
                                             V
                                             ∖
                                             S
                                             )
                                             )
                                             +
                                             x
                                             (
                                             A
                                             (
                                             {
                                             q
                                             }
                                             ,
                                             S
                                             )
                                             )
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             ∀
                                             S
                                             ⊂
                                             V
                                             ∖
                                             
                                                {
                                                1
                                                ,
                                                n
                                                }
                                             
                                             ,
                                             
                                                (
                                                p
                                                ,
                                                q
                                                )
                                             
                                             ∈
                                             
                                                B
                                                −
                                             
                                             
                                                (
                                                S
                                                ,
                                                V
                                                ∖
                                                S
                                                )
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (6)
                              
                                 
                                    
                                       
                                          
                                             
                                                x
                                                a
                                             
                                             ∈
                                             
                                                {
                                                0
                                                ,
                                                1
                                                }
                                             
                                             ∀
                                             a
                                             ∈
                                             A
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        Constraints (4) and (5) are called subtour elimination (SE) and precedence-forcing (PF) inequalities, respectively. Although they are exponential in number, the associated separation problems can be solved efficiently (Ascheuer et al., 1993). (To see that the PF inequalities prevent tours that violate the precedences, consider any arc 
                           
                              
                                 (
                                 p
                                 ,
                                 q
                                 )
                              
                              ∈
                              
                                 B
                                 −
                              
                           
                         and any invalid tour that visits q, followed by a set of nodes T, followed by p. This tour violates the PF inequality with 
                           
                              S
                              =
                              T
                              ∪
                              {
                              p
                              }
                           
                        .)

The polytope associated with the above formulation has been studied in depth (Ascheuer et al., 1993; Ascheuer et al., 2000; Balas et al., 1995; Escudero et al., 1994; Gouveia & Ruthmair, 2015; Mak & Ernst, 2007). Of particular interest to us will be the following four families of valid inequalities:

                           
                              •
                              The simple (π, σ) inequalities (Balas et al., 1995):

                                    
                                       (7)
                                       
                                          
                                             
                                                
                                                
                                                
                                                   
                                                      x
                                                      (
                                                      
                                                      A
                                                      (
                                                      
                                                      S
                                                      ∖
                                                      (
                                                      π
                                                      (
                                                      p
                                                      )
                                                      ∪
                                                      σ
                                                      (
                                                      q
                                                      )
                                                      )
                                                      ,
                                                      
                                                      V
                                                      ∖
                                                      (
                                                      S
                                                      ∪
                                                      π
                                                      (
                                                      p
                                                      )
                                                      ∪
                                                      σ
                                                      (
                                                      q
                                                      )
                                                      )
                                                      
                                                      )
                                                      
                                                      )
                                                      ≥
                                                      1
                                                   
                                                
                                             
                                             
                                                
                                                
                                                
                                                   
                                                      
                                                      ∀
                                                      S
                                                      ⊂
                                                      V
                                                      ∖
                                                      
                                                         {
                                                         1
                                                         ,
                                                         n
                                                         }
                                                      
                                                      
                                                      ,
                                                      
                                                      
                                                         (
                                                         p
                                                         ,
                                                         q
                                                         )
                                                      
                                                      ∈
                                                      
                                                         B
                                                         −
                                                      
                                                      
                                                         (
                                                         S
                                                         ,
                                                         V
                                                         ∖
                                                         S
                                                         )
                                                      
                                                      .
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              

The precedence-cycle-breaking (PCB) inequalities (Balas et al., 1995):

                                    
                                       (8)
                                       
                                          
                                             
                                                ∑
                                                
                                                   r
                                                   =
                                                   1
                                                
                                                k
                                             
                                             x
                                             
                                                (
                                                A
                                                
                                                   (
                                                   
                                                      S
                                                      r
                                                   
                                                   ,
                                                   V
                                                   ∖
                                                   
                                                      S
                                                      r
                                                   
                                                   )
                                                
                                                )
                                             
                                             ≥
                                             k
                                             +
                                             1
                                             ,
                                          
                                       
                                    
                                 where k ≥ 2 is a positive integer, and 
                                    
                                       
                                          S
                                          1
                                       
                                       ,
                                       …
                                       ,
                                       
                                          S
                                          k
                                       
                                    
                                  are disjoint subsets of V∖{1, n} such that 
                                    
                                       
                                          B
                                          +
                                       
                                       
                                          (
                                          
                                             S
                                             r
                                          
                                          ,
                                          
                                             S
                                             
                                                r
                                                +
                                                1
                                             
                                          
                                          )
                                       
                                       ≠
                                       ∅
                                    
                                  for 
                                    
                                       r
                                       =
                                       1
                                       ,
                                       …
                                       ,
                                       k
                                       ,
                                    
                                  with 
                                    
                                       
                                          S
                                          
                                             k
                                             +
                                             1
                                          
                                       
                                       =
                                       
                                          S
                                          1
                                       
                                    
                                 .

The following inequalities, given in Proposition 3.7 of Balas et al. (1995), which we call P-to-Q inequalities:

                                    
                                       (9)
                                       
                                          
                                             
                                                
                                                
                                                
                                                   
                                                      x
                                                      (
                                                      A
                                                      (
                                                      P
                                                      ,
                                                      Q
                                                      ,
                                                      V
                                                      ∖
                                                      (
                                                      Q
                                                      ∪
                                                      P
                                                      )
                                                      )
                                                      )
                                                      ≥
                                                      2
                                                   
                                                
                                             
                                             
                                                
                                                
                                                
                                                   
                                                      
                                                      ∀
                                                      P
                                                      ,
                                                      Q
                                                      ⊂
                                                      V
                                                      ∖
                                                      
                                                         {
                                                         1
                                                         ,
                                                         n
                                                         }
                                                      
                                                      :
                                                      
                                                      P
                                                      ∩
                                                      Q
                                                      =
                                                      ∅
                                                      ,
                                                      
                                                         B
                                                         +
                                                      
                                                      
                                                         (
                                                         P
                                                         ,
                                                         Q
                                                         )
                                                      
                                                      ≠
                                                      ∅
                                                      .
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              

The following inequalities, given in Gouveia and Ruthmair (2015), which we call odd dipath
inequalities:

                                    
                                       (10)
                                       
                                          
                                             x
                                             (
                                             A
                                             (
                                             S
                                             ,
                                             V
                                             ∖
                                             S
                                             )
                                             )
                                             ≥
                                             ⌈
                                             k
                                             (
                                             S
                                             )
                                             /
                                             2
                                             ⌉
                                             ,
                                          
                                       
                                    
                                 where S ⊂ V∖{1, n} and k(S) is the largest integer k such that there exists a dipath 
                                    
                                       
                                          v
                                          0
                                       
                                       ,
                                       …
                                       ,
                                       
                                          v
                                          k
                                       
                                    
                                  in 
                                    
                                       H
                                       −
                                    
                                  with vi
                                  ∈ S if and only if i is odd.


                        Balas et al. (1995) show that the simple (π, σ) inequalities (7) dominate the SE and PF inequalities, yet can be separated in polynomial time. They also point out that each PF inequality (5) is dominated by two P-to-Q inequalities: one in which 
                           
                              P
                              =
                              S
                           
                         and 
                           
                              Q
                              =
                              {
                              q
                              }
                              ,
                           
                         and the other in which 
                           
                              P
                              =
                              {
                              p
                              }
                           
                         and 
                           
                              Q
                              =
                              S
                              ∪
                              {
                              q
                              }
                              ∖
                              {
                              p
                              }
                           
                        . Gouveia and Ruthmair (2015) observe that the odd dipath inequalities dominate the SE inequalities.

It is noted in Ascheuer et al. (1993), Balas et al. (1995), Escudero (1988) that certain arcs can be deleted from A without losing any feasible solutions. In our notation, we can delete the arc (i, j) from A if 
                           
                              
                                 (
                                 j
                                 ,
                                 i
                                 )
                              
                              ∈
                              
                                 B
                                 +
                              
                           
                         or if 
                           
                              
                                 (
                                 i
                                 ,
                                 j
                                 )
                              
                              ∈
                              
                                 B
                                 +
                              
                              ∖
                              
                                 B
                                 −
                              
                           
                        . In particular, the arcs entering 1 and leaving n can be deleted, the arc (1, j) can be deleted if π(j)∖{1} ≠ ∅, and the arc (i, n) can be deleted if σ(i)∖{n} ≠ ∅. We assume from now on that all such arcs have been deleted from A.

As mentioned in the introduction, the CSOP was introduced in Hernández-Pérez and Salazar-González (2009). In the CSOP, the vehicle has a (positive integer) capacity Q and each precedence relation (p, q) ∈ B is associated with a commodity that has a weight of dpq
                         and needs to be collected at p and delivered at q. (We remark that a relaxed version of the CSOP, in which the vehicle is permitted to visit nodes more than once, was presented in an earlier paper Timlin and Pulleyblank, 1992.)

The following MCF formulation of the CSOP was presented in Hernández-Pérez and Salazar-González (2009). For each a ∈ A and each b ∈ B, define the binary variable 
                           
                              
                                 f
                                 a
                                 b
                              
                              ,
                           
                         taking the value 1 if and only if commodity b is carried across arc a. Then take (1)–(3) and (6), and add the following constraints:

                           
                              (11)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                f
                                                b
                                             
                                             
                                                (
                                                A
                                                
                                                   (
                                                   
                                                      {
                                                      i
                                                      }
                                                   
                                                   ,
                                                   V
                                                   ∖
                                                   
                                                      {
                                                      i
                                                      }
                                                   
                                                   )
                                                
                                                )
                                             
                                             −
                                             
                                                f
                                                b
                                             
                                             
                                                (
                                                A
                                                
                                                   (
                                                   V
                                                   ∖
                                                   
                                                      {
                                                      i
                                                      }
                                                   
                                                   ,
                                                   
                                                      {
                                                      i
                                                      }
                                                   
                                                   )
                                                
                                                )
                                             
                                             =
                                             
                                                d
                                                i
                                                b
                                             
                                          
                                       
                                       
                                          
                                             
                                             ∀
                                             i
                                             ∈
                                             V
                                             ,
                                             
                                             b
                                             ∈
                                             B
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (12)
                              
                                 
                                    
                                       
                                       
                                          
                                             0
                                             ≤
                                             
                                                f
                                                a
                                                b
                                             
                                             ≤
                                             
                                                x
                                                a
                                             
                                          
                                       
                                       
                                          
                                             
                                             ∀
                                             a
                                             ∈
                                             A
                                             ,
                                             b
                                             ∈
                                             B
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (13)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                ∑
                                                
                                                   b
                                                   ∈
                                                   B
                                                
                                             
                                             
                                                d
                                                b
                                             
                                             
                                                f
                                                a
                                                b
                                             
                                             ≤
                                             Q
                                             
                                                x
                                                a
                                             
                                          
                                       
                                       
                                          
                                             ∀
                                             a
                                             ∈
                                             A
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                        where the constant 
                           
                              d
                              i
                              b
                           
                         takes the value 1 if i is the origin of the commodity b, 
                           
                              −
                              1
                           
                         if i is the destination of b, and 0 otherwise.

The following enhancements to this model were also proposed in Hernández-Pérez and Salazar-González (2009):

                           
                              •
                              One can change the first inequality in (12) to an equation if (i) the head of a is the tail of b, (ii) the head of b is the tail of a, (iii) the tail of a is 1 but the tail of b is not, or (iv) the head of a is n but the head of b is not. One can also change the second inequality in (12) to an equation if a and b share a common head or tail.

The inequalities (13) can be strengthened slightly to:

                                    
                                       (14)
                                       
                                          
                                             
                                                ∑
                                                
                                                   b
                                                   ∈
                                                   B
                                                
                                             
                                             
                                                d
                                                b
                                             
                                             
                                                f
                                                
                                                   i
                                                   j
                                                
                                                b
                                             
                                             ≤
                                             
                                                (
                                                Q
                                                −
                                                max
                                                
                                                   {
                                                   0
                                                   ,
                                                   −
                                                   
                                                      d
                                                      i
                                                   
                                                   ,
                                                   
                                                      d
                                                      j
                                                   
                                                   }
                                                
                                                )
                                             
                                             
                                                x
                                                
                                                   i
                                                   j
                                                
                                             
                                             
                                             ∀
                                             
                                                (
                                                i
                                                ,
                                                j
                                                )
                                             
                                             ∈
                                             A
                                             ,
                                          
                                       
                                    
                                 where dv
                                  is the net demand collected at v for each v ∈ V, i.e.

                                    
                                       
                                          
                                             
                                                d
                                                v
                                             
                                             =
                                             d
                                             
                                                (
                                                B
                                                
                                                   (
                                                   
                                                      {
                                                      v
                                                      }
                                                   
                                                   ,
                                                   V
                                                   ∖
                                                   
                                                      {
                                                      v
                                                      }
                                                   
                                                   )
                                                
                                                )
                                             
                                             −
                                             d
                                             
                                                (
                                                B
                                                
                                                   (
                                                   V
                                                   ∖
                                                   
                                                      {
                                                      v
                                                      }
                                                   
                                                   ,
                                                   
                                                      {
                                                      v
                                                      }
                                                   
                                                   )
                                                
                                                )
                                             
                                             .
                                          
                                       
                                    
                                 
                              

The arc (i, j) can be eliminated from A if any of the following quantities exceeds Q:
                                    
                                       •
                                       
                                          d( B(V∖{i, j}, {i, j}) )


                                          d( B({i}, V∖{i}) ∪ B(V∖{j}, {j}) )


                                          d( B({i, j}, V∖{i, j}) ).

The CSOP was also considered very recently by Gouveia and Ruthmair (2015). They observed that, if there is any triple (p, q), (p, r), (r, q) ∈ B, then the set of feasible solutions is unchanged if we remove (p, q) from B and add dpq
                         to the weight of the commodities (p, r) and (r, q). They also present some alternative integer programming formulations. Using branch-and-cut algorithms based on these formulations and on the odd dipath inequalities (10), they were able to solve several previously-unsolved SOP and CSOP instances.

Finally, we recall four results on flows, cuts and metrics.

                           Theorem 1
                           Max-Flow Min-Cut Theorem (Ford & Fulkerson, 1956)


                           
                              Let
                              
                                 
                                    G
                                    =
                                    (
                                    V
                                    ,
                                    A
                                    )
                                 
                               
                              be a directed graph, let
                              
                                 
                                    u
                                    ∈
                                    
                                       Z
                                       +
                                       A
                                    
                                 
                               
                              be a given vector of arc capacities, let s, t ∈ V be given distinct nodes, and let dst be a positive number. Then a flow of dst units can be sent from s to t in G if and only if
                              
                                 
                                    
                                       
                                          u
                                          
                                             (
                                             A
                                             
                                                (
                                                S
                                                ,
                                                V
                                                ∖
                                                S
                                                )
                                             
                                             )
                                          
                                          ≥
                                          
                                             d
                                             
                                                s
                                                t
                                             
                                          
                                          
                                          ∀
                                          S
                                          ⊂
                                          V
                                          :
                                          
                                          s
                                          ∈
                                          S
                                          ,
                                          
                                          t
                                          ∈
                                          V
                                          ∖
                                          S
                                          .
                                       
                                    
                                 
                              
                           


                              Let
                              
                                 
                                    G
                                    =
                                    (
                                    V
                                    ,
                                    A
                                    )
                                 
                               
                              be a digraph and let
                              
                                 
                                    d
                                    ∈
                                    
                                       Z
                                       V
                                    
                                    ,
                                 
                              
                              
                                 
                                    ℓ
                                    ∈
                                    
                                       Z
                                       +
                                       A
                                    
                                 
                               
                              and
                              
                                 
                                    u
                                    ∈
                                    
                                       Z
                                       +
                                       A
                                    
                                 
                               
                              be given vectors, with ℓ ≤ u and
                              
                                 
                                    d
                                    (
                                    V
                                    )
                                    =
                                    0
                                 
                              
                              . Then there exists a feasible flow of a single commodity in G such that (i) the net flow leaving each node i ∈ V is di, and (ii) between ℓ
                                 a
                               
                              and ua units of flow pass through each arc a, if and only if
                              
                                 
                                    (15)
                                    
                                       
                                          u
                                          
                                             (
                                             A
                                             
                                                (
                                                S
                                                ,
                                                V
                                                ∖
                                                S
                                                )
                                             
                                             )
                                          
                                          −
                                          ℓ
                                          
                                             (
                                             A
                                             
                                                (
                                                V
                                                ∖
                                                S
                                                ,
                                                S
                                                )
                                             
                                             )
                                          
                                          ≥
                                          
                                             ∑
                                             
                                                i
                                                ∈
                                                S
                                             
                                          
                                          
                                             d
                                             i
                                          
                                          
                                          ∀
                                          S
                                          ⊂
                                          V
                                          .
                                       
                                    
                                 
                              
                           


                              Let
                              
                                 
                                    G
                                    =
                                    (
                                    V
                                    ,
                                    A
                                    )
                                 
                               
                              be a digraph, let
                              
                                 
                                    u
                                    ∈
                                    
                                       Z
                                       +
                                       A
                                    
                                 
                               
                              be a vector of arc capacities, and let B be a set of commodities. For each (p, q) ∈ B, let dpq be the amount of the commodity that needs to be sent from p to q. Then the commodities can be routed simultaneously in G if and only if the following “metric” inequality
                              
                                 
                                    
                                       
                                          
                                             ∑
                                             
                                                a
                                                ∈
                                                A
                                             
                                          
                                          
                                             μ
                                             a
                                          
                                          
                                             u
                                             a
                                          
                                          ≥
                                          
                                             ∑
                                             
                                                b
                                                ∈
                                                B
                                             
                                          
                                          
                                             μ
                                             b
                                          
                                          
                                             d
                                             b
                                          
                                       
                                    
                                 
                              
                              holds for all
                              
                                 
                                    μ
                                    ∈
                                    
                                       Q
                                       +
                                       
                                          V
                                          ×
                                          V
                                       
                                    
                                 
                               
                              such that
                              
                                 
                                    
                                       μ
                                       
                                          i
                                          i
                                       
                                    
                                    =
                                    0
                                 
                               
                              for all i ∈ V, and
                              
                                 
                                    
                                       μ
                                       
                                          i
                                          j
                                       
                                    
                                    ≤
                                    
                                       μ
                                       
                                          i
                                          k
                                       
                                    
                                    +
                                    
                                       μ
                                       
                                          k
                                          j
                                       
                                    
                                 
                               
                              for all {i, j, k} ⊂ V.
                           

(A vector μ satisfying the properties in Theorem 3 is often called a metric. Strictly speaking, it should be called an oriented semi-metric. See, e.g., Deza and Panteleeva, 2000.)

                           Theorem 4
                           Deza & Panteleeva (Deza & Panteleeva, 2000)


                           
                              Let k ≥ 2 be an integer, and let
                              
                                 
                                    
                                       S
                                       1
                                    
                                    ,
                                    …
                                    ,
                                    
                                       S
                                       k
                                    
                                 
                               
                              be a partition of V. Define μ ∈ {0, 1}
                                 V × V
                               
                              by setting μij to 1 if and only if i ∈ Ss and j ∈ St for some s, t such that 1 ≤ s < t ≤ k. Then μ lies on an extreme ray of the cone of oriented semi-metrics.
                           

(Deza and Panteleeva also call arc sets of the form 
                           
                              A
                              (
                              
                                 S
                                 1
                              
                              ,
                              …
                              ,
                              
                                 S
                                 k
                              
                              )
                           
                         
                        oriented multicuts. Note that, when 
                           
                              k
                              =
                              2
                              ,
                           
                         an oriented multicut is just a dicut.)

We remark that the first two theorems have been used many times before in the vehicle routing literature (see, e.g., Gouveia, 1995; Hernández-Pérez & Salazar-González, 2009; Letchford & Salazar-González, 2006; 2015). The third was used in Kerivin, Lacroix, Mahjoub, and Quilliot (2008). To our knowledge, the fourth has not been used before.

This section presents two simple MCF formulations of the SOP, both obtained by modifying the MCF formulation of the CSOP mentioned in Section 2.2. From now on, when we say “the projection” of a given MCF formulation, we mean the projection of the feasible region of the continuous relaxation of the formulation onto the space of the x variables.

Our first MCF formulation, which we call “MCF1”, consists of (1)–(3) and (6), together with the constraints (11)–(12) for the commodities in 
                           
                              
                                 B
                                 −
                              
                              ,
                           
                         rather than B. This model has a polynomial number of both variables and constraints.

                           Lemma 1
                           
                              Every feasible solution to the continuous relaxation of 
                              MCF1 
                              satisfies the following equations:
                              
                                 
                                    •
                                    
                                       
                                          
                                             
                                                f
                                                
                                                   i
                                                   j
                                                
                                                
                                                   p
                                                   q
                                                
                                             
                                             =
                                             
                                                x
                                                
                                                   i
                                                   j
                                                
                                             
                                          
                                        
                                       for all
                                       
                                          
                                             
                                                (
                                                p
                                                ,
                                                q
                                                )
                                             
                                             ∈
                                             
                                                B
                                                −
                                             
                                          
                                        
                                       and all (i, j) ∈ A such that
                                       
                                          
                                             i
                                             =
                                             p
                                          
                                        
                                       or
                                       
                                          
                                             j
                                             =
                                             q
                                          
                                       
                                       ;
                                    


                                       
                                          
                                             
                                                f
                                                
                                                   i
                                                   j
                                                
                                                
                                                   p
                                                   q
                                                
                                             
                                             =
                                             0
                                          
                                        
                                       for all
                                       
                                          
                                             
                                                (
                                                p
                                                ,
                                                q
                                                )
                                             
                                             ∈
                                             
                                                B
                                                −
                                             
                                          
                                        
                                       and (i, j) ∈ A such that (i)
                                       
                                          
                                             j
                                             =
                                             p
                                             ,
                                          
                                        
                                       (ii)
                                       
                                          
                                             i
                                             =
                                             q
                                             ,
                                          
                                        
                                       (iii) p ≠ 1 and
                                       
                                          
                                             i
                                             =
                                             1
                                          
                                        
                                       and (iv) q ≠ n and
                                       
                                          
                                             j
                                             =
                                             n
                                          
                                       
                                       .
                                    

Let (p, q) be fixed, and consider the flow of the commodity associated with (p, q). The constraint (11) for 
                                 
                                    b
                                    =
                                    (
                                    p
                                    ,
                                    q
                                    )
                                 
                               and 
                                 
                                    i
                                    =
                                    p
                                 
                               states that the net flow leaving node p equals 1. Moreover, the Eq. (2) for node p, together with the bounds (12) for 
                                 
                                    b
                                    =
                                    (
                                    p
                                    ,
                                    q
                                    )
                                 
                               and all arcs 
                                 
                                    a
                                    ∈
                                    
                                       B
                                       −
                                    
                                    
                                       (
                                       
                                          {
                                          p
                                          }
                                       
                                       ,
                                       V
                                       ∖
                                       
                                          {
                                          p
                                          }
                                       
                                       )
                                    
                                    ,
                                 
                               imply that no more than one unit of the flow can leave node p. Together with non-negativity, this implies that one unit of the flow leaves node p, and none enters. This implies the equations 
                                 
                                    
                                       f
                                       
                                          i
                                          j
                                       
                                       
                                          p
                                          q
                                       
                                    
                                    =
                                    
                                       x
                                       
                                          i
                                          j
                                       
                                    
                                 
                               for all j when 
                                 
                                    i
                                    =
                                    p
                                 
                               and the equations 
                                 
                                    
                                       f
                                       
                                          i
                                          j
                                       
                                       
                                          p
                                          q
                                       
                                    
                                    =
                                    0
                                 
                               for all i when 
                                 
                                    j
                                    =
                                    p
                                 
                              . A similar argument, applied to node q, yields the equations 
                                 
                                    
                                       f
                                       
                                          i
                                          j
                                       
                                       
                                          p
                                          q
                                       
                                    
                                    =
                                    
                                       x
                                       
                                          i
                                          j
                                       
                                    
                                 
                               for all i when 
                                 
                                    j
                                    =
                                    q
                                 
                               and the equations 
                                 
                                    
                                       f
                                       
                                          i
                                          j
                                       
                                       
                                          p
                                          q
                                       
                                    
                                    =
                                    0
                                 
                               for all j when 
                                 
                                    i
                                    =
                                    q
                                 
                              .

Now suppose that p ≠ 1. Since we have deleted the arcs entering 1 from A, none of the flow can pass through node 1. This implies the equations 
                                 
                                    
                                       f
                                       
                                          i
                                          j
                                       
                                       
                                          p
                                          q
                                       
                                    
                                    =
                                    0
                                 
                               for all j when 
                                 
                                    i
                                    =
                                    1
                                 
                              . Similarly, if q ≠ n, then none of the flow can pass through node n. This implies the last set of equations mentioned.□


                              The projection of MCF1 is completely described by the equations 
                              
                                 (2)
                               
                              and 
                              
                                 (3)
                              
                              , non-negativity on x, the SE inequalities 
                              
                                 (4)
                               
                              and the (slightly strengthened SE) inequalities
                              
                                 
                                    (16)
                                    
                                       
                                          x
                                          (
                                          A
                                          (
                                          S
                                          ,
                                          V
                                          ∖
                                          (
                                          S
                                          ∪
                                          {
                                          n
                                          }
                                          )
                                          )
                                          )
                                          ≥
                                          1
                                       
                                    
                                 
                              
                              for all S⊆V∖{1, n} such that
                              
                                 
                                    
                                       B
                                       −
                                    
                                    
                                       (
                                       S
                                       ,
                                       V
                                       ∖
                                       
                                          (
                                          S
                                          ∪
                                          
                                             {
                                             1
                                             ,
                                             n
                                             }
                                          
                                          )
                                       
                                       )
                                    
                                    ≠
                                    ∅
                                 
                              
                              .
                           

Since there are no constraints linking the f variables for different commodities, we can deal with the constraints (11) and (12) for each commodity in 
                                 
                                    B
                                    −
                                 
                               separately.

First, consider a commodity 
                                 
                                    
                                       (
                                       p
                                       ,
                                       q
                                       )
                                    
                                    ∈
                                    
                                       B
                                       −
                                    
                                 
                               such that p ≠ 1 and q ≠ n. Lemma 1 implies that none of the corresponding flow can pass through nodes 1 or n. Theorem 1 then yields x(A(S∖{1, n}, V∖(S ∪ {1, n}))) ≥ 1 for all S ⊂ V such that p ∈ S and q ∉ S. Note that, if 1 ∈ S, then this inequality is unchanged if we drop 1 from S. Similarly, if n ∈ S, then the inequality is unchanged if we drop n from S. So we can assume that S⊆V∖{1, n}. In that case, the inequality becomes x(A(S, V∖(S ∪ {1, n}))) ≥ 1. Since there are no arcs in A entering node 1, this last inequality is equivalent to (16).

A similar argument applies for commodities 
                                 
                                    
                                       (
                                       p
                                       ,
                                       q
                                       )
                                    
                                    ∈
                                    
                                       B
                                       −
                                    
                                 
                               such that 
                                 
                                    p
                                    =
                                    1
                                 
                               or 
                                 
                                    q
                                    =
                                    n
                                 
                              .□

We remark that the projection of MCF1 does not satisfy all of the PF inequalities (5) in general. (It is easy to construct counter-examples, even for 
                           
                              n
                              =
                              6
                           
                        .) Indeed, there is no dominance relation between (5) and (16), as can be seen by comparing their right-hand sides for a given S.

In order to derive our second MCF formulation of the SOP, we will need the following lemma:

                           Lemma 2
                           
                              All feasible (integer) solutions to MCF1 satisfy the equations
                              
                                 
                                    
                                       f
                                       
                                          i
                                          j
                                       
                                       
                                          p
                                          q
                                       
                                    
                                    =
                                    0
                                 
                               
                              for all (i, j) ∈ A and
                              
                                 
                                    
                                       (
                                       p
                                       ,
                                       q
                                       )
                                    
                                    ∈
                                    
                                       B
                                       −
                                    
                                 
                               
                              such that i ∈ π(p) ∪ σ(q) ∪ {q} or j ∈ π(p) ∪ σ(q) ∪ {p}.
                           

If i ∈ π(p) or j ∈ π(p) ∪ {p}, then the vehicle can only traverse the arc (i, j) before it has picked up the commodity (p, q) at node p. If i ∈ σ(q) ∪ {q} or j ∈ σ(q), then the vehicle can only traverse the arc (i, j) after it has delivered the commodity (p, q) at node q. In either case, the commodity will not be on the vehicle as the arc is traversed.□

Our second MCF formulation, which we call “MCF2”, is obtained by taking MCF1 and simply deleting all of the f variables mentioned in Lemma 2. We remark that the set of f variables eliminated via Lemma 2 includes all those that could be eliminated via Lemma 1, and all those mentioned by Hernández-Pérez and Salazar-González (2009) (see Section 2.2).

Note that, if 
                           
                              
                                 |
                              
                              
                                 B
                                 +
                              
                              
                                 |
                              
                           
                         is large, then MCF2 can be significantly smaller than MCF1. The following theorem shows that, as well as being smaller than MCF1, MCF2 is stronger.

                           Theorem 6
                           
                              The projection of MCF2 is completely described by the equations 
                              
                                 (2)
                               
                              and 
                              
                                 (3)
                              
                              , non-negativity on x, and the simple (π, σ) inequalities 
                              
                                 (7)
                              
                              .
                           

As in the proof of Theorem 5, we can deal with the constraints for each commodity in 
                                 
                                    B
                                    −
                                 
                               separately. For a fixed 
                                 
                                    
                                       (
                                       p
                                       ,
                                       q
                                       )
                                    
                                    ∈
                                    
                                       B
                                       −
                                    
                                    ,
                                 
                               the formulation contains the flow conservation equations (11) and bounds (12) for the given (p, q) and the equation 
                                 
                                    
                                       f
                                       
                                          i
                                          j
                                       
                                       
                                          p
                                          q
                                       
                                    
                                    =
                                    0
                                 
                               for the arcs (i, j) ∈ A mentioned in Lemma 2. We now use Theorem 2 with:

                                 
                                    •
                                    
                                       
                                          
                                             
                                                d
                                                p
                                             
                                             =
                                             1
                                          
                                        and 
                                          
                                             
                                                d
                                                q
                                             
                                             =
                                             −
                                             1
                                             ,
                                          
                                       
                                    


                                       
                                          
                                             
                                                d
                                                i
                                             
                                             =
                                             0
                                          
                                        for the other nodes in V,


                                       
                                          
                                             
                                                ℓ
                                                
                                                   i
                                                   j
                                                
                                             
                                             =
                                             
                                                u
                                                
                                                   i
                                                   j
                                                
                                             
                                             =
                                             0
                                          
                                        for the arcs mentioned in Lemma 2,


                                       
                                          
                                             
                                                ℓ
                                                
                                                   i
                                                   j
                                                
                                             
                                             =
                                             0
                                          
                                        and 
                                          
                                             
                                                u
                                                
                                                   i
                                                   j
                                                
                                             
                                             =
                                             
                                                x
                                                
                                                   i
                                                   j
                                                
                                             
                                          
                                        for all other arcs in A.

Now, for a given set S ⊂ V, the right-hand side of (15) is equal to 1 if p ∈ S and q ∉ S, and is either 0 or 
                                 
                                    −
                                    1
                                 
                               otherwise. The only non-redundant inequalities (15) are therefore the ones with p ∈ S and q ∉ S. These are precisely the simple (π, σ) inequalities.□

We remind the reader that the simple (π, σ) inequalities dominate the SE and PF inequalities. So, MCF2 can be significantly stronger than MCF1, especially when 
                           
                              
                                 |
                              
                              
                                 B
                                 +
                              
                              
                                 |
                              
                           
                         is large. This is reflected by our computational results in Section 6.

In this section, we present two MCF formulations of the SOP that are more complex, but significantly stronger than MCF1 and MCF2. It turns out that their projections satisfy some new (and exponentially large) families of strong valid inequalities, that both generalise and dominate several known families for the standard formulation of the SOP.

Let 
                           D
                         denote the family of dipaths in 
                           
                              H
                              −
                           
                         from 1 to n, viewed as sets of arcs. Observe that, for any 
                           
                              D
                              ∈
                              D
                              ,
                           
                         the vehicle must carry exactly one of the |D| associated commodities at any one time. Accordingly, every feasible (integer) solution of MCF1 or MCF2 must satisfy the following equations:

                           
                              (17)
                              
                                 
                                    
                                       ∑
                                       
                                          b
                                          ∈
                                          D
                                       
                                    
                                    
                                       f
                                       a
                                       b
                                    
                                    =
                                    
                                       x
                                       a
                                    
                                    
                                    ∀
                                    D
                                    ∈
                                    D
                                    ,
                                    
                                    a
                                    ∈
                                    A
                                    .
                                 
                              
                           
                        We call these precedence-dipath (PD) equations. (Actually, some of the f variables on the left-hand side of (17) may have been eliminated using Lemma 2, but we ignore that for the moment, to keep the notation simple.)

Note that 
                           
                              |
                              D
                              |
                           
                         can be exponential in n, and therefore so can the number of PD equations. Fortunately, only a polynomial number of PD equations are needed:

                           Proposition 1
                           
                              For a given arc a ∈ A, at most
                              
                                 
                                    
                                       |
                                    
                                    
                                       B
                                       −
                                    
                                    
                                       |
                                       −
                                       n
                                       +
                                       2
                                    
                                 
                               
                              PD equations can be linearly independent.
                           

Write the left-hand side of the PD Eq. (17) as αTfa
                              , where both α and fa
                               are in 
                                 
                                    
                                       
                                          {
                                          0
                                          ,
                                          1
                                          }
                                       
                                       
                                          
                                             |
                                          
                                          
                                             B
                                             −
                                          
                                          
                                             |
                                          
                                       
                                    
                                    ,
                                 
                               and αb
                               equals 1 if b ∈ D, and 0 otherwise. Observe that α is the incidence vector of the dipath D. Therefore, α satisfies the equations:

                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      ∑
                                                      
                                                         i
                                                         :
                                                         
                                                            (
                                                            1
                                                            ,
                                                            i
                                                            )
                                                         
                                                         ∈
                                                         
                                                            B
                                                            −
                                                         
                                                      
                                                   
                                                   
                                                      α
                                                      
                                                         1
                                                         i
                                                      
                                                   
                                                   =
                                                
                                             
                                             
                                                1
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      ∑
                                                      
                                                         i
                                                         :
                                                         
                                                            (
                                                            i
                                                            ,
                                                            n
                                                            )
                                                         
                                                         ∈
                                                         
                                                            B
                                                            −
                                                         
                                                      
                                                   
                                                   
                                                      α
                                                      
                                                         i
                                                         n
                                                      
                                                   
                                                   =
                                                
                                             
                                             
                                                1
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      ∑
                                                      
                                                         j
                                                         :
                                                         
                                                            (
                                                            i
                                                            ,
                                                            j
                                                            )
                                                         
                                                         ∈
                                                         
                                                            B
                                                            −
                                                         
                                                      
                                                   
                                                   
                                                      α
                                                      
                                                         i
                                                         j
                                                      
                                                   
                                                   =
                                                
                                             
                                             
                                                
                                                   
                                                      ∑
                                                      
                                                         j
                                                         :
                                                         
                                                            (
                                                            j
                                                            ,
                                                            i
                                                            )
                                                         
                                                         ∈
                                                         
                                                            B
                                                            −
                                                         
                                                      
                                                   
                                                   
                                                      α
                                                      
                                                         j
                                                         i
                                                      
                                                   
                                                   
                                                   ∀
                                                   i
                                                   ∈
                                                   V
                                                   ∖
                                                   
                                                      {
                                                      1
                                                      ,
                                                      n
                                                      }
                                                   
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              These n equations are linearly dependent, but any 
                                 
                                    n
                                    −
                                    1
                                 
                               of them are independent. From this it follows that the dimension of the affine hull of the feasible vectors α is at most 
                                 
                                    
                                       |
                                    
                                    
                                       B
                                       −
                                    
                                    
                                       |
                                       −
                                       n
                                       +
                                       1
                                    
                                 
                              . In other words, any collection of affinely independent feasible vectors α contains at most 
                                 
                                    
                                       |
                                    
                                    
                                       B
                                       −
                                    
                                    
                                       |
                                       −
                                       n
                                       +
                                       2
                                    
                                 
                               members. This implies the desired result.□

We have not found a simple procedure to construct a maximal family of linearly independent PD equations. We are however able to construct a family of 
                           
                              O
                              (
                              |
                              A
                              ∥
                              
                                 B
                                 −
                              
                              |
                              )
                           
                         valid equations that imply all PD equations. To do this, we use the following lemma:

                           Lemma 3
                           
                              The PD equations 
                              
                                 (17)
                               
                              imply the following “double dipath” (DD) equations:
                              
                                 
                                    (18)
                                    
                                       
                                          
                                             ∑
                                             
                                                b
                                                ∈
                                                
                                                   D
                                                   
                                                      i
                                                      j
                                                   
                                                
                                             
                                          
                                          
                                             f
                                             a
                                             b
                                          
                                          =
                                          
                                             ∑
                                             
                                                b
                                                ∈
                                                
                                                   D
                                                   
                                                      i
                                                      j
                                                   
                                                   ′
                                                
                                             
                                          
                                          
                                             f
                                             a
                                             b
                                          
                                       
                                    
                                 
                              
                              for any a ∈ A, any
                              
                                 
                                    
                                       (
                                       i
                                       ,
                                       j
                                       )
                                    
                                    ∈
                                    
                                       B
                                       +
                                    
                                    ,
                                 
                               
                              and any pair
                              
                                 
                                    
                                       D
                                       
                                          i
                                          j
                                       
                                    
                                    ,
                                    
                                       D
                                       
                                          i
                                          j
                                       
                                       ′
                                    
                                 
                               
                              of dipaths in
                              
                                 
                                    H
                                    −
                                 
                               
                              that start at node i, end at node j, and have no other nodes in common.
                           

Let i, j, Dij
                               and 
                                 
                                    D
                                    
                                       i
                                       j
                                    
                                    ′
                                 
                               be as stated. Let D
                              1i
                               be any dipath in 
                                 
                                    H
                                    −
                                 
                               from 1 to i, and let Djn
                               be any dipath in 
                                 
                                    H
                                    −
                                 
                               from j to n. Then, for any a ∈ A, we have the following two PD equations:

                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      ∑
                                                      
                                                         b
                                                         ∈
                                                         
                                                            D
                                                            
                                                               1
                                                               i
                                                            
                                                         
                                                         ∪
                                                         
                                                            D
                                                            
                                                               i
                                                               j
                                                            
                                                         
                                                         ∪
                                                         
                                                            D
                                                            
                                                               j
                                                               n
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      f
                                                      a
                                                      b
                                                   
                                                
                                             
                                             
                                                =
                                             
                                             
                                                
                                                   x
                                                   a
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      ∑
                                                      
                                                         b
                                                         ∈
                                                         
                                                            D
                                                            
                                                               1
                                                               i
                                                            
                                                         
                                                         ∪
                                                         
                                                            D
                                                            
                                                               i
                                                               j
                                                            
                                                            ′
                                                         
                                                         ∪
                                                         
                                                            D
                                                            
                                                               j
                                                               n
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      f
                                                      a
                                                      b
                                                   
                                                
                                             
                                             
                                                =
                                             
                                             
                                                
                                                   
                                                      x
                                                      a
                                                   
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              Subtracting one from the other yields the DD Eq. (18).□


                              One can construct in
                              
                                 
                                    O
                                    (
                                    n
                                    |
                                    A
                                    ∥
                                    
                                       B
                                       −
                                    
                                    |
                                    )
                                 
                               
                              time a family of |A| PD equations and
                              
                                 
                                    |
                                    A
                                    |
                                    (
                                    |
                                    
                                       B
                                       −
                                    
                                    |
                                    −
                                    n
                                    +
                                    1
                                    )
                                 
                               
                              DD equations that imply all other PD equations.
                           

Let 
                                 
                                    T
                                    ⊂
                                    
                                       B
                                       −
                                    
                                 
                               be an arbitrary spanning arborescence in 
                                 
                                    
                                       H
                                       −
                                    
                                    ,
                                 
                               rooted at node 1. (That is, T is a collection of 
                                 
                                    n
                                    −
                                    1
                                 
                               arcs such that the digraph (V, T) contains a unique dipath from node 1 to any other node.) For each arc a ∈ A, we place into our family the PD equation in which D is set to the unique dipath from 1 to n in (V, T). For each a ∈ A and each 
                                 
                                    
                                       b
                                       ′
                                    
                                    ∈
                                    
                                       B
                                       −
                                    
                                    ∖
                                    T
                                    ,
                                 
                               we place into our family the unique DD equation for which the two dipaths Dij
                               and 
                                 
                                    D
                                    
                                       i
                                       j
                                    
                                    ′
                                 
                               use only arcs in T ∪ {b′}. (To construct these dipaths for a given 
                                 
                                    
                                       b
                                       ′
                                    
                                    =
                                    
                                       (
                                       p
                                       ,
                                       q
                                       )
                                    
                                    ,
                                 
                               first let D
                              1q
                               be the unique dipath from 1 to q in (V, T), and let 
                                 
                                    D
                                    
                                       1
                                       q
                                    
                                    ′
                                 
                               be the union of b′ and the unique dipath from 1 to p in (V, T). Then drop any arcs that D
                              1q
                               and 
                                 
                                    D
                                    
                                       1
                                       q
                                    
                                    ′
                                 
                               have in common, to obtain Dij
                               and 
                                 
                                    D
                                    
                                       i
                                       j
                                    
                                    ′
                                 
                              . Note that 
                                 
                                    j
                                    =
                                    q
                                 
                               and i ∈ π(p).)

Since the arborescence contains 
                                 
                                    n
                                    −
                                    1
                                 
                               arcs, there are 
                                 
                                    
                                       |
                                    
                                    
                                       B
                                       −
                                    
                                    
                                       |
                                       −
                                       n
                                       +
                                       1
                                    
                                 
                               candidates for b′. Therefore the resulting family of equations contains |A| PD equations and 
                                 
                                    |
                                    A
                                    |
                                    (
                                    |
                                    
                                       B
                                       −
                                    
                                    |
                                    −
                                    n
                                    +
                                    1
                                    )
                                 
                               DD equations, as stated. Now consider a fixed a ∈ A, and the associated family of one PP equation and 
                                 
                                    
                                       |
                                    
                                    
                                       B
                                       −
                                    
                                    
                                       |
                                       −
                                       n
                                       +
                                       1
                                    
                                 
                               DD equations. Since each DD equation involves an arc b′ that is not involved in the PD equation, nor in any other DD equation in the family, the α vectors associated with the family of equations (see the proof of Proposition 1) are affinely independent. Together with Proposition 1, this implies that the equations in the family imply all other PD equations for the given arc a.

As for the running time, the arborescence can be constructed in 
                                 
                                    O
                                    (
                                    |
                                    
                                       B
                                       −
                                    
                                    |
                                    )
                                 
                               time, by, e.g., breadth-first search. Once this is done, the dipath D for the PD equations can be computed in 
                                 
                                    O
                                    (
                                    n
                                    )
                                 
                               time, and so can the dipaths Dij
                               and 
                                 
                                    D
                                    
                                       i
                                       j
                                    
                                    ′
                                 
                               for the DD equations, for fixed b′. Since there are 
                                 
                                    O
                                    (
                                    |
                                    
                                       B
                                       −
                                    
                                    |
                                    )
                                 
                               candidates for b′, the total time spent constructing the dipaths is 
                                 
                                    O
                                    (
                                    n
                                    |
                                    
                                       B
                                       −
                                    
                                    |
                                    )
                                 
                              . Once this is done, one can construct the PD equations in 
                                 
                                    O
                                    (
                                    n
                                    |
                                    A
                                    |
                                    )
                                 
                               time and the DD equations in 
                                 
                                    O
                                    (
                                    n
                                    |
                                    A
                                    ∥
                                    
                                       B
                                       −
                                    
                                    |
                                    )
                                 
                               time.□

Taking MCF2 and adding the PD and DD equations mentioned in Theorem 7, we obtain a formulation that we call “MCF3”. We remark that the PD equations, together with non-negativity on the f variables, imply the variable upper bounds 
                           
                              
                                 f
                                 a
                                 b
                              
                              ≤
                              
                                 x
                                 a
                              
                           
                         in (12). Then, they can be deleted from MCF3.

Although the PD and DD equations in MCF3 are polynomial in number, they can still cause problems for an LP solver. Instead of adding them to MCF2 right from the start, it may be preferable to generate PD equations dynamically, as cutting planes. The following result is useful in this regard:

                           Proposition 2
                           
                              If (x
                              *, f
                              *) is a feasible solution to the continuous relaxation of MCF2, then the separation problem for the PD equations 
                              
                                 (17)
                               
                              can be solved in
                              
                                 
                                    O
                                    (
                                    |
                                    A
                                    |
                                    +
                                    |
                                    
                                       A
                                       *
                                    
                                    ∥
                                    
                                       B
                                       −
                                    
                                    |
                                    )
                                 
                               
                              time, where A
                              * 
                              is the number of x variables that have a positive value at x
                              *
                              .
                           

Consider a given arc a ∈ A. If 
                                 
                                    
                                       x
                                       a
                                       *
                                    
                                    =
                                    0
                                    ,
                                 
                               then the bounds (12) force 
                                 
                                    f
                                    a
                                    b
                                 
                               to be zero for all 
                                 
                                    b
                                    ∈
                                    
                                       B
                                       −
                                    
                                    ,
                                 
                               and no PD equation can be violated for the given a. So suppose that 
                                 
                                    
                                       x
                                       a
                                       *
                                    
                                    >
                                    0
                                 
                              . Assign to each arc 
                                 
                                    b
                                    ∈
                                    
                                       B
                                       −
                                    
                                 
                               a weight of 
                                 
                                    
                                       (
                                       
                                          f
                                          a
                                          b
                                       
                                       )
                                    
                                    *
                                 
                              . Then there exists a violated PD equation for the given a if and only if there exists some dipath 
                                 
                                    D
                                    ∈
                                    D
                                 
                               whose weight exceeds 
                                 
                                    x
                                    a
                                    *
                                 
                              . Since 
                                 
                                    H
                                    −
                                 
                               is a directed acyclic graph, a maximum weight (1, n)-dipath in 
                                 
                                    H
                                    −
                                 
                               can be computed in 
                                 
                                    
                                       |
                                    
                                    
                                       B
                                       −
                                    
                                    
                                       |
                                    
                                 
                               time.□

In this subsection, we show that the projection of MCF3 satisfies two new (and again exponentially large) families of valid inequalities. The first family arises from an application of Theorems 3 and 4, presented in Section 2.3.

                           Theorem 8
                           
                              The projection of MCF3 satisfies the “oriented multicut” (OM) inequality
                              
                                 
                                    (19)
                                    
                                       
                                          x
                                          
                                             (
                                             A
                                             
                                                (
                                                
                                                   S
                                                   1
                                                
                                                ,
                                                …
                                                ,
                                                
                                                   S
                                                   k
                                                
                                                )
                                             
                                             )
                                          
                                          
                                          ≥
                                          
                                          
                                             max
                                             
                                                D
                                                ∈
                                                D
                                             
                                          
                                          
                                          
                                             |
                                             D
                                             ∩
                                             
                                                B
                                                −
                                             
                                             
                                                (
                                                
                                                   S
                                                   1
                                                
                                                ,
                                                …
                                                ,
                                                
                                                   S
                                                   k
                                                
                                                )
                                             
                                             |
                                          
                                       
                                    
                                 
                              
                              for every ordered partition
                              
                                 
                                    
                                       S
                                       1
                                    
                                    ,
                                    …
                                    ,
                                    
                                       S
                                       k
                                    
                                 
                               
                              of V.
                           

Let (x
                              *, f
                              *) be a feasible solution to the LP relaxation of MCF3, and let D
                              * denote the dipath achieving the maximum on the right-hand side of (19). Due to the flow conservation equations (11) and the PD equations (17), we can interpret 
                                 
                                    
                                       (
                                       
                                          f
                                          a
                                          b
                                       
                                       )
                                    
                                    *
                                 
                               for a ∈ A and b ∈ D
                              * as a simultaneous routing of the commodities in D
                              * such that the amount routed across each arc a ∈ A does not exceed 
                                 
                                    x
                                    a
                                    *
                                 
                              . Then, by setting 
                                 
                                    B
                                    =
                                    
                                       D
                                       *
                                    
                                    ,
                                 
                              
                              
                                 
                                    u
                                    =
                                    
                                       x
                                       *
                                    
                                 
                               and 
                                 
                                    
                                       d
                                       
                                          p
                                          q
                                       
                                    
                                    =
                                    1
                                 
                               for all (p, q) ∈ D
                              * in Theorem 3, we see that (x
                              *, f
                              *) must satisfy the metric inequalities

                                 
                                    
                                       
                                          
                                             ∑
                                             
                                                a
                                                ∈
                                                A
                                             
                                          
                                          
                                             μ
                                             a
                                          
                                          
                                             x
                                             a
                                             *
                                          
                                          ≥
                                          
                                             ∑
                                             
                                                b
                                                ∈
                                                
                                                   D
                                                   *
                                                
                                             
                                          
                                          
                                             μ
                                             b
                                          
                                          .
                                       
                                    
                                 
                              Setting μ to the metric given in Theorem 4, we see that x
                              * must satisfy:

                                 
                                    
                                       
                                          x
                                          
                                             (
                                             A
                                             
                                                (
                                                
                                                   S
                                                   1
                                                
                                                ,
                                                …
                                                ,
                                                
                                                   S
                                                   k
                                                
                                                )
                                             
                                             )
                                          
                                          
                                          ≥
                                          
                                          
                                             |
                                             
                                                D
                                                *
                                             
                                             ∩
                                             
                                                B
                                                −
                                             
                                             
                                                (
                                                
                                                   S
                                                   1
                                                
                                                ,
                                                …
                                                ,
                                                
                                                   S
                                                   k
                                                
                                                )
                                             
                                             |
                                          
                                          .
                                       
                                    
                                 
                              The result then follows from the definition of D
                              *.□

It turns out that the OM inequalities generalise and/or dominate several known families of valid inequalities in the literature:

                           Proposition 3
                           
                              The OM inequalities 
                              
                                 (19)
                               
                              generalise and/or dominate the following inequalities:
                              
                                 
                                    •
                                    
                                       the P-to-Q inequalities 
                                       
                                          (9)
                                        
                                       (and therefore the PF inequalities 
                                       
                                          (5)
                                       
                                       );
                                    


                                       the odd dipath inequalities 
                                       
                                          (10)
                                        
                                       (and therefore the SE inequalities 
                                       
                                          (4)
                                       
                                       );
                                    


                                       the PCB inequalities 
                                       
                                          (8)
                                        
                                       such that, for some 1 ≤ s ≤ k, there exists a dipath
                                       
                                          
                                             D
                                             ∈
                                             D
                                          
                                        
                                       that has at least two arcs with tail in Ss and head outside Ss.
                                    

Consider sets P and Q satisfying the conditions in (9). Setting 
                                 
                                    k
                                    =
                                    3
                                    ,
                                 
                              
                              
                                 
                                    
                                       S
                                       1
                                    
                                    =
                                    P
                                    ,
                                 
                              
                              
                                 
                                    
                                       S
                                       2
                                    
                                    =
                                    Q
                                 
                               and 
                                 
                                    
                                       S
                                       3
                                    
                                    =
                                    V
                                    ∖
                                    
                                       (
                                       P
                                       ∪
                                       Q
                                       )
                                    
                                    ,
                                 
                               we obtain the OM inequality

                                 
                                    
                                       
                                          x
                                          
                                             (
                                             A
                                             
                                                (
                                                P
                                                ,
                                                Q
                                                ,
                                                V
                                                ∖
                                                
                                                   (
                                                   P
                                                   ∪
                                                   Q
                                                   )
                                                
                                                )
                                             
                                             )
                                          
                                          ≥
                                          
                                             max
                                             
                                                D
                                                ∈
                                                D
                                             
                                          
                                          
                                          
                                             |
                                             D
                                             ∩
                                             
                                                B
                                                −
                                             
                                             
                                                (
                                                P
                                                ,
                                                Q
                                                ,
                                                V
                                                ∖
                                                
                                                   (
                                                   P
                                                   ∪
                                                   Q
                                                   )
                                                
                                                )
                                             
                                             |
                                          
                                          .
                                       
                                    
                                 
                              The left-hand side of this OM inequality is the same as that of (9), and its right-hand side is at least as large.

Now consider any S⊆V∖{1, n}. Setting 
                                 
                                    k
                                    =
                                    2
                                    ,
                                 
                              
                              
                                 
                                    
                                       S
                                       1
                                    
                                    =
                                    S
                                 
                               and 
                                 
                                    
                                       S
                                       2
                                    
                                    =
                                    V
                                    ∖
                                    S
                                    ,
                                 
                               we obtain the OM inequality:

                                 
                                    (20)
                                    
                                       
                                          x
                                          
                                             (
                                             A
                                             
                                                (
                                                S
                                                :
                                                V
                                                ∖
                                                S
                                                )
                                             
                                             )
                                          
                                          
                                          ≥
                                          
                                          
                                             max
                                             
                                                D
                                                ∈
                                                D
                                             
                                          
                                          
                                          
                                             |
                                             D
                                             ∩
                                             
                                                B
                                                −
                                             
                                             
                                                (
                                                S
                                                ,
                                                V
                                                ∖
                                                S
                                                )
                                             
                                             |
                                          
                                          .
                                       
                                    
                                 
                              The left-hand side of this OM inequality is the same as that of (10), and its right-hand side is at least as large.

As for the PCB inequalities, if there exists some s with the stated property, then the OM inequality obtained by setting 
                                 
                                    S
                                    =
                                    
                                       S
                                       s
                                    
                                 
                               in (20) has a right-hand side at least 2. This inequality, together with the SE inequalities on the sets Sr
                               with r ≠ s, implies the PCB inequality (8).□

We remark that no polynomial-time separation algorithms are known for the PCB, P-to-Q or odd dipath inequalities themselves.

We call the inequalities (20), which are the OM inequalities with 
                           
                              k
                              =
                              2
                              ,
                           
                         
                        dicut inequalities. The following theorem shows that the dicut inequalities can be both generalised and strengthened. (Gouveia and Ruthmair, 2015 strengthen the (less general) odd dipath inequalities in a similar way.)

                           Theorem 9
                           
                              Let S ⊂ V∖{1, n} be given, and let D be any dipath in
                              
                                 
                                    H
                                    −
                                 
                               
                              such that
                              
                                 
                                    D
                                    ∩
                                    
                                       B
                                       −
                                    
                                    
                                       (
                                       S
                                       ,
                                       V
                                       ∖
                                       S
                                       )
                                    
                                    ≠
                                    ∅
                                 
                              
                              . Let t be the tail of the first arc in D that lies in
                              
                                 
                                    
                                       B
                                       −
                                    
                                    
                                       (
                                       S
                                       ,
                                       V
                                       ∖
                                       S
                                       )
                                    
                                    ,
                                 
                               
                              and let h be the head of the last such arc. Then the projection of MCF3 satisfies the “generalised strengthened dicut” (GSD) inequality:
                              
                                 
                                    (21)
                                    
                                       
                                          
                                             
                                             
                                             
                                                
                                                   x
                                                   (
                                                   A
                                                   (
                                                   
                                                   S
                                                   ∖
                                                   (
                                                   π
                                                   (
                                                   t
                                                   )
                                                   ∪
                                                   σ
                                                   (
                                                   h
                                                   )
                                                   )
                                                   ,
                                                   
                                                   V
                                                   ∖
                                                   (
                                                   S
                                                   ∪
                                                   π
                                                   (
                                                   t
                                                   )
                                                   ∪
                                                   σ
                                                   (
                                                   h
                                                   )
                                                   )
                                                   
                                                   )
                                                   )
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                             
                                                
                                                   
                                                      
                                                      ≥
                                                      
                                                      |
                                                      D
                                                      ∩
                                                   
                                                   
                                                      B
                                                      −
                                                   
                                                   
                                                      
                                                         (
                                                         S
                                                         ,
                                                         V
                                                         ∖
                                                         S
                                                         )
                                                      
                                                      |
                                                      .
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           

Summing the flow conservation equations (11) over all nodes i ∈ S and all commodities 
                                 
                                    b
                                    ∈
                                    D
                                    ∩
                                    
                                       B
                                       −
                                    
                                    
                                       (
                                       S
                                       ,
                                       V
                                       ∖
                                       S
                                       )
                                    
                                    ,
                                 
                               we obtain:

                                 
                                    
                                       
                                          
                                             ∑
                                             
                                                b
                                                ∈
                                                D
                                                ∩
                                                
                                                   B
                                                   −
                                                
                                                
                                                   (
                                                   S
                                                   ,
                                                   V
                                                   ∖
                                                   S
                                                   )
                                                
                                             
                                          
                                          
                                             f
                                             b
                                          
                                          
                                             (
                                             A
                                             
                                                (
                                                S
                                                ,
                                                V
                                                ∖
                                                S
                                                )
                                             
                                             )
                                          
                                          =
                                          
                                             |
                                             D
                                             ∩
                                             
                                                B
                                                −
                                             
                                             
                                                (
                                                S
                                                ,
                                                V
                                                ∖
                                                S
                                                )
                                             
                                             |
                                          
                                          .
                                       
                                    
                                 
                              Now, due to Lemma 2, this equation remains valid if we replace the left-hand side with

                                 
                                    
                                       
                                          
                                             ∑
                                             
                                                b
                                                ∈
                                                D
                                                ∩
                                                
                                                   B
                                                   −
                                                
                                                
                                                   (
                                                   S
                                                   ,
                                                   V
                                                   ∖
                                                   S
                                                   )
                                                
                                             
                                          
                                          
                                             f
                                             b
                                          
                                          
                                             (
                                             A
                                             
                                                (
                                                
                                                S
                                                ∖
                                                
                                                   (
                                                   π
                                                   
                                                      (
                                                      t
                                                      )
                                                   
                                                   ∪
                                                   σ
                                                   
                                                      (
                                                      h
                                                      )
                                                   
                                                   )
                                                
                                                
                                                ,
                                                
                                                V
                                                ∖
                                                
                                                   (
                                                   S
                                                   ∪
                                                   π
                                                   
                                                      (
                                                      t
                                                      )
                                                   
                                                   ∪
                                                   σ
                                                   
                                                      (
                                                      h
                                                      )
                                                   
                                                   )
                                                
                                                
                                                )
                                             
                                             )
                                          
                                          .
                                       
                                    
                                 
                              Due to the PD equations (17) for the given D, this expression cannot be larger than the left-hand side of (21).□

We have the following lemma:

                           Lemma 4
                           
                              The GSD inequalities 
                              
                                 (21)
                               
                              generalise the simple (π, σ) inequalities 
                              
                                 (7)
                              
                              .
                           

Let S, p and q satisfy the conditions in (7). Set D to the trivial dipath in 
                                 
                                    H
                                    −
                                 
                               that consists of the single arc (p, q). Then D(S) also contains only the single arc (p, q), which in turn implies that 
                                 
                                    t
                                    =
                                    p
                                 
                               and 
                                 
                                    h
                                    =
                                    q
                                 
                              .□

Using the same approach as in Theorem 9, it is possible to define a family of “generalised strengthened OM” inequalities, which reduce to GSD inequalities when 
                           
                              k
                              =
                              2
                           
                        . We do not go into details, however, partly for the sake of brevity, but partly because the notation becomes burdensome. In any case, we have seen that the projection of MCF3 satisfies many of the known inequalities in the SOP literature (namely, the SE, PF, simple (π, σ), P-to-Q and odd dipath inequalities, together with a large subclass of the PCB inequalities), and many more inequalities besides.

Perhaps surprisingly, one can derive additional valid equations, that are not implied by the Eqs. (2), (3), (11) or (17). These new equations are presented in the following proposition:

                           Proposition 4
                           
                              Let i and j be any two nodes in V∖{1, n} that are incomparable, in the sense that i ∉ σ(j) and j ∉ σ(i). Let D
                              1i
                               
                              be any dipath in
                              
                                 
                                    H
                                    −
                                 
                               
                              from 1 to i, and let D
                              1j
                               
                              be any dipath in
                              
                                 
                                    H
                                    −
                                 
                               
                              from 1 to j. Then every feasible (integer) solution of MCF3 must satisfy the following “incomparable pair” (IP) equation:
                              
                                 
                                    (22)
                                    
                                       
                                          
                                             ∑
                                             
                                                b
                                                ∈
                                                
                                                   D
                                                   
                                                      1
                                                      j
                                                   
                                                
                                             
                                          
                                          
                                             f
                                             b
                                          
                                          
                                             (
                                             A
                                             
                                                (
                                                
                                                   {
                                                   i
                                                   }
                                                
                                                ,
                                                V
                                                ∖
                                                
                                                   {
                                                   i
                                                   }
                                                
                                                )
                                             
                                             )
                                          
                                          
                                          +
                                          
                                          
                                             ∑
                                             
                                                b
                                                ∈
                                                
                                                   D
                                                   
                                                      1
                                                      i
                                                   
                                                
                                             
                                          
                                          
                                             f
                                             b
                                          
                                          
                                             (
                                             A
                                             
                                                (
                                                
                                                   {
                                                   j
                                                   }
                                                
                                                ,
                                                V
                                                ∖
                                                
                                                   {
                                                   j
                                                   }
                                                
                                                )
                                             
                                             )
                                          
                                          
                                          =
                                          
                                          1
                                          .
                                       
                                    
                                 
                              
                           

By definition, the vehicle cannot carry more than one of the commodities in D
                              1j
                               at any given time. Also, if it is carrying one of them at a given time, then it has not yet visited node j. Accordingly, the first of the two quantities on the left-hand side of (22) takes the value 1 if node i is visited before node j, and 0 otherwise. For similar reasons, the second quantity on the left-hand side of (22) takes the value 1 if node j is visited before node i, and 0 otherwise. Therefore, exactly one of the two quantities must equal 1.□

As with the PD equations (17) and DD equations (18), the IP equations (22) can be exponential in number. Fortunately, it is enough to take one IP equation (arbitrarily chosen) for each incomparable pair i, j. To see this, recall from Lemma 3 that the DD Eq. (18) are already satisfied by the continuous relaxation of MCF3. The DD equations imply that the left-hand side of (22) remains the same for any choice of D
                        1i
                         and D
                        1j
                        .

Adding at most 
                           
                              (
                              
                                 
                                    n
                                    −
                                    2
                                 
                                 2
                              
                              )
                           
                         IP Eq. (22) to MCF3 (one for each incomparable pair i, j), we obtain a formulation that we call “MCF4”. We have not been able to characterise any inequalities that are valid for the projection of MCF4, beyond those that we have already proven to be valid for the projection of MCF3. Nevertheless, our computational results (Section 6) show that the lower bound obtained by solving the continuous relaxation of MCF4 is stronger than the one obtained by solving the continuous relaxation of MCF3.

The number of variables in the formulations MCF1–MCF4, though polynomial, is very large. This makes solving even their continuous relaxations a challenge in practice. Fortunately, one can optimise over the projection of MCF2 efficiently in practice, using Theorem 6, together with the fact, mentioned in Section 2.1, that the separation problem for the simple (π, σ) inequalities (7) can be solved efficiently. One can optimise over the projection of MCF1 in a similar way (details omitted for brevity).

Unfortunately, we do not know of any (practically) efficient way to optimise over the projections of MCF3 and MCF4. On the other hand, the PD equations enable one to eliminate many f variables. This can be done in several ways, but care is needed to ensure that the elimination is done in such a way that the density of the constraint matrix is not substantially increased. Our preferred option is to eliminate all of the f variables associated with the commodities in 
                           
                              B
                              −
                           
                         that have node n as the destination. The following proposition shows how to do this:

                           Proposition 5
                           
                              Let T be as in the proof of 
                              
                                 Theorem 7
                              
                              , and let R denote
                              
                                 
                                    
                                       B
                                       −
                                    
                                    
                                       (
                                       V
                                       ∖
                                       
                                          {
                                          n
                                          }
                                       
                                       ,
                                       
                                          {
                                          n
                                          }
                                       
                                       )
                                    
                                 
                              
                              . The lower bounds obtained by optimising over the continuous relaxations of 
                              MCF3 and MCF4 are unchanged if we make the following changes to the relaxations:

                                 
                                    •
                                    
                                       delete the variables
                                       
                                          
                                             f
                                             a
                                             b
                                          
                                        
                                       for all a ∈ A and b ∈ R;
                                    


                                       delete the Eq. 
                                       
                                          (11)
                                        
                                       for all i ∈ V and b ∈ R;
                                    


                                       delete the inequalities 
                                       
                                          (12)
                                        
                                       for all a ∈ A and b ∈ R;
                                    


                                       delete the PD equations mentioned in the proof of 
                                       
                                          Theorem 7
                                       
                                       ;
                                    


                                       delete all DD equations mentioned in the proof of 
                                       
                                          Theorem 7
                                        
                                       such that b′ ∈ R∖T;
                                    


                                       add the inequality
                                       
                                          
                                             
                                                ∑
                                                
                                                   b
                                                   ∈
                                                   D
                                                
                                             
                                             
                                                f
                                                a
                                                b
                                             
                                             ≤
                                             
                                                x
                                                a
                                             
                                          
                                        
                                       for all a ∈ A and all of the |R| maximal dipaths D in
                                       
                                          
                                             H
                                             −
                                          
                                        
                                       that use only arcs in T∖R.
                                    

Let x
                              * ∈ [0, 1]|A| and (fb
                              )* ∈ [0, 1]|A| for 
                                 
                                    b
                                    ∈
                                    
                                       B
                                       −
                                    
                                    ∖
                                    R
                                 
                               be given. For each b ∈ R, we construct a vector (fb
                              )* ∈ [0, 1]|A| as follows. Let D(b) be the unique dipath in 
                                 D
                               that uses only arcs in T ∪ {b}. Then set:

                                 
                                    
                                       
                                          
                                             
                                                (
                                                
                                                   f
                                                   a
                                                   b
                                                
                                                )
                                             
                                             *
                                          
                                          =
                                          
                                             x
                                             a
                                             *
                                          
                                          −
                                          
                                             ∑
                                             
                                                h
                                                ∈
                                                D
                                                (
                                                b
                                                )
                                             
                                          
                                          
                                             
                                                (
                                                
                                                   f
                                                   a
                                                   h
                                                
                                                )
                                             
                                             *
                                          
                                          
                                          ∀
                                          a
                                          ∈
                                          A
                                          ,
                                          
                                          b
                                          ∈
                                          R
                                          .
                                       
                                    
                                 
                              It is then an easy (though tedious) exercise to show that x
                              * and (fb
                              )* for 
                                 
                                    b
                                    ∈
                                    
                                       B
                                       −
                                    
                                 
                               constitute a feasible solution to the original relaxation if and only if x
                              * and (fb
                              )* for 
                                 
                                    b
                                    ∈
                                    
                                       B
                                       −
                                    
                                    ∖
                                    R
                                 
                               constitute a feasible solution to the modified relaxation.□

We remark that the separation problem for the inequalities mentioned in Proposition 5 can be solved in 
                           
                              O
                              (
                              |
                              A
                              |
                              +
                              |
                              
                                 A
                                 *
                              
                              ∥
                              
                                 B
                                 −
                              
                              |
                              )
                           
                         time, using a similar argument to the one used to prove Proposition 2.

In the case of MCF3, a further reduction in the number of commodities is possible, at the expense of re-introducing a subset of the SE inequalities:

                           Proposition 6
                           
                              Define the node set
                              
                                 
                                    
                                       
                                          
                                             
                                                F
                                             
                                             
                                                =
                                             
                                             
                                                
                                                   {
                                                   i
                                                   ∈
                                                   V
                                                   ∖
                                                   {
                                                   1
                                                   ,
                                                   n
                                                   }
                                                   :
                                                   
                                                   π
                                                   (
                                                   i
                                                   )
                                                   =
                                                   {
                                                   1
                                                   }
                                                   ,
                                                   
                                                   σ
                                                   (
                                                   i
                                                   )
                                                   =
                                                   {
                                                   n
                                                   }
                                                   }
                                                
                                             
                                          
                                          
                                             
                                             
                                                =
                                             
                                             
                                                
                                                   {
                                                   i
                                                   ∈
                                                   V
                                                   ∖
                                                   
                                                      {
                                                      1
                                                      ,
                                                      n
                                                      }
                                                   
                                                   :
                                                   
                                                   
                                                      (
                                                      1
                                                      ,
                                                      i
                                                      )
                                                   
                                                   ,
                                                   
                                                      (
                                                      i
                                                      ,
                                                      n
                                                      )
                                                   
                                                   ∈
                                                   
                                                      B
                                                      −
                                                   
                                                   }
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              (That is, F consists of the “free” nodes, that are not involved in any “genuine” precedences.) Then the lower bound obtained by optimising over the continuous relaxation of MCF3 is unchanged if, in addition to the reduction mentioned in Proposition 
                              
                                 5
                              
                              , we make the following changes:

                                 
                                    •
                                    
                                       delete the variable
                                       
                                          
                                             f
                                             a
                                             
                                                1
                                                i
                                             
                                          
                                        
                                       for all a ∈ A and all i ∈ F, along with all constraints in which it is involved;
                                    


                                       add the SE inequalities 
                                       
                                          (4)
                                        
                                       for all S⊆F.
                                    

Consider some i ∈ F. After applying the reduction mentioned in Proposition 5, there is only one commodity associated with node i, namely the commodity (1, i). One can check that the f variables associated with this commodity, i.e., the variables 
                                 
                                    f
                                    a
                                    
                                       1
                                       i
                                    
                                 
                               for a ∈ A, do not appear together with variables associated with other commodities in any constraint of MCF3. Then, we can treat commodity (1, i) independently from the other commodities when analysing the projection of MCF3. Note also that none of the 
                                 
                                    f
                                    a
                                    
                                       1
                                       i
                                    
                                 
                               variables can be fixed to zero using Lemma 2 (beyond those that automatically take the value zero due to Lemma 1). Then, by Theorem 1, the only effect that the commodity (1, i) has on the projection is to enforce the SE inequality for all S ⊂ V such that i ∈ S, 1 ∉ S.

It follows that the effect on the projection of all of the commodities (1, i) for i ∈ F is merely to impose the SE inequality for all S ⊂ V with S ∩ F ≠ ∅ and 1 ∉ S. Of these, the ones with S∖F ≠ ∅ are already imposed by the constraints involving other commodities (see the proof of Theorem 5).□

We remark that the separation problem for the SE inequalities mentioned in Proposition 6 can be easily solved in polynomial time, by shrinking the nodes in V∖F and then applying any minimum cut algorithm. We remark also that the proof of Proposition 6 does not carry over to MCF4, since a single IP Eq. (22) can involve commodities associated with two free nodes. We do not know whether an analogue of Proposition 6 holds for MCF4.


                        Table 1
                         summarises the four models described in this paper for the SOP.

We close this section with one final remark. When all nodes are free, the SOP reduces to the asymmetric travelling salesman problem (ATSP). The results in this section and the last imply that, in this case, the projections of MCF1 to MCF3 are defined by the degree, SE and non-negativity inequalities. Interestingly, this does not hold for MCF4. Indeed, we have found small ATSP instances for which the LP relaxation of MCF4 gives a stronger lower bound than that of MCF3.

Now we turn our attention to the CSOP (defined in Section 2.2).

We start by extending the commodity-elimination rule of Gouveia and Ruthmair (2015). Suppose that an arc (i, j) is in B but not in 
                           
                              B
                              −
                           
                        . Then there exists a dipath in 
                           
                              H
                              −
                           
                         from i to j. The set of feasible CSOP solutions is then unchanged if we remove the arc (i, j) from B and increase the weight of all arcs in the dipath by dij
                        . From this, it follows that we can assume that each commodity corresponds to an arc in 
                           
                              
                                 B
                                 −
                              
                              ,
                           
                         and vice-versa. We make this assumption in the remainder of this section.

We also assume that all arcs that can be deleted from A using the rules mentioned in Sections 2.1 and 2.2 have been deleted. (For the rule mentioned in Section 2.2, we replace B with 
                           
                              B
                              −
                           
                        .)

Our first MCF formulation of the CSOP, called “MCF1C”, is obtained simply by adding the following inequalities to MCF1:

                           
                              (23)
                              
                                 
                                    
                                       ∑
                                       
                                          b
                                          ∈
                                          
                                             B
                                             −
                                          
                                       
                                    
                                    
                                       d
                                       b
                                    
                                    
                                       f
                                       a
                                       b
                                    
                                    ≤
                                    Q
                                    
                                       x
                                       a
                                    
                                    
                                    ∀
                                    a
                                    ∈
                                    A
                                    .
                                 
                              
                           
                        Note that these are the same as (13), except that we sum over 
                           
                              B
                              −
                           
                         rather than B.

Although MCF1C is only a minor extension of MCF1, it has a more complicated projection:

                           Proposition 7
                           
                              The projection of MCF1C satisfies the following “fractional capacitated oriented multicut” (FCOM) inequality for each ordered partition
                              
                                 
                                    
                                       S
                                       1
                                    
                                    ,
                                    …
                                    ,
                                    
                                       S
                                       k
                                    
                                 
                               
                              of V:
                              
                                 
                                    
                                       
                                          x
                                          
                                             (
                                             A
                                             
                                                (
                                                
                                                   S
                                                   1
                                                
                                                ,
                                                …
                                                ,
                                                
                                                   S
                                                   k
                                                
                                                )
                                             
                                             )
                                          
                                          
                                          ≥
                                          
                                          
                                             
                                                d
                                                (
                                                
                                                   B
                                                   −
                                                
                                                
                                                   (
                                                   
                                                      S
                                                      1
                                                   
                                                   ,
                                                   …
                                                   ,
                                                   
                                                      S
                                                      k
                                                   
                                                   )
                                                
                                                )
                                             
                                             Q
                                          
                                          .
                                       
                                    
                                 
                              
                           

Similar to the proof of Theorem 8.□

Observe that there is no dominance relation, in general, between the FCOM inequalities and the OM inequalities. Moreover, one could obtain a family of valid inequalities for the CSOP that dominate both, by replacing the right-hand side of either by:

                           
                              
                                 
                                    max
                                    
                                       {
                                       
                                          max
                                          
                                             D
                                             ∈
                                             D
                                          
                                       
                                       
                                       
                                          |
                                          D
                                          ∩
                                          
                                             B
                                             −
                                          
                                          
                                             (
                                             
                                                S
                                                1
                                             
                                             ,
                                             …
                                             ,
                                             
                                                S
                                                k
                                             
                                             )
                                          
                                          |
                                       
                                       ,
                                       
                                       
                                          ⌈
                                          
                                             
                                                d
                                                (
                                                
                                                   B
                                                   −
                                                
                                                
                                                   (
                                                   
                                                      S
                                                      1
                                                   
                                                   ,
                                                   …
                                                   ,
                                                   
                                                      S
                                                      k
                                                   
                                                   )
                                                
                                                )
                                             
                                             Q
                                          
                                          ⌉
                                       
                                       }
                                    
                                    .
                                 
                              
                           
                        The resulting inequalities, however, would not be satisfied by the projections in general.

When 
                           
                              k
                              =
                              2
                              ,
                           
                         the FCOM inequalities reduce to:

                           
                              
                                 
                                    x
                                    
                                       (
                                       A
                                       
                                          (
                                          S
                                          ,
                                          V
                                          ∖
                                          S
                                          )
                                       
                                       )
                                    
                                    
                                    ≥
                                    
                                    
                                       
                                          d
                                          (
                                          
                                             B
                                             −
                                          
                                          
                                             (
                                             S
                                             ,
                                             V
                                             ∖
                                             S
                                             )
                                          
                                          )
                                       
                                       Q
                                    
                                    .
                                 
                              
                           
                        We call these fractional capacitated dicut (FCD) inequalities. They are considered in Hernández-Pérez and Salazar-González (2009) and are analogous to the well-known fractional capacity inequalities for the CVRP (see, e.g., Gouveia, 1995; Letchford & Salazar-González, 2006), which are dominated by some other inequalities called multistar inequalities (see Gouveia, 1995). It is possible to derive multistar inequalities for the CSOP too, that dominate the FCD inequalities.

                           Theorem 10
                           
                              For any S ⊂ V and any (i, j) ∈ A(V∖S, S), define
                              
                                 
                                    
                                       
                                          
                                             B
                                             ˜
                                          
                                          
                                             (
                                             S
                                             ,
                                             i
                                             ,
                                             j
                                             )
                                          
                                          =
                                          
                                             B
                                             −
                                          
                                          
                                             (
                                             
                                                {
                                                i
                                                }
                                             
                                             ,
                                             V
                                             ∖
                                             
                                                (
                                                S
                                                ∪
                                                
                                                   {
                                                   i
                                                   }
                                                
                                                )
                                             
                                             )
                                          
                                          ∪
                                          
                                             B
                                             −
                                          
                                          
                                             (
                                             S
                                             ∖
                                             
                                                {
                                                j
                                                }
                                             
                                             ,
                                             
                                                {
                                                j
                                                }
                                             
                                             )
                                          
                                          .
                                       
                                    
                                 
                              
                              The projection of MCF1C satisfies the following “multistar” inequality for each S ⊂ V:
                              
                                 
                                    (24)
                                    
                                       
                                          x
                                          
                                             (
                                             A
                                             
                                                (
                                                S
                                                ,
                                                V
                                                ∖
                                                S
                                                )
                                             
                                             )
                                          
                                          
                                          ≥
                                          
                                          
                                             
                                                d
                                                
                                                   (
                                                   
                                                      B
                                                      −
                                                   
                                                   
                                                      (
                                                      S
                                                      ,
                                                      V
                                                      ∖
                                                      S
                                                      )
                                                   
                                                   )
                                                
                                                +
                                                
                                                   ∑
                                                   
                                                      (
                                                      i
                                                      ,
                                                      j
                                                      )
                                                      ∈
                                                      A
                                                      (
                                                      V
                                                      ∖
                                                      S
                                                      ,
                                                      S
                                                      )
                                                   
                                                
                                                d
                                                
                                                   (
                                                   
                                                      B
                                                      ˜
                                                   
                                                   
                                                      (
                                                      S
                                                      ,
                                                      i
                                                      ,
                                                      j
                                                      )
                                                   
                                                   )
                                                
                                                
                                                   x
                                                   
                                                      i
                                                      j
                                                   
                                                
                                             
                                             Q
                                          
                                          .
                                       
                                    
                                 
                              
                           

Let S ⊂ V be fixed. The proof will proceed in three steps. First, we will create an artificial single-commodity flow, by taking a non-negative linear combination of the actual commodity flows. Second, we will derive lower and upper bounds on the amount of the artificial flow passing through each arc. Third, we will apply Hoffman’s circulation theorem to obtain the multistar inequality.

The artificial flow, say f, is obtained by setting

                                 
                                    
                                       
                                          
                                             f
                                             a
                                          
                                          =
                                          
                                             ∑
                                             
                                                b
                                                ∈
                                                
                                                   B
                                                   −
                                                
                                                ∖
                                                
                                                   B
                                                   −
                                                
                                                
                                                   (
                                                   V
                                                   ∖
                                                   S
                                                   ,
                                                   S
                                                   )
                                                
                                             
                                          
                                          
                                             d
                                             b
                                          
                                          
                                             f
                                             a
                                             b
                                          
                                          
                                          ∀
                                          
                                             (
                                             i
                                             ,
                                             j
                                             )
                                          
                                          ∈
                                          A
                                          .
                                       
                                    
                                 
                              That is, fa
                               represents the total load carried across the arc a, but excluding the commodities in 
                                 
                                    
                                       B
                                       −
                                    
                                    
                                       (
                                       V
                                       ∖
                                       S
                                       ,
                                       S
                                       )
                                    
                                 
                              . Observe that the net amount of this flow leaving a given i ∈ V is:

                                 
                                    
                                       
                                          
                                             
                                             
                                             
                                                
                                                   d
                                                   
                                                      (
                                                      
                                                         B
                                                         −
                                                      
                                                      
                                                         (
                                                         
                                                            {
                                                            i
                                                            }
                                                         
                                                         ,
                                                         V
                                                         ∖
                                                         
                                                            {
                                                            i
                                                            }
                                                         
                                                         )
                                                      
                                                      )
                                                   
                                                   −
                                                   d
                                                   
                                                      (
                                                      
                                                         B
                                                         −
                                                      
                                                      
                                                         (
                                                         S
                                                         ∖
                                                         
                                                            {
                                                            i
                                                            }
                                                         
                                                         ,
                                                         
                                                            {
                                                            i
                                                            }
                                                         
                                                         )
                                                      
                                                      )
                                                   
                                                   
                                                   
                                                   
                                                   
                                                   if
                                                   
                                                   i
                                                   ∈
                                                   S
                                                
                                             
                                          
                                          
                                             
                                             
                                             
                                                
                                                   d
                                                   
                                                      (
                                                      
                                                         B
                                                         −
                                                      
                                                      
                                                         (
                                                         
                                                            {
                                                            i
                                                            }
                                                         
                                                         ,
                                                         V
                                                         ∖
                                                         
                                                            (
                                                            S
                                                            ∪
                                                            
                                                               {
                                                               i
                                                               }
                                                            
                                                            )
                                                         
                                                         )
                                                      
                                                      )
                                                   
                                                   −
                                                   d
                                                   
                                                      (
                                                      
                                                         B
                                                         −
                                                      
                                                      
                                                         (
                                                         V
                                                         ∖
                                                         
                                                            {
                                                            i
                                                            }
                                                         
                                                         ,
                                                         
                                                            {
                                                            i
                                                            }
                                                         
                                                         )
                                                      
                                                      )
                                                   
                                                   
                                                   if
                                                   
                                                   i
                                                   ∉
                                                   S
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              We will denote this quantity by di
                              .

Now for the lower and upper bounds. The upper bounds are easy: from (23), we have fij
                               ≤ Qxij
                               for all (i, j) ∈ A. As for the lower bounds, note that, by Lemma 1, we have 
                                 
                                    
                                       f
                                       
                                          i
                                          j
                                       
                                       b
                                    
                                    =
                                    
                                       x
                                       
                                          i
                                          j
                                       
                                    
                                 
                               for all (i, j) ∈ A(V∖S, S) and all 
                                 
                                    b
                                    ∈
                                    
                                       B
                                       ˜
                                    
                                    
                                       (
                                       S
                                       ,
                                       i
                                       ,
                                       j
                                       )
                                    
                                 
                              . Together with non-negativity, this yields the lower bounds 
                                 
                                    
                                       f
                                       
                                          i
                                          j
                                       
                                    
                                    ≥
                                    d
                                    
                                       (
                                       
                                          B
                                          ˜
                                       
                                       
                                          (
                                          S
                                          ,
                                          i
                                          ,
                                          j
                                          )
                                       
                                       )
                                    
                                    
                                       x
                                       
                                          i
                                          j
                                       
                                    
                                 
                               for all (i, j) ∈ A(V∖S, S). For the other arcs in A, we have a trivial lower bound of zero.

Finally, we apply the Hoffman circulation theorem with di
                               defined as above for all i ∈ V, uij
                               set to Qxij
                               for all (i, j) ∈ A, and ℓ
                                 ij
                               set to 
                                 
                                    d
                                    
                                       (
                                       
                                          B
                                          ˜
                                       
                                       
                                          (
                                          S
                                          ,
                                          i
                                          ,
                                          j
                                          )
                                       
                                       )
                                    
                                    
                                       x
                                       
                                          i
                                          j
                                       
                                    
                                 
                               for all (i, j) ∈ A(V∖S, S), and zero for all other arcs. It yields the following inequality for the given set S:

                                 
                                    
                                       
                                          Q
                                          x
                                          
                                             (
                                             A
                                             
                                                (
                                                S
                                                ,
                                                V
                                                ∖
                                                S
                                                )
                                             
                                             )
                                          
                                          −
                                          d
                                          
                                             (
                                             
                                                B
                                                −
                                             
                                             
                                                (
                                                S
                                                ,
                                                V
                                                ∖
                                                S
                                                )
                                             
                                             )
                                          
                                          
                                          ≥
                                          
                                          
                                             ∑
                                             
                                                (
                                                i
                                                ,
                                                j
                                                )
                                                ∈
                                                A
                                                (
                                                V
                                                ∖
                                                S
                                                ,
                                                S
                                                )
                                             
                                          
                                          
                                             d
                                             (
                                          
                                          
                                             B
                                             ˜
                                          
                                          
                                             (
                                             S
                                             ,
                                             i
                                             ,
                                             j
                                             )
                                          
                                          
                                             x
                                             
                                                i
                                                j
                                             
                                          
                                          .
                                       
                                    
                                 
                              This is equivalent to (24).□

Now, recall that MCF2 was obtained from MCF1 by fixing some f variables to zero, using Lemma 2. The following lemma enables us to fix some additional f variables:

                           Lemma 5
                           
                              Suppose that (i, j) ∈ A and
                              
                                 
                                    
                                       (
                                       p
                                       ,
                                       q
                                       )
                                    
                                    ∈
                                    
                                       B
                                       −
                                    
                                 
                               
                              are incomparable, i.e., that neither i nor j belong to {p, q} ∪ π(p) ∪ π(q) ∪ σ(p) ∪ σ(q). Then we can fix
                              
                                 
                                    f
                                    
                                       i
                                       j
                                    
                                    
                                       p
                                       q
                                    
                                 
                               
                              to zero if any of the following three quantities exceeds Q:
                              
                                 
                                    •
                                    
                                       
                                          
                                             d
                                             
                                                (
                                                
                                                
                                                   B
                                                   −
                                                
                                                
                                                   (
                                                   V
                                                   ∖
                                                   
                                                      {
                                                      i
                                                      ,
                                                      j
                                                      }
                                                   
                                                   ,
                                                   
                                                      {
                                                      i
                                                      ,
                                                      j
                                                      }
                                                   
                                                   )
                                                
                                                
                                                )
                                             
                                             +
                                             
                                                d
                                                
                                                   p
                                                   q
                                                
                                             
                                          
                                       
                                    


                                       
                                          
                                             d
                                             
                                                (
                                                
                                                
                                                   B
                                                   −
                                                
                                                
                                                   (
                                                   
                                                      {
                                                      i
                                                      }
                                                   
                                                   ,
                                                   V
                                                   ∖
                                                   
                                                      {
                                                      i
                                                      }
                                                   
                                                   )
                                                
                                                ∪
                                                
                                                   B
                                                   −
                                                
                                                
                                                   (
                                                   V
                                                   ∖
                                                   
                                                      {
                                                      j
                                                      }
                                                   
                                                   ,
                                                   
                                                      {
                                                      j
                                                      }
                                                   
                                                   )
                                                
                                                
                                                )
                                             
                                             +
                                             
                                                d
                                                
                                                   p
                                                   q
                                                
                                             
                                          
                                       
                                    


                                       
                                          
                                             d
                                             
                                                (
                                                
                                                
                                                   B
                                                   −
                                                
                                                
                                                   (
                                                   
                                                      {
                                                      i
                                                      ,
                                                      j
                                                      }
                                                   
                                                   ,
                                                   V
                                                   ∖
                                                   
                                                      {
                                                      i
                                                      ,
                                                      j
                                                      }
                                                   
                                                   )
                                                
                                                )
                                             
                                             +
                                             
                                                d
                                                
                                                   p
                                                   q
                                                
                                             
                                          
                                       
                                       .
                                    

Suppose that 
                                 
                                    
                                       f
                                       
                                          i
                                          j
                                       
                                       
                                          p
                                          q
                                       
                                    
                                    =
                                    1
                                 
                              . Then the vehicle traverses the arc (i, j) while carrying the commodity (p, q). Suppose also that (i, j) and (p, q) are incomparable. Then the vehicle must also be carrying the commodity (p, q) when it arrives at i, and also when it departs from j. The three quantities mentioned are then lower bounds on the load of the vehicle when it arrives at i, traverses the arc (i, j), or departs from j, respectively.□

Using Lemmas 2 and 5 to eliminate f variables from MCF1C, and also tightening the bounds (23) by replacing them with (14) (again, with B replaced with 
                           
                              B
                              −
                           
                        ), we obtain what we call “MCF2C”. The projection of MCF2C satisfies slightly strengthened versions of the simple (π, σ), GSD, FCOM, FCD and multistar inequalities. We do not go into details, for the sake of brevity.

Finally, we let “MCF3C” be the formulation obtained by adding the PD equations (17) to MCF2C, and “MCF4C” be the one obtained by adding the IP equations (22) to MCF3C. We remark that Proposition 5 applies to MCF3C and MCF4C, provided that the weights db
                         are equal to zero for all commodities ending at node n. Similarly, Proposition 6 applies to MCF4C, provided that 
                           
                              
                                 d
                                 
                                    1
                                    i
                                 
                              
                              =
                              
                                 d
                                 
                                    i
                                    n
                                 
                              
                              =
                              0
                           
                         for all i ∈ F.

This section analyses the implications of using the new constraints introduced in this paper when solving the SOP and CSOP. We deal with the SOP in Section 6.1 and the CSOP in Section 6.2. All experiments were conducted on a Dell Precision T5400 desktop computer, with a 3.16GHz Intel Xeon X5460 processor, running Windows Vista Ultimate 64 bit. Our implementation was written in Microsoft Visual C, using IBM ILOG Cplex 12.6 both as LP solver and branch-and-cut framework. Although this framework has functions to active and deactivate the presolver and general-purpose cutting-plane inequalities, our preliminary experiments did not reveal any clear influence when changing the default parameter settings. For that reason, the results in this section were obtained using the default settings.

We used three kinds of SOP instances considered in Hernández-Pérez and Salazar-González (2009). In instances of the first kind, n points are randomly located in the square [500] × [500] and the cost ca
                         of each arc a corresponds to the Euclidean distance between the end nodes of a. In instances of the second kind, each cost ca
                         is a random number in [0,500]. Then, m commodities are randomly generated with source sb
                         and destination tb
                         such that 1 < sb
                         < tb
                         < n. If the addition of a commodity causes H to contain a directed cycle, then it is discarded and replaced by another. The resulting m genuine precedences are then placed into B (along with the 
                           
                              n
                              −
                              2
                           
                         dummy precedences leaving node 1 and the 
                           
                              n
                              −
                              2
                           
                         dummy precedences entering node n). The two kinds of instances are denoted by ‘EU’ and ‘RD’ in the tables. The instances of the third kind are available in the TSP-library with the names ‘esc11’, ‘esc12’, ‘br17.10’, ‘br17.12’ and ‘esc25’.

For 
                           
                              n
                              =
                              25
                           
                         and 
                           
                              m
                              =
                              10
                              ,
                              20
                              ,
                              30
                              ,
                              40
                              ,
                              50
                              ,
                              60
                              ,
                           
                         we created ten instances of the first and second kinds. Table 2
                         shows some average features of these instances. It also shows features of the five instances of the third kind. In particular, for each line, it displays:

                           
                              
                                 
                                    
                                       
                                          |
                                       
                                       
                                          B
                                          −
                                       
                                       
                                          |
                                       
                                    
                                 : the number of precedences in B after deleting the precedences inferred by transitivity,


                                 m′: the number of genuine precedences in 
                                    
                                       
                                          B
                                          −
                                       
                                       ,
                                    
                                 
                              

|F|: the number of “free” nodes as defined in Proposition 6,

|A|: the number of arcs remaining after the elimination procedure described at the end of Section 2.1,


                                 Numvar: the number of variables in MCF2.

To measure the impact of using the PD Eq. (17) and IP Eq. (22), we have considered five models. The first model is MCF1. The second model is MCF2, where the PD and the IP equations are not present. The third model is MCF3, with the PD equations dynamically separated. The fourth model, denoted by ‘MCF2+IP’, includes the IP equations instead of the PD equations. The fifth model includes both PD and IP equations, and is therefore MCF4.


                        Table 3
                        
                         shows results obtained when solving the LP relaxations of the five models. Each line shows the average features of the ten randomly generated instances of each kind and m. For each of the five models, we give ‘Gap’, the average percentage gap between the LP and IP values, and Time, the average CPU time in seconds. We see that MCF1 gives extremely poor lower bounds, and the bounds from MCF2 are rather poor as well, especially when m is small. The addition of either PD or IP equations improve the bounds substantially, though at the cost of longer solution times. Interestingly, PD equations seem to be more useful for EU instances, whereas IP equations seem to be more useful for RD instances. We do not have an explanation for this phenomenon. Finally, the addition of both PD and IP equations leads to quite tight bounds for both kinds of instances, although at the cost of rather long solution times.

Next, we explored the use of the formulations within a branch-and-bound context. Table 4 shows, for each type of instances, ‘time’, the average CPU time of the branch-and-bound search in seconds, and ‘BB’, the average number of nodes explored during the search. It does not report the value for MCF1, because most of the branch-and-bound searches required more than 1 hour on the random instances when MCF1 was used, which never happened when using the other models. The computational time to construct the models was negligible on our experiments. We see that the instances get easier as the number of precedences increases. This behaviour is explained because a large number of precedences helps to define the solution. The results also confirm that the models with the stronger LP relaxations typically use fewer branch-and-bound nodes, but this does not always pay off in terms of overall solution time. In fact, there does not appear to be any clear winner in terms of overall solution time.

Our CSOP instances are based on the instances “esc11”, “esc12”, “br17.10”, “br17.12” and “esc25”, with db
                         being random integers in [1,5] as considered in Hernández-Pérez and Salazar-González (2009). We analyse the performance of the algorithm based on MCF4C with several values of Q. We decided to use specific instances rather than random instances (as for the uncapacitated case) because infeasible CSOP instances frequently appeared when reducing Q on randomly generated instances. Using specific instances instead makes it easier to analyse the impact of reducing Q.


                        Table 5
                         shows the results of applying MCF4C to the capacitated instances. Each line refers to the CSOP instance determined by its capacity Q. The instances with larger capacity than the reported one correspond to the uncapacitated case (i.e. SOP). The instances with smaller capacity than the reported one are infeasible. As done on the uncapacitated SOP instances, and based on preliminary computational experiments, we decided to manage the PD Eq. (17) dynamically and the IP Eq. (22) statically. This means that each node of the branch-and-bound search is a cutting-plane procedure that iteratively separates the PD equations as described in Proposition 2, and the whole algorithm is a branch-and-cut procedure. The column headings in Table 5 represent:

                           
                              
                                 LB
                                 0: LP value before starting the first cutting-plane iteration (which coincides with the LP value of MCF2C+IP),


                                 LB
                                 1: LP value before performing the first branching procedure (i.e. the LP value of MCF4C),


                                 Opt: value of the optimal solution when the branch-and-bound search has concluded,


                                 Numvar: number of variables in the model (including both x and f variables),


                                 IPs: number of IP Eq. (22) in the model,


                                 PDs: number of PD Eq. (17) generated by the algorithm,


                                 iPD: number of iterations of the cutting-plane procedure generating violated PD equations,


                                 time: CPU time to complete the branch-and-bound search,


                                 BB: number of branch-and-bound nodes where the branching procedure was applied,


                                 q: maximal demand over all the arcs in the optimal solution.

The values LB
                        0 and LB
                        1 may be influenced by the CPLEX presolver and the CPLEX general-purpose cutting-plane inequalities, but this influence was negligible on our computational experiments. The results are obtained using the default CPLEX setting.

The table confirms that considering the capacity constraint in the problem makes it harder to solve. However there is not a linear correlation between the CPU time increment and the capacity decrement when fixing the other features of the instance. Observing the behaviour of the algorithm on instances with the same optimal solution, the instances with smallest Q are the easiest to solve. Indeed, on these instances with smallest Q, the LP values LB
                        0 and LB
                        1 are the highest, and the BB and time numbers are the smallest. This is explained by the fact that inequalities (23) and (24) are stronger when Q is smaller.

@&#CONCLUSION@&#

This paper has introduced new multi-commodity flow formulations to solve the sequential ordering problem and its capacitated variant. The new formulations have stronger LP relaxations when compared to other formulations in the literature, at the cost of having flow variables related to dummy precedences. The paper introduced two families of valid equations, and gave theoretical results concerned with both separation and projection. Finally, the paper described the implementation of a branch-and-cut algorithm to solve uncapacitated and capacitated instances. Although our implementation was not able to solve to optimality any unsolved instance in the SOP literature, it confirmed that the new models produce good lower bounds in practice.

Future research could be devoted to completely characterising the projections of MCF3 and MCF4, or at least characterising the projection of MCF4 in the special case of the Asymmetric TSP. Another line of research could be into the use of decomposition techniques, such as Dantzig-Wolfe or Benders decomposition, to solve the LP relaxations of our formulations more efficiently. Finally, one could explore the possibility of “hybrid” formulations, which use our multi-commodity flow variables in combination with other kinds of variables, such as the ones used by Gouveia and Pesneau (2006), Gouveia and Ruthmair (2015).

@&#REFERENCES@&#

