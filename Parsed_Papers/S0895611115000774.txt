@&#MAIN-TITLE@&#Sparse Non-negative Matrix Factorization (SNMF) based color unmixing for breast histopathological image analysis

@&#HIGHLIGHTS@&#


               
                  
                  
                     
                        
                           
                           SNMF uses more meaningful representation of color components for separating stained colors.


                        
                        
                           
                           Color unmixing is driven by the specific data information of each individual image.


                        
                        
                           
                           SNMF efficiently decomposes brown DAB component from IHC images.


                        
                        
                           
                           Served as a pre-processing step for accurately segmenting nuclei and lymphocytes from H & E images.


                        
                        
                           
                           SNMF shows improved performance than compared approaches.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Color unmixing

Breast histology

Immunohistochemistry image

Hematoxylin and Eosin image

@&#ABSTRACT@&#


               
               
                  Color deconvolution has emerged as a popular method for color unmixing as a pre-processing step for image analysis of digital pathology images. One deficiency of this approach is that the stain matrix is pre-defined which requires specific knowledge of the data. This paper presents an unsupervised Sparse Non-negative Matrix Factorization (SNMF) based approach for color unmixing. We evaluate this approach for color unmixing of breast pathology images. Compared to Non-negative Matrix Factorization (NMF), the sparseness constraint imposed on coefficient matrix aims to use more meaningful representation of color components for separating stained colors. In this work SNMF is leveraged for decomposing pure stained color in both Immunohistochemistry (IHC) and Hematoxylin and Eosin (H&E) images. SNMF is compared with Principle Component Analysis (PCA), Independent Component Analysis (ICA), Color Deconvolution (CD), and Non-negative Matrix Factorization (NMF) based approaches. SNMF demonstrated improved performance in decomposing brown diaminobenzidine (DAB) component from 36 IHC images as well as accurately segmenting about 1400 nuclei and 500 lymphocytes from H & E images.
               
            

@&#INTRODUCTION@&#

In clinical practice, pathologists visually examine tissue samples under a microscope for the purpose of diagnosing the presence of disease. Different colour stains are usually used to indicate the presence of different proteins. Hematoxylin and Eosin (H&E) are standard stains that highlight nuclei in blue/purple and cytoplasm in pink in order to visualize the structure of interest in the tissue [28]. Hematoxylin (H) dye can stain all nuclei in the H&E histopathological images. Therefore, in order to detect or segment all the nuclei, one popular idea (such as blue ratio algorithm [7]) is to detect H stains or blue color in the image. Immunohistochemistry (IHC) is yet another type of tissues staining that attempts to capture the expression levels associated with specific proteins. For instance, CD31, CD34, and CD105 expressions are found on vascular channels and some specific cell types (e.g. expression of CD34 on myofibroblasts) in human breast tumor tissue sections. As they are indicators of angiogenesis, the immunostaining of these proteins can be used to evaluate the degree of tumor angiogenesis in histological tissue sections [3,5,8,22]. In clinical practice, the malignancy grading of the tumor and angiogenic activity are largely based on the intensity, architectural, and vascular density features of brown diaminobenzidine (DAB) in IHC stained breast tissue [2]. Therefore, quantitative analysis on DAB compound is the pre-requisite to evaluate the tumor growth and metastasis in breast tissue [17].

However, the IHC, H, E stains unfortunately overlap considerably which makes the problem of stain quantification within specific histologic primitives (e.g. nuclei, gland) challenging. Fig. 1
                     (a) is an image of a breast tumor tissue section stained with CD31 antibody and hematoxylin counterstain. Stain or color separation in histology images could aid in automated detection of specific histologic structures such as nuclei and lymphocytes. A few approaches have been recently proposed to address this problem. Color Deconvolution (CD) is one such effective approach presented in [25] for unmixing pure stain colors. In [25], CD algorithm was employed for color unmixing of IHC stained histological images. Similarly, CD was employed for separating DAB and H stains from IHC stained histological images in [2]. Then H and DAB components are further used for constructing vascular density and graph features, respectively. In [4,21,27], CD was used for H & E stained image analysis. The unmixed H stain component with CD was further used for nuclei detection and segmentation. Nuclear morphology is an important phenotypic feature for grading of disease aggressiveness. For instance, the modified Bloom Richardson (mBR) grading system for breast cancers is highly correlated with nuclei morphology. The alterations in nuclei size, shape, and topological information are important signatures for disease diagnosis and prognosis [35–37]. Recently a number of nuclear segmentation approaches have been proposed [1,4,7,12,21,23,26,27]. CD was employed in [4,21,26,27] as a pre-processing step for nuclei detection/segmentation. The unmixed H stain component was leveraged to detect the nuclei boundaries in [27]. Then nuclear morphological features are extracted to predict prognosis of male breast cancers. Similarly, in [4] cancer nuclei was detected based on the unmixed H stain component. Then graph features and texture features were subsequently extracted for quantifying the mBR grade in ER+ breast cancers. In [21], the unmixed H stain component was leveraged to identify different types of nuclei. In [26,27], color unmixing and mathematical morphology operators were integrated with radial symmetry-based image transformation for nuclei detection. The watershed method was subsequently employed for nuclei segmentation. In [7], the blue ratio and multi-reference graph framework were employed for nuclei segmentation from H & E stained Glioblastroma Multiforme images. In [1], a hybrid active contour model developed on color intensities of RGB space was studied for nuclei segmentation in H & E stained breast histopathological images.

Before color unmixing, the CD approach usually transforms the H & E stained images into Optical Density (OD) images based on the Beer–Lambert Law [16]. The CD operation is subsequently applied to separate different color components by multiplication of OD image with the inverse of the color matrix. This stain matrix was defined by the measurement of relative absorbtion for red, green and blue components associated with each stain used in the tissue. One disadvantage of this approach is that the color matrix is pre-defined and therefore limits its applicability to other image modalities. Moreover, the CD method requires accurate estimation of the stain matrix [19].

Principle Component Analysis (PCA) [18] and independent Component Analysis (ICA) [15] are two popular unsupervised approaches that have been broadly used for representation learning [6]. Non-negative matrix Factorization (NMF) is the other important approach which decomposes a non-negative matrix into two low-rank non-negative matrices for finding a linear representation of non-negative data. In [24], an unsupervised spectral decomposition with Non-negative Matrix Factorization (NMF) algorithm was presented for color unmixing on IHC images of human biopsy tissue. In [13], a blind color decomposition method was presented for color unmixing of histopathological images. Sparse representation is usually incorporated for improving the efficiency of decomposition. Sparsity methods have been widely investigated and applied for medical image analysis, such as in [9–11,14,29–34,38].

In this paper, we present a sparse NMF (SNMF) approach for color unmixing on histological images of the breast. The sparse representation of histological images aims to represent the image using fewer “active” components for better interpreting the staining of different components. The SNMF algorithm begins by transforming an intensity image in RGB space into the Optical Density (OD) image via the Beer–Lambert Law. Then the OD image is decomposed into a basis and a coefficient matrices, respectively. Multiplication of individual components of the basis matrix and coefficient matrix produces the OD image for each corresponding component. Finally, the intensity images of each component are represented in RGB space from the corresponding OD image. The post-processing operation is conducted on the intensity image of the resulting component. For instance, for H & E images, the unmixed H components can be leveraged for further segmenting nuclei/lympocytes. To show the effectiveness of proposed approach in color unmixing, we qualitatively and quantitatively evaluate the SNMF against PCA, ICA, CD, and NMF on three data sets which includes 36 CD 31, CD34, and CD105 IHC and H & E stained histopathological images, 200 H & E lymph node-negative and estrogen receptor-positive (LN-, ER+) breast cancer images, and 100 human epidermal growth factor receptor-2 (HER2+) breast cancer images, respectively. SNMF is compared with other approaches in terms of decomposing brown diaminobenzidine (DAB) component from IHC images as well as accurately segmenting nuclei/lymphocytes from H & E images.

The rest of paper is organized as follows: A detailed description of Sparse Non-negative Matrix Factorization (SNMF) for color unmixing is presented in Section 2. The experimental setup and comparative strategies are discussed in Section 3. The experiment results and discussions are reported in Section 4. Concluding remarks are presented in Section 5.

@&#METHODS@&#

It is assumed that the stained images are light absorbing and the relationship between the stain and its absorption satisfy the Beer–Lambert Law [16]. Let ζ be different color channels in RGB space, i.e. ζ
                        ∈{R, G, B}. Each D
                        
                           ζ
                         is the corresponding OD vector of different color channels. According to Beer–Lambert Law, D
                        
                           ζ
                         of each color channel ζ for pixel p is expressed in terms of an absorbance which is defined as


                        
                           
                              (1)
                              
                                 
                                    D
                                    ζ
                                 
                                 (
                                 p
                                 )
                                 =
                                 −
                                 ln
                                 
                                    
                                       
                                          
                                             
                                                
                                                   I
                                                   ζ
                                                
                                                (
                                                p
                                                )
                                             
                                             
                                                
                                                   I
                                                   0
                                                
                                                (
                                                p
                                                )
                                             
                                          
                                       
                                    
                                 
                                 =
                                 ɛ
                                 ×
                                 ℓ
                                 ×
                                 η
                                 .
                              
                           
                        where ɛ, ℓ, and η represent respectively an absorptivity of the attenuator of the specimen, the distance the light travels through the specimen, and the concentration of staining in the specimen. I
                        0 is the intensity of light entering the specimen and I
                        
                           ζ
                         is the intensity of light detected in channel ζ after absorption as I
                        0 passes the specimen.

From Eq. (1), it is easy to see that the intensities I
                        
                           ζ
                        
                        ∈{I
                        
                           R
                        , I
                        
                           G
                        , I
                        
                           B
                        } nonlinearly depend on the staining concentration η. Thus, these intensity values of RGB image cannot directly be used for decomposition of each of stains. However, by applying Beer–Lambert Law in (1), the corresponding optical density D
                        
                           ζ
                         for each channel is linear with η. Therefore, before employing SNMF for decomposition, the original RGB intensity image is transformed to corresponding vectors D
                        
                           ζ
                        .

Based on color deconvolution method [25], the relationship between the amount of each stain


                        
                           
                              
                                 φ
                                 (
                                 p
                                 )
                                 =
                                 
                                    
                                       
                                          
                                             
                                                φ
                                                R
                                             
                                             (
                                             p
                                             )
                                             ,
                                             
                                                φ
                                                G
                                             
                                             (
                                             p
                                             )
                                             ,
                                             
                                                φ
                                                B
                                             
                                             (
                                             p
                                             )
                                          
                                       
                                    
                                    T
                                 
                              
                           
                        and OD


                        
                           
                              
                                 D
                                 (
                                 p
                                 )
                                 =
                                 
                                    
                                       
                                          
                                             
                                                D
                                                R
                                             
                                             (
                                             p
                                             )
                                             ,
                                             
                                                D
                                                G
                                             
                                             (
                                             p
                                             )
                                             ,
                                             
                                                D
                                                B
                                             
                                             (
                                             p
                                             )
                                          
                                       
                                    
                                    T
                                 
                              
                           
                        to pixel p can be expressed as


                        
                           
                              (2)
                              
                                 D
                                 (
                                 p
                                 )
                                 =
                                 S
                                 φ
                                 (
                                 p
                                 )
                                 .
                              
                           
                        where


                        
                           
                              (3)
                              
                                 S
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      s
                                                      
                                                         R
                                                         ,
                                                         1
                                                      
                                                   
                                                
                                                
                                                   
                                                      s
                                                      
                                                         G
                                                         ,
                                                         1
                                                      
                                                   
                                                
                                                
                                                   
                                                      s
                                                      
                                                         B
                                                         ,
                                                         1
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      s
                                                      
                                                         R
                                                         ,
                                                         2
                                                      
                                                   
                                                
                                                
                                                   
                                                      s
                                                      
                                                         G
                                                         ,
                                                         2
                                                      
                                                   
                                                
                                                
                                                   
                                                      s
                                                      
                                                         B
                                                         ,
                                                         2
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      s
                                                      
                                                         R
                                                         ,
                                                         3
                                                      
                                                   
                                                
                                                
                                                   
                                                      s
                                                      
                                                         G
                                                         ,
                                                         3
                                                      
                                                   
                                                
                                                
                                                   
                                                      s
                                                      
                                                         B
                                                         ,
                                                         3
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        is the staining matrix that defines the association between OD and the amount of each stain on pixel p. Each row in S corresponds to each staining channel.

For all pixels in the image, we can rewrite (2) as a data matrix


                        
                           
                              (4)
                              
                                 D
                                 =
                                 S
                                 ϕ
                                 ,
                              
                           
                        where


                        
                           
                              (5)
                              
                                 D
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      D
                                                      R
                                                   
                                                   (
                                                   1
                                                   )
                                                
                                                
                                                   
                                                      D
                                                      R
                                                   
                                                   (
                                                   2
                                                   )
                                                
                                                
                                                   …
                                                
                                                
                                                   
                                                      D
                                                      R
                                                   
                                                   (
                                                   n
                                                   )
                                                
                                             
                                             
                                                
                                                   
                                                      D
                                                      G
                                                   
                                                   (
                                                   1
                                                   )
                                                
                                                
                                                   
                                                      D
                                                      G
                                                   
                                                   (
                                                   2
                                                   )
                                                
                                                
                                                   …
                                                
                                                
                                                   
                                                      D
                                                      G
                                                   
                                                   (
                                                   n
                                                   )
                                                
                                             
                                             
                                                
                                                   
                                                      D
                                                      B
                                                   
                                                   (
                                                   1
                                                   )
                                                
                                                
                                                   
                                                      D
                                                      B
                                                   
                                                   (
                                                   2
                                                   )
                                                
                                                
                                                   …
                                                
                                                
                                                   
                                                      D
                                                      B
                                                   
                                                   (
                                                   n
                                                   )
                                                
                                             
                                             
                                                
                                                
                                                
                                                
                                             
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                        and


                        
                           
                              (6)
                              
                                 ϕ
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      φ
                                                      R
                                                   
                                                   (
                                                   1
                                                   )
                                                
                                                
                                                   
                                                      φ
                                                      R
                                                   
                                                   (
                                                   2
                                                   )
                                                
                                                
                                                   …
                                                
                                                
                                                   
                                                      φ
                                                      R
                                                   
                                                   (
                                                   n
                                                   )
                                                
                                             
                                             
                                                
                                                   
                                                      φ
                                                      G
                                                   
                                                   (
                                                   1
                                                   )
                                                
                                                
                                                   
                                                      φ
                                                      G
                                                   
                                                   (
                                                   2
                                                   )
                                                
                                                
                                                   …
                                                
                                                
                                                   
                                                      φ
                                                      G
                                                   
                                                   (
                                                   n
                                                   )
                                                
                                             
                                             
                                                
                                                   
                                                      φ
                                                      B
                                                   
                                                   (
                                                   1
                                                   )
                                                
                                                
                                                   
                                                      φ
                                                      B
                                                   
                                                   (
                                                   2
                                                   )
                                                
                                                
                                                   …
                                                
                                                
                                                   
                                                      φ
                                                      B
                                                   
                                                   (
                                                   n
                                                   )
                                                
                                             
                                             
                                                
                                                
                                                
                                                
                                             
                                          
                                       
                                    
                                 
                                 .
                              
                           
                        The amount of stain ϕ can be obtained by solving the closed-form solution of (4).

However, although the amount of stain can be obtained with the method presented in [25], the CD framework requires that the stain matrix S in (4) is estimated in a way that is specific to the particular dataset. Once this matrix is estimated, it will be fixed and leveraged for all subsequent images. It is obvious that this approach has limitations. Aside from the fact that the estimated stain matrix S will be particular to the dataset under consideration, S might not be optimal for all images in the dataset.

It is easy to prove that the data matrix D in (5) is a non-negative matrix. SNMF aims to decompose a non-negative matrix into a basis matrix and a coefficient matrix. In general, PCA, ICA, and NMF/SNMF can all be seen as matrix factorization approaches, with different choices of objective function and/or constraints. Given a non-negative matrix D
                        ∈
                        R
                        
                           d×n
                        , where n is the number of data points (or pixels in the image) and d is dimension of each data point, it is easy to see that the desired rank of matrix D is k
                        ≤min{d, n}. The SNMF algorithm decomposes D into two non-negative matric B
                        ∈
                        R
                        
                           d×k
                         and X
                        ∈
                        R
                        
                           k×n
                         so that


                        
                           
                              (7)
                              
                                 D
                                 ≈
                                 B
                                 ×
                                 X
                                 .
                              
                           
                        
                     

The solution of (7) can be obtained by solving the following optimization problem:
                           
                              (8)
                              
                                 
                                    
                                       
                                          
                                             min
                                             
                                                B
                                                ,
                                                X
                                             
                                          
                                          
                                             1
                                             2
                                          
                                          ∥
                                          D
                                          −
                                          BX
                                          
                                             ∥
                                             F
                                             2
                                          
                                          ,
                                       
                                    
                                    
                                       
                                          s
                                          .
                                          t
                                          .
                                          
                                          
                                          B
                                          ,
                                          X
                                          ≥
                                          0
                                          ,
                                       
                                    
                                 
                              
                           
                        where B and X represent basis matrix and coefficient matrix, respectively. In order to avoid the issue of scale-variance and non-unique solutions, the standard NMF algorithm (8) can be extended to Sparse NMF (SNMF) algorithm [20] by adding a regularization term and a sparsity term as follows:
                           
                              (9)
                              
                                 
                                    
                                       
                                          
                                             min
                                             
                                                B
                                                ,
                                                X
                                             
                                          
                                          
                                             1
                                             2
                                          
                                          ∥
                                          D
                                          −
                                          BX
                                          
                                             ∥
                                             F
                                             2
                                          
                                          +
                                          
                                             
                                                
                                                   α
                                                   1
                                                
                                             
                                             2
                                          
                                          ∥
                                          B
                                          
                                             ∥
                                             F
                                             2
                                          
                                          +
                                          
                                             
                                                
                                                   α
                                                   2
                                                
                                             
                                             2
                                          
                                          ∥
                                          X
                                          
                                             ∥
                                             F
                                             2
                                          
                                          +
                                          
                                             β
                                             2
                                          
                                          
                                             ∑
                                             
                                                i
                                                =
                                                1
                                             
                                             n
                                          
                                          ∥
                                          X
                                          (
                                          :
                                          ,
                                          i
                                          )
                                          
                                             ∥
                                             1
                                             2
                                          
                                       
                                       
                                    
                                    
                                       
                                          s
                                          .
                                          t
                                          .
                                          
                                          
                                          B
                                          ,
                                          X
                                          ≥
                                          0
                                       
                                       
                                    
                                 
                              
                           
                        where α
                        1, α
                        2, and β are positive constants. The second and third terms represent the “smoothness” constraint which aims to penalize large values of the elements in basis and coefficient matrices. The fourth term of (9), the sparseness constraint is imposed on coefficient matrix by utilizing L
                        1 norm minimization. The sparseness constraint in Eq. (9) imposed on coefficient matrix aims to use desired dimensional of color space to better represent different components for more meaningful representation. The smoothness constraint imposed on both basis and coefficient matrices aims to smooth the image and remove white noises. The effectiveness of “smoothness” and “sparseness” constraints in (9) on color unmixing are analyzed in Section 3.


                        Fig. 1 shows the application of SNMF for color unmixing on an IHC image. Fig. 1(a) represents the original CD31 IHC stained histological images of breast tissue. In Fig. 1, the decomposition of immunostaining from original image (Fig. 1(a)) is important for quantifying the brown regions, representing microvessels. By applying SNMF algorithm, the image is decomposed into antibody CD31 stained component (see Fig. 1(b)) and H stained component (see Fig. 1(c)).

Next, we use an H&E stained image as an example to show the principle of SNMF for color unmixing (see Fig. 2
                        ). In Fig. 2, each channel of original RGB image is decomposed into the constituent components and expressed as 
                           I
                           =
                           [
                           
                              I
                              R
                              T
                           
                           ;
                           
                              I
                              G
                              T
                           
                           ;
                           
                              I
                              B
                              T
                           
                           ]
                        . By applying Beer–Lambert Law in Eq. (1), intensity image I can be represented by OD image D in RGB space as 
                           D
                           =
                           [
                           
                              D
                              R
                              T
                           
                           ;
                           
                              D
                              G
                              T
                           
                           ;
                           
                              D
                              B
                              T
                           
                           ]
                        . Here we use D and D
                        
                           ζ
                         to represent OD matrix and a row vector of D, respectively. D is subsequently decomposed into a d
                        ×
                        k basis matrix B and a k
                        ×
                        n coefficient matrix X based on Eqs. (7)–(9). Note that for two stained images (H & E), k
                        =2 and for CD31 IHC and H & E images, k
                        =3.

The OD image of H component is constructed by multiplying the first column B(:, 1) of basis matrix B and the first row X(1, :) of coefficient matrix X. Similarly, the E component can be reconstructed by the second column B(:, 2) of basis matrix B and the second row X(2, :). Then the intensity image of the H and E components are represented in RGB space from corresponding OD images by applying Beer–Lambert Law in Eq. (1). The reconstructed intensity images (H and E components) in RGB space are shown in Fig. 3
                        .

After SNMF decomposition and reconstruction, the H and E components are expected to be discriminable and the reconstructed H component better represents the nuclei. Fig. 4
                         shows the procedure of nuclear segmentation with the SNMF based approach. The segmentation procedure involves separating the H component from the E component via the SNMF based approach. Subsequently the intensity image of the reconstructed H component is transformed on to a binary image. Morphological operations are subsequently employed for separating connected nuclei and nuclear contour were extracted.

To show the effectiveness of our new approach, we compare SNMF with PCA [18], ICA [15], CD[25], and NMF [24] in color unmixing of the following three data sets in Table 1
                     .

The aim of this experiment was to analyze the effects of smoothness and sparseness constraints in Eq. (9) on color unmixing of histopathological images with the SNMF algorithm. The experiments are conducted on the IHC images from D1 for decomposing the brown DAB component.

For D1, since there is no ground truth for what constitutes an ideal “color unmixing” results, we only provide a qualitative comparison of SNMF and PCA, ICA, CD, and NMF in separating DAB components from original IHC and H & E stained images. For D2 and D3 we implicitly compare the “color unmixing” results obtained via SNMF and PCA, ICA, CD, and NMF in terms of the ability of segmentation in conjunction with the correpsonding unmixed color representations to detect and segment nuclei and lymphocytes. The resultant intensity image of the H component in the RGB space is transformed into a gray scale image and then finally into a binary image. Finally, mathematical morphologic operations are employed for separating the connected nuclei and extracting the nuclear contours. Fig. 4 illustrates the procedure of SNMF based nuclei/lymphocytes segmentation on H & E stained images.

@&#PERFORMANCE EVALUATION@&#

The quantitative performance of SNMF and PCA, ICA, CD, and NMF for segmentation accuracy of nuclei/lymphocyte regions are analyzed by using region-based measures:
                           
                              (10)
                              
                                 
                                    Dice
                                       
                                    coefficient
                                       
                                    (
                                    DICE
                                    )
                                 
                                 =
                                 
                                    
                                       2
                                       ×
                                       |
                                       A
                                       (
                                       S
                                       )
                                       ∩
                                       A
                                       (
                                       G
                                       )
                                       |
                                    
                                    
                                       |
                                       A
                                       (
                                       S
                                       )
                                       |
                                       +
                                       |
                                       A
                                       (
                                       G
                                       )
                                       |
                                    
                                 
                                 ,
                              
                           
                        
                        
                           
                              (11)
                              
                                 
                                    Overlap
                                       
                                    (
                                    OL
                                    )
                                 
                                 =
                                 
                                    
                                       |
                                       A
                                       (
                                       S
                                       )
                                       ∩
                                       A
                                       (
                                       G
                                       )
                                       |
                                    
                                    
                                       |
                                       A
                                       (
                                       S
                                       )
                                       ∪
                                       A
                                       (
                                       G
                                       )
                                       |
                                    
                                 
                                 ,
                              
                           
                        
                        
                           
                              (12)
                              
                                 
                                    Sensitivity
                                    (
                                    SN
                                    )
                                 
                                 =
                                 
                                    
                                       |
                                       A
                                       (
                                       S
                                       )
                                       ∩
                                       A
                                       (
                                       G
                                       )
                                       |
                                    
                                    
                                       |
                                       A
                                       (
                                       G
                                       )
                                       |
                                    
                                 
                                 ,
                              
                           
                        
                        
                           
                              (13)
                              
                                 
                                    Specificity
                                       
                                    (
                                    SP
                                    )
                                 
                                 =
                                 
                                    
                                       |
                                       C
                                       −
                                       A
                                       (
                                       S
                                       )
                                       ∩
                                       A
                                       (
                                       G
                                       )
                                       |
                                    
                                    
                                       |
                                       C
                                       −
                                       A
                                       (
                                       G
                                       )
                                       |
                                    
                                 
                                 ,
                              
                           
                        
                        
                           
                              (14)
                              
                                 
                                    Positive
                                       
                                    predictive
                                       
                                    value
                                       
                                    (
                                    PPV
                                    )
                                 
                                 =
                                 
                                    
                                       |
                                       A
                                       (
                                       S
                                       )
                                       ∩
                                       A
                                       (
                                       G
                                       )
                                       |
                                    
                                    
                                       |
                                       A
                                       (
                                       S
                                       )
                                       |
                                    
                                 
                                 .
                              
                           
                        Here C is the total number of pixels in the image or region of interest (ROI) and |s| represents the cardinality of any set s. 
                           A
                           (
                           S
                           )
                         and 
                           A
                           (
                           G
                           )
                         is the area of the segmentation results by automated and manual segmentation, respectively. The values shown in the Table 2
                         are average of Dice, OL, SN, SP, and PPV on nulcei/lymphocytes segmentation of all images in D2 and D3 with respect to manual segmentation.

The effect of the sparseness term in (9) on color unmixing of IHC images in D1 are illustrated in Fig. 5
                        . The first and second rows of Fig. 5 show the decomposed DAB and H components as the weight β for the sparseness term changes. When β
                        =0, as in Fig. 5 (a), the DAB component is not well separated within the original image (see Fig. 7
                        (a)). When the sparseness term is included, pure stains of DAB and H components are more easily separable (see Fig. 5 (b–d) and (f–h)). Also, we can see that as the value of β increases, the noisy background of the DAB components are removed and the pure color of nuclei component are enhanced because of the effect of sparsity.

The effects of the smoothness term in (9) on color unmixing are illustrated in Fig. 6
                        . The images in the first and second rows of the figure show the corresponding decomposed DAB and H components as the weights α
                        1 and α
                        2 of the smoothness term changes. When the smoothness is ignored (α
                        1
                        =
                        α
                        2
                        =0), and as the images and the corresponding magnified regions in Fig. 6 (a) and (b) show, the decomposed components are noisy. However, when the smoothness terms are restored (α
                        1
                        =
                        α
                        2
                        =2.5), the resultant images (see Fig. 6 (c) and (d)) are smoothed and the most of the noise eliminated.

The comparison of SNMF and PCA, ICA, CD, and NMF in separating the DAB component from the original IHC images with different stains are shown in Fig. 7. The first row in Fig. 7 represent the original IHC CD31, CD34, and CD105 stained images. The decomposed DAB components obtained respectively via PCA, ICA, CD, NMF, and SNMF are shown in the 2nd to 6th rows in Fig. 7. The results demonstrate the superiority of SNMF over PCA, ICA, CD, and NMF in separating the DAB component.

The nuclei/lymphocytes segmentation on one image from D2 (Fig. 8
                         (a)) and D3 (Fig. 8 (b)) using the different color unmixing strategies are shown in Fig. 8. The 1st and 3rd rows correspond to the H component identified via the 5 different color unmixing strategies. The 2nd and 4th rows correspond to the segmentation results based on the unmixed H component obtained from an H & E stained image. SNMF was able to achieve more accurate segmentation compared to PCA, ICA, CD, and NMF.

The results in Fig. 8 further illustrate the importance of accurate color unmixing for nuclear and lymphocyte segmentation. As it may be evidenced by Fig. 8 (h–l) and (r–v) the less accurate color unmixing obtained via PCA, ICA, CD, and NMF results in correspondingly worse nuclear segmentations compared to our SNMF based approach (Fig. 8 (l,v)).

The quantitative evaluations of different approaches are conducted on manually annotated 1400 nuclei and 500 lymphocytes across all images in D2 and D3, respectively. The quantitative evaluation results on nuclei/lymphocyte segmentation of SNMF and comparison approaches are shown in Table 2. SNMF showed better segmentation accuracy in terms of Dice and PPV on D2 as well as Dice and OL on D3.

This paper presents a Sparse Non-negative Matrix Factorization (SNMF) for color unmixing on breast histology. One of major objectives for color unmixing is nuclei segmentation. As we show in Fig. 4, for quantitative evaluation on the performance of color unmixing by different approaches, the separated H component is leveraged for further segmenting the nuclei. The qualitative and quantitative evaluation on separating brown diaminobenzidine (DAB) component on immunohistochemical images and automated segmentation of nuclei and lymphocytes on H & E images suggest that SNMF can better separate individual stain components for histological images as compared with Principle Component Analysis, independent Component Analysis, Color Deconvolution, and Non-negative Matrix Factorization based approaches.

There are some limitations in this work. One limitation is that we cannot quantitatively evaluate the effectiveness of color unmixing by SNMF against other approaches because of lacking ground truth. We alternatively choose to evaluate the segmentation accuracy for different approaches. In this application, color unmixing can be considered as a pre-processing step for nuclei/lympocyte segmentation. Any advanced color-based nuclei segmentation methods can be used upon the unmixing results in post-processing step. Therefore, the accuracy of nuclei/lymphoctyes segmentation by different approaches would dependent on the performance of both color unmixing for better separation of pure color of H component and subsequent segmentation module. This is the limitation of this evaluation strategy. Finally, the SNMF algorithm in the paper is only conducted on small region of interests from whole slide images. In the future work, we will apply SNMF algorithm for color unmixing problem in whole slide images.

@&#ACKNOWLEDGEMENTS@&#

We would like to thank Amy Ziober and her team at the Test Development Service Center in the Department of Pathology and Laboratory Medicine, University of Pennsylvania, for their work on CD31, CD34 and CD105 staining. Research reported in this publication was supported by National Natural Science Foundation of China (No. 61273259); Six Major Talents Summit of Jiangsu Province (No. 2013-XXRJ-019), and Natural Science Foundation of Jiangsu Province of China (No. BK20141482); the National Cancer Institute of the National Institutes of Health under award numbers (R01CA136535-01, R01CA140772-01, R21CA167811-01, R21CA179327-01, R21CA195152-01); the National Institute of Diabetes and Digestive and Kidney Diseases under award number R01DK098503-02; the DOD Prostate Cancer Synergistic Idea Development Award (PC120857); the DOD Lung Cancer Idea Development New Investigator Award (LC130463); the DOD Prostate Cancer Idea Development Award; the Ohio Third Frontier Technology development Grant; the CTSC Coulter Annual Pilot Grant; the Case Comprehensive Cancer Center Pilot Grant VelaSano Grant from the Cleveland Clinic; the Wallace H. Coulter Foundation Program in the Department of Biomedical Engineering at Case Western Reserve University.

The content is solely the responsibility of the authors and does not necessarily represent the official views of the National Institutes of Health.

@&#REFERENCES@&#

