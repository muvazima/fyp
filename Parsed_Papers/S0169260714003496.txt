@&#MAIN-TITLE@&#Virtual colon flattening method based on colonic outer surface

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           We do virtual colon flattening based on colonic outer surface.


                        
                        
                           
                           We conduct both of quantitative and visual evaluations to the results.


                        
                        
                           
                           Using colonic outer surface can improve the outcome of virtual colon flattening.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Virtual colon flattening

Colonic outer surface

Deformable distortion correction

@&#ABSTRACT@&#


               
               
                  Virtual colon flattening (VF) is a minimally invasive viewing mode used to detect colorectal polyps on the colonic inner surface in virtual colonoscopy. Compared with conventional colonoscopy, inspecting a flattened colonic inner surface is faster and results in fewer uninspected regions. Unfortunately, the deformation distortions of flattened colonic inner surface impede the performance of VF. Conventionally, the deformation distortions can be corrected by using the colonic inner surface. However, colonic curvatures and haustral folds make correcting deformation distortions using only the colonic inner surface difficult. Therefore, we propose a VF method that is based on the colonic outer surface. The proposed method includes two novel algorithms, namely, the colonic outer surface extraction algorithm and the colonic outer surface-based distortion correction algorithm. Sixty scans involving 77 annotated polyps were used for the validation. The flattened colons were independently inspected by three operators and then compared with three existing VF methods. The correct detection rates of the proposed method and the three existing methods were 79.6%, 67.1%, 71.9%, and 72.7%, respectively, and the false positives per scan were 0.16, 0.32, 0.21, and 0.26, respectively. The experimental results demonstrate that our proposed method has better performance than existing methods that are based on the colonic inner surface.
               
            

@&#INTRODUCTION@&#

Colorectal cancer is the second leading contributor to cancer-related deaths in developed countries [1]. A colorectal polyp grows into a cancerous tumor in a few years. Early detection and successful resection of precursor polyps are effective procedures to reduce the incidence of colorectal cancer [2–4]. Conventionally, virtual colonoscopy is a minimally invasive procedure used to detect colorectal polyps based on computed tomography (CT) data [5]. In virtual colonoscopy, operators inspect the colonic inner surface via a virtual camera going through the entire colon along the colon centerline. However, the virtual fly-through can only provide a limited field of view (FOV) for operators on a single projection window, resulting in time-consuming inspection and the possibility of missing polyps obscured by colonic haustral folds. Virtual colon flattening (VF) is a complementary viewing mode to virtual colonoscopy [6]. VF provides a global FOV of the entire 3D colonic inner surface for operators by virtually flattening the colonic inner surface onto a 2D image. Compared with conventional colonoscopy, inspecting on a 2D flattened image is faster and results in fewer uninspected regions [7–9]. Numerous methods have been proposed to implement VF in the last decade [6,10–17]. These methods can be divided into three categories, namely, ray casting, conformal mapping, and skeleton straightening, all of which were named according to the principal computer graphic technique used.

Ray casting is based on the ray tracing algorithm [18]. The key step in ray casting is to generate sampling rays that are uniform, non-intersecting, and approximately orthogonal to the colon centerline. The 3D colonic inner surface can be mapped into a 2D image via ray projection by using sampling rays. Wang et al. [6] proposed a method that uses electric field lines as sampling rays. Bartroli et al. [10] utilized the distance field to generate sampling rays. Conformal mapping is based on a mathematical concept [12]. Conformal mapping is angle preserving when mapping a 3D structure to a 2D image. Hong et al. [11] presented a conformal-mapping method based on a harmonic 1-form. Qiu et al. [13] proposed to use discrete Ricci flow to realize conformal mapping because the computation of discrete Ricci flow can be fully parallelized and efficiently accelerated by a graphics processing unit. Zeng et al. [14] introduced the usage of quasi-conformal mapping, which can achieve supine and prone colon registration for the same patient case. Gurijala et al. proposed to use heat diffusion Riemannian metric to fulfill conformal mapping, which is robust to topological noise [17]. Skeleton straightening takes advantage of the mesh skinning algorithm, which is widely used in computer animation. In this technique, the colonic inner surface is regarded as a skin layer and the colon centerline is used as the skeleton. Further, Sudarsky et al. [15] presented a general three-step skeleton-straightening method. Yao et al. [16] described a reversible projection skeleton-straightening method that can revert a 2D flattened image to the 3D original structure.

The applications of existing VF methods are often hindered by distortions of colonic anatomies when deformed from a 3D structure to a 2D image. To alleviate deformation distortions, many existing methods use the colonic inner surface as the basis for distortion correction. However, the colonic inner surface is not a reliable tool for distortion correction because of its colonic haustral folds. Various colonic haustral folds make the surface of colonic inner surface rough, leading to unacceptable distortions. For example, ray casting and conformal mapping are usually vulnerable to over- and under-sampling, which might cause shrinking and exaggeration of the colonic inner surface on the 2D image. In skeleton straightening, colonic haustral folds can negatively affect the shape of the flattened colonic inner surface.

This study proposes a VF method that uses the colonic outer surface instead of the colonic inner surface to correct distortions. The proposed method contains two novel algorithms, namely, the colonic outer surface extraction (OSE) algorithm and the colonic outer surface-based distortion correction algorithm (DCA). OSE was developed to extract the colonic outer surface for distortion correction. In OSE, the level set method is used to generate a candidate colonic outer surface, and a geodesic distance map is applied to eliminate fused areas between distant colonic regions. The DCA describes how to use the colonic outer surface to correct distortions. Our method was validated on 60 scans involving 77 annotated polyps and compared with three existing methods.

@&#METHOD@&#

The concepts of colonic inner surface, colonic outer surface, and colonic wall are first defined to illustrate the proposed method. The colonic inner surface is the lumen–mucosa boundary, and the colonic outer surface is the tissue–serosa boundary. The colonic wall is the layer between the colonic inner surface and the colonic outer surface. The colonic inner surface is the outer surface of the colonic lumen, whereas the colonic outer surface is the outer surface of the colonic wall (see Fig. 1
                     ).

The framework of our proposed method is presented in Fig. 2
                     . The proposed method is composed of seven steps. As shown in Fig. 2, only the last four procedures are introduced sequentially in the following section because the first three procedures can be performed by using many other existing methods.

In this section, the OSE algorithm is developed to extract a single-connectedness colonic outer surface. OSE consists of three steps: extract colonic wall, create geodesic distance map based on colonic lumen, detect and eliminate fused areas of colonic wall by using geodesic distance map and ball filter technique [19]. In our work, the OSE algorithm focuses on the third step on how to attain a single-connectedness colonic outer surface that is suitable for colon flattening, because the first and the second steps can be fulfilled by many existing methods [20–24].

Methods developed by Van Uitert and Summers [20] and Lu and Zhao [21] were adopted to extract colonic wall and produce geodesic distance map respectively. Geodesic distance map in the colonic lumen presents geodesic distance values to the bottom of the rectum. In our method, the computation of geodesic distance was implemented via the 3–4–5 integer distance metric. An example of a geodesic distance map is illustrated in Fig. 3
                        .

For the third step, OSE aims to detect fused areas (see Fig. 1(d)) in the colonic wall. OSE considers that the colonic lumen is a single-connected tube, even though partial colonic walls might fuse together. If a fusion of the colonic wall takes place, there must be two sets of paths from voxels locating at the fused areas to the starting seed. In the OSE, the bottom of rectum was used as the starting seed (see Fig. 1(b)). Thus, we could determine whether a voxel belongs to the fused colonic wall by checking the difference between its longest path and shortest path to the starting seed. For a given voxel 
                           p
                         on the colonic wall, we used the ball filter technique [19] to calculate the difference dif(
                           p
                        ) between its longest and shortest paths to the starting seed. The ball filter was constructed as follows.

Let voxel set O contain all the voxels that are inside the colon outer surface, voxel set I contain all the voxels that are inside the colonic lumen, and voxel set S contain all the voxels that are inside the colonic wall. Thus, S can be computed by O and I:
                           
                              (1)
                              
                                 
                                    
                                       S
                                    
                                    =
                                    
                                       O
                                    
                                    −
                                    (
                                    
                                       O
                                    
                                    ∩
                                    
                                       I
                                    
                                    )
                                    .
                                 
                              
                           
                        
                     

Let voxel set N represent all the voxels inside the ball filter, which uses the given voxel 
                           p
                         as the centroid. Then,
                           
                              (2)
                              
                                 
                                    
                                       N
                                    
                                    =
                                    {
                                    
                                       q
                                    
                                    |
                                    |
                                    
                                       q
                                    
                                    −
                                    
                                       p
                                    
                                    |
                                    |
                                    <
                                    
                                       T
                                       r
                                    
                                    ,
                                    
                                       q
                                    
                                    ∈
                                    
                                       I
                                    
                                    ,
                                    
                                       p
                                    
                                    ∈
                                    
                                       S
                                    
                                    }
                                 
                              
                           
                        where T
                        
                           r
                         is the size of the ball filter. T
                        
                           r
                         was set as 6.0, which can cover colonic wall of thickness not larger than 6×0.5×2=6mm (The smallest pixel spacing is 0.5mm, see Section 3.1).

Thus, the dif(
                           p
                        ) can be calculated as
                           
                              (3)
                              
                                 
                                    d
                                    i
                                    f
                                    (
                                    
                                       p
                                    
                                    )
                                    =
                                    M
                                    a
                                    x
                                    (
                                    g
                                    (
                                    
                                       q
                                    
                                    )
                                    )
                                    −
                                    M
                                    i
                                    n
                                    (
                                    g
                                    (
                                    
                                       q
                                    
                                    )
                                    )
                                    ,
                                    
                                       q
                                    
                                    ∈
                                    
                                       N
                                    
                                    ,
                                    
                                       p
                                    
                                    ∈
                                    
                                       S
                                    
                                 
                              
                           
                        where g(x) is the geodesic distance map and g(
                           q
                        ) returns the value of geodesic distance at the position of voxel 
                           q
                         by looking up the geodesic distance map which generates at the second step. Max(x) and Min(x) returns the maximal and minimal values of g(x) within the ball filter defined in Eq. (2).

Let voxel set F represents the removed voxels. Then,
                           
                              (4)
                              
                                 
                                    
                                       F
                                    
                                    =
                                    {
                                    
                                       p
                                    
                                    |
                                    d
                                    i
                                    f
                                    (
                                    
                                       p
                                    
                                    )
                                    >
                                    
                                       T
                                       d
                                    
                                    ,
                                    
                                       p
                                    
                                    ∈
                                    
                                       S
                                    
                                    }
                                    .
                                 
                              
                           
                        where T
                        
                           d
                         is a threshold to remove voxels belonging to fused areas. T
                        
                           d
                         was set to 5% of the maximal value in the geodesic map, so that even the thickness of the largest haustral folds would not exceed T
                        
                           d
                        .

Thus, the update O
                        
                           #
                         without any fused areas can be calculated as
                           
                              (5)
                              
                                 
                                    
                                       
                                          O
                                       
                                       
                                          #
                                       
                                    
                                    =
                                    
                                       O
                                    
                                    −
                                    
                                       F
                                    
                                    .
                                 
                              
                           
                        
                     

After eliminating the fused regions, a morphological opening operation was applied to O
                        
                           #
                         to screen the diverticula on the colon. Finally, a smooth single-connected colonic outer surface can be obtained by extracting the outer surface of O
                        
                           #
                        , as shown in Fig. 4
                        .

Electronic field sampling was adopted to perform original sampling of colonic inner surface. This ray-casting technique was developed by Wang et al. [6]. Electronic field sampling used a charge centerline to generate electronic lines that were used as sampling rays to sample the colonic inner surface. Each point on the colonic centerline constructed a sampling plane (Fig. 5
                        ). When mapping 3D object to 2D view, sampling rays and projection lines were correlated. Sampled voxels on the sampling ray were mapped to the voxels on the corresponding projection line one-to-one, that is, the distance of sampled voxels to the center points along sampling rays determined the depth of field of their corresponding mapped voxels on the 2D view. In our work, an improved version of the electronic field sampling method proposed by Zhang et al. [25] was adopted.

Distortions caused by colonic curvatures can be attributed to two aspects. First, samplings between inward and outward areas were imbalanced at the curved region. Second, two adjacent straight regions might be so close that undesired interactions between the two straight regions were introduced. Intuitively, we attempted to separate all curved and straight regions to process each region independently.

The separation of curve and straight regions could help to reduce longitude distortion of sampling planes along the colonic centerline (see Fig. 6(a)). After separation, segments of centerlines were smoothed and extended, and sampling planes were generated along the separated centerlines in equidistance. We should mention that, the centerline used in this study was produced based on colonic outer surface rather than colonic inner surface, because our previous work indicated that colonic outer surface based centerline was smoother [25]. As shown in Fig. 6(b) and (c), since each segment of centerline was independent, sampling planes on one segment were not affected by sampling planes on other segments. Thus, sampling planes generated after region separation were more regular than those generated before region separation at the longitude direction, especially in those curved regions.

In our work, the “velocity” of the scalar complementary geodesic distance map (CGDM) was developed as a new property to define the boundaries between the curved and straight regions. Scalar CGDM [26] belongs to one type of double-seeded geodesic distance transformation. CGDM can be calculated as:
                              
                                 (6)
                                 
                                    
                                       c
                                       g
                                       (
                                       
                                          p
                                       
                                       )
                                       =
                                       
                                          g
                                          1
                                       
                                       (
                                       
                                          p
                                       
                                       )
                                       −
                                       
                                          g
                                          2
                                       
                                       (
                                       
                                          p
                                       
                                       )
                                       ,
                                    
                                 
                              
                           where cg(
                              p
                           ) returns the complementary geodesic distance value at the voxel 
                              p
                           , and g
                           1(
                              p
                           ) and g
                           2(
                              p
                           ) return the geodesic distance values from the voxel 
                              p
                            to the first and second seeds, respectively. The rectum and cecum endpoints served as the two starting seeds.

Scalar CGDM is attained by normalizing CGDM with distance interval R. In this study, R was set as 10. Since CGDM was calculated with the use of 3–4–5 integer distance metric, R
                           =10 could guarantee that equidistant sheet is of thickness of at least two voxels. The main feature of scalar CGDM is that it consists of a series of continuous equidistant sheets which are basically orthogonal to the colon centerline, as shown in Fig. 7(a). Scalar CGDM has several basic properties, such as uniqueness, monotonicity, symmetry, and quasi-linearity. Details on the basic properties of scalar CGDM can be found in [26]. However, relying on the basic properties of scalar CGDM is not sufficient to differentiate curved from the straight regions. Therefore, “velocity” was developed as a new property to quantify the degree of colonic curvature. All equidistant sheets would propagate in a wave-like manner if the target region is a tube-like structure, such as the colon, based on uniqueness and monotonicity. The velocity of an equidistant sheet was low at the curved regions because partial voxels that entered the inward region must slow down to wait for voxels that enter the outward region. Thus, the distributions of equidistant sheets at the curved regions were sparser than those of equidistant sheets at the straight regions (Fig. 7). The velocity v can be calculated as
                              
                                 (7)
                                 
                                    
                                       ν
                                       =
                                       
                                          
                                             
                                                ∑
                                                
                                                   i
                                                   =
                                                   0
                                                
                                                t
                                             
                                             
                                                
                                                   ∇
                                                
                                                c
                                                g
                                                (
                                                
                                                   
                                                      p
                                                   
                                                   i
                                                
                                                )
                                             
                                          
                                          t
                                       
                                       ,
                                    
                                 
                              
                           where ▿cg(
                              p
                           ) is used to calculate the gradient of cg(
                              p
                           ) in the scalar CGDM and t represents the volume of the equidistant sheet.

Four steps are used to determine curved regions and straight regions. Firstly, extract local minimum from the curve of velocity (Fig. 7(c)). Secondly, remove outlier local minimums, whose values are larger than the threshold 
                              
                                 
                                    T
                                    v
                                 
                                 =
                                 5.0
                              
                           . (Since R
                           =10 is the normalization interval of scalar CGDM, the range of velocity is 0–10. So, we set T
                           
                              v
                            equaling to half of the range of velocity.) Thirdly, if the number of local minimums exceeds T
                           
                              n
                           , it would be limited to T
                           
                              n
                            based on ascending order. T
                           
                              n
                            is used to prevent over-separation. In this study, we empirically set T
                           
                              n
                           
                           =20, which is five times of anatomical colonic curvatures (hepatic flexure, splenic flexure, sigmoid junction, and rectosigmoid). Finally, the extracted local minimums are labeled as curved regions, while the remaining regions are labeled as straight regions.

The correction procedure in this section aims to alleviate radial distortion on colonic inner surface sampling. The correction procedure consists of four steps. First is the acquisition of original sampling endpoints by using the electronic field sampling method described in Section 2.1. Original sampling endpoints are intersection points of colonic outer surface and original sampling rays. Second is the extraction of profile of colonic outer surface. Third is the generation of corrected sampling endpoints. The corrected sampling endpoints are equidistant points along the profile of colonic outer surface. Two neighboring corrected sampling endpoints are at a distance of D. In this study, D is set to 1, so that each voxel along the profile of colonic outer surface would not be missed during the resampling. Fourth is to construct corrected sampling rays via corrected sampling endpoints and resample the colonic inner surface. Fig. 8
                            presents the procedure about the generation of corrected sampling rays.

We used 60 CT scans for the performance validation (downloaded from National Cancer Image Archive Resources [27]). The volumes of CT scans are 512×512×366–512×512×505. The slice thickness is 1.25mm. The pixel spacing is 0.5–0.8mm. The 60 CT scans involve 77 annotated polyps, where 57 polyps are 6–9mm and 20 polyps are larger than 10mm. Among the 77 annotated polyps, 16 were annotated as pedunculated, 54 were sessile, and 7 were flat.

To validate the performance of our proposed method, three existing methods were used for comparison. Each of the three existing methods belongs to the ray-casting technique (RCT), the conformal-mapping technique (CMT), and the skeleton-straightening technique (AST), as mentioned above. The three existing methods used for comparison were implemented following the methods developed by Wang et al. [6], Hong et al. [11] and Sudarsky et al. [15]. They were coded by Matlab 2013a [28] and VTK Libraries [29].

For the sake of fair comparison, the four methods all initiated from the same colonic inner surface and colon centerline. In this paper, methods developed by Franaszek et al. [30] and Lu et al. [31] were adopted to extract colonic inner surface and colon centerline respectively. Furthermore, with the help of 3D Slicer [32], colonic inner surface and colon centerline might undergo semi-automatical refinement, such as surface denoising and centerline correction.

We conduct both of quantitative and visual comparisons on the results of the four methods. For the quantitative comparisons, both of size change ratio and shape change ratio are provided. In this study, size change ratio is defined as the change ratio of polyp's longest diameter, and shape change ratio is defined as the change ratio of polyp's longest diameter versus its shortest diameter. In the quantitative comparisons, firstly, we measured the longest diameter and shortest diameters of polyps on the 3D view with 3D Slicer [32]. Secondly, we measured the longest diameter and shortest diameters of polyps on the 2D flattened results. Finally, we calculated both of the change ratios of size and shape between 3D measurements and 2D measurements. The quantitative comparison results were presented in Table 1
                        , Figs. 9 and 10
                        
                        .

For visual comparison, three operators were asked to visually inspect the flattened results independently. Before inspection, the three operators were trained by five additional scans. Each operator would inspect all of the four results generated by the four VF methods on the five training scans. When inspection began, flattened results were put into four groups according to the used method. The inspection dates between two groups were one week so as to avoid recall bias. During inspection, operators would record 2D coordinates of the detected polyps on the 2D flattened images. A distance threshold E
                        =20 was set to verify the 2D coordinates of the operator-detected polyps with those of the annotated polyps. If the distance from an operator-detected polyp to its closest annotated polyp did not exceed the distance threshold, the operator-detected polyp was regarded as a true positive. We used two indicators, sensitivity and false positives per scan, to evaluate the results. These indicators were calculated as follows.
                           
                              (8)
                              
                                 
                                    Sensitivity
                                    =
                                    
                                       
                                          Number of detections
                                       
                                       
                                          Number of annotations
                                       
                                    
                                    ×
                                    100
                                    ,
                                 
                              
                           
                        
                        
                           
                              (9)
                              
                                 
                                    False positives per scan
                                    =
                                    
                                       
                                          Nummber of false positives
                                       
                                       
                                          Number of scans
                                       
                                    
                                    .
                                 
                              
                           
                        
                     

The visual comparison results were presented in Tables 2 and 3
                        
                        . The P-values were computed from one way ANOVA test with the Matlab 2013a. An example for the results of the four methods is presented in Fig. 11
                        . The average time for distortion correction, including the algorithms OSE and DCA, was approximately 5min on a PC platform of Intel 2.7GHz CPU and 8.00GB RAM.

@&#DISCUSSION@&#

In this study, we developed two novel algorithms (OSE and DCA) to flatten the colonic inner surface with the help of the colonic outer surface. A complete VF image produced by our method is presented in Fig. 12
                     . The OSE algorithm aimed to extract a single-connected colonic outer surface. As shown in Fig. 4, the colonic outer surface attained by using OSE algorithm was single-connected without fused areas. Further, as shown in Fig. 12, the flattened colonic inner surface was complete and did not have any holes caused by fusion of partial colonic outer surface. In the DCA algorithm, the electronic field sampling method was adopted as the basic sampling tool due to its simplicity and easy integration with other post-processing procedures. We hypothesized that the non-uniform sampling of colon (a convoluted tube-like object) was principally caused by two problems. One involves interactions between distant sampling planes; the other involves interactions between neighboring sampling planes. The first problem could be avoided by separating colonic curved regions from straight regions. The second problem cannot be avoided, but can be significantly alleviated after linear correction to sampling rays.

As shown in Table 1, Figs. 9 and 10, our method achieved the smallest change to polyp when mapping from 3D structure to 2D object. Further, as can be seen in Tables 2 and 3, our proposed method could yield higher sensitivity and lower false positives per scan than the other methods that use the colonic inner surface as correction basis. From the significance analysis, we can see that our method attain statistically better performance on the sensitivity of polyp detection than the other methods (P-value is only a little higher than 0.05). Both of the quantitative and visual results demonstrated the advantages of using colonic outer surface for distortion correction.

Our method attempted to process curved and straight regions independently (see Section 2.3.1), which would cause split to flattened colon. To overcome the split problem, overlaps were used to represent the split regions, which was similar to the approach that was widely used by other existing methods to deal with such split on the flattened colon along the centerline direction (see Fig. 11(b)–(d)). Therefore, although our method would split the flattened colon, operators could still get used to such split after training. As indicated by the visual comparison results in Tables 2 and 3, the split of flattened colon was not a problem on the performance of polyp detection.

@&#CONCLUSION@&#

In this paper, we proposed a VF method that use colonic outer surface to correct deformable distortion. Using colonic outer surface has several advantages over using colonic inner surface. First, the correction basis and the target colonic inner surface are two separated objects, in contrast to the conventional means whose correction basis is also colonic inner surface itself. Second, the colonic outer surface is smoother and can represent the topological structure of the entire colon better than the colonic inner surface, because no haustral folds exist on the colonic outer surface.

None declared.

@&#ACKNOWLEDGMENTS@&#

This work was supported in part by the National Basic Research Program of China (2010CB834302), the National Natural Science Foundation of China (81371634), the National High Technology Research and Development Program of China (2007AA02Z452), the Shanghai Jiao Tong University Medical Engineering Cross Research Funds (YG2013MS30 and YG2011MS51), and the Scientific Innovation Act of STCSM (13511504200).

@&#REFERENCES@&#

