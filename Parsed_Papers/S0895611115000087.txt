@&#MAIN-TITLE@&#Iterative mesh transformation for 3D segmentation of livers with cancers in CT images

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           An iterative mesh transformation algorithm for liver segmentation is proposed.


                        
                        
                           
                           Multi-resolution transformation optimization controls the 3D shape of a liver mesh.


                        
                        
                           
                           Dynamic-programming searches the 2D liver contours on CT images.


                        
                        
                           
                           A semi-automated segmentation scheme for diseased livers is developed.


                        
                        
                           
                           Interaction is reduced to as little as five user-identified landmarks.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Image segmentation

Mesh deformation

Dynamic-programming

Liver segmentation

@&#ABSTRACT@&#


               
               
                  Segmentation of diseased liver remains a challenging task in clinical applications due to the high inter-patient variability in liver shapes, sizes and pathologies caused by cancers or other liver diseases. In this paper, we present a multi-resolution mesh segmentation algorithm for 3D segmentation of livers, called iterative mesh transformation that deforms the mesh of a region-of-interest (ROI) in a progressive manner by iterations between mesh transformation and contour optimization. Mesh transformation deforms the 3D mesh based on the deformation transfer model that searches the optimal mesh based on the affine transformation subjected to a set of constraints of targeting vertices. Besides, contour optimization searches the optimal transversal contours of the ROI by applying the dynamic-programming algorithm to the intersection polylines of the 3D mesh on 2D transversal image planes. The initial constraint set for mesh transformation can be defined by a very small number of targeting vertices, namely landmarks, and progressively updated by adding the targeting vertices selected from the optimal transversal contours calculated in contour optimization. This iterative 3D mesh transformation constrained by 2D optimal transversal contours provides an efficient solution to a progressive approximation of the mesh of the targeting ROI. Based on this iterative mesh transformation algorithm, we developed a semi-automated scheme for segmentation of diseased livers with cancers using as little as five user-identified landmarks. The evaluation study demonstrates that this semi-automated liver segmentation scheme can achieve accurate and reliable segmentation results with significant reduction of interaction time and efforts when dealing with diseased liver cases.
               
            

@&#INTRODUCTION@&#

Liver cancer is the third most common cause of death from cancer worldwide [1], and liver is the most common metastatic spread sites of cancers after the lymph nodes, which have been found in 30–70% of patients who are dying of cancer [2]. With the technical advances of computed tomography (CT), hepatic CT scanning has become one of the major routinely-performed clinical imaging modality in cancer diagnosis, staging, and treatment evaluation because of the relatively low cost and wide availability [3]. Segmentation of liver in CT images is crucial for liver-related clinical applications. However, accurate and reliable liver segmentation continues to be a challenging task especially for diseased livers because of the deformation of the liver shape caused by large tumors, the complexity of the diseased liver pathologies, the variability of image presence of different hepatic diseases (such as hypodense or hyperdense lesions), and the fuzzy boundaries between liver and the adjacent organs (such as heart and stomach). Therefore, liver segmentation attracts continuously researchers’ attentions in medical imaging and graphics community [4,5].

Numerous automated, semi-automated and interactive methods for liver segmentation have been developed, including statistical shape model [6–8], atlas matching method [9–11], deformable model [12,13], level-set method [14–17], and other hybrid methods based on user-interaction [18], graph-cut [19], region-growing [20], machine-learning [21], etc. With regard to segmentation accuracy and reliability, there is a clear tendency that interactive methods outperform semi-automated methods, which in turn outperform fully automated approaches. However, user interaction time and efforts tend to have a reversed tendency: interactive segmentation of a liver on CT images is labor-intensive, time-consuming and prone to inter-operator variability. Clinical applications seek an accurate and reliable segmentation method for diseased livers with minimum amount of required user interactions.

The technique challenges of the segmentation of diseased livers result from the high inter-patient variability in liver shapes, sizes and pathologies as well as the longitudinal intra-patient variability. It is not uncommon that cancers and metastases change the liver size and deforms the liver shape, and thus result in a very large range of variations among patients. Fig. 1
                      demonstrates the inter-patient variability in shapes and sizes of diseased livers from patients with cancers or metastases. The sizes of livers vary significantly with more than four times of difference. More importantly, the shapes of livers show substantial difference caused by cancers or metastases or treatments: (1) liver shapes may be bended or twisted or deformed severely due to the growing or shrinking of tumors; (2) different hepatic lobes may be shrunk or expanded extraordinarily; and (3) tumor tissues show substantially different CT intensity compared to normal liver parenchyma. This inter-patient variability makes the modeling of a statistic shape for liver segmentation an extremely challenging task. To deal with the complex shape variations of diseased livers, sparse shape composition model [22] and auto context multi-atlas model [23] were proposed to handle errors or outliers of statistic models and preserve local details for different shapes of liver. These atlas-based or shape-prior-based automatic methods require learning from available shapes of segmented livers, which may be itself a difficult task.

As long as fully-automated segmentation methods fail to produce satisfactory segmentations on these diseased cases, certain amounts of user interaction are still required. Deformable models offer the essential options of interactive control over the segmentation process via interactive manipulating of a deformable surface [24]. Traditional mesh deformation methods simulate the mechanism behavior of a surface by minimizing the stretching and bending energies of the surface, such as active geometric deformed models [25] and active contour models or snakes [26]. However, one limitation of these energy-based mesh deformable methods is that the difference between the initial mesh and resulting mesh must be sufficiently small, which may turn out a large amount of interactive manipulations. Motivated by the deformation transfer model [27], which transfers the mesh deformation using deformation gradients instead of local energies, mesh may be deformed efficiently using a small set of targeting points while allowing accurate detail-preserving interactions.

In this paper, we proposed a multi-resolution mesh segmentation algorithm, called iterative mesh transformation that deforms the mesh of a region-of-interest (ROI) in a progressive manner by iterations between mesh transformation and contour optimization. The initial constraint set for mesh transformation can be defined by a very small number of targeting vertices, namely landmarks, and progressively updated by adding the targeting vertices selected from the optimal transversal contours calculated in contour optimization. This iteration between 3D mesh transformation and 2D transversal contours optimization provides an efficient solution to a progressive approximation of the targeting ROI mesh with minimum user interactions. By using this iterative mesh transformation algorithm, we developed a semi-automated image segmentation scheme for diseased livers with cancers. This scheme can effectively segment the diseased livers with cancers using as little as five user-identified landmarks. It achieves accurate and reliable segmentation results when dealing with these diseased liver cases, and reduces significantly the interaction time and efforts. The resulting 3D liver mesh provides the meta-data for quantitative image analysis of diseased livers in different clinical applications.

The major contributions of the proposed method are twofold.
                        
                           •
                           Technical contributions: Diseased livers tend to have high inter-patient variability of shapes and sizes, which makes the modeling of a statistic shape for liver segmentation an extremely challenging task. The transformation optimization in iterative mesh transformation provides an effective solution for the global approximation of a diseased liver, which is superior to those of energy-based mesh deformation that tends to converge to a local boundary caused by the inhomogeneity in diseased regions. On the other hand, the transversal contours optimization provides the local refinement for detecting the precise boundaries of a liver. As a result, the combination of 3D transformation optimization and 2D contour optimization provides an accurate and efficient technical solution for the segmentation of diseased livers.

Clinical contributions: Manual contouring remains the major clinical procedure for segmentation of diseased livers with pathologies, which is labor-intensive, time-consuming and prone to inter-operator variability. The proposed iterative liver segmentation scheme is easy-of-use and reduces the interaction effort as little as five user-identified landmarks. It takes in average 5min to segment a diseased liver case, which is more efficient than most of existing liver segmentation methods. The accuracy and running time have been evaluated by using the MICCAI cases as well as the real clinical cases collected in our institute.

@&#METHOD@&#

Let I(
                           
                              v
                           
                        ) denote the pixel value at a vertex 
                           
                              
                                 v
                              
                              =
                              
                                 
                                    [
                                    x
                                    ,
                                    y
                                    ,
                                    z
                                    ]
                                 
                                 T
                              
                              ∈
                              
                                 R
                                 3
                              
                           
                         in a CT volume, where R
                        3 is 3-dimensional (3D) Euclidean space. A mesh can be defined as a 3-tuple 
                           
                              
                                 M
                              
                              =
                              (
                              
                                 V
                              
                              ,
                              
                                 E
                              
                              ,
                              
                                 Z
                              
                              )
                           
                        , where 
                           V
                         is a vector of vertices, 
                           E
                         is a set of edges connecting two vertices and 
                           Z
                         is a set of faces defined by a closed set of edges, in which a triangle face has three edges. A mesh segmentation is defined as an optimization process that deforms an initial mesh (such as a polyhedron) under certain constrains for segmentation of a ROI, which can be represented as an evolution process 
                           
                              
                                 Λ
                              
                              (
                              θ
                              )
                              =
                              (
                              
                                 M
                                 0
                              
                              ,
                              
                                 M
                                 θ
                              
                              ,
                              
                                 Ω
                              
                              )
                           
                        , where M
                        0 is the initial mesh, M
                        θ is the resulting ROI mesh, 
                           
                              Ω
                           
                         is the constrain set, and 
                           θ
                         is the steps of evolution.


                        Fig. 2
                         illustrates the mesh evolution in the segmentation of a sphere, in which the initial mesh M
                        0 is defined as an icosahedron. During each evolution, a triangle face is decomposed into four smaller triangle faces by adding a middle point on each edge of the triangle (see point D on edge AC in Fig. 2(a)). The corresponding targeting vertex of the newly-added middle point is the boundary point on the sphere surface (see point D
                        
                           1
                         in Fig. 2(a)). Mesh segmentation is a very effective way to approximate the surface or boundary of an object, because the number of faces increases in an exponential manner during the evolution. Table 1
                         lists the properties of the meshes at each step of evolution. The vertices set of M
                        θ contains all the vertices of M
                        θ−1.

Without the loss of generality, we may assume that the targeting ROI is a closed region and thus can be represented by a 2-dimensional (2D) manifold, aka a boundary surface. This assumption indicates that the segmented ROI is locally homeomorphic to a 2D Euclidean space (such as a plane), and thus its boundary surface can be modeled by a triangle mesh. Considering the fact that a sphere is a 2D manifold and is homeomorphic to the boundary surface of a targeting ROI, the homeomorphic theory states that there is a continuous one-to-one mapping between these two surfaces, as indicated below:
                           If 
                                 X
                               and 
                                 Y
                               are homeomorphic, there exists a mapping 
                                 
                                    
                                       Ψ
                                    
                                    :
                                    
                                       X
                                    
                                    →
                                    
                                       Y
                                    
                                 
                               that satisfies the following criteria: (1) 
                                 
                                    Ψ
                                 
                               is a one-to-one correspondence, (2) 
                                 
                                    Ψ
                                 
                               is continuous, and (3) 
                                 
                                    
                                       
                                          Ψ
                                       
                                       
                                          −
                                          1
                                       
                                    
                                 
                               is continuous.
                        
                     

If such a mapping 
                           
                              Ψ
                           
                         exists, we can transform a sphere mesh 
                           
                              
                                 
                                    M
                                 
                                 
                                    Sphere
                                 
                              
                           
                         to the ROI mesh 
                           
                              
                                 
                                    M
                                 
                                 
                                    ROI
                                 
                              
                           
                         by using 
                           
                              Ψ
                           
                         defined by a set of transformations between 
                           
                              
                                 
                                    M
                                 
                                 
                                    Sphere
                                 
                              
                           
                         and 
                           
                              
                                 
                                    M
                                 
                                 
                                    ROI
                                 
                              
                           
                        . Therefore, mesh segmentation is defined as a multi-resolution mesh optimization process by using an objective function subject to a set of correspondence constraints (
                           Ω
                        ):
                           
                              (1)
                              
                                 
                                    
                                       
                                          M
                                       
                                       
                                          R
                                       
                                       *
                                    
                                    (
                                    θ
                                    )
                                    =
                                    
                                       
                                          
                                             
                                                argmin
                                             
                                             
                                                
                                                   s
                                                
                                                .
                                                
                                                   t
                                                
                                                .
                                                
                                                   Ω
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                M
                                             
                                             
                                                ROI
                                             
                                          
                                       
                                    
                                    (
                                    
                                       w
                                       0
                                    
                                    
                                       f
                                    
                                    (
                                    
                                       M
                                       0
                                    
                                    )
                                    +
                                    
                                       w
                                       1
                                    
                                    
                                       f
                                    
                                    
                                       
                                          
                                             M
                                             1
                                          
                                       
                                    
                                    +
                                    ⋯
                                    +
                                    
                                       w
                                       θ
                                    
                                    
                                       f
                                    
                                    
                                       
                                          
                                             M
                                             θ
                                          
                                       
                                    
                                    )
                                    ,
                                 
                              
                           
                        where, 
                           
                              
                                 
                                    M
                                 
                                 
                                    R
                                 
                                 *
                              
                              
                                 θ
                              
                           
                         is the approximation of the ROI mesh 
                           
                              
                                 
                                    M
                                 
                                 
                                    ROI
                                 
                              
                           
                         after the evolution of θ times, 
                           f
                         is the objective function of the transformation optimization defined on mesh M
                        
                           i
                        , w
                        
                           i
                         is the weight of 
                           
                              
                                 f
                              
                              
                                 
                                    
                                       M
                                       i
                                    
                                 
                              
                           
                        . Constraint 
                           Ω
                         is a set of known correspondence between the sphere mesh 
                           
                              
                                 
                                    M
                                 
                                 
                                    Sphere
                                 
                              
                           
                         and the ROI mesh 
                           
                              
                                 
                                    M
                                 
                                 
                                    ROI
                                 
                              
                           
                        .

The weights in Eq. (1) control the “level-of-detail” (or granularity) of deformation at different resolutions of the resulting mesh. In general, w
                        0 controls the coarsest or overall deformation and w
                        θ does the finest deformation for detail preservation. Rigid organs tend to have larger value of w
                        0 and smaller value of w
                        θ, whereas flexible ones employ smaller value of w
                        0 and larger value of w
                        θ. In our study, θ is set to 5, which indicates the number of vertices of the resulting mesh of a liver is 10,242 (θ
                        =5). 
                           
                              
                                 w
                                 0
                              
                              −
                              
                                 w
                                 5
                              
                           
                         are set to 0.1, 0.1, 01, 0.2 and 0.5, respectively. These values were estimated empirically based on the flexibility of a liver.

The homeomorphic assumption indicates that a local boundary of a ROI can be mapped to a local surface of a sphere if the local boundary is small enough. By dividing each transversal slice of a ROI into n sectors, as illustrated in Fig. 3
                        , we may establish the mapping correspondence 
                           
                              Ψ
                           
                         between the sphere surface and a ROI boundary when the sector is divided small enough. It results in a continuous one-to-one mapping between the ROI boundary point (
                           
                              
                                 
                                    v
                                 
                                 
                                    i
                                 
                                 
                                    ROI
                                 
                              
                           
                        ) and the sphere mesh vertex (
                           
                              
                                 
                                    v
                                 
                                 
                                    i
                                 
                                 
                                    S
                                 
                              
                           
                        ).

Let 
                           V
                        
                        
                           
                              S
                           
                         and 
                           V
                        
                        
                           ROI
                         be the vertex set of a sphere surface and a ROI boundary respectively, and the mapping function 
                           
                              Ψ
                           
                         be a linear transformation. We may represent 
                           
                              
                                 
                                    v
                                 
                                 
                                    i
                                 
                                 
                                    ROI
                                 
                              
                           
                         as the transformed vertex of 
                           
                              
                                 
                                    v
                                 
                                 
                                    i
                                 
                                 
                                    S
                                 
                              
                           
                        :
                           
                              (2)
                              
                                 
                                    
                                       T
                                    
                                    ×
                                    
                                       
                                          v
                                       
                                       
                                          i
                                       
                                       
                                          S
                                       
                                    
                                    +
                                    
                                       D
                                    
                                    =
                                    
                                       
                                          v
                                       
                                       
                                          i
                                       
                                       
                                          ROI
                                       
                                    
                                 
                              
                           
                        where, 
                           
                              
                                 
                                    v
                                 
                                 
                                    i
                                 
                                 
                                    S
                                 
                              
                           
                         is the vertex of the initial sphere mesh, 
                           
                              
                                 
                                    v
                                 
                                 
                                    i
                                 
                                 
                                    ROI
                                 
                              
                           
                         is the vertex of the ROI boundary, 
                           T
                         is a 3×3 affine transformation matrix, and 
                           D
                         is a translation vector.

Considering the geometric continuity during a mesh deformation, we assume that the four vertices 
                           
                              
                                 v
                                 1
                              
                              −
                              
                                 v
                                 4
                              
                           
                         around an edge E
                        i in a mesh share the same affine transformation 
                           T
                         and translation 
                           D
                        , as shown in Fig. 4(a). Thus, 
                           
                              
                                 
                                    v
                                 
                                 
                                    i
                                 
                                 
                                    ROI
                                 
                              
                           
                         can be represented below:
                           
                              (3)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   T
                                                
                                                ×
                                                
                                                   
                                                      v
                                                   
                                                   1
                                                   
                                                      S
                                                   
                                                
                                                +
                                                
                                                   D
                                                
                                                =
                                                
                                                   
                                                      v
                                                   
                                                   1
                                                   
                                                      ROI
                                                   
                                                
                                                ,
                                             
                                          
                                          
                                             
                                                
                                                   T
                                                
                                                ×
                                                
                                                   
                                                      v
                                                   
                                                   2
                                                   
                                                      S
                                                   
                                                
                                                +
                                                
                                                   D
                                                
                                                =
                                                
                                                   
                                                      v
                                                   
                                                   2
                                                   
                                                      ROI
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   T
                                                
                                                ×
                                                
                                                   
                                                      v
                                                   
                                                   3
                                                   
                                                      S
                                                   
                                                
                                                +
                                                
                                                   D
                                                
                                                =
                                                
                                                   
                                                      v
                                                   
                                                   3
                                                   
                                                      ROI
                                                   
                                                
                                                ,
                                             
                                          
                                          
                                             
                                                
                                                   T
                                                
                                                ×
                                                
                                                   
                                                      v
                                                   
                                                   4
                                                   
                                                      S
                                                   
                                                
                                                +
                                                
                                                   D
                                                
                                                =
                                                
                                                   
                                                      v
                                                   
                                                   4
                                                   
                                                      ROI
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

By eliminating 
                           D
                         in Eq. (3), the affine transformation 
                           T
                         for the edge E
                        i between 
                           V
                        
                        
                           
                              S
                           
                         and 
                           V
                        
                        
                           ROI
                         can be determined by Eq. (4):
                           
                              (4)
                              
                                 
                                    
                                       T
                                    
                                    (
                                    
                                       E
                                       i
                                    
                                    )
                                    =
                                    
                                       
                                          T
                                       
                                       
                                          ROI
                                       
                                    
                                    ×
                                    
                                       
                                          [
                                          
                                             
                                                T
                                             
                                             
                                                S
                                             
                                          
                                          ]
                                       
                                       
                                          −
                                          1
                                       
                                    
                                 
                              
                           
                        where, both 
                           T
                        
                        
                           
                              ROI
                           
                         and 
                           T
                        
                        
                           
                              S
                           
                         are 3×3 matrix, 
                           
                              
                                 
                                    T
                                 
                                 
                                    ROI
                                 
                              
                              =
                              
                                 
                                    
                                       
                                          v
                                       
                                       2
                                       
                                          ROI
                                       
                                    
                                    −
                                    
                                       
                                          v
                                       
                                       1
                                       
                                          ROI
                                       
                                    
                                    ,
                                    
                                       
                                          v
                                       
                                       3
                                       
                                          ROI
                                       
                                    
                                    −
                                    
                                       
                                          v
                                       
                                       1
                                       
                                          ROI
                                       
                                    
                                    ,
                                    
                                       
                                          v
                                       
                                       4
                                       
                                          ROI
                                       
                                    
                                    −
                                    
                                       
                                          v
                                       
                                       1
                                       
                                          ROI
                                       
                                    
                                 
                              
                           
                        , and 
                           
                              
                                 
                                    T
                                 
                                 
                                    S
                                 
                              
                              =
                              [
                              
                                 
                                    v
                                 
                                 2
                                 
                                    S
                                 
                              
                              −
                              
                                 
                                    v
                                 
                                 1
                                 
                                    S
                                 
                              
                              ,
                              
                                 
                                    v
                                 
                                 3
                                 
                                    S
                                 
                              
                              −
                              
                                 
                                    v
                                 
                                 1
                                 
                                    S
                                 
                              
                              ,
                              
                                 
                                    v
                                 
                                 4
                                 
                                    S
                                 
                              
                              −
                              
                                 
                                    v
                                 
                                 1
                                 
                                    S
                                 
                              
                              ]
                           
                        .

Because all initial vertices are defined on a sphere, any four vertices 
                           
                              
                                 
                                    v
                                 
                                 1
                                 
                                    S
                                 
                              
                              −
                              
                                 
                                    v
                                 
                                 4
                                 
                                    S
                                 
                              
                           
                         around an edge E
                        i are non-coplanar and thus 
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                T
                                             
                                             
                                                S
                                             
                                          
                                       
                                    
                                 
                                 
                                    −
                                    1
                                 
                              
                           
                         always exists. Therefore, the transformation matrix 
                           
                              
                                 T
                              
                              (
                              
                                 E
                                 i
                              
                              )
                           
                         for an edge E
                        
                           i
                         represented by Eq. (4) is a linear function of the unknown coordinates of four deformed vertices 
                           
                              
                                 
                                    v
                                 
                                 
                                    i
                                 
                                 
                                    ROI
                                 
                              
                           
                        , i
                        =1–4, as illustrated in Fig. 4(a). This indicates that the mapping 
                           
                              Ψ
                           
                         between 
                           V
                        
                        
                           
                              S
                           
                         and 
                           V
                        
                        
                           ROI
                         is a function of unknown vertices 
                           
                              
                                 
                                    v
                                 
                                 
                                    i
                                 
                                 
                                    ROI
                                 
                              
                           
                         and can be represented by a linear combination of 
                           
                              
                                 T
                              
                              (
                              
                                 E
                                 i
                              
                              )
                           
                        , where E
                        
                           i
                         is an edge in the edge set of all the triangles that share the vertex of 
                           
                              
                                 
                                    v
                                 
                                 i
                                 S
                              
                           
                        : 
                           
                              
                                 E
                                 i
                              
                              ∈
                              {
                              E
                              
                                 
                                    
                                       Z
                                       i
                                    
                                 
                              
                              ,
                               
                              where
                               
                              
                                 
                                    v
                                 
                                 i
                                 S
                              
                              ∈
                              
                                 V
                              
                              
                                 
                                    
                                       Z
                                       i
                                    
                                 
                              
                              }
                           
                        .

The objective function 
                           
                              
                                 f
                              
                              
                                 
                                    
                                       M
                                       i
                                    
                                 
                              
                           
                         in Eq. (1) is formed by the weighted sum of three types of constraints: smooth constraint (
                           C
                        
                        
                           
                              S
                           
                        ), deforming constraint (
                           C
                        
                        
                           
                              D
                           
                        ) and distance constraint (
                           C
                        
                        
                           
                              L
                           
                        ):
                           
                              (5)
                              
                                 
                                    
                                       f
                                    
                                    =
                                    
                                       w
                                       S
                                    
                                    
                                       
                                          C
                                       
                                       
                                          S
                                       
                                    
                                    +
                                    
                                       w
                                       D
                                    
                                    
                                       
                                          C
                                       
                                       
                                          D
                                       
                                    
                                    +
                                    
                                       w
                                       L
                                    
                                    
                                       
                                          C
                                       
                                       
                                          L
                                       
                                    
                                    ,
                                 
                              
                           
                        where, w
                        
                           S
                        , w
                        
                           D
                        , w
                        
                           L
                         are the weights of the corresponding constraints.

The smooth constraint 
                           C
                        
                        
                           
                              S
                           
                         is so defined that the transformation matrix 
                           
                              
                                 T
                              
                              (
                              
                                 E
                                 i
                              
                              )
                           
                         (see Eq. (4)) for three edges of a triangle face should be as equal as possible. In specific, for each triangle face Z
                        
                           i
                         in a mesh 
                           M
                        , as shown in Fig. 4b and c, 
                           C
                        
                        
                           
                              S
                           
                         is defined below:
                           
                              (6)
                              
                                 
                                    
                                       
                                          C
                                       
                                       
                                          S
                                       
                                    
                                    
                                       
                                          M
                                       
                                    
                                    =
                                    
                                       ∑
                                       
                                          
                                             
                                                Z
                                             
                                             
                                                i
                                             
                                          
                                          ∈
                                          
                                             Z
                                          
                                          (
                                          
                                             M
                                          
                                          )
                                       
                                    
                                    
                                       
                                          ∑
                                          
                                             
                                                
                                                   
                                                      
                                                         j
                                                         ≠
                                                         k
                                                         =
                                                         1
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            E
                                                            j
                                                         
                                                         ∈
                                                         E
                                                         
                                                            
                                                               
                                                                  
                                                                     Z
                                                                  
                                                                  
                                                                     i
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            E
                                                            k
                                                         
                                                         ∈
                                                         E
                                                         
                                                            
                                                               
                                                                  
                                                                     Z
                                                                  
                                                                  
                                                                     i
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          3
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               T
                                                            
                                                            (
                                                            
                                                               E
                                                               j
                                                            
                                                         
                                                      
                                                      −
                                                      
                                                         T
                                                      
                                                      
                                                         
                                                            
                                                               E
                                                               k
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             F
                                             2
                                          
                                       
                                    
                                    ,
                                 
                              
                           
                        where, 
                           Z
                        
                        (
                        
                           M
                        
                        ) indicates the triangle face set of mesh 
                           M
                        , Z
                        
                           i
                         is the ith face, 
                           
                              
                                 T
                              
                              (
                              
                                 E
                                 j
                              
                              )
                           
                         and 
                           
                              
                                 T
                              
                              (
                              
                                 E
                                 k
                              
                              )
                           
                         are the transformation matrix of edge E
                        
                           j
                         and E
                        
                           k
                         in the triangle Z
                        
                           i
                         respectively, 
                           
                              
                                 
                                    
                                       ⋅
                                    
                                 
                                 F
                                 2
                              
                           
                         is the Frobenius norm of a matrix.

The deforming constraint 
                           C
                        
                        
                           
                              D
                           
                         transforms the vertices (
                           
                              
                                 
                                    v
                                 
                                 i
                                 
                                    ROI
                                 
                              
                           
                        ) of the mesh as close as possible to the targeting vertices (
                           
                              
                                 
                                    v
                                 
                                 i
                                 
                                    TC
                                 
                              
                           
                        ) of a ROI:
                           
                              (7)
                              
                                 
                                    
                                       
                                          C
                                       
                                       
                                          D
                                       
                                    
                                    (
                                    
                                       M
                                    
                                    )
                                    =
                                    
                                       ∑
                                       
                                          (
                                          
                                             
                                                v
                                             
                                             
                                                i
                                             
                                             
                                                ROI
                                             
                                          
                                          ,
                                          
                                             
                                                v
                                             
                                             
                                                i
                                             
                                             
                                                TC
                                             
                                          
                                          )
                                          ∈
                                          
                                             Ω
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         v
                                                      
                                                      i
                                                      
                                                         ROI
                                                      
                                                   
                                                   −
                                                   
                                                      
                                                         v
                                                      
                                                      i
                                                      
                                                         TC
                                                      
                                                   
                                                
                                             
                                          
                                          2
                                       
                                    
                                    ,
                                 
                              
                           
                        where, 
                           Ω
                         is the set of known vertex correspondence between the sphere mesh and the object boundary of a ROI.

Targeting vertices are known boundary points of a ROI, which may be established by the user-identified landmarks of the ROI 
                           
                              
                                 
                                    V
                                 
                                 
                                    landmark
                                 
                              
                           
                        , the segmented neighboring organs such as 
                           
                              
                                 
                                    V
                                 
                                 
                                    chest
                                 
                              
                           
                         (for liver segmentation), and the selected contour points 
                           
                              
                                 
                                    V
                                 
                                 
                                    contour
                                 
                              
                           
                         on optimal transversal contours. For our application of liver segmentation, we can define 
                           
                              
                                 Ω
                              
                              =
                              {
                              
                                 
                                    
                                       
                                          v
                                       
                                       i
                                       
                                          ROI
                                       
                                    
                                    ,
                                    
                                       
                                          v
                                       
                                       i
                                       
                                          TC
                                       
                                    
                                 
                              
                              |
                              
                                 
                                    v
                                 
                                 i
                                 
                                    ROI
                                 
                              
                              ∈
                              
                                 V
                              
                              
                                 
                                    M
                                 
                              
                                 
                              and
                                 
                              
                                 
                                    v
                                 
                                 i
                                 
                                    TC
                                 
                              
                              ∈
                              (
                              
                                 
                                    V
                                 
                                 
                                    landmark
                                 
                              
                              ∪
                              
                                 
                                    V
                                 
                                 
                                    chest
                                 
                              
                              ∪
                              
                                 
                                    V
                                 
                                 
                                    contour
                                 
                              
                              )
                              }
                           
                        .

In order to maintain the shape regularity of a triangle and prevent the mesh from drastic deformation, we add the distance constraint 
                           C
                        
                        
                           L
                         for maintaining the minimum signed distance change before and after deformation:
                           
                              (8)
                              
                                 
                                    
                                       
                                          C
                                       
                                       
                                          L
                                       
                                    
                                    
                                       
                                          M
                                       
                                    
                                    =
                                    
                                       ∑
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         E
                                                         i
                                                      
                                                      ∈
                                                      E
                                                      
                                                         
                                                            M
                                                         
                                                      
                                                      ,
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            v
                                                         
                                                         1
                                                      
                                                      ∈
                                                      V
                                                      
                                                         
                                                            
                                                               E
                                                               i
                                                            
                                                         
                                                      
                                                      ,
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            v
                                                         
                                                         2
                                                      
                                                      ∈
                                                      V
                                                      (
                                                      
                                                         E
                                                         i
                                                      
                                                      )
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               v
                                                            
                                                            1
                                                            
                                                               ROI
                                                            
                                                         
                                                         −
                                                         
                                                            
                                                               v
                                                            
                                                            2
                                                            
                                                               ROI
                                                            
                                                         
                                                      
                                                   
                                                   −
                                                   
                                                      
                                                         
                                                            
                                                               v
                                                            
                                                            1
                                                            S
                                                         
                                                         −
                                                         
                                                            
                                                               v
                                                            
                                                            2
                                                            S
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          2
                                       
                                    
                                    ,
                                 
                              
                           
                        where, 
                           E
                        (
                           M
                        ) indicates the edge set of mesh 
                           M
                        , 
                           
                              
                                 V
                              
                              (
                              
                                 E
                                 i
                              
                              )
                           
                         is a set of end points of edge E
                        
                           i
                        , i.e., 
                           
                              
                                 
                                    v
                                 
                                 1
                              
                           
                         and 
                           
                              
                                 
                                    v
                                 
                                 2
                              
                           
                         are two end points of an edge E
                        
                           i
                        .

The weights in Eq. (5) balance three deformations applied to each triangle: w
                        S and w
                        L are smoothing terms in which w
                        S controls the continuity of transformations among adjacent triangles and w
                        L controls the shape regularity of a triangle; w
                        D is a positive term which controls the transformation between mesh vertices and the targeting vertices, i.e. the detected boundary points. In our study, we set 
                           
                              
                                 w
                                 S
                              
                              =
                              1
                           
                        , 
                           
                              
                                 w
                                 D
                              
                              =
                              100
                           
                         and 
                           
                              
                                 w
                                 L
                              
                              =
                              1
                           
                        . The large value of w
                        D implies the strong preservations of the known boundary vertices.

Based on Eq. (1), mesh segmentation is an optimal process for minimizing the objective function by searching a new set of unknown vertices 
                           
                              
                                 
                                    V
                                 
                                 
                                    ROI
                                 
                              
                           
                        . Because all the vertices in the resulting deformed mesh 
                           
                              
                                 
                                    M
                                 
                                 
                                    θ
                                 
                              
                              =
                              (
                              
                                 V
                              
                              ,
                              
                                 E
                              
                              ,
                              
                                 Z
                              
                              )
                           
                         are independent, Eq. (1) can be represented by a vector-valued system of 
                           
                              
                                 
                                    V
                                 
                                 
                                    ROI
                                 
                              
                              =
                              
                                 
                                    
                                       
                                          v
                                       
                                       1
                                       
                                          ROI
                                       
                                    
                                    ,
                                    
                                       
                                          v
                                       
                                       2
                                       
                                          ROI
                                       
                                    
                                    ,
                                    ⋯
                                    ,
                                    
                                       
                                          v
                                       
                                       n
                                       
                                          ROI
                                       
                                    
                                 
                              
                           
                        , which includes all vertices of meshes 
                           
                              
                                 M
                                 0
                              
                              −
                              
                                 M
                                 θ
                              
                           
                        . In addition, because 
                           
                              
                                 T
                              
                              (
                              
                                 E
                                 i
                              
                              )
                           
                         is a function of 
                           
                              
                                 
                                    v
                                 
                                 i
                                 
                                    ROI
                                 
                              
                           
                         (see Eq. (4)), all constrains in the objective function 
                           f
                         form a second order polynomial of 
                           
                              
                                 
                                    v
                                 
                                 i
                                 
                                    ROI
                                 
                              
                           
                        , i.e., 
                           f
                         can be represented by a linear system:
                           
                              (9)
                              
                                 
                                    
                                       f
                                    
                                    =
                                    
                                       ∑
                                       
                                          ξ
                                          =
                                          1
                                       
                                       
                                          
                                             N
                                             *
                                          
                                       
                                    
                                    
                                       
                                          
                                             A
                                          
                                          ξ
                                       
                                       
                                          V
                                       
                                       +
                                       
                                          
                                             B
                                          
                                          
                                             ξ
                                             F
                                          
                                          2
                                       
                                    
                                    ,
                                 
                              
                           
                        where, N
                        
                           *
                        (*
                        =
                        S, D, L) is the total number of items in Eqs. (6), (7) and (8), 
                           
                              
                                 
                                    A
                                 
                                 ξ
                              
                           
                         is a 
                           
                              
                                 N
                                 *
                              
                              ×
                              n
                           
                         sparse coefficient matrix and 
                           
                              
                                 
                                    B
                                 
                                 ξ
                              
                           
                         is a N column vector.

Therefore, the object function 
                           f
                         in Eq. (5) can be reformed to a system of linear equations of variable vector 
                           
                              
                                 
                                    V
                                 
                                 
                                    ROI
                                 
                              
                           
                        . Because function 
                           f
                         has a representation of a sparse matrix, we may use the sparse LU factorization [28] to efficiently solve the optimized 
                           
                              
                                 
                                    V
                                 
                                 
                                    ROI
                                 
                              
                           
                         in the linear system, which results in the transformed ROI mesh. The detailed process of solving the minimization problem in Eq. (1) can be found in Appendix 1.

Initial mesh segmentation based on the constraint set 
                           Ω
                         without 
                           
                              
                                 
                                    V
                                 
                                 
                                    contour
                                 
                              
                           
                         in Eq. (7) may result in the mismatches between the intersection polylines of the mesh and the true ROI boundaries on 2D transversal image planes in CT volume due to the lack of local boundary constraints (
                           
                              
                                 
                                    V
                                 
                                 
                                    contour
                                 
                              
                              )
                           
                         in 
                           Ω
                        . Thus, the constraint set 
                           Ω
                         needs to be updated before the next evolution of mesh deformation to achieve accurate segmentation. This constraints updating is performed automatically by adding targeting vertices (
                           
                              
                                 
                                    v
                                 
                                 i
                                 
                                    TC
                                 
                              
                           
                        ) selected from the local boundaries of a ROI into 
                           
                              
                                 
                                    V
                                 
                                 
                                    contour
                                 
                              
                           
                        , which are searched in the neighborhood of the initial intersection polylines.

Assuming that the boundary of a ROI is located in the neighborhood of the intersection polylines of the initial mesh on the 2D transversal images. This neighborhood is defined as a band on the transversal images centered by the intersection polylines of the initial mesh, as shown in Fig. 5
                        . The width of the band can be adjusted in terms of the size of the ROI. In our study, we set the band width to be 40pixels. The local boundary of a ROI will be detected by optimal-path searching within this local band.

A transversal CT image can be represented by a 2D weighted bi-directed graph, in which one node corresponds to a pixel in the image. Each node (pixel) has eight edges connecting to its neighborhood pixels, and each node and each edge has a related cost, respectively. A local ROI boundary on a transversal image plane is defined as the optimal path with the minimum cost between two corresponding nodes in the graph. We defined five cost functions on a node or an edge employing the forms similar to those described in [29].

The Laplacian zero-crossing is defined as the points with local maximal or minimal gradient magnitude, which corresponds to a boundary point. Thus, a node has a low cost if it is a zero-crossing point:
                              
                                 (10)
                                 
                                    
                                       
                                          S
                                          
                                             ZX
                                          
                                       
                                       (
                                       
                                          v
                                       
                                       )
                                       =
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         0
                                                         ;
                                                      
                                                   
                                                   
                                                      
                                                         if
                                                            
                                                         
                                                            ∇
                                                            2
                                                         
                                                         
                                                            
                                                               v
                                                            
                                                         
                                                         ⋅
                                                         
                                                            ∇
                                                            2
                                                         
                                                         
                                                            
                                                               u
                                                            
                                                         
                                                         <
                                                         0
                                                            
                                                         and
                                                            
                                                         |
                                                         
                                                            ∇
                                                            2
                                                         
                                                         
                                                            
                                                               v
                                                            
                                                         
                                                         |
                                                         <
                                                         |
                                                         
                                                            ∇
                                                            2
                                                         
                                                         
                                                            
                                                               u
                                                            
                                                         
                                                         |
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         1
                                                         ;
                                                      
                                                   
                                                   
                                                      
                                                         Otherwise
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           where, 
                              
                                 
                                    ∇
                                    2
                                 
                                 (
                                 )
                              
                            is the Laplacian operator, 
                              u
                            is a neighboring pixel of 
                              v
                           .

A large gradient magnitude tends to indicate a local boundary. Thus, a gradient magnitude is considered as the local cost of a boundary:
                              
                                 (11)
                                 
                                    
                                       
                                          S
                                          g
                                       
                                       
                                          
                                             
                                                v
                                             
                                             ,
                                             
                                                u
                                             
                                          
                                       
                                       =
                                       k
                                       (
                                       1
                                       −
                                       
                                          
                                             
                                                
                                                   ∇
                                                   
                                                      
                                                         u
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             max
                                             
                                                
                                                   |
                                                   ∇
                                                   (
                                                   
                                                      
                                                         u
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   )
                                                   |
                                                
                                             
                                          
                                       
                                       )
                                    
                                 
                              
                           where, 
                              
                                 ∇
                                 (
                                 )
                              
                            is the gradient operator, k is 1 if v and u are diagonal neighbors, and k is 
                              
                                 
                                    2
                                 
                              
                            if v and u are horizontal or vertical neighbors.

We assume that a local boundary is perpendicular to the gradient direction. Thus, the cost is low if the direction of an edge is perpendicular to the gradient direction of the pixel:
                              
                                 (12)
                                 
                                    
                                       
                                          S
                                          d
                                       
                                       
                                          
                                             
                                                v
                                             
                                             ,
                                             
                                                u
                                             
                                          
                                       
                                       =
                                       
                                          
                                             
                                                
                                                   
                                                      vu
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            vu
                                                         
                                                      
                                                   
                                                
                                             
                                             ×
                                             
                                                
                                                   ∇
                                                   
                                                      
                                                         v
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         ∇
                                                         
                                                            
                                                               v
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           where, u is a neighboring node of v.

Because the edge in the graph is bi-direction, we may define that the ROI region is located at the right side of the contour when walking through the contour in the clockwise direction. In order to separate a ROI region with low or high intensity compared to its background, we construct a cost function that compares the normal direction of the contour and the gradient direction:
                              
                                 (13)
                                 
                                    
                                       
                                          S
                                          c
                                       
                                       
                                          
                                             v
                                          
                                       
                                       =
                                       
                                          1
                                          2
                                       
                                       (
                                       1
                                       +
                                       k
                                       
                                          n
                                       
                                       ⋅
                                       
                                          
                                             ∇
                                             
                                                
                                                   v
                                                
                                             
                                          
                                          
                                             
                                                
                                                   ∇
                                                   
                                                      
                                                         v
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       )
                                    
                                 
                              
                           where, 
                              n
                            is the normal of the contour (see Fig. 6(b)), k is 1 for brighter ROI such as liver parenchyma (enhanced liver tissue is brighter than its neighborhood), and is −1 for darker ROI such as tumor (tumor tends to be darker than normal liver tissues). The default value of k is 1 and is set to −1 manually for tumor ROI.

Assume that a local ROI boundary has a similar profile. We define an iso-distance contour map (see Fig. 6) of a local contour: if two neighboring pixels are located at the same level of isocontour, its cost is low; otherwise the cost is high. The maximum isocontour value is defined as 8pixels and the minimum isocontour is −8pixels. The initial zero isocontour is the intersection polylines of the initial mesh. To normalize the cost, the value of the cost is divided by 16:
                              
                                 (14)
                                 
                                    
                                       
                                          S
                                          
                                             Iso
                                          
                                       
                                       
                                          
                                             
                                                v
                                             
                                             ,
                                             
                                                u
                                             
                                          
                                       
                                       =
                                       
                                          
                                             e
                                             
                                                
                                                   v
                                                
                                             
                                             −
                                             e
                                             (
                                             
                                                u
                                             
                                             )
                                          
                                       
                                       /
                                       16
                                    
                                 
                              
                           where, 
                              
                                 e
                                 
                                    
                                       v
                                    
                                 
                              
                            is the isocontour value at pixel 
                              v
                           .

The local cost function from vertex 
                              v
                            to vertex 
                              u
                            is the weighted sum of five aforementioned costs defined on vertex 
                              v
                            and edge 
                              vu
                           :
                              
                                 (15)
                                 
                                    
                                       S
                                       
                                          
                                             
                                                v
                                             
                                             ,
                                             
                                                u
                                             
                                          
                                       
                                       =
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               Σ
                                                            
                                                            
                                                               Cost
                                                            
                                                         
                                                         ,
                                                      
                                                   
                                                   
                                                      
                                                         if
                                                            
                                                         
                                                            u
                                                         
                                                         ,
                                                         
                                                            v
                                                         
                                                            
                                                         ∈
                                                            
                                                         B
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         ∞
                                                         ,
                                                      
                                                   
                                                   
                                                      
                                                         otherwise
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       ,
                                    
                                 
                              
                           where, 
                              
                                 
                                    
                                       Σ
                                    
                                    
                                       Cost
                                    
                                 
                                 =
                                 
                                    w
                                    
                                       ZX
                                    
                                 
                                 
                                    S
                                    
                                       ZX
                                    
                                 
                                 
                                    
                                       v
                                    
                                 
                                 +
                                 
                                    w
                                    g
                                 
                                 
                                    S
                                    g
                                 
                                 
                                    
                                       
                                          v
                                       
                                       ,
                                       
                                          u
                                       
                                    
                                 
                                 +
                                 
                                    w
                                    d
                                 
                                 
                                    S
                                    d
                                 
                                 
                                    
                                       
                                          v
                                       
                                       ,
                                       
                                          u
                                       
                                    
                                 
                                 +
                                 
                                    w
                                    c
                                 
                                 
                                    S
                                    C
                                 
                                 
                                    
                                       v
                                    
                                 
                                 +
                                 
                                    w
                                    
                                       Iso
                                    
                                 
                                 
                                    S
                                    
                                       Iso
                                    
                                 
                                 
                                    
                                       
                                          v
                                       
                                       ,
                                       
                                          u
                                       
                                    
                                 
                              
                           , 
                              v
                           ,
                              u
                            are two vertices located within the band 
                              B
                            shown in Fig. 5. We set w
                           ZX
                           =0.15, w
                           g
                           =0.15, w
                           d
                           =0.1, w
                           c
                           =0.5, and w
                           Iso
                           =0.1. These values were set empirically, which may be fine-tuned in different clinical applications and imaging modalities.

We use the dynamic-programming (DP) graph search algorithm [29] to search the local boundaries of a ROI within the band, such as the Dijkstra's algorithm or the A* algorithm [30]. To accelerate the searching of an optimal path with minimum cost, we employed an active list that sorts nodes by the total cost of starting nodes. This sorted active list takes computation time 
                              O
                            (N) for sorting of N nodes (pixels) [30].

The seed points 
                              
                                 (
                                 
                                    v
                                    i
                                    
                                       Seed
                                    
                                 
                                 )
                              
                            for searching the optimal path are selected on the intersection polyline at an interval of n pixels (n
                           =60 in our study). Contour optimization searches the optimal path with minimal cost between each pair of seed points 
                              
                                 
                                    
                                       
                                          v
                                          i
                                          
                                             Seed
                                          
                                       
                                       ,
                                       
                                          v
                                          
                                             i
                                             +
                                             1
                                          
                                          
                                             Seed
                                          
                                       
                                    
                                 
                              
                            by using Eq. (15) and then the resulting optimal paths are connected to form the optimized transversal contour 
                              
                                 
                                    C
                                    
                                       Opt
                                    
                                 
                              
                            of the ROI.

The local boundary constraints (
                              
                                 
                                    
                                       V
                                    
                                    
                                       contour
                                    
                                 
                              
                           ) in constraint set 
                              Ω
                            in Eq. (7) is updated by adding a set of boundary points that are selected from the optimized transversal contour 
                              
                                 
                                    C
                                    
                                       Opt
                                    
                                 
                              
                            as the constraint targeting vertices (
                              
                                 
                                    
                                       v
                                    
                                    i
                                    
                                       TC
                                    
                                 
                              
                           ). To ensure that the selected 
                              
                                 
                                    
                                       v
                                    
                                    i
                                    
                                       TC
                                    
                                 
                              
                            is at or near the boundary of the ROI, we applied the following selection criteria:
                              
                                 •
                                 The middle segment of each optimal path between 
                                       
                                          
                                             
                                                
                                                   v
                                                   i
                                                   
                                                      Seed
                                                   
                                                
                                                ,
                                                
                                                   v
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                   
                                                      Seed
                                                   
                                                
                                             
                                          
                                       
                                     is selected to reduce the influence of inaccurate positions of initial seed points.

For each point at the middle segment of a path, the vertex with the lowest cost is selected as the candidate of 
                                       
                                          
                                             
                                                v
                                             
                                             i
                                             
                                                TC
                                             
                                          
                                       
                                    .

All the 
                                       
                                          
                                             
                                                v
                                             
                                             i
                                             
                                                TC
                                             
                                          
                                       
                                     candidates on the transversal contour 
                                       
                                          
                                             C
                                             
                                                Opt
                                             
                                          
                                       
                                     are filtered to remove those that have a roof-edge, considering the segmented ROI has a step-edge.

Mesh transformation and contour optimization is performed in an iterative manner: mesh transformation initializes the transversal contours, and contour optimization updates the constraint targeting vertices for the refinement of the targeting mesh in the next iteration of mesh transformation. At each mesh transformation, ROI mesh is evolving from low to high resolution, as indicated by Eq. (1). This iteration between mesh transformation and contour optimization is repeated in a multi-resolution progressively-optimized manner to ensure an efficient and accurate approximation of the ROI mesh.

By applying the iterative mesh deformation algorithm, we developed a semi-automated segmentation scheme for diseased livers with cancer on CT images. The algorithmic steps of the semi-automated liver segmentation scheme are illustrated in Fig. 7
                     .

The mesh segmentation of a liver is initialized by five manually identified liver anatomical landmarks and a set of chest wall points 
                        
                           
                              
                                 V
                              
                              
                                 Chest
                              
                           
                        
                      that are detected automatically [31]. The five initial liver landmarks are illustrated in Fig. 8
                     , which are the liver top (superior) point 
                        
                           (
                           
                              v
                              t
                           
                           )
                        
                     , the liver bottom (inferior) point (
                        
                           
                              v
                              b
                           
                        
                     ), the liver posterior point (
                        
                           
                              v
                              p
                           
                        
                     ), the liver anterior point (
                        
                           
                              v
                              a
                           
                        
                     ), and the liver left point (
                        
                           
                              v
                              l
                           
                        
                     ), respectively. Because the right boundary of a liver is adjacent to the chest wall, a set of points at the boundaries of the chest wall is selected as the initial targeting constraint vertices, which are shown as the red points 
                        
                           
                              
                                 v
                              
                              i
                              c
                           
                        
                      in Fig. 8(a).

The initial homeomorphic sphere mesh for constructing 
                        M
                     
                     0 is built by setting the center at 
                        
                           
                              1
                              2
                           
                           (
                           
                              
                                 v
                              
                              t
                           
                           +
                           
                              
                                 v
                              
                              b
                           
                           )
                        
                      and the radius of 
                        
                           
                              1
                              2
                           
                           
                              
                                 
                                    
                                       v
                                    
                                    t
                                 
                                 −
                                 
                                    
                                       v
                                    
                                    b
                                 
                              
                           
                        
                     , as shown in Fig. 8(a). To establish the correspondence constraints 
                        
                           Ω
                        
                     , each targeting vertex on CT images (
                        
                           
                              
                                 v
                              
                              i
                              
                                 TC
                              
                           
                        
                      in Eq. (7)) needs to be mapped to the corresponding vertex on the sphere mesh, which is defined as the nearest vertex on the sphere mesh for each 
                        
                           
                              
                                 v
                              
                              i
                              
                                 TC
                              
                           
                        
                     , as shown in Fig. 8(a). By using the initial correspondence constraints 
                        
                           
                              
                                 Ω
                              
                              0
                           
                        
                     , the sphere mesh is deformed to the initial liver mesh 
                        
                           
                              
                                 M
                              
                              0
                           
                        
                      based on mesh transformation in Eq. (1). The resulting 
                        
                           
                              
                                 M
                              
                              0
                           
                        
                      is displayed in Fig. 8(b).

Because the deformed liver mesh 
                        
                           
                              
                                 M
                              
                              0
                           
                        
                      intersects with all transversal slices of CT images between the top and bottom landmarks, we may calculate a series of intersection polylines of the mesh on each transversal slice. These intersection polylines are re-sampled at an interval of 60pixels to generate a set of seed points (
                        
                           
                              
                                 v
                              
                              i
                              
                                 Seed
                              
                           
                        
                     ), shown as the red points in Fig. 9(a). Between each pair of neighboring seed points (
                        
                           
                              
                                 v
                              
                              i
                              
                                 Seed
                              
                           
                        
                     , 
                        
                           
                              
                                 v
                              
                              
                                 i
                                 +
                                 1
                              
                              
                                 Seed
                              
                           
                        
                     ), an optimal path with minimal cost is searched. The optimal transversal contour is created by connecting all the optimal paths between every pair of seed points (
                        
                           
                              
                                 v
                              
                              i
                              
                                 Seed
                              
                           
                        
                     , 
                        
                           
                              
                                 v
                              
                              
                                 i
                                 +
                                 1
                              
                              
                                 Seed
                              
                           
                        
                     ) on the transversal image, shown as the yellow lines in Fig. 9(b).

Due to the lack of local boundary constraint in 
                        
                           
                              
                                 Ω
                              
                              i
                           
                        
                     , the initial intersection polylines and the seed points 
                        
                           
                              
                                 v
                              
                              i
                              
                                 seed
                              
                           
                        
                      may not closely match the local liver boundary. By contour optimization, the updated transversal contours approximate more accurately to the local boundary than do the initial polylines, as shown the yellow lines in Fig. 9(a) and (b) respectively. Thus, we use the middle points (
                        
                           
                              v
                              i
                              
                                 mid
                              
                           
                        
                     ) of each optimal path as the targeting points and replace constraint set 
                        
                           
                              
                                 Ω
                              
                              
                                 i
                                 +
                                 1
                              
                           
                        
                      with them to refine the targeting vertices. Occasionally, in case that the 
                        
                           
                              v
                              i
                              
                                 mid
                              
                           
                        
                      is off the liver boundary, we may adjust or add or delete 
                        
                           
                              v
                              i
                              
                                 mid
                              
                           
                        
                      interactively. In general, approximately one to three pairs of extra correspondences may be needed for one case. Based on the updated constraint set 
                        
                           
                              
                                 Ω
                              
                              
                                 i
                                 +
                                 1
                              
                           
                        
                     , a new mesh 
                        
                           
                              
                                 M
                              
                              
                                 i
                                 +
                                 1
                              
                           
                        
                      is calculated using Eq. (1). Fig. 9(c) compares the difference between the updated mesh 
                        
                           
                              
                                 M
                              
                              
                                 i
                                 +
                                 1
                              
                           
                        
                      (red) and the initial mesh 
                        
                           
                              
                                 M
                              
                              i
                           
                        
                      (yellow).

@&#EXPERIMENTS AND RESULTS@&#

Forty (40) hepatic CT cases with biopsy-confirmed liver cancers or metastases were retrospectively collected for the evaluation of the accuracy and efficiency of our proposed semi-automated liver segmentation scheme. These hepatic CT cases were obtained by multi-detector CT scanners with the following parameter settings: 2.5–5mm collimation, 1.25–2.5mm reconstruction interval, 175mA tube current, and 120kVp tube voltage. All cases were acquired with use of an intra-venous contrast agent (ISOVUE; GE Healthcare, Milwaukee, WI).

The livers in these 40 hepatic CT cases were segmented manually by two radiologists in consensus on CT images. The volumetric size of these 40 cancerous livers ranged from 1079.2CC to 4652.3CC, in which the tumor volume percentages (ratio of tumor volume/liver volume) ranged from 1.77% to 53.54%. Some of these cases are shown in Fig. 1.

The manually-segmented liver volumes were compared with those obtained by the computerized liver volumes segmented by the proposed semi-automated scheme. The computerized liver volumes ranged from 1100.4CC to 4443.5CC.


                     Figs. 10–12
                     
                     
                      demonstrate some resulting images of three cases segmented by the proposed liver segmentation scheme. All these cases contain different sizes of tumors. Fig. 10 demonstrates a case that was finished without any additional changes of the seeding points, i.e. by using only five user-identified liver landmarks. Fig. 11 shows a case with a few manual adjustments on couple seed points on three slices. After the first run of the scheme, some seed points on the contours were adjusted manually by the user (see the upper row). After adjustments, the contours were finalized by the second run of the scheme (see the lower rower). Fig. 12 shows an example case with large tumors. After the initial mesh segmentation, nine seed points were adjusted manual for contour refinement. It takes less than 5min to get the result shown in Fig. 12.

We evaluated the performance of the proposed liver segmentation scheme by using the evaluation criterion proposed in [4], which includes five metrics: (1) VOE: volumetric overlap error (%), (2) RVD: relative absolute volume difference (%), (3) ASD: average symmetric surface distance (unit: mm), (4) RSD: root-mean-square of symmetric surface distance (unit: mm), and (5) MSD: maximum symmetric surface distance (unit: mm). According to the criterion [4], a score of 75 is “comparable to human performance” of liver segmentation, which corresponds to VOE=6.4%, RVD=4.7%, ASD=1.0mm, RSD=1.8mm, and MSD=19mm.

The evaluated performance of the proposed scheme is listed in Table 2
                     . Our proposed liver segmentation achieved the average score of 84.75±3.69. This implies that the accuracy of the proposed liver segmentation scheme is superior to that of averaged “human performance”. In average, the proposed semi-automated liver scheme took approximately 5min including about 2min of computing time. It demonstrates that our scheme is accurate and efficient in segmentation of livers considering that our study used diseased liver cases with pathologies including cancers and metastases, which are in general difficult cases compared to those healthy liver cases (such as liver donor cases in transplantation) in the literatures.

In order to compare our method with other existing liver segmentation methods in terms of accuracy, running time, ease of use, and consistency, we selected five semi-automated or interactive liver segmentation methods from open-source segmentation software ITK Snap (www.itksnap.org) and Seg3D (www.sci.utah.edu/cibc-software/seg3d.html), and compared our method with these five selected methods by using 10 liver cases downloaded from MICCAI database (www.sliver07.org). We conducted a user study by evaluating the performance of these methods in two user groups: (1) the novice group of five college students, and (2) the expert group of five 3D imaging analysts in radiology department. After one day training of these tools, each participant finished the 10 MICCAI cases using five selected tools as well as our tool. Because interactive manual segmentation methods tends to outperform semi-automated or automated segmentation methods at a high cost of time and effort, all participant were required to apply the same criteria of accuracy in the evaluation of each method. We compared the accuracy scores, the running time, and the easy-of-use index of each method in two groups. The result is showed in Table 3
                     .

The average accuracy scores of all methods were approximately 80, which indicate the similar levels of accuracy for all tested methods. Compared with the five selected liver segmentation methods, our method demonstrated the highest level of easy-of-use as that of manual contouring, but took only about 5min for finishing a liver segmentation task, which was much more efficient than other methods, in particular about 30–40min for the manual contouring methods. Overall, the expert group outperformed the novice group with higher accuracy score (80.3 vs 79.6) and shorter running time (21.2 vs 30.3). However, we observed that the running time in our method was almost constant in both groups, whereas it was approximately 10min less (about 25%–35%) in expert group than that in novice group for other methods. The low standard deviation of our methods indicate that our liver segmentation scheme achieved a consistent accuracy score among different user groups

@&#DISCUSSION AND CONCLUSION@&#

The proposed semi-automated liver segmentation scheme based on iterative mesh transformation combines the advantages of 3D shape continuity and slice-to-slice constraints to achieve a quick and accurate segmentation with minimal user interaction. From our user study, we observed that our method is quicker and more consistent than other methods in both user groups. This outperformance of our method may result from the algorithm and user familiarity with our method.
                        
                           •
                           The energy-based contour deformable models (such as snakes) requires that the distances between the initial contours (or mesh) and the resulting contours (or mesh) of a ROI must be sufficiently small. User needs to manually initialize contours on each slice in the neighborhood of ROI or use interpolation to estimate the initial contours. The former may increase the interaction time and the latter is prone-to errors which may increase the error-correction time. In addition, deformable models tend to run a large number of iterations such as 100 or 200 iterations to approximate the contours or mesh of a ROI in images.

Different from energy-based deformation models, 3D mesh transformation model relies on small number of targeting vertices, five landmarks (feature points) in our liver segmentation scheme, to approximate the initial mesh of a ROI. The sparse LU factorization algorithm is very efficient to solve the minimization of the objective function (solve the resulting mesh) and contour optimization also takes O(NLogN) to find the optimized ROI contours on each image. In addition, the mesh is updated automatically every time when user corrects one vertex on a contour, i.e. the error-correcting is propagated to neighboring contours, which may substantially reduce the error-correcting time.

We had to admit that the authors and the participants in the user study were more familiar with the features of our software than those of other tools. This may cause bias to the user study, in particular the user time. The running time in Table 3 relies on the experience of the image analyst and their familiarity to the software to certain degree. The results might not reflect the best performance of these selected methods.

We acknowledge that the proposed iterative liver segmentation method and the evaluation study have four major limitations.
                        
                           (1)
                           Mapping between a sphere mesh and a ROI boundary: The mesh transformation is established based on the one-to-one homeomorphic mapping between a sphere mesh and a ROI boundary. This assumption of continuous one-to-one mapping may not be easily held in the case of a concave or convex boundary, as shown in Fig. 13(a). Because the ROI contour is searched within the band centered by the intersection polyline of the transformed mesh, the resulting contour may miss the concave hole if the band cannot cover the entire hole, as shown in Fig. 13(b). Our current solution relies on interactive adding of a targeting point to cover the concave hole. In future, we will replace the sphere mesh with an initial liver mesh that has the same topology including these major concave holes.

Parameter setting: There are several important parameters in our liver segmentation scheme that were set empirically, such as the weights in Eqs. (1), (5) and (15). We did not explore the possibility to optimize them further in this study because an optimal setting of the parameters may be related to the specific liver scanning protocols. Thus, we chose the parameters to be general, not optimized for our specific liver scanning protocol. Another important parameter is the bandwidth for searching 2D optimal contours. In our current implementation, we used a bandwidth of 40pixels in each iteration for simplicity. A large bandwidth may erroneously take the neighboring large gradient boundaries such as bone as the liver boundaries, as pointed by the white arrows in Fig. 13(b). An ideal solution is to adjust the bandwidth parameter at each iteration: from a large bandwidth at initial iteration to a small bandwidth at the final iteration.

User interaction: In comparison to previous semi-automated segmentation methods, our method reduced the user-interaction to as little as identification of five landmarks. However, users interaction is still needed to review and adjust targeting points on 2D transversal contours after each iteration, in particular at first or second iterations. This is the major interaction time spent in our current segmentation scheme. In future, this interactive identification of five landmarks may be lifted by automated landmark labeling and neighboring organs segmentation. In addition, the selection of constraint targeting points on transversal contours will be refined to minimize the constraint set with the most salient features on the contours.

Evaluation study: The hepatic CT images for evaluation were retrospectively collected from a radio-chemotherapy study for patients with primary liver cancer or metastasis, and scanned with our institutional abdominal imaging protocol by using an intra-venous contrast agent. These cancer cases may present different texture patterns compared to other liver pathologies such as fatty liver or cirrhosis, and other liver imaging protocols. Further evaluation is required to apply this proposed liver segmentation scheme to hepatic CT images with other liver pathologies.

In summary, we proposed a semi-automated segmentation scheme for diseased livers with cancers based on an iterative mesh transformation constrained by optimal transversal contours. The initial evaluation demonstrated that this semi-automated liver segmentation scheme can achieve an accurate and efficient 3D segmentation for diseased livers by using as little as five user-identified landmarks and an average of 5min. Although this scheme was developed in the context of segmentation of diseased liver with tumors in hepatic CT images, this method may provide a general scheme for semi-automated segmentation of other organs or tumors.

@&#ACKNOWLEDGMENTS@&#

The authors thank Jeffrey Clark, MD, Anand Singh, MD, and Jennifer McGowan, RT from Department of Radiology at Massachusetts General Hospital for technical discussion, evaluation and statistical assistance with this manuscript.

Based on Eq. (1) in Section II, mesh transformation is a minimization problem to solve the objective function 
                        
                           
                              f
                           
                           
                              
                                 
                                    
                                       M
                                    
                                    i
                                 
                              
                           
                        
                      formed by the weighted sum of three constraints: the smoothing constraint (
                        C
                     
                     
                        
                           S
                        
                     : Eq. (6)), the deforming constraint (
                        C
                     
                     
                        
                           D
                        
                     : Eq. (7)), and the distance constraint (
                        C
                     
                     
                        
                           L
                        
                     : Eq. (8)).

For an edge 
                        E
                     
                     
                        j
                     , let the four vertices around 
                        E
                     
                     
                        j
                      be 
                        
                           
                              
                                 v
                              
                              
                                 
                                    E
                                    j
                                 
                                 [
                                 x
                                 ]
                              
                           
                        
                     , where 
                        
                           
                              E
                              j
                           
                           
                              x
                           
                        
                      is the index of the vertices in the mesh, 
                        
                           
                              x
                           
                           =
                           1
                           −
                           4
                        
                     . Let 
                        
                           
                              t
                              
                                 
                                    E
                                    j
                                 
                              
                              
                                 (
                                 r
                                 ,
                                 c
                                 )
                              
                           
                        
                      be the element (r, c) of the 
                        
                           3
                           ×
                           3
                        
                      matrix 
                        
                           
                              
                                 
                                    
                                       
                                          
                                             T
                                          
                                          
                                             S
                                          
                                       
                                    
                                 
                              
                              
                                 −
                                 1
                              
                           
                        
                      in Eq. (4), where r, c
                     =1–3. Eq. (6) can be represented in the vector form of 
                        
                           
                              
                                 v
                              
                              i
                              
                                 R
                                 O
                                 I
                              
                           
                        
                     , shown in Eq. (A.1).
                        
                           (A.1)
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   C
                                                
                                                
                                                   S
                                                
                                             
                                             
                                                
                                                   M
                                                
                                             
                                             =
                                             
                                                ∑
                                                
                                                   
                                                      
                                                         
                                                            
                                                               i
                                                               =
                                                               1
                                                               ,
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     Z
                                                                  
                                                                  
                                                                     i
                                                                  
                                                               
                                                               ∈
                                                               Z
                                                               
                                                                  
                                                                     M
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   |
                                                   
                                                      Z
                                                   
                                                   
                                                      
                                                         M
                                                      
                                                   
                                                   |
                                                
                                             
                                             
                                                
                                                   ∑
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  j
                                                                  ≠
                                                                  k
                                                                  =
                                                                  1
                                                                  ,
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        E
                                                                     
                                                                     j
                                                                  
                                                                  ∈
                                                                  
                                                                     E
                                                                  
                                                                  (
                                                                  
                                                                     
                                                                        Z
                                                                     
                                                                     
                                                                        i
                                                                     
                                                                  
                                                                  )
                                                                  ,
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        E
                                                                     
                                                                     k
                                                                  
                                                                  ∈
                                                                  
                                                                     E
                                                                  
                                                                  (
                                                                  
                                                                     
                                                                        Z
                                                                     
                                                                     
                                                                        i
                                                                     
                                                                  
                                                                  )
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   3
                                                
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  T
                                                               
                                                               (
                                                               
                                                                  
                                                                     E
                                                                  
                                                                  j
                                                               
                                                               )
                                                               −
                                                               
                                                                  T
                                                               
                                                               
                                                                  
                                                                     
                                                                        
                                                                           E
                                                                        
                                                                        k
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                      F
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             =
                                             
                                                ∑
                                                
                                                   
                                                      
                                                         
                                                            
                                                               i
                                                               =
                                                               1
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     Z
                                                                  
                                                                  
                                                                     i
                                                                  
                                                               
                                                               ∈
                                                               Z
                                                               
                                                                  
                                                                     M
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   |
                                                   
                                                      Z
                                                   
                                                   
                                                      
                                                         M
                                                      
                                                   
                                                   |
                                                
                                             
                                             
                                                
                                                   ∑
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  j
                                                                  ≠
                                                                  k
                                                                  =
                                                                  1
                                                                  ,
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        E
                                                                     
                                                                     
                                                                        j
                                                                     
                                                                  
                                                                  ∈
                                                                  E
                                                                  (
                                                                  
                                                                     
                                                                        Z
                                                                     
                                                                     
                                                                        i
                                                                     
                                                                  
                                                                  )
                                                                  ,
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        E
                                                                     
                                                                     
                                                                        k
                                                                     
                                                                  
                                                                  ∈
                                                                  
                                                                     E
                                                                  
                                                                  (
                                                                  
                                                                     
                                                                        Z
                                                                     
                                                                     
                                                                        i
                                                                     
                                                                  
                                                                  )
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      3
                                                   
                                                
                                                
                                                   
                                                      ∑
                                                      
                                                         c
                                                         =
                                                         1
                                                      
                                                      3
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               ∑
                                                               
                                                                  r
                                                                  =
                                                                  1
                                                               
                                                               3
                                                            
                                                            
                                                               
                                                                  t
                                                                  
                                                                     
                                                                        E
                                                                        j
                                                                     
                                                                  
                                                                  
                                                                     
                                                                        
                                                                           r
                                                                           ,
                                                                           c
                                                                        
                                                                     
                                                                  
                                                               
                                                               (
                                                               
                                                                  
                                                                     v
                                                                  
                                                                  
                                                                     
                                                                        E
                                                                        j
                                                                     
                                                                     
                                                                        
                                                                           r
                                                                           +
                                                                           1
                                                                        
                                                                     
                                                                  
                                                                  
                                                                     ROI
                                                                  
                                                               
                                                               −
                                                               
                                                                  
                                                                     v
                                                                  
                                                                  
                                                                     
                                                                        E
                                                                        j
                                                                     
                                                                     [
                                                                     1
                                                                     ]
                                                                  
                                                                  
                                                                     ROI
                                                                  
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             −
                                             
                                                
                                                   
                                                      
                                                         
                                                            ∑
                                                            
                                                               r
                                                               =
                                                               1
                                                            
                                                            3
                                                         
                                                         
                                                            
                                                               t
                                                               
                                                                  
                                                                     E
                                                                     k
                                                                  
                                                               
                                                               
                                                                  
                                                                     
                                                                        r
                                                                        ,
                                                                        c
                                                                     
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  
                                                                     
                                                                        v
                                                                     
                                                                     
                                                                        
                                                                           E
                                                                           k
                                                                        
                                                                        
                                                                           
                                                                              r
                                                                              +
                                                                              1
                                                                           
                                                                        
                                                                     
                                                                     
                                                                        ROI
                                                                     
                                                                  
                                                                  −
                                                                  
                                                                     
                                                                        v
                                                                     
                                                                     
                                                                        
                                                                           E
                                                                           k
                                                                        
                                                                        [
                                                                        1
                                                                        ]
                                                                     
                                                                     
                                                                        ROI
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                                2
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     
                  

Let N
                     S, N
                     D, N
                     L be the numbers of the items in Eqs. (A.1), (7) and (8), respectively. 
                        
                           
                              N
                              s
                           
                           =
                           
                              
                                 
                                    Z
                                 
                                 (
                                 
                                    M
                                 
                                 )
                              
                           
                           ×
                           3
                           ×
                           3
                        
                     , 
                        
                           
                              N
                              D
                           
                           =
                           
                              
                                 Ω
                              
                           
                        
                     , 
                        
                           
                              N
                              L
                           
                           =
                           
                              
                                 
                                    E
                                 
                                 (
                                 
                                    M
                                 
                                 )
                              
                           
                        
                     , where 
                        
                           
                              
                                 
                                    Z
                                 
                                 (
                                 
                                    M
                                 
                                 )
                              
                           
                        
                      is the number of triangle faces, 
                        
                           
                              
                                 Ω
                              
                           
                        
                      is the number of targeting constraint vertices in the constraint set, and 
                        
                           
                              
                                 
                                    E
                                 
                                 (
                                 
                                    M
                                 
                                 )
                              
                           
                        
                      is the number of edges in the mesh.

Therefore, the three constraints 
                        
                           
                              
                                 C
                              
                              *
                           
                        
                      (*
                     =
                     S,D,L) can be represented by a linear system:
                        
                           (A.2)
                           
                              
                                 
                                    
                                       C
                                    
                                    *
                                 
                                 =
                                 
                                    ∑
                                    
                                       ξ
                                       =
                                       1
                                    
                                    
                                       
                                          N
                                          *
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      A
                                                   
                                                   *
                                                
                                                
                                                   V
                                                
                                                +
                                                
                                                   
                                                      B
                                                   
                                                   *
                                                
                                             
                                          
                                       
                                       
                                          F
                                       
                                       2
                                    
                                 
                                 ,
                              
                           
                        
                     where, 
                        A
                     
                     * is an 
                        
                           
                              N
                              *
                           
                           ×
                           n
                        
                      matrix, n is the number of vertices in the mesh, and 
                        B
                     
                     * is an 
                        
                           
                              N
                              *
                           
                           ×
                           1
                        
                      vector. For the smooth constraint 
                        C
                     
                     
                        
                           S
                        
                     , based on Eq. (A.1), 
                        B
                     
                     
                        
                           S
                        
                      is a zero vector and 
                        A
                     
                     
                        
                           S
                        
                      is a sparse matrix as shown in Fig. A.1
                     .

The non-zero elements in 
                        A
                     
                     
                        
                           S
                        
                      can be calculated from Eq. (A.1):
                        
                           (A.3)
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   e
                                                
                                                
                                                   j
                                                
                                             
                                             [
                                             1
                                             ]
                                             =
                                             −
                                             
                                                ∑
                                                
                                                   r
                                                   =
                                                   1
                                                
                                                3
                                             
                                             
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      
                                                         
                                                            E
                                                         
                                                         
                                                            j
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               r
                                                            
                                                            ,
                                                            
                                                               c
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             ,
                                          
                                       
                                       
                                          
                                             
                                                
                                                   e
                                                
                                                
                                                   j
                                                
                                             
                                             [
                                             
                                                i
                                             
                                             ]
                                             =
                                             
                                                
                                                   t
                                                
                                                
                                                   
                                                      
                                                         E
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            i
                                                         
                                                         −
                                                         1
                                                         ,
                                                         
                                                            c
                                                         
                                                      
                                                   
                                                
                                             
                                             ,
                                             
                                                i
                                             
                                             =
                                             2,3,4.
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   e
                                                
                                                
                                                   k
                                                
                                             
                                             [
                                             1
                                             ]
                                             =
                                             
                                                ∑
                                                
                                                   r
                                                   =
                                                   1
                                                
                                                3
                                             
                                             
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      
                                                         
                                                            E
                                                         
                                                         
                                                            k
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               r
                                                            
                                                            ,
                                                            
                                                               c
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             ,
                                          
                                       
                                       
                                          
                                             
                                                
                                                   e
                                                
                                                
                                                   k
                                                
                                             
                                             [
                                             
                                                i
                                             
                                             ]
                                             =
                                             −
                                             
                                                
                                                   t
                                                
                                                
                                                   
                                                      
                                                         E
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            i
                                                         
                                                         −
                                                         1
                                                         ,
                                                         
                                                            c
                                                         
                                                      
                                                   
                                                
                                             
                                             ,
                                             
                                                i
                                             
                                             =
                                             2,3,4.
                                          
                                       
                                    
                                 
                              
                           
                        
                     
                  

For the deforming constraint 
                        
                           
                              
                                 C
                              
                              
                                 D
                              
                           
                        
                     , 
                        A
                     
                     
                        D
                      and 
                        B
                     
                     
                        D
                      in the form of linear system of Eq. (A.1) can be represented in Fig. A.2
                     . For the distance constraint 
                        
                           
                              
                                 C
                              
                              
                                 L
                              
                           
                        
                     , 
                        A
                     
                     
                        
                           L
                        
                      and 
                        B
                     
                     
                        
                           L
                        
                      are shown in Fig. A.3
                     .

The distribution of the non-zero elements in 
                        
                           
                              
                                 A
                              
                              *
                           
                        
                      and 
                        
                           
                              
                                 B
                              
                              *
                           
                        
                      (Fig. A.1, Fig. A.2 and Fig. A.3) indicates that: 
                        
                           
                              
                                 
                                    
                                       
                                          
                                             A
                                          
                                          
                                             i
                                          
                                          *
                                       
                                    
                                 
                              
                              
                                 T
                              
                           
                           
                              
                                 B
                              
                              
                                 j
                              
                              *
                           
                           =
                           0
                           (
                           i
                           ≠
                           j
                           )
                        
                     . Thus, Eq. (A.2) can be rewritten as:
                        
                           (A.4)
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   C
                                                
                                                *
                                             
                                             =
                                             
                                                ∑
                                                ξ
                                                
                                                   
                                                      N
                                                      *
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  A
                                                               
                                                               ξ
                                                               *
                                                            
                                                            
                                                               
                                                                  V
                                                               
                                                               
                                                                  ROI
                                                               
                                                            
                                                            +
                                                            
                                                               
                                                                  B
                                                               
                                                               ξ
                                                               *
                                                            
                                                         
                                                      
                                                   
                                                   F
                                                   2
                                                
                                             
                                             =
                                             
                                                ∑
                                                ξ
                                                
                                                   
                                                      N
                                                      *
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        A
                                                                     
                                                                     ξ
                                                                     *
                                                                  
                                                                  
                                                                     
                                                                        V
                                                                     
                                                                     
                                                                        ROI
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            T
                                                         
                                                      
                                                      +
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        B
                                                                     
                                                                     ξ
                                                                     *
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            T
                                                         
                                                      
                                                   
                                                
                                                ⋅
                                                
                                                   
                                                      
                                                         
                                                            A
                                                         
                                                         ξ
                                                         *
                                                      
                                                      
                                                         
                                                            V
                                                         
                                                         
                                                            ROI
                                                         
                                                      
                                                      +
                                                      
                                                         
                                                            B
                                                         
                                                         ξ
                                                         *
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             =
                                             
                                                ∑
                                                ξ
                                                
                                                   
                                                      N
                                                      *
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        V
                                                                     
                                                                     
                                                                        ROI
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                         T
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        A
                                                                     
                                                                     ξ
                                                                     *
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            T
                                                         
                                                      
                                                      
                                                         
                                                            A
                                                         
                                                         ξ
                                                         *
                                                      
                                                      
                                                         
                                                            V
                                                         
                                                         
                                                            ROI
                                                         
                                                      
                                                      +
                                                      
                                                         
                                                            V
                                                         
                                                         
                                                            
                                                               ROI
                                                               
                                                                   
                                                                  T
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        A
                                                                     
                                                                     ξ
                                                                     *
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            T
                                                         
                                                      
                                                      
                                                         
                                                            B
                                                         
                                                         ξ
                                                         *
                                                      
                                                      +
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        B
                                                                     
                                                                     ξ
                                                                     *
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            T
                                                         
                                                      
                                                      
                                                         
                                                            A
                                                         
                                                         ξ
                                                         *
                                                      
                                                      
                                                         
                                                            V
                                                         
                                                         
                                                            ROI
                                                         
                                                      
                                                      +
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        B
                                                                     
                                                                     ξ
                                                                     *
                                                                  
                                                               
                                                            
                                                         
                                                         
                                                            T
                                                         
                                                      
                                                      
                                                         
                                                            B
                                                         
                                                         ξ
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     
                  

The partial derivatives of 
                        C
                     
                     * is:
                        
                           (A.5)
                           
                              
                                 
                                    
                                       ∂
                                       
                                          
                                             C
                                          
                                          *
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             V
                                          
                                          
                                             ROI
                                          
                                       
                                    
                                 
                                 =
                                 2
                                 
                                    ∑
                                    ξ
                                    
                                       
                                          N
                                          *
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      A
                                                   
                                                   ξ
                                                   *
                                                
                                             
                                          
                                       
                                       
                                          T
                                       
                                    
                                    
                                       
                                          A
                                       
                                       ξ
                                       *
                                    
                                 
                                 
                                    
                                       V
                                    
                                    
                                       ROI
                                    
                                 
                                 +
                                 2
                                 
                                    ∑
                                    ξ
                                    
                                       
                                          N
                                          *
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      A
                                                   
                                                   ξ
                                                   *
                                                
                                             
                                          
                                       
                                       
                                          T
                                       
                                    
                                    
                                       
                                          B
                                       
                                       ξ
                                       *
                                    
                                 
                              
                           
                        
                     
                  

Thus, the partial derivatives of 
                        f
                      has the form below:
                        
                           (A.6)
                           
                              
                                 
                                    
                                       ∂
                                       
                                          f
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             V
                                          
                                          
                                             ROI
                                          
                                       
                                    
                                 
                                 =
                                 2
                                 
                                    
                                       
                                          
                                             w
                                          
                                          
                                             S
                                          
                                       
                                       
                                          ∑
                                          ξ
                                          
                                             
                                                
                                                   N
                                                
                                                
                                                   S
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            A
                                                         
                                                         ξ
                                                         
                                                            S
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                T
                                             
                                          
                                          
                                             
                                                A
                                             
                                             ξ
                                             
                                                S
                                             
                                          
                                       
                                       +
                                       
                                          
                                             w
                                          
                                          
                                             D
                                          
                                       
                                       
                                          ∑
                                          ξ
                                          
                                             
                                                
                                                   N
                                                
                                                
                                                   D
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            A
                                                         
                                                         ξ
                                                         
                                                            D
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                T
                                             
                                          
                                          
                                             
                                                A
                                             
                                             ξ
                                             
                                                D
                                             
                                          
                                       
                                       +
                                       
                                          
                                             w
                                          
                                          
                                             L
                                          
                                       
                                       
                                          ∑
                                          ξ
                                          
                                             
                                                
                                                   N
                                                
                                                
                                                   L
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            A
                                                         
                                                         ξ
                                                         
                                                            L
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                T
                                             
                                          
                                          
                                             
                                                A
                                             
                                             ξ
                                             
                                                L
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       V
                                    
                                    
                                       ROI
                                    
                                 
                                 +
                                 2
                                 
                                    
                                       
                                          
                                             w
                                          
                                          
                                             S
                                          
                                       
                                       
                                          ∑
                                          ξ
                                          
                                             
                                                
                                                   N
                                                
                                                
                                                   S
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            A
                                                         
                                                         ξ
                                                         
                                                            S
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                T
                                             
                                          
                                          
                                             
                                                B
                                             
                                             ξ
                                             
                                                S
                                             
                                          
                                       
                                       +
                                       
                                          
                                             w
                                          
                                          
                                             D
                                          
                                       
                                       
                                          ∑
                                          ξ
                                          
                                             
                                                
                                                   N
                                                
                                                
                                                   D
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            A
                                                         
                                                         ξ
                                                         
                                                            D
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                T
                                             
                                          
                                          
                                             
                                                B
                                             
                                             ξ
                                             
                                                D
                                             
                                          
                                       
                                       +
                                       
                                          
                                             w
                                          
                                          
                                             L
                                          
                                       
                                       
                                          ∑
                                          ξ
                                          
                                             
                                                
                                                   N
                                                
                                                
                                                   L
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            A
                                                         
                                                         ξ
                                                         
                                                            L
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                T
                                             
                                          
                                          
                                             
                                                B
                                             
                                             ξ
                                             
                                                L
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     
                  

Finally, the minimization problem in Eq. (1) can be solved by evaluating the following equation:
                        
                           (A.7)
                           
                              
                                 
                                    
                                       ∂
                                       
                                          w
                                          0
                                       
                                       
                                          f
                                       
                                       
                                          
                                             
                                                
                                                   M
                                                
                                                0
                                             
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             V
                                          
                                          
                                             ROI
                                          
                                       
                                    
                                 
                                 +
                                 
                                    
                                       ∂
                                       
                                          w
                                          1
                                       
                                       
                                          f
                                       
                                       
                                          
                                             
                                                
                                                   M
                                                
                                                1
                                             
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             V
                                          
                                          
                                             ROI
                                          
                                       
                                    
                                 
                                 +
                                 ⋯
                                 +
                                 
                                    
                                       ∂
                                       
                                          w
                                          θ
                                       
                                       
                                          f
                                       
                                       
                                          
                                             
                                                
                                                   M
                                                
                                                
                                                   θ
                                                
                                             
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             V
                                          
                                          
                                             ROI
                                          
                                       
                                    
                                 
                                 =
                                 0
                              
                           
                        
                     
                  

In terms of Eq. (A.6), Eq. (A.7) can be converted to a standard vector-formed linear system, which can be solved by using the sparse LU factorization algorithm [28].

Supplementary data associated with this article can be found, in the online version, at http://dx.doi.org/10.1016/j.compmedimag.2015.01.006.


                     
                        
                           
                        
                     
                  

@&#REFERENCES@&#

