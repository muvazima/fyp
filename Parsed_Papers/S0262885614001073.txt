@&#MAIN-TITLE@&#Accelerometer-based correction of skewed horizon and keystone distortion in digital photography

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           On-board accelerometers make feasible perspective correction in digital photography.


                        
                        
                           
                           Perspective correction is obtained with no human intervention.


                        
                        
                           
                           Perspective correction can be applied also to zoom lenses.


                        
                        
                           
                           Accelerometer calibration is necessary to get high accuracy.


                        
                        
                           
                           Accelerometer pose has to be estimated carefully to get high accuracy.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Accelerometer

Perspective correction

Keystone

Horizon

Digital photography

Sensor fusion

Noise propagation

@&#ABSTRACT@&#


               
               
                  Improper camera orientation produces convergent vertical lines (keystone distortion) and skewed horizon lines (horizon distortion) in digital pictures; an a-posteriori processing is then necessary to obtain appealing pictures. We show here that, after accurate calibration, the camera on-board accelerometer can be used to automatically generate an alternative perspective view from a virtual camera, leading to images with residual keystone and horizon distortions that are essentially imperceptible at visual inspection. Furthermore, we describe the uncertainty on the position of each pixel in the corrected image with respect to the accelerometer noise. Experimental results show a similar accuracy for a smartphone and for a digital reflex camera. The method can find application in customer imaging devices as well as in the computer vision field, especially when reference vertical and horizontal features are not easily detectable in the image.
               
            

@&#INTRODUCTION@&#

Photographic images may be affected by perspective distortions due to the attitude of the camera with respect to the depicted object. For instance, when the picture of a building is taken from the ground, the entire facade rarely fits into the frame without tilting the camera: the vertical lines appear then convergent in the acquired picture (keystone distortion, Fig. 1c). Similarly, a rolled camera leads to a skewed horizon line (horizon distortion, Fig. 1b).

Because of the poor appeal of images affected by perspective distortion (Fig. 1d), camera and lens manufacturers produce tilt-shift (TS) lenses [1,2], whose optical elements are manually shifted and tilted until a satisfying perspective is achieved. However, because of the cost and difficulty to use them, TS lenses are employed only by professional photographers in particular contexts (e.g. architectural photography). A simpler and cheaper solution is a-posteriori processing through widely diffused softwares like Photoshop [3], Gimp [4] or Hugin [5]. These apply a perspective transformation to the picture, whose parameters can be reliably estimated only if reference vertical and horizontal features are present in the picture and manually localized with high accuracy. More refined approaches automatically extract vertical and horizontal lines in man-made environments and have been exploited for texture map acquisition and metric measurements [6], camera calibration and 3D reconstruction from a single view [7], robotic navigation [8], perspective correction for documents [9] or digital photography [10]. The accuracy depends in any case on the accuracy on the estimated vanishing points [7]. In [11] the uncertainty on the automatically extracted vanishing points is minimized through the definition of a proper cost function, but the method cannot work if straight lines are not present, as in a portrait or a mountain view.

Integration of inertial sensors and vision systems has been explored to overcome this issue. For instance, after combined calibration of camera and inertial sensors [12–14], the gravity force is used as a reference to improve robot navigation [8,15] or for automotive applications [16]. In [17], accelerometer data and local invariant image features are used to estimate the camera pose and insert virtual objects into the scene, whereas in [18] the camera pose is estimated through the accelerometer to facilitate panorama imaging from multiple views. Accelerometers are used in [19] to estimate the camera pose and vibrations and consequently correct perspective and blur. A method to fully correct the perspective distortions using an accelerometer as a tilt sensor and the camera autofocus system as a distance measurement system is also described in [20].

Despite the large literature, on-board perspective correction is nowadays not present in digital cameras yet. This fact can be explained considering that accelerometer noise and imprecise calibration [17,18,21,22], as well as imprecise estimate of the orientation of the accelerometer with respect to the imaging sensor [8,12,14,15,23], may bias the estimated camera attitude. Here we show that an accurate system calibration makes automatic perspective correction feasible with high accuracy; furthermore, we show how to estimate the uncertainty of the position of each pixel in the corrected picture. The method was tested on a smartphone and on a digital reflex camera equipped with a zoom lens, with or without auto-focus enabled, leading in all cases to images with residual keystone and horizon distortion which are practically imperceptible at visual inspection.

@&#METHOD@&#

The method is based on estimating the pose of the camera from the output of the on-board accelerometer. The accelerometer calibration procedure in [22] is first applied; a set of images of a checkerboard is then taken from different points of view, measuring at the same time the accelerometer output. These data are used for traditional camera calibration [24] and to compute the rotation matrix R
                     
                        Acc
                     
                     
                        Cam
                      describing the orientation of the accelerometer with respect to the camera sensor plane (camera-accelerometer calibration, see Fig. 2
                     ), through an approach similar to the one described in [13]. After accelerometer and camera-accelerometer calibration, the camera attitude can be estimated for every acquired picture and an alternative perspective view can be generated. If zoom lenses are used, the proposed method still applies, using interpolation to estimate the camera internal parameters at every zoom focal length.

Let us define V
                        
                           i
                        
                        =[V
                        
                           x,i
                        
                        V
                        
                           y,i
                        
                        V
                        
                           z,i
                        ]
                           T
                         the accelerometer voltage output and 
                           
                              
                                 
                                    
                                       g
                                       Acc
                                    
                                    i
                                 
                              
                              =
                              
                                 
                                    
                                       
                                          
                                             g
                                             
                                                x
                                                ,
                                                i
                                             
                                          
                                          
                                             g
                                             
                                                y
                                                ,
                                                i
                                             
                                          
                                          
                                             g
                                             
                                                z
                                                ,
                                                i
                                             
                                          
                                       
                                    
                                    T
                                 
                              
                           
                         the corresponding acceleration vector measured by the accelerometer. These are related by [21,22]:
                           
                              (1)
                              
                                 
                                    
                                       
                                          
                                             g
                                             Acc
                                          
                                          i
                                       
                                    
                                    =
                                    
                                       S
                                       
                                          −
                                          1
                                       
                                    
                                    
                                       
                                          
                                             V
                                             i
                                          
                                          
                                             
                                                V
                                                CC
                                             
                                             −
                                             O
                                          
                                       
                                    
                                    ,
                                 
                              
                           
                        where VCC
                         is the voltage power supply, O
                        =[O
                        
                           x
                        
                        O
                        
                           y
                        
                        O
                        
                           z
                        ]
                           T
                         is the offset vector and S
                        ={S
                        
                           ij
                        }
                           i,j
                           =
                           x,y,z
                         the sensitivity matrix. S and O are estimated through the method in [22], which automatically selects the best model (scalar, diagonal or symmetric matrix) for S based on the noise level and the number of the calibration data. To this aim, the set 
                           
                              
                                 
                                    
                                       
                                          g
                                          Acc
                                       
                                       i
                                    
                                 
                              
                              
                                 i
                                 =
                                 1
                                 ..
                                 M
                              
                           
                         is acquired with the accelerometer in M random orientations. Since in stationary condition the norm of 
                           
                              
                                 
                                    g
                                    Acc
                                 
                                 i
                              
                           
                         should equal the gravity acceleration, g, S and O are estimated minimizing the cost function E:
                           
                              (2)
                              
                                 
                                    E
                                    =
                                    
                                       
                                          ∑
                                          
                                             i
                                             =
                                             1
                                          
                                          M
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     S
                                                                     
                                                                        −
                                                                        1
                                                                     
                                                                  
                                                                  
                                                                     
                                                                        
                                                                           V
                                                                           i
                                                                        
                                                                        
                                                                           
                                                                              V
                                                                              CC
                                                                           
                                                                           −
                                                                           O
                                                                        
                                                                     
                                                                  
                                                               
                                                            
                                                            2
                                                         
                                                      
                                                      −
                                                      
                                                         g
                                                         2
                                                      
                                                   
                                                
                                                2
                                             
                                          
                                       
                                    
                                 
                              
                           
                        through the Levemberg–Marquardt algorithm; as initial guess for S and O the nominal parameters reported in the sensor datasheet are used.

Each component of 
                           
                              
                                 
                                    g
                                    Acc
                                 
                                 i
                              
                           
                         is approximately affected by zero mean Gaussian noise with standard deviation σ
                        
                           g
                        
                        =
                        σ
                        
                           V
                        
                        s/V
                        
                           CC
                        , where σV
                         is the noise standard deviation on each channel of the accelerometer and s is the sensor average sensitivity [22]; noise standard deviation can be reduced to 
                           
                              
                                 σ
                                 g
                              
                              /
                              
                                 
                                    N
                                    S
                                 
                              
                           
                         by averaging NS
                         samples acquired in stationary conditions.

The aim of the camera-accelerometer calibration is the computation of the camera internal parameters [25] and of the rotation matrix R
                        
                           Acc
                        
                        
                           Cam
                        , which describes the orientation of the accelerometer with respect to the camera sensor plane (Fig. 2).

Camera calibration is performed through the Matlab Toolbox [24]: a set of N images of a checkerboard, resting on the horizontal plane (Z
                        =0), is acquired from different positions. Then the Toolbox is used to estimate the camera focals, fx
                         and fy
                        , the camera principal point, [c
                        
                           x
                         
                        c
                        
                           y
                        ]
                           T
                         and a unique distortion parameter. The adoption of this simplified distortion model (also adopted in [26,27]) is justified considering that most of the cameras include a lens model in their firmware which automatically corrects the majority of distortions [1,2]. The use of a unique distortion parameter is furthermore needed for the interpolation scheme adopted with zoom lenses (see Section 2.5).

After camera calibration, R
                        
                           Acc
                        
                        
                           Cam
                         is estimated comparing the accelerometer measurements of the gravity vector 
                           
                              
                                 
                                    
                                       
                                          g
                                          Acc
                                       
                                       i
                                    
                                 
                              
                              
                                 i
                                 =
                                 1
                                 ..
                                 N
                              
                           
                        , with the gravity vector given in the sensor camera reference frame for the same camera orientations, 
                           
                              
                                 
                                    
                                       
                                          g
                                          Cam
                                       
                                       i
                                    
                                 
                              
                              
                                 i
                                 =
                                 1
                                 ..
                                 N
                              
                           
                        . To this aim, let us remember that, using homogeneous coordinates, the projection [u v w]
                           T
                         of a 3D point [X Y Z]
                           T
                         onto the camera image plane is given by [25]:
                           
                              (3)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      u
                                                   
                                                
                                                
                                                   
                                                      v
                                                   
                                                
                                                
                                                   
                                                      w
                                                   
                                                
                                             
                                          
                                          =
                                          K
                                          
                                             R
                                             Cam
                                             T
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         I
                                                         3
                                                      
                                                   
                                                   
                                                      −
                                                      t
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      X
                                                   
                                                
                                                
                                                   
                                                      Y
                                                   
                                                
                                                
                                                   
                                                      Z
                                                   
                                                
                                                
                                                   
                                                      1
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          K
                                          =
                                          
                                             
                                                
                                                   
                                                      
                                                         f
                                                         x
                                                      
                                                   
                                                   
                                                      0
                                                   
                                                   
                                                      
                                                         c
                                                         x
                                                      
                                                   
                                                
                                                
                                                   
                                                      0
                                                   
                                                   
                                                      
                                                         f
                                                         y
                                                      
                                                   
                                                   
                                                      
                                                         c
                                                         y
                                                      
                                                   
                                                
                                                
                                                   
                                                      0
                                                   
                                                   
                                                      0
                                                   
                                                   
                                                      1
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where I
                        3 is the 3×3 identity matrix, RCam
                         is the camera rotation matrix and t is the position of the camera projection center. When the camera observes a set of points on the plane Z
                        =0, like the corners of the calibration pattern considered here, this simplifies as:
                           
                              (4)
                              
                                 
                                    
                                       
                                          
                                             
                                                u
                                             
                                          
                                          
                                             
                                                v
                                             
                                          
                                          
                                             
                                                w
                                             
                                          
                                       
                                    
                                    =
                                    K
                                    
                                       R
                                       Cam
                                       T
                                    
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         1
                                                      
                                                   
                                                   
                                                      
                                                         0
                                                      
                                                   
                                                   
                                                      
                                                         0
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         0
                                                      
                                                   
                                                   
                                                      
                                                         1
                                                      
                                                   
                                                   
                                                      
                                                         0
                                                      
                                                   
                                                
                                             
                                             
                                                −
                                                t
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                X
                                             
                                          
                                          
                                             
                                                Y
                                             
                                          
                                          
                                             
                                                1
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where H
                        =
                        KR
                        
                           Cam
                        
                        
                           T
                         is the 3×3 homography matrix which relates the points on Z
                        =0 and those on the camera image plane.

The eight free parameters in H can be estimated from at least four points in known position on Z
                        =0, measuring their 2D coordinates in the camera image plane [25]. Here in particular the entire set of points identified by the Calibration Toolbox is available. From Eq. (4) it is then evident that:
                           
                              (5)
                              
                                 
                                    
                                       R
                                       Cam
                                       T
                                    
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         1
                                                      
                                                   
                                                   
                                                      
                                                         0
                                                      
                                                   
                                                   
                                                      
                                                         0
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         0
                                                      
                                                   
                                                   
                                                      
                                                         1
                                                      
                                                   
                                                   
                                                      
                                                         0
                                                      
                                                   
                                                
                                             
                                             
                                                −
                                                t
                                             
                                          
                                       
                                    
                                    =
                                    
                                       K
                                       
                                          −
                                          1
                                       
                                    
                                    H
                                    .
                                 
                              
                           
                        
                     

From this, the camera orientation with respect to the calibration pattern is computed: in fact, the first and second columns of RCam
                         are equal to corresponding columns of K
                        −1
                        H whereas the third column of RCam
                         is orthogonal to them.

Given this premise, camera-accelerometer calibration is practically performed as follows. For each image used for camera calibration, the ith camera orientation, R
                        
                           Cam,i
                        , is estimated through the homography based method described above. Since the gravity vector corresponds to the -Z axis in the reference system defined by the checkerboard, the direction of the gravity force 
                           
                              
                                 
                                    g
                                    Cam
                                 
                                 i
                              
                           
                         in the camera reference system for the ith
                         orientation is:
                           
                              (6)
                              
                                 
                                    
                                       
                                          
                                             g
                                             Cam
                                          
                                          i
                                       
                                    
                                    =
                                    
                                       
                                          
                                             R
                                             Cam
                                          
                                          
                                             ,
                                             i
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                0
                                                ,
                                                0
                                                ,
                                                −
                                                1
                                             
                                          
                                          T
                                       
                                    
                                    .
                                 
                              
                           
                        
                     

The matrix R
                        
                           Acc
                        
                        
                           Cam
                         is finally estimated as the one which rotates the set of versors 
                           
                              
                                 
                                    
                                       
                                          
                                             g
                                             Acc
                                          
                                          i
                                       
                                    
                                    /
                                    
                                       
                                          
                                             
                                                g
                                                Acc
                                             
                                             i
                                          
                                       
                                    
                                 
                              
                              
                                 i
                                 =
                                 1
                                 ..
                                 N
                              
                           
                         into the set 
                           
                              
                                 
                                    
                                       
                                          
                                             g
                                             Cam
                                          
                                          i
                                       
                                    
                                    /
                                    
                                       
                                          
                                             
                                                g
                                                Cam
                                             
                                             i
                                          
                                       
                                    
                                 
                              
                              
                                 i
                                 =
                                 1
                                 ..
                                 N
                              
                           
                        , through the least squares approach in [28]. After calibration, the residual angles between the versors of the set 
                           
                              
                                 
                                    
                                       
                                          
                                             g
                                             Cam
                                          
                                          i
                                       
                                    
                                    /
                                    
                                       
                                          
                                             
                                                g
                                                Cam
                                             
                                             i
                                          
                                       
                                    
                                 
                              
                              
                                 i
                                 =
                                 1
                                 ..
                                 N
                              
                           
                         and those of 
                           
                              
                                 
                                    
                                       R
                                       Acc
                                       Cam
                                    
                                    
                                       
                                          
                                             g
                                             Acc
                                          
                                          i
                                       
                                    
                                    /
                                    
                                       
                                          
                                             
                                                g
                                                Acc
                                             
                                             i
                                          
                                       
                                    
                                 
                              
                              
                                 i
                                 =
                                 1
                                 ..
                                 N
                              
                           
                         provide an estimate of the accuracy of the accelerometer in computing the orientation angles.

For each acquired picture, the camera pose can be derived from gAcc
                        . First, the gravity force versor in the camera reference is obtained as:
                           
                              (7)
                              
                                 
                                    
                                       g
                                       Cam
                                    
                                    =
                                    
                                       
                                          
                                             R
                                             Acc
                                             Cam
                                          
                                          T
                                       
                                    
                                    
                                       
                                          g
                                          Acc
                                       
                                       
                                          
                                             g
                                             Acc
                                          
                                       
                                    
                                    ,
                                 
                              
                           
                        assuming that RCam
                         can be decomposed as:
                           
                              (8)
                              
                                 
                                    
                                       R
                                       Cam
                                    
                                    =
                                    
                                       R
                                       X
                                    
                                    
                                       R
                                       Y
                                    
                                    
                                       R
                                       0
                                    
                                 
                              
                           
                        where R
                        0 describes a rotation of 90° around the X axis, RY
                         a rotation of an angle h around the Y axis (camera roll), whereas RX
                         is a rotation of an angle k around the X axis (camera tilt); k and h are given by:
                           
                              (9)
                              
                                 
                                    k
                                    =
                                    arctan
                                    
                                       
                                          
                                             −
                                             
                                                g
                                                Z
                                                Cam
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         g
                                                         X
                                                         Cam
                                                      
                                                      2
                                                   
                                                
                                                +
                                                
                                                   
                                                      
                                                         g
                                                         Y
                                                         Cam
                                                      
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                    
                                    ,
                                    h
                                    =
                                    arctan
                                    
                                       
                                          
                                             g
                                             X
                                             Cam
                                          
                                          
                                             g
                                             Y
                                             Cam
                                          
                                       
                                    
                                 
                              
                           
                        where g
                        
                           X,Y,Z
                        
                        
                           Cam
                         represent the X, Y, Z components of gCam
                        .

Given the camera orientation in the absolute reference frame, horizon and keystone distortion correction is achieved by projection of the acquired picture from the rotated camera image plane to a vertical image plane. In particular, rewriting Eq. (3) for a camera centered in the origin (t
                        =0) and oriented as R
                        
                           Cam
                        
                        
                           T
                        , we get:
                           
                              (10)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      u
                                                   
                                                   
                                                      v
                                                   
                                                   
                                                      w
                                                   
                                                
                                             
                                          
                                          T
                                       
                                    
                                    =
                                    K
                                    
                                       R
                                       Cam
                                       T
                                    
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      X
                                                   
                                                   
                                                      Y
                                                   
                                                   
                                                      Z
                                                   
                                                
                                             
                                          
                                          T
                                       
                                    
                                    ;
                                 
                              
                           
                        on the other hand, projection onto a camera correctly aligned with the vertical plane (i.e., R
                        
                           Cam
                        
                        
                           T
                        
                        =
                        R
                        0) is described by:
                           
                              (11)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         u
                                                         ′
                                                      
                                                   
                                                   
                                                      
                                                         v
                                                         ′
                                                      
                                                   
                                                   
                                                      
                                                         w
                                                         ′
                                                      
                                                   
                                                
                                             
                                          
                                          T
                                       
                                    
                                    =
                                    K
                                    
                                       R
                                       0
                                       T
                                    
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      X
                                                   
                                                   
                                                      Y
                                                   
                                                   
                                                      Z
                                                   
                                                
                                             
                                          
                                          T
                                       
                                    
                                    .
                                 
                              
                           
                        
                     

Combining Eqs. (8), (10) and (11) we finally get the homography HC
                         between points on the rotated [u v w]
                           T
                         and vertical [u′ v′ w′]
                           T
                         plane:
                           
                              (12)
                              
                                 
                                    
                                       H
                                       C
                                    
                                    =
                                    K
                                    
                                       R
                                       0
                                       T
                                    
                                    
                                       R
                                       X
                                    
                                    
                                       R
                                       Y
                                    
                                    
                                       R
                                       0
                                    
                                    
                                       K
                                       
                                          −
                                          1
                                       
                                    
                                    .
                                 
                              
                           
                        
                     

An alternative perspective view from a properly oriented virtual camera is finally obtained by first removing the lens distortion and then resampling the image as:
                           
                              (13)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         u
                                                         ′
                                                      
                                                   
                                                   
                                                      
                                                         v
                                                         ′
                                                      
                                                   
                                                   
                                                      
                                                         w
                                                         ′
                                                      
                                                   
                                                
                                             
                                          
                                          T
                                       
                                    
                                    =
                                    
                                       H
                                       C
                                    
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      u
                                                   
                                                   
                                                      v
                                                   
                                                   
                                                      w
                                                   
                                                
                                             
                                          
                                          T
                                       
                                    
                                    .
                                 
                              
                           
                        
                     

Let us define x′=
                        u′/w′ and y′=
                        v′/w′ the coordinates of the corrected point. We are interested here in estimating the uncertainty 
                           
                              u
                              
                                 x
                                 ′
                              
                           
                         and 
                           
                              u
                              
                                 y
                                 ′
                              
                           
                         on x' and y' due to the accelerometer noise. The uncertainty of a given quantity can be estimated as the geometric sum of its partial derivatives with respect to all the (noisy) input variables multiplied by the standard uncertainty of the respective variable [29]. Uncertainty is introduced here by the noise on 
                           
                              
                                 
                                    g
                                    Acc
                                 
                                 i
                              
                           
                         or by residual calibration errors (associated to a non linear accelerometer response [22]). In both cases, we will assume a zero mean Gaussian noise with standard deviation σg
                         on each component of 
                           
                              
                                 
                                    g
                                    Acc
                                 
                                 i
                              
                           
                        , resulting in the same kind of noise on gCam
                        . This introduces the uncertainties uh
                         and uk
                         on h and k in Eq. (9) that are obtained, after some simplifications, as:
                           
                              (14)
                              
                                 
                                    
                                       
                                          
                                             u
                                             h
                                          
                                          =
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  ∂
                                                                  h
                                                               
                                                               
                                                                  ∂
                                                                  
                                                                     g
                                                                     X
                                                                     Cam
                                                                  
                                                               
                                                            
                                                            
                                                               σ
                                                               g
                                                            
                                                         
                                                      
                                                      2
                                                   
                                                
                                                +
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  ∂
                                                                  h
                                                               
                                                               
                                                                  ∂
                                                                  
                                                                     g
                                                                     Y
                                                                     Cam
                                                                  
                                                               
                                                            
                                                            
                                                               σ
                                                               g
                                                            
                                                         
                                                      
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          =
                                          
                                             
                                                σ
                                                g
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               g
                                                               X
                                                               Cam
                                                            
                                                         
                                                         2
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         
                                                            
                                                               g
                                                               Y
                                                               Cam
                                                            
                                                         
                                                         2
                                                      
                                                   
                                                
                                             
                                          
                                          ,
                                       
                                    
                                    
                                       
                                          
                                             u
                                             k
                                          
                                          =
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  ∂
                                                                  k
                                                               
                                                               
                                                                  ∂
                                                                  
                                                                     g
                                                                     X
                                                                     Cam
                                                                  
                                                               
                                                            
                                                            
                                                               σ
                                                               g
                                                            
                                                         
                                                      
                                                      2
                                                   
                                                
                                                +
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  ∂
                                                                  k
                                                               
                                                               
                                                                  ∂
                                                                  
                                                                     g
                                                                     Y
                                                                     Cam
                                                                  
                                                               
                                                            
                                                            
                                                               σ
                                                               g
                                                            
                                                         
                                                      
                                                      2
                                                   
                                                
                                                +
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  ∂
                                                                  k
                                                               
                                                               
                                                                  ∂
                                                                  
                                                                     g
                                                                     Z
                                                                     Cam
                                                                  
                                                               
                                                            
                                                            
                                                               σ
                                                               g
                                                            
                                                         
                                                      
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          =
                                          
                                             
                                                σ
                                                g
                                             
                                             g
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     

The uncertainty 
                           
                              u
                              
                                 x
                                 ′
                              
                           
                         and 
                           
                              u
                              
                                 y
                                 ′
                              
                           
                         are obtained studying the propagation of the uncertainty to x' and y' through Eq. (13); 
                           
                              u
                              
                                 x
                                 ′
                              
                           
                         and 
                           
                              u
                              
                                 y
                                 ′
                              
                           
                         are in practice obtained as:
                           
                              (15)
                              
                                 
                                    
                                       
                                          
                                             u
                                             
                                                x
                                                ′
                                             
                                          
                                          =
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  ∂
                                                                  
                                                                     
                                                                        
                                                                           u
                                                                           ′
                                                                        
                                                                        /
                                                                        
                                                                           w
                                                                           ′
                                                                        
                                                                     
                                                                  
                                                               
                                                               
                                                                  ∂
                                                                  h
                                                               
                                                            
                                                            
                                                               u
                                                               h
                                                            
                                                         
                                                      
                                                      2
                                                   
                                                
                                                +
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  ∂
                                                                  
                                                                     
                                                                        
                                                                           u
                                                                           ′
                                                                        
                                                                        /
                                                                        
                                                                           w
                                                                           ′
                                                                        
                                                                     
                                                                  
                                                               
                                                               
                                                                  ∂
                                                                  k
                                                               
                                                            
                                                            
                                                               u
                                                               k
                                                            
                                                         
                                                      
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          =
                                          
                                             1
                                             
                                                
                                                   
                                                      w
                                                      ′
                                                   
                                                   2
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  ∂
                                                                  
                                                                     u
                                                                     ′
                                                                  
                                                               
                                                               
                                                                  ∂
                                                                  h
                                                               
                                                            
                                                            
                                                               w
                                                               ′
                                                            
                                                            −
                                                            
                                                               
                                                                  ∂
                                                                  
                                                                     w
                                                                     ′
                                                                  
                                                               
                                                               
                                                                  ∂
                                                                  h
                                                               
                                                            
                                                            
                                                               u
                                                               ′
                                                            
                                                         
                                                      
                                                      2
                                                   
                                                
                                                
                                                   u
                                                   h
                                                   2
                                                
                                                +
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  ∂
                                                                  
                                                                     u
                                                                     ′
                                                                  
                                                               
                                                               
                                                                  ∂
                                                                  k
                                                               
                                                            
                                                            
                                                               w
                                                               ′
                                                            
                                                            −
                                                            
                                                               
                                                                  ∂
                                                                  
                                                                     w
                                                                     ′
                                                                  
                                                               
                                                               
                                                                  ∂
                                                                  k
                                                               
                                                            
                                                            
                                                               u
                                                               ′
                                                            
                                                         
                                                      
                                                      2
                                                   
                                                
                                                
                                                   u
                                                   k
                                                   2
                                                
                                             
                                          
                                          ,
                                       
                                    
                                    
                                       
                                          
                                             u
                                             
                                                y
                                                ′
                                             
                                          
                                          =
                                          
                                             1
                                             
                                                
                                                   
                                                      w
                                                      ′
                                                   
                                                   2
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  ∂
                                                                  
                                                                     v
                                                                     ′
                                                                  
                                                               
                                                               
                                                                  ∂
                                                                  h
                                                               
                                                            
                                                            
                                                               w
                                                               ′
                                                            
                                                            −
                                                            
                                                               
                                                                  ∂
                                                                  
                                                                     w
                                                                     ′
                                                                  
                                                               
                                                               
                                                                  ∂
                                                                  h
                                                               
                                                            
                                                            
                                                               v
                                                               ′
                                                            
                                                         
                                                      
                                                      2
                                                   
                                                
                                                
                                                   u
                                                   h
                                                   2
                                                
                                                +
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  ∂
                                                                  
                                                                     v
                                                                     ′
                                                                  
                                                               
                                                               
                                                                  ∂
                                                                  k
                                                               
                                                            
                                                            
                                                               w
                                                               ′
                                                            
                                                            −
                                                            
                                                               
                                                                  ∂
                                                                  
                                                                     w
                                                                     ′
                                                                  
                                                               
                                                               
                                                                  ∂
                                                                  k
                                                               
                                                            
                                                            
                                                               v
                                                               ′
                                                            
                                                         
                                                      
                                                      2
                                                   
                                                
                                                
                                                   u
                                                   k
                                                   2
                                                
                                             
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     

Since k and h appear respectively only in RX
                         and RY
                         in HC
                         in Eq. (12), we have:
                           
                              (16)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            ∂
                                                            
                                                               u
                                                               ′
                                                            
                                                         
                                                         
                                                            ∂
                                                            k
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            ∂
                                                            
                                                               v
                                                               ′
                                                            
                                                         
                                                         
                                                            ∂
                                                            k
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            ∂
                                                            
                                                               w
                                                               ′
                                                            
                                                         
                                                         
                                                            ∂
                                                            k
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                             T
                                          
                                          =
                                          K
                                          
                                             R
                                             0
                                             T
                                          
                                          
                                             
                                                ∂
                                                
                                                   R
                                                   X
                                                
                                             
                                             
                                                ∂
                                                k
                                             
                                          
                                          
                                             R
                                             Y
                                          
                                          
                                             R
                                             0
                                          
                                          
                                             K
                                             
                                                −
                                                1
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      u
                                                   
                                                
                                                
                                                   
                                                      v
                                                   
                                                
                                                
                                                   
                                                      w
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            ∂
                                                            
                                                               u
                                                               ′
                                                            
                                                         
                                                         
                                                            ∂
                                                            h
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            ∂
                                                            
                                                               v
                                                               ′
                                                            
                                                         
                                                         
                                                            ∂
                                                            h
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            ∂
                                                            
                                                               w
                                                               ′
                                                            
                                                         
                                                         
                                                            ∂
                                                            h
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                             T
                                          
                                          =
                                          K
                                          
                                             R
                                             0
                                             T
                                          
                                          
                                             R
                                             X
                                          
                                          
                                             
                                                ∂
                                                
                                                   R
                                                   Y
                                                
                                             
                                             
                                                ∂
                                                h
                                             
                                          
                                          
                                             R
                                             0
                                          
                                          
                                             K
                                             
                                                −
                                                1
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      u
                                                   
                                                
                                                
                                                   
                                                      v
                                                   
                                                
                                                
                                                   
                                                      w
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        where:
                           
                              (17)
                              
                                 
                                    
                                       
                                          
                                             
                                                ∂
                                                
                                                   R
                                                   X
                                                
                                             
                                             
                                                ∂
                                                k
                                             
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      0
                                                   
                                                   
                                                      0
                                                   
                                                   
                                                      0
                                                   
                                                
                                                
                                                   
                                                      0
                                                   
                                                   
                                                      −
                                                      sin
                                                      
                                                         k
                                                      
                                                   
                                                   
                                                      −
                                                      cos
                                                      
                                                         k
                                                      
                                                   
                                                
                                                
                                                   
                                                      0
                                                   
                                                   
                                                      cos
                                                      
                                                         k
                                                      
                                                   
                                                   
                                                      −
                                                      sin
                                                      
                                                         k
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                ∂
                                                
                                                   R
                                                   Y
                                                
                                             
                                             
                                                ∂
                                                h
                                             
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      −
                                                      sin
                                                      
                                                         h
                                                      
                                                   
                                                   
                                                      0
                                                   
                                                   
                                                      cos
                                                      
                                                         k
                                                      
                                                   
                                                
                                                
                                                   
                                                      0
                                                   
                                                   
                                                      0
                                                   
                                                   
                                                      0
                                                   
                                                
                                                
                                                   
                                                      −
                                                      cos
                                                      
                                                         h
                                                      
                                                   
                                                   
                                                      0
                                                   
                                                   
                                                      −
                                                      sin
                                                      
                                                         k
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

In practice, to estimate the uncertainty of the pixel in position [x′ y′]
                           T
                         in the corrected image, uk
                         and uh
                         are computed through Eq. (14); Eq. (13) is then inverted to compute the original pixel position [u v w]
                           T
                        , the corresponding derivatives in Eq. (16) are computed and 
                           
                              u
                              
                                 x
                                 ′
                              
                           
                         and 
                           
                              u
                              
                                 y
                                 ′
                              
                           
                         are finally obtained as in Eq. (15).

Eq. (12) highlights that HC
                         depends on the internal camera parameters c
                        
                           x
                        , c
                        
                           y
                        , f
                        
                           x
                         and fy
                         in K. For fixed focal length lenses this is not an issue, since these parameters can be computed only once and then stored, during the camera-accelerometer calibration procedure. When zoom lenses are adopted, however, the camera internal parameters (as well as the distortion parameter) vary as a function of the zoom focal length [26,27]. Although fx
                         and fy
                         approximately vary linearly with the zoom focal length, the principal point [c
                        
                           x
                         
                        c
                        
                           y
                        ]
                           T
                         is influenced by the rotation of the groups of lenses inside the barrel and it may describe complicated or discontinuous trajectories in the image space [26]; the same is true for the distortion parameter. Some zoom lens calibration procedures have therefore been proposed, but they generally require a large amount of data to get a continuous representation of the camera parameters as a function of the zoom focal length [26,27].

Here we adopted a simpler interpolation scheme to obtain the camera parameters at any focal length. To this aim, we first performed camera calibration with the zoom fixed at the minimum, medium and maximum focal length. The EXIF header of each acquired picture is then used to determine the focal length of the zoom [27], with a typical discretization step of 1mm. A piecewise linear interpolation scheme is used to compute the camera internal and distortion parameters at any focal length and consequently apply perspective correction.

@&#RESULTS@&#

The proposed method was tested using a digital reflex camera (DC) and a commercial smartphone (SP). In contrast to smartphones, which are designed to help software developers to provide new applications, embedded accelerometer raw data are generally not available to digital reflex camera users. To overcome this issue, we rigidly fixed on the same moving support a FreeIMU 0.3.5_MS and a Nikon D3100 camera, equipped with a Nikon 18–55mm f/3.5–5.6 GII AF-S DX zoom lens and acquiring images of 4608×3072pixels. The FreeIMU is an open hardware Inertial Measurement Unit (IMU) [30,31], including a Bosch BMA180 accelerometer, which can be easily coupled with an Arduino board [31,32] for data read-out.


                        Accelerometer calibration was performed using M
                        =45 different orientations. To perform camera-accelerometer calibration, we employed a checkerboard of 7×9 squares with side of 28mm fixed to the floor and for three different zoom focal lengths (18mm, 35mm and 55mm) we acquired N
                        =30 pictures from random orientations, without moving the focusing ring. For each picture, the accelerometer output was read by an Arduino UNO [32]. Accelerometer calibration was performed using all the M
                        =90 available data, whereas camera accelerometer calibration was performed independently for each focal length to estimate R
                        
                           Acc
                        
                        
                           Cam
                        .

We also applied the proposed method to a Samsung Galaxy S2 GT-I9100 SP, equipped with a K3DH tri-axial accelerometer by STMicroelectronics and with a camera acquiring images of 3264×2448pixels. M
                        =64 different orientations were used for accelerometer calibration and the same checkerboard previously described was used to acquire N
                        =30 images for camera accelerometer calibration.


                        Table 1
                         reports the rotation angles around the X, Y and Z axes obtained from the decomposition of R
                        
                           Acc
                        
                        
                           Cam
                        , as well as the average and the maximum registration error between the versors of the sets 
                           
                              
                                 
                                    
                                       
                                          
                                             g
                                             Cam
                                          
                                          i
                                       
                                    
                                    /
                                    
                                       
                                          
                                             
                                                g
                                                Cam
                                             
                                             i
                                          
                                       
                                    
                                 
                              
                              
                                 i
                                 =
                                 1
                                 ..
                                 N
                              
                           
                         and 
                           
                              
                                 
                                    
                                       R
                                       Acc
                                       Cam
                                    
                                    
                                       
                                          
                                             g
                                             Acc
                                          
                                          i
                                       
                                    
                                    /
                                    
                                       
                                          
                                             
                                                g
                                                Acc
                                             
                                             i
                                          
                                       
                                    
                                 
                              
                              
                                 i
                                 =
                                 1
                                 ..
                                 N
                              
                           
                        , defined as:
                           
                              (18)
                              
                                 
                                    
                                       
                                          
                                             ϵ
                                             Avg
                                          
                                          =
                                          
                                             
                                                
                                                   ∑
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   N
                                                
                                                
                                                   
                                                      
                                                         arccos
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        
                                                                           g
                                                                           Cam
                                                                        
                                                                        i
                                                                        T
                                                                     
                                                                  
                                                                  
                                                                     
                                                                        
                                                                           
                                                                              g
                                                                              Cam
                                                                           
                                                                           i
                                                                        
                                                                     
                                                                  
                                                               
                                                               
                                                                  
                                                                     
                                                                        R
                                                                        Acc
                                                                        Cam
                                                                     
                                                                     
                                                                        
                                                                           
                                                                              g
                                                                              Acc
                                                                           
                                                                           i
                                                                        
                                                                     
                                                                  
                                                                  
                                                                     
                                                                        
                                                                           
                                                                              g
                                                                              Acc
                                                                           
                                                                           i
                                                                        
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             N
                                          
                                       
                                    
                                    
                                       
                                          
                                             ϵ
                                             Max
                                          
                                          =
                                          
                                             max
                                             
                                                i
                                                =
                                                1
                                                ..
                                                N
                                             
                                          
                                          
                                             
                                                arccos
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  g
                                                                  Cam
                                                               
                                                               i
                                                               T
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  
                                                                     g
                                                                     Cam
                                                                  
                                                                  i
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               R
                                                               Acc
                                                               Cam
                                                            
                                                            
                                                               
                                                                  
                                                                     g
                                                                     Acc
                                                                  
                                                                  i
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  
                                                                     g
                                                                     Acc
                                                                  
                                                                  i
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

These represent an estimate of the accuracy of the calibrated accelerometers in computing the orientation angles in real situations. Table 1 shows that the three R
                        
                           Acc
                        
                        
                           Cam
                         matrices computed at different focals for the Nikon camera are coherent within each other; the maximum discrepancy observed is between the rotation angle around the X axis computed for the 35mm and 55mm zoom focal lengths, that differ by 0.67°. The maximum registration error between 
                           
                              
                                 
                                    
                                       
                                          
                                             g
                                             Cam
                                          
                                          i
                                       
                                    
                                    /
                                    
                                       
                                          
                                             
                                                g
                                                Cam
                                             
                                             i
                                          
                                       
                                    
                                 
                              
                              
                                 i
                                 =
                                 1
                                 ..
                                 N
                              
                           
                         and 
                           
                              
                                 
                                    
                                       R
                                       Acc
                                       Cam
                                    
                                    
                                       
                                          
                                             g
                                             Acc
                                          
                                          i
                                       
                                    
                                    /
                                    
                                       
                                          
                                             
                                                g
                                                Acc
                                             
                                             i
                                          
                                       
                                    
                                 
                              
                              
                                 i
                                 =
                                 1
                                 ..
                                 N
                              
                           
                        , was observed for the 35mm focal and it was equal to 0.52°, whereas the average registration error ϵ
                           Avg
                         was always smaller than 0.2°. Overall, noise on the BMA180 accelerometer data, inaccuracies in its calibration as well as inaccuracies in the computation of R
                        
                           Acc
                        
                        
                           Cam
                        , may introduce an angular error on 
                           
                              
                                 
                                    g
                                    Acc
                                 
                                 i
                              
                           
                         which is in the order of tenths of a degree and may only rarely exceed 0.5°.

Registration errors obtained with the SP accelerometer are approximately 4 times higher, with ϵ
                           Avg
                        
                        =0.56∘. This is coherent with the experimentally measured accelerometer noise, which is approximately three times higher for the K3DH accelerometer with respect to the BMA180 sensor.

To quantitatively evaluate the proposed method, we attached the calibration checkerboard to a vertical wall ensuring the horizontality and verticality of its borders using a spirit level and a plumb line (Fig. 3
                        ). For the digital camera and for each zoom focal length (18mm, 35mm and 55mm), we applied the proposed method to 10 pictures of the checkerboard acquired from random camera orientations, without moving the lens focusing ring. For the sake of comparison with a vision based procedure, which however requires the knowledge of the geometry of the acquired object, we used the checkerboard corners, extracted through the Matlab Calibration Toolbox [24], to derive the homography between the camera image and the vertical plane; we later applied the homography to remove horizon and keystone distortions.

The accuracy of perspective correction was quantified by the angles between the vertical borders of the checkerboard and the vertical direction (ϵL
                         and ϵR
                         in Fig. 3). Notice that horizontal lines cannot be detected in the corrected images, since the perspective distortion introduced by camera rotation around the vertical axis cannot be identified through the accelerometer and consequently it cannot be corrected; ϵL
                         and ϵR
                         are therefore used to approximately measure the horizon distortion. On the other hand, the angle between the left and right borders of the checkerboard (ϵK
                         in Fig. 3) is used to approximately quantify the keytstone distortion.

The average value and the standard deviation of ϵL
                        , ϵR
                         and ϵK
                         are reported in Table 2
                         for each zoom focal length, before and after correction with the proposed method and with the homography based one. Horizon and keystone distortions are reduced in both cases well beyond 1°. The accelerometer based method leads to a slightly biased correction for the zoom focal lengths of 18mm and 35mm, with a maximum bias of 0.55° for ϵK
                         at 35mm. Comparison with data reported in Table 1 reveals that this bias can be associated to a partially inaccurate estimate of R
                        
                           Acc
                        
                        
                           Cam
                        : for zoom focal lengths of 18mm and 35mm, ϵ
                           Avg
                         in Table 1 is approximately 0.2° and the minimum absolute bias on ϵL
                        , ϵR
                         and ϵK
                         in Table 2 is in this cases equal to 0.12°. On the other hand, when the zoom focal length of 55mm is considered, ϵ
                           Avg
                        
                        =0.12∘ and the corresponding maximum absolute bias on ϵL
                        , ϵR
                         and ϵK
                         is limited to 0.03°.


                        Table 2 also reveals that the accelerometer based method is less precise than the method based on homography: a maximum standard deviation of 0.35° can be observed for ϵK
                         at a zoom focal length of 55mm, whereas the maximum standard deviation for the homography based method is 0.06° for ϵR
                         at 55mm. The higher standard deviation measured for the proposed method can be explained considering that, because of noise and sensor non-linearities, even after calibration, the accuracy of the accelerometer used as a tilt sensor rarely exceeds the tenth of degree, as reported in [21,22] and coherently with the results in Table 1; on the other hand, the estimate of the camera orientation performed through a method entirely based on a vision approach is characterized by a higher accuracy [25].

A more qualitative evaluation was obtained on the field through a set of pictures of a building and a tower at zoom focal lengths of 18mm, 35mm and 55mm, keeping the lens focus ring in the same position used for camera calibration. Residual perspective distortions were generally not detectable by visual inspection on a typical laptop display. Two typical results are shown in Fig. 4
                        : panel (a) shows a picture acquired at 18mm, with the camera rolled by h
                        =−7.87° and tilted by k
                        =14.26°; this leads to vertical lines inclined from 0.58° to 15.63°. After correction, a residual keystone distortion is present, with a convergence angle between the vertical lines at the border of the picture smaller than 0.7°. This residual error is compatible with an imprecise estimate of the camera focal length (fx
                         and fy
                        ), a noisy estimate of k (see Eq. (9)) as well as a biased estimate of R
                        
                           Acc
                        
                        
                           Cam
                        . Fig. 4c shows a picture acquired at 35mm, with the camera rolled by h
                        =−0.80° and tilted by k
                        =44.47°. In this case, after perspective correction the vertical lines are biased by approximately 0.4°; this residual error could be explained with a biased estimate of R
                        
                           Acc
                        
                        
                           Cam
                        , as well as a noisy estimate of h (see Eq. (9)). In both cases, the residual horizon and keystone distortions are practically imperceptible at visual inspection.


                        Fig. 5c–d shows the uncertainties 
                           
                              u
                              
                                 x
                                 ′
                              
                           
                         (horizontal direction) and 
                           
                              u
                              
                                 y
                                 ′
                              
                           
                         (vertical direction) computed through Eq. (15) for the picture in Fig. 5a–b. After correction, the slope of the two red segments in the image are 0.144° and −0.302°, corresponding respectively to a shift between the upper and lower segment point of 5 and 8pixels along the x' (horizontal) direction. When compared to the estimated uncertainty 
                           
                              u
                              
                                 x
                                 ′
                              
                           
                        , these shifts appear slightly large, thus further suggesting that, beyond accelerometer noise, other phenomena like imprecise estimate of R
                        
                           Cam
                        
                        
                           Acc
                         or non-linear response of the accelerometer may influence 
                           
                              
                                 
                                    g
                                    Acc
                                 
                                 i
                              
                           
                         and consequently bias the horizon and keystone distortion correction procedure.


                        Table 2 furthermore reports the average and the standard deviation of ϵL
                        , ϵR
                         and ϵK
                         obtained with the Samsung Galaxy S2 GT-I9100 smartphone, for a set of 10 images of the checkerboard acquired by random positions. Accuracy and precision are in this case slightly worse with respect to those obtained with the Nikon D3100 camera, but also in this case poorly perceivable at visual inspection.

To quantitatively evaluate the proposed method when the zoom focal length is randomly varied, we acquired 10 pictures of the vertical checkerboard for zoom focal lengths varying from 18mm to 55mm, maintaining the same camera orientation for the entire set of pictures and without moving the focus ring. The proposed method (as well as the homography based method) was applied after interpolation of the camera internal parameters based on EXIF data, as described in Section 2.5.

The average value and the standard deviation of ϵL
                        , ϵR
                         and ϵK
                         are reported in Table 2; these demonstrate that precision and accuracy of the proposed method are practically not affected by the interpolation scheme adopted for zoom lenses. Table 3
                         shows the values of ϵL
                        , ϵR
                         and ϵK
                         at any zoom focal length. A trend is observable in this table and it is even more evident in Fig. 7
                        
                        : the method is less accurate for a zoom focal length of 18mm (ϵK
                        
                        =1.07°), whereas higher accuracy is achieved for longer zoom focal lengths (the best results obtained at 46mm). Overall, these data also demonstrate that interpolation of the internal and distortion camera parameters does not introduce significant errors in the perspective correction process.


                        Table 2 furthermore reports the average value and the standard deviation of ϵL
                        ,ϵR
                         and ϵK
                         measured on a set of 10 images of the vertical checkerboard, taken from random orientations and position of the camera, at varying zoom focal lengths and with the auto focus function enabled. Also in this case, the precision and the accuracy of the proposed method are similar to those obtained for a fixed focal length with fixed focus ring, thus suggesting that the use of the autofocus system does not significantly alter the accuracy of the proposed method.


                        Fig. 6 finally demonstrates the results obtained on the field at various zoom focal lengths, with the autofocus function enabled. The residual perspective distortions are also in this case comparable with those reported in Fig. 4.

@&#DISCUSSION@&#

The method described here permits to automatically correct horizon and keystone distortions in digital pictures using the camera on-board accelerometer. This can be helpful in the field of architectural photography, where time consuming procedures and costly TS lenses [1,2], or a-posteriori processing [3–5,33], are required to obtain the correct perspective. The proposed method can also be applied to facilitate and improve the automatic identification of horizontal and vertical features, which is required by vision based methods [13,23]; in this case the uncertainty in Eq. (15) can be used to define the area that has to be analyzed to identify the features in each part of the image. Furthermore, the proposed method remains the only applicable when such features are not available or not reliably identifiable (e.g. for large view panoramas or architectural photography of curved shaped objects).

Since the output of the accelerometer is not affected by rotations around the vertical direction, the camera orientation is estimated apart from a rotation (pan angle [33]) around the gravity axis and perspective distortions associated to the pan angle cannot be corrected. This is evident in Fig. 3, where the cyan lines are not horizontal after perspective correction. Notice, however, that even if the camera orientation with respect to the magnetic pole could be estimated through a magnetometer [30,31], this information could not be used for perspective correction, as the orientation of the subject (for instance, the facade of a building) with respect to the camera would remain unknown also in this case. A first attempt to handle this issue was reported in [20], where measurements from the auto focus system in various points of the picture are used to estimate the orientation of a planar surface with respect to the camera and consequently correct the perspective distortion. However, this procedure has not been implemented yet on any device, probably because of the limited accuracy of the estimated camera pose and difficulty to handle with non planar surfaces.

It is interesting to notice that a slight modification of the proposed method (and in particular of the correction homography Hc
                      in Eq. (12)) would permit to correct images of objects lying in the horizontal plane, like documents or aerial photographs.

The key point to achieve a satisfying horizon and keystone distortion correction is an accurate estimate of the camera orientation, which is influenced by several factors: (i) accelerometer calibration; (ii) camera-accelerometer calibration; (iii) accelerometer noise. Comparing the results in Table 2 with those reported in our preliminary work [33] (where we achieved ϵ
                        L
                     
                     =−0.27∘
                     ±1.57∘, ϵ
                        R
                     
                     =0.20∘
                     ±1.49∘ and ϵ
                        K
                     
                     =−0.47∘
                     ±0.34∘ without any accelerometer calibration) shows for instance that accelerometer calibration reduces by approximately one order of magnitude the residual horizon and keystone distortions. This is also coherent with the results in [21,22] and with Table 1, which demonstrate that after calibration the accuracy of a MEMS accelerometer used as a tilt sensor is reduced at the order of tenths of degree.

Such result is even more noticeable when compared with the typical accuracy achieved by state-of-the art methods based on vision. For instance, the authors in [11] propose a method to automatically detect the vanishing points and they quantify the accuracy with the horizon error, defined as “the maximum distance from the true horizon to the ground truth horizon in the image, normalized by the image height”; the inverse tangent of this error roughly corresponds to the error angles ϵL
                      and ϵR
                      defined here. The worst case horizon error reported in [11] on a database of urban images is 0.078, corresponding to more than 4°, whereas the median horizon error is approximately 0.6°. Overall, the accuracy of the method proposed here is therefore comparable with that of state-of-the-art methods based on automatic extraction of features in a man-made environment.

The camera-accelerometer calibration procedure described here (and previously adopted in [13,23]) is necessary to estimate the relative pose of the accelerometer with respect to the image sensor. Table 1 shows that, even in the case of a smartphone where the image sensor and the accelerometer are mounted on the same silicon board, their orientation can differ by some tenths of degree, thus making necessary the estimate of R
                     
                        Acc
                     
                     
                        Cam
                     . Also in this case the rotation angles in R
                     
                        Acc
                     
                     
                        Cam
                      are estimated with an accuracy of tenths of degree, thus introducing errors of the same order of magnitude on the estimated h and k angles.

Finally, noise on V
                     
                        i
                      produces noise on each channel of 
                        
                           
                              
                                 g
                                 Cam
                              
                              i
                           
                        
                      which introduces the uncertainties 
                        
                           u
                           
                              x
                              ′
                           
                        
                      and 
                        
                           u
                           
                              y
                              ′
                           
                        
                      on the position [x′
                     y′] of each pixel in the corrected image. Application of Eq. (14) to the two accelerometers considered here permits to estimate the expected uncertainty on h and k: for the BMA180 accelerometer we measured for instance σ
                     
                        g
                     
                     =0.005m/s2, resulting in u
                     
                        k
                     
                     =0.03∘ and a u
                     
                        h
                     
                     ≥0.03∘ (the minimum uncertainty for h is achieved for g
                     
                        Z
                     
                     
                        Cam
                     
                     =0); for the K3DH accelerometer we measured a higher noise, σ
                     
                        g
                     
                     =0.022m/s2, resulting in u
                     
                        h
                     
                     ≥
                     u
                     
                        k
                     
                     =0.13∘. Overall, these experimental results together with the discussion reported in [22] suggest that residual calibration errors (due to non linear response of the accelerometer) as well as slight inaccuracies in the estimate of R
                     
                        Acc
                     
                     
                        Cam
                      do have a significant role in reducing the accuracy of the estimated camera orientation. In practice, the uncertainty estimated through Eq. (15) remains valid, but σg
                      has to be properly increased to take into account other source of noise beyond noise on V
                     
                        i
                     . On the other hand, the proposed method could clearly benefit from an improvement of the accelerometer calibration procedure, for instance by taking into account the sensor non-linearities [22].

Differently from methods based on the identification of visual features, whose accuracy is influenced by the proper localization of the features in the scene [7,11], the accuracy of the present method is in general a function of the camera orientation, as highlighted by Eq. (15). Fig. 8
                      shows the results of simulation where the minimum uncertainty, equal to 0.15pixels, is obtained for h
                     =
                     k
                     =0°, whereas the maximum uncertainty, equal to 4.97pixels, is achieved at k
                     =±40∘ and h
                     =±75∘. This figure highlights that the accuracy is approximately constant when the camera is close to be horizontally held (h
                     =
                     k
                     =0°), which is the most common case in practical cases. The accuracy decreases dramatically when the camera optical axis is almost vertical (k
                     →±90∘): in this case, in fact, the denominator in uh
                      in Eq. (14) becomes smaller and the uncertainty in the position of the corrected pixels becomes consequently high.

A significant advantage of the proposed method is that it can be applied to zoom lens with the same accuracy measured for a fixed focal lens. This requires the adoption of an interpolation scheme to compute the internal (fX
                     , fY
                     , cX
                      and cY
                     ) and distortion camera parameters. To facilitate the interpolation procedure, we used a lens distortion model with a unique distortion parameter. This choice is common to other authors in the literature [26,27], and it is also justified by the fact that modern digital cameras generally include a lens distortion model and automatically correct for it. In practice, residual lens distortions on the acquired picture are generally very small: considering the camera calibration at 18mm, 35 and 55mm performed by the Matlab Calibration Toolbox [24] during our experiments, we measured a distortion field whose maximum magnitude was lower than 6pixels at the border of the image, in the worst case. For a 3072×4608 image, like those acquired by the Nikon D3100 camera, this may introduce in the worst case (i.e., a vertical line on the leftmost/rightmost column of the picture) a rotation of 0.22°, which is comparable with the typical residual error in Table 2.

With respect to other zoom calibration procedures described in literature [26,27], the one adopted here is characterized by simplicity, as it only requires to calibrate the zoom lens at some different focal lengths and to use then a piecewise linear interpolation scheme to obtain the camera parameters at each focal (with a discretization step of 1mm), based on the EXIF data in each picture file. For the Nikon 18–55mm lens, we performed a full calibration at 18mm, 35mm and 55mm since the lens has a maximum elongation at 18mm and 55m, whereas its length is minimal at 35mm, therefore suggesting that a particular configuration of the groups of lenses inside the barrel occurs at 35mm. The discontinuity in the movement of the groups of lenses in the range 18–35mm and 35–55mm is evident if one considers the position of the principal point as a function of the zoom length (Fig. 9
                     ): [c
                     
                        X
                     ,
                     c
                     
                        Y
                     ] moves downward from 18mm to 35mm and then diagonally from 35mm to 55mm. The same discontinuity could be appreciated also in Fig. 7 where the errors are reported with respect to the lens focal length and appear roughly constant in the range 18–35mm, while decreasing in the range 35–55mm, inverting their sign. It is worthy to notice that different zoom lenses could require a higher or lower number of full calibration at different focal lengths, depending on the behavior of the group of lenses during the barrel rotation.

Although a continuous interpolation scheme could be in some sense more attractive and more coherent with the literature [26,27], we avoided it: in fact, comparison of the curves in Fig. 9 shows that, using a quadratic interpolation scheme for the Nikon 18–55mm lens considered here, the principal point is in its leftmost position for a zoom focal length of 27mm, which does not appear to be a “special” point by observing the behavior of the Nikon 18–55mm lens considered here. Ultimately, polynomial interpolation schemes should be avoided as they may introduce oscillations on the estimated parameters and consequently worsen the quality of perspective correction.

Overall, despite the simplicity of the interpolation scheme adopted here and the rough discretization obtained using EXIF data, results in Tables 2 and 3 show that inaccuracies on the internal camera parameters introduced by interpolation do not significantly affect the accuracy of the proposed method and therefore discourages the adoption of more complicated zoom calibration procedures. Also enabling the auto focus function of the digital camera does not significantly alter the quality of perspective correction (see Table 2): this is coherent with [26,27], where it is observed that the movements of the focus ring only slightly alter the camera internal parameters.

Finally, it is important to notice that resampling (see Eq. (13)) may imply image undersampling and/or interpolation and it could consequently lower down the picture quality. As distortion is proportional to h and k, and so does picture quality after resampling, low quality picture could be obtained in case of large perspective distortions in the original picture. Such drawback is however negligible in most cases, given the typical amount of sensor pixels in modern digital cameras.

@&#CONCLUSION@&#

We have described an accelerometer-based approach to remove keystone and horizon distortion in digital photography; although the accuracy of the method is lower with respect to more traditional vision based approaches, it has the advantage that it can be applied automatically even if reference straight lines are not present in the acquired picture.

The experimental results demonstrate that a careful accelerometer calibration is the key point to obtain a satisfying perspective correction. The development of new accelerometer calibration procedures, including sensor non-linearities, would further improve its accuracy. On the other hand, a simple piecewise linear interpolation scheme can be adopted to apply perspective correction to the nowadays widely used zoom lenses.

The method appears sufficiently robust to be implemented in modern digital cameras, as well as in tablets, smartphones or other imaging devices. It can also be employed in computer vision applications, where it can furnish the uncertainty for the position of each pixels in the corrected image.

@&#REFERENCES@&#

