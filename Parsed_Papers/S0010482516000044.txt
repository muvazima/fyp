@&#MAIN-TITLE@&#Automated measurement of parameters related to the deformities of lower limbs based on x-rays images

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           A CAD system was developed for assessment of the deformities of lower extremities.


                        
                        
                           
                           Measurements of the quantities related to the deformities are fully automatic.


                        
                        
                           
                           Measurements are based on detection of characteristic points, axes and tangents.


                        
                        
                           
                           There is a very good correlation between manual and automated measurements.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Active appearance model

X-rays

Computer assisted diagnosis

Lower-limb

@&#ABSTRACT@&#


               
               
                  Measurement of the deformation of the lower limbs in the current standard full-limb X-rays images presents significant challenges to radiologists and orthopedists. The precision of these measurements is deteriorated because of inexact positioning of the leg during image acquisition, problems with selecting reliable anatomical landmarks in projective X-ray images, and inevitable errors of manual measurements. The influence of the random errors resulting from the last two factors on the precision of the measurement can be reduced if an automated measurement method is used instead of a manual one. In the paper a framework for an automated measurement of various metric and angular quantities used in the description of the lower extremity deformation in full-limb frontal X-ray images is described. The results of automated measurements are compared with manual measurements. These results demonstrate that an automated method can be a valuable alternative to the manual measurements.
               
            

@&#INTRODUCTION@&#

The anatomy of the lower limb joints as well as the anatomy of the tibia and femur diaphyses is ideally suited to the mechanical functions of the lower limb. Under physiological conditions angles formed by planes tangent to joint surfaces and some specific anatomical and mechanical axes fall into well defined standard ranges [1]. At the same time the lengths of bones within the left and right limbs are expected to be equal. Whenever these conditions are not met, a deformity of a lower extremity is reported which is defined as deviation of the physiological axes of the extremity from their normal positions.

Accurate measurement of the deformation of the lower limbs presents significant challenges to radiologists and orthopedists [2]. It is essential in selecting and designing implants, planning osteotomy cut or fracture management [3–5]. Deformations in lower extremity – if not corrected – alter the length, rotation, and alignment of long bones, resulting in the translation of knee from its ideal position what finally leads to impairments in the function of the entire lower limb.

The deformations of lower extremity can develop in coronal, sagittal or transverse planes. They can be classified into three categories: angular, torsional, and bowing. Angular deformities (varus–valgus deviations), which are the most frequent leg deformities, occur in the coronal plane. For angularly deformed lower extremity its mechanical axis passes at some significant distance from the center of the knee joint. Measurements of some specific angles between planes tangent to joint surfaces and anatomical and mechanical axes of either long bones or entire leg is then necessary to differentiate between e.g. femoral or tibial causes of the deformity. It is also essential for correct planning of an appropriate orthopedic treatment.

Currently, full-limb X-rays made in standing position are considered the gold standard imaging method used to quantify the deformities of the lower extremities [6]. Compared to computed tomography (CT), full-limb films offer a cheaper option of reproducible measurement of the mechanical axis of the whole lower extremity [7]. Another advantage of the full-limb X-rays over CT is that the latter is made in supine position what can potentially lead to errors in the estimation of lower extremity angles, differences in the position of hip, knee or ankle joints etc., which may be difficult to correct. Moreover, the X-rays dose received by a patient during X-rays examination is much smaller than during CT scan. Unfortunately, while there is a consensus about the set of quantities which should be measured to assess the deformities [1], the full-limb film measurement procedures are not well standardized [8–11]. The precision of these measurements is deteriorated because of inexact positioning of the leg during image acquisition, problems with selecting reliable anatomical landmarks in projective X-rays images, inevitable errors of manual measurements etc.

Clearly, these limitations can be overcome and random measurement errors can be reduced to some extent if an automated method for assessment of the deformities is used instead of a manual measurements. In particular, based on some predefined image features anatomical landmarks can be automatically selected to determine planes and axes of interest. Then, the landmarks can be determined consistently in the dataset of all analyzed images, enforcing reliable comparison of the results, more accurate quantitative diagnosis and better estimation of the effects of therapy. The problem of standardization can be brought to the problem of selecting appropriate features specifying landmarks necessary to determine the angles and lengths of interest. Obviously, for an automated method the problem of intra- and inter-reader variability is not existent and thus consistent results will be reported for any single image. Because the manual assessment of the deformities is time-consuming as it involves measurement of multiple quantities, it would be also desirable that the automated analysis shortens the time required for the evaluation of the image data.

Motivated by these arguments, we developed an automated method for measurement of various metric and angular quantities used in the description of the lower extremity deformation in full-limb frontal X-ray images. The results of automated measurements are compared with manual measurements. These results demonstrate that an automated method can be a valuable alternative for the manual measurements.

@&#MATERIAL AND METHODS@&#

The study was conducted as a retrospective analysis of imaging data from anonymized examinations performed between February 2012 and April 2015 as a part of routine medical service provided by one of the authors (W.W.) institution. There were no exclusion criteria related to either a patient status or an image quality – the only condition for including an image in the study was that all joints of both limbs are entirely seen in the image. Totally, 88 consecutive X-ray full-limb images were analyzed (32 female, mean age 39 years, range from 17 to 67 years; 56 male, mean age 37 years, range from 10 to 66 years; entire cohort: mean age 38 years, range from 10 to 67 years).

The images were acquired with a computed radiography system Philips Digital Diagnost (Philips Medical Systems) with built-in 43cm×43cm flat panel detector. The modality supports imaging of long body parts like entire spine, lower or upper limbs. Whenever the size of the imaged body parts exceeds the required size of the field of view, images of consecutive sections of the body part are acquired and then stitched with a build-in functionality of the radiography system. The patients were imaged in standing position. Antero-posterior images were acquired with peak kilo-voltage 85kVp, exposition from 20mAs to 120mAs and magnification from 0.25 to 0.33. In the present study the region of interest contained lower limbs including iliac bone, hip, knee, and ankle joints. After acquisition the image data were transferred to a dedicated workstation, where manual measurements were done by one of the authors (W.W., board-certified radiologist with 20 years of experience) using the eFilm software (Merge Healthcare Inc.). Images were also saved to DICOM files for further automated analysis with the dedicated software developed in the present study. The deformities of the left and right legs were assessed independently resulting in 176 study cases. The data of 15 patients (30 study cases) were analyzed three times by the same reader at time intervals of two weeks to estimate the variability of manual measurements. The pixel size of the images was equal to 0.136mm. The average width of the analyzed images was equal to 3020 pixels (minimal 2985, maximal 3081, standard deviation 17). The average height of the images was equal to 8100 pixels (minimal 6718, maximal 8506, standard deviation 360). The images were coded with contrast resolution equal to 1 byte.

Anatomic axis of femur (line B in 
                        Fig. 1a) and tibia (line F in Fig. 1b) correspond to the diaphyseal midlines of these bones. The mechanical axis of the femur (line C in Fig. 1a) runs from the center of the femoral head (point P2 in Fig. 1a) to the center of the knee joint (P3 in Fig. 1a). The mechanical axis of the leg (Mikulicz line) runs from the center of the femoral head (P2 in Fig. 1a and c) to the center of the ankle joint (P6 in Fig. 1b and c).

Based on the frontal X-rays images of lower limbs the following quantities are determined in the present study for left and right limbs to quantitatively characterize the deformities of lower limbs:
                           
                              1.
                              The length of femur, which is measured from the highest point within intercondylar fossa of femur (point P3 in Fig. 1a) to the highest point at the boundary of the femoral head (P1 in Fig. 1a); additionally the difference between vertical positions of these highest left and right points is also measured (difference in hip joints);

The length of tibia, which is measured from the depression between the intercondylar tubercles of the intercondylar eminence of the proximal extremity of tibia (P5 in Fig. 1b) to the midpoint of the ankle joint surface of the distal extremity (P6 in Fig. 1b); additionally the difference between vertical position of these left and right midpoints is also measured (difference in ankle joints);

The distance from the Mikulicz line to the center of the knee joint (to P3) (Mikulicz distance-Fig. 1c);

Anatomical–mechanical femoral angle (aMFA), which is the angle between anatomical and mechanical axis of the femur (lines B and C in Fig. 1a);

Mechanical lateral distal femoral angle (mLDFA) is the angle between the tangent to the femoral condyles (line A in Fig. 1a) and Mikulicz line (Fig. 1c);

Anatomical lateral distal femoral angle (aLDFA) is the angle between the tangent to the femoral condyles and anatomical axis of the femur (line B in Fig. 1a);

Anatomical medial proximal tibial angle (aMPTA) is the angle between the tangent to the tibial plateau and the anatomical axis of the tibia (line F in Fig. 1b);

Anatomical lateral distal tibial angle (aLDTA) is the angle between the anatomical axis of the tibia and the tangent to the surface of the ankle joint (line E in Fig. 1b).

The measurement of the lengths of tibia and femur as well as the differences in hip and ankle joints is the means of assessing the left–right symmetry of the locomotor system. Mikulicz distance is used to distinguish between normal cases and either varus or valgus deformities. In the case of varus or valgus deformities mLDFA is used to distinguish between either tibial or femoral cases of the deformity. The remaining parameters are related to the shape of the bones and their load-bearing capacity, which should be optimal (aMFA is related to the length of a femoral neck, aLDFA, aMPTA, and aLDTA are related to the shape of the bone epiphyses).

@&#METHODS@&#

Generally, the main idea for automated assessment of the deformities of the lower limbs is to find the bone boundaries in X-rays images of limbs, because – given the bone boundaries – the characteristic point and axes can be found, what is necessary to qualitatively characterize the limb deformities. The detection algorithm consists of the flowing stages, which are described in detail below:
                           
                              1.
                              Extraction of the joint regions from the entire field of view (based on histogram of oriented gradients detector);

Approximate localization of joint contours, based on statistical information about typical bone shapes;

Correction of the statistical model prediction based on gradient information;

Extraction of bone diaphyses contours;

Extraction of characteristic points and axes and measurement.

Control images were saved to disc after every processing step. The mean duration time of every processing step was calculated based on the creation time of these images. Then, the total processing time was compared with the time used for manual assessment of radiographs, which was also recorded.

Histogram of oriented gradient (HOG) detector [12] was used to extract joint regions from X-rays images of the lower limbs. The detector was trained based on an image set composed of 30 randomly chosen study cases. The training was performed separately for each of the three joints (that is hip, knee and ankle joints). In each training image a rectangular region containing the joint of interest was manually drawn. In all training cases only right joints were marked. Then, the HOG descriptor was created for each marked region and a support vector (SVM) classifier was trained based on the descriptor vectors. The classifier was then applied to the remaining study cases and in all these cases the joint regions of interest were successfully detected (
                           Fig. 2). The detection was implemented in a way typical for this type of problem, i.e. a sliding window of varying size was created with top-left corner in every image pixel, then the HOG descriptor was calculated for each window, and if the HOG descriptor was sufficiently close to the class of desciptors learnt during the training, the window was marked as containing a meaningful object (a joint). Because the classifiers were trained based on the shapes of the right joints only, prior to the detection of left joints the original images were flipped horizontally. The detected joint regions were saved to files for further analysis. In the computations an implementation of the HOG detector provided in dlib library (dlib.net) was used (this implementation uses the HOG settings proposed in [13], in particular cell size equal to 8 pixels, 9 orientation bins and 31dimensional feature vector in every image pixel).

Active appearance model (AAM) [14] is one of the most powerful statistical methods used to localize object boundaries. Based on typical object shapes and appearances learnt from a training set, an image transformation is determined which minimizes an error between an actual object image and an instance of a statistical model of the object. Typically a shape of an object is modeled as a sum of a mean shape and a linear combination of eigenvector shapes derived from principal component analysis of the training examples. Similarly, the texture within an object is modeled as a sum of some mean texture and a linear combination of eigenvector textures learnt from the training set.

In the present study we used an implementation of AAM provided by the author of the method (http://personalpages.manchester.ac.uk/staff/timothy.f.cootes last access June 19th 2015). During the training phase the contours of joints were manually delineated in region of interest images created in the previous step and these statistical data acquired during the training stage were used to find joint contours for test objects (
                           Fig. 3). The ground truth (manual contours) data were also collected for the test images. The error of contour extraction was estimated as the mean distance between the AAM contour and the ground truth (manually drawn) contour. To accurately determine the quantities of interest, the bone contours must be determined quite well as the goal is to find angles of interest with error as small as possible. Unfortunately, we have found that AAM is not accurate enough for our application even if trained on substantially larger group than in the cased of a HOG detector. We have observed that increasing the training set over 50–60 study cases only marginally improves the performance of AAM. Training set contained maximally 120 study cases and even for such a large training group some corrections (as described in the next section) were necessary.

The manual outlining in training images was restricted only to joint surfaces and lateral and medial surfaces of bone extremities. AAM trained on contours containing parts of diaphyses behaved generally badly and was not able to correctly localize bone boundaries in test images even if trained on a large set (over 100) of images. We attribute this problem to a huge number of texture and shape variants in the analyzed set of X-rays images. This in turn creates a problem of finding the contours of diaphyses which are necessary to determine some anatomical axes, as described in the Materials section. This problem is not however very serious. To find the diaphysis contour of either femur or tibia we simply applied breadth first search algorithm to a gradient image. In particular we traced paths connecting corresponding end points of proximal and distal extremity contours, found by AAM (e.g. left end point of the tibia proximal extremity contour and the left end point of the tibia distal proximity contour). The paths were confined to cross the regions of the highest absolute values of horizontal gradients with an additional restriction that the horizontal gradient has correct orientation corresponding to the transition from bone to soft tissue regions (i.e. transition from high to low intensities). The applied variant of the breadth first search algorithm creates a priority queue with priority given by the absolute values of horizontal gradient. The queue is initially populated with a single seed element – the end point of an AAM contour. Then, all pixels – neighbors of the top element of the queue are added to the queue in the order specified by the corresponding values of horizontal gradient and the top element is recorded as the preceeding pixel for these neighbors. The top element is removed from the queue. The procedure is iterated until some stop condition is reached (e.g. the AAM contour on the opposite bone epiphysis is reached), Then, based on the information about preceeding pixels, the path is traced back to the seed element resulting in a sequence of pixels along diaphysis contour.

The successful fitting of the statistical model depends crucially on the initialization of the active appearance model. If the shape of the initial model is too different or localized too far from the actual object, the search for the optimal set of model parameters will not converge to a satisfactory solution. To avoid manual model initialization the following procedure was adopted. For each test image A we found such image T from the training set that the pixel-wise coefficient of linear correlation between gray-values of A and T was maximal. Prior to computing the correlation coefficient, each training image was rescaled to the size of Im. Because small detail are not very important at this stage, Im was downscaled to pixel size equal to about 0.5mm and both test and training images were blurred with a Gaussian filter. As the correlation coefficients were rather high (over 0.9), we applied Horn–Schunk method [15] to compute transformation between a test and a training image. Given the resulting optical flow field, the manual contour available for the training image (i.e. the sequence of consecutive points localized along an object boundary) was transformed to the space of the test image. This transformed contour was used as the first guess for the test object contour.

The pixel size of the analyzed images was equal to 0.145mm and the boundary of bones can be usually delineated manually with accuracy of 2–3 pixels. In contrast AAM-even if trained on a large set of images-does not achieve such accuracy mainly because of a huge number of possible texture and anatomic shape variants. Thus, to deliver reliable quantitative results, the AAM contours must be corrected to align them with the crest lines. AAM contours contain sections corresponding to lateral and medial borders of bone extremities and a section corresponding to the joint boundary. Keeping in mind the definitions of quantities of interest corrections should be applied only to the last of the three aforementioned sections.

The correction of AAM contours were based on an immediate observation that the proximal (distal) joint borders are characterized by a transition from low to high (high to low) intensities in the vertical direction. Thus, for each point of an AAM contour we searched within some neighborhood in a vertical direction for such a pixel P which had the highest absolute value of vertical gradient and correct gradient direction (
                           Fig. 4). In the calculations 10 pixel wide neighborhood in both direction was consistently used. The pixel P then replaced the AAM contour point in further analyses. Finally, given the corrected set of contour points a quadratic spline passing through the points was generated as the final estimate of joint borders.

An AAM contour consists of a sequence of consecutive points. By the construction of AAM it can be guaranteed that if for example points from n-th to m-th correspond in the training set to the contours of femur condyles, then this correspondence is still present after fitting an AAM to a test image.This observation is the base for our procedures for determining characteristic points and axes, necessary to quantitatively characterize the deformities of lower limbs.

Given that the spline curve along the top boundary of the femoral head is coded as a sequence of pixels, the highest point P1 (Fig. 1a) of this sector of the femur boundary can be immediately determined to be used in the calculation of the femur length. Because – by the construction of AAM – the points along a contour of the femoral head can be identified within the sequence of all contour points, an ellipse which best fits to these points was found using the least squares procedure. In particular the following model F(x,y) was fitted to the coordinate data:
                                 
                                    (1)
                                    
                                       
                                          F
                                          (
                                          x
                                          ,
                                          y
                                          )
                                          =
                                          
                                             
                                                ax
                                             
                                             
                                                2
                                             
                                          
                                          
                                             
                                                
                                                +
                                                
                                                2
                                                b
                                                x
                                                y
                                                
                                                +
                                                
                                                
                                                   cy
                                                
                                             
                                             
                                                2
                                             
                                          
                                          
                                          +
                                          
                                          2
                                          d
                                          x
                                          
                                          +
                                          
                                          2
                                          f
                                          y
                                          
                                          +
                                          
                                          g
                                       
                                    
                                 
                              where x and y are horizontal and vertical coordinates of a contour point, respectively and a, b, c, d, e, f and g are model parameters. After these parameters are found, the coordinates xF
                               and yF
                               of the center of the femoral head P2 (Fig. 1a) used to determine the mechanical axes of the femur and of the leg are:
                                 
                                    (2)
                                    
                                       
                                          
                                             
                                                x
                                             
                                             
                                                f
                                             
                                          
                                          =
                                          
                                             (
                                             
                                                c
                                                d
                                                −
                                                b
                                                f
                                             
                                             )
                                          
                                          /
                                          
                                             (
                                             
                                                
                                                   
                                                      b
                                                   
                                                   2
                                                
                                                −
                                                a
                                                c
                                             
                                             )
                                          
                                          
                                             
                                                y
                                             
                                             
                                                f
                                             
                                          
                                          =
                                          
                                             (
                                             
                                                a
                                                f
                                                −
                                                b
                                                d
                                             
                                             )
                                          
                                          /
                                          
                                             (
                                             
                                                
                                                   
                                                      b
                                                   
                                                   2
                                                
                                                −
                                                a
                                                c
                                             
                                             )
                                          
                                       
                                    
                                 
                              
                           

The highest point P3 within intercondylar fossa of femur (necessary in the calculation of the femur length) is found after fitting parabola to the section of the contour corresponding to the fossa. Then the highest point corresponds to the maximum of this parabola. Finally, we find a point P4 at the half of the femur length at the midline of the femur diaphysis. We assume that the anatomical axis B of the femur crosses P3 and approximates best the midline between left and right borders of the femur diaphysis. The approximation is limited to a part of the diaphysis with length equal to 1/3 of the length of the femur and centered at P3. The mechanical axis C of the femur crosses P2 and P3.

To find the tangent to the femoral condyles we construct the convex hull for the sector of the corrected AAM contour corresponding to the proximal knee joint surface. The search for the convex hull starts from the lateral side and proceeds to the medial side. The single sector of the resulting polygonal chain which starts within the lateral condyle and ends within the medial condyle is the required tangent A.

The length of the tibia is measured from a depression between intercondylar tubercles (P5 in Fig. 1b). AAM, even after gradient-based corrections, provides only rough localization of the rectangular region containing the depression. For this reason methods described in previous section (like fitting some curve to the joint boundary) are not accurate enough to use them to determine coordinates of P5. Instead, we used some low-level processing for this purpose. In particular, the region of interest (ROI) containing the depression was roughly estimated from the coordinates of AAM points corresponding to the apexes of the intercondylar tubercles. Next Gaussian filter with width equal to 2 pixels was applied to the ROI and the gray-level intensities were rescaled to the range from 0 to 255. Histogram of gray-level intensities was calculated and smoothed with a running average (width of 11 points). Finally, the minimum of the histogram was localized between modes corresponding to bone and soft tissue regions and ROI was thresholded with the threshold set at this minimum. In the resulting binary image (where white color corresponded to bone) only the largest white connected component was left and the black pixel with the lowest vertical coordinate was identified as the bottom of the depression between intercondylar tubercles i.e. P5.

The length of tibia is measured to the midpoint of the proximal border of the ankle joint (P6 in Fig. 1b). Because there is no salient feature which can be attributed to this point, we decided to use as P6 this AAM contour point which was localized in the midpoint of the proximal border of the ankle joint in the training images.

The presence of the fibula can made the borders of the diaphysis of the tibia less clearly distinguishable than in the case of femur. Thus, to determine the anatomical axis of the tibia we determined a middle 1/3 (i.e. the part of the diaphysis centered at P7 in Fig. 1b and length equal to 1/3 pf the length of the tibia) and based on the information about left and right borders of this part of the diaphysis the midline of the diaphysis was determined (the anatomical axis of the tibia – line F in Fig. 1b).

The shape of the proximal border of the ankle joint is too complicated to unequivocally define a tangent to the distal extremity of the tibia. Instead, to calculate aLDTA, we determined a tangent to the talus bone, which has much more clear borders in X-rays images. The tangent to the talus bone was determined with the convex hull method described in the previous section. After shifting the tangent to P6 we finally get the requested line E, necessary to calculate aLDTA.

The last line to be determined is the tangent to the tibial plateau. Unfortunately, due to the projection nature of the X-rays imaging, the tibial plateau is not manifested in all X-ray images. Thus, to determine the reference line D, corresponding to the requested tangent, the following procedure was adopted. The sectors of the knee borders (coded as a sequence of pixels) corresponding to the lateral and medial condyles of the tibia were examine pixel by pixel from the interior towards the exterior parts of the condyles. The first pixel in which the absolute value of the horizontal component of the gradient became greater than the vertical component of the gradient was designated as the apex of the condyle. A line passing through the apexes of the lateral and medial condyle was identified with the tangent to the tibial plateau (line D in Fig. 1b).

The manual and automated measurements were correlated and the degree of correlation was expressed with the Pearson’s coefficient of linear correlation r. The significance of this correlation was tested. Student’s paired t-test was used to check if there are differences between manual and automated measurements. The test of the difference between two correlation coefficients was used to check if there are differences between the correlation coefficient calculated for manual and automated measurement and the correlation coefficient calculated for any two repeated manual measurements. One-way repeated measures ANOVA was used to test if there are differences between the results of any pair of manual measurements. In all tests significance level of 0.001 was used. Bland–Altman plots with 95% agreement limits were used to visualize the agreement between manual and automated measurements.

@&#RESULTS@&#

Thirty study cases were analyzed manually three times by the same reader (W.W.) to estimate variability of the manual measurements. The Pearson’s coefficient of correlation between the three series of manual measurements as well as the maximal difference between these measurements are presented in 
                     Table 1. The correlations between any two series of manual measurements were significant. There were no significant differences between any pair of correlation coefficients calculated for the three series of manual measurements (p-values of the test of difference between correlation coefficients are shown in second column of Table 1). The maximal discrepancies between any pair of individual measurements are also shown in the table. One-way repeated measures ANOVA indicated that there were no statistically significant differences between the results of the three manual measurements (p-values of ANOVA test are shown in the third column of Table 1). Note that the differences between repeated measurements of angular quantities can be quite large, equal to even 4 degrees. Also, there are big discrepancies between repeated manual measurements of the Mikulicz distance (up to 3mm).

The data set of 176 cases was divided randomly into a training set of 66 cases and a test set of 110 cases. Thirty training cases were used to train the histogram of oriented gradients-based detector of joint regions and all 66 training cases were used to train Active Appearance Model-based detector of joints contours. A sample image with automatically detected characteristic axes, tangents and points is shown in 
                     Fig. 5. For the sample image there is a difference between automatically and manually assessed left aMFA equal to 1 degree. Note that the error in determining the angular variables follows from the positioning of the two lines defining the angle of interest. For example, 1 degree difference can result from shifting the ends of mechanical and anatomical axes of a femur by a distance equal to the size of dots placed in characteristic points in the figure. The Pearson’s coefficients of correlation between the manual and automated measurements and the maximal differences between the manual and automated measurements are presented in 
                     Table 2 for the test cases. The correlations between automated and manual measurements were significant. In the case of metric quantities these coefficients were larger than 0.99, except for the difference in the vertical positions of ankle joints. For all metric quantities the values of the correlation coefficient were in the range found for the correlation coefficients between repeated manual measurements and there were no significant differences between respective coefficients of correlation shown in Table 1 and Table 2 (p-values of the test of the significance of the difference between two correlation coefficients larger than 10%, except femur length in which case the coefficient of correlation between manual and automated measurements was significantly larger than the correlation coefficients between pairs of manual measurements). The correlation coefficients between angular quantities measured with automated and manual methods are also high, although not as high as for metric quantities. Except aMFA and mLDFA these correlation coefficients were in the range found for the correlation coefficients between repeated manual measurements. In the case of mLDFA the p-value of the test of the significance of the difference between the two correlation coefficients was equal to 0.15% so the difference between the respective coefficients of correlations shown in Tables 1 and 2 was at the limit of the assumed significance level (0.1%).

The p-values of the t-test are also shown in Table 2. Only in the case of aMFA and mLDFA the differences were significant. However, there was non-zero bias of the automated measurement related to the manual measurements of these two quantities. The bias was equal to 0.46 degrees and −0.64 degrees for aMFA and mLDFA, respectively. After removing the bias, automated and manual measurements of either aMFA or mLDFA were not statistically different. The agreement between automated and manual measurements is demonstrated in 
                     Fig. 6 and 
                     Fig. 7 for metric and angular quantities, respectively. In these plots the limits of 95% agreement (horizontal lines) are also shown.

The discrepancies between manual and automated measurements of metric quantities are almost the same as the discrepancies between repeated manual measurements. The discrepancies between automated and manual measurements of the length of either tibia or femur can be neglected as they do not exceed 0.5mm (that is, 4 pixels). For other metric parameters (differences between vertical position of the highest points in the femoral head of the left and right hip, difference between vertical position of the central points of the left and right ankle joint, Mikulicz distance) these discrepancies are however larger. The Bland–Altman plots show that such larger discrepancies, exceeding 95% agreement lines, are observed for isolated cases – totally 10 cases for the three aforementioned quantities. In the case of angular quantities, as for metric quantities, the Bland–Altman plots show that larger discrepancies, exceeding 95% agreement lines, are observed only for isolated cases. The discrepancies between automated and manual measurements are however still in the same range as in the case of repeated manual measurements. The likely causes for the apparently worse performance of automated measurements of aMFA and mLDFA are discussed in the next section.

The computations were run on a Pentium Dual Core E5300, 2.60GHz, 3.25GB RAM machine (single core was only used). The duration time of the detection of joint regions was equal on average to 4s per a joint (24s on average for a full radiogram). The duration time of the initial localization of the mean AAM shape and AAM fitting was equal on average to 15s per a joint (90s on average for a full radiogram). The total time duration of the remaining steps was equal to 10s for a full radiogram. The training time was longer but the length of the training phase does not influence the processing speed at the testing stage. However, for 30 training shapes for HOG-based detector of joint regions or 66 training shapes for AAM it was still shorter than 5min. In contrast, the average duration time of the manual assessment of the radiographs was equal to 12min.

@&#DISCUSSION@&#

In the paper we have described a system for comprehensive analysis of the deformities of lower extremities based on the analysis of full-limb X-rays images. The system is fully automatic. The purpose of the study was achieved. A very good agreement between the results of automated and manual measurements has been demonstrated what suggests that the developed framework can be an alternative for manual measurements. Another advantage of the proposed framework is the processing speed, as the time necessary for assessment of deformities has been reduced from over a dozen minutes for a manual method to about two minutes for an automated method. Because the implementation is partially based on open-source libraries and is not optimized for the problem in hand, we expect that the processing time can be further reduced.

Our automated measurement method can be compared with methods used for the same purpose by other authors. In [16–20] antero-posterior full limb radiographs made in standing position were analyzed to determine the deformities of the lower limbs. In these papers the authors used semi-automated methods which were essentially dependent on manual interaction with a user, who was asked to put manually some characteristic points in predefined landmark positions. Then, based on the coordinates of these marker points the quantities of interest were determined. In all aforementioned papers the authors reported that measurements based on manually set predefined landmark points are characterized by higher precision (lower intra- and inter-reader variability) than measurements based on manually drawing lines necessary to determine the angular variables of interest. It should be noted that the problem of automated segmentation of bones from limb radiographs has been addressed previously [21–23] but it has not been demonstrated that the quality of segmentation is good enough to ensure reliable assessment of the leg deformities (that is, an agreement with manual assessment of deformities has not been demonstrated).

It has been shown in the present study that the discrepancies between repeated manual measurements performed by an experienced radiologist can be as large as 4 degrees for aMPTA and 3mm for Mikulicz distance. Compared to the width of the physiological ranges of angular quantities, which do not exceed 6 degrees [1] or the width of physiological range of Mikulicz distance (4mm) [1] it is clear that these discrepancies cannot be neglected. These high values of discrepancies, which are an immediate effect of uncertainties related to analysis of projective X-rays images highlight the need of an algorithmic approach to the process of measurement. In particular, such an algorithmic approach should follow the consecutive steps of the framework developed in the present study. Based on some predefined image features anatomical landmarks were automatically selected to determine planes and axes of interest. Then, the landmarks can be found consistently in the dataset of all analyzed images, enforcing reliable comparison of the results, more accurate quantitative diagnosis and better estimation of the effects of therapy. The problem of standardization can be brought to the problem of selecting appropriate features specifying the landmarks.

The discrepancies between manual and automated measurements of metric quantities were observed for isolated cases. Careful analysis of the image data shows that in 7 out of 10 cases these discrepancies were due to uncertainties of manual measurements, related to poor contrast of bone edges or structures of interest obscured by other structures. In the remaining 3 cases there were errors in automated localizing of the highest point within intercondylar fossa of femur or the central point of the ankle joint. Because the problems with automated detection occurred for a few cases only, we did not have enough data to design a procedure which will correct these errors in an automated manner.

In the case of angular variables discrepancies between manual and automated measurements were found also in isolated cases. If uncertainties occurred in manual procedures then – besides reasons mentioned above – they followed from uncertain determination of tangents to joint surfaces, which in turn followed from poor contrast or flexion or rotation of the leg during image acquisition. Apparently, the worst performance has been found for aMFA and mLDFA. However, it should be pointed out that estimation of both aMFA and mLDFA requires prior selection of the central point of the femoral head. This anatomical landmark is not salient. Automated determination of its location required fitting an ellipse to the femoral head and then finding the origin of the ellipse. Obviously, direct application of this procedure in a manual measurement would be cumbersome. We expect that it would be difficult to propose common algorithmic rules which should be followed in both automated and manual determination of the center of the femoral head as such rules would not be practical to apply them in a routine work. We attribute the decreased correlation between manual and automated measurements of aMFA and mLDFA to the problems with precise determination of this landmark in manual measurements.

Important modules of the proposed framework are derived from powerful methods of machine learning in the domain of image analysis, which can be applied in the analysis of a broad class of problems. However we had to support these methods with domain-specific corrections which were essential for the final good performance of the proposed framework. The combination of both provided satisfactory solution to the problem in hand.

The main limitation of the present study is that the developed framework can be applied to X-rays images only. Whenever surgical correction of the deformations is likely, the accuracy of the analysis may not be sufficient. However the assumption of the present study was to design a computer-aided detection system supporting current gold standard X-rays – based method for assessment of deformities of lower extremities and this purpose has been achieved. Surgical intervention requires prior CT scan in which case 3D analysis can be performed based on data with much better quality than analyzed in the present study [24].

It should be also noted that with the data in hand (prospective data collected from routinely performed X-ray examinations) we are not able to estimate accuracy of either manual or automated measurement because gold standard measurement for this case should involve analysis of e.g. 3D CT data corresponding to a given X-ray image. This would however require collecting an extra CT image for every patient undergoing X-rays what is associated with additional dose of ionizing radiation. Strong medical indication for such an experiment can be hardly found.

In conclusion, we have developed an automated framework for assessment of deformities of lower limbs in frontal X-rays images. The accuracy of the framework is comparable with the accuracy of manual measurements.

None.

@&#REFERENCES@&#

