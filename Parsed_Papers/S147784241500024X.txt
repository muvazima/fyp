@&#MAIN-TITLE@&#The abstract domain of Trapezoid Step Functions

@&#HIGHLIGHTS@&#


               
                  
                  
                     
                        
                           
                           The domain of Trapezoid Step Functions is introduced for the static analysis on continuous functions׳ values.


                        
                        
                           
                           The domain is a (proper) refinement of the Interval Valued Step Function Domain.


                        
                        
                           
                           A constructive abstraction procedure is provided that deals with floating point precision issues.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Abstract domain

Abstract interpretation

Continuous functions

Embedded software

Static analysis

@&#ABSTRACT@&#


               
               
                  The Trapezoid Step Functions (TSF) domain is introduced in order to approximate continuous functions by a finite sequence of trapezoids, adopting linear functions to abstract the upper and the lower bounds of a continuous variable in each time slot. The lattice structure of TSF
                     is studied, showing how to build and compute a sound abstraction of a given continuous function. Experimental results underline the effectiveness of the approach in terms of both precision and efficiency with respect to the domain of Interval Valued Step Functions (IVSF).
               
            

@&#INTRODUCTION@&#

Embedded software is made up of discrete (that is, the program) and continuous (that is, the physical environment) components. The program receives inputs from the physical environment through sensors that are usually modeled by volatile variables. Embedded software often deals with safety critical systems, like flight controllers. The reliability of these systems is crucial: even a single bug can result in a disaster, and this is a relevant challenge for formal verification methods. Static analysis is aimed at over-approximating the concrete semantics of a program in a computable way to prove properties that are satisfied by all possible executions. In the context of embedded software, safety properties are particularly important, and it is necessary to precisely approximate both the discrete and the continuous system.

On one hand, there is a large literature on the static analysis of discrete programs. On the other hand, these approaches do not perform well when they are applied to continuous environments. For instance, in the context of the abstract interpretation framework [1,2], the Interval domain [1] abstracts continuous systems with the minimal and the maximal values a sensor can return at any time. This approach is definitely too rough for the static analysis of embedded programs. Bouissou and Martel [3] proposed the Interval Valued Step Functions (IVSF) domain for approximating the behavior of a function in a given interval of time (i.e, a step) with the minimal and the maximal values the function could achieve during that period of time.

In this work (that extends [4]) we go one step further by introducing the Trapezoid Step Functions (TSF) domain. TSF
                     abstracts the values of a function in a given time slot with two linear functions, tracking in this way linear relationships between the time and the output value. Our work is inspired by the evolution of numerical domains. Since the Interval domain is not precise enough in many contexts, various relational domains (e.g., Polyhedra [5] and Octagons [6]) have been introduced. In a similar way, our domain, instead of tracking the minimal and the maximal values of a function in a given time slot, tracks two linear functions that approximate values of the function as a linear multivalued function [7,8]. The two linear functions, together with the two vertical lines that delimit the time slot, form a trapezoid. We approximate the function with a finite number of trapezoids, one for each step.

Consider, for instance, Fig. 1
                     . It compares the 4-steps abstraction of 
                        f
                        =
                        sin
                        (
                        x
                        )
                      by TSF
                     (on the left) and by IVSF
                     (on the right) in the interval 
                        [
                        0
                        ,
                        2
                        π
                        ]
                     . These plots make clear that in general TSF
                     better approximates the shape of the function using trapezoids rather than the rectangles obtained with IVSF.

In Fig. 2
                      we can see the abstraction of the same function (
                        sin
                        (
                        x
                        )
                     ) with the same number of steps (4) on a restricted domain (
                        [
                        0
                        ,
                        π
                        /
                        2
                        ]
                     ). This scenario is quite different from Fig. 1, but also in this case the plots show that TSF
                     is quite more precise than IVSF.

Of course, with a suitable choice of the time steps, the precision improvement obtained by using trapezoids further increases, as depicted in Fig. 2. Moreover, if the width of steps is not fixed, TSF
                     can be seen as a refinement of IVSF
                     that yields a more accurate function representation, as depicted in Fig. 3
                     .

The main contributions of this paper are:
                        
                           •
                           the formal definition of TSF
                              and its lattice operators,

the introduction of a sound abstraction function that, given a continuous and derivable function, builds up its abstraction in TSF, and

the discussion of some experimental results and the comparison with the ones obtained by IVSF.

The paper is structured as follows. The rest of this section introduces a motivating example and recalls some basic concepts of abstract interpretation. Sections 2 and 3 formalize the domain and the abstraction function. In Section 4 we present some experimental results when applying TSF
                     to the abstraction of different functions, and how our results compare with IVSF. Section 5 discusses the related work and Section 6 concludes.

Our motivating example concerns a special case of hybrid system, where we have a discrete system (an embedded program) which takes a continuous environment as input.

Consider the program in Fig. 4
                        . This is the code of an integrator, a quite common component of embedded programs. It has been inspired by [9] and it is the example used in [3] in order to show the main features of IVSF. This code integrates a function (whose values are provided through the volatile variable x) using the rectangle method on a sampling step h. We assume that the function we integrate is 
                           sin
                           (
                           2
                           π
                           t
                           )
                        , and that the input data are given by a sensor (hence the volatile variable x) at a frequency of 8KHz. This scenario is particularly interesting for the analysis of numerical precision, since the sensor will produce the sequence of values 
                           [
                           0
                           ,
                           
                              
                                 
                                    
                                       
                                          2
                                       
                                    
                                 
                                 
                                    2
                                 
                              
                           
                           ,
                           1
                           ,
                           
                              
                                 
                                    
                                       
                                          2
                                       
                                    
                                 
                                 
                                    2
                                 
                              
                           
                           ,
                           0
                           ,
                           −
                           
                              
                                 
                                    
                                       
                                          2
                                       
                                    
                                 
                                 
                                    2
                                 
                              
                           
                           ,
                           −
                           1
                           ,
                           −
                           
                              
                                 
                                    
                                       
                                          2
                                       
                                    
                                 
                                 
                                    2
                                 
                              
                           
                           ]
                         on x. Therefore, in a perfect arithmetic computation the summation of these values multiplied by h will be equal to zero after 
                           8
                           ×
                           i
                         iterations 
                           ∀
                           i
                           ∈
                           N
                        . Nevertheless, in a real system this summation would produce some approximate values because of floating point approximation. This code is particularly interesting to test the precision of abstract domains since it propagates the approximation error of our abstract domain at each iteration of the while loop, and therefore it is a good candidate to test the precision of TSF.

Abstract interpretation [1,2] is a framework to define and prove the soundness of abstractions. Usually, concrete states are composed by sets of elements (e.g., all the possible computational states, or a set of continuous functions), that are approximated by a unique element (also referred to as an abstract state) in the abstract domain. Formally, the concrete domain 
                           ℘
                           (
                           D
                           )
                         forms a complete lattice 
                           〈
                           ℘
                           (
                           D
                           )
                           ,
                           ⊆
                           ,
                           ∅
                           ,
                           D
                           ,
                           ∪
                           ,
                           ∩
                           〉
                        . Similarly, the abstract domain 
                           A
                         has to form a lattice 
                           〈
                           A
                           ,
                           
                              
                                 ≤
                              
                              
                                 A
                              
                           
                           ,
                           
                              
                                 ⊥
                              
                              
                                 A
                              
                           
                           ,
                           
                              
                                 ⊤
                              
                              
                                 A
                              
                           
                           ,
                           
                              
                                 ⊔
                              
                              
                                 A
                              
                           
                           ,
                           
                              
                                 ⊓
                              
                              
                                 A
                              
                           
                           〉
                         as well.
                           1
                        
                        
                           1
                           This can be weakened into a partial order where over-approximations of the concrete least upper bound and greatest lower bound exist.
                         The concrete and abstract domains are related by a concretization 
                           
                              
                                 γ
                              
                              
                                 A
                              
                           
                         and an abstraction 
                           
                              
                                 α
                              
                              
                                 A
                              
                           
                         functions. The abstract domain is a sound approximation of the concrete domain if 
                           
                              
                                 γ
                              
                              
                                 A
                              
                           
                         and 
                           
                              
                                 α
                              
                              
                                 A
                              
                           
                         form a Galois connection. When abstract domains do not satisfy the ascending chain condition, a widening operator 
                           
                              
                                 ∇
                              
                              
                                 A
                              
                           
                         is required in order to guarantee the convergence of the fixed point computation.

In this section, we first introduce the concrete domain. Then we formalize the lattice structure of our abstract domain. Finally, we introduce a widening operator that is necessary for ensuring the convergence of the analysis on this domain.

In this way, we provide a complete definition of an abstract domain that can be used not only to abstract single functions (as we did in the experimental results), but also to abstract a set of functions (e.g., to take into account some rounding approximations).

The concrete domain 
                           D
                         is defined as the powerset of continuous functions in 
                           
                              
                                 R
                              
                              
                                 +
                              
                           
                           →
                           R
                         (i.e., the set 
                           
                              
                                 C
                              
                              
                                 +
                              
                           
                        ): 
                           
                              
                                 D
                                 =
                                 ℘
                                 (
                                 
                                    
                                       C
                                    
                                    
                                       +
                                    
                                 
                                 )
                              
                           
                        Since in the scenario of embedded programs the input variable represents the time, the functions׳ domain is 
                           
                              
                                 R
                              
                              
                                 +
                              
                           
                         instead of 
                           R
                        .

Let us first introduce the key idea behind our domain. Given a function f and a finite set of ordered indices 
                           
                              
                                 {
                                 
                                    
                                       t
                                    
                                    
                                       i
                                    
                                 
                                 }
                              
                              
                                 0
                                 ≤
                                 i
                                 ≤
                                 N
                              
                           
                        , we approximate the values of f in a step 
                           [
                           
                              
                                 t
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 t
                              
                              
                                 i
                                 +
                                 1
                              
                           
                           ]
                         by a trapezoid whose (i) two parallel sides are vertical, in correspondence of t
                        
                           i
                         and 
                           
                              
                                 t
                              
                              
                                 i
                                 +
                                 1
                              
                           
                        , and (ii) the other two sides are in the form 
                           
                              
                                 f
                              
                              
                                 −
                              
                           
                           (
                           x
                           )
                           =
                           
                              
                                 m
                              
                              
                                 −
                              
                           
                           x
                           +
                           
                              
                                 q
                              
                              
                                 −
                              
                           
                         and 
                           
                              
                                 f
                              
                              
                                 +
                              
                           
                           (
                           x
                           )
                           =
                           
                              
                                 m
                              
                              
                                 +
                              
                           
                           x
                           +
                           
                              
                                 q
                              
                              
                                 +
                              
                           
                         and approximate lower and upper values of f inside 
                           [
                           
                              
                                 t
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 t
                              
                              
                                 i
                                 +
                                 1
                              
                           
                           ]
                        . For instance, Fig. 5
                         depicts a trapezoid defined on the step 
                           [
                           0
                           ,
                           3
                           ]
                         with 
                           
                              
                                 f
                              
                              
                                 −
                              
                           
                           (
                           t
                           )
                           =
                           0.33
                           t
                           +
                           1
                         and 
                           
                              
                                 f
                              
                              
                                 +
                              
                           
                           (
                           t
                           )
                           =
                           −
                           0.17
                           t
                           +
                           3.5
                         as lower and upper sides, respectively.

Formally, given a step 
                           [
                           
                              
                                 t
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 t
                              
                              
                                 i
                                 +
                                 1
                              
                           
                           ]
                        , a single trapezoid is defined by two linear functions, and each of these two functions is defined by two real numbers representing the slope and intercept. Therefore, the pair of sides of each trapezoid is defined by a tuple 
                           v
                           =
                           (
                           
                              
                                 m
                              
                              
                                 −
                              
                           
                           ,
                           
                              
                                 q
                              
                              
                                 −
                              
                           
                           ,
                           
                              
                                 m
                              
                              
                                 +
                              
                           
                           ,
                           
                              
                                 q
                              
                              
                                 +
                              
                           
                           )
                        , where 
                           
                              
                                 m
                              
                              
                                 −
                              
                           
                           ,
                           
                              
                                 q
                              
                              
                                 −
                              
                           
                           ,
                           
                              
                                 m
                              
                              
                                 +
                              
                           
                           ,
                           
                              
                                 q
                              
                              
                                 +
                              
                           
                           ∈
                           R
                           ∪
                           {
                           −
                           ∞
                           ,
                           +
                           ∞
                           }
                        , which represents the two lines 
                           
                              
                                 f
                              
                              
                                 −
                              
                           
                           (
                           x
                           )
                           =
                           
                              
                                 m
                              
                              
                                 −
                              
                           
                           x
                           +
                           
                              
                                 q
                              
                              
                                 −
                              
                           
                         and 
                           
                              
                                 f
                              
                              
                                 +
                              
                           
                           (
                           x
                           )
                           =
                           
                              
                                 m
                              
                              
                                 +
                              
                           
                           x
                           +
                           
                              
                                 q
                              
                              
                                 +
                              
                           
                        . We denote by 
                           
                              
                                 f
                              
                              
                                 −
                              
                           
                         and 
                           
                              
                                 f
                              
                              
                                 +
                              
                           
                         the lower and the upper side, respectively. TSF
                        can be seen as a generalization of IVSF, whose two horizontal sides are parallel, i.e., with 
                           
                              
                                 f
                              
                              
                                 +
                              
                           
                           (
                           x
                           )
                           =
                           
                              
                                 q
                              
                              
                                 +
                              
                           
                         and 
                           
                              
                                 f
                              
                              
                                 −
                              
                           
                           (
                           x
                           )
                           =
                           
                              
                                 q
                              
                              
                                 −
                              
                           
                        .

Note that the two lines of a trapezoid in TSF
                        can also go to 
                           ∞
                        . In our domain, this is represented by 
                           
                              
                                 q
                              
                              
                                 −
                              
                           
                           =
                           −
                           ∞
                         or 
                           
                              
                                 q
                              
                              
                                 +
                              
                           
                           =+
                           ∞
                        .
                           2
                        
                        
                           2
                           The numerical order relationship 
                                 ≤
                               is extended to consider 
                                 −
                                 ∞
                               and 
                                 +
                                 ∞
                              .
                        
                     

Following the standard notation on step functions [3], consider a generic set V of values. These values could be simple numbers (integer, reals, etc.) but also more complex structures like intervals or tuples. In our domain, a value will be composed by two lines, the upper (
                           
                              
                                 f
                              
                              
                                 +
                              
                           
                        ) and the lower (
                           
                              
                                 f
                              
                              
                                 −
                              
                           
                        ) side of trapezoids. Then, we represent a step function from time to V as a conjunction of constraints of the form “ 
                           
                              
                                 t
                              
                              
                                 i
                              
                           
                           :
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                        ” such that 
                           
                              
                                 t
                              
                              
                                 i
                              
                           
                           ∈
                           
                              
                                 R
                              
                              
                                 +
                              
                           
                           ∧
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                           ∈
                           V
                        . This means that the step function switches to 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                         at time t
                        
                           i
                        . For 
                           t
                           ∈
                           [
                           
                              
                                 t
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 t
                              
                              
                                 i
                                 +
                                 1
                              
                           
                           )
                         the function respects the constraints represented by value 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                        . When 
                           t
                           =
                           
                              
                                 t
                              
                              
                                 i
                                 +
                                 1
                              
                           
                        , the abstract value of the function switches “abruptly” to 
                           
                              
                                 v
                              
                              
                                 i
                                 +
                                 1
                              
                           
                        . We consider only finite conjunctions of constraints, otherwise the abstract operations of our domain would not be computable. A finite sequence of constraints 
                           f
                           =
                           
                              
                                 t
                              
                              
                                 0
                              
                           
                           :
                           
                              
                                 v
                              
                              
                                 0
                              
                           
                           ∧
                           
                              
                                 t
                              
                              
                                 1
                              
                           
                           :
                           
                              
                                 v
                              
                              
                                 1
                              
                           
                           ∧
                           ⋯
                           ∧
                           
                              
                                 t
                              
                              
                                 N
                              
                           
                           :
                           
                              
                                 v
                              
                              
                                 N
                              
                           
                         represents the step function f such that 
                           ∀
                           t
                           ∈
                           
                              
                                 R
                              
                              
                                 +
                              
                           
                           :
                           f
                           (
                           t
                           )
                           =
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                         with 
                           i
                           =
                           max
                           (
                           {
                           j
                           ∈
                           [
                           0
                           ,
                           N
                           ]
                           :
                           
                              
                                 t
                              
                              
                                 j
                              
                           
                           ≤
                           t
                           }
                           )
                        . We use the compact notation 
                           f
                           =
                           
                              
                                 ⋀
                              
                              
                                 0
                                 ≤
                                 i
                                 ≤
                                 N
                              
                           
                           
                              
                                 t
                              
                              
                                 i
                              
                           
                           :
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                        , with 
                           N
                           ∈
                           N
                           ∧
                           ∀
                           i
                           ∈
                           [
                           0
                           ,
                           N
                           ]
                           :
                           (
                           
                              
                                 t
                              
                              
                                 i
                              
                           
                           ∈
                           
                              
                                 R
                              
                              
                                 +
                              
                           
                           ∧
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                           ∈
                           V
                           )
                        . V is the set of tuples 
                           {
                           (
                           
                              
                                 m
                              
                              
                                 −
                              
                           
                           ,
                           
                              
                                 q
                              
                              
                                 −
                              
                           
                           ,
                           
                              
                                 m
                              
                              
                                 +
                              
                           
                           ,
                           
                              
                                 q
                              
                              
                                 +
                              
                           
                           )
                           :
                           
                              
                                 m
                              
                              
                                 −
                              
                           
                           ,
                           
                              
                                 q
                              
                              
                                 −
                              
                           
                           ,
                           
                              
                                 m
                              
                              
                                 +
                              
                           
                           ,
                           
                              
                                 q
                              
                              
                                 +
                              
                           
                           ∈
                           R
                           ∪
                           {
                           −
                           ∞
                           ,
                           +
                           ∞
                           }
                           }
                        . To lighten up the notation, a quadruple 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                           =
                           (
                           
                              
                                 m
                              
                              
                                 i
                              
                              
                                 −
                              
                           
                           ,
                           
                              
                                 q
                              
                              
                                 i
                              
                              
                                 −
                              
                           
                           ,
                           
                              
                                 m
                              
                              
                                 i
                              
                              
                                 +
                              
                           
                           ,
                           
                              
                                 q
                              
                              
                                 i
                              
                              
                                 +
                              
                           
                           )
                         denotes 
                           
                              
                                 f
                              
                              
                                 i
                              
                              
                                 −
                              
                           
                           (
                           t
                           )
                           =
                           
                              
                                 m
                              
                              
                                 i
                              
                              
                                 −
                              
                           
                           t
                           +
                           
                              
                                 q
                              
                              
                                 i
                              
                              
                                 −
                              
                           
                         and 
                           
                              
                                 f
                              
                              
                                 i
                              
                              
                                 +
                              
                           
                           (
                           t
                           )
                           =
                           
                              
                                 m
                              
                              
                                 i
                              
                              
                                 +
                              
                           
                           t
                           +
                           
                              
                                 q
                              
                              
                                 i
                              
                              
                                 +
                              
                           
                        . We will alternatively denote a step value as 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                           =
                           (
                           
                              
                                 m
                              
                              
                                 i
                              
                              
                                 −
                              
                           
                           ,
                           
                              
                                 q
                              
                              
                                 i
                              
                              
                                 −
                              
                           
                           ,
                           
                              
                                 m
                              
                              
                                 i
                              
                              
                                 +
                              
                           
                           ,
                           
                              
                                 q
                              
                              
                                 i
                              
                              
                                 +
                              
                           
                           )
                         or 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                           =
                           (
                           
                              
                                 f
                              
                              
                                 i
                              
                              
                                 −
                              
                           
                           ,
                           
                              
                                 f
                              
                              
                                 i
                              
                              
                                 +
                              
                           
                           )
                        .

For example, the step function h with two steps 
                           
                              
                                 t
                              
                              
                                 0
                              
                           
                           =
                           0
                           ,
                           
                              
                                 t
                              
                              
                                 1
                              
                           
                           =
                           3
                         with values, respectively, 
                           
                              
                                 v
                              
                              
                                 0
                              
                           
                           =
                           (
                           1
                           ,
                           −
                           1
                           ,
                           2
                           ,
                           1
                           )
                           ,
                           
                              
                                 v
                              
                              
                                 1
                              
                           
                           =
                           (
                           0
                           ,
                           3.5
                           ,
                           
                              
                                 
                                    1
                                 
                                 
                                    3
                                 
                              
                           
                           ,
                           4
                           )
                         will be written as 
                           h
                           =
                           (
                           0
                           :
                           (
                           1
                           ,
                           −
                           1
                           ,
                           2
                           ,
                           1
                           )
                           )
                           ∧
                           (
                           3
                           :
                           (
                           0
                           ,
                           3.5
                           ,
                           
                              
                                 
                                    1
                                 
                                 
                                    3
                                 
                              
                           
                           ,
                           4
                           )
                           )
                        . The graphical representation of h is depicted in Fig. 6
                        , where we can see the two trapezoids composing the step function. On the upper and lower sides of the trapezoids we reported the equations of the corresponding lines.

However, different abstract values may represent exactly the same step function. For example, the conjunctions 
                              (
                              0
                              :
                              (
                              0
                              ,
                              0
                              ,
                              1
                              ,
                              1
                              )
                              )
                              ∧
                              (
                              4
                              :
                              (
                              0
                              ,
                              0
                              ,
                              1
                              ,
                              1
                              )
                              )
                            and 
                              (
                              0
                              :
                              (
                              0
                              ,
                              0
                              ,
                              1
                              ,
                              1
                              )
                              )
                              ∧
                              (
                              7
                              :
                              (
                              0
                              ,
                              0
                              ,
                              1
                              ,
                              1
                              )
                              )
                            define the same step function. To avoid that, we adopt the notion of normal form defined in [3]:
                              
                                 1.
                                 the switching times t
                                    
                                       i
                                     of a conjunction are sorted and different (if 
                                       f
                                       =
                                       
                                          
                                             ⋀
                                          
                                          
                                             0
                                             ≤
                                             i
                                             ≤
                                             N
                                          
                                       
                                       {
                                       
                                          
                                             t
                                          
                                          
                                             i
                                          
                                       
                                       :
                                       
                                          
                                             v
                                          
                                          
                                             i
                                          
                                       
                                       }
                                     then 
                                       
                                          
                                             t
                                          
                                          
                                             0
                                          
                                       
                                       <
                                       
                                          
                                             t
                                          
                                          
                                             1
                                          
                                       
                                       <
                                       ⋯
                                       <
                                       
                                          
                                             t
                                          
                                          
                                             n
                                          
                                       
                                       <
                                       
                                       ...
                                       
                                       <
                                       
                                          
                                             t
                                          
                                          
                                             N
                                          
                                       
                                    );

two consecutive constraints cannot have equal values (each 
                                       
                                          
                                             v
                                          
                                          
                                             i
                                          
                                       
                                     must be different from 
                                       
                                          
                                             v
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                       
                                    , that is 
                                       ∀
                                       i
                                       ∈
                                       [
                                       0
                                       ,
                                       N
                                       −
                                       1
                                       ]
                                       ,
                                       
                                          
                                             v
                                          
                                          
                                             i
                                          
                                       
                                       ≠
                                       
                                          
                                             v
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                       
                                    )


                                    
                                       ∀
                                       v
                                       =
                                       (
                                       
                                          
                                             m
                                          
                                          
                                             −
                                          
                                       
                                       ,
                                       
                                          
                                             q
                                          
                                          
                                             −
                                          
                                       
                                       ,
                                       
                                          
                                             m
                                          
                                          
                                             +
                                          
                                       
                                       ,
                                       
                                          
                                             q
                                          
                                          
                                             +
                                          
                                       
                                       )
                                    , if 
                                       
                                          
                                             q
                                          
                                          
                                             −
                                          
                                       
                                       =
                                       −
                                       ∞
                                     then 
                                       
                                          
                                             m
                                          
                                          
                                             −
                                          
                                       
                                       =
                                       0
                                    ; and if 
                                       
                                          
                                             q
                                          
                                          
                                             +
                                          
                                       
                                       =+
                                       ∞
                                     then 
                                       
                                          
                                             m
                                          
                                          
                                             +
                                          
                                       
                                       =
                                       0
                                    .

Given two normalized conjunctions, we define the same equality test as in [3]: 
                              
                                 
                                    
                                       
                                          ⋀
                                       
                                       
                                          0
                                          ≤
                                          i
                                          ≤
                                          N
                                       
                                    
                                    {
                                    
                                       
                                          t
                                       
                                       
                                          i
                                       
                                    
                                    :
                                    
                                       
                                          v
                                       
                                       
                                          i
                                       
                                    
                                    }
                                    =
                                    
                                       
                                          ⋀
                                       
                                       
                                          0
                                          ≤
                                          j
                                          ≤
                                          M
                                       
                                    
                                    {
                                    
                                       
                                          u
                                       
                                       
                                          j
                                       
                                    
                                    :
                                    
                                       
                                          w
                                       
                                       
                                          j
                                       
                                    
                                    }
                                    ⟺
                                    N
                                    =
                                    M
                                    ∧
                                    ∀
                                    i
                                    ∈
                                    [
                                    0
                                    ,
                                    N
                                    ]
                                    :
                                    
                                       
                                          t
                                       
                                       
                                          i
                                       
                                    
                                    =
                                    
                                       
                                          u
                                       
                                       
                                          i
                                       
                                    
                                    ∧
                                    
                                       
                                          v
                                       
                                       
                                          i
                                       
                                    
                                    =
                                    
                                       
                                          w
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                           The normalization process induces an equivalence relation 
                              ≡
                            defined by 
                              
                                 
                                    f
                                    ≡
                                    g
                                    ⇔
                                    Norm
                                    (
                                    f
                                    )
                                    =
                                    Norm
                                    (
                                    g
                                    )
                                    .
                                 
                              
                           
                        

We impose two constraints on abstract elements:
                              
                                 (1)
                                 At each step, the two lines 
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                     and 
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                     either coincide or they do not intersect. Formally:
                                       
                                          (i)
                                          
                                             
                                                ∀
                                                i
                                                ∈
                                                [
                                                0
                                                ,
                                                N
                                                −
                                                1
                                                ]
                                                :
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                   
                                                
                                                )
                                                ≤
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                   
                                                
                                                )
                                                ∧
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                )
                                                ≤
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                )
                                             ,


                                             
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      N
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      N
                                                   
                                                
                                                )
                                                ≤
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      N
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      N
                                                   
                                                
                                                )
                                                ∧
                                                (
                                                
                                                   
                                                      m
                                                   
                                                   
                                                      N
                                                   
                                                   
                                                      −
                                                   
                                                
                                                ≤
                                                
                                                   
                                                      m
                                                   
                                                   
                                                      N
                                                   
                                                   
                                                      +
                                                   
                                                
                                                )
                                              where 
                                                
                                                   
                                                      m
                                                   
                                                   
                                                      N
                                                   
                                                   
                                                      −
                                                   
                                                
                                              and 
                                                
                                                   
                                                      m
                                                   
                                                   
                                                      N
                                                   
                                                   
                                                      +
                                                   
                                                
                                              denote the slopes of 
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      N
                                                   
                                                   
                                                      −
                                                   
                                                
                                              and 
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      N
                                                   
                                                   
                                                      +
                                                   
                                                
                                             , respectively.

This assumption is not restrictive, since we can always split a step with intersecting sides into two smaller steps with not intersecting sides through the Refine operator defined in Section 2.6.

Two consecutive steps of a step function must have at least one point in common. Formally:
                                       
                                          
                                             ∀
                                             i
                                             ∈
                                             [
                                             0
                                             ,
                                             N
                                             −
                                             1
                                             ]
                                             ,
                                             [
                                             
                                                
                                                   f
                                                
                                                
                                                   i
                                                
                                                
                                                   −
                                                
                                             
                                             (
                                             
                                                
                                                   t
                                                
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                             )
                                             ,
                                             
                                                
                                                   f
                                                
                                                
                                                   i
                                                
                                                
                                                   +
                                                
                                             
                                             (
                                             
                                                
                                                   t
                                                
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                             )
                                             ]
                                             ∩
                                             [
                                             
                                                
                                                   f
                                                
                                                
                                                   i
                                                   +
                                                   1
                                                
                                                
                                                   −
                                                
                                             
                                             (
                                             
                                                
                                                   t
                                                
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                             )
                                             ,
                                             
                                                
                                                   f
                                                
                                                
                                                   i
                                                   +
                                                   1
                                                
                                                
                                                   +
                                                
                                             
                                             (
                                             
                                                
                                                   t
                                                
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                             )
                                             ]
                                             ≠
                                             ∅
                                          
                                       
                                    
                                 

This means that the interval of values at 
                              t
                              =
                              
                                 
                                    t
                                 
                                 
                                    i
                                    +
                                    1
                                 
                              
                            identified by 
                              
                                 
                                    v
                                 
                                 
                                    i
                                 
                              
                            and the one identified by 
                              
                                 
                                    v
                                 
                                 
                                    i
                                    +
                                    1
                                 
                              
                            at the same input t must have a non-empty intersection. This constraint is needed because otherwise the concrete functions represented by the abstract element would not be continuous, and it would be abstracted by a bottom value in our domain.

In Fig. 7
                            we can see an example of an abstract state which violates this constraint. In particular, at t=3 we can see that the interval of values identified by the left trapezoid is [2, 3]. The interval identified by the right trapezoid, on the other hand, is [3.5, 5]. Since 
                              [
                              2
                              ,
                              3
                              ]
                              ∩
                              [
                              3.5
                              ,
                              5
                              ]
                              =
                              ∅
                           , this abstract state is not valid and it collapses to bottom. This is a sound approximation, since there is no continuous function that may satisfy this constraint.

The elements (that is, states) of our abstract domain, denoted by 
                              
                                 
                                    D
                                 
                                 
                                    ♯
                                 
                              
                           , are (possibly normalized) finite conjunctions of constraints 
                              f
                              =
                              
                                 
                                    ⋀
                                 
                                 
                                    0
                                    ≤
                                    i
                                    ≤
                                    N
                                 
                              
                              {
                              
                                 
                                    t
                                 
                                 
                                    i
                                 
                              
                              :
                              
                                 
                                    v
                                 
                                 
                                    i
                                 
                              
                              }
                            (with 
                              N
                              ∈
                              N
                              ∧
                              ∀
                              i
                              ∈
                              [
                              0
                              ,
                              N
                              ]
                              :
                              (
                              
                                 
                                    t
                                 
                                 
                                    i
                                 
                              
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    +
                                 
                              
                              ∧
                              
                                 
                                    v
                                 
                                 
                                    i
                                 
                              
                              ∈
                              V
                              )
                           ) which satisfy the constraints (1) and (2) above.

Note that the abstract states of TSF
                           refer to the entire domain 
                              
                                 
                                    R
                                 
                                 
                                    +
                                 
                              
                           . Since the conjunctions we consider are finite, this means that the last trapezoid lacks its right side (it is not closed): the upper and lower sides extend (on the right) to infinity. Of course, if we restrict the domain to a finite interval, we should remove the constraint on the slopes of the last step. Fig. 8
                            depicts the restriction of the abstract state of Fig. 6 to the Interval domain [0, 10].

The abstract step function f defined by 
                           
                              
                                 ⋀
                              
                              
                                 0
                                 ≤
                                 i
                                 ≤
                                 N
                              
                           
                           {
                           
                              
                                 t
                              
                              
                                 i
                              
                           
                           :
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                           }
                        , where 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                           =
                           (
                           
                              
                                 f
                              
                              
                                 i
                              
                              
                                 −
                              
                           
                           ,
                           
                              
                                 f
                              
                              
                                 i
                              
                              
                                 +
                              
                           
                           )
                           =
                           (
                           
                              
                                 m
                              
                              
                                 i
                              
                              
                                 −
                              
                           
                           ,
                           
                              
                                 q
                              
                              
                                 i
                              
                              
                                 −
                              
                           
                           ,
                           
                              
                                 m
                              
                              
                                 i
                              
                              
                                 +
                              
                           
                           ,
                           
                              
                                 q
                              
                              
                                 i
                              
                              
                                 +
                              
                           
                           )
                        , represents the set of continuous functions that are bounded by the lines 
                           
                              
                                 f
                              
                              
                                 i
                              
                              
                                 −
                              
                           
                           (
                           t
                           )
                           =
                           
                              
                                 m
                              
                              
                                 i
                              
                              
                                 −
                              
                           
                           t
                           +
                           
                              
                                 q
                              
                              
                                 i
                              
                              
                                 −
                              
                           
                         and 
                           
                              
                                 f
                              
                              
                                 i
                              
                              
                                 +
                              
                           
                           (
                           t
                           )
                           =
                           
                              
                                 m
                              
                              
                                 i
                              
                              
                                 +
                              
                           
                           t
                           +
                           
                              
                                 q
                              
                              
                                 i
                              
                              
                                 +
                              
                           
                         for any time 
                           t
                           ∈
                           [
                           
                              
                                 t
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 t
                              
                              
                                 i
                                 +
                                 1
                              
                           
                           ]
                        . The concretization function γ is thus defined by: 
                           
                              
                                 γ
                                 (
                                 
                                    
                                       ⋀
                                    
                                    
                                       0
                                       ≤
                                       i
                                       ≤
                                       N
                                    
                                 
                                 {
                                 
                                    
                                       t
                                    
                                    
                                       i
                                    
                                 
                                 :
                                 
                                    
                                       v
                                    
                                    
                                       i
                                    
                                 
                                 }
                                 )
                                 =
                                 {
                                 g
                                 ∈
                                 
                                    
                                       C
                                    
                                    
                                       +
                                    
                                 
                                 |
                                 ∀
                                 i
                                 ∈
                                 [
                                 0
                                 ,
                                 N
                                 ]
                                 ,
                                 ∀
                                 t
                                 ∈
                                 [
                                 
                                    
                                       t
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       t
                                    
                                    
                                       i
                                       +
                                       1
                                    
                                 
                                 ]
                                 ,
                                 g
                                 (
                                 t
                                 )
                                 ∈
                                 [
                                 
                                    
                                       f
                                    
                                    
                                       i
                                    
                                    
                                       −
                                    
                                 
                                 (
                                 t
                                 )
                                 ,
                                 
                                    
                                       f
                                    
                                    
                                       i
                                    
                                    
                                       +
                                    
                                 
                                 (
                                 t
                                 )
                                 ]
                                 }
                              
                           
                        where if 
                           dom
                           (
                           f
                           )
                           =
                           
                              
                                 R
                              
                              
                                 +
                              
                           
                         then 
                           
                              
                                 t
                              
                              
                                 N
                                 +
                                 1
                              
                           
                           =+
                           ∞
                         , whereas if 
                           dom
                           (
                           f
                           )
                           =
                           [
                           0
                           ,
                           k
                           ]
                        , with k constant, then 
                           
                              
                                 t
                              
                              
                                 N
                              
                           
                           <
                           
                              
                                 t
                              
                              
                                 N
                                 +
                                 1
                              
                           
                           =
                           k
                        .


                        Fig. 9
                         depicts an example of an abstract state defined on the domain [0, 5] with 4 steps (note that here 
                           
                              
                                 t
                              
                              
                                 N
                                 +
                                 1
                              
                           
                           =
                           5
                        ). In this figure we can see three possible concrete functions (
                           
                              
                                 f
                              
                              
                                 1
                              
                           
                           =
                           
                              
                                 x
                              
                              
                                 3
                              
                           
                           −
                           7
                           
                              
                                 x
                              
                              
                                 2
                              
                           
                           +
                           12
                           x
                           −
                           2
                        , 
                           
                              
                                 f
                              
                              
                                 2
                              
                           
                           =
                           ln
                           (
                           x
                           +
                           1
                           )
                         and 
                           
                              
                                 f
                              
                              
                                 3
                              
                           
                           =
                           sin
                           (
                           x
                           )
                        ) that are all approximated by such abstract state.

The definition of an abstraction is not as direct as the concretization. As in the case of the polyhedral domain [5], we cannot define the best one: it is always possible to increase the quality of the abstraction by increasing the number of steps. Thus, for now, we only give a criterion (the same as [3]) for a function α to be a safe abstraction (later, in Section 3, we will provide a constructive definition of a sound abstraction function).

As an abstract step function 
                           f
                           ∈
                           
                              
                                 D
                              
                              
                                 ♯
                              
                           
                         can be seen as a multivalued function, we will make use of the following notation: 
                           
                              
                                 for
                                 
                                 t
                                 ∈
                                 [
                                 
                                    
                                       t
                                    
                                    
                                       j
                                    
                                 
                                 ,
                                 
                                    
                                       t
                                    
                                    
                                       j
                                       +
                                       1
                                    
                                 
                                 ]
                                 ,
                                 
                                 f
                                 (
                                 t
                                 )
                                 =
                                 {
                                 v
                                 :
                                 
                                    
                                       f
                                    
                                    
                                       j
                                    
                                    
                                       −
                                    
                                 
                                 (
                                 t
                                 )
                                 ≤
                                 v
                                 ≤
                                 
                                    
                                       f
                                    
                                    
                                       j
                                    
                                    
                                       +
                                    
                                 
                                 (
                                 t
                                 )
                                 }
                                 .
                              
                           
                        
                     

Let us now define the lower- and upper-functions for a given set of continuous real functions. Let 
                           Y
                         be a set of continuous functions (
                           Y
                           ∈
                           D
                        ). We define two functions 
                           
                              
                                 Y
                              
                              
                                 ̲
                              
                           
                         and 
                           
                              
                                 Y
                              
                              
                                 ¯
                              
                           
                         to be the inf- and sup-functions of 
                           Y
                        : 
                           
                              
                                 Y
                              
                              
                                 ̲
                              
                           
                           =
                           λ
                           t
                           .
                           
                           inf
                           {
                           y
                           (
                           t
                           )
                           :
                           y
                           ∈
                           Y
                           }
                         and 
                           
                              
                                 Y
                              
                              
                                 ¯
                              
                           
                           =
                           λ
                           t
                           .
                           
                           sup
                           {
                           y
                           (
                           t
                           )
                           :
                           y
                           ∈
                           Y
                           }
                        . The same way, we define the lower- and upper-functions of a Trapezoid Step Function. For 
                           f
                           ∈
                           
                              
                                 D
                              
                              
                                 ♯
                              
                           
                        , the real-valued step functions 
                           
                              
                                 f
                              
                              
                                 ̲
                              
                           
                         and 
                           
                              
                                 f
                              
                              
                                 ¯
                              
                           
                         are 
                           
                              
                                 f
                              
                              
                                 ̲
                              
                           
                           =
                           λ
                           t
                           .
                           
                              
                                 f
                              
                              
                                 i
                              
                              
                                 −
                              
                           
                           (
                           t
                           )
                         and 
                           
                              
                                 f
                              
                              
                                 ¯
                              
                           
                           =
                           λ
                           t
                           .
                           
                              
                                 f
                              
                              
                                 i
                              
                              
                                 +
                              
                           
                           (
                           t
                           )
                         where, in both cases, 
                           i
                           =
                           max
                           (
                           {
                           j
                           ∈
                           N
                           :
                           
                              
                                 t
                              
                              
                                 j
                              
                           
                           ≤
                           t
                           }
                           )
                        . These four functions are used to define the α-Validity Condition. 
                           Definition 1
                           
                              α-Validity Condition


                           A function 
                                 α
                                 :
                                 D
                                 →
                                 
                                    
                                       D
                                    
                                    
                                       ♯
                                    
                                 
                               satisfies the α-Validity Condition (α-V.C.) if and only if for all 
                                 Y
                                 ∈
                                 D
                              , it holds that 
                                 
                                    
                                       ∀
                                       t
                                       ∈
                                       
                                          
                                             R
                                          
                                          
                                             +
                                          
                                       
                                       ,
                                       
                                       
                                          
                                             α
                                             (
                                             Y
                                             )
                                          
                                          
                                             ̲
                                          
                                       
                                       (
                                       t
                                       )
                                       ≤
                                       
                                          
                                             Y
                                          
                                          
                                             ̲
                                          
                                       
                                       (
                                       t
                                       )
                                       ≤
                                       
                                          
                                             Y
                                          
                                          
                                             ¯
                                          
                                       
                                       (
                                       t
                                       )
                                       ≤
                                       
                                          
                                             α
                                             (
                                             Y
                                             )
                                          
                                          
                                             ¯
                                          
                                       
                                       (
                                       t
                                       )
                                    
                                 
                              
                           

We now formulate the theorem that guarantees the soundness of the abstraction. 
                           Theorem 2
                           
                              If α satisfies the α-Validity Condition, then for every 
                              
                                 Y
                                 ∈
                                 D
                              , 
                                 Y
                                 ⊆
                                 γ
                                 (
                                 α
                                 (
                                 Y
                                 )
                                 )
                              .

Let 
                                 Y
                               be a subset of continuous functions and 
                                 f
                                 =
                                 α
                                 (
                                 Y
                                 )
                                 ∈
                                 
                                    
                                       D
                                    
                                    
                                       ♯
                                    
                                 
                              . We have to prove that 
                                 Y
                                 ⊆
                                 γ
                                 (
                                 f
                                 )
                              . Since α satisfies the α-Validity Condition, we know that 
                                 ∀
                                 t
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       +
                                    
                                 
                                 ,
                                 ∀
                                 g
                                 ∈
                                 Y
                                 ,
                                 g
                                 (
                                 t
                                 )
                                 ∈
                                 [
                                 
                                    
                                       f
                                    
                                    
                                       −
                                    
                                 
                                 (
                                 t
                                 )
                                 ,
                                 
                                    
                                       f
                                    
                                    
                                       +
                                    
                                 
                                 (
                                 t
                                 )
                                 ]
                              . Let us take a 
                                 g
                                 ∈
                                 Y
                              . g is a continuous function that verifies 
                                 ∀
                                 t
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       +
                                    
                                 
                                 ,
                                 g
                                 (
                                 t
                                 )
                                 ∈
                                 [
                                 
                                    
                                       f
                                    
                                    
                                       −
                                    
                                 
                                 (
                                 t
                                 )
                                 ,
                                 
                                    
                                       f
                                    
                                    
                                       +
                                    
                                 
                                 (
                                 t
                                 )
                                 ]
                              , thus 
                                 g
                                 ∈
                                 γ
                                 (
                                 f
                                 )
                              . Therefore, we have that 
                                 Y
                                 ⊆
                                 γ
                                 (
                                 f
                                 )
                              □.

The partial order 
                           
                              
                                 ⊆
                              
                              
                                 ♯
                              
                           
                         on 
                           
                              
                                 D
                              
                              
                                 ♯
                              
                           
                         is defined pointwise, that is, 
                           f
                           
                              
                                 ⊆
                              
                              
                                 ♯
                              
                           
                           g
                         if for every possible input t, the set of values assumed by f in this point is a subset of the set of values assumed by g at the same point. Formally, 
                           f
                           
                              
                                 ⊆
                              
                              
                                 ♯
                              
                           
                           g
                           ⇔
                           ∀
                           t
                           ∈
                           
                              
                                 R
                              
                              
                                 +
                              
                           
                           :
                           f
                           (
                           t
                           )
                           ⊆
                           g
                           (
                           t
                           )
                        .

To define the partial order on step functions, we first define a partial order on single steps. Let 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                           =
                           (
                           
                              
                                 f
                              
                              
                                 i
                              
                              
                                 −
                              
                           
                           ,
                           
                              
                                 f
                              
                              
                                 i
                              
                              
                                 +
                              
                           
                           )
                         and 
                           
                              
                                 w
                              
                              
                                 j
                              
                           
                           =
                           (
                           
                              
                                 g
                              
                              
                                 j
                              
                              
                                 −
                              
                           
                           ,
                           
                              
                                 g
                              
                              
                                 j
                              
                              
                                 +
                              
                           
                           )
                         be the values of two steps on the same domain 
                           [
                           a
                           ,
                           b
                           ]
                         with 
                           b
                           ≠
                           +
                           ∞
                        , or 
                           [
                           a
                           ,
                           +
                           ∞
                           ]
                         . Then
                           
                              (1)
                              
                                 
                                    
                                       v
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       ⊑
                                    
                                    
                                       [
                                       a
                                       ,
                                       b
                                       ]
                                    
                                 
                                 
                                    
                                       w
                                    
                                    
                                       j
                                    
                                 
                                 ⇔
                                 ∀
                                 t
                                 ∈
                                 [
                                 a
                                 ,
                                 b
                                 ]
                                 :
                                 
                                    
                                       f
                                    
                                    
                                       i
                                    
                                    
                                       −
                                    
                                 
                                 (
                                 t
                                 )
                                 ≥
                                 
                                    
                                       g
                                    
                                    
                                       j
                                    
                                    
                                       −
                                    
                                 
                                 (
                                 t
                                 )
                                 ∧
                                 
                                    
                                       f
                                    
                                    
                                       i
                                    
                                    
                                       +
                                    
                                 
                                 (
                                 t
                                 )
                                 ≤
                                 
                                    
                                       g
                                    
                                    
                                       j
                                    
                                    
                                       +
                                    
                                 
                                 (
                                 t
                                 )
                                 ⇔
                                 ∀
                                 t
                                 ∈
                                 [
                                 a
                                 ,
                                 b
                                 ]
                                 :
                                 [
                                 
                                    
                                       f
                                    
                                    
                                       i
                                    
                                    
                                       −
                                    
                                 
                                 (
                                 t
                                 )
                                 ,
                                 
                                    
                                       f
                                    
                                    
                                       i
                                    
                                    
                                       +
                                    
                                 
                                 (
                                 t
                                 )
                                 ]
                                 ⊆
                                 [
                                 
                                    
                                       g
                                    
                                    
                                       j
                                    
                                    
                                       −
                                    
                                 
                                 (
                                 t
                                 )
                                 ,
                                 
                                    
                                       g
                                    
                                    
                                       j
                                    
                                    
                                       +
                                    
                                 
                                 (
                                 t
                                 )
                                 ]
                                 ⇔
                                 [
                                 
                                    
                                       f
                                    
                                    
                                       i
                                    
                                    
                                       −
                                    
                                 
                                 (
                                 a
                                 )
                                 ,
                                 
                                    
                                       f
                                    
                                    
                                       i
                                    
                                    
                                       +
                                    
                                 
                                 (
                                 a
                                 )
                                 ]
                                 ⊆
                                 [
                                 
                                    
                                       g
                                    
                                    
                                       j
                                    
                                    
                                       −
                                    
                                 
                                 (
                                 a
                                 )
                                 ,
                                 
                                    
                                       g
                                    
                                    
                                       j
                                    
                                    
                                       +
                                    
                                 
                                 (
                                 a
                                 )
                                 ]
                                 ∧
                                 [
                                 
                                    
                                       f
                                    
                                    
                                       i
                                    
                                    
                                       −
                                    
                                 
                                 (
                                 b
                                 )
                                 ,
                                 
                                    
                                       f
                                    
                                    
                                       i
                                    
                                    
                                       +
                                    
                                 
                                 (
                                 b
                                 )
                                 ]
                                 ⊆
                                 [
                                 
                                    
                                       g
                                    
                                    
                                       j
                                    
                                    
                                       −
                                    
                                 
                                 (
                                 b
                                 )
                                 ,
                                 
                                    
                                       g
                                    
                                    
                                       j
                                    
                                    
                                       +
                                    
                                 
                                 (
                                 b
                                 )
                                 ]
                                 
                                    
                                       v
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       ⊑
                                    
                                    
                                       [
                                       a
                                       ,
                                       +
                                       ∞
                                       ]
                                    
                                 
                                 
                                    
                                       w
                                    
                                    
                                       j
                                    
                                 
                                 ⇔
                                 [
                                 
                                    
                                       f
                                    
                                    
                                       i
                                    
                                    
                                       −
                                    
                                 
                                 (
                                 a
                                 )
                                 ,
                                 
                                    
                                       f
                                    
                                    
                                       i
                                    
                                    
                                       +
                                    
                                 
                                 (
                                 a
                                 )
                                 ]
                                 ⊆
                                 [
                                 
                                    
                                       g
                                    
                                    
                                       j
                                    
                                    
                                       −
                                    
                                 
                                 (
                                 a
                                 )
                                 ,
                                 
                                    
                                       g
                                    
                                    
                                       j
                                    
                                    
                                       +
                                    
                                 
                                 (
                                 a
                                 )
                                 ]
                                 ∧
                                 (
                                 
                                    
                                       m
                                    
                                    
                                       i
                                    
                                    
                                       −
                                    
                                 
                                 ≥
                                 
                                    
                                       m
                                    
                                    
                                       j
                                    
                                    
                                       −
                                    
                                 
                                 )
                                 ∧
                                 (
                                 
                                    
                                       m
                                    
                                    
                                       i
                                    
                                    
                                       +
                                    
                                 
                                 ≤
                                 
                                    
                                       m
                                    
                                    
                                       j
                                    
                                    
                                       +
                                    
                                 
                                 )
                                 where
                                 
                                 
                                    
                                       m
                                    
                                    
                                       i
                                    
                                    
                                       −
                                    
                                 
                                 ,
                                 
                                    
                                       m
                                    
                                    
                                       i
                                    
                                    
                                       +
                                    
                                 
                                 ,
                                 
                                    
                                       m
                                    
                                    
                                       j
                                    
                                    
                                       −
                                    
                                 
                                 ,
                                 
                                    
                                       m
                                    
                                    
                                       j
                                    
                                    
                                       +
                                    
                                 
                                 
                                 are
                                 
                                 the
                                 
                                 slopes
                                 
                                 of
                                 
                                 
                                    
                                       f
                                    
                                    
                                       i
                                    
                                    
                                       −
                                    
                                 
                                 ,
                                 
                                    
                                       f
                                    
                                    
                                       i
                                    
                                    
                                       +
                                    
                                 
                                 ,
                                 
                                    
                                       g
                                    
                                    
                                       j
                                    
                                    
                                       −
                                    
                                 
                                 ,
                                 
                                    
                                       g
                                    
                                    
                                       j
                                    
                                    
                                       +
                                    
                                 
                                 ,
                                 
                                 respectively
                                 .
                              
                           
                        
                     

In other words, 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                         is smaller than 
                           
                              
                                 w
                              
                              
                                 j
                              
                           
                         if the area of the trapezoid identified by 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                         (in the given interval) is contained in the area of the trapezoid identified by 
                           
                              
                                 w
                              
                              
                                 j
                              
                           
                         (in the same interval).

Now we can give an effective condition for testing whether 
                           f
                           
                              
                                 ⊆
                              
                              
                                 ♯
                              
                           
                           g
                        . Let 
                           f
                           =
                           
                              
                                 ⋀
                              
                              
                                 0
                                 ≤
                                 i
                                 ≤
                                 N
                              
                           
                           {
                           
                              
                                 t
                              
                              
                                 i
                              
                           
                           :
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                           }
                         and 
                           g
                           =
                           
                              
                                 ⋀
                              
                              
                                 0
                                 ≤
                                 j
                                 ≤
                                 M
                              
                           
                           {
                           
                              
                                 u
                              
                              
                                 j
                              
                           
                           :
                           
                              
                                 w
                              
                              
                                 j
                              
                           
                           }
                         be two abstract states, then
                           
                              (2)
                              
                                 
                                    
                                       
                                          f
                                          
                                             
                                                ⊆
                                             
                                             
                                                ♯
                                             
                                          
                                          g
                                       
                                    
                                    
                                       
                                          ⇕
                                       
                                    
                                    
                                       
                                          ∀
                                          (
                                          i
                                          ,
                                          j
                                          )
                                          ∈
                                          [
                                          0
                                          ,
                                          N
                                          ]
                                          ×
                                          [
                                          0
                                          ,
                                          M
                                          ]
                                          :
                                          [
                                          a
                                          ,
                                          b
                                          ]
                                          =
                                          [
                                          
                                             
                                                t
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          
                                             
                                                t
                                             
                                             
                                                i
                                                +
                                                1
                                             
                                          
                                          ]
                                          ∩
                                          [
                                          
                                             
                                                u
                                             
                                             
                                                j
                                             
                                          
                                          ,
                                          
                                             
                                                u
                                             
                                             
                                                j
                                                +
                                                1
                                             
                                          
                                          ]
                                          ≠
                                          ∅
                                          ⇒
                                          
                                             
                                                v
                                             
                                             
                                                i
                                             
                                          
                                          
                                             
                                                ⊑
                                             
                                             
                                                [
                                                a
                                                ,
                                                b
                                                ]
                                             
                                          
                                          
                                             
                                                w
                                             
                                             
                                                j
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

The condition (2) considers all intersections between steps from the two abstract states, that is, all pairs of steps 
                           (
                           
                              
                                 t
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 u
                              
                              
                                 j
                              
                           
                           )
                         from f and g that have a non-empty intersection (
                           [
                           
                              
                                 t
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 t
                              
                              
                                 i
                                 +
                                 1
                              
                           
                           ]
                           ∩
                           [
                           
                              
                                 u
                              
                              
                                 j
                              
                           
                           ,
                           
                              
                                 u
                              
                              
                                 j
                                 +
                                 1
                              
                           
                           ]
                           ≠
                           ∅
                        ). To check if two steps have an intersection (
                           [
                           
                              
                                 t
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 t
                              
                              
                                 i
                                 +
                                 1
                              
                           
                           ]
                           ∩
                           [
                           
                              
                                 u
                              
                              
                                 j
                              
                           
                           ,
                           
                              
                                 u
                              
                              
                                 j
                                 +
                                 1
                              
                           
                           ]
                           ≠
                           ∅
                        ), we can use the condition 
                           
                              
                                 u
                              
                              
                                 j
                              
                           
                           ≤
                           
                              
                                 t
                              
                              
                                 i
                                 +
                                 1
                              
                           
                           ∧
                           
                              
                                 u
                              
                              
                                 j
                                 +
                                 1
                              
                           
                           ≥
                           
                              
                                 t
                              
                              
                                 i
                              
                           
                        , and the intersection will be 
                           [
                           max
                           (
                           
                              
                                 t
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 u
                              
                              
                                 j
                              
                           
                           )
                           ,
                           min
                           (
                           
                              
                                 t
                              
                              
                                 i
                                 +
                                 1
                              
                           
                           ,
                           
                              
                                 u
                              
                              
                                 j
                                 +
                                 1
                              
                           
                           )
                           ]
                        . For each intersection, we then compare the two values (
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 w
                              
                              
                                 j
                              
                           
                        ) in that interval.

If each step value of f is smaller than the value of every intersected step of g (with respect to their intersection on the domain), then 
                           f
                           
                              
                                 ⊆
                              
                              
                                 ♯
                              
                           
                           g
                        . 
                           Lemma 3
                           Soundness of the partial order


                           
                              If 
                              
                                 f
                                 ,
                                 g
                                 ∈
                                 
                                    
                                       D
                                    
                                    
                                       ♯
                                    
                                 
                               
                              are normalized, then 
                              
                                 
                                    
                                       f
                                       
                                          
                                             ⊆
                                          
                                          
                                             ♯
                                          
                                       
                                       g
                                       ⇔
                                       ∀
                                       t
                                       ∈
                                       
                                          
                                             R
                                          
                                          
                                             +
                                          
                                       
                                       ,
                                       
                                       f
                                       (
                                       t
                                       )
                                       ⊆
                                       g
                                       (
                                       t
                                       )
                                    
                                 
                              
                           

We distinguish the two directions:
                                 
                                    •
                                    (
                                          ⇒
                                       ) Let 
                                          f
                                          =
                                          
                                             
                                                ⋀
                                             
                                             
                                                0
                                                ≤
                                                i
                                                ≤
                                                N
                                             
                                          
                                          {
                                          
                                             
                                                t
                                             
                                             
                                                i
                                             
                                          
                                          :
                                          
                                             
                                                v
                                             
                                             
                                                i
                                             
                                          
                                          }
                                        and 
                                          g
                                          =
                                          
                                             
                                                ⋀
                                             
                                             
                                                0
                                                ≤
                                                j
                                                ≤
                                                M
                                             
                                          
                                          {
                                          
                                             
                                                u
                                             
                                             
                                                j
                                             
                                          
                                          :
                                          
                                             
                                                w
                                             
                                             
                                                j
                                             
                                          
                                          }
                                       , be such that 
                                          f
                                          
                                             
                                                ⊆
                                             
                                             
                                                ♯
                                             
                                          
                                          g
                                       , and let t be 
                                          ∈
                                          
                                             
                                                R
                                             
                                             
                                                +
                                             
                                          
                                       . Then there exist 
                                          i
                                          ∈
                                          [
                                          0
                                          ,
                                          N
                                          ]
                                        and 
                                          j
                                          ∈
                                          [
                                          0
                                          ,
                                          M
                                          ]
                                        such that 
                                          t
                                          ∈
                                          [
                                          
                                             
                                                t
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          
                                             
                                                t
                                             
                                             
                                                i
                                                +
                                                1
                                             
                                          
                                          ]
                                          ∧
                                          t
                                          ∈
                                          [
                                          
                                             
                                                u
                                             
                                             
                                                j
                                             
                                          
                                          ,
                                          
                                             
                                                u
                                             
                                             
                                                j
                                                +
                                                1
                                             
                                          
                                          ]
                                       . Thus, 
                                          [
                                          
                                             
                                                t
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          
                                             
                                                t
                                             
                                             
                                                i
                                                +
                                                1
                                             
                                          
                                          ]
                                          ∩
                                          [
                                          
                                             
                                                u
                                             
                                             
                                                j
                                             
                                          
                                          ,
                                          
                                             
                                                u
                                             
                                             
                                                j
                                                +
                                                1
                                             
                                          
                                          ]
                                          ≠
                                          ∅
                                       , so 
                                          f
                                          (
                                          t
                                          )
                                          =
                                          [
                                          
                                             
                                                f
                                             
                                             
                                                i
                                             
                                             
                                                −
                                             
                                          
                                          (
                                          t
                                          )
                                          ,
                                          
                                             
                                                f
                                             
                                             
                                                i
                                             
                                             
                                                +
                                             
                                          
                                          (
                                          t
                                          )
                                          ]
                                          ⊆
                                          [
                                          
                                             
                                                g
                                             
                                             
                                                j
                                             
                                             
                                                −
                                             
                                          
                                          (
                                          t
                                          )
                                          ,
                                          
                                             
                                                g
                                             
                                             
                                                j
                                             
                                             
                                                +
                                             
                                          
                                          (
                                          t
                                          )
                                          ]
                                          =
                                          g
                                          (
                                          t
                                          )
                                        by definition of 
                                          
                                             
                                                ⊑
                                             
                                             
                                                [
                                                a
                                                ,
                                                b
                                                ]
                                             
                                          
                                       .

(
                                          ⇐
                                       ) Let 
                                          f
                                          ,
                                          g
                                          ∈
                                          
                                             
                                                D
                                             
                                             
                                                ♯
                                             
                                          
                                        be such that 
                                          ∀
                                          t
                                          ∈
                                          
                                             
                                                R
                                             
                                             
                                                +
                                             
                                          
                                          ,
                                          f
                                          (
                                          t
                                          )
                                          ⊆
                                          g
                                          (
                                          t
                                          )
                                       . Let 
                                          i
                                          ,
                                          j
                                          ∈
                                          [
                                          0
                                          ,
                                          N
                                          ]
                                          ×
                                          [
                                          0
                                          ,
                                          M
                                          ]
                                        be such that 
                                          [
                                          a
                                          ,
                                          b
                                          ]
                                          =
                                          [
                                          
                                             
                                                t
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          
                                             
                                                t
                                             
                                             
                                                i
                                                +
                                                1
                                             
                                          
                                          ]
                                          ∩
                                          [
                                          
                                             
                                                u
                                             
                                             
                                                j
                                             
                                          
                                          ,
                                          
                                             
                                                u
                                             
                                             
                                                j
                                                +
                                                1
                                             
                                          
                                          ]
                                          ≠
                                          ∅
                                       , and let 
                                          x
                                          ∈
                                          [
                                          a
                                          ,
                                          b
                                          ]
                                       . Since 
                                          ∀
                                          t
                                          ∈
                                          
                                             
                                                R
                                             
                                             
                                                +
                                             
                                          
                                          ,
                                          f
                                          (
                                          t
                                          )
                                          ⊆
                                          g
                                          (
                                          t
                                          )
                                       , then we also have 
                                          ∀
                                          x
                                          ∈
                                          [
                                          a
                                          ,
                                          b
                                          ]
                                          :
                                          f
                                          (
                                          x
                                          )
                                          ⊆
                                          g
                                          (
                                          x
                                          )
                                       , that is 
                                          ∀
                                          x
                                          ∈
                                          [
                                          a
                                          ,
                                          b
                                          ]
                                          :
                                          (
                                          [
                                          
                                             
                                                f
                                             
                                             
                                                i
                                             
                                             
                                                −
                                             
                                          
                                          (
                                          x
                                          )
                                          ,
                                          
                                             
                                                f
                                             
                                             
                                                i
                                             
                                             
                                                +
                                             
                                          
                                          (
                                          x
                                          )
                                          ]
                                          ⊆
                                          [
                                          
                                             
                                                g
                                             
                                             
                                                j
                                             
                                             
                                                −
                                             
                                          
                                          (
                                          x
                                          )
                                          ,
                                          
                                             
                                                g
                                             
                                             
                                                j
                                             
                                             
                                                +
                                             
                                          
                                          (
                                          x
                                          )
                                          ]
                                          )
                                       . Then we have that 
                                          
                                             
                                                v
                                             
                                             
                                                i
                                             
                                          
                                          
                                             
                                                ⊑
                                             
                                             
                                                [
                                                a
                                                ,
                                                b
                                                ]
                                             
                                          
                                          
                                             
                                                w
                                             
                                             
                                                j
                                             
                                          
                                        for each possible pair (i, j) by the second line of Eq. (1), and 
                                          f
                                          
                                             
                                                ⊆
                                             
                                             
                                                ♯
                                             
                                          
                                          g
                                        by Eq. (2).□

We can see an example of the partial order relationship between two abstract states f and g on the domain [0, 15] in Fig. 10
                        . The abstract state f is represented with straight lines, the abstract state g with dashed lines. f is defined on the step list {0, 4, 7, 11} while g is defined on the step list {0, 5, 10}. Then the comparison is made on the following intervals: [0, 4], [4, 5], [5, 7], [7, 10], [10, 11], [11, 15]. Since in each of these intervals we have that the straight lines lie within the area defined by the dashed lines, we obtain that 
                           f
                           
                              
                                 ⊆
                              
                              
                                 ♯
                              
                           
                           g
                        .

The top element of the domain is defined by 
                              
                                 
                                    ⊤
                                 
                                 
                                    ♯
                                 
                              
                              =
                              0
                              :
                              (
                              0
                              ,
                              −
                              ∞
                              ,
                              0
                              ,
                              ∞
                              )
                            (that is, the step function with only one step with value 
                              R
                           ), while 
                              
                                 
                                    ⊥
                                 
                                 
                                    ♯
                                 
                              
                            is a special element such that 
                              γ
                              (
                              
                                 
                                    ⊥
                                 
                                 
                                    ♯
                                 
                              
                              )
                              =
                              ∅
                              ∧
                              ∀
                              f
                              ∈
                              
                                 
                                    D
                                 
                                 
                                    ♯
                                 
                              
                              ,
                              
                                 
                                    ⊥
                                 
                                 
                                    ♯
                                 
                              
                              
                                 
                                    ⊆
                                 
                                 
                                    ♯
                                 
                              
                              f
                           .

We define a Refine operator, which, given an abstract state of TSF
                        and a set of indices, adds these indices to the step list of the state. The concretization of the abstract state remains the same after the application of a Refine operator, since the values 
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                         are not modified. This operator will be useful to make two abstract states directly comparable, by making them defined on the same step list.

Consider an abstract state 
                           f
                           =
                           
                              
                                 ⋀
                              
                              
                                 0
                                 ≤
                                 i
                                 ≤
                                 N
                              
                           
                           {
                           
                              
                                 t
                              
                              
                                 i
                              
                           
                           :
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                           }
                         where 
                           T
                           =
                           {
                           
                              
                                 t
                              
                              
                                 i
                              
                           
                           :
                           0
                           ≤
                           i
                           ≤
                           N
                           }
                         and a set of indices 
                           S
                           =
                           {
                           
                              
                                 s
                              
                              
                                 j
                              
                           
                           :
                           0
                           ≤
                           j
                           ≤
                           M
                           }
                        . Let 
                           R
                           =
                           {
                           
                              
                                 r
                              
                              
                                 k
                              
                           
                           :
                           ∀
                           k
                           ∈
                           [
                           0
                           ,
                           P
                           ]
                           ,
                           (
                           
                              
                                 r
                              
                              
                                 k
                              
                           
                           ∈
                           (
                           T
                           ∪
                           S
                           )
                           ∧
                           
                              
                                 r
                              
                              
                                 k
                              
                           
                           <
                           
                              
                                 r
                              
                              
                                 k
                                 +
                                 1
                              
                           
                           )
                           }
                         be the set of all the indices contained in T and S, ordered and without repetitions (therefore 
                           P
                           =
                           N
                           +
                           M
                           −
                           |
                           T
                           ∩
                           S
                           |
                        ). The Refine operator on this state is defined by 
                           
                              
                                 Refine
                                 (
                                 f
                                 ,
                                 S
                                 )
                                 =
                                 
                                    
                                       ⋀
                                    
                                    
                                       0
                                       ≤
                                       k
                                       ≤
                                       P
                                    
                                 
                                 {
                                 
                                    
                                       r
                                    
                                    
                                       k
                                    
                                 
                                 :
                                 
                                    
                                       
                                          
                                             v
                                          
                                          
                                             k
                                          
                                       
                                    
                                    
                                       ^
                                    
                                 
                                 }
                              
                           
                        where 
                           
                              
                                 
                                    
                                       v
                                    
                                    
                                       k
                                    
                                 
                              
                              
                                 ^
                              
                           
                           =
                           
                              
                                 v
                              
                              
                                 max
                                 {
                                 i
                                 :
                                 
                                    
                                       t
                                    
                                    
                                       i
                                    
                                 
                                 ≤
                                 
                                    
                                       r
                                    
                                    
                                       k
                                    
                                 
                                 }
                              
                           
                        . Intuitively, you can see that this operator does not change the abstract information of the state. In fact we can enunciate the following lemma: 
                           Lemma 4
                           Refinement


                           
                              Given a normalized abstract state f, for any set of indices S, it holds that 
                              
                                 f
                                 ≡
                                 Refine
                                 (
                                 f
                                 ,
                                 S
                                 )
                              .

In the Appendix section.□

We can see an example of the Refine operator in Fig. 11
                        . The step list of the original abstract state is [0, 5, 11], while the set of indices I is [2, 6, 9, 14]. On the left we depict the original abstract state, on the right its refined version with respect to I (the vertical lines are dashed in correspondence with the indices of I).

The Refine operator will be used when dealing with two abstract states together (for example, in the least upper bound operator) to refine both states through the set of indices of the other state. For example, if f and g are the two abstract states being considered, the preliminary step is to refine f with the steps of g, and to refine g with the steps of f. In this way, we obtain two abstract states defined on the same set of indices (that is, the union of the two original step lists).

Notice that the abstract state resulting from a refinement operation is, in general, not normalized, because it violates the second condition (i.e., two consecutive constraints cannot have equal values). This is not a problem, since the refinement is used as a preliminary step of various operations (glb, lub,…), and normalization is applied on their final result.

Given two elements x and y of the abstract domain, the greatest lower bound operator defines the greatest element 
                           z
                           =
                           x
                           
                              
                                 ∩
                              
                              
                                 ♯
                              
                           
                           y
                         that under-approximates both x and y. In TSF, this means that we have to create a sequence of trapezoids that are (i) as vast as possible and (ii) contained in both the given sequences of trapezoids.

Let 
                           
                              
                                 f
                              
                              
                                 ′
                              
                           
                           =
                           
                              
                                 ⋀
                              
                              
                                 0
                                 ≤
                                 k
                                 ≤
                                 N
                              
                           
                           {
                           
                              
                                 x
                              
                              
                                 k
                              
                           
                           :
                           
                              
                                 v
                              
                              
                                 k
                              
                           
                           }
                         and 
                           
                              
                                 g
                              
                              
                                 ′
                              
                           
                           =
                           
                              
                                 ⋀
                              
                              
                                 0
                                 ≤
                                 j
                                 ≤
                                 M
                              
                           
                           {
                           
                              
                                 u
                              
                              
                                 j
                              
                           
                           :
                           
                              
                                 w
                              
                              
                                 j
                              
                           
                           }
                         be two abstract states defined on the step lists 
                           V
                           =
                           {
                           
                              
                                 x
                              
                              
                                 k
                              
                           
                           :
                           k
                           ∈
                           [
                           0
                           ,
                           N
                           ]
                           }
                         and 
                           U
                           =
                           {
                           
                              
                                 u
                              
                              
                                 j
                              
                           
                           :
                           j
                           ∈
                           [
                           0
                           ,
                           M
                           ]
                           }
                        , respectively (note that 
                           N
                           +
                           1
                           =
                           |
                           V
                           |
                         and 
                           M
                           +
                           1
                           =
                           |
                           U
                           |
                        , that is, the number of steps of an abstract state corresponds to the cardinality of its step list). Let 
                           min
                           (
                           
                              
                                 l
                              
                              
                                 1
                              
                           
                           (
                           t
                           )
                           ,
                           
                              
                                 l
                              
                              
                                 2
                              
                           
                           (
                           t
                           )
                           ,
                           [
                           a
                           ,
                           b
                           ]
                           )
                         be an operator which compares the lines 
                           
                              
                                 l
                              
                              
                                 1
                              
                           
                           (
                           t
                           )
                         and 
                           
                              
                                 l
                              
                              
                                 2
                              
                           
                           (
                           t
                           )
                         in the domain range 
                           [
                           a
                           ,
                           b
                           ]
                         and returns the one which is always below the other one, under the assumption that the two lines do not intersect in such range. Since 
                           
                              
                                 l
                              
                              
                                 1
                              
                           
                           (
                           t
                           )
                         and 
                           
                              
                                 l
                              
                              
                                 2
                              
                           
                           (
                           t
                           )
                         are straight lines, it suffices to compare their values in t=a and t=b. Let 
                           max
                           (
                           
                              
                                 l
                              
                              
                                 1
                              
                           
                           (
                           t
                           )
                           ,
                           
                              
                                 l
                              
                              
                                 2
                              
                           
                           (
                           t
                           )
                           ,
                           [
                           a
                           ,
                           b
                           ]
                           )
                         be the opposite operator, which returns the line always above. Let StepList(f) be a function which, given an abstract state f, extracts its step list. Then, we can write the formal definition of the greatest lower bound of 
                           
                              
                                 f
                              
                              
                                 ′
                              
                           
                         and 
                           
                              
                                 g
                              
                              
                                 ′
                              
                           
                         (i.e., 
                           
                              
                                 f
                              
                              
                                 ′
                              
                           
                           
                              
                                 ∩
                              
                              
                                 ♯
                              
                           
                           
                              
                                 g
                              
                              
                                 ′
                              
                           
                        )as the result of the algorithm depicted in Fig. 12
                        :

An informal description of this algorithm is as follows:
                           
                              
                                 Step 1 (lines 1–3 of the algorithm):
                              In order to make the two abstract states 
                                    
                                       
                                          f
                                       
                                       
                                          ′
                                       
                                    
                                    ,
                                    
                                       
                                          g
                                       
                                       
                                          ′
                                       
                                    
                                  directly comparable, we refine them on the same step list, creating two new abstract states 
                                    f
                                    ,
                                    g
                                 . Let 
                                    f
                                    =
                                    Refine
                                    (
                                    
                                       
                                          f
                                       
                                       
                                          ′
                                       
                                    
                                    ,
                                    U
                                    )
                                  and 
                                    g
                                    =
                                    Refine
                                    (
                                    
                                       
                                          g
                                       
                                       
                                          ′
                                       
                                    
                                    ,
                                    V
                                    )
                                  be these two new states. By Lemma 4, these refined states are equivalent to 
                                    
                                       
                                          f
                                       
                                       
                                          ′
                                       
                                    
                                  and 
                                    
                                       
                                          g
                                       
                                       
                                          ′
                                       
                                    
                                 , so the greatest lower bound of 
                                    f
                                    ,
                                    g
                                  is also the greatest lower bound of 
                                    
                                       
                                          f
                                       
                                       
                                          ′
                                       
                                    
                                    ,
                                    
                                       
                                          g
                                       
                                       
                                          ′
                                       
                                    
                                 .

Let 
                                    T
                                    =
                                    {
                                    
                                       
                                          t
                                       
                                       
                                          i
                                       
                                    
                                    :
                                    i
                                    ∈
                                    [
                                    0
                                    ,
                                    P
                                    −
                                    1
                                    ]
                                    }
                                  (where 
                                    P
                                    =
                                    |
                                    V
                                    ∪
                                    U
                                    |
                                    =
                                    |
                                    T
                                    |
                                 ) be the step list of f and g. Let 
                                    (
                                    
                                       
                                          f
                                       
                                       
                                          i
                                       
                                       
                                          −
                                       
                                    
                                    ,
                                    
                                       
                                          f
                                       
                                       
                                          i
                                       
                                       
                                          +
                                       
                                    
                                    )
                                    ,
                                    (
                                    
                                       
                                          g
                                       
                                       
                                          i
                                       
                                       
                                          −
                                       
                                    
                                    ,
                                    
                                       
                                          g
                                       
                                       
                                          i
                                       
                                       
                                          +
                                       
                                    
                                    )
                                  be the values (i.e., lower and upper sides) of 
                                    f
                                    ,
                                    g
                                  in the generic step 
                                    [
                                    
                                       
                                          t
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          t
                                       
                                       
                                          i
                                          +
                                          1
                                       
                                    
                                    ]
                                 . We will split each step 
                                    [
                                    
                                       
                                          t
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          t
                                       
                                       
                                          i
                                          +
                                          1
                                       
                                    
                                    ]
                                  into sub-steps, with respect to intersections of the sides of the two trapezoids (one from f, one from g, lines 9–21). This applies also for the last steps. If there is no intersection, we leave the step unchanged (line 26). Each step 
                                    [
                                    
                                       
                                          t
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          t
                                       
                                       
                                          i
                                          +
                                          1
                                       
                                    
                                    ]
                                  will then generate one (or more) steps in 
                                    f
                                    
                                       
                                          ∩
                                       
                                       
                                          ♯
                                       
                                    
                                    g
                                 , depending on the intersections of the sides in such step. The goal is to obtain sub-steps in which the sides of the two trapezoids do not intersect each other in any point inside the sub-step range.

By the first constraint on abstract elements, we know that, inside a step, the upper and lower side of a trapezoid do not intersect. In fact, the two sides could have an extreme in common (the value at t
                                 
                                    i
                                  or at 
                                    
                                       
                                          t
                                       
                                       
                                          i
                                          +
                                          1
                                       
                                    
                                 ) or they could be the same line, but they surely do not have an intersection point inside 
                                    [
                                    
                                       
                                          t
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          t
                                       
                                       
                                          i
                                          +
                                          1
                                       
                                    
                                    ]
                                 , otherwise they would violate the first constraint (Eq. 2.2). For this reason, we know for sure that 
                                    
                                       
                                          f
                                       
                                       
                                          i
                                       
                                       
                                          −
                                       
                                    
                                    ,
                                    
                                       
                                          f
                                       
                                       
                                          i
                                       
                                       
                                          +
                                       
                                    
                                  do not intersect each other, and the same holds for 
                                    
                                       
                                          g
                                       
                                       
                                          i
                                       
                                       
                                          −
                                       
                                    
                                    ,
                                    
                                       
                                          g
                                       
                                       
                                          i
                                       
                                       
                                          +
                                       
                                    
                                 . The possible intersections inside 
                                    (
                                    
                                       
                                          t
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          t
                                       
                                       
                                          i
                                          +
                                          1
                                       
                                    
                                    )
                                  (extremes excluded) are then: (1) between 
                                    
                                       
                                          f
                                       
                                       
                                          i
                                       
                                       
                                          −
                                       
                                    
                                  and 
                                    
                                       
                                          g
                                       
                                       
                                          i
                                       
                                       
                                          −
                                       
                                    
                                 , (2) between 
                                    
                                       
                                          f
                                       
                                       
                                          i
                                       
                                       
                                          +
                                       
                                    
                                  and 
                                    
                                       
                                          g
                                       
                                       
                                          i
                                       
                                       
                                          +
                                       
                                    
                                 , (3) between 
                                    
                                       
                                          f
                                       
                                       
                                          i
                                       
                                       
                                          −
                                       
                                    
                                  and 
                                    
                                       
                                          g
                                       
                                       
                                          i
                                       
                                       
                                          +
                                       
                                    
                                 , and (4) between 
                                    
                                       
                                          f
                                       
                                       
                                          i
                                       
                                       
                                          +
                                       
                                    
                                  and 
                                    
                                       
                                          g
                                       
                                       
                                          i
                                       
                                       
                                          −
                                       
                                    
                                 .

In cases 1 and 2 (intersection between 
                                    
                                       
                                          f
                                       
                                       
                                          i
                                       
                                       
                                          −
                                       
                                    
                                    ,
                                    
                                       
                                          g
                                       
                                       
                                          i
                                       
                                       
                                          −
                                       
                                    
                                  or between 
                                    
                                       
                                          f
                                       
                                       
                                          i
                                       
                                       
                                          +
                                       
                                    
                                    ,
                                    
                                       
                                          g
                                       
                                       
                                          i
                                       
                                       
                                          +
                                       
                                    
                                 , lines 9–21), we split the step in sub-steps with respect to the intersection point. Note that we could obtain two or three sub-steps: if only 
                                    
                                       
                                          f
                                       
                                       
                                          i
                                       
                                       
                                          −
                                       
                                    
                                    ,
                                    
                                       
                                          g
                                       
                                       
                                          i
                                       
                                       
                                          −
                                       
                                    
                                  intersect each other (lines 17–18) then we have two sub-steps (and the same happens if the only intersection regards 
                                    
                                       
                                          f
                                       
                                       
                                          i
                                       
                                       
                                          +
                                       
                                    
                                    ,
                                    
                                       
                                          g
                                       
                                       
                                          i
                                       
                                       
                                          +
                                       
                                    
                                 , lines 20–21 – see Fig. 13
                                 (d) – but if there are two intersections (one between 
                                    
                                       
                                          f
                                       
                                       
                                          i
                                       
                                       
                                          −
                                       
                                    
                                    ,
                                    
                                       
                                          g
                                       
                                       
                                          i
                                       
                                       
                                          −
                                       
                                    
                                  and the other between 
                                    
                                       
                                          f
                                       
                                       
                                          i
                                       
                                       
                                          +
                                       
                                    
                                    ,
                                    
                                       
                                          g
                                       
                                       
                                          i
                                       
                                       
                                          +
                                       
                                    
                                 , lines 12–14 – see Fig. 13(e) – then we obtain three sub-steps.

In cases 3 and 4 (intersection between 
                                    
                                       
                                          f
                                       
                                       
                                          i
                                       
                                       
                                          −
                                       
                                    
                                    ,
                                    
                                       
                                          g
                                       
                                       
                                          i
                                       
                                       
                                          +
                                       
                                    
                                  – Fig. 13(b)) or between 
                                    
                                       
                                          f
                                       
                                       
                                          i
                                       
                                       
                                          +
                                       
                                    
                                    ,
                                    
                                       
                                          g
                                       
                                       
                                          i
                                       
                                       
                                          −
                                       
                                    
                                  (Fig. 13(c), lines 7–8), instead of splitting the step with respect to the intersection point, we immediately return 
                                    
                                       
                                          ⊥
                                       
                                       
                                          ♯
                                       
                                    
                                  as result of the 
                                    
                                       
                                          ∩
                                       
                                       
                                          ♯
                                       
                                    
                                  operation. In fact, assume that 
                                    
                                       
                                          f
                                       
                                       
                                          i
                                       
                                       
                                          −
                                       
                                    
                                    ,
                                    
                                       
                                          g
                                       
                                       
                                          i
                                       
                                       
                                          +
                                       
                                    
                                  have an intersection (the same reasoning holds if the intersection is between 
                                    
                                       
                                          f
                                       
                                       
                                          i
                                       
                                       
                                          +
                                       
                                    
                                    ,
                                    
                                       
                                          g
                                       
                                       
                                          i
                                       
                                       
                                          −
                                       
                                    
                                 ). Then, at one extreme of the step (i.e., at t
                                 
                                    i
                                  or 
                                    
                                       
                                          t
                                       
                                       
                                          i
                                          +
                                          1
                                       
                                    
                                 ), the lower side of the trapezoid of f (
                                    
                                       
                                          f
                                       
                                       
                                          i
                                       
                                       
                                          −
                                       
                                    
                                 ) is greater than the upper side of the trapezoid of g (
                                    
                                       
                                          g
                                       
                                       
                                          i
                                       
                                       
                                          +
                                       
                                    
                                 ). This means that, at such point, the two states have no value in common since the areas of the trapezoids do not intersect: the lowest value assumed by the continuous functions abstracted by f is greater than the greatest value assumed by the continuous functions abstracted by g. The result of the greatest lower bound must therefore be 
                                    
                                       
                                          ⊥
                                       
                                       
                                          ♯
                                       
                                    
                                 .

If the step 
                                    [
                                    
                                       
                                          t
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                       
                                          t
                                       
                                       
                                          i
                                          +
                                          1
                                       
                                    
                                    ]
                                  does not contain any intersection, two cases apply:
                                    
                                       •
                                       If 
                                             [
                                             
                                                
                                                   f
                                                
                                                
                                                   i
                                                
                                                
                                                   −
                                                
                                             
                                             (
                                             
                                                
                                                   t
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                             ,
                                             
                                                
                                                   f
                                                
                                                
                                                   i
                                                
                                                
                                                   +
                                                
                                             
                                             (
                                             
                                                
                                                   t
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                             ]
                                             ∩
                                             [
                                             
                                                
                                                   g
                                                
                                                
                                                   i
                                                
                                                
                                                   −
                                                
                                             
                                             (
                                             
                                                
                                                   t
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                             ,
                                             
                                                
                                                   g
                                                
                                                
                                                   i
                                                
                                                
                                                   +
                                                
                                             
                                             (
                                             
                                                
                                                   t
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                             ]
                                             =
                                             ∅
                                             ∨
                                             [
                                             
                                                
                                                   f
                                                
                                                
                                                   i
                                                
                                                
                                                   −
                                                
                                             
                                             (
                                             
                                                
                                                   t
                                                
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                             )
                                             ,
                                             
                                                
                                                   f
                                                
                                                
                                                   i
                                                
                                                
                                                   +
                                                
                                             
                                             (
                                             
                                                
                                                   t
                                                
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                             )
                                             ]
                                             ∩
                                             [
                                             
                                                
                                                   g
                                                
                                                
                                                   i
                                                
                                                
                                                   −
                                                
                                             
                                             (
                                             
                                                
                                                   t
                                                
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                             )
                                             ,
                                          
                                          
                                             
                                                
                                                   g
                                                
                                                
                                                   i
                                                
                                                
                                                   +
                                                
                                             
                                             (
                                             
                                                
                                                   t
                                                
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                             )
                                             ]
                                             =
                                             ∅
                                           (Fig. 13(a), lines 22–23) then we return 
                                             
                                                
                                                   ⊥
                                                
                                                
                                                   ♯
                                                
                                             
                                          , because in this case at one extreme of the step (i.e., at t
                                          
                                             i
                                           or 
                                             
                                                
                                                   t
                                                
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                          ) the lowest value of one state is greater than the greatest value of the other one.

Otherwise, we do not need to split the step (line 25), since we are in the case sketched by Fig. 13(f).

We know for sure that, in each of the sub-steps generated by the algorithm: (i) the two states have some values in common (i.e., the areas of the trapezoids have a non-empty intersection) at each point of the sub-step; (ii) inside the sub-step the four sides of the two trapezoids derived from f and g do not have any intersection. Then, for each sub-step it is easy to compute the value of the corresponding trapezoid of the result (
                                    f
                                    
                                       
                                          ∩
                                       
                                       
                                          ♯
                                       
                                    
                                    g
                                 ): the lower side will correspond to the greatest of the two lower sides of 
                                    f
                                    ,
                                    g
                                  in the sub-step, while the upper side will correspond to the lowest of the two upper sides of 
                                    f
                                    ,
                                    g
                                  in the sub-step. In Fig. 13(d), (e) and (f) we can see the result of this procedure in three different cases (step split into two substeps, step split into three substeps, step not split, respectively). The gray area represents the resulting trapezoids of 
                                    f
                                    
                                       
                                          ∩
                                       
                                       
                                          ♯
                                       
                                    
                                    g
                                 . We add the newly generated sub-steps to the result at line 26 (at the end of each iteration of the loop).

At the end of the computation (lines 28–32) we normalize the resulting abstract state using Norm (line 31). It could happen that the intervals identified by the two sides of two consecutive steps do not intersect at the border between the two steps (for an example, see Fig. 14
                                 , where the straight lines represent the trapezoids of f, the dashed lines represent the trapezoids of g and the darkened areas represent the trapezoids of 
                                    f
                                    
                                       
                                          ∩
                                       
                                       
                                          ♯
                                       
                                    
                                    g
                                 ). For this reason, we check if the second constraint is satisfied (that is, we are not in the situation of Fig. 14). If the check fails, we return 
                                    
                                       
                                          ⊥
                                       
                                       
                                          ♯
                                       
                                    
                                  as result of the glb operation (lines 28–31). In fact, this means that the two multivalued functions f and g do not have any possible value in common at that border and thus their lower bound in the TSF
                                 domain does not exist.

In conclusion, the intersection 
                           f
                           
                              
                                 ∩
                              
                              
                                 ♯
                              
                           
                           g
                         creates a new step function whose value is at every time t the intersection 
                           f
                           (
                           t
                           )
                           ∩
                           g
                           (
                           t
                           )
                        . If this intersection is empty in at least one point, we cannot return a continuous abstract function and then we define 
                           f
                           
                              
                                 ∩
                              
                              
                                 ♯
                              
                           
                           g
                         as 
                           
                              
                                 ⊥
                              
                              
                                 ♯
                              
                           
                        , the bottom element of 
                           
                              
                                 D
                              
                              
                                 ♯
                              
                           
                        . 
                           Lemma 5
                           
                              
                                 
                                    
                                       ∩
                                    
                                    
                                       ♯
                                    
                                 
                               maintains the constraint satisfaction


                           
                              Let f and g be two abstract states which both respect the constraints enunciated in 
                              
                                 Section 2.2 
                              and which are defined on the same set of indices 
                              
                                 T
                                 =
                                 {
                                 
                                    
                                       t
                                    
                                    
                                       i
                                    
                                 
                                 :
                                 i
                                 ∈
                                 [
                                 0
                                 ,
                                 N
                                 ]
                                 }
                               (if this is not the case, we can apply the Refine operator). Let 
                              
                                 f
                                 
                                    
                                       ∩
                                    
                                    
                                       ♯
                                    
                                 
                                 g
                                 =
                                 h
                               
                              be the result of 
                              
                                 Algorithm 12. Then, h respects the two constraints too.

In the Appendix section.□


                              Let 
                              
                                 f
                                 ,
                                 g
                               
                              be two abstract states and let 
                              
                                 h
                                 =
                                 f
                                 
                                    
                                       ∩
                                    
                                    
                                       ♯
                                    
                                 
                                 g
                               
                              be the result of 
                              
                                 Algorithm 12. Then, h is the greatest lower bound of f and g, i.e.:
                                 
                                    1.
                                    
                                       
                                          h
                                          
                                             
                                                ⊆
                                             
                                             
                                                ♯
                                             
                                          
                                          f
                                          ∧
                                          h
                                          
                                             
                                                ⊆
                                             
                                             
                                                ♯
                                             
                                          
                                          g
                                       
                                    


                                       
                                          k
                                          
                                             
                                                ⊆
                                             
                                             
                                                ♯
                                             
                                          
                                          h
                                          
                                          ∀
                                          k
                                        lower bound of f and g
                                    

In the Appendix section.□

Given two elements x and y of the abstract domain, the least upper bound operator defines the least element z that over-approximates both x and y. In TSF, this means that we have to create a sequence of trapezoids that are as narrow as possible and that, at the same time, contain the two given sequences of trapezoids.

Let 
                           
                              
                                 f
                              
                              
                                 ′
                              
                           
                           =
                           
                              
                                 ⋀
                              
                              
                                 0
                                 ≤
                                 k
                                 ≤
                                 N
                              
                           
                           {
                           
                              
                                 x
                              
                              
                                 k
                              
                           
                           :
                           
                              
                                 v
                              
                              
                                 k
                              
                           
                           }
                         and 
                           
                              
                                 g
                              
                              
                                 ′
                              
                           
                           =
                           
                              
                                 ⋀
                              
                              
                                 0
                                 ≤
                                 j
                                 ≤
                                 M
                              
                           
                           {
                           
                              
                                 u
                              
                              
                                 j
                              
                           
                           :
                           
                              
                                 w
                              
                              
                                 j
                              
                           
                           }
                         be two abstract states. In order to define the least upper bound of 
                           
                              
                                 f
                              
                              
                                 ′
                              
                           
                         and 
                           
                              
                                 g
                              
                              
                                 ′
                              
                           
                        , we use an algorithm very similar to the one presented for the glb in Section 2.7. First, we refine 
                           
                              
                                 f
                              
                              
                                 ′
                              
                           
                         and 
                           
                              
                                 g
                              
                              
                                 ′
                              
                           
                         on the same step list, obtaining 
                           f
                           =
                           Refine
                           (
                           
                              
                                 f
                              
                              
                                 ′
                              
                           
                           ,
                           U
                           )
                         and 
                           g
                           =
                           Refine
                           (
                           
                              
                                 g
                              
                              
                                 ′
                              
                           
                           ,
                           V
                           )
                         where V and U are the step list of 
                           
                              
                                 f
                              
                              
                                 ′
                              
                           
                         and 
                           
                              
                                 g
                              
                              
                                 ′
                              
                           
                        , respectively. Then, for each step of f and g we look at the two trapezoids and check if there are intersections either between the two lower sides (
                           
                              
                                 f
                              
                              
                                 i
                              
                              
                                 −
                              
                           
                           ,
                           
                              
                                 g
                              
                              
                                 i
                              
                              
                                 −
                              
                           
                        ) or between the two upper sides (
                           
                              
                                 f
                              
                              
                                 i
                              
                              
                                 +
                              
                           
                           ,
                           
                              
                                 g
                              
                              
                                 i
                              
                              
                                 +
                              
                           
                        ). We split the step with respect to such intersections; if there are none, the step remains unsplit. In each of these new steps, we are sure that neither the upper sides nor the lower sides intersect each other. So, the resulting trapezoid for each new step is made by the greatest of the upper sides and the lowest of the lower sides. The algorithm is depicted in Fig. 15
                        . For some examples, see Fig. 16
                        .

The algorithm is very similar to the one introduced for the glb, with the following differences:
                           
                              •
                              min and max are reversed, since here we keep the lowest line between 
                                    
                                       
                                          f
                                       
                                       
                                          i
                                       
                                       
                                          −
                                       
                                    
                                    ,
                                    
                                       
                                          g
                                       
                                       
                                          i
                                       
                                       
                                          −
                                       
                                    
                                  and the greatest line between 
                                    
                                       
                                          f
                                       
                                       
                                          i
                                       
                                       
                                          +
                                       
                                    
                                    ,
                                    
                                       
                                          g
                                       
                                       
                                          i
                                       
                                       
                                          +
                                       
                                    
                                  in order to over-approximate f
                                 
                                    i
                                  and g
                                 
                                    i
                                 ;

we never return 
                                    
                                       
                                          ⊥
                                       
                                       
                                          ♯
                                       
                                    
                                  because the lub between two values is always possible and it also satisfies, by construction, the constraints of Section 2.2.

Let 
                                 f
                                 ,
                                 g
                               be two abstract states which both respect the constraints enunciated in Section 2.2 and which are defined on the same set of indices 
                                 T
                                 =
                                 {
                                 
                                    
                                       t
                                    
                                    
                                       i
                                    
                                 
                                 :
                                 i
                                 ∈
                                 [
                                 0
                                 ,
                                 N
                                 ]
                                 }
                               (if it is not the case, we can apply the Refine operator). Let 
                                 f
                                 
                                    
                                       ∪
                                    
                                    
                                       ♯
                                    
                                 
                                 g
                                 =
                                 h
                               be the result of Algorithm 15. Then, the abstract state h satisfies the two constraints too.

In the Appendix section.□


                              
                                 
                                    
                                       ∪
                                    
                                    
                                       ♯
                                    
                                 
                               
                              is a least upper bound operator. Let 
                              
                                 f
                                 
                                    
                                       ∪
                                    
                                    
                                       ♯
                                    
                                 
                                 g
                                 =
                                 h
                               
                              be the result of 
                              
                                 Algorithm 15. Then, h is the least upper bound of f and g, i.e.:
                                 
                                    1.
                                    
                                       
                                          f
                                          
                                             
                                                ⊆
                                             
                                             
                                                ♯
                                             
                                          
                                          h
                                          ∧
                                          g
                                          
                                             
                                                ⊆
                                             
                                             
                                                ♯
                                             
                                          
                                          h
                                       .


                                       
                                          h
                                          
                                             
                                                ⊆
                                             
                                             
                                                ♯
                                             
                                          
                                          k
                                          ∀
                                          k
                                        
                                       upper bound of f and g.

In the Appendix section.□

The dual operator of Refine is Compact. This operator reduces the number of steps contained in an abstract state, and it is useful in order to keep it below a given threshold and make the analysis convergent (throughout the widening which exploits this operator). Compact works by merging a pair of steps into a single one, and by repeating the same procedure until the threshold is reached. While Refine leaves the precision of an abstraction unchanged, the Compact operator induces some loss of precision, since it merges together some steps.

Let 
                           f
                           =
                           
                              
                                 ⋀
                              
                              
                                 0
                                 ≤
                                 i
                                 ≤
                                 N
                              
                           
                           {
                           
                              
                                 t
                              
                              
                                 i
                              
                           
                           :
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                           }
                         be an abstract state, and let M be the threshold to reach, with 
                           M
                           <
                           N
                           +
                           1
                        . The algorithm (i) chooses the step with the minimum width (
                           
                              
                                 w
                              
                              
                                 i
                              
                           
                           =
                           
                              
                                 t
                              
                              
                                 i
                                 +
                                 1
                              
                           
                           −
                           
                              
                                 t
                              
                              
                                 i
                              
                           
                        ), (ii) merges it with the next one, and (iii) repeats (i) and (ii) iteratively until the threshold M is reached. We choose the step to be merged as the smallest one (i.e., the one with the smallest width), but this choice is arbitrary: alternative solutions are possible (for example considering the similarity of values of successive steps) and can be supported by our approach as well. Another possibility would be to minimize the difference between the slopes and intercepts of corresponding lines, that is, the following quantity: 
                           
                              
                                 (
                                 |
                                 
                                    
                                       m
                                    
                                    
                                       i
                                    
                                    
                                       +
                                    
                                 
                                 −
                                 
                                    
                                       m
                                    
                                    
                                       i
                                       +
                                       1
                                    
                                    
                                       +
                                    
                                 
                                 |
                                 )
                                 +
                                 (
                                 |
                                 
                                    
                                       q
                                    
                                    
                                       i
                                    
                                    
                                       +
                                    
                                 
                                 −
                                 
                                    
                                       q
                                    
                                    
                                       i
                                       +
                                       1
                                    
                                    
                                       +
                                    
                                 
                                 |
                                 )
                                 +
                                 (
                                 |
                                 
                                    
                                       m
                                    
                                    
                                       i
                                    
                                    
                                       −
                                    
                                 
                                 −
                                 
                                    
                                       m
                                    
                                    
                                       i
                                       +
                                       1
                                    
                                    
                                       −
                                    
                                 
                                 |
                                 )
                                 +
                                 (
                                 |
                                 
                                    
                                       q
                                    
                                    
                                       i
                                    
                                    
                                       −
                                    
                                 
                                 −
                                 
                                    
                                       q
                                    
                                    
                                       i
                                       +
                                       1
                                    
                                    
                                       −
                                    
                                 
                                 |
                                 )
                              
                           
                        
                     

As for the creation of the merged step, let 
                           
                              
                                 A
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 B
                              
                              
                                 i
                              
                           
                         be the two extremes (the left and right ones, respectively) of 
                           
                              
                                 f
                              
                              
                                 i
                              
                              
                                 +
                              
                           
                         in 
                           [
                           
                              
                                 t
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 t
                              
                              
                                 i
                                 +
                                 1
                              
                           
                           ]
                        , and let 
                           
                              
                                 A
                              
                              
                                 i
                                 +
                                 1
                              
                           
                           ,
                           
                              
                                 B
                              
                              
                                 i
                                 +
                                 1
                              
                           
                         be the two extremes of 
                           
                              
                                 f
                              
                              
                                 i
                                 +
                                 1
                              
                              
                                 +
                              
                           
                         in 
                           [
                           
                              
                                 t
                              
                              
                                 i
                                 +
                                 1
                              
                           
                           ,
                           
                              
                                 t
                              
                              
                                 i
                                 +
                                 2
                              
                           
                           ]
                        . Then the upper side 
                           
                              
                                 f
                              
                              
                                 ′
                                 +
                              
                           
                         of the merged step will have the slope of the side linking A
                        
                           i
                         and 
                           
                              
                                 B
                              
                              
                                 i
                                 +
                                 1
                              
                           
                        . If the point 
                           P
                           =
                           max
                           (
                           
                              
                                 B
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 A
                              
                              
                                 i
                                 +
                                 1
                              
                           
                           )
                         is above such side, the intercept will be such that the side covers exactly P, otherwise the original intercept of the side linking A
                        
                           i
                         and 
                           
                              
                                 B
                              
                              
                                 i
                                 +
                                 1
                              
                           
                         is kept, as depicted in Fig. 17
                        . The same applies symmetrically for the lower side: we consider the minimum between the two points at 
                           
                              
                                 t
                              
                              
                                 i
                                 +
                                 1
                              
                           
                         and we check if such point is below the side linking the two extremes at t
                        
                           i
                         and 
                           
                              
                                 t
                              
                              
                                 i
                                 +
                                 2
                              
                           
                        .

A slightly different process is required if the selected step is next to last (that is, i=N), since in such case we cannot rely on 
                           
                              
                                 t
                              
                              
                                 i
                                 +
                                 2
                              
                           
                        . For the upper side, we consider 
                           
                              
                                 f
                              
                              
                                 N
                              
                              
                                 +
                              
                           
                         and we increase its intercept if one of the extremes of 
                           
                              
                                 f
                              
                              
                                 N
                                 −
                                 1
                              
                              
                                 +
                              
                           
                         in 
                           [
                           
                              
                                 t
                              
                              
                                 N
                                 −
                                 1
                              
                           
                           ,
                           
                              
                                 t
                              
                              
                                 N
                              
                           
                           ]
                         is greater than such side. The same procedure applies symmetrically for the lower side.

In addition, we can specify a list of steps which we do not want to remove from the state. Let T be the step list of the abstract state f, and let 
                           X
                           ⊆
                           T
                         be the step list of f that have to be preserved. Obviously, if M is the number of steps we want in the resulting abstract state, 
                           |
                           X
                           |
                           ≤
                           M
                         holds. Then, 
                           g
                           =
                           
                              
                                 Compact
                              
                              
                                 X
                              
                           
                           (
                           f
                           ,
                           M
                           )
                         is an abstract state obtained by compacting f to M steps, and discarding only steps coming from 
                           T
                           \
                           X
                        . The algorithm presented above can be applied in this case as well by considering only the steps in 
                           T
                           \
                           X
                         when selecting the steps to remove.

It is worth stressing that the Compact operator as defined above is likely to be non-deterministic, since there might be many steps having the minimal width; the same holds for other selection criteria, and that in general it is not confluent, i.e., the non-determinism actually leads to computing different results. Note also that the single compaction steps composing the Compact operator do not enjoy any associativity property; that is, even when compacting the very same steps, if these are compacted using a different ordering (e.g., left-to-right vs right-to-left) a different final result would be obtained. Following all the observations above, more precise results can be obtained either by a different choice of the steps to be merged, or by compacting many consecutive steps in a single operation, rather than one at a time, according to suitable heuristics. 
                           Lemma 9
                           Soundness of Compact
                           


                           
                              Let 
                              
                                 f
                                 ∈
                                 
                                    
                                       D
                                    
                                    
                                       ♯
                                    
                                 
                               
                              and 
                              
                                 M
                                 ∈
                                 N
                              . If 
                              
                                 g
                                 =
                                 Compact
                                 (
                                 f
                                 ,
                                 M
                                 )
                              , then 
                              
                                 f
                                 
                                    
                                       ⊆
                                    
                                    
                                       ♯
                                    
                                 
                                 g
                              .

In the Appendix section.□

The widening operator is parameterized on (i) k
                        
                           S
                        , corresponding to the maximum number of steps allowed in an abstract state, (ii) 
                           
                              
                                 k
                              
                              
                                 M
                              
                           
                           ,
                           
                              
                                 k
                              
                              
                                 Q
                              
                           
                        , corresponding to the maximum value allowed for the slope and intercept of trapezoid sides respectively, and (iii) 
                           
                              
                                 k
                              
                              
                                 I
                              
                           
                           ,
                           
                              
                                 k
                              
                              
                                 L
                              
                           
                        , corresponding to the increment constants for the slope and intercept respectively. All these parameters have to be positive. Thanks to these parameters, we can tune the widening operators at different levels of precision and efficiency.

The widening operator 
                           
                              
                                 ∇
                              
                              
                                 
                                    
                                       D
                                    
                                    
                                       ♯
                                    
                                 
                              
                           
                         is then defined as follows:
                           
                              
                                 
                                    
                                       ∇
                                    
                                    
                                       
                                          
                                             D
                                          
                                          
                                             ♯
                                          
                                       
                                    
                                 
                                 :
                                 (
                                 
                                    
                                       D
                                    
                                    
                                       ♯
                                    
                                 
                                 ,
                                 
                                    
                                       D
                                    
                                    
                                       ♯
                                    
                                 
                                 )
                                 →
                                 
                                    
                                       D
                                    
                                    
                                       ♯
                                    
                                 
                                 f
                                 
                                    
                                       ∇
                                    
                                    
                                       
                                          
                                             D
                                          
                                          
                                             ♯
                                          
                                       
                                    
                                 
                                 g
                                 =
                                 {
                                 
                                    
                                       
                                          
                                             
                                                
                                                   ⊤
                                                
                                                
                                                   ♯
                                                
                                             
                                          
                                          
                                             if
                                             
                                             |
                                             U
                                             |
                                             >
                                             
                                                
                                                   k
                                                
                                                
                                                   S
                                                
                                             
                                          
                                       
                                       
                                          
                                             f
                                          
                                          
                                             if
                                             
                                             g
                                             
                                                
                                                   ⊆
                                                
                                                
                                                   ♯
                                                
                                             
                                             f
                                          
                                       
                                       
                                          
                                             
                                                
                                                   Compact
                                                
                                                
                                                   U
                                                
                                             
                                             (
                                             
                                                
                                                   h
                                                
                                                
                                                   MQ
                                                
                                             
                                             ,
                                             
                                                
                                                   k
                                                
                                                
                                                   S
                                                
                                             
                                             )
                                          
                                          
                                             otherwise
                                          
                                       
                                    
                                 
                              
                           
                        where U is the step list of the abstract state f.

We distinguish three cases: 
                           
                              
                                 |
                                 U
                                 |
                                 >
                                 
                                    
                                       k
                                    
                                    
                                       S
                                    
                                 
                              :
                           
                              
                                 f exceeds the maximum number of steps allowed in an abstract state, k
                                 
                                    S
                                 , and we return 
                                    
                                       
                                          ⊤
                                       
                                       
                                          ♯
                                       
                                    
                                 .

We have reached a stable iterate, and we simply return f.

We return the compacted version of h
                                 
                                    MQ
                                 , keeping all the steps U of f (we know that 
                                    |
                                    U
                                    |
                                    ≤
                                    
                                       
                                          k
                                       
                                       
                                          S
                                       
                                    
                                 , otherwise we would have returned 
                                    
                                       
                                          ⊤
                                       
                                       
                                          ♯
                                       
                                    
                                 ). In this way, we are sure that U will be a subset of the step list of the result (
                                    f
                                    
                                       
                                          ∇
                                       
                                       
                                          
                                             
                                                D
                                             
                                             
                                                ♯
                                             
                                          
                                       
                                    
                                    g
                                 ). The abstract state h
                                 
                                    MQ
                                  is built as follows. Let f be defined on the step list U, and g be defined on the step list V. Let 
                                    
                                       
                                          f
                                       
                                       
                                          ′
                                       
                                    
                                    =
                                    Refine
                                    (
                                    f
                                    ,
                                    V
                                    )
                                  be the refined version of f with the addition of the indices of g, and 
                                    
                                       
                                          g
                                       
                                       
                                          ′
                                       
                                    
                                    =
                                    Refine
                                    (
                                    g
                                    ,
                                    U
                                    )
                                  the refined version of g with the addition of the indices of f. Then 
                                    
                                       
                                          f
                                       
                                       
                                          ′
                                       
                                    
                                  and 
                                    
                                       
                                          g
                                       
                                       
                                          ′
                                       
                                    
                                  are defined on the same step list 
                                    T
                                    =
                                    U
                                    ∪
                                    V
                                 . So we have that 
                                    
                                       
                                          f
                                       
                                       
                                          ′
                                       
                                    
                                    =
                                    
                                       
                                          ⋀
                                       
                                       
                                          0
                                          ≤
                                          i
                                          ≤
                                          N
                                       
                                    
                                    {
                                    
                                       
                                          t
                                       
                                       
                                          i
                                       
                                    
                                    :
                                    
                                       
                                          v
                                       
                                       
                                          i
                                       
                                    
                                    =
                                    (
                                    
                                       
                                          f
                                       
                                       
                                          i
                                       
                                       
                                          −
                                       
                                    
                                    ,
                                    
                                       
                                          f
                                       
                                       
                                          i
                                       
                                       
                                          +
                                       
                                    
                                    )
                                    }
                                  and 
                                    
                                       
                                          g
                                       
                                       
                                          ′
                                       
                                    
                                    =
                                    
                                       
                                          ⋀
                                       
                                       
                                          0
                                          ≤
                                          i
                                          ≤
                                          N
                                       
                                    
                                    {
                                    
                                       
                                          t
                                       
                                       
                                          i
                                       
                                    
                                    :
                                    
                                       
                                          w
                                       
                                       
                                          i
                                       
                                    
                                    =
                                    (
                                    
                                       
                                          g
                                       
                                       
                                          i
                                       
                                       
                                          −
                                       
                                    
                                    ,
                                    
                                       
                                          g
                                       
                                       
                                          i
                                       
                                       
                                          +
                                       
                                    
                                    )
                                    }
                                 . We define h
                                 
                                    MQ
                                  as 
                                    
                                       
                                          
                                             
                                                h
                                             
                                             
                                                MQ
                                             
                                          
                                          =
                                          
                                             
                                                ⋀
                                             
                                             
                                                0
                                                ≤
                                                i
                                                ≤
                                                N
                                             
                                          
                                          {
                                          
                                             
                                                t
                                             
                                             
                                                i
                                             
                                          
                                          :
                                          
                                             
                                                z
                                             
                                             
                                                i
                                             
                                          
                                          =
                                          (
                                          
                                             
                                                h
                                             
                                             
                                                i
                                             
                                             
                                                −
                                             
                                          
                                          ,
                                          
                                             
                                                h
                                             
                                             
                                                i
                                             
                                             
                                                +
                                             
                                          
                                          )
                                          }
                                       
                                    
                                 where 
                                    (
                                    
                                       
                                          h
                                       
                                       
                                          i
                                       
                                       
                                          −
                                       
                                    
                                    ,
                                    
                                       
                                          h
                                       
                                       
                                          i
                                       
                                       
                                          +
                                       
                                    
                                    )
                                  are defined as follows: 
                                    
                                       
                                          
                                             
                                                h
                                             
                                             
                                                i
                                             
                                             
                                                −
                                             
                                          
                                          (
                                          x
                                          )
                                          =
                                          {
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            g
                                                         
                                                         
                                                            i
                                                         
                                                         
                                                            −
                                                         
                                                      
                                                      (
                                                      x
                                                      )
                                                   
                                                   
                                                      if
                                                      
                                                      
                                                         
                                                            f
                                                         
                                                         
                                                            i
                                                         
                                                         
                                                            −
                                                         
                                                      
                                                      =
                                                      
                                                         
                                                            g
                                                         
                                                         
                                                            i
                                                         
                                                         
                                                            −
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      −
                                                      ∞
                                                   
                                                   
                                                      if
                                                      
                                                      (
                                                      
                                                         
                                                            m
                                                         
                                                         
                                                            
                                                               
                                                                  g
                                                               
                                                               
                                                                  i
                                                               
                                                               
                                                                  −
                                                               
                                                            
                                                         
                                                      
                                                      ≤
                                                      −
                                                      
                                                         
                                                            k
                                                         
                                                         
                                                            M
                                                         
                                                      
                                                      )
                                                      ∨
                                                      (
                                                      
                                                         
                                                            q
                                                         
                                                         
                                                            
                                                               
                                                                  g
                                                               
                                                               
                                                                  i
                                                               
                                                               
                                                                  −
                                                               
                                                            
                                                         
                                                      
                                                      ≤
                                                      −
                                                      
                                                         
                                                            k
                                                         
                                                         
                                                            Q
                                                         
                                                      
                                                      )
                                                      ∨
                                                      (
                                                      
                                                         
                                                            m
                                                         
                                                         
                                                            
                                                               
                                                                  f
                                                               
                                                               
                                                                  i
                                                               
                                                               
                                                                  −
                                                               
                                                            
                                                         
                                                      
                                                      ≤
                                                      −
                                                      
                                                         
                                                            k
                                                         
                                                         
                                                            M
                                                         
                                                      
                                                      )
                                                      ∨
                                                      (
                                                      
                                                         
                                                            q
                                                         
                                                         
                                                            
                                                               
                                                                  f
                                                               
                                                               
                                                                  i
                                                               
                                                               
                                                                  −
                                                               
                                                            
                                                         
                                                      
                                                      ≤
                                                      −
                                                      
                                                         
                                                            k
                                                         
                                                         
                                                            Q
                                                         
                                                      
                                                      )
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            (
                                                            
                                                               
                                                                  g
                                                               
                                                               
                                                                  i
                                                               
                                                               
                                                                  −
                                                               
                                                            
                                                            )
                                                         
                                                         
                                                            •
                                                         
                                                      
                                                      (
                                                      x
                                                      )
                                                   
                                                   
                                                      otherwise
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                h
                                             
                                             
                                                i
                                             
                                             
                                                +
                                             
                                          
                                          (
                                          x
                                          )
                                          =
                                          {
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            g
                                                         
                                                         
                                                            i
                                                         
                                                         
                                                            +
                                                         
                                                      
                                                      (
                                                      x
                                                      )
                                                   
                                                   
                                                      
                                                         
                                                            iff
                                                         
                                                         
                                                            i
                                                         
                                                         
                                                            +
                                                         
                                                      
                                                      =
                                                      
                                                         
                                                            g
                                                         
                                                         
                                                            i
                                                         
                                                         
                                                            +
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      +
                                                      ∞
                                                   
                                                   
                                                      if
                                                      
                                                      (
                                                      
                                                         
                                                            m
                                                         
                                                         
                                                            
                                                               
                                                                  g
                                                               
                                                               
                                                                  i
                                                               
                                                               
                                                                  +
                                                               
                                                            
                                                         
                                                      
                                                      ≥
                                                      
                                                         
                                                            k
                                                         
                                                         
                                                            M
                                                         
                                                      
                                                      )
                                                      ∨
                                                      (
                                                      
                                                         
                                                            q
                                                         
                                                         
                                                            
                                                               
                                                                  g
                                                               
                                                               
                                                                  i
                                                               
                                                               
                                                                  +
                                                               
                                                            
                                                         
                                                      
                                                      ≥
                                                      
                                                         
                                                            k
                                                         
                                                         
                                                            Q
                                                         
                                                      
                                                      )
                                                      ∨
                                                      (
                                                      
                                                         
                                                            m
                                                         
                                                         
                                                            
                                                               
                                                                  f
                                                               
                                                               
                                                                  i
                                                               
                                                               
                                                                  +
                                                               
                                                            
                                                         
                                                      
                                                      ≥
                                                      
                                                         
                                                            k
                                                         
                                                         
                                                            M
                                                         
                                                      
                                                      )
                                                      ∨
                                                      (
                                                      
                                                         
                                                            q
                                                         
                                                         
                                                            
                                                               
                                                                  f
                                                               
                                                               
                                                                  i
                                                               
                                                               
                                                                  +
                                                               
                                                            
                                                         
                                                      
                                                      ≥
                                                      
                                                         
                                                            k
                                                         
                                                         
                                                            Q
                                                         
                                                      
                                                      )
                                                   
                                                
                                                
                                                   
                                                      (
                                                      
                                                         
                                                            g
                                                         
                                                         
                                                            i
                                                         
                                                         
                                                            +
                                                         
                                                      
                                                      )
                                                      °
                                                      (
                                                      x
                                                      )
                                                   
                                                   
                                                      otherwise
                                                   
                                                
                                             
                                          
                                       
                                    
                                 and 
                                    
                                       
                                          
                                             
                                                (
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                )
                                             
                                             
                                                •
                                             
                                          
                                          (
                                          t
                                          )
                                          =
                                          (
                                          
                                             
                                                m
                                             
                                             
                                                
                                                   
                                                      MIN
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                             
                                          
                                          −
                                          
                                             
                                                k
                                             
                                             
                                                I
                                             
                                          
                                          )
                                          ×
                                          t
                                          +
                                          (
                                          
                                             
                                                q
                                             
                                             
                                                
                                                   
                                                      MIN
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                             
                                          
                                          −
                                          
                                             
                                                k
                                             
                                             
                                                L
                                             
                                          
                                          )
                                          (
                                          
                                             
                                                g
                                             
                                             
                                                i
                                             
                                             
                                                +
                                             
                                          
                                          )
                                          °
                                          (
                                          t
                                          )
                                          =
                                          (
                                          
                                             
                                                m
                                             
                                             
                                                
                                                   
                                                      MAX
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                             
                                          
                                          +
                                          
                                             
                                                k
                                             
                                             
                                                I
                                             
                                          
                                          )
                                          ×
                                          t
                                          +
                                          (
                                          
                                             
                                                q
                                             
                                             
                                                
                                                   
                                                      MAX
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                             
                                          
                                          +
                                          
                                             
                                                k
                                             
                                             
                                                L
                                             
                                          
                                          )
                                          
                                             
                                                m
                                             
                                             
                                                
                                                   
                                                      MIN
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                             
                                          
                                          =
                                          min
                                          (
                                          
                                             
                                                m
                                             
                                             
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                             
                                          
                                          ,
                                          
                                             
                                                m
                                             
                                             
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                             
                                          
                                          )
                                          
                                             
                                                q
                                             
                                             
                                                
                                                   
                                                      MIN
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                             
                                          
                                          =
                                          min
                                          (
                                          
                                             
                                                q
                                             
                                             
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                             
                                          
                                          ,
                                          
                                             
                                                q
                                             
                                             
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                             
                                          
                                          )
                                          
                                             
                                                m
                                             
                                             
                                                
                                                   
                                                      MAX
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                             
                                          
                                          =
                                          max
                                          (
                                          
                                             
                                                m
                                             
                                             
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                             
                                          
                                          ,
                                          
                                             
                                                m
                                             
                                             
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                             
                                          
                                          )
                                          
                                             
                                                q
                                             
                                             
                                                
                                                   
                                                      MAX
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                             
                                          
                                          =
                                          max
                                          (
                                          
                                             
                                                q
                                             
                                             
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                             
                                          
                                          ,
                                          
                                             
                                                q
                                             
                                             
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                             
                                          
                                          )
                                       
                                    
                                 
                              

The computation is symmetric for the lower and upper side, so let us focus on 
                                    
                                       
                                          h
                                       
                                       
                                          i
                                       
                                       
                                          +
                                       
                                    
                                    (
                                    x
                                    )
                                 . For each step t
                                 
                                    i
                                  of 
                                    
                                       
                                          f
                                       
                                       
                                          ′
                                       
                                    
                                  and 
                                    
                                       
                                          g
                                       
                                       
                                          ′
                                       
                                    
                                  we consider three distinct cases:
                                    
                                       •
                                       
                                          
                                             
                                                
                                                   f
                                                
                                                
                                                   i
                                                
                                                
                                                   +
                                                
                                             
                                             =
                                             
                                                
                                                   g
                                                
                                                
                                                   i
                                                
                                                
                                                   +
                                                
                                             
                                          : the side is the same in 
                                             
                                                
                                                   f
                                                
                                                
                                                   ′
                                                
                                             
                                           and 
                                             
                                                
                                                   g
                                                
                                                
                                                   ′
                                                
                                             
                                          , so we keep it unchanged.


                                          
                                             (
                                             
                                                
                                                   m
                                                
                                                
                                                   
                                                      
                                                         g
                                                      
                                                      
                                                         i
                                                      
                                                      
                                                         +
                                                      
                                                   
                                                
                                             
                                             ≥
                                             
                                                
                                                   k
                                                
                                                
                                                   M
                                                
                                             
                                             )
                                             ∨
                                             (
                                             
                                                
                                                   q
                                                
                                                
                                                   
                                                      
                                                         g
                                                      
                                                      
                                                         i
                                                      
                                                      
                                                         +
                                                      
                                                   
                                                
                                             
                                             ≥
                                             
                                                
                                                   k
                                                
                                                
                                                   Q
                                                
                                             
                                             )
                                             ∨
                                             (
                                             
                                                
                                                   m
                                                
                                                
                                                   
                                                      
                                                         f
                                                      
                                                      
                                                         i
                                                      
                                                      
                                                         +
                                                      
                                                   
                                                
                                             
                                             ≥
                                             
                                                
                                                   k
                                                
                                                
                                                   M
                                                
                                             
                                             )
                                             ∨
                                             (
                                             
                                                
                                                   q
                                                
                                                
                                                   
                                                      
                                                         f
                                                      
                                                      
                                                         i
                                                      
                                                      
                                                         +
                                                      
                                                   
                                                
                                             
                                             ≥
                                             
                                                
                                                   k
                                                
                                                
                                                   Q
                                                
                                             
                                             )
                                          : the slope (or the intercept) of the side of one abstract state (
                                             
                                                
                                                   g
                                                
                                                
                                                   ′
                                                
                                             
                                           or 
                                             
                                                
                                                   f
                                                
                                                
                                                   ′
                                                
                                             
                                          ) exceeds the threshold k
                                          
                                             M
                                           (k
                                          
                                             Q
                                          ), so we move the side to 
                                             +
                                             ∞
                                          .

Otherwise, we keep the maximum slope and intercept between their values in 
                                             
                                                
                                                   f
                                                
                                                
                                                   i
                                                
                                                
                                                   +
                                                
                                             
                                           and 
                                             
                                                
                                                   g
                                                
                                                
                                                   i
                                                
                                                
                                                   +
                                                
                                             
                                           and then we increase them both by a predefined constant quantity (k
                                          
                                             I
                                           for the slope, k
                                          
                                             L
                                           for the intercept).

Intuitively, the convergence is guaranteed by the combination of:
                           
                              •
                              the application of compact with the parameter k
                                 
                                    S
                                 ;

the parameters k
                                 
                                    M
                                  and k
                                 
                                    Q
                                  that limit the maximal values allowed for the slope and the intercept of a line, respectively. If a certain line exceeds one of these two values, then it goes to 
                                    ±
                                    ∞
                                 , stopping its possible growth in that direction;

the •and 
                                    ○
                                  operators, that shift a side down (•) and up (
                                    ○
                                 ) for a predefined amount respectively. In particular, referring to 
                                    ○
                                 , the maximum slope 
                                    
                                       
                                          m
                                       
                                       
                                          
                                             
                                                MAX
                                             
                                             
                                                i
                                             
                                             
                                                +
                                             
                                          
                                       
                                    
                                  between the ones of 
                                    
                                       
                                          f
                                       
                                       
                                          i
                                       
                                       
                                          +
                                       
                                    
                                  and 
                                    
                                       
                                          g
                                       
                                       
                                          i
                                       
                                       
                                          +
                                       
                                    
                                  is increased by k
                                 
                                    I
                                 , while the maximum intercept 
                                    
                                       
                                          q
                                       
                                       
                                          
                                             
                                                MAX
                                             
                                             
                                                i
                                             
                                             
                                                +
                                             
                                          
                                       
                                    
                                  between the one of 
                                    
                                       
                                          f
                                       
                                       
                                          i
                                       
                                       
                                          +
                                       
                                    
                                  and 
                                    
                                       
                                          g
                                       
                                       
                                          i
                                       
                                       
                                          +
                                       
                                    
                                  is increased by k
                                 
                                    L
                                 . k
                                 
                                    I
                                  and k
                                 
                                    L
                                  are positive values and ensure that we will reach the convergence in a finite number of steps.

Since the normalization may interact to prevent the termination of the iterative sequence, a normalization step is not performed at each step. Therefore, the result of a widening operation might need to be normalized, like in the case of the widening for reduced product [10]. It should be worth noting that an alternative approach may be considered where the semantic nature of abstract elements is preserved, so that the result of the widening will not depend on the synctactic representation considered. For the case of the domains of Octagons, this has been done in [11].

For the soundness of this operator we refer to the definition of [12,13], through the two properties of covering and termination. 
                           Lemma 10
                           Correctness of 
                                 
                                    
                                       ∇
                                    
                                    
                                       
                                          
                                             D
                                          
                                          
                                             ♯
                                          
                                       
                                    
                                 
                              
                           


                           
                              The widening operator 
                              
                                 
                                    
                                       ∇
                                    
                                    
                                       
                                          
                                             D
                                          
                                          
                                             ♯
                                          
                                       
                                    
                                 
                               
                              is correct, that is, it respects the properties of covering and termination:
                                 
                                    1.
                                    
                                       Covering: 
                                          ∀
                                          f
                                          ,
                                          g
                                          ∈
                                          
                                             
                                                D
                                             
                                             
                                                ♯
                                             
                                          
                                          :
                                          f
                                          
                                             
                                                ⊆
                                             
                                             
                                                ♯
                                             
                                          
                                          (
                                          f
                                          
                                             
                                                ∇
                                             
                                             
                                                
                                                   
                                                      D
                                                   
                                                   
                                                      ♯
                                                   
                                                
                                             
                                          
                                          g
                                          )
                                          ∧
                                          g
                                          
                                             
                                                ⊆
                                             
                                             
                                                ♯
                                             
                                          
                                          (
                                          f
                                          
                                             
                                                ∇
                                             
                                             
                                                
                                                   
                                                      D
                                                   
                                                   
                                                      ♯
                                                   
                                                
                                             
                                          
                                          g
                                          )
                                       .


                                       Termination: for every ascending chain 
                                       
                                          
                                             
                                                {
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      j
                                                   
                                                
                                                }
                                             
                                             
                                                j
                                                ≥
                                                0
                                             
                                          
                                       , the ascending chain defined as 
                                       
                                          
                                             
                                                g
                                             
                                             
                                                0
                                             
                                          
                                          =
                                          
                                             
                                                f
                                             
                                             
                                                0
                                             
                                          
                                          ;
                                          
                                             
                                                g
                                             
                                             
                                                j
                                                +
                                                1
                                             
                                          
                                          =
                                          
                                             
                                                g
                                             
                                             
                                                j
                                             
                                          
                                          
                                             
                                                ∇
                                             
                                             
                                                
                                                   
                                                      D
                                                   
                                                   
                                                      ♯
                                                   
                                                
                                             
                                          
                                          
                                             
                                                f
                                             
                                             
                                                j
                                                +
                                                1
                                             
                                          
                                        
                                       stabilizes after a finite number of terms.

In the Appendix section.□

Notice that the widening operator defined above is just one of the (many) possible widening operators that may be defined on 
                           
                              
                                 D
                              
                              
                                 ♯
                              
                           
                        . As a valuable alternative, we might adopt a partitioning on the left argument, as in [14,15]. The advantage of limiting the step list by refraining from adding new ones is that there would be no need of replacing the whole element by 
                           
                              
                                 ⊤
                              
                              
                                 ♯
                              
                           
                         as we do when the number of steps is greater than k
                        
                           S
                        . It would be interesting as a future work to investigate the tradeoff between efficiency and accuracy of different widening operators on TSF.


                        
                           Theorem 11
                           
                              Let 
                              
                                 [
                                 
                                    
                                       D
                                    
                                    
                                       ♯
                                    
                                 
                                 ]
                               
                              be the set of equivalence classes of 
                              
                                 
                                    
                                       D
                                    
                                    
                                       ♯
                                    
                                 
                               
                              wrt the normalization operator. Then 
                              
                                 (
                                 [
                                 
                                    
                                       D
                                    
                                    
                                       ♯
                                    
                                 
                                 ]
                                 ∪
                                 {
                                 
                                    
                                       ⊥
                                    
                                    
                                       ♯
                                    
                                 
                                 }
                                 ,
                                 
                                    
                                       ⊆
                                    
                                    
                                       ♯
                                    
                                 
                                 ,
                                 
                                    
                                       ⊥
                                    
                                    
                                       ♯
                                    
                                 
                                 ,
                                 
                                    
                                       ⊤
                                    
                                    
                                       ♯
                                    
                                 
                                 ,
                                 
                                    
                                       ∪
                                    
                                    
                                       ♯
                                    
                                 
                                 ,
                                 
                                    
                                       ∩
                                    
                                    
                                       ♯
                                    
                                 
                                 )
                               
                              is a lattice.

By Lemma 3 we get that 
                                 
                                    
                                       ⊆
                                    
                                    
                                       ♯
                                    
                                 
                               is a partial order, by Lemma 8 that 
                                 
                                    
                                       ∪
                                    
                                    
                                       ♯
                                    
                                 
                               is the least upper bound operator, by Lemma 6 that 
                                 
                                    
                                       ∩
                                    
                                    
                                       ♯
                                    
                                 
                               is the greatest lower bound operator.□

We also proved the correctness of the widening operator 
                           
                              
                                 ∇
                              
                              
                                 
                                    
                                       D
                                    
                                    
                                       ♯
                                    
                                 
                              
                           
                         in Lemma 10. Therefore, we have defined and proved the correctness of the basic operators required to define an abstract domain in the abstract interpretation framework [1,2]. The basic operators defined are all that is needed when simply approximating the value of a continuous function that can be read by the program. Notice however that the concrete semantics for imperative programs might require more operators than those defined above. E.g., the computation of expressions and assignments is modelled by affine images and preimages, while conditional tests are modelled by constraint addition or the so-called filters.

In this section, we show how to compute the approximation of continuous functions in IVSF
                     and TSF. We consider IVSF
                     as well since [3] did not define its abstraction function, because they relied on a particular type of ODE solver [16]. In the rest of this section, we restrict our attention on 
                        
                           
                              C
                           
                           
                              +
                           
                           
                              2
                           
                        
                      functions, as for IVSF
                     we handle with functions׳ concavity and convexity. However, this restriction may be relaxed yielding to a less precise abstraction in the general case: if the function is not in 
                        
                           
                              C
                           
                           
                              +
                           
                           
                              2
                           
                        
                      in a given interval, in that step it can be safely abstracted by 
                        (
                        0
                        ,
                        h
                        ,
                        0
                        ,
                        k
                        )
                      if the image of f is bounded in 
                        [
                        h
                        ,
                        k
                        ]
                     , and by 
                        (
                        0
                        ,
                        −
                        ∞
                        ,
                        0
                        +
                        ∞
                        )
                      otherwise. Notice that by ”precision” of an abstract representation we mean its total area on a given (finite) interval: when the area is smaller, the abstract representation is more precise.

For both domains IVSF
                     and TSF
                     we consider two different approaches: when the step width is constant and fixed, and when we automatically determine the step distribution. Note that we abstract only one concrete function; this approach can be generalized to the abstraction of a finite set of concrete functions C by computing the abstraction of each function in the set and then returning the least upper bound of all the resulting abstract states.

In the following subsections, we will denote by:
                        
                           •
                           
                              
                                 f
                                 ∈
                                 
                                    
                                       C
                                    
                                    
                                       +
                                    
                                    
                                       2
                                    
                                 
                               – the continuous function we want to abstract;


                              
                                 
                                    
                                       f
                                    
                                    
                                       ′
                                    
                                 
                                 ,
                                 
                                    
                                       f
                                    
                                    
                                       ″
                                    
                                 
                               – its first and second derivatives;


                              
                                 
                                    
                                       F
                                    
                                    
                                       0
                                    
                                    
                                       ′
                                    
                                 
                               – the set containing the points of the domain where 
                                 
                                    
                                       f
                                    
                                    
                                       ′
                                    
                                 
                                 (
                                 x
                                 )
                                 =
                                 0
                               (the minimum and maximum points of the function), that is, 
                                 
                                    
                                       F
                                    
                                    
                                       0
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 {
                                 t
                                 :
                                 
                                    
                                       f
                                    
                                    
                                       ′
                                    
                                 
                                 (
                                 t
                                 )
                                 =
                                 0
                                 }
                              ;


                              
                                 
                                    
                                       F
                                    
                                    
                                       0
                                    
                                    
                                       ″
                                    
                                 
                               – the set containing the points of the domain where 
                                 
                                    
                                       f
                                    
                                    
                                       ″
                                    
                                 
                                 (
                                 x
                                 )
                                 =
                                 0
                               (the inflection points), that is, 
                                 
                                    
                                       F
                                    
                                    
                                       0
                                    
                                    
                                       ″
                                    
                                 
                                 =
                                 {
                                 t
                                 :
                                 
                                    
                                       f
                                    
                                    
                                       ″
                                    
                                 
                                 (
                                 t
                                 )
                                 =
                                 0
                                 }
                              ;


                              
                                 
                                    
                                       
                                          
                                             G
                                          
                                          
                                             0
                                          
                                          
                                             ′
                                          
                                       
                                    
                                    
                                       [
                                       a
                                       ,
                                       b
                                       ]
                                    
                                 
                               – the set containing the maximum and minimum points of f restricted to the domain interval 
                                 [
                                 a
                                 ,
                                 b
                                 ]
                              , that is, 
                                 
                                    
                                       
                                          
                                             G
                                          
                                          
                                             0
                                          
                                          
                                             ′
                                          
                                       
                                    
                                    
                                       [
                                       a
                                       ,
                                       b
                                       ]
                                    
                                 
                                 =
                                 {
                                 f
                                 (
                                 t
                                 )
                                 :
                                 t
                                 ∈
                                 (
                                 [
                                 a
                                 ,
                                 b
                                 ]
                                 ∩
                                 
                                    
                                       F
                                    
                                    
                                       0
                                    
                                    
                                       ′
                                    
                                 
                                 )
                                 }
                              ;


                              
                                 
                                    
                                       
                                          
                                             G
                                          
                                          
                                             0
                                          
                                          
                                             ″
                                          
                                       
                                    
                                    
                                       [
                                       a
                                       ,
                                       b
                                       ]
                                    
                                 
                               – the same set but for the inflection points, that is, 
                                 
                                    
                                       
                                          
                                             G
                                          
                                          
                                             0
                                          
                                          
                                             ″
                                          
                                       
                                    
                                    
                                       [
                                       a
                                       ,
                                       b
                                       ]
                                    
                                 
                                 =
                                 {
                                 f
                                 (
                                 t
                                 )
                                 :
                                 t
                                 ∈
                                 (
                                 [
                                 a
                                 ,
                                 b
                                 ]
                                 ∩
                                 
                                    
                                       F
                                    
                                    
                                       0
                                    
                                    
                                       ″
                                    
                                 
                                 )
                                 }
                              .

Given a fixed step width w, suppose that 
                           [
                           a
                           ,
                           b
                           ]
                         is a generic interval (
                           b
                           −
                           a
                           =
                           w
                           ∧
                           a
                           =
                           k
                           ×
                           w
                           ∧
                           b
                           =
                           (
                           k
                           +
                           1
                           )
                           ×
                           w
                           ∧
                           k
                           ≥
                           0
                           ,
                           w
                           >
                           0
                        ). 
                           M
                           =
                           max
                           (
                           {
                           f
                           (
                           a
                           )
                           ,
                           f
                           (
                           b
                           )
                           }
                           ∪
                           
                              
                                 
                                    
                                       G
                                    
                                    
                                       0
                                    
                                    
                                       ′
                                    
                                 
                              
                              
                                 [
                                 a
                                 ,
                                 b
                                 ]
                              
                           
                           )
                         is the maximum point of the function in the interval 
                           [
                           a
                           ,
                           b
                           ]
                        , extremes included, and 
                           m
                           =
                           min
                           (
                           {
                           f
                           (
                           a
                           )
                           ,
                           f
                           (
                           b
                           )
                           }
                           ∪
                           
                              
                                 
                                    
                                       G
                                    
                                    
                                       0
                                    
                                    
                                       ′
                                    
                                 
                              
                              
                                 [
                                 a
                                 ,
                                 b
                                 ]
                              
                           
                           )
                         is the minimum point of the function in the interval 
                           [
                           a
                           ,
                           b
                           ]
                        , extremes included. The best abstraction in IVSF
                        of this step is the interval 
                           [
                           m
                           ,
                           M
                           ]
                        . To build the abstraction of the function f, we repeat this procedure for each step of the abstract state.

For the IVSF
                        abstract domain, we cannot find a priori the best way to split the domain of f into sub-intervals. We could use different techniques, for example:
                           
                              •
                              splitting in correspondence of the inflection points of the function, and

splitting in correspondence of the intermediate point between each pair of minimum/maximum points.

Once chosen a technique for splitting the domain in steps, we can apply the procedure introduced in Section 3.1 to compute the abstraction of each single step.

In TSF
                        a very good trade-off between complexity and precision of the abstraction can be achieved by splitting the domain in correspondence of (i) the maximum and minimum points 
                           
                              
                                 F
                              
                              
                                 0
                              
                              
                                 ′
                              
                           
                        , and (ii) the inflection points 
                           
                              
                                 F
                              
                              
                                 0
                              
                              
                                 ″
                              
                           
                        , in order to split the function into its convex and concave parts.

Assume that 
                           [
                           a
                           ,
                           b
                           ]
                         is a generic sub-interval obtained using this schema. Then the two sides which compose the value of such step are the following ones (see Fig. 18
                        ):
                           
                              (1)
                              The side l
                                 1 linking the points 
                                    P
                                    =
                                    (
                                    a
                                    ,
                                    f
                                    (
                                    a
                                    )
                                    )
                                  and 
                                    Q
                                    =
                                    (
                                    b
                                    ,
                                    f
                                    (
                                    b
                                    )
                                    )
                                  (the points of f in correspondence of the extremes of the interval 
                                    [
                                    a
                                    ,
                                    b
                                    ]
                                 ).

The side l
                                 2 which has the same slope as l
                                 1 and is tangent to f inside 
                                    [
                                    a
                                    ,
                                    b
                                    ]
                                 . Since we already know the slope of this side, we just need to compute its intercept. The procedure is the following one:
                                    
                                       (a)
                                       Find the point 
                                             
                                                
                                                   x
                                                
                                                
                                                   R
                                                
                                             
                                             ∈
                                             [
                                             a
                                             ,
                                             b
                                             ]
                                           where the first derivative of f is equal to the slope of l
                                          1: 
                                             
                                                
                                                   f
                                                
                                                
                                                   ′
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   R
                                                
                                             
                                             )
                                             =
                                             
                                                
                                                   m
                                                
                                                
                                                   
                                                      
                                                         l
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                
                                             
                                          . This point can be computed by bisection in 
                                             [
                                             a
                                             ,
                                             b
                                             ]
                                          . Notice that this point is unique because, after splitting, the interval does not contain any inflection point.

Let R be the point with coordinates 
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   R
                                                
                                             
                                             ,
                                             f
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   R
                                                
                                             
                                             )
                                             )
                                          . Then l
                                          2 is the side that goes through the point R and with slope equal to the one of l
                                          1 (
                                             
                                                
                                                   m
                                                
                                                
                                                   
                                                      
                                                         l
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                             =
                                             
                                                
                                                   m
                                                
                                                
                                                   
                                                      
                                                         l
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                
                                             
                                          ). The intercept is computed as follows: 
                                             
                                                
                                                   q
                                                
                                                
                                                   
                                                      
                                                         l
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                             =
                                             f
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   R
                                                
                                             
                                             )
                                             −
                                             
                                                
                                                   m
                                                
                                                
                                                   
                                                      
                                                         l
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                             ×
                                             
                                                
                                                   x
                                                
                                                
                                                   R
                                                
                                             
                                          .

Note also that the abstraction procedure introduced above can be further refined so that TSF
                        is always as precise as IVSF
                        by splitting the steps where the upper or lower side intersects the tangent at points of zero derivative. In the case of the 
                           sin
                           (
                           x
                           )
                         function, this leads to the abstraction depicted in Fig. 3.

Also in the case of TSF
                        we can define the abstraction on a fixed step width. Suppose that 
                           [
                           a
                           ,
                           b
                           ]
                         is a generic interval determined by a fixed width w. First of all, we split the interval into sub-intervals, following the schema introduced in Section 3.3. Then for each sub-interval, we compute the upper and lower sides as specified in Section 3.3. Finally, we have to “join” these sub-intervals into a single one (with range 
                           [
                           a
                           ,
                           b
                           ]
                        ) through the Compact operator (see Section 2.9).

Observe that the abstraction function of IVSF
                        is less restrictive than the one of TSF, since TSF׳s abstraction needs the second derivative of the function to know the inflection points.

Unfortunately, the abstraction technique presented in Section 3.3 is theoretically sound but it might be not computable on a finite precision machine, due to the rounding issues of floating point representation. The abstraction function depends on various values: the stationary points (
                           
                              
                                 F
                              
                              
                                 0
                              
                              
                                 ′
                              
                           
                        ), the inflection points (
                           
                              
                                 F
                              
                              
                                 0
                              
                              
                                 ″
                              
                           
                        ), the point 
                           
                              
                                 x
                              
                              
                                 r
                              
                           
                           ∈
                           [
                           a
                           ,
                           b
                           ]
                         such that 
                           
                              
                                 f
                              
                              
                                 ′
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 R
                              
                           
                           )
                           =
                           
                              
                                 m
                              
                              
                                 l
                                 1
                              
                           
                        . Even knowing exactly all the points in 
                           
                              
                                 F
                              
                              
                                 0
                              
                              
                                 ′
                              
                           
                         and 
                           
                              
                                 F
                              
                              
                                 0
                              
                              
                                 ″
                              
                           
                         by mathematical analysis, we may not be able to precisely represent them in a machine (e.g., 
                           
                              
                                 2
                              
                           
                        ).

In this section, we introduce a refinement of the basic abstraction function proposed in Section 3.3 to enforce the soundness of the resulting abstraction function in a floating point computation. In this scenario, only a bounded domain is considered.

For each real value a, we denote by 
                           
                              
                                 a
                              
                              
                                 <
                              
                           
                         and 
                           
                              
                                 a
                              
                              
                                 >
                              
                           
                         the interval floating number representation such that 
                           
                              
                                 a
                              
                              
                                 <
                              
                           
                           ≤
                           a
                           ≤
                           
                              
                                 a
                              
                              
                                 >
                              
                           
                        .

Like in Section 3.3, we split the domain in steps with respect to the stationary points (
                           
                              
                                 F
                              
                              
                                 0
                              
                              
                                 ′
                              
                           
                        ) and the inflection points (
                           
                              
                                 F
                              
                              
                                 0
                              
                              
                                 ″
                              
                           
                        ). We consider as splitting points the set 
                           S
                           =
                           {
                           
                              
                                 t
                              
                              
                                 <
                              
                           
                           ,
                           
                              
                                 t
                              
                              
                                 >
                              
                           
                           :
                           t
                           ∈
                           
                              
                                 F
                              
                              
                                 0
                              
                              
                                 ′
                              
                           
                           ∪
                           
                              
                                 F
                              
                              
                                 0
                              
                              
                                 ″
                              
                           
                           }
                        .

For each step 
                           [
                           
                              
                                 t
                              
                              
                                 <
                              
                           
                           ,
                           
                              
                                 t
                              
                              
                                 >
                              
                           
                           ]
                        , let 
                           
                              
                                 a
                              
                              
                                 1
                              
                           
                           =
                           min
                           {
                           
                              
                                 (
                                 f
                                 (
                                 
                                    
                                       t
                                    
                                    
                                       <
                                    
                                 
                                 )
                                 )
                              
                              
                                 <
                              
                           
                           ,
                           
                              
                                 (
                                 f
                                 (
                                 t
                                 )
                                 )
                              
                              
                                 <
                              
                           
                           ,
                           
                              
                                 (
                                 f
                                 (
                                 
                                    
                                       t
                                    
                                    
                                       >
                                    
                                 
                                 )
                                 )
                              
                              
                                 <
                              
                           
                           }
                         and 
                           
                              
                                 a
                              
                              
                                 2
                              
                           
                           =
                           max
                           {
                           (
                           f
                           
                              
                                 (
                                 
                                    
                                       t
                                    
                                    
                                       <
                                    
                                 
                                 )
                              
                              
                                 >
                              
                           
                           ,
                           
                              
                                 (
                                 f
                                 (
                                 t
                                 )
                                 )
                              
                              
                                 >
                              
                           
                           ,
                           
                              
                                 (
                                 f
                                 (
                                 
                                    
                                       t
                                    
                                    
                                       >
                                    
                                 
                                 )
                                 )
                              
                              
                                 >
                              
                           
                           }
                        . Then, we can abstract the function f in the step 
                           [
                           
                              
                                 t
                              
                              
                                 <
                              
                           
                           ,
                           
                              
                                 t
                              
                              
                                 >
                              
                           
                           ]
                         by 
                           (
                           0
                           ,
                           
                              
                                 a
                              
                              
                                 1
                              
                           
                           ,
                           0
                           ,
                           
                              
                                 a
                              
                              
                                 2
                              
                           
                           )
                        .

Let us consider now a step 
                           [
                           
                              
                                 a
                              
                              
                                 >
                              
                           
                           ,
                           
                              
                                 b
                              
                              
                                 <
                              
                           
                           ]
                        , where 
                           a
                           ≠
                           b
                         are consecutive elements in S. Let us refer to the scenario depicted in Fig. 19
                         (the other cases can be treated similarly). The two sides which compose the value of such step are the following ones:
                           
                              1.
                              Consider the segment l
                                 1 linking the points 
                                    (
                                    
                                       
                                          a
                                       
                                       
                                          >
                                       
                                    
                                    ,
                                    
                                       
                                          (
                                          f
                                          (
                                          a
                                          )
                                          )
                                       
                                       
                                          >
                                       
                                    
                                    )
                                  and 
                                    (
                                    
                                       
                                          b
                                       
                                       
                                          <
                                       
                                    
                                    ,
                                    
                                       
                                          (
                                          f
                                          (
                                          b
                                          )
                                          )
                                       
                                       
                                          >
                                       
                                    
                                    )
                                  (the overapproximations of the points of f in correspondence of the extremes of the interval 
                                    [
                                    
                                       
                                          a
                                       
                                       
                                          >
                                       
                                    
                                    ,
                                    
                                       
                                          b
                                       
                                       
                                          <
                                       
                                    
                                    ]
                                 ). Let m be the slope of l
                                 1 (dotted line in the figure). The upper side will be the segment passing through 
                                    (
                                    
                                       
                                          a
                                       
                                       
                                          >
                                       
                                    
                                    ,
                                    f
                                    
                                       
                                          (
                                          a
                                          )
                                       
                                       
                                          >
                                       
                                    
                                    )
                                  with slope 
                                    
                                       
                                          m
                                       
                                       
                                          >
                                       
                                    
                                 .

Consider the segment l
                                 2 which has as slope 
                                    
                                       
                                          m
                                       
                                       
                                          <
                                       
                                    
                                  and is tangent to f inside 
                                    [
                                    
                                       
                                          a
                                       
                                       
                                          >
                                       
                                    
                                    ,
                                    
                                       
                                          b
                                       
                                       
                                          <
                                       
                                    
                                    ]
                                 . We need to compute its intercept. The procedure is the following one:
                                    
                                       (a)
                                       Find the point 
                                             
                                                
                                                   x
                                                
                                                
                                                   R
                                                
                                             
                                             ∈
                                             [
                                             
                                                
                                                   a
                                                
                                                
                                                   >
                                                
                                             
                                             ,
                                             
                                                
                                                   b
                                                
                                                
                                                   <
                                                
                                             
                                             ]
                                           where the first derivative of f is equal to 
                                             
                                                
                                                   m
                                                
                                                
                                                   <
                                                
                                             
                                           : 
                                             
                                                
                                                   f
                                                
                                                
                                                   ′
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   R
                                                
                                             
                                             )
                                             =
                                             
                                                
                                                   m
                                                
                                                
                                                   <
                                                
                                             
                                          . This point can be computed by bisection in 
                                             [
                                             a
                                             ,
                                             b
                                             ]
                                          .

Let R be the point with coordinates 
                                             (
                                             
                                                
                                                   (
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         R
                                                      
                                                   
                                                   )
                                                
                                                
                                                   >
                                                
                                             
                                             ,
                                             
                                                
                                                   (
                                                   f
                                                   (
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         R
                                                      
                                                   
                                                   )
                                                   )
                                                
                                                
                                                   <
                                                
                                             
                                             )
                                          . Then the lower side is the segment passing by R and with slope equal to 
                                             
                                                
                                                   m
                                                
                                                
                                                   <
                                                
                                             
                                          . The intercept is computed as follows: 
                                             
                                                
                                                   (
                                                   f
                                                   (
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         R
                                                      
                                                   
                                                   )
                                                   )
                                                
                                                
                                                   <
                                                
                                             
                                             −
                                             
                                                
                                                   m
                                                
                                                
                                                   <
                                                
                                             
                                             ×
                                             
                                                
                                                   (
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         R
                                                      
                                                   
                                                   )
                                                
                                                
                                                   >
                                                
                                             
                                          .

@&#EXPERIMENTAL RESULTS@&#

In this section we present some experimental results about the use of TSF, and we compare them with the ones obtained by IVSF. First of all, we explore how the precision of TSF
                     varies with the number of steps of the representation when analyzing some representative functions. Then we consider a standard example of embedded software (introduced in Section 1.1) as a test-bench.

Let us first compare the precision of TSF
                        and IVSF. We apply the abstraction function to a set of representative functions (namely, 
                           sin
                           (
                           x
                           )
                        , x
                        3, e
                        
                           x
                        , and 
                           ln
                           (
                           x
                           +
                           1
                           )
                        
                        
                           3
                        
                        
                           3
                           Note that, since 
                                 ln
                                 (
                                 x
                                 )
                               is not continuous in x=0, we apply it to 
                                 x
                                 +
                                 1
                               in order to have a continuous function in the domain [0, 10]
                        ) in the interval [0, 10] varying the number of steps. We measure the precision of a representation by computing the area covered by the abstract states in the Cartesian plan: the wider the area, the rougher the abstraction. Table 1
                         reports the results of this computation. The first column reports the number of steps. Then, for each analyzed function, we report the area of the TSF
                        and IVSF
                        abstractions, and the ratio between the two areas. For instance, if the ratio is 50%, it means that the TSF
                        area is half of the IVSF
                        one (i.e., it is twice more precise).

We implemented the computation of TSF
                        in Java
                        and we ran it on an Intel Core 2 Quad CPU 2.83GHz with 4GB of RAM, running Windows 7, and the Java SE Runtime Environment 1.6.0_16-b01. The execution is always extremely fast: in the worst case (function e
                        
                           x
                        ), TSF
                        requires 40ms to compute the approximation and the area of the function for all the different numbers of steps. This result is not particularly surprising since the computation mainly performs arithmetic operators for whom modern processors are quite efficient. Since the times of executions are so low, we could not notice any significant difference between TSF
                        and IVSF
                        even if we would expect that IVSF
                        is faster. In addition, we did not notice any relevant memory consumption by the computation since it does not need to allocate any memory.

In all cases, TSF
                        is more precise than IVSF. In the worst case, TSF
                        is almost 4 times more precise (since the ratio is 
                           ≈
                           29
                           %
                        ) and this happens when using a small number of intervals (4). In the best case, it is approximately 330 times more precise (the ratio is 0.3%), and this happens when using a lot of intervals (128).

The accuracy of TSF
                        improves with respect to the one of IVSF
                        when we increase the number of steps. IVSF
                        uses rectangles to approximate portions of the curve, so it is accurate when the curve is “flat” (i.e., similar to a horizontal line), while it loses precision when the curve׳s slope is high. On the other hand, the accuracy of TSF
                        does not depend on the curve slope, since the trapezoids are able to approximate well various kinds of slope. It depends only on how much the curve differs from a straight line within a single step. If in a single step the curve is similar to a straight line, then the error is near zero; if in a single step the curve is very concave/convex, then there is a lack of precision. The bigger the number of steps, the more the function resembles a straight line in each single step (rather than a convex/concave curve) and the more the TSF
                        precision increases.

Consider the motivating example presented in Section 1.1. Table 2
                         reports the intervals of the values of intgrx computed by TSF
                        and IVSF
                        after 104 iterations of the while loop, without applying the widening operator. The smaller the interval, the more precise the analysis. The last column reports the ratio between the widths of the two intervals. TSF
                        obtains more precise results in all the cases. Note that augmenting the numbers of steps in the abstraction improves the precision of both domains, and the error ratio of TSF
                        vs IVSF
                        stabilizes around 60% even if it is slightly better when augmenting the number of steps.

@&#RELATED WORK@&#

The abstraction of continuous functions is not a new topic in static analysis, even if it has been only partially explored so far.

To the best of our knowledge, IVSF
                     has been the first formalism to allow the integration of the continuous environment in an abstract interpretation of embedded software. A static analyzer based on that formalism has been implemented [17] in order to consider the interactions between the program and the physical environments on which it acts. The analyzer (HybridFluctuat) is based upon Fluctuat, a tool developed by CEA which aims at analyzing the numerical precision and stability of complex algorithms. However, as far as we know, IVSF
                     theoretical framework has not been refined further since then. In Section 4 we compare extensively the precision of our approach with respect to IVSF
                     showing that TSF
                     is quite more precise than IVSF
                     when abstracting a representative set of continuous functions.

A useful domain theoretic characterization of continuous function can be found in [18], but this work only describes the continuous functions at the concrete level, and there is nothing involving their sound abstraction.


                     [19] introduced domain-specific abstract domains for digital filters, in the context of ASTREE [20], but did not provide a generic treatment of continuous functions and their abstraction.

As for hybrid systems, previous work on abstract interpretation-based strategies for such systems mainly involves the analysis of hybrid automata [21,22].

Regarding continuity analysis of programs, [23] was the first to advocate a testing methodology for Lipschitz-continuity of software. [24] introduced a type system that verifies the Lipschitz-continuity of functional programs. This system does not handle control flow and does not consider any application other than differential privacy. [25] recently proposed a qualitative program analysis to automatically determine if a program implements a continuous function. The practical motivation they address is the verification of robustness properties of programs whose inputs can have small amounts of error and uncertainty. This work was further extended by [26] to quantify the robustness of a program to uncertainty in its inputs. Since they decompose the verification of robustness into the independent sub-problems of verifying continuity and piecewise robustness, they do not add new insights to the specific problem of program continuity with respect to [25]. Our treatment of continuous functions should be applicable to this particular setting (continuity of programs) as well.

A Trapezoid Step Function is a sequence of trapezoids, one for each step. But a TSF
                     can be seen as a pair of PieceWise Linear (PWL) functions as well, where one PWL function bounds the approximated continuous functions from above and the other one bounds them from below. There exists an extensive literature about PWL functions, since they played an important role in approximation, regression and classification. One of the biggest problems concerns their explicit representation in a closed form [27,28]. Another important issue is to find a PWL approximation of a certain function to minimize or bound the overall area (or the distance in each point) between the original function and the approximation [29–31]. Instead, our approach provides a sound approximation of a function rather than bounding the error of its representation.

In this paper we introduced the Trapezoid Step Functions domain, a new abstract domain aimed at approximating the behaviors of continuous environments. Following the abstract interpretation framework, we formally defined the elements of our domain together with the lattice and the widening operators, proving the soundness of our approach. We then introduced an abstraction function that, given a concrete function, builds up its abstract representation in TSF. Finally, we presented some experimental results about the precision of TSF, and we compared them with the ones obtained by the Interval Valued Step Functions domain (IVSF), that, to the best of our knowledge, is the most refined domain in the context of the abstraction of functions in continuous environments. The experimental results underline that TSF
                     obtains abstractions that are more precise than the ones obtained by IVSF.


                     Future work: We are planning to apply TSF
                     to other case studies. First of all, we want to apply TSF
                     to the approximation of the solutions of Ordinary Differential Equations (as done by IVSF). Then we want to explore how we could use TSF
                     to approximate the values produced by a program (e.g., a simulator of the results given by sensors in embedded systems). In addition, we plan to develop some semantic operators over TSF
                     (e.g., sum and product or other arithmetic operations) to apply it to the cost analysis of code [32]. In the context of cost analysis, it will probably be necessary to extend our approach to multivariate functions (here we only considered univariate ones) in order to allow more complex cost models. Finally, it would be very interesting to investigate how TSF
                     could be used for abstracting multi-valued functions [7], and in particular float-valued functions.

@&#ACKNOWLEDGMENTS@&#

Work partially supported by MIUR Project “Security Horizons”.


                     
                        Lemma 4
                        
                           Given a normalized abstract state f, for any set of indices S, it holds that 
                           
                              f
                              ≡
                              Refine
                              (
                              f
                              ,
                              S
                              )
                           .

The equivalence relation 
                              ≡
                            considers the normalized version of the two elements being compared. We know by hypothesis that f is already in normalized form, so we have to compare f with 
                              Norm
                              (
                              Refine
                              (
                              f
                              ,
                              S
                              )
                              )
                           .

Suppose that f is defined on the step list T, that is, 
                              ∀
                              
                                 
                                    t
                                 
                                 
                                    i
                                 
                              
                              ∈
                              T
                           , the step function f has a step at t
                           
                              i
                           . To underline this relationship, we write f
                           
                              T
                            instead of f. Let 
                              Refine
                              (
                              
                                 
                                    f
                                 
                                 
                                    T
                                 
                              
                              ,
                              S
                              )
                              =
                              
                                 
                                    f
                                 
                                 
                                    R
                                 
                                 
                                    ′
                                 
                              
                            be the refined version of f
                           
                              T
                           , where 
                              R
                              =
                              T
                              ∪
                              S
                           . This means that the result of the Refine operator is a step function 
                              
                                 
                                    f
                                 
                                 
                                    ′
                                 
                              
                            defined on the step list 
                              R
                              =
                              T
                              ∪
                              S
                           . So we can write 
                              
                                 
                                    f
                                 
                                 
                                    T
                                 
                              
                              =
                              
                                 
                                    ⋀
                                 
                                 
                                    i
                                    ∈
                                    [
                                    0
                                    ,
                                    N
                                    −
                                    1
                                    ]
                                 
                              
                              {
                              
                                 
                                    t
                                 
                                 
                                    i
                                 
                              
                              :
                              
                                 
                                    v
                                 
                                 
                                    i
                                 
                              
                              }
                            (supposing 
                              |
                              T
                              |
                              =
                              N
                           ) and 
                              
                                 
                                    f
                                 
                                 
                                    R
                                 
                                 
                                    ′
                                 
                              
                              =
                              
                                 
                                    ⋀
                                 
                                 
                                    j
                                    ∈
                                    [
                                    0
                                    ,
                                    M
                                    −
                                    1
                                    ]
                                 
                              
                              {
                              
                                 
                                    r
                                 
                                 
                                    j
                                 
                              
                              :
                              
                                 
                                    
                                       
                                          v
                                       
                                       
                                          j
                                       
                                    
                                 
                                 
                                    ^
                                 
                              
                              }
                              (
                              supposing
                              (
                              |
                              R
                              |
                              =
                              M
                              )
                           .

By definition of Refine, we know that 
                              ∀
                              
                                 
                                    r
                                 
                                 
                                    j
                                 
                              
                              ∈
                              (
                              S
                              \
                              T
                              )
                              ⊆
                              R
                            the value of the step r
                           
                              j
                            in 
                              
                                 
                                    f
                                 
                                 
                                    R
                                 
                                 
                                    ′
                                 
                              
                            is 
                              
                                 
                                    
                                       
                                          v
                                       
                                       
                                          j
                                       
                                    
                                 
                                 
                                    ^
                                 
                              
                              =
                              
                                 
                                    v
                                 
                                 
                                    max
                                    {
                                    i
                                    :
                                    
                                       
                                          t
                                       
                                       
                                          i
                                       
                                    
                                    ≤
                                    
                                       
                                          r
                                       
                                       
                                          j
                                       
                                    
                                    }
                                 
                              
                           . So, the value of the step r
                           
                              j
                            is the same as the one of a consecutive step already present in f
                           
                              T
                           . The normalization process removes any step which has the same value of the previous one. Then each step 
                              
                                 
                                    r
                                 
                                 
                                    j
                                 
                              
                              ∈
                              (
                              S
                              \
                              T
                              )
                            is removed and the result of the normalization of 
                              
                                 
                                    f
                                 
                                 
                                    R
                                 
                                 
                                    ′
                                 
                              
                            is a step function 
                              
                                 
                                    f
                                 
                                 
                                    T
                                 
                                 
                                    ″
                                 
                              
                            with step indices only from the set T (since 
                              (
                              T
                              ∪
                              S
                              )
                              \
                              (
                              S
                              \
                              T
                              )
                              =
                              T
                           ). Moreover, the value associated to each step t
                           
                              i
                            of 
                              
                                 
                                    f
                                 
                                 
                                    T
                                 
                                 
                                    ″
                                 
                              
                            is 
                              
                                 
                                    v
                                 
                                 
                                    i
                                 
                              
                           , the same as in f
                           
                              T
                           , since neither the Refine operator nor the normalization process change any step value. Then f
                           
                              T
                            and 
                              
                                 
                                    f
                                 
                                 
                                    T
                                 
                                 
                                    ″
                                 
                              
                            are defined on the same step list, and they have the same step values. We can conclude that 
                              
                                 
                                    f
                                 
                                 
                                    T
                                 
                              
                              =
                              
                                 
                                    f
                                 
                                 
                                    T
                                 
                                 
                                    ″
                                 
                              
                              =
                              Norm
                              (
                              
                                 
                                    f
                                 
                                 
                                    R
                                 
                                 
                                    ′
                                 
                              
                              )
                              =
                              Norm
                              (
                              Refine
                              (
                              
                                 
                                    f
                                 
                                 
                                    T
                                 
                              
                              ,
                              S
                              )
                              )
                           , thus 
                              f
                              =
                              Norm
                              (
                              Refine
                              (
                              f
                              ,
                              S
                              )
                              )
                            and finally, since 
                              f
                              =
                              Norm
                              (
                              f
                              )
                           , we have 
                              f
                              ≡
                              Refine
                              (
                              f
                              ,
                              S
                              )
                            by definition of 
                              ≡
                           .


                           Let f and g be two abstract states which both respect the constraints enunciated in 
                           
                              Section 2.2 
                           and which are defined on the same set of indices 
                           
                              T
                              =
                              {
                              
                                 
                                    t
                                 
                                 
                                    i
                                 
                              
                              :
                              i
                              ∈
                              [
                              0
                              ,
                              N
                              ]
                              }
                            (if this is not the case, we can apply the Refine operator). Let 
                           
                              f
                              
                                 
                                    ∩
                                 
                                 
                                    ♯
                                 
                              
                              g
                              =
                              h
                            
                           be the result of 
                           
                              Algorithm 12. Then, h respects the two constraints too.

If 
                              h
                              =
                              
                                 
                                    ⊥
                                 
                                 
                                    ♯
                                 
                              
                           , then it automatically respects the constraints (
                              
                                 
                                    ⊥
                                 
                                 
                                    ♯
                                 
                              
                            is a valid element of the domain). Now assume 
                              h
                              ≠
                              
                                 
                                    ⊥
                                 
                                 
                                    ♯
                                 
                              
                            and 
                              h
                              =
                              
                                 
                                    ⋀
                                 
                                 
                                    j
                                    ∈
                                    [
                                    0
                                    ,
                                    M
                                    ]
                                 
                              
                              {
                              
                                 
                                    x
                                 
                                 
                                    j
                                 
                              
                              :
                              
                                 
                                    v
                                 
                                 
                                    j
                                 
                              
                              =
                              (
                              
                                 
                                    h
                                 
                                 
                                    j
                                 
                                 
                                    −
                                 
                              
                              ,
                              
                                 
                                    h
                                 
                                 
                                    j
                                 
                                 
                                    +
                                 
                              
                              )
                              }
                           . By construction of h, we know that 
                              T
                              ⊆
                              X
                              =
                              {
                              
                                 
                                    x
                                 
                                 
                                    j
                                 
                              
                              :
                              j
                              ∈
                              [
                              0
                              ,
                              M
                              ]
                              }
                           , that is, the steps indices of f and g are a subset of those of h. In fact, h has a number of steps which is greater or equal to the one of f and g, since each step of f and g generates from one to three steps in h, depending on the different cases (lines 12–14, 17–18, 20–21 and 25).

The constraints applied to h are the following ones:
                              
                                 1.
                                 
                                    
                                       ∀
                                       j
                                       ∈
                                       [
                                       0
                                       ,
                                       M
                                       ]
                                       ,
                                       
                                          
                                             h
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       (
                                       
                                          
                                             t
                                          
                                          
                                             j
                                          
                                       
                                       )
                                       ≤
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             +
                                          
                                       
                                       (
                                       
                                          
                                             t
                                          
                                          
                                             j
                                          
                                       
                                       )
                                       ∧
                                       (
                                       
                                          
                                             m
                                          
                                          
                                             N
                                          
                                          
                                             −
                                          
                                       
                                       ≤
                                       
                                          
                                             m
                                          
                                          
                                             N
                                          
                                          
                                             +
                                          
                                       
                                       )
                                     where 
                                       
                                          
                                             m
                                          
                                          
                                             N
                                          
                                          
                                             −
                                          
                                       
                                     and 
                                       
                                          
                                             m
                                          
                                          
                                             N
                                          
                                          
                                             +
                                          
                                       
                                     denote the slopes of 
                                       
                                          
                                             h
                                          
                                          
                                             M
                                          
                                          
                                             −
                                          
                                       
                                     and 
                                       
                                          
                                             h
                                          
                                          
                                             M
                                          
                                          
                                             +
                                          
                                       
                                    , respectively.


                                    
                                       ∀
                                       j
                                       ∈
                                       [
                                       0
                                       ,
                                       M
                                       −
                                       1
                                       ]
                                       ,
                                       [
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             −
                                          
                                       
                                       (
                                       
                                          
                                             t
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       )
                                       ,
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             +
                                          
                                       
                                       (
                                       
                                          
                                             t
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       )
                                       ]
                                       ∩
                                       [
                                       
                                          
                                             h
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                          
                                             −
                                          
                                       
                                       (
                                       
                                          
                                             t
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       )
                                       ,
                                       
                                          
                                             h
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                          
                                             +
                                          
                                       
                                       (
                                       
                                          
                                             t
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       )
                                       ]
                                       ≠
                                       ∅
                                    .

Consider the generic step 
                                       [
                                       
                                          
                                             x
                                          
                                          
                                             j
                                          
                                       
                                       ,
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       ]
                                    , where 
                                       j
                                       ∈
                                       [
                                       0
                                       ,
                                       M
                                       ]
                                     and 
                                       (
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             −
                                          
                                       
                                       ,
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             +
                                          
                                       
                                       )
                                     is the value of h in such step. By construction of h, we know that each step range 
                                       [
                                       
                                          
                                             x
                                          
                                          
                                             j
                                          
                                       
                                       ,
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       ]
                                     of h is a subset of a step range from 
                                       f
                                       ,
                                       g
                                    , that is, 
                                       ∃
                                       i
                                       :
                                       [
                                       
                                          
                                             x
                                          
                                          
                                             j
                                          
                                       
                                       ,
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       ]
                                       ⊆
                                       [
                                       
                                          
                                             t
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             t
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                       
                                       ]
                                     (lines 12–14, 17–18, 20–21 and 25). Let 
                                       (
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       ,
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                       )
                                       ,
                                       (
                                       
                                          
                                             g
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       ,
                                       
                                          
                                             g
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                       )
                                     be the values of f and g in such step, respectively. By construction, we also know that the lines 
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       ,
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                       ,
                                       
                                          
                                             g
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       ,
                                       
                                          
                                             g
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                     do not intersect each other inside 
                                       [
                                       
                                          
                                             x
                                          
                                          
                                             j
                                          
                                       
                                       ,
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       ]
                                     (lines 7, 9, 10, 19). Regarding 
                                       (
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             −
                                          
                                       
                                       ,
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             +
                                          
                                       
                                       )
                                    , we know that 
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             −
                                          
                                       
                                     corresponds to 
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                     or 
                                       
                                          
                                             g
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                    , and that 
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             +
                                          
                                       
                                     corresponds to 
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                     or 
                                       
                                          
                                             g
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                     (since in the algorithm we always use the functions 
                                       max
                                       (
                                       ·
                                       ,
                                       ·
                                       ,
                                       ·
                                       )
                                     and 
                                       min
                                       (
                                       ·
                                       ,
                                       ·
                                       ,
                                       ·
                                       )
                                     which return one of the first two inputs – lines 12–14, 17–18, 20–21 and 25). If both sides 
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             −
                                          
                                       
                                       ,
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             +
                                          
                                       
                                     correspond to sides from the same state (i.e., 
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             −
                                          
                                       
                                       =
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       ∧
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             +
                                          
                                       
                                       =
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                     or 
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             −
                                          
                                       
                                       =
                                       
                                          
                                             g
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       ∧
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             +
                                          
                                       
                                       =
                                       
                                          
                                             g
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                    ), then the first validity condition is satisfied, because both f and g satisfy it. Otherwise, either 
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             −
                                          
                                       
                                       =
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       ∧
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             +
                                          
                                       
                                       =
                                       
                                          
                                             g
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                     or 
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             −
                                          
                                       
                                       =
                                       
                                          
                                             g
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       ∧
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             +
                                          
                                       
                                       =
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                    . Suppose that 
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             −
                                          
                                       
                                       =
                                       
                                          
                                             g
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       ∧
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             +
                                          
                                       
                                       =
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                     (the other case is symmetric). Then, to prove that h satisfies the first validity condition, we must prove that 
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                          
                                       
                                       )
                                       ≥
                                       
                                          
                                             g
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                          
                                       
                                       )
                                       ∧
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       )
                                       ≥
                                       
                                          
                                             g
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       )
                                    :
                                       
                                          •
                                          To prove 
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      j
                                                   
                                                
                                                )
                                                ≥
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      j
                                                   
                                                
                                                )
                                             , for the sake of a contradiction, suppose that 
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      j
                                                   
                                                
                                                )
                                                <
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      j
                                                   
                                                
                                                )
                                             . Then, the result of the glb operation would have been 
                                                
                                                   
                                                      ⊥
                                                   
                                                   
                                                      ♯
                                                   
                                                
                                              (because 
                                                [
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      j
                                                   
                                                
                                                )
                                                ,
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      j
                                                   
                                                
                                                )
                                                ]
                                                ∩
                                                [
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      j
                                                   
                                                
                                                )
                                                ,
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      j
                                                   
                                                
                                                )
                                                ]
                                                =
                                                ∅
                                             ), which is in contradiction with the hypothesis that 
                                                h
                                                ≠
                                                
                                                   
                                                      ⊥
                                                   
                                                   
                                                      ♯
                                                   
                                                
                                             .

To prove 
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                )
                                                ≥
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                )
                                             , the reasoning is symmetrical.

The condition on the slopes in the last step holds trivially.

The second constraint is automatically respected by each output of the glb computation, since we return 
                                       
                                          
                                             ⊥
                                          
                                          
                                             ♯
                                          
                                       
                                     if the property is not satisfied (lines 28–31). □


                           Let 
                           
                              f
                              ,
                              g
                            
                           be two abstract states and let 
                           
                              h
                              =
                              f
                              
                                 
                                    ∩
                                 
                                 
                                    ♯
                                 
                              
                              g
                            
                           be Let 
                           
                              f
                              
                                 
                                    ∩
                                 
                                 
                                    ♯
                                 
                              
                              g
                              =
                              h
                            
                           be the result of 
                           
                              Algorithm 12. Then, h is the greatest lower bound of f and g, i.e.:
                              
                                 1.
                                 
                                    
                                       h
                                       
                                          
                                             ⊆
                                          
                                          
                                             ♯
                                          
                                       
                                       f
                                       ∧
                                       h
                                       
                                          
                                             ⊆
                                          
                                          
                                             ♯
                                          
                                       
                                       g
                                    ,


                                    
                                       k
                                       
                                          
                                             ⊆
                                          
                                          
                                             ♯
                                          
                                       
                                       h
                                       ∀
                                       k
                                     
                                    lower bound of f and g.

Let us first assume that 
                              h
                              ≠
                              
                                 
                                    ⊥
                                 
                                 
                                    ♯
                                 
                              
                            (afterwards we will consider also the case where 
                              h
                              =
                              
                                 
                                    ⊥
                                 
                                 
                                    ♯
                                 
                              
                           ). Also, let 
                              f
                              ,
                              g
                              ,
                              h
                            be defined on the same step list 
                              T
                              =
                              {
                              
                                 
                                    t
                                 
                                 
                                    i
                                 
                              
                              :
                              i
                              ∈
                              [
                              0
                              ,
                              N
                              ]
                              }
                           . We can obtain this situation by refining the three abstract states on the union of their step lists through Refine. By Lemma 4 we know that an abstract state and its refined version are equivalent, so the refinement does not change the order relationship between states. For this reason, in all our proofs we can use indifferently either the original abstract state or its refined version.
                              
                                 1.
                                 Since 
                                       f
                                       ,
                                       g
                                       ,
                                       h
                                     are defined on the same set of indices T, we can write 
                                       f
                                       =
                                       
                                          
                                             ⋀
                                          
                                          
                                             i
                                             ∈
                                             [
                                             0
                                             ,
                                             N
                                             ]
                                          
                                       
                                       {
                                       
                                          
                                             t
                                          
                                          
                                             i
                                          
                                       
                                       :
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                       
                                       }
                                    , 
                                       g
                                       =
                                       
                                          
                                             ⋀
                                          
                                          
                                             i
                                             ∈
                                             [
                                             0
                                             ,
                                             N
                                             ]
                                          
                                       
                                       {
                                       
                                          
                                             t
                                          
                                          
                                             i
                                          
                                       
                                       :
                                       
                                          
                                             g
                                          
                                          
                                             i
                                          
                                       
                                       }
                                     and 
                                       h
                                       =
                                       
                                          
                                             ⋀
                                          
                                          
                                             i
                                             ∈
                                             [
                                             0
                                             ,
                                             N
                                             ]
                                          
                                       
                                       {
                                       
                                          
                                             t
                                          
                                          
                                             i
                                          
                                       
                                       :
                                       
                                          
                                             h
                                          
                                          
                                             i
                                          
                                       
                                       }
                                    . By definition of 
                                       
                                          
                                             ⊆
                                          
                                          
                                             ♯
                                          
                                       
                                    , we have that 
                                       h
                                       
                                          
                                             ⊆
                                          
                                          
                                             ♯
                                          
                                       
                                       f
                                       ∧
                                       h
                                       
                                          
                                             ⊆
                                          
                                          
                                             ♯
                                          
                                       
                                       g
                                       ⇔
                                       ∀
                                       i
                                       ∈
                                       [
                                       0
                                       ,
                                       N
                                       ]
                                       :
                                       
                                          
                                             h
                                          
                                          
                                             i
                                          
                                       
                                       
                                          
                                             ⊑
                                          
                                          
                                             [
                                             
                                                
                                                   t
                                                
                                                
                                                   i
                                                
                                             
                                             ,
                                             
                                                
                                                   t
                                                
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                             ]
                                          
                                       
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                       
                                       ∧
                                       
                                          
                                             h
                                          
                                          
                                             i
                                          
                                       
                                       
                                          
                                             ⊑
                                          
                                          
                                             [
                                             
                                                
                                                   t
                                                
                                                
                                                   i
                                                
                                             
                                             ,
                                             
                                                
                                                   t
                                                
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                             ]
                                          
                                       
                                       
                                          
                                             g
                                          
                                          
                                             i
                                          
                                       
                                    . Let 
                                       [
                                       
                                          
                                             t
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             t
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                       
                                       ]
                                     be a generic step, where 
                                       i
                                       ∈
                                       [
                                       0
                                       ,
                                       N
                                       ]
                                    . By construction of h, we know that 
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                     and 
                                       
                                          
                                             g
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                     do not intersect each other in 
                                       [
                                       
                                          
                                             t
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             t
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                       
                                       ]
                                    , as well as 
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                     and 
                                       
                                          
                                             g
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                     do not intersect (lines 9, 10, 19). Then
                                       
                                          •
                                          For the upper line, we know, by construction, that 
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                              is the lowest between the two non-intersecting sides 
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                              and 
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                              (lines 12–14, 17–18, 20–21 and 25, where we use 
                                                min
                                                (
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                ,
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                ,
                                                ·
                                                )
                                             ), so 
                                                ∀
                                                t
                                                ∈
                                                [
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ,
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                ]
                                                ,
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                t
                                                )
                                                ≤
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                t
                                                )
                                                ∧
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                t
                                                )
                                                ≤
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                t
                                                )
                                             .

For the lower line, we know, by construction, that 
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                              is the greatest between the two not-intersecting sides 
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                              and 
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                              (lines 12–14, 17–18, 20–21 and 25, where we use 
                                                max
                                                
                                                (
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                ,
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                ,
                                                ·
                                                )
                                             ), so 
                                                ∀
                                                t
                                                ∈
                                                [
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ,
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                ]
                                                ,
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                t
                                                )
                                                ≤
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                t
                                                )
                                                ∧
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                t
                                                )
                                                ≤
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                t
                                                )
                                             .

From 
                                                ∀
                                                t
                                                ∈
                                                [
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ,
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                ]
                                                ,
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                t
                                                )
                                                ≤
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                t
                                                )
                                              and from 
                                                ∀
                                                t
                                                ∈
                                                [
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ,
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                ]
                                                ,
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                t
                                                )
                                                ≤
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                t
                                                )
                                             , by definition of 
                                                u
                                                
                                                   
                                                      ⊑
                                                   
                                                   
                                                      [
                                                      a
                                                      ,
                                                      b
                                                      ]
                                                   
                                                
                                                v
                                              (Eq. (1)), it follows that 
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                
                                                
                                                   
                                                      ⊑
                                                   
                                                   
                                                      [
                                                      
                                                         
                                                            t
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            t
                                                         
                                                         
                                                            i
                                                            +
                                                            1
                                                         
                                                      
                                                      ]
                                                   
                                                
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      i
                                                   
                                                
                                             . From 
                                                ∀
                                                t
                                                ∈
                                                [
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ,
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                ]
                                                ,
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                t
                                                )
                                                ≤
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                t
                                                )
                                                ∧
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                t
                                                )
                                                ≤
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                t
                                                )
                                             , it follows that 
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                
                                                
                                                   
                                                      ⊑
                                                   
                                                   
                                                      [
                                                      
                                                         
                                                            t
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            t
                                                         
                                                         
                                                            i
                                                            +
                                                            1
                                                         
                                                      
                                                      ]
                                                   
                                                
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      i
                                                   
                                                
                                             .

Then, 
                                                ∀
                                                i
                                                ∈
                                                I
                                                ,
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                
                                                
                                                   
                                                      ⊑
                                                   
                                                   
                                                      [
                                                      
                                                         
                                                            t
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            t
                                                         
                                                         
                                                            i
                                                            +
                                                            1
                                                         
                                                      
                                                      ]
                                                   
                                                
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ∧
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                
                                                
                                                   
                                                      ⊑
                                                   
                                                   
                                                      [
                                                      
                                                         
                                                            t
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            t
                                                         
                                                         
                                                            i
                                                            +
                                                            1
                                                         
                                                      
                                                      ]
                                                   
                                                
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      i
                                                   
                                                
                                              and so we conclude that 
                                                h
                                                
                                                   
                                                      ⊆
                                                   
                                                   
                                                      ♯
                                                   
                                                
                                                f
                                                ∧
                                                h
                                                
                                                   
                                                      ⊆
                                                   
                                                   
                                                      ♯
                                                   
                                                
                                                g
                                              by definition of 
                                                
                                                   
                                                      ⊆
                                                   
                                                   
                                                      ♯
                                                   
                                                
                                             .

Let 
                                       f
                                       ,
                                       g
                                       ,
                                       h
                                     be defined on the same set of indices T. By contradiction, assume that 
                                       ∃
                                       k
                                       :
                                       k
                                     is a lower bound of f and g, and 
                                       k
                                       ⊈
                                       h
                                    . Let us suppose that k is defined on T (we can always obtain it by applying Refine). This means that 
                                       ∃
                                       i
                                       ∈
                                       I
                                       :
                                       
                                          
                                             k
                                          
                                          
                                             i
                                          
                                       
                                       
                                          
                                             ⋢
                                          
                                          
                                             [
                                             
                                                
                                                   t
                                                
                                                
                                                   i
                                                
                                             
                                             ,
                                             
                                                
                                                   t
                                                
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                             ]
                                          
                                       
                                       
                                          
                                             h
                                          
                                          
                                             i
                                          
                                       
                                    . Since 
                                       
                                          
                                             h
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       ,
                                       
                                          
                                             h
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                       ,
                                       
                                          
                                             k
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       ,
                                       
                                          
                                             k
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                     are straight lines, and by the definition of 
                                       
                                          
                                             ⊑
                                          
                                          
                                             [
                                             a
                                             ,
                                             b
                                             ]
                                          
                                       
                                     (Eq. (1)), at least one of the following equations must be satisfied (otherwise it would hold 
                                       
                                          
                                             k
                                          
                                          
                                             i
                                          
                                       
                                       
                                          
                                             ⊑
                                          
                                          
                                             [
                                             
                                                
                                                   t
                                                
                                                
                                                   i
                                                
                                             
                                             ,
                                             
                                                
                                                   t
                                                
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                             ]
                                          
                                       
                                       
                                          
                                             h
                                          
                                          
                                             i
                                          
                                       
                                    ):
                                       
                                          •
                                          
                                             
                                                
                                                   
                                                      k
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                   
                                                
                                                )
                                                >
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                   
                                                
                                                )
                                             
                                          


                                             
                                                
                                                   
                                                      k
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                )
                                                >
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                )
                                             
                                          


                                             
                                                
                                                   
                                                      k
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                   
                                                
                                                )
                                                <
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                   
                                                
                                                )
                                             
                                          


                                             
                                                
                                                   
                                                      k
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                )
                                                <
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                )
                                             
                                          

This part of the proof is trivial, since 
                                       
                                          
                                             ⊥
                                          
                                          
                                             ♯
                                          
                                       
                                       
                                          
                                             ⊆
                                          
                                          
                                             ♯
                                          
                                       
                                       f
                                       ∧
                                       
                                          
                                             ⊥
                                          
                                          
                                             ♯
                                          
                                       
                                       
                                          
                                             ⊆
                                          
                                          
                                             ♯
                                          
                                       
                                       g
                                     by definition of 
                                       
                                          
                                             ⊥
                                          
                                          
                                             ♯
                                          
                                       
                                    .

If 
                                       h
                                       =
                                       
                                          
                                             ⊥
                                          
                                          
                                             ♯
                                          
                                       
                                    , then one between the following two facts must be true:
                                       
                                          (a)
                                          in some point t of the domain, the two trapezoids of 
                                                f
                                                ,
                                                g
                                              did not have any point in common: 
                                                [
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                t
                                                )
                                                ,
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                t
                                                )
                                                ]
                                                ∩
                                                [
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                t
                                                )
                                                ,
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                t
                                                )
                                                ]
                                                =
                                                ∅
                                              (supposing that 
                                                t
                                                ∈
                                                [
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ,
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                ]
                                             ); this means that 
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                t
                                                )
                                                >
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                t
                                                )
                                                ∨
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                t
                                                )
                                                >
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                t
                                                )
                                              (lines 8 and 23).

the result of the glb computation did not respect the second constraint, because at the border between two steps 
                                                [
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ,
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                ]
                                              and 
                                                [
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                ,
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      2
                                                   
                                                
                                                ]
                                              the two trapezoids of h did not have any point in common: 
                                                [
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                )
                                                ,
                                             
                                             
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                )
                                                ]
                                              
                                             
                                                ∩
                                              
                                             
                                                [
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                )
                                                ,
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                )
                                                ]
                                                =
                                                ∅
                                              (lines 28–31).

Now consider case (b) (the result of the glb did not respect the second constraint – lines 28–29). We will prove that any other lower bound k of f and g does not respect the second constraint, either. For the sake of a contradiction, suppose that 
                                       ∃
                                       k
                                       :
                                       k
                                     is a lower bound of f and g and 
                                       k
                                       ≠
                                       
                                          
                                             ⊥
                                          
                                          
                                             ♯
                                          
                                       
                                    .

The hypothesis 
                                       [
                                       
                                          
                                             h
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       (
                                       
                                          
                                             t
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                       
                                       )
                                       ,
                                       
                                          
                                             h
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                       (
                                       
                                          
                                             t
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                       
                                       )
                                       ]
                                       ∩
                                       [
                                       
                                          
                                             h
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                          
                                             −
                                          
                                       
                                       (
                                       
                                          
                                             t
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                       
                                       )
                                       ,
                                       
                                          
                                             h
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                          
                                             +
                                          
                                       
                                       (
                                       
                                          
                                             t
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                       
                                       )
                                       ]
                                       =
                                       ∅
                                     (violation of the second constraint by h) can be rewritten, by construction of h (lines 12–14, 17–18, 20–21 and 25, where we assign 
                                       
                                          
                                             h
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       =
                                       max
                                       (
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       ,
                                       
                                          
                                             g
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       ,
                                       ·
                                       )
                                     and 
                                       
                                          
                                             h
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                       =
                                       min
                                       (
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                       ,
                                       
                                          
                                             g
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                       ,
                                       ·
                                       )
                                    ), as 
                                       [
                                       A
                                       ,
                                       B
                                       ]
                                       ∩
                                       [
                                       C
                                       ,
                                       D
                                       ]
                                       =
                                       ∅
                                     where
                                       
                                          •
                                          
                                             
                                                A
                                                =
                                                max
                                                (
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                )
                                                ,
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                )
                                                )
                                                ,
                                             
                                          


                                             
                                                B
                                                =
                                                min
                                                (
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                )
                                                ,
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                )
                                                )
                                                ,
                                             
                                          


                                             
                                                C
                                                =
                                                max
                                                (
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                )
                                                ,
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                )
                                                )
                                                ,
                                             
                                          


                                             
                                                D
                                                =
                                                min
                                                (
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                )
                                                ,
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                )
                                                )
                                             
                                          

This means that 
                                       B
                                       <
                                       C
                                       ∨
                                       A
                                       >
                                       D
                                    . Suppose that 
                                       A
                                       >
                                       D
                                    , exactly like it happens in Fig. 14 (the reasoning is symmetrical if 
                                       B
                                       <
                                       C
                                    ). The abstract state k, being a lower bound, must be less or equal than f and g. So, for example, 
                                       
                                          
                                             k
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       (
                                       
                                          
                                             t
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                       
                                       )
                                     must be greater or equal than 
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       (
                                       
                                          
                                             t
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                       
                                       )
                                     and 
                                       
                                          
                                             g
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       (
                                       
                                          
                                             t
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                       
                                       )
                                    . Thus, 
                                       
                                          
                                             k
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       (
                                       
                                          
                                             t
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                       
                                       )
                                       ≥
                                       A
                                    . For the same reason (k is a lower bound of 
                                       f
                                       ,
                                       g
                                    ), 
                                       
                                          
                                             k
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                          
                                             +
                                          
                                       
                                       (
                                       
                                          
                                             t
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                       
                                       )
                                     must be less or equal than both 
                                       
                                          
                                             f
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                          
                                             +
                                          
                                       
                                       (
                                       
                                          
                                             t
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                       
                                       )
                                     and 
                                       
                                          
                                             g
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                          
                                             +
                                          
                                       
                                       (
                                       
                                          
                                             t
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                       
                                       )
                                    : thus, 
                                       
                                          
                                             k
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                          
                                             +
                                          
                                       
                                       (
                                       
                                          
                                             t
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                       
                                       )
                                       ≤
                                       D
                                    . Then, since we know that 
                                       A
                                       >
                                       D
                                    , by transitivity we have 
                                       
                                          
                                             k
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                          
                                             +
                                          
                                       
                                       (
                                       
                                          
                                             t
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                       
                                       )
                                       <
                                       
                                          
                                             k
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       (
                                       
                                          
                                             t
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                       
                                       )
                                    , and this violates the second constraint. The TSF
                                    domain does not include abstract states which do not respect such condition, so k becomes 
                                       
                                          
                                             ⊥
                                          
                                          
                                             ♯
                                          
                                       
                                    . Trivially, it follows 
                                       
                                          
                                             ⊥
                                          
                                          
                                             ♯
                                          
                                       
                                       =
                                       k
                                       
                                          
                                             ⊆
                                          
                                          
                                             ♯
                                          
                                       
                                       h
                                       =
                                       
                                          
                                             ⊥
                                          
                                          
                                             ♯
                                          
                                       
                                    .□


                           Let 
                           
                              f
                              ,
                              g
                            
                           be two abstract states which both respect the constraints enunciated in 
                           
                              Section 2.2 
                           and which are defined on the same set of indices 
                           
                              T
                              =
                              {
                              
                                 
                                    t
                                 
                                 
                                    i
                                 
                              
                              :
                              i
                              ∈
                              [
                              0
                              ,
                              N
                              ]
                              }
                            (if it is not the case, we can use the Refine operator). Let 
                           
                              f
                              
                                 
                                    ∪
                                 
                                 
                                    ♯
                                 
                              
                              g
                              =
                              h
                            
                           be the result of 
                           
                              Algorithm 15. Then, the abstract state h satisfies the two constraints.

Let 
                              h
                              =
                              
                                 
                                    ⋀
                                 
                                 
                                    j
                                    ∈
                                    [
                                    0
                                    ,
                                    M
                                    ]
                                 
                              
                              {
                              
                                 
                                    x
                                 
                                 
                                    j
                                 
                              
                              :
                              
                                 
                                    v
                                 
                                 
                                    j
                                 
                              
                              =
                              (
                              
                                 
                                    h
                                 
                                 
                                    j
                                 
                                 
                                    −
                                 
                              
                              ,
                              
                                 
                                    h
                                 
                                 
                                    j
                                 
                                 
                                    +
                                 
                              
                              )
                              }
                            be the lub of 
                              f
                              ,
                              g
                           . By construction of h, we know that 
                              T
                              ⊆
                              X
                              =
                              {
                              
                                 
                                    x
                                 
                                 
                                    j
                                 
                              
                              :
                              j
                              ∈
                              [
                              0
                              ,
                              M
                              ]
                              }
                           , that is, the steps indices of f and g are a subset of those of h. In fact, h has a number of steps which is greater or equal to the one of 
                              f
                              ,
                              g
                           , since each step of 
                              f
                              ,
                              g
                            generates from one to three steps in h, depending on the sides intersections (lines 10–12, 15–16, 18–19, 21). The constraints applied to h are the following ones:
                              
                                 1.
                                 
                                    
                                       ∀
                                       j
                                       ∈
                                       [
                                       0
                                       ,
                                       M
                                       ]
                                       ,
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             −
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                          
                                       
                                       )
                                       ≤
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             +
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                          
                                       
                                       )
                                       ∧
                                       (
                                       
                                          
                                             m
                                          
                                          
                                             M
                                          
                                          
                                             −
                                          
                                       
                                       ≤
                                       
                                          
                                             m
                                          
                                          
                                             M
                                          
                                          
                                             +
                                          
                                       
                                       )
                                     where 
                                       
                                          
                                             m
                                          
                                          
                                             M
                                          
                                          
                                             −
                                          
                                       
                                     and 
                                       
                                          
                                             m
                                          
                                          
                                             M
                                          
                                          
                                             +
                                          
                                       
                                     are the slopes of the last step.


                                    
                                       ∀
                                       j
                                       ∈
                                       [
                                       0
                                       ,
                                       M
                                       −
                                       1
                                       ]
                                       ,
                                       [
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             −
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       )
                                       ,
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             +
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       )
                                       ]
                                       ∩
                                       [
                                       
                                          
                                             h
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                          
                                             −
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       )
                                       ,
                                       
                                          
                                             h
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                          
                                             +
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       )
                                       ]
                                       ≠
                                       ∅
                                    
                                 

Consider the generic step 
                                       [
                                       
                                          
                                             x
                                          
                                          
                                             j
                                          
                                       
                                       ,
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       ]
                                    , where 
                                       j
                                       ∈
                                       [
                                       0
                                       ,
                                       M
                                       ]
                                     and 
                                       (
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             −
                                          
                                       
                                       ,
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             +
                                          
                                       
                                       )
                                     is the value of h in such step. By construction of h, we know that each step range 
                                       [
                                       
                                          
                                             x
                                          
                                          
                                             j
                                          
                                       
                                       ,
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       ]
                                     of h is a subset of a step range from 
                                       f
                                       ,
                                       g
                                    , that is, 
                                       ∃
                                       i
                                       :
                                       [
                                       
                                          
                                             x
                                          
                                          
                                             j
                                          
                                       
                                       ,
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       ]
                                       ⊆
                                       [
                                       
                                          
                                             t
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             t
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                       
                                       ]
                                     (lines 10–12, 15–16, 18–19, 21). Let 
                                       (
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       ,
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                       )
                                       ,
                                       (
                                       
                                          
                                             g
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       ,
                                       
                                          
                                             g
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                       )
                                     be the values of f and g in such step, respectively. Regarding 
                                       (
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             −
                                          
                                       
                                       ,
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             +
                                          
                                       
                                       )
                                    , we know that 
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             −
                                          
                                       
                                     corresponds to the lowest line between 
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                     and 
                                       
                                          
                                             g
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                    , and that 
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             +
                                          
                                       
                                     corresponds to the greatest line between 
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                     or 
                                       
                                          
                                             g
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                     (lines 10–12, 15–16, 18–19, 21, where we assign 
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             +
                                          
                                       
                                       =
                                       max
                                       (
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                       ,
                                       
                                          
                                             g
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                       ,
                                       ·
                                       )
                                     and 
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             −
                                          
                                       
                                       =
                                       min
                                       (
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       ,
                                       
                                          
                                             g
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       ,
                                       ·
                                       )
                                    ). For this reason, it holds that 
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             +
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                          
                                       
                                       )
                                       ≥
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                          
                                       
                                       )
                                       ∧
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             +
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                          
                                       
                                       )
                                       ≥
                                       
                                          
                                             g
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                          
                                       
                                       )
                                     (for the upper side) and that 
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             −
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                          
                                       
                                       )
                                       ≤
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                          
                                       
                                       )
                                       ∧
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             −
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                          
                                       
                                       )
                                       ≤
                                       
                                          
                                             g
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                          
                                       
                                       )
                                     (for the lower side). By hypothesis, f satisfies the first constraint, so it holds also 
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                          
                                       
                                       )
                                       ≥
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                          
                                       
                                       )
                                    . Combining 
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             +
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                          
                                       
                                       )
                                       ≥
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                          
                                       
                                       )
                                       ∧
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                          
                                       
                                       )
                                       ≥
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                          
                                       
                                       )
                                       ∧
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             −
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                          
                                       
                                       )
                                       ≤
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                          
                                       
                                       )
                                     we obtain, by transitivity, that 
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             +
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                          
                                       
                                       )
                                       ≥
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             −
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                          
                                       
                                       )
                                    . The same reasoning can be done about the value of h in 
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                    , obtaining 
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             +
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       )
                                       ≥
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             −
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       )
                                    . The condition on the slopes of the last step holds trivially. Then, h satisfies the first constraint.

As before, consider the generic step 
                                       [
                                       
                                          
                                             x
                                          
                                          
                                             j
                                          
                                       
                                       ,
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       ]
                                    , where 
                                       j
                                       ∈
                                       [
                                       0
                                       ,
                                       M
                                       −
                                       1
                                       ]
                                     and 
                                       (
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             −
                                          
                                       
                                       ,
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             +
                                          
                                       
                                       )
                                     is the value of h in such step. By construction of h, 
                                       ∃
                                       i
                                       :
                                       [
                                       
                                          
                                             x
                                          
                                          
                                             j
                                          
                                       
                                       ,
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       ]
                                       ⊆
                                       [
                                       
                                          
                                             t
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             t
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                       
                                       ]
                                     (lines 10–12, 15–16, 18–19, 21). Let 
                                       (
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       ,
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                       )
                                       ,
                                       (
                                       
                                          
                                             g
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       ,
                                       
                                          
                                             g
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                       )
                                     be the values of f and g in such step respectively. Moreover, let 
                                       (
                                       
                                          
                                             h
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                          
                                             −
                                          
                                       
                                       ,
                                       
                                          
                                             h
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                          
                                             +
                                          
                                       
                                       )
                                       ,
                                     
                                    
                                       (
                                       
                                          
                                             f
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                          
                                             −
                                          
                                       
                                       ,
                                       
                                          
                                             f
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                          
                                             +
                                          
                                       
                                       )
                                       ,
                                       (
                                       
                                          
                                             g
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                          
                                             −
                                          
                                       
                                       ,
                                       
                                          
                                             g
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                          
                                             +
                                          
                                       
                                       )
                                     be the values of 
                                       f
                                       ,
                                       g
                                     and h in 
                                       [
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             2
                                          
                                       
                                       ]
                                     respectively. Using a similar notation to the one introduced in the second part of Lemma 6, let 
                                       A
                                       =
                                       min
                                       (
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       )
                                       ,
                                       
                                          
                                             g
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       )
                                       )
                                       ,
                                       B
                                       =
                                       max
                                       (
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       )
                                       ,
                                       
                                          
                                             g
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       )
                                       )
                                       ,
                                     
                                    
                                       C
                                       =
                                       min
                                       (
                                       
                                          
                                             f
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                          
                                             −
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       )
                                       ,
                                       
                                          
                                             g
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                          
                                             −
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       )
                                       )
                                       ,
                                       D
                                       =
                                       max
                                       (
                                       
                                          
                                             f
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                          
                                             +
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       )
                                       ,
                                       
                                          
                                             g
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                          
                                             +
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       )
                                       )
                                     be the lower and upper values assumed by h in 
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                     with respect to the trapezoids of steps 
                                       [
                                       
                                          
                                             x
                                          
                                          
                                             j
                                          
                                       
                                       ,
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       ]
                                     and 
                                       [
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             2
                                          
                                       
                                       ]
                                    . The second constraint (
                                       [
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             −
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       )
                                       ,
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             +
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       )
                                       ]
                                       ∩
                                       [
                                       
                                          
                                             h
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                          
                                             −
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       )
                                       ,
                                       
                                          
                                             h
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                          
                                             +
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       )
                                       ]
                                       ≠
                                       ∅
                                    ) can be then rewritten, by construction of h (lines 10–12, 15–16, 18–19, 21, where we assign 
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             +
                                          
                                       
                                       =
                                       max
                                       (
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                       ,
                                       
                                          
                                             g
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                       ,
                                       ·
                                       )
                                     and 
                                       
                                          
                                             h
                                          
                                          
                                             j
                                          
                                          
                                             −
                                          
                                       
                                       =
                                       min
                                       (
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       ,
                                       
                                          
                                             g
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       ,
                                       ·
                                       )
                                    ), as 
                                       [
                                       A
                                       ,
                                       B
                                       ]
                                       ∩
                                       [
                                       C
                                       ,
                                       D
                                       ]
                                       ≠
                                       ∅
                                    . By contradiction, suppose that 
                                       [
                                       A
                                       ,
                                       B
                                       ]
                                       ∩
                                       [
                                       C
                                       ,
                                       D
                                       ]
                                       =
                                       ∅
                                    . Then it must be that 
                                       A
                                       >
                                       D
                                     or 
                                       B
                                       <
                                       C
                                    . Suppose that 
                                       A
                                       >
                                       D
                                     is true (the same reasoning applies to 
                                       B
                                       <
                                       C
                                     symmetrically). Since 
                                       A
                                       =
                                       min
                                       (
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       )
                                       ,
                                       
                                          
                                             g
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       )
                                       )
                                     and 
                                       D
                                       =
                                       max
                                       (
                                       
                                          
                                             f
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                          
                                             +
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       )
                                       ,
                                       
                                          
                                             g
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                          
                                             +
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       )
                                       )
                                    , this means that 
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       )
                                       >
                                       
                                          
                                             f
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                          
                                             +
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       )
                                    . This is a contradiction, because either f has a step starting at 
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                     (and in this case f would not respect the second constraint at the border 
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                    ) or not. In this second case, 
                                       [
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             2
                                          
                                       
                                       ]
                                       ⊆
                                       [
                                       
                                          
                                             t
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             t
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                       
                                       ]
                                     and thus 
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       =
                                       
                                          
                                             f
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                          
                                             −
                                          
                                       
                                       ∧
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                       =
                                       
                                          
                                             f
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                          
                                             +
                                          
                                       
                                    . Then, 
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       )
                                       >
                                       
                                          
                                             f
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                          
                                             +
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       )
                                     can be rewritten as 
                                       
                                          
                                             f
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                          
                                             −
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       )
                                       >
                                       
                                          
                                             f
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                          
                                             +
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       )
                                     which violates the first constraint inside step 
                                       [
                                       
                                          
                                             t
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             t
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                       
                                       ]
                                    . We reached a contradiction, so we must discard the absurd hypothesis that the second constraint is not respected by 
                                       
                                          
                                             ∪
                                          
                                          
                                             ♯
                                          
                                       
                                    .□


                           
                              
                                 
                                    ∪
                                 
                                 
                                    ♯
                                 
                              
                            
                           is a least upper bound operator. Let 
                           
                              h
                              =
                              f
                              
                                 
                                    ∪
                                 
                                 
                                    ♯
                                 
                              
                              g
                            
                           be result of 
                           
                              Algorithm 15. Then h is the least upper bound of f and g, i.e.
                           
                              
                                 1.
                                 
                                    
                                       f
                                       
                                          
                                             ⊆
                                          
                                          
                                             ♯
                                          
                                       
                                       h
                                       ∧
                                       g
                                       
                                          
                                             ⊆
                                          
                                          
                                             ♯
                                          
                                       
                                       h
                                    
                                 


                                    
                                       ∀
                                       k
                                     
                                    upper bound of f and g: 
                                       h
                                       
                                          
                                             ⊆
                                          
                                          
                                             ♯
                                          
                                       
                                       k
                                    
                                 

Let 
                              f
                              ,
                              g
                              ,
                              h
                            be defined on the same step list 
                              T
                              =
                              {
                              
                                 
                                    t
                                 
                                 
                                    i
                                 
                              
                              :
                              i
                              ∈
                              [
                              0
                              ,
                              N
                              ]
                              }
                           : 
                              f
                              =
                              
                                 
                                    ⋀
                                 
                                 
                                    i
                                    ∈
                                    I
                                 
                              
                              {
                              
                                 
                                    t
                                 
                                 
                                    i
                                 
                              
                              :
                              
                                 
                                    f
                                 
                                 
                                    i
                                 
                              
                              }
                              ,
                              g
                              =
                              
                                 
                                    ⋀
                                 
                                 
                                    i
                                    ∈
                                    I
                                 
                              
                              {
                              
                                 
                                    t
                                 
                                 
                                    i
                                 
                              
                              :
                              
                                 
                                    g
                                 
                                 
                                    i
                                 
                              
                              }
                            and 
                              h
                              =
                              
                                 
                                    ⋀
                                 
                                 
                                    i
                                    ∈
                                    I
                                 
                              
                              {
                              
                                 
                                    t
                                 
                                 
                                    i
                                 
                              
                              :
                              
                                 
                                    h
                                 
                                 
                                    i
                                 
                              
                              }
                           . We can obtain this situation by refining the three abstract states on the union of their step lists.
                              
                                 1.
                                 By definition of 
                                       
                                          
                                             ⊆
                                          
                                          
                                             ♯
                                          
                                       
                                    , we have that 
                                       f
                                       
                                          
                                             ⊆
                                          
                                          
                                             ♯
                                          
                                       
                                       h
                                       ∧
                                       g
                                       
                                          
                                             ⊆
                                          
                                          
                                             ♯
                                          
                                       
                                       h
                                       ⇔
                                       ∀
                                       i
                                       ∈
                                       [
                                       0
                                       ,
                                       N
                                       ]
                                       :
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                       
                                       
                                          
                                             ⊑
                                          
                                          
                                             [
                                             
                                                
                                                   t
                                                
                                                
                                                   i
                                                
                                             
                                             ,
                                             
                                                
                                                   t
                                                
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                             ]
                                          
                                       
                                       
                                          
                                             h
                                          
                                          
                                             i
                                          
                                       
                                       ∧
                                       
                                          
                                             g
                                          
                                          
                                             i
                                          
                                       
                                       
                                          
                                             ⊑
                                          
                                          
                                             [
                                             
                                                
                                                   t
                                                
                                                
                                                   i
                                                
                                             
                                             ,
                                             
                                                
                                                   t
                                                
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                             ]
                                          
                                       
                                       
                                          
                                             h
                                          
                                          
                                             i
                                          
                                       
                                    . Let 
                                       [
                                       
                                          
                                             t
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             t
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                       
                                       ]
                                     be a generic step, where 
                                       i
                                       ∈
                                       [
                                       0
                                       ,
                                       N
                                       ]
                                    . By construction of h, we know that 
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                     and 
                                       
                                          
                                             g
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                     do not intersect each other in 
                                       [
                                       
                                          
                                             t
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             t
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                       
                                       ]
                                    , as well as 
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                     and 
                                       
                                          
                                             g
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                     do not intersect (lines 7, 8, 17). Then
                                       
                                          •
                                          For the upper line, we know by construction that 
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                              is the greatest between the two non-intersecting sides 
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                              and 
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                              (lines 10–12, 15–16, 18–19, 21), so 
                                                ∀
                                                t
                                                ∈
                                                [
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ,
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                ]
                                                ,
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                t
                                                )
                                                ≥
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                t
                                                )
                                                ∧
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                t
                                                )
                                                ≥
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                t
                                                )
                                             .

For the lower line, we know by construction that 
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                              is the lowest between the two non-intersecting sides 
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                              and 
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                              (lines 10–12, 15–16, 18–19, 21), so 
                                                ∀
                                                t
                                                ∈
                                                [
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ,
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                ]
                                                ,
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                t
                                                )
                                                ≤
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                t
                                                )
                                                ∧
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                t
                                                )
                                                ≤
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                t
                                                )
                                             .

From 
                                                ∀
                                                t
                                                ∈
                                                [
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ,
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                ]
                                                ,
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                t
                                                )
                                                ≥
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                t
                                                )
                                              and from 
                                                ∀
                                                t
                                                ∈
                                                [
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ,
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                ]
                                                ,
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                t
                                                )
                                                ≤
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                t
                                                )
                                             , by definition of 
                                                u
                                                
                                                   
                                                      ⊑
                                                   
                                                   
                                                      [
                                                      a
                                                      ,
                                                      b
                                                      ]
                                                   
                                                
                                                v
                                              (Eq. (1)), it follows that 
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      i
                                                   
                                                
                                                
                                                   
                                                      ⊑
                                                   
                                                   
                                                      [
                                                      
                                                         
                                                            t
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            t
                                                         
                                                         
                                                            i
                                                            +
                                                            1
                                                         
                                                      
                                                      ]
                                                   
                                                
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                
                                             . From 
                                                ∀
                                                t
                                                ∈
                                                [
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ,
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                ]
                                                ,
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                t
                                                )
                                                ≥
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                t
                                                )
                                                ∧
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                t
                                                )
                                                ≤
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                t
                                                )
                                             , it follows that 
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      i
                                                   
                                                
                                                
                                                   
                                                      ⊑
                                                   
                                                   
                                                      [
                                                      
                                                         
                                                            t
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            t
                                                         
                                                         
                                                            i
                                                            +
                                                            1
                                                         
                                                      
                                                      ]
                                                   
                                                
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                
                                             .

Then, 
                                                ∀
                                                i
                                                ∈
                                                I
                                                ,
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      i
                                                   
                                                
                                                
                                                   
                                                      ⊑
                                                   
                                                   
                                                      [
                                                      
                                                         
                                                            t
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            t
                                                         
                                                         
                                                            i
                                                            +
                                                            1
                                                         
                                                      
                                                      ]
                                                   
                                                
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ∧
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      i
                                                   
                                                
                                                
                                                   
                                                      ⊑
                                                   
                                                   
                                                      [
                                                      
                                                         
                                                            t
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            t
                                                         
                                                         
                                                            i
                                                            +
                                                            1
                                                         
                                                      
                                                      ]
                                                   
                                                
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                
                                              and so we conclude that 
                                                f
                                                
                                                   
                                                      ⊆
                                                   
                                                   
                                                      ♯
                                                   
                                                
                                                h
                                                ∧
                                                g
                                                
                                                   
                                                      ⊆
                                                   
                                                   
                                                      ♯
                                                   
                                                
                                                h
                                              by definition of 
                                                
                                                   
                                                      ⊆
                                                   
                                                   
                                                      ♯
                                                   
                                                
                                             .

Assume that k is defined on the same step list 
                                       T
                                       =
                                       {
                                       
                                          
                                             t
                                          
                                          
                                             i
                                          
                                       
                                       :
                                       i
                                       ∈
                                       [
                                       0
                                       ,
                                       N
                                       ]
                                       }
                                     as that of 
                                       f
                                       ,
                                       g
                                       ,
                                       h
                                     (as said before, if this is not true, we can make it true by refining each abstract state on the union of the four step lists, maintaining all the relationships among such states). By contradiction, assume that 
                                       h
                                       ⊈
                                       k
                                    , that is 
                                       ∃
                                       i
                                       ∈
                                       [
                                       0
                                       ,
                                       N
                                       ]
                                       :
                                       
                                          
                                             h
                                          
                                          
                                             i
                                          
                                       
                                       
                                          
                                             ⋢
                                          
                                          
                                             [
                                             
                                                
                                                   t
                                                
                                                
                                                   i
                                                
                                             
                                             ,
                                             
                                                
                                                   t
                                                
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                             ]
                                          
                                       
                                       
                                          
                                             k
                                          
                                          
                                             i
                                          
                                       
                                    . Since 
                                       
                                          
                                             h
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       ,
                                       
                                          
                                             h
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                       ,
                                       
                                          
                                             k
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       ,
                                       
                                          
                                             k
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                     are straight lines, and by the definition of 
                                       
                                          
                                             ⊑
                                          
                                          
                                             [
                                             a
                                             ,
                                             b
                                             ]
                                          
                                       
                                     (Eq. (1)), at least one of the following equations must be true (otherwise it would hold 
                                       
                                          
                                             h
                                          
                                          
                                             i
                                          
                                       
                                       
                                          
                                             ⊑
                                          
                                          
                                             [
                                             
                                                
                                                   t
                                                
                                                
                                                   i
                                                
                                             
                                             ,
                                             
                                                
                                                   t
                                                
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                             ]
                                          
                                       
                                       
                                          
                                             k
                                          
                                          
                                             i
                                          
                                       
                                    ):
                                       
                                          •
                                          
                                             
                                                
                                                   
                                                      k
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                   
                                                
                                                )
                                                <
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                   
                                                
                                                )
                                             
                                          


                                             
                                                
                                                   
                                                      k
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                )
                                                <
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                )
                                             
                                          


                                             
                                                
                                                   
                                                      k
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                   
                                                
                                                )
                                                >
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                   
                                                
                                                )
                                             
                                          


                                             
                                                
                                                   
                                                      k
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                )
                                                >
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                )
                                             
                                          


                           Let 
                           
                              f
                              ∈
                              
                                 
                                    D
                                 
                                 
                                    ♯
                                 
                              
                            
                           and 
                           
                              M
                              ∈
                              N
                           . If 
                           
                              g
                              =
                              Compact
                              (
                              f
                              ,
                              M
                              )
                           , then 
                           
                              f
                              
                                 
                                    ⊆
                                 
                                 
                                    ♯
                                 
                              
                              g
                           .

Let N be the number of steps of the abstract state f, where 
                              N
                              >
                              M
                           . In order to prove the proposition above, we have to prove that 
                              f
                              
                                 
                                    ⊆
                                 
                                 
                                    ♯
                                 
                              
                              Compact
                              (
                              f
                              ,
                              N
                              −
                              1
                              )
                           , that is, the execution of one step of the compaction, going from N steps to 
                              N
                              −
                              1
                           . If the reduction of one step decreases the size of the abstract function, then our proposition is proved to be valid, since the reduction function works by reducing repeatedly one step at a time (being equivalent to an iterative process) and the ordering is transitive. In fact, from 
                              f
                              =
                              Compact
                              (
                              f
                              ,
                              N
                              )
                              
                                 
                                    ⊆
                                 
                                 
                                    ♯
                                 
                              
                              Compact
                              (
                              f
                              ,
                              N
                              −
                              1
                              )
                              
                                 
                                    ⊆
                                 
                                 
                                    ♯
                                 
                              
                              
                              ...
                              
                              
                                 
                                    ⊆
                                 
                                 
                                    ♯
                                 
                              
                              Compact
                              (
                              f
                              ,
                              M
                              +
                              1
                              )
                              
                                 
                                    ⊆
                                 
                                 
                                    ♯
                                 
                              
                              Compact
                              (
                              f
                              ,
                              M
                              )
                              =
                              g
                           , we derive (by transitivity of the partial ordering) 
                              f
                              
                                 
                                    ⊆
                                 
                                 
                                    ♯
                                 
                              
                              g
                           .

Let i be the index of the step to be removed, and suppose that 
                              i
                              <
                              N
                              −
                              2
                            (that is, the last step is not involved in the reduction; that case can be trivially proved with slight modifications to this proof). The steps we are joining together are then f
                           
                              i
                            and 
                              
                                 
                                    f
                                 
                                 
                                    i
                                    +
                                    1
                                 
                              
                           ; the result will be the step g
                           
                              i
                            of the new abstract function. Since the steps before and after i remain unchanged, in order to prove that 
                              f
                              
                                 
                                    ⊆
                                 
                                 
                                    ♯
                                 
                              
                              g
                            we just need to prove that 
                              ∀
                              t
                              ∈
                              [
                              
                                 
                                    t
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                                 
                                    t
                                 
                                 
                                    i
                                    +
                                    1
                                 
                              
                              ]
                              :
                              [
                              
                                 
                                    f
                                 
                                 
                                    i
                                 
                                 
                                    −
                                 
                              
                              (
                              t
                              )
                              ,
                              
                                 
                                    f
                                 
                                 
                                    i
                                 
                                 
                                    +
                                 
                              
                              (
                              t
                              )
                              ]
                              ⊆
                              [
                              
                                 
                                    g
                                 
                                 
                                    i
                                 
                                 
                                    −
                                 
                              
                              (
                              t
                              )
                              ,
                              
                                 
                                    g
                                 
                                 
                                    i
                                 
                                 
                                    +
                                 
                              
                              (
                              t
                              )
                              ]
                            and 
                              ∀
                              t
                              ∈
                              [
                              
                                 
                                    t
                                 
                                 
                                    i
                                    +
                                    1
                                 
                              
                              ,
                              
                                 
                                    t
                                 
                                 
                                    i
                                    +
                                    2
                                 
                              
                              ]
                              :
                              [
                              
                                 
                                    f
                                 
                                 
                                    i
                                    +
                                    1
                                 
                                 
                                    −
                                 
                              
                              (
                              t
                              )
                              ,
                              
                                 
                                    f
                                 
                                 
                                    i
                                    +
                                    1
                                 
                                 
                                    +
                                 
                              
                              (
                              t
                              )
                              ]
                              ⊆
                              [
                              
                                 
                                    g
                                 
                                 
                                    i
                                 
                                 
                                    −
                                 
                              
                              (
                              t
                              )
                              ,
                              
                                 
                                    g
                                 
                                 
                                    i
                                 
                                 
                                    +
                                 
                              
                              (
                              t
                              )
                              ]
                           . We consider the two cases separately, first 
                              [
                              
                                 
                                    f
                                 
                                 
                                    i
                                 
                                 
                                    −
                                 
                              
                              (
                              t
                              )
                              ,
                              
                                 
                                    f
                                 
                                 
                                    i
                                 
                                 
                                    +
                                 
                              
                              (
                              t
                              )
                              ]
                              ⊆
                              [
                              
                                 
                                    g
                                 
                                 
                                    i
                                 
                                 
                                    −
                                 
                              
                              (
                              t
                              )
                              ,
                              
                                 
                                    g
                                 
                                 
                                    i
                                 
                                 
                                    +
                                 
                              
                              (
                              t
                              )
                              ]
                            and then 
                              [
                              
                                 
                                    f
                                 
                                 
                                    i
                                    +
                                    1
                                 
                                 
                                    −
                                 
                              
                              (
                              t
                              )
                              ,
                              
                                 
                                    f
                                 
                                 
                                    i
                                    +
                                    1
                                 
                                 
                                    +
                                 
                              
                              (
                              t
                              )
                              ]
                              ⊆
                              [
                              
                                 
                                    g
                                 
                                 
                                    i
                                 
                                 
                                    −
                                 
                              
                              (
                              t
                              )
                              ,
                              
                                 
                                    g
                                 
                                 
                                    i
                                 
                                 
                                    +
                                 
                              
                              (
                              t
                              )
                              ]
                           .

We use the following notation, referring to a generic step 
                              [
                              
                                 
                                    t
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                                 
                                    t
                                 
                                 
                                    i
                                    +
                                    1
                                 
                              
                              ]
                           : 
                              A
                              =
                              
                                 
                                    f
                                 
                                 
                                    i
                                 
                                 
                                    −
                                 
                              
                              (
                              
                                 
                                    t
                                 
                                 
                                    i
                                 
                              
                              )
                           , 
                              B
                              =
                              
                                 
                                    f
                                 
                                 
                                    i
                                 
                                 
                                    −
                                 
                              
                              (
                              
                                 
                                    t
                                 
                                 
                                    i
                                    +
                                    1
                                 
                              
                              )
                           , 
                              C
                              =
                              
                                 
                                    f
                                 
                                 
                                    i
                                 
                                 
                                    +
                                 
                              
                              (
                              
                                 
                                    t
                                 
                                 
                                    i
                                 
                              
                              )
                           , 
                              D
                              =
                              
                                 
                                    f
                                 
                                 
                                    i
                                 
                                 
                                    +
                                 
                              
                              (
                              
                                 
                                    t
                                 
                                 
                                    i
                                    +
                                    1
                                 
                              
                              )
                           . See Fig. 20
                            for a graphical representation of this notation.
                              
                                 
                                    
                                       •
                                    
                                 
                                 (
                                       [
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       (
                                       t
                                       )
                                       ,
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                       (
                                       t
                                       )
                                       ]
                                       ⊆
                                       [
                                       
                                          
                                             g
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       (
                                       t
                                       )
                                       ,
                                       
                                          
                                             g
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                       (
                                       t
                                       )
                                       ]
                                    ) For the upper side, we have two distinct cases:
                                       
                                          
                                             
                                                ○
                                             
                                          
                                          In the first one, the upper side passes for C, and D is below such side; then trivially 
                                                ∀
                                                t
                                                ∈
                                                [
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ,
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                ]
                                                :
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                t
                                                )
                                                ≤
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                t
                                                )
                                             .

Otherwise, the upper side passes for D, and C is below such side (since the upper side is produced by lifting up the side passing for C, so C necessarily remains below; this case is depicted in Fig. 20); in this case we have 
                                                ∀
                                                t
                                                ∈
                                                [
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ,
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                ]
                                                :
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                t
                                                )
                                                ≤
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                t
                                                )
                                              as well.

(
                                       [
                                       
                                          
                                             f
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                          
                                             −
                                          
                                       
                                       (
                                       t
                                       )
                                       ,
                                       
                                          
                                             f
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                          
                                             +
                                          
                                       
                                       (
                                       t
                                       )
                                       ]
                                       ⊆
                                       [
                                       
                                          
                                             g
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       (
                                       t
                                       )
                                       ,
                                       
                                          
                                             g
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                       (
                                       t
                                       )
                                       ]
                                    ) this case is symmetric to the previous one.□


                           The widening operator 
                           
                              
                                 
                                    ∇
                                 
                                 
                                    
                                       
                                          D
                                       
                                       
                                          ♯
                                       
                                    
                                 
                              
                            
                           is correct, that is, it respects the properties of covering and termination:
                              
                                 1.
                                 
                                    Covering: 
                                       ∀
                                       f
                                       ,
                                       g
                                       ∈
                                       
                                          
                                             D
                                          
                                          
                                             ♯
                                          
                                       
                                       :
                                       f
                                       
                                          
                                             ⊆
                                          
                                          
                                             ♯
                                          
                                       
                                       (
                                       f
                                       
                                          
                                             ∇
                                          
                                          
                                             
                                                
                                                   D
                                                
                                                
                                                   ♯
                                                
                                             
                                          
                                       
                                       g
                                       )
                                       ∧
                                       g
                                       
                                          
                                             ⊆
                                          
                                          
                                             ♯
                                          
                                       
                                       (
                                       f
                                       
                                          
                                             ∇
                                          
                                          
                                             
                                                
                                                   D
                                                
                                                
                                                   ♯
                                                
                                             
                                          
                                       
                                       g
                                       )
                                    .


                                    Termination: for every ascending chain 
                                    
                                       
                                          
                                             {
                                             
                                                
                                                   f
                                                
                                                
                                                   j
                                                
                                             
                                             }
                                          
                                          
                                             j
                                             ≥
                                             0
                                          
                                       
                                    , the ascending chain defined as 
                                    
                                       
                                          
                                             g
                                          
                                          
                                             0
                                          
                                       
                                       =
                                       
                                          
                                             f
                                          
                                          
                                             0
                                          
                                       
                                       ;
                                       
                                          
                                             g
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       =
                                       
                                          
                                             g
                                          
                                          
                                             j
                                          
                                       
                                       
                                          
                                             ∇
                                          
                                          
                                             
                                                
                                                   D
                                                
                                                
                                                   ♯
                                                
                                             
                                          
                                       
                                       
                                          
                                             f
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                     
                                    stabilizes after a finite number of terms.


                           
                              Covering
                              
                                 By definition of 
                                       
                                          
                                             ∇
                                          
                                          
                                             
                                                
                                                   D
                                                
                                                
                                                   ♯
                                                
                                             
                                          
                                       
                                    , we have three possible cases:
                                       
                                          1.
                                          If 
                                                |
                                                U
                                                |
                                                >
                                                
                                                   
                                                      k
                                                   
                                                   
                                                      S
                                                   
                                                
                                              we return 
                                                
                                                   
                                                      ⊤
                                                   
                                                   
                                                      #
                                                   
                                                
                                             , and trivially 
                                                f
                                                
                                                   
                                                      ⊆
                                                   
                                                   
                                                      ♯
                                                   
                                                
                                                
                                                   
                                                      ⊤
                                                   
                                                   
                                                      #
                                                   
                                                
                                                ∧
                                                g
                                                
                                                   
                                                      ⊆
                                                   
                                                   
                                                      ♯
                                                   
                                                
                                                
                                                   
                                                      ⊤
                                                   
                                                   
                                                      #
                                                   
                                                
                                             
                                          

If 
                                                g
                                                
                                                   
                                                      ⊆
                                                   
                                                   
                                                      ♯
                                                   
                                                
                                                f
                                              then we return f and trivially 
                                                f
                                                
                                                   
                                                      ⊆
                                                   
                                                   
                                                      ♯
                                                   
                                                
                                                f
                                              by the reflexivity property of the partial order and 
                                                g
                                                
                                                   
                                                      ⊆
                                                   
                                                   
                                                      ♯
                                                   
                                                
                                                f
                                              by hypothesis.

In the last case, suppose that the two functions are defined on the same step list (we can obtain that with the Refine operator, without changing their ordering by Lemma 4), 
                                                f
                                                =
                                                
                                                   
                                                      ⋀
                                                   
                                                   
                                                      0
                                                      ≤
                                                      i
                                                      ≤
                                                      N
                                                   
                                                
                                                {
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                   
                                                
                                                :
                                                
                                                   
                                                      v
                                                   
                                                   
                                                      i
                                                   
                                                
                                                }
                                                
                                                ∧
                                                
                                                g
                                                =
                                                
                                                   
                                                      ⋀
                                                   
                                                   
                                                      0
                                                      ≤
                                                      i
                                                      ≤
                                                      N
                                                   
                                                
                                                {
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                   
                                                
                                                :
                                                
                                                   
                                                      w
                                                   
                                                   
                                                      i
                                                   
                                                
                                                }
                                             .

Let 
                                                h
                                                =
                                                
                                                   
                                                      ⋀
                                                   
                                                   
                                                      0
                                                      ≤
                                                      i
                                                      ≤
                                                      N
                                                   
                                                
                                                {
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                   
                                                
                                                :
                                                
                                                   
                                                      z
                                                   
                                                   
                                                      i
                                                   
                                                
                                                }
                                              be the result of the widening of f and g. We must prove that 
                                                ∀
                                                i
                                                ,
                                                
                                                   
                                                      w
                                                   
                                                   
                                                      i
                                                   
                                                
                                                
                                                   
                                                      ⊑
                                                   
                                                   
                                                      [
                                                      
                                                         
                                                            t
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            t
                                                         
                                                         
                                                            i
                                                            +
                                                            1
                                                         
                                                      
                                                      ]
                                                   
                                                
                                                
                                                   
                                                      z
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ∧
                                                
                                                   
                                                      v
                                                   
                                                   
                                                      i
                                                   
                                                
                                                
                                                   
                                                      ⊑
                                                   
                                                   
                                                      [
                                                      
                                                         
                                                            t
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            t
                                                         
                                                         
                                                            i
                                                            +
                                                            1
                                                         
                                                      
                                                      ]
                                                   
                                                
                                                
                                                   
                                                      z
                                                   
                                                   
                                                      i
                                                   
                                                
                                             . This is trivially true for the last step (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                      =+
                                                      ∞
                                                   
                                                
                                             ). In the other cases, consider first 
                                                
                                                   
                                                      w
                                                   
                                                   
                                                      i
                                                   
                                                
                                                
                                                   
                                                      ⊑
                                                   
                                                   
                                                      [
                                                      
                                                         
                                                            t
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            t
                                                         
                                                         
                                                            i
                                                            +
                                                            1
                                                         
                                                      
                                                      ]
                                                   
                                                
                                                
                                                   
                                                      z
                                                   
                                                   
                                                      i
                                                   
                                                
                                             . By definition of 
                                                
                                                   
                                                      ⊑
                                                   
                                                   
                                                      [
                                                      
                                                         
                                                            t
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            t
                                                         
                                                         
                                                            i
                                                            +
                                                            1
                                                         
                                                      
                                                      ]
                                                   
                                                
                                             , we have that 
                                                
                                                   
                                                      w
                                                   
                                                   
                                                      i
                                                   
                                                
                                                
                                                   
                                                      ⊑
                                                   
                                                   
                                                      [
                                                      
                                                         
                                                            t
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            t
                                                         
                                                         
                                                            i
                                                            +
                                                            1
                                                         
                                                      
                                                      ]
                                                   
                                                
                                                
                                                   
                                                      z
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ⇔
                                                [
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                   
                                                
                                                )
                                                ,
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                   
                                                
                                                )
                                                ]
                                                ⊆
                                                [
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                   
                                                
                                                )
                                                ,
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                   
                                                
                                                )
                                                ]
                                                ∧
                                                [
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                )
                                                ,
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                )
                                                ]
                                                ⊆
                                                [
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                )
                                                ,
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                )
                                                ]
                                                ⇔
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                   
                                                
                                                )
                                                ≥
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                   
                                                
                                                )
                                                ∧
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                   
                                                
                                                )
                                                ≤
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                   
                                                
                                                )
                                                
                                                ∧
                                                
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                )
                                                ≥
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                )
                                                
                                                ∧
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                )
                                                ≤
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      +
                                                   
                                                
                                                (
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                )
                                             . Regarding 
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      −
                                                   
                                                
                                                (
                                                t
                                                )
                                             , we know that it could be:
                                                
                                                   •
                                                   
                                                      
                                                         
                                                            
                                                               h
                                                            
                                                            
                                                               i
                                                            
                                                            
                                                               −
                                                            
                                                         
                                                         (
                                                         t
                                                         )
                                                         =
                                                         
                                                            
                                                               g
                                                            
                                                            
                                                               i
                                                            
                                                            
                                                               −
                                                            
                                                         
                                                         (
                                                         t
                                                         )
                                                      . Then 
                                                         ∀
                                                         t
                                                         ∈
                                                         [
                                                         
                                                            
                                                               t
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                         ,
                                                         
                                                            
                                                               t
                                                            
                                                            
                                                               i
                                                               +
                                                               1
                                                            
                                                         
                                                         ]
                                                         :
                                                         
                                                            
                                                               g
                                                            
                                                            
                                                               i
                                                            
                                                            
                                                               −
                                                            
                                                         
                                                         (
                                                         t
                                                         )
                                                         ≥
                                                         
                                                            
                                                               g
                                                            
                                                            
                                                               i
                                                            
                                                            
                                                               −
                                                            
                                                         
                                                         (
                                                         t
                                                         )
                                                      
                                                   


                                                      
                                                         
                                                            
                                                               h
                                                            
                                                            
                                                               i
                                                            
                                                            
                                                               −
                                                            
                                                         
                                                         (
                                                         t
                                                         )
                                                         =
                                                         −
                                                         ∞
                                                      . Then 
                                                         ∀
                                                         t
                                                         ∈
                                                         [
                                                         
                                                            
                                                               t
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                         ,
                                                         
                                                            
                                                               t
                                                            
                                                            
                                                               i
                                                               +
                                                               1
                                                            
                                                         
                                                         ]
                                                         :
                                                         
                                                            
                                                               g
                                                            
                                                            
                                                               i
                                                            
                                                            
                                                               −
                                                            
                                                         
                                                         (
                                                         t
                                                         )
                                                         ≥
                                                         −
                                                         ∞
                                                      
                                                   


                                                      
                                                         
                                                            
                                                               h
                                                            
                                                            
                                                               i
                                                            
                                                            
                                                               −
                                                            
                                                         
                                                         (
                                                         t
                                                         )
                                                         =
                                                         
                                                            
                                                               (
                                                               
                                                                  
                                                                     g
                                                                  
                                                                  
                                                                     i
                                                                  
                                                                  
                                                                     −
                                                                  
                                                               
                                                               )
                                                            
                                                            
                                                               •
                                                            
                                                         
                                                         (
                                                         t
                                                         )
                                                       that is 
                                                         
                                                            
                                                               h
                                                            
                                                            
                                                               i
                                                            
                                                            
                                                               −
                                                            
                                                         
                                                         (
                                                         t
                                                         )
                                                         =
                                                         (
                                                         
                                                            
                                                               m
                                                            
                                                            
                                                               
                                                                  
                                                                     MIN
                                                                  
                                                                  
                                                                     i
                                                                  
                                                                  
                                                                     −
                                                                  
                                                               
                                                            
                                                         
                                                         −
                                                         
                                                            
                                                               k
                                                            
                                                            
                                                               I
                                                            
                                                         
                                                         )
                                                         ×
                                                         t
                                                         +
                                                         (
                                                         
                                                            
                                                               q
                                                            
                                                            
                                                               
                                                                  
                                                                     MIN
                                                                  
                                                                  
                                                                     i
                                                                  
                                                                  
                                                                     −
                                                                  
                                                               
                                                            
                                                         
                                                         −
                                                         
                                                            
                                                               k
                                                            
                                                            
                                                               L
                                                            
                                                         
                                                         )
                                                         =
                                                         
                                                            
                                                               m
                                                            
                                                            
                                                               
                                                                  
                                                                     MIN
                                                                  
                                                                  
                                                                     i
                                                                  
                                                                  
                                                                     −
                                                                  
                                                               
                                                            
                                                         
                                                         ×
                                                         t
                                                         −
                                                         
                                                            
                                                               k
                                                            
                                                            
                                                               I
                                                            
                                                         
                                                         ×
                                                         t
                                                         +
                                                         
                                                            
                                                               q
                                                            
                                                            
                                                               
                                                                  
                                                                     MIN
                                                                  
                                                                  
                                                                     i
                                                                  
                                                                  
                                                                     −
                                                                  
                                                               
                                                            
                                                         
                                                         −
                                                         
                                                            
                                                               k
                                                            
                                                            
                                                               L
                                                            
                                                         
                                                      . Since 
                                                         
                                                            
                                                               k
                                                            
                                                            
                                                               I
                                                            
                                                         
                                                         ,
                                                         
                                                            
                                                               k
                                                            
                                                            
                                                               L
                                                            
                                                         
                                                       are both 
                                                         ≥
                                                         0
                                                       by definition and 
                                                         
                                                            
                                                               m
                                                            
                                                            
                                                               
                                                                  
                                                                     MIN
                                                                  
                                                                  
                                                                     i
                                                                  
                                                                  
                                                                     −
                                                                  
                                                               
                                                            
                                                         
                                                         ≤
                                                         
                                                            
                                                               m
                                                            
                                                            
                                                               
                                                                  
                                                                     g
                                                                  
                                                                  
                                                                     i
                                                                  
                                                                  
                                                                     −
                                                                  
                                                               
                                                            
                                                         
                                                         ∧
                                                         
                                                            
                                                               q
                                                            
                                                            
                                                               
                                                                  
                                                                     MIN
                                                                  
                                                                  
                                                                     i
                                                                  
                                                                  
                                                                     −
                                                                  
                                                               
                                                            
                                                         
                                                         ≤
                                                         
                                                            
                                                               q
                                                            
                                                            
                                                               
                                                                  
                                                                     g
                                                                  
                                                                  
                                                                     i
                                                                  
                                                                  
                                                                     −
                                                                  
                                                               
                                                            
                                                         
                                                       also by definition, we can say that 
                                                         
                                                            
                                                               h
                                                            
                                                            
                                                               i
                                                            
                                                            
                                                               −
                                                            
                                                         
                                                         (
                                                         t
                                                         )
                                                         =
                                                         
                                                            
                                                               m
                                                            
                                                            
                                                               
                                                                  
                                                                     MIN
                                                                  
                                                                  
                                                                     i
                                                                  
                                                                  
                                                                     −
                                                                  
                                                               
                                                            
                                                         
                                                         ×
                                                         t
                                                         +
                                                         
                                                            
                                                               q
                                                            
                                                            
                                                               
                                                                  
                                                                     MIN
                                                                  
                                                                  
                                                                     i
                                                                  
                                                                  
                                                                     −
                                                                  
                                                               
                                                            
                                                         
                                                         −
                                                         
                                                            
                                                               k
                                                            
                                                            
                                                               I
                                                            
                                                         
                                                         ×
                                                         t
                                                         −
                                                         
                                                            
                                                               k
                                                            
                                                            
                                                               L
                                                            
                                                         
                                                         ≤
                                                         
                                                            
                                                               m
                                                            
                                                            
                                                               
                                                                  
                                                                     g
                                                                  
                                                                  
                                                                     i
                                                                  
                                                                  
                                                                     −
                                                                  
                                                               
                                                            
                                                         
                                                         ×
                                                         t
                                                         +
                                                         
                                                            
                                                               q
                                                            
                                                            
                                                               
                                                                  
                                                                     g
                                                                  
                                                                  
                                                                     i
                                                                  
                                                                  
                                                                     −
                                                                  
                                                               
                                                            
                                                         
                                                         =
                                                         
                                                            
                                                               g
                                                            
                                                            
                                                               i
                                                            
                                                            
                                                               −
                                                            
                                                         
                                                         (
                                                         t
                                                         )
                                                       holds 
                                                         ∀
                                                         t
                                                         ≥
                                                         0
                                                      .

We want to prove that the ascending chain 
                                       
                                          
                                             {
                                             
                                                
                                                   g
                                                
                                                
                                                   j
                                                
                                             
                                             }
                                          
                                          
                                             j
                                             ≥
                                             0
                                          
                                       
                                     stabilizes after a finite number of terms. Consider a generic element of the chain, g
                                    
                                       j
                                    . Since the chain is ascending, 
                                       
                                          
                                             g
                                          
                                          
                                             j
                                             −
                                             1
                                          
                                       
                                       
                                          
                                             ⊆
                                          
                                          
                                             ♯
                                          
                                       
                                       
                                          
                                             g
                                          
                                          
                                             j
                                          
                                       
                                    . If 
                                       
                                          
                                             g
                                          
                                          
                                             j
                                             −
                                             1
                                          
                                       
                                       =
                                       
                                          
                                             g
                                          
                                          
                                             j
                                          
                                       
                                    , the chain has stabilized and the convergence is reached. Otherwise, we have that 
                                       
                                          
                                             g
                                          
                                          
                                             j
                                             −
                                             1
                                          
                                       
                                       
                                          
                                             ⊂
                                          
                                          
                                             ♯
                                          
                                       
                                       
                                          
                                             g
                                          
                                          
                                             j
                                          
                                       
                                    . By definition of 
                                       
                                          
                                             ⊆
                                          
                                          
                                             ♯
                                          
                                       
                                    , this means that the area of (at least) one trapezoid of g
                                    
                                       j
                                     has increased with respect to the corresponding trapezoid of 
                                       
                                          
                                             g
                                          
                                          
                                             j
                                             −
                                             1
                                          
                                       
                                    . Let 
                                       (
                                       
                                          
                                             s
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       ,
                                       
                                          
                                             s
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                       )
                                     be the lower and upper sides of such trapezoid in g
                                    
                                       j
                                    . The area of the step is increased if the two lines (
                                       
                                          
                                             s
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                     and 
                                       
                                          
                                             s
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                    ) drift apart with respect to their values at the preceding iteration, that is, in 
                                       
                                          
                                             g
                                          
                                          
                                             j
                                             −
                                             1
                                          
                                       
                                    . In particular, or 
                                       
                                          
                                             s
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                     went down (that is, the slope, the intercept or both decreased), or 
                                       
                                          
                                             s
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                     went up (that is, the slope, the intercept or both increased). By definition of widening, we know that the lines will stop increasing or decreasing when their slope or intercept reach the threshold values (
                                       
                                          
                                             k
                                          
                                          
                                             M
                                          
                                       
                                       ,
                                       
                                          
                                             k
                                          
                                          
                                             Q
                                          
                                       
                                    ) they will be approximated by 
                                       +
                                       ∞
                                     or 
                                       −
                                       ∞
                                    . We also know that the growth in the number of steps is limited to k
                                    
                                       S
                                    , and that the steps of the previous value in the chain will be preserved (the widening only adds indices, but it does not remove them).

Suppose that the chain ascends of the minimum possible quantity (with respect to our parameters 
                                       
                                          
                                             k
                                          
                                          
                                             I
                                          
                                       
                                       ,
                                       
                                          
                                             k
                                          
                                          
                                             L
                                          
                                       
                                     and the float numbers representation of the computer).

Let us define 
                                       
                                          
                                             maxIterationsToStopGrowth
                                             (
                                             i
                                             )
                                             =
                                             min
                                             (
                                             
                                                
                                                   
                                                      |
                                                      
                                                         
                                                            m
                                                         
                                                         
                                                            i
                                                         
                                                         
                                                            +
                                                         
                                                      
                                                      −
                                                      
                                                         
                                                            k
                                                         
                                                         
                                                            M
                                                         
                                                      
                                                      |
                                                   
                                                   
                                                      
                                                         
                                                            k
                                                         
                                                         
                                                            I
                                                         
                                                      
                                                   
                                                
                                                ,
                                                
                                                   
                                                      |
                                                      
                                                         
                                                            q
                                                         
                                                         
                                                            i
                                                         
                                                         
                                                            +
                                                         
                                                      
                                                      −
                                                      
                                                         
                                                            k
                                                         
                                                         
                                                            Q
                                                         
                                                      
                                                      |
                                                   
                                                   
                                                      
                                                         
                                                            k
                                                         
                                                         
                                                            L
                                                         
                                                      
                                                   
                                                
                                             
                                             )
                                             +
                                             min
                                             (
                                             
                                                
                                                   
                                                      |
                                                      
                                                         
                                                            m
                                                         
                                                         
                                                            i
                                                         
                                                         
                                                            −
                                                         
                                                      
                                                      −
                                                      
                                                         
                                                            k
                                                         
                                                         
                                                            M
                                                         
                                                      
                                                      |
                                                   
                                                   
                                                      
                                                         
                                                            k
                                                         
                                                         
                                                            I
                                                         
                                                      
                                                   
                                                
                                                ,
                                                
                                                   
                                                      |
                                                      
                                                         
                                                            q
                                                         
                                                         
                                                            i
                                                         
                                                         
                                                            −
                                                         
                                                      
                                                      −
                                                      
                                                         
                                                            k
                                                         
                                                         
                                                            Q
                                                         
                                                      
                                                      |
                                                   
                                                   
                                                      
                                                         
                                                            k
                                                         
                                                         
                                                            L
                                                         
                                                      
                                                   
                                                
                                             
                                             )
                                          
                                       
                                    This value is an upper bound of the number of iterations needed for step t
                                    
                                       i
                                     to reach the threshold after which it stops growing. In particular, consider a generic step t
                                    
                                       i
                                     and the increase of its upper side. Since the slope is increased of at least k
                                    
                                       I
                                     and, at the same time, the intercept is increased of at least k
                                    
                                       L
                                    , the side will stop to grow after, at most, 
                                       min
                                       (
                                       (
                                       |
                                       
                                          
                                             m
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                       −
                                       
                                          
                                             k
                                          
                                          
                                             M
                                          
                                       
                                       |
                                       )
                                       /
                                       
                                          
                                             k
                                          
                                          
                                             I
                                          
                                       
                                       ,
                                       (
                                       |
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                       −
                                       
                                          
                                             k
                                          
                                          
                                             Q
                                          
                                       
                                       |
                                       )
                                       /
                                       
                                          
                                             k
                                          
                                          
                                             L
                                          
                                       
                                       )
                                     iterations (after that, the side is set to 
                                       +
                                       ∞
                                    , its maximum value). The same happens for the lower side, which stops to grow after, at most, 
                                       min
                                       (
                                       (
                                       |
                                       
                                          
                                             m
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       −
                                       
                                          
                                             k
                                          
                                          
                                             M
                                          
                                       
                                       |
                                       )
                                       /
                                       
                                          
                                             k
                                          
                                          
                                             I
                                          
                                       
                                       ,
                                       (
                                       |
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       −
                                       
                                          
                                             k
                                          
                                          
                                             Q
                                          
                                       
                                       |
                                       )
                                       /
                                       
                                          
                                             k
                                          
                                          
                                             L
                                          
                                       
                                       )
                                     iterations. Thus, each step t
                                    
                                       i
                                     is abstracted to top after at most 
                                       min
                                       (
                                       (
                                       |
                                       
                                          
                                             m
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                       −
                                       
                                          
                                             k
                                          
                                          
                                             M
                                          
                                       
                                       |
                                       )
                                       /
                                       
                                          
                                             k
                                          
                                          
                                             I
                                          
                                       
                                       ,
                                       (
                                       |
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                       −
                                       
                                          
                                             k
                                          
                                          
                                             Q
                                          
                                       
                                       |
                                       )
                                       /
                                       
                                          
                                             k
                                          
                                          
                                             L
                                          
                                       
                                       )
                                       +
                                       min
                                       (
                                       (
                                       |
                                       
                                          
                                             m
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       −
                                       
                                          
                                             k
                                          
                                          
                                             M
                                          
                                       
                                       |
                                       )
                                       /
                                       
                                          
                                             k
                                          
                                          
                                             I
                                          
                                       
                                       ,
                                       (
                                       |
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       −
                                       
                                          
                                             k
                                          
                                          
                                             Q
                                          
                                       
                                       |
                                       )
                                       /
                                       
                                          
                                             k
                                          
                                          
                                             L
                                          
                                       
                                       )
                                     iterations, that is, the quantity maxIterationsToStopGrowth(i).

Let 
                                       g
                                       =
                                       
                                          
                                             ⋀
                                          
                                          
                                             i
                                             ∈
                                             [
                                             0
                                             ,
                                             N
                                             ]
                                          
                                       
                                       {
                                       
                                          
                                             t
                                          
                                          
                                             i
                                          
                                       
                                       :
                                       
                                          
                                             v
                                          
                                          
                                             i
                                          
                                       
                                       =
                                       (
                                       
                                          
                                             m
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       ,
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                          
                                             −
                                          
                                       
                                       ,
                                       
                                          
                                             m
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                       ,
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                          
                                             +
                                          
                                       
                                       )
                                       }
                                     be a generic element of the ascending chain 
                                       {
                                       
                                          
                                             g
                                          
                                          
                                             j
                                          
                                       
                                       }
                                    . Then, an upper bound of the maximum number of iterations needed to converge is 
                                       
                                          (3)
                                          
                                             K
                                             =
                                             
                                                
                                                   ∑
                                                
                                                
                                                   i
                                                   =
                                                   0
                                                
                                                
                                                   N
                                                
                                             
                                             maxIterationsToStopGrowth
                                             (
                                             i
                                             )
                                             +
                                             (
                                             
                                                
                                                   k
                                                
                                                
                                                   S
                                                
                                             
                                             −
                                             N
                                             )
                                             ×
                                             maxIterationsToStopGrowth
                                             (
                                             iMAX
                                             )
                                          
                                       
                                    where 
                                       iMAX
                                       =
                                       {
                                       i
                                       ∈
                                       [
                                       0
                                       ,
                                       N
                                       ]
                                       :
                                       ∄
                                       j
                                       ∈
                                       [
                                       0
                                       ,
                                       N
                                       ]
                                       :
                                       maxIterationsToStopGrowth
                                       (
                                       j
                                       )
                                       >
                                       maxIterationsToStopGrowth
                                       (
                                       i
                                       )
                                       }
                                     is the step index which maximizes the quantity maxIterationsToStopGrowth.

Eq. (3) is composed by two parts:
                                       
                                          •
                                          
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      i
                                                      =
                                                      0
                                                   
                                                   
                                                      N
                                                   
                                                
                                                maxIterationsToStopGrowth
                                                (
                                                i
                                                )
                                              represents an upper bound of the number of iterations needed for all the steps of g to reach the threshold after which they stop growing. In fact, at each iteration of the widening, at least one side of one step is moved up or down and this means that its slope and intercept move closer to the thresholds 
                                                
                                                   
                                                      k
                                                   
                                                   
                                                      M
                                                   
                                                
                                                ,
                                                
                                                   
                                                      k
                                                   
                                                   
                                                      Q
                                                   
                                                
                                             . Each step t
                                             
                                                i
                                              of g will stop to grow after, at most, maxIterationsToStopGrowth(i) iterations. Summing this quantity for all the N steps of g, we obtain the first part of Eq. (3).


                                             
                                                (
                                                
                                                   
                                                      k
                                                   
                                                   
                                                      S
                                                   
                                                
                                                −
                                                N
                                                )
                                                ×
                                                maxIterationsToStopGrowth
                                                (
                                                iMAX
                                                )
                                              represents an upper bound of the number of iterations needed for all the (possibly) added steps to reach the threshold after which they stop growing. In fact, we know that the maximum number of steps allowed in an abstract state by the widening is k
                                             
                                                S
                                             . The state g is composed by N steps, so at most 
                                                
                                                   
                                                      k
                                                   
                                                   
                                                      S
                                                   
                                                
                                                −
                                                N
                                              steps could be added to g along the chain. Nevertheless, we know that the chain 
                                                {
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      j
                                                   
                                                
                                                }
                                              is increasing, so these added steps cannot have values that are smaller (i.e., far from the thresholds that stop the growth) than the already existing values in g. In order to have an upper bound of the iterations needed by these added step to stop growing, we then suppose that all these steps lie within the step of g which is farthest from the growth stop. More precisely, let 
                                                iMAX
                                              be the index of the step which maximizes the quantity 
                                                maxIterationsToStopGrowth
                                                (
                                                ·
                                                )
                                             . Then, each added step stops to grow after, at most, maxIterationsToStopGrowth(iMAX) iterations. Multiplying this value by 
                                                
                                                   
                                                      k
                                                   
                                                   
                                                      S
                                                   
                                                
                                                −
                                                N
                                              (the maximum number of steps we can add to g) we obtain the second part of Eq. (3).

Since K is the result of the summation of two finite quantities, we can say that the ascending chain 
                                       
                                          
                                             {
                                             
                                                
                                                   g
                                                
                                                
                                                   j
                                                
                                             
                                             }
                                          
                                          
                                             j
                                             ≥
                                             0
                                          
                                       
                                     stabilizes after a finite number of terms, which is at most K.□

@&#REFERENCES@&#

