@&#MAIN-TITLE@&#Automatic surface repairing, defeaturing and meshing algorithms based on an extended B-rep

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           A new data structure that combines the continuous and discrete surface representations is proposed.


                        
                        
                           
                           A sequence of repairing, defeaturing and meshing algorithms that can exploit the strengths of both representations is developed.


                        
                        
                           
                           The repairing algorithm is defined on the discrete model but can output a correct B-rep.


                        
                        
                           
                           The output mesh is loyal to the input continuous model and therefore more geometrically accurate.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Mesh generation

Repairing

Defeaturing

Boundary representation

Virtual topology

Face clustering

@&#ABSTRACT@&#


               
               
                  This paper presents an extended surface boundary representation (B-rep), where each topology entity can have dual geometric representations to accommodate various defects (e.g., gaps and overlaps) commonly present in CAD models. Keeping a uniform B-rep and the unsuppressed geometry data enables the use of various existing repairing, defeaturing and meshing algorithms to process CAD models with small gaps and overlaps on surface boundaries. The continuous geometry of the input model remains untouched in the repairing, defeaturing and meshing process, and the output mesh is loyal to this geometry. Such feature is often desirable in numerical simulations that require meshes with high geometry fidelity.
               
            

@&#INTRODUCTION@&#

To facilitate a numerical simulation, one needs to first prepare a geometry model and then discretise this model into a mesh. These two steps together are called the pre-processing of the simulation. For a simulation with complex geometry configuration, both steps are major performance bottlenecks because of intensive manual interactions. Recent advances of automatic mesh generation technologies relieve the burden of mesh generation to some extent. However, in many cases, creating qualified geometry inputs for mesh generation remains an outstanding challenge [1,2]. For instance, it was reported that, in Sandia National Laboratory, geometry preparation and mesh generation account for about 60% and 20% of overall simulation time, respectively, while only 20% of the overall time is actually devoted to numerical simulation [3].

Most analysis models come from Computer Aided Design (CAD) systems. The original CAD models rarely meet the requirement of mesh generation and they need to be processed following a two-step procedure. Firstly, a CAD model is often contaminated by geometry errors, which if not rectified may collapse or invalidate the meshing procedure. Therefore, a repairing procedure is required to clean the CAD model and remove such geometry errors. Secondly, the input CAD model may contain many details for manufacturing or other purposes, but the meshing algorithm may fail to recognise them and generate badly shaped elements under larger mesh sizes than the geometry scales of the fine details. Even if the meshing algorithm captures these details and generates a mesh with acceptable quality, the total element number may increase massively due to small element sizes defined around the details. Therefore, a defeaturing step is indispensable to remove the details with minor analysis significance and ensure the output mesh can define a cost-effective analysis model.

Mesh generation starts from surface meshing. In most cases, the subsequent volume meshing [4] relies on the surface mesh only and does not access the CAD model. Therefore, to some extent, the most important step of geometry preparation is to define a clean and defeatured surface model. In the CAD and Computer Graphics (CG) communities, many methods have been proposed to depict a surface. However, the continuous representation based on NURBS, Bézier and Coons patches and the discrete representation based on triangular facets presently dominate in the community of Computer Aided Engineering (CAE). Accordingly, techniques for surface repairing and defeaturing can be categorised into two groups: those applied directly to the continuous model and those to the discrete model.

Geometry computations defined on a discrete model are very efficient because the edges and facets that depict the surface have linear equations. In contrast, a continuous surface has a high-order irreversible parametric representation. Many computations define on it depend on numerically instable iterative procedures, hence more time-consuming and less reliable. Nevertheless, the continuous surface has its own strengths. Firstly, the design of most industry products is based on continuous surfaces. If the computational mesh is defined on a discrete model, the simulation accuracy may degrade due to the geometry inaccuracy of the mesh. Secondly, the continuous surface is usually organised with a boundary representation (B-rep). Many efficient defeaturing and meshing algorithms have been developed by utilising the topology entities of the B-rep [5–9]. These algorithms cannot be applied on a pure discrete model that is internally organised with some edge-based data structures.

In this study, we propose a new data structure namely the hybrid surface B-rep. It combines the continuous and discrete representations of surfaces. Each topology entity of the surface B-rep has a dual geometry representation in default. In addition, the mappings are maintained between the topology entities (faces, curves and points) of the B-rep and their counterparts (facets, edges and vertices) on the discrete model. The primary motivation of developing this data structure is to enrich our choices of geometry repairing, geometry defeaturing and mesh generation algorithms to serve different application purposes better. Upon this data structure, we can combine different types of algorithms in one pre-processing workflow. In contrast, most of the existing pre-processing approaches are solely based on either the discrete or the continuous model. As a result, they can only employ one type of geometry repairing, geometry defeaturing and mesh generation algorithms.

To demonstrate the benefit of the proposed data structure, a novel pre-processing workflow is proposed for CAD models with small gaps and overlaps on surface boundaries. These errors are common in CAD models due to translation errors, numerical inaccuracies and tolerance settings. For such CAD models, the existing pre-processing approaches prepare the mesh model by one of the following two approaches.
                        
                           (1)
                           
                              The continuous model based approach. This approach is adopted by many commercial tools [10]. It first repairs the gaps of the input model directly by redefining the curves and surfaces in the neighbourhood [11]. No matter real 
                              [12] or virtual operations [5–7,13,14] are executed in the following defeaturing step, the final mesh is always generated on a modified CAD model.


                              The discrete model based approach. This approach repairs the tessellated dual of the input CAD model [15–17] and if needed, the repaired discrete model can be further simplified [18]. All of these steps modify the geometry and take the risk of degrading the geometry accuracy of the final mesh.

The proposed approach combines the discrete model based geometry-repairing algorithm [15,16] and the continuous model based defeaturing algorithm [6] in one pre-processing workflow. Firstly, it repairs the discrete dual of the input model, and updates the topology entities of the B-rep. Next, the repaired B-rep is defeatured by combining neighbouring faces. The defeatured B-rep contains two types of faces: the real faces and the virtual faces. The real face has a unique counterpart in the input model and its continuous model is meshed directly by a mapping-based surface mesher. However, the virtual face, i.e. a combination of many faces, has no intrinsic parametric space. Its discrete model is meshed instead and then the interior mesh points are projected onto the continuous model. The final output is a combination of the meshes generated on real and virtual faces.

Compared with the algorithms solely based on the discrete or the continuous models, the advantages of the proposed approach are:
                        
                           (1)
                           Most geometry computations are performed on the discrete model, avoiding the tedious, expensive and unreliable calculations on the continuous model.

The input continuous model is not modified, and the output mesh is loyal to the input model rather than a discrete one or a modified one due to the repairing and defeaturing algorithms. This feature is often much desirable in simulations that require meshes with high geometry fidelity.

The repairing algorithm not only removes geometry errors on the discrete model, but it also generates a correct B-rep. Therefore, the defeaturing and meshing algorithms that rely on a valid B-rep input can be directly applied.

@&#RELATED WORK@&#

If the CAD input is a continuous surface model with local geometry errors, a basic idea to address these errors is to redefine the geometry and topology entities locally [10,11]. For instance, in the region where two boundary curves overlap with each other, a new curve can be defined to replace the two curves. Accordingly, the topology entities of these two curves in the B-rep need to be replaced as well so that the adjacency of the faces initially bounded by the replaced curves is correctly set up. The advantage of this strategy is that both the geometry and the topology of the repaired model are continuous, and are accurately redefined so that a routine implementation of the downstream defeaturing and meshing algorithms is facilitated. Nevertheless, this strategy complicates the implementation of the repairing algorithm itself. Different overlapping cases and gap patterns must be classified to manage them accordingly. Redefining existing curves or faces and creating new curves or faces involve time-consuming and numerically instable geometry computations. Meanwhile, the modification of the CAD model may degrade the geometry fidelity of the output mesh.

Alternatively, some algorithms have been proposed to repair geometry errors on the discrete model, where the repairing procedure is reduced to a combination of local operations such as vertex contraction, edge splitting and so on [15–17]. These computations are usually very efficient because of their local and linear nature. The drawbacks of these repairing algorithms are also evident, despite of their simplicity and efficiency. Firstly, the geometry accuracy of the output mesh may be unqualified for a high-fidelity simulation. Moreover, the discrete model contains no high-level topology entities such as those defined in a B-rep; therefore, many effective defeaturing and meshing algorithms cannot be applied after repairing.

Defeaturing algorithms have also been developed separately for the continuous and the discrete models. The defeaturing algorithms for discrete models utilise local operations such as edge-collapse and vertex-removal, where the mesh geometry and topology are altered simultaneously [18]. However, the defeaturing algorithms for continuous models can be either geometry-based or topology-based. The geometry-based algorithms employ complicated geometry computations to change the model geometry directly [10,11], while the topology-based algorithms only alter the topology entities of a B-rep, hence more efficient and reliable [5–7,13,14]. However, the standard B-rep must be extended by introducing new types of topology entities such as quilt 
                     [13], virtual topologies 
                     [5] and Mesh Constraint Topologies (MCT) 
                     [14]. The extended B-rep is incompatible with the current neutral CAD file standards; thus, how to transfer it between different systems remains an issue. Nevertheless, this issue is not prominent for an integrated system where all pre-processing steps of numerical simulations can be completed without exchanging intermediate data with other systems. Presently, some geometry processing engines developed for mesh generation (such as CAPRI [19,20] and CGM [21,22]) support these new concepts, so do a few other mesh generation tools (such as Cubit [23] and Pointwise [24]).

Hamri et al. [25] also incorporated a dual geometry representation in their conceptual software environment for CAD/CAE integration. However, unlike the present study that treats CAD inputs with various geometry errors, their system assumes the CAD model is clean and without geometry defects. In addition, their defeaturing algorithm relies on the discrete model, while the proposed approach is topology-based and defined on the extended B-rep.

Besides, Smith et al. [17] and Quadros et al. [18] have foreseen the possible benefits of maintaining a dual geometry representation when developing their repairing and defeaturing algorithms. However, no details were given on how to organise a dual representation and how to implement their algorithms based on the dual representation. The algorithms depicted in [17,18] are purely based on discrete models, where the input and output meshes are both defined on discrete models. Different from existing approaches, this study takes a continuous model as the input, and the output mesh is defined on the continuous model.

The surface B-rep is a subset of the solid B-rep and it includes three basic topology entities: face, curve and point, as illustrated in Fig. 1
                        . Meanwhile, a specific topology entity named loop is used to limit the valid region of a face. Internally, a loop refers to a set of boundary curves and is a group entity that distinguishes with other topology entities.

In the extended B-rep, each topology entity has two types of geometric representations in default. One representation corresponds to geometry entities defined on the continuous model, while the other representation describes a surface defined by a set of triangles and a curve defined by a set of linear segments. Fig. 2
                            presents a simple example to illustrate this dual representation.

Depending on the input model, the dual representation can be initialized in two ways. If the input geometry is a continuous model, its curves and faces are meshed into linear segments and triangles, respectively. At this stage, the triangle shapes do not matter, but the tessellated model must be geometrically close to the continuous model. If the input geometry is a discrete model, it is first subdivided into many patches, after which a continuous representation is built by parameterising each patch. The first approach is employed in this study because a continuous input is considered.

A discrete model is composed of many triangles, and it is represented by using the half-edge data structure, which contains three topology entities of different dimensions: facets, edges and vertices.

To connect the B-rep and the discrete model, three basic mappings between their topology entities are defined as follows:
                              
                                 (1)
                                 
                                    The face-facet mapping. A face corresponds to a set of facets.


                                    The curve-edge mapping. A curve corresponds to a set of edges.


                                    The point-vertex mapping. A point corresponds to a vertex.

Other mappings can be defined as well, e.g., between a curve and all vertices that lie on the curve, or between a face and all edges that bound the face. As these additional mappings can be derived from the basic mappings, they are not explicitly represented in the extended B-rep.

Two definitions are introduced below to describe the above mappings:
                              Definition 1
                              Classification [26]
                              


                              Given a di
                                 -dimensional topology entity (di
                                 
                                 =0–2) 
                                    
                                       
                                          
                                             M
                                          
                                          
                                             
                                                
                                                   d
                                                
                                                
                                                   i
                                                
                                             
                                          
                                       
                                    
                                  of the discrete model, 
                                    
                                       
                                          
                                             M
                                          
                                          
                                             
                                                
                                                   d
                                                
                                                
                                                   i
                                                
                                             
                                          
                                       
                                    
                                  is classified on a dj
                                 -dimensional topology entity (di
                                 
                                 ⩽
                                 dj
                                 
                                 ⩽2) 
                                    
                                       
                                          
                                             G
                                          
                                          
                                             
                                                
                                                   d
                                                
                                                
                                                   j
                                                
                                             
                                          
                                       
                                    
                                  of the B-rep if 
                                    
                                       
                                          
                                             M
                                          
                                          
                                             
                                                
                                                   d
                                                
                                                
                                                   i
                                                
                                             
                                          
                                       
                                    
                                  lies on 
                                    
                                       
                                          
                                             G
                                          
                                          
                                             
                                                
                                                   d
                                                
                                                
                                                   j
                                                
                                             
                                          
                                       
                                    
                                 , denoted as 
                                    
                                       
                                          
                                             M
                                          
                                          
                                             
                                                
                                                   d
                                                
                                                
                                                   i
                                                
                                             
                                          
                                       
                                       ⊑
                                       
                                          
                                             G
                                          
                                          
                                             
                                                
                                                   d
                                                
                                                
                                                   j
                                                
                                             
                                          
                                       
                                    
                                 .

Given a d-dimensional topology entity (d
                                 =0–2) 
                                    
                                       
                                          
                                             G
                                          
                                          
                                             d
                                          
                                       
                                    
                                  of the B-rep, the d-dimensional topology entities of the discrete model classified on 
                                    
                                       
                                          
                                             G
                                          
                                          
                                             d
                                          
                                       
                                    
                                  form a reverse classification set, denoted as 
                                    
                                       RCS
                                       (
                                       
                                          
                                             G
                                          
                                          
                                             d
                                          
                                       
                                       )
                                       =
                                       {
                                       
                                          
                                             M
                                          
                                          
                                             d
                                          
                                       
                                       |
                                       
                                          
                                             M
                                          
                                          
                                             d
                                          
                                       
                                       ⊑
                                       
                                          
                                             G
                                          
                                          
                                             d
                                          
                                       
                                       }
                                    
                                 .

In the proposed defeaturing algorithm, neighbouring faces need to be combined into a virtual face. Sheffer et al. [5] also proposed a similar but more generalised concept, virtual topology, which introduces more virtual operations to suppress features.

Compared with tedious and expensive real operations that edit the geometry directly, their virtual counterparts only edit the B-rep topology entities. For instance, to combine two neighbouring faces 
                           
                              
                                 
                                    G
                                 
                                 
                                    1
                                 
                                 
                                    1
                                 
                              
                           
                         and 
                           
                              
                                 
                                    G
                                 
                                 
                                    2
                                 
                                 
                                    1
                                 
                              
                           
                         into a new face 
                           
                              
                                 
                                    G
                                 
                                 
                                    1
                                 
                              
                           
                        , the real operation may create a new face through resampling to cover the original faces and then update the B-rep accordingly, while the virtual operation only creates a new topological face 
                           
                              
                                 
                                    G
                                 
                                 
                                    1
                                 
                              
                           
                         in the B-rep referring to 
                           
                              
                                 
                                    G
                                 
                                 
                                    1
                                 
                                 
                                    1
                                 
                              
                           
                         and 
                           
                              
                                 
                                    G
                                 
                                 
                                    2
                                 
                                 
                                    1
                                 
                              
                           
                        . Assuming that 
                           
                              
                                 
                                    L
                                 
                                 
                                    1
                                 
                              
                           
                         and 
                           
                              
                                 
                                    L
                                 
                                 
                                    2
                                 
                              
                           
                         are the loops of 
                           
                              
                                 
                                    G
                                 
                                 
                                    1
                                 
                                 
                                    1
                                 
                              
                           
                         and 
                           
                              
                                 
                                    G
                                 
                                 
                                    2
                                 
                                 
                                    1
                                 
                              
                           
                        , the loop of 
                           
                              
                                 
                                    G
                                 
                                 
                                    1
                                 
                              
                           
                         is 
                           
                              L
                              =
                              (
                              
                                 
                                    L
                                 
                                 
                                    1
                                 
                              
                              ∪
                              
                                 
                                    L
                                 
                                 
                                    2
                                 
                              
                              )
                              -
                              (
                              
                                 
                                    L
                                 
                                 
                                    1
                                 
                              
                              ∩
                              
                                 
                                    L
                                 
                                 
                                    2
                                 
                              
                              )
                           
                        .

The input is a composite surface model with each surface defined by a continuous representation. Small gaps and overlaps may be present on surface boundaries. One choice to obtain a qualified surface mesh is to first build a discrete representation, then repair the discrete model, and finally generate the mesh on the discrete model. However, to ensure a higher accuracy it is desirable to output the surface mesh directly defined on the original continuous model. Therefore, as shown in Fig. 3
                     , a new workflow is proposed following the extended B-rep:
                        
                           (1)
                           
                              Initialisation. The input model is tessellated to set up a dual geometric representation.


                              Repairing. The discrete model in the dual representation is first repaired by executing iteratively vertex pair contraction and expansion operations [15,16]. Then, based on the mapping with the repaired discrete model, the topology entities of the B-rep are repaired to obtain a clean B-rep.


                              Defeaturing. Neighbouring faces in the clean B-rep are combined to improve the meshability of the model. Consequently, the simplified B-rep contains virtual faces.


                              Meshing. A real face corresponds to a face in the continuous input model, and can be meshed by a mapping-based surface mesher [27]. A virtual face refers to a combination of faces without intrinsic parameterisation, and its discrete model is parameterised and meshed, after which the mesh points are projected onto the continuous model. Finally, the meshes on real and virtual faces are merged for output.

Geometry errors in the continuous input model are inherited by the discrete model after tessellation. The algorithm proposed by Patel et al. [15,16] is employed to produce a valid discrete model. For the sake of completeness, the operation is briefly recapped in Section 5.1. A novel algorithm is proposed to repair the B-rep, which is essential for the subsequent defeaturing and meshing algorithms, and this is explained in detail in Section 5.2.

The discrete model is repaired through the following steps [15,16]:
                           
                              (1)
                              Label the edges adjacent to only one facet as boundary edges and the ending vertices of these edges as boundary vertices.

For a given resolution tolerance 
                                    
                                       
                                          
                                             ε
                                          
                                          
                                             r
                                          
                                       
                                    
                                 , search all pairs of boundary vertices 
                                    
                                       <
                                       
                                          
                                             P
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             P
                                          
                                          
                                             j
                                          
                                       
                                       >
                                    
                                  that meet the condition 
                                    
                                       |
                                       
                                          
                                             P
                                          
                                          
                                             i
                                          
                                       
                                       
                                          
                                             P
                                          
                                          
                                             j
                                          
                                       
                                       |
                                       ⩽
                                       
                                          
                                             ε
                                          
                                          
                                             r
                                          
                                       
                                    
                                 , and sort the pairs in an ascending order of 
                                    
                                       |
                                       
                                          
                                             P
                                          
                                          
                                             i
                                          
                                       
                                       
                                          
                                             P
                                          
                                          
                                             j
                                          
                                       
                                       |
                                    
                                 .

For each pair of boundary vertices 
                                    
                                       <
                                       
                                          
                                             P
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             P
                                          
                                          
                                             j
                                          
                                       
                                       >
                                    
                                 , if 
                                    
                                       |
                                       
                                          
                                             P
                                          
                                          
                                             i
                                          
                                       
                                       
                                          
                                             P
                                          
                                          
                                             j
                                          
                                       
                                       |
                                       ⩽
                                       
                                          
                                             ε
                                          
                                          
                                             g
                                          
                                       
                                    
                                 , where 
                                    
                                       
                                          
                                             ε
                                          
                                          
                                             g
                                          
                                       
                                    
                                  denotes a given a glue tolerance, contract them by stitching; otherwise, if 
                                    
                                       
                                          
                                             ε
                                          
                                          
                                             g
                                          
                                       
                                       <
                                       |
                                       
                                          
                                             P
                                          
                                          
                                             i
                                          
                                       
                                       
                                          
                                             P
                                          
                                          
                                             j
                                          
                                       
                                       |
                                       ⩽
                                       
                                          
                                             ε
                                          
                                          
                                             r
                                          
                                       
                                    
                                 , cover the gap between them by filling.

Besides the stitching and filling operations, an edge splitting operation is defined to deal with T-connections, as shown in Fig. 4, where 
                           
                              |
                              
                                 
                                    P
                                 
                                 
                                    1
                                 
                              
                              
                                 
                                    P
                                 
                                 
                                    4
                                 
                              
                              |
                              ⩾
                              
                                 
                                    ε
                                 
                                 
                                    r
                                 
                              
                           
                         and 
                           
                              |
                              
                                 
                                    P
                                 
                                 
                                    1
                                 
                              
                              
                                 
                                    P
                                 
                                 
                                    5
                                 
                              
                              |
                              ⩾
                              
                                 
                                    ε
                                 
                                 
                                    r
                                 
                              
                           
                        , but the distance between 
                           
                              
                                 
                                    P
                                 
                                 
                                    1
                                 
                              
                           
                         and 
                           
                              
                                 
                                    P
                                 
                                 
                                    4
                                 
                              
                              
                                 
                                    P
                                 
                                 
                                    5
                                 
                              
                           
                         is smaller than 
                           
                              
                                 
                                    ε
                                 
                                 
                                    r
                                 
                              
                           
                        . Edge splitting introduces the projection of 
                           
                              
                                 
                                    P
                                 
                                 
                                    1
                                 
                              
                           
                         on 
                           
                              
                                 
                                    P
                                 
                                 
                                    4
                                 
                              
                              
                                 
                                    P
                                 
                                 
                                    5
                                 
                              
                           
                        , i.e., 
                           
                              
                                 
                                    P
                                 
                                 
                                    7
                                 
                              
                           
                        . Stitching or filling can then be executed on the vertex pair 
                           
                              <
                              
                                 
                                    P
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    P
                                 
                                 
                                    7
                                 
                              
                              >
                           
                        .


                        Fig. 5 illustrates three cases of stitching. In Fig. 5a, 
                           
                              
                                 
                                    P
                                 
                                 
                                    1
                                 
                              
                           
                         and 
                           
                              
                                 
                                    P
                                 
                                 
                                    2
                                 
                              
                           
                         are contracted because 
                           
                              |
                              
                                 
                                    P
                                 
                                 
                                    1
                                 
                              
                              
                                 
                                    P
                                 
                                 
                                    2
                                 
                              
                              |
                              ⩽
                              
                                 
                                    ε
                                 
                                 
                                    g
                                 
                              
                           
                        . Stitching may introduce edge contraction, as shown in Fig. 5b, where 
                           
                              
                                 
                                    P
                                 
                                 
                                    1
                                 
                              
                              
                                 
                                    P
                                 
                                 
                                    3
                                 
                              
                           
                         and 
                           
                              
                                 
                                    P
                                 
                                 
                                    2
                                 
                              
                              
                                 
                                    P
                                 
                                 
                                    3
                                 
                              
                           
                         are contracted when 
                           
                              
                                 
                                    P
                                 
                                 
                                    1
                                 
                              
                           
                         and 
                           
                              
                                 
                                    P
                                 
                                 
                                    2
                                 
                              
                           
                         are contracted. In the case of a T-connection, edge splitting is executed before stitching, as shown in Fig. 5c.


                        Fig. 6 illustrates two cases of filling. In Fig. 6a, two triangles are created to fill the gap between 
                           
                              
                                 
                                    P
                                 
                                 
                                    1
                                 
                              
                           
                         and 
                           
                              
                                 
                                    P
                                 
                                 
                                    2
                                 
                              
                           
                         because 
                           
                              |
                              
                                 
                                    P
                                 
                                 
                                    1
                                 
                              
                              
                                 
                                    P
                                 
                                 
                                    2
                                 
                              
                              |
                              >
                              
                                 
                                    ε
                                 
                                 
                                    g
                                 
                              
                           
                        . It is unsuitable to execute stitching for this vertex pair in order to maintain the geometry shape. Moreover, in the case of a T-connection, edge splitting must be executed before filling, as shown in Fig. 6b.

The efficiency of the algorithm largely depends on the search of boundary vertex pairs. The octree data structure can be adopted to speed up this searching procedure. Furthermore, an adaptive strategy for the settings of 
                           
                              
                                 
                                    ε
                                 
                                 
                                    r
                                 
                              
                           
                         and 
                           
                              
                                 
                                    ε
                                 
                                 
                                    g
                                 
                              
                           
                         can improve the reliability of the algorithm. More details are referred to [15,16].

The mapping defined in Section 3.2.2 connects the B-rep and the discrete model, and must be updated simultaneously when repairing the discrete model. The updated mapping is used to setup a correct B-rep based on the repaired discrete model.


                           Figs. 4–6
                           
                           
                            present all cases of the edge splitting, stitching and filling operations adopted by the repairing algorithm for the discrete model. The mapping between the B-rep and the discrete model is updated accordingly in each case of these operations.
                              
                                 (1)
                                 As shown in Fig. 4, edge splitting introduces a new vertex 
                                       
                                          
                                             
                                                P
                                             
                                             
                                                7
                                             
                                          
                                       
                                     to split 
                                       
                                          
                                             
                                                P
                                             
                                             
                                                4
                                             
                                          
                                          
                                             
                                                P
                                             
                                             
                                                5
                                             
                                          
                                       
                                     and 
                                       
                                          Δ
                                          
                                             
                                                P
                                             
                                             
                                                4
                                             
                                          
                                          
                                             
                                                P
                                             
                                             
                                                5
                                             
                                          
                                          
                                             
                                                P
                                             
                                             
                                                6
                                             
                                          
                                       
                                    . If 
                                       
                                          
                                             
                                                P
                                             
                                             
                                                4
                                             
                                          
                                          
                                             
                                                P
                                             
                                             
                                                5
                                             
                                          
                                          ⊑
                                          
                                             
                                                G
                                             
                                             
                                                i
                                             
                                             
                                                1
                                             
                                          
                                       
                                     and 
                                       
                                          Δ
                                          
                                             
                                                P
                                             
                                             
                                                4
                                             
                                          
                                          
                                             
                                                P
                                             
                                             
                                                5
                                             
                                          
                                          
                                             
                                                P
                                             
                                             
                                                6
                                             
                                          
                                          ⊑
                                          
                                             
                                                G
                                             
                                             
                                                j
                                             
                                             
                                                2
                                             
                                          
                                       
                                    , the new edges (
                                       
                                          
                                             
                                                P
                                             
                                             
                                                4
                                             
                                          
                                          
                                             
                                                P
                                             
                                             
                                                7
                                             
                                          
                                       
                                     and 
                                       
                                          
                                             
                                                P
                                             
                                             
                                                7
                                             
                                          
                                          
                                             
                                                P
                                             
                                             
                                                5
                                             
                                          
                                       
                                    ) and faces (
                                       
                                          Δ
                                          
                                             
                                                P
                                             
                                             
                                                4
                                             
                                          
                                          
                                             
                                                P
                                             
                                             
                                                7
                                             
                                          
                                          
                                             
                                                P
                                             
                                             
                                                6
                                             
                                          
                                       
                                     and 
                                       
                                          Δ
                                          
                                             
                                                P
                                             
                                             
                                                6
                                             
                                          
                                          
                                             
                                                P
                                             
                                             
                                                7
                                             
                                          
                                          
                                             
                                                P
                                             
                                             
                                                5
                                             
                                          
                                       
                                    ) must be classified on 
                                       
                                          
                                             
                                                G
                                             
                                             
                                                i
                                             
                                             
                                                1
                                             
                                          
                                       
                                     and 
                                       
                                          
                                             
                                                G
                                             
                                             
                                                j
                                             
                                             
                                                2
                                             
                                          
                                       
                                    , respectively.

In Fig. 5a and c, the new vertex 
                                       
                                          P
                                       
                                     must inherit the classifications of 
                                       
                                          
                                             
                                                P
                                             
                                             
                                                1
                                             
                                          
                                       
                                     and 
                                       
                                          
                                             
                                                P
                                             
                                             
                                                2
                                             
                                          
                                       
                                    . If 
                                       
                                          
                                             
                                                P
                                             
                                             
                                                1
                                             
                                          
                                          ⊑
                                          
                                             
                                                G
                                             
                                             
                                                i
                                             
                                             
                                                0
                                             
                                          
                                       
                                    , then 
                                       
                                          P
                                          ⊑
                                          
                                             
                                                G
                                             
                                             
                                                i
                                             
                                             
                                                0
                                             
                                          
                                       
                                    ; and if 
                                       
                                          
                                             
                                                P
                                             
                                             
                                                2
                                             
                                          
                                          ⊑
                                          
                                             
                                                G
                                             
                                             
                                                j
                                             
                                             
                                                0
                                             
                                          
                                       
                                    , then 
                                       
                                          P
                                          ⊑
                                          
                                             
                                                G
                                             
                                             
                                                j
                                             
                                             
                                                0
                                             
                                          
                                       
                                    . In Fig. 5b, the new edge 
                                       
                                          
                                             
                                                PP
                                             
                                             
                                                3
                                             
                                          
                                       
                                     must inherit the classifications of 
                                       
                                          
                                             
                                                P
                                             
                                             
                                                1
                                             
                                          
                                          
                                             
                                                P
                                             
                                             
                                                3
                                             
                                          
                                       
                                     and 
                                       
                                          
                                             
                                                P
                                             
                                             
                                                2
                                             
                                          
                                          
                                             
                                                P
                                             
                                             
                                                3
                                             
                                          
                                       
                                    . If 
                                       
                                          
                                             
                                                P
                                             
                                             
                                                1
                                             
                                          
                                          
                                             
                                                P
                                             
                                             
                                                3
                                             
                                          
                                          ⊑
                                          
                                             
                                                G
                                             
                                             
                                                i
                                             
                                             
                                                1
                                             
                                          
                                       
                                    , then 
                                       
                                          
                                             
                                                PP
                                             
                                             
                                                3
                                             
                                          
                                          ⊑
                                          
                                             
                                                G
                                             
                                             
                                                i
                                             
                                             
                                                1
                                             
                                          
                                       
                                    ; and if 
                                       
                                          
                                             
                                                P
                                             
                                             
                                                2
                                             
                                          
                                          
                                             
                                                P
                                             
                                             
                                                3
                                             
                                          
                                          ⊑
                                          
                                             
                                                G
                                             
                                             
                                                j
                                             
                                             
                                                1
                                             
                                          
                                       
                                    , then 
                                       
                                          
                                             
                                                PP
                                             
                                             
                                                3
                                             
                                          
                                          ⊑
                                          
                                             
                                                G
                                             
                                             
                                                j
                                             
                                             
                                                1
                                             
                                          
                                       
                                    . Note that an edge or facet can have more than one classification at this stage.

In Fig. 6a and b, the filling operation introduces three new edges (
                                       
                                          
                                             
                                                P
                                             
                                             
                                                1
                                             
                                          
                                          
                                             
                                                P
                                             
                                             
                                                3
                                             
                                          
                                          ,
                                       
                                     
                                    
                                       
                                          
                                             
                                                P
                                             
                                             
                                                1
                                             
                                          
                                          
                                             
                                                P
                                             
                                             
                                                2
                                             
                                          
                                       
                                     and 
                                       
                                          
                                             
                                                P
                                             
                                             
                                                1
                                             
                                          
                                          
                                             
                                                P
                                             
                                             
                                                4
                                             
                                          
                                       
                                    ) and two new facets (
                                       
                                          Δ
                                          
                                             
                                                P
                                             
                                             
                                                3
                                             
                                          
                                          
                                             
                                                P
                                             
                                             
                                                1
                                             
                                          
                                          
                                             
                                                P
                                             
                                             
                                                2
                                             
                                          
                                       
                                     and 
                                       
                                          Δ
                                          
                                             
                                                P
                                             
                                             
                                                1
                                             
                                          
                                          
                                             
                                                P
                                             
                                             
                                                4
                                             
                                          
                                          
                                             
                                                P
                                             
                                             
                                                2
                                             
                                          
                                       
                                    ). Their classifications will be determined later (see Section 5.2.3 for more details).

Before examining the algorithm for repairing the B-rep, two examples are presented below to illustrate the basic idea.

In Fig. 7
                           a, 
                              
                                 
                                    
                                       G
                                    
                                    
                                       1
                                    
                                    
                                       1
                                    
                                 
                              
                            and 
                              
                                 
                                    
                                       G
                                    
                                    
                                       2
                                    
                                    
                                       1
                                    
                                 
                              
                            are boundary curves of two faces 
                              
                                 
                                    
                                       G
                                    
                                    
                                       1
                                    
                                    
                                       2
                                    
                                 
                              
                            and 
                              
                                 
                                    
                                       G
                                    
                                    
                                       2
                                    
                                    
                                       2
                                    
                                 
                              
                           . The discrete duals of the two curves are shown in Fig. 7b:
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            M
                                                         
                                                         
                                                            1
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      =
                                                      {
                                                      
                                                         
                                                            M
                                                         
                                                         
                                                            1
                                                            i
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      |
                                                      
                                                         
                                                            M
                                                         
                                                         
                                                            1
                                                            i
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ⊑
                                                      
                                                         
                                                            G
                                                         
                                                         
                                                            1
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ,
                                                      i
                                                      =
                                                      1
                                                      ,
                                                      2
                                                      ,
                                                      ⋯
                                                      ,
                                                      
                                                         
                                                            n
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      }
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            M
                                                         
                                                         
                                                            2
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      =
                                                      {
                                                      
                                                         
                                                            M
                                                         
                                                         
                                                            2
                                                            i
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      |
                                                      
                                                         
                                                            M
                                                         
                                                         
                                                            2
                                                            i
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ⊑
                                                      
                                                         
                                                            G
                                                         
                                                         
                                                            2
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ,
                                                      i
                                                      =
                                                      1
                                                      ,
                                                      2
                                                      ,
                                                      ⋯
                                                      ,
                                                      
                                                         
                                                            n
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      }
                                                   
                                                
                                             
                                          
                                       
                                    
                                    .
                                 
                              
                           It is assumed that stitching is employed to repair the discrete model because the two curves are sufficiently close from each other. After repairing, the discrete duals of the two curves are refreshed, where 
                              
                                 
                                    
                                       M
                                    
                                    
                                       2
                                    
                                    
                                       1
                                    
                                 
                              
                            is a subset of 
                              
                                 
                                    
                                       M
                                    
                                    
                                       1
                                    
                                    
                                       1
                                    
                                 
                              
                           , as shown in Fig. 7c:
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            M
                                                         
                                                         
                                                            1
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      =
                                                      {
                                                      
                                                         
                                                            M
                                                         
                                                         
                                                            1
                                                            i
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      |
                                                      
                                                         
                                                            M
                                                         
                                                         
                                                            1
                                                            i
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ⊑
                                                      
                                                         
                                                            G
                                                         
                                                         
                                                            1
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ,
                                                      i
                                                      =
                                                      1
                                                      ,
                                                      2
                                                      ,
                                                      ⋯
                                                      ,
                                                      m
                                                      }
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            M
                                                         
                                                         
                                                            2
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      =
                                                      {
                                                      
                                                         
                                                            M
                                                         
                                                         
                                                            2
                                                            i
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      |
                                                      
                                                         
                                                            M
                                                         
                                                         
                                                            2
                                                            i
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ⊑
                                                      
                                                         
                                                            G
                                                         
                                                         
                                                            2
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ,
                                                      i
                                                      =
                                                      
                                                         
                                                            m
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ,
                                                      ⋯
                                                      
                                                         
                                                            m
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      ,
                                                      1
                                                      <
                                                      
                                                         
                                                            m
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      <
                                                      
                                                         
                                                            m
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      <
                                                      m
                                                      }
                                                   
                                                
                                             
                                          
                                       
                                    
                                    .
                                 
                              
                           
                        

To repair the B-rep, three curves 
                              
                                 
                                    
                                       G
                                    
                                    
                                       new,
                                       j
                                    
                                    
                                       1
                                    
                                 
                                 (
                                 j
                                 =
                                 1
                                 ,
                                 2
                                 ,
                                 3
                                 )
                              
                            are created. Their discrete duals are:
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            M
                                                         
                                                         
                                                            new,
                                                            1
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      =
                                                      {
                                                      
                                                         
                                                            M
                                                         
                                                         
                                                            1
                                                            i
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      |
                                                      
                                                         
                                                            M
                                                         
                                                         
                                                            1
                                                            i
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ⊑
                                                      
                                                         
                                                            G
                                                         
                                                         
                                                            new,
                                                            1
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ,
                                                      i
                                                      =
                                                      1
                                                      ,
                                                      2
                                                      ,
                                                      ⋯
                                                      ,
                                                      
                                                         
                                                            m
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      }
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            M
                                                         
                                                         
                                                            new,
                                                            2
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      =
                                                      {
                                                      
                                                         
                                                            M
                                                         
                                                         
                                                            1
                                                            i
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      |
                                                      
                                                         
                                                            M
                                                         
                                                         
                                                            1
                                                            i
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ⊑
                                                      
                                                         
                                                            G
                                                         
                                                         
                                                            new,
                                                            2
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ,
                                                      i
                                                      =
                                                      
                                                         
                                                            m
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ,
                                                      ⋯
                                                      ,
                                                      
                                                         
                                                            m
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      }
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            M
                                                         
                                                         
                                                            new,
                                                            3
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      =
                                                      {
                                                      
                                                         
                                                            M
                                                         
                                                         
                                                            1
                                                            i
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      |
                                                      
                                                         
                                                            M
                                                         
                                                         
                                                            1
                                                            i
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ⊑
                                                      
                                                         
                                                            G
                                                         
                                                         
                                                            new,
                                                            3
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ,
                                                      i
                                                      =
                                                      
                                                         
                                                            m
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      ,
                                                      ⋯
                                                      ,
                                                      m
                                                      }
                                                   
                                                
                                             
                                          
                                       
                                    
                                    .
                                 
                              
                           After replacing 
                              
                                 
                                    
                                       G
                                    
                                    
                                       2
                                    
                                    
                                       1
                                    
                                 
                              
                            with 
                              
                                 
                                    
                                       G
                                    
                                    
                                       new,
                                       2
                                    
                                    
                                       1
                                    
                                 
                              
                            and 
                              
                                 
                                    
                                       G
                                    
                                    
                                       1
                                    
                                    
                                       1
                                    
                                 
                              
                            with a combination of 
                              
                                 
                                    
                                       G
                                    
                                    
                                       new,
                                       j
                                    
                                    
                                       1
                                    
                                 
                                 (
                                 j
                                 =
                                 1
                                 ,
                                 2
                                 ,
                                 3
                                 )
                              
                           , it is observed that 
                              
                                 
                                    
                                       G
                                    
                                    
                                       1
                                    
                                    
                                       2
                                    
                                 
                              
                            is adjacent to 
                              
                                 
                                    
                                       G
                                    
                                    
                                       2
                                    
                                    
                                       2
                                    
                                 
                              
                            through a common curve 
                              
                                 
                                    
                                       G
                                    
                                    
                                       new,
                                       2
                                    
                                    
                                       1
                                    
                                 
                              
                            in the repaired B-rep.


                           Fig. 8
                            presents another example where the gap between the curves 
                              
                                 
                                    
                                       G
                                    
                                    
                                       1
                                    
                                    
                                       1
                                    
                                 
                              
                            and 
                              
                                 
                                    
                                       G
                                    
                                    
                                       2
                                    
                                    
                                       1
                                    
                                 
                              
                            are so large that filling is required to repair the discrete model. The discrete duals of the two curves are shown in Fig. 8b:
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            M
                                                         
                                                         
                                                            1
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      =
                                                      {
                                                      
                                                         
                                                            M
                                                         
                                                         
                                                            1
                                                            i
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      |
                                                      
                                                         
                                                            M
                                                         
                                                         
                                                            1
                                                            i
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ⊑
                                                      
                                                         
                                                            G
                                                         
                                                         
                                                            1
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ,
                                                      i
                                                      =
                                                      1
                                                      ,
                                                      2
                                                      ,
                                                      ⋯
                                                      ,
                                                      
                                                         
                                                            m
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      }
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            M
                                                         
                                                         
                                                            2
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      =
                                                      {
                                                      
                                                         
                                                            M
                                                         
                                                         
                                                            2
                                                            i
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      |
                                                      
                                                         
                                                            M
                                                         
                                                         
                                                            2
                                                            i
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ⊑
                                                      
                                                         
                                                            G
                                                         
                                                         
                                                            2
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ,
                                                      i
                                                      =
                                                      1
                                                      ,
                                                      2
                                                      ,
                                                      ⋯
                                                      ,
                                                      
                                                         
                                                            m
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      }
                                                   
                                                
                                             
                                          
                                       
                                    
                                    .
                                 
                              
                           
                        

After repairing, a set of facets are inserted:
                              
                                 
                                    
                                       
                                          M
                                       
                                       
                                          new
                                       
                                       
                                          2
                                       
                                    
                                    =
                                    {
                                    
                                       
                                          M
                                       
                                       
                                          i
                                       
                                       
                                          2
                                       
                                    
                                    |
                                    i
                                    =
                                    1
                                    ,
                                    2
                                    ,
                                    ⋯
                                    ,
                                    n
                                    }
                                    .
                                 
                              
                           
                        

Instead of classifying 
                              
                                 
                                    
                                       M
                                    
                                    
                                       new
                                    
                                    
                                       2
                                    
                                 
                              
                            onto 
                              
                                 
                                    
                                       G
                                    
                                    
                                       1
                                    
                                    
                                       2
                                    
                                 
                              
                            or 
                              
                                 
                                    
                                       G
                                    
                                    
                                       2
                                    
                                    
                                       2
                                    
                                 
                              
                           , a face 
                              
                                 
                                    
                                       G
                                    
                                    
                                       new
                                    
                                    
                                       2
                                    
                                 
                              
                            is created in the B-rep and 
                              
                                 
                                    
                                       M
                                    
                                    
                                       new
                                    
                                    
                                       2
                                    
                                 
                              
                            is classified onto 
                              
                                 
                                    
                                       G
                                    
                                    
                                       new
                                    
                                    
                                       2
                                    
                                 
                              
                           :
                              
                                 
                                    
                                       
                                          M
                                       
                                       
                                          new
                                       
                                       
                                          2
                                       
                                    
                                    =
                                    {
                                    
                                       
                                          M
                                       
                                       
                                          i
                                       
                                       
                                          2
                                       
                                    
                                    |
                                    
                                       
                                          M
                                       
                                       
                                          i
                                       
                                       
                                          2
                                       
                                    
                                    ⊑
                                    
                                       
                                          G
                                       
                                       
                                          new
                                       
                                       
                                          2
                                       
                                    
                                    ,
                                    i
                                    =
                                    1
                                    ,
                                    2
                                    ,
                                    ⋯
                                    ,
                                    n
                                    }
                                    .
                                 
                              
                           
                        

Initially, a closed curve 
                              
                                 
                                    
                                       G
                                    
                                    
                                       new
                                    
                                    
                                       1
                                    
                                 
                              
                            is created to bound 
                              
                                 
                                    
                                       G
                                    
                                    
                                       new
                                    
                                    
                                       2
                                    
                                 
                              
                           , and its discrete dual is:
                              
                                 
                                    
                                       
                                          M
                                       
                                       
                                          new
                                       
                                       
                                          1
                                       
                                    
                                    =
                                    
                                       
                                          M
                                       
                                       
                                          1
                                       
                                       
                                          1
                                       
                                    
                                    ∪
                                    
                                       
                                          M
                                       
                                       
                                          2
                                       
                                       
                                          1
                                       
                                    
                                    ∪
                                    {
                                    
                                       
                                          M
                                       
                                       
                                          l
                                       
                                       
                                          1
                                       
                                    
                                    }
                                    ∪
                                    {
                                    
                                       
                                          M
                                       
                                       
                                          r
                                       
                                       
                                          1
                                       
                                    
                                    }
                                    ,
                                 
                              
                           where 
                              
                                 
                                    
                                       M
                                    
                                    
                                       l
                                    
                                    
                                       1
                                    
                                 
                              
                            and 
                              
                                 
                                    
                                       M
                                    
                                    
                                       r
                                    
                                    
                                       1
                                    
                                 
                              
                            are two boundary edges of 
                              
                                 
                                    
                                       G
                                    
                                    
                                       new
                                    
                                    
                                       2
                                    
                                 
                              
                           , as shown in Fig. 8c. Furthermore, 
                              
                                 
                                    
                                       G
                                    
                                    
                                       new
                                    
                                    
                                       1
                                    
                                 
                              
                            is subdivided into four curves 
                              
                                 
                                    
                                       G
                                    
                                    
                                       k
                                    
                                    
                                       1
                                    
                                 
                                 (
                                 k
                                 =
                                 1
                                 ∼
                                 4
                                 )
                              
                           , where 
                              
                                 
                                    
                                       G
                                    
                                    
                                       3
                                    
                                    
                                       1
                                    
                                 
                              
                            and 
                              
                                 
                                    
                                       G
                                    
                                    
                                       4
                                    
                                    
                                       1
                                    
                                 
                              
                            are new curves with 
                              
                                 
                                    
                                       M
                                    
                                    
                                       l
                                    
                                    
                                       1
                                    
                                 
                                 ⊑
                                 
                                    
                                       G
                                    
                                    
                                       3
                                    
                                    
                                       1
                                    
                                 
                              
                            and 
                              
                                 
                                    
                                       M
                                    
                                    
                                       r
                                    
                                    
                                       1
                                    
                                 
                                 ⊑
                                 
                                    
                                       G
                                    
                                    
                                       4
                                    
                                    
                                       1
                                    
                                 
                              
                           . In the repaired B-rep, 
                              
                                 
                                    
                                       G
                                    
                                    
                                       new
                                    
                                    
                                       2
                                    
                                 
                              
                            is adjacent to 
                              
                                 
                                    
                                       G
                                    
                                    
                                       1
                                    
                                    
                                       2
                                    
                                 
                              
                            and 
                              
                                 
                                    
                                       G
                                    
                                    
                                       2
                                    
                                    
                                       2
                                    
                                 
                              
                            through 
                              
                                 
                                    
                                       G
                                    
                                    
                                       1
                                    
                                    
                                       1
                                    
                                 
                              
                            and 
                              
                                 
                                    
                                       G
                                    
                                    
                                       2
                                    
                                    
                                       1
                                    
                                 
                              
                           , respectively.

The algorithm is a top-down procedure, i.e., targeting faces first, followed by curves and points. As explained in Section 5.2.1, new facets created by filling are not classified initially. During this stage, new faces are created in the B-rep, and unclassified facets will be classified on these faces, as illustrated in Algorithm 1.
                              
                                 
                                    
                                    
                                       
                                          
                                             Algorithm 1. Create new faces in the B-rep
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         M
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             : all of the unclassified facets, 
                                                
                                                   
                                                      
                                                         M
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   =
                                                   {
                                                   
                                                      
                                                         M
                                                      
                                                      
                                                         1
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   ,
                                                   ⋯
                                                   ,
                                                   
                                                      
                                                         M
                                                      
                                                      
                                                         n
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   }
                                                
                                             
                                          
                                       
                                       
                                          1. Initialise the visit flags of all facets to be 0
                                       
                                       
                                          2. k
                                             =0
                                       
                                       
                                          3. for 
                                             i
                                             =1 upto 
                                             n
                                          
                                       
                                       
                                          4.
                                             if 
                                             
                                                
                                                   
                                                      
                                                         M
                                                      
                                                      
                                                         i
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                              is visited
                                       
                                       
                                          5. 
                                             
                                             continue
                                          
                                       
                                       
                                          6. 
                                             k++
                                       
                                       
                                          7. Flag 
                                                
                                                   
                                                      
                                                         M
                                                      
                                                      
                                                         i
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                              as visited, and push 
                                                
                                                   
                                                      
                                                         M
                                                      
                                                      
                                                         i
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                              into a stack 
                                                
                                                   R
                                                
                                             
                                          
                                       
                                       
                                          8. Create a new face 
                                                
                                                   
                                                      
                                                         G
                                                      
                                                      
                                                         k
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                              in the B-rep, and classify 
                                                
                                                   
                                                      
                                                         M
                                                      
                                                      
                                                         i
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                              on 
                                                
                                                   
                                                      
                                                         G
                                                      
                                                      
                                                         k
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          9. 
                                             while 
                                             
                                                
                                                   R
                                                
                                              is not empty
                                       
                                       
                                          10. 
                                             Pop the top element of 
                                                
                                                   R
                                                
                                             , i.e., 
                                                
                                                   
                                                      
                                                         M
                                                      
                                                      
                                                         t
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          11. 
                                             Access the neighbours of 
                                                
                                                   
                                                      
                                                         M
                                                      
                                                      
                                                         t
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             , i.e., 
                                                
                                                   
                                                      
                                                         M
                                                      
                                                      
                                                         a
                                                         1
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             , 
                                                
                                                   
                                                      
                                                         M
                                                      
                                                      
                                                         a
                                                         2
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                              and 
                                                
                                                   
                                                      
                                                         M
                                                      
                                                      
                                                         a
                                                         3
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             :
                                       
                                       
                                          12. 
                                             
                                             for 
                                             m
                                             =1 upto 3
                                       
                                       
                                          13. 
                                             
                                             if 
                                             
                                                
                                                   
                                                      
                                                         M
                                                      
                                                      
                                                         am
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                              is unvisited and unclassified
                                          
                                       
                                       
                                          14. 
                                             
                                             classify 
                                                
                                                   
                                                      
                                                         M
                                                      
                                                      
                                                         am
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                              on 
                                                
                                                   
                                                      
                                                         G
                                                      
                                                      
                                                         k
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          15. 
                                             
                                             push 
                                                
                                                   
                                                      
                                                         M
                                                      
                                                      
                                                         am
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                              into 
                                                
                                                   R
                                                
                                             
                                          
                                       
                                       
                                          16. 
                                             Flag 
                                                
                                                   
                                                      
                                                         M
                                                      
                                                      
                                                         am
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                              as visited
                                       
                                    
                                 
                              
                           The curves of the B-rep need to be refreshed. First, a closed boundary curve is created for each new face. The boundary curve of a new face only has a discrete representation initially, which is composed of the boundary edges of the discrete model classified on the face. Then, a curve splitting procedure is introduced to glue adjacent faces in the B-rep, as detailed in Algorithm 2.

It is worth to give more explanations for Lines 21 and 24 in Algorithm 2. In Fig. 7, the curve 
                              
                                 
                                    
                                       G
                                    
                                    
                                       2
                                    
                                    
                                       1
                                    
                                 
                              
                            is replaced by a new curve 
                              
                                 
                                    
                                       G
                                    
                                    
                                       new,
                                       2
                                    
                                    
                                       1
                                    
                                 
                              
                            because they have identical discrete representations. However, the curve 
                              
                                 
                                    
                                       G
                                    
                                    
                                       1
                                    
                                    
                                       1
                                    
                                 
                              
                            is split by 
                              
                                 
                                    
                                       G
                                    
                                    
                                       new,
                                       2
                                    
                                    
                                       1
                                    
                                 
                              
                            into three curves (including 
                              
                                 
                                    
                                       G
                                    
                                    
                                       new,
                                       2
                                    
                                    
                                       1
                                    
                                 
                              
                           ) because the discrete dual of 
                              
                                 
                                    
                                       G
                                    
                                    
                                       new,
                                       2
                                    
                                    
                                       1
                                    
                                 
                              
                           , i.e., 
                              
                                 
                                    
                                       M
                                    
                                    
                                       new,
                                       2
                                    
                                    
                                       1
                                    
                                 
                              
                            overlaps with the intermediate part of the dual of 
                              
                                 
                                    
                                       G
                                    
                                    
                                       1
                                    
                                    
                                       1
                                    
                                 
                              
                           , i.e., 
                              
                                 
                                    
                                       M
                                    
                                    
                                       1
                                    
                                    
                                       1
                                    
                                 
                              
                           . Instead, if either the end vertex of 
                              
                                 
                                    
                                       M
                                    
                                    
                                       new,
                                       2
                                    
                                    
                                       1
                                    
                                 
                              
                            is identical to an end vertex of 
                              
                                 
                                    
                                       M
                                    
                                    
                                       1
                                    
                                    
                                       1
                                    
                                 
                              
                           , 
                              
                                 
                                    
                                       G
                                    
                                    
                                       1
                                    
                                    
                                       1
                                    
                                 
                              
                            should be split into two curves. In Line 24, the splitting results of 
                              
                                 
                                    
                                       G
                                    
                                    
                                       i
                                       1
                                       k
                                    
                                    
                                       1
                                    
                                 
                              
                            may be new curves or existing curves in 
                              
                                 
                                    
                                       G
                                    
                                    
                                       1
                                    
                                 
                              
                            (
                              
                                 
                                    
                                       G
                                    
                                    
                                       new
                                    
                                    
                                       1
                                    
                                 
                              
                            is always a new curve). Here, a curve is new if and only if its discrete representation is unique in the B-rep.

After executing Algorithm 2, the topological curves of the B-rep are repaired. Finally, the topological points of the B-rep are updated to ensure all end points of curves are included in the B-rep.

In the above repairing process, the geometry entities and the relationship between geometry and topology entities must be refreshed as well. The trivial details regarding how to implement this refreshing procedure are not presented here.

To sum up, the repaired model has the following unique features:
                              
                                 (1)
                                 The B-rep topology is correct.

The discrete model is valid in terms of both topology and geometry.

Each B-rep topology entity has a unique discrete representation.

Some B-rep topology entities may have no continuous representation, e.g., the curves 
                                       
                                          
                                             
                                                G
                                             
                                             
                                                3
                                             
                                             
                                                1
                                             
                                          
                                       
                                     and 
                                       
                                          
                                             
                                                G
                                             
                                             
                                                4
                                             
                                             
                                                1
                                             
                                          
                                       
                                     and the face 
                                       
                                          
                                             
                                                G
                                             
                                             
                                                new
                                             
                                             
                                                2
                                             
                                          
                                       
                                     shown in Fig. 8c.

Some B-rep topology entities may have more than one continuous representation, e.g., the curve 
                                       
                                          
                                             
                                                G
                                             
                                             
                                                new,
                                                2
                                             
                                             
                                                1
                                             
                                          
                                       
                                     in Fig. 7c.

Both the discrete model and the B-rep topology are valid after repairing, which allows two types of defeaturing and meshing strategies to be applied on the repaired model. Similar to Quadros et al. [18], one strategy is to simplify the discrete model with edge-collapse operations and then mesh the simplified discrete model. The other strategy is to combine neighbouring faces in a valid B-rep topology and then mesh the simplified B-rep. In this study, we choose the second strategy to demonstrate the benefit of having the valid B-rep topology. This approach is more suitable for mesh generation that requires high geometry fidelity for the surface mesh.

Some features may prevent the generation of a high-quality surface mesh. Here, a mesh is identified as low quality if it contains many elements that are badly shaped or unnecessarily small. Fig. 9
                         presents various features that affect surface mesh quality, i.e., short curves, tiny faces, curve proximities and small angles. The meshes around these features have to be densified to avoid the generation of badly shaped elements. Even so, the quality of some elements may still be unacceptable, such as those around the small angle shown in Fig. 9d.

A simple and efficient method to suppress these features is face clustering 
                        [6,7]. For instance, if S
                        1 and S
                        2 in Fig. 9c are combined, the proximity features will be removed. As reviewed in Section 2, two approaches are applicable to combine faces: the geometry-based approach and the topology-based approach. The latter is adopted to avoid tedious and expensive computation for continuous representation of faces.

Topologically, we can represent face adjacencies by an adjacency graph, as shown in Fig. 10
                        , where graph nodes refer to faces and graph arcs connect neighbouring faces. A face-clustering operation is equivalent to an arc-contraction operation on the adjacency graph. Based on this equivalence, Algorithm 3 presents the defeaturing workflow, which is a variant of the algorithm proposed by Inoue et al. [6].

To meet requirements from different applications, the user is allowed to mask some arcs as internal or boundary. All internal arcs are contracted in a preprocessing step (Line 1 of Algorithm 3). Geometry criteria, termed as geometry indices, are introduced to score unmasked arcs so that the top-scored arc can be contracted first. In addition, these indices can be employed to judge whether an arc is mergeable. In [6], many indices are proposed and four different combinations of these indices are tested for the scoring and mergeability. In our algorithm, the hybrid strategy that considers both the boundary smoothness and region flatness is adopted. More details of the implementation are referred to [6]. It needs to mention that most geometric indices are computed on the discrete model. For instance, one geometry index considers the ratios of face areas with a user-defined threshold. Obviously, the area of a face can be approximated by the sum area of all triangles classified on this face.

Note that the new faces created by filling operations, e.g., the face 
                           
                              
                                 
                                    G
                                 
                                 
                                    new
                                 
                                 
                                    2
                                 
                              
                           
                         shown in Fig. 8c, can be merged with their neighbours in this defeaturing procedure.
                           
                              
                                 
                                 
                                    
                                       
                                          Algorithm 3. The general flowchart of the defeaturing algorithm
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                G
                                             
                                          : the adjacency graph of the surface model
                                    
                                    
                                       1. Contract all arcs in 
                                             
                                                G
                                             
                                           marked as internal
                                       
                                    
                                    
                                       2. 
                                             
                                                A
                                             
                                          , all of the unmasked arcs in 
                                             
                                                G
                                             
                                          : 
                                             
                                                A
                                                =
                                                {
                                                
                                                   
                                                      a
                                                   
                                                   
                                                      1
                                                   
                                                
                                                ,
                                                ⋯
                                                ,
                                                
                                                   
                                                      a
                                                   
                                                   
                                                      n
                                                   
                                                
                                                }
                                             
                                          
                                       
                                    
                                    
                                       3. Score all arcs in 
                                             
                                                A
                                             
                                           by geometry criteria
                                    
                                    
                                       4. 
                                             
                                                
                                                   
                                                      a
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                          : a top-scored arc that is unmasked and mergeable
                                       
                                    
                                    
                                       5. while 
                                          
                                             
                                                
                                                   
                                                      a
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                           exists
                                    
                                    
                                       6. Contract 
                                             
                                                
                                                   
                                                      a
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       7. Rescore all arcs incident to the ending nodes of 
                                             
                                                
                                                   
                                                      a
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

The meshing procedure is conducted on curves and faces individually. Algorithm 4 presents a bottom-up meshing procedure to maintain the mesh conformity on shared entities, i.e., common points of neighbouring curves and common curves of neighbouring faces. Note that this procedure is defined on the topology entities of the B-rep. When an entity is to be meshed, its boundary entities are checked first. If a boundary entity is unmeshed, a meshing function is called; otherwise, the existing mesh data is referred. This procedure ensures that all entities are meshed once. Therefore, if the input B-rep topology is correct, the mesh conformity can be ensured automatically.
                              
                                 
                                    
                                    
                                       
                                          
                                             Algorithm 4. The general workflow of the meshing algorithm
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         G
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             : a set of faces contained in the surface model, 
                                                
                                                   
                                                      
                                                         G
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   =
                                                   {
                                                   
                                                      
                                                         G
                                                      
                                                      
                                                         1
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   ,
                                                   ⋯
                                                   ,
                                                   
                                                      
                                                         G
                                                      
                                                      
                                                         n
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   }
                                                
                                             
                                          
                                       
                                       
                                          1. for 
                                             i
                                             =1 upto 
                                             n
                                          
                                       
                                       
                                          2. 
                                             
                                                
                                                   
                                                      
                                                         G
                                                      
                                                      
                                                         i
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                
                                             : a set of boundary curves of 
                                                
                                                   
                                                      
                                                         G
                                                      
                                                      
                                                         i
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             , 
                                                
                                                   
                                                      
                                                         G
                                                      
                                                      
                                                         i
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   =
                                                   {
                                                   
                                                      
                                                         G
                                                      
                                                      
                                                         i
                                                         1
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   ,
                                                   ⋯
                                                   ,
                                                   
                                                      
                                                         G
                                                      
                                                      
                                                         im
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   }
                                                
                                             
                                          
                                       
                                       
                                          3. 
                                             for 
                                             k
                                             =1 upto 
                                             m
                                          
                                       
                                       
                                          4. 
                                             
                                             if 
                                             
                                                
                                                   
                                                      
                                                         G
                                                      
                                                      
                                                         ik
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                
                                              is unmeshed
                                       
                                       
                                          5. 
                                             
                                             
                                             
                                                
                                                   
                                                      
                                                         G
                                                      
                                                      
                                                         ik
                                                         ,
                                                         0
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                
                                              and 
                                                
                                                   
                                                      
                                                         G
                                                      
                                                      
                                                         ik
                                                         ,
                                                         1
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                
                                             : the ending points of 
                                                
                                                   
                                                      
                                                         G
                                                      
                                                      
                                                         ik
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          6. 
                                             
                                             
                                             if 
                                             
                                                
                                                   
                                                      
                                                         G
                                                      
                                                      
                                                         ik
                                                         ,
                                                         0
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                
                                              is unmeshed
                                       
                                       
                                          7. 
                                             
                                             
                                             Mesh 
                                                
                                                   
                                                      
                                                         G
                                                      
                                                      
                                                         ik
                                                         ,
                                                         0
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          8. 
                                             
                                             
                                             if 
                                             
                                                
                                                   
                                                      
                                                         G
                                                      
                                                      
                                                         ik
                                                         ,
                                                         1
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                
                                              is unmeshed
                                       
                                       
                                          9. 
                                             
                                             
                                             Mesh 
                                                
                                                   
                                                      
                                                         G
                                                      
                                                      
                                                         ik
                                                         ,
                                                         1
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          10. 
                                             
                                             
                                             
                                                
                                                   
                                                      
                                                         B
                                                      
                                                      
                                                         ik
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                
                                             : the boundary mesh of 
                                                
                                                   
                                                      
                                                         G
                                                      
                                                      
                                                         ik
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          11. 
                                             
                                             Mesh 
                                                
                                                   
                                                      
                                                         G
                                                      
                                                      
                                                         ik
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                
                                              with given 
                                                
                                                   
                                                      
                                                         B
                                                      
                                                      
                                                         ik
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          12. 
                                                
                                                   
                                                      
                                                         B
                                                      
                                                      
                                                         i
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                
                                             : the boundary mesh of 
                                                
                                                   
                                                      
                                                         G
                                                      
                                                      
                                                         i
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          13. Mesh 
                                                
                                                   
                                                      
                                                         G
                                                      
                                                      
                                                         i
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                              with given 
                                                
                                                   
                                                      
                                                         B
                                                      
                                                      
                                                         i
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        

As explained in Section 5.2.3, a topology entity has one unique discrete representation in the repaired B-rep, but the continuous representations of point and curve entities may not exist or may not be unique. This complicates the meshing procedures for points and curves.

The mesh point of a point entity is located on its unique discrete dual, which is actually the average position of all continuous points referred by the point entity. The meshing procedure of a curve entity involves three cases. If the curve corresponds to a unique continuous representation, the meshing procedure is conducted on the continuous curve directly; otherwise, it is conducted on the unique discrete curve. Furthermore, in case that the curve entity refers to more than one continuous curve, a procedure is required to project meshing points, apart from two end points, from the discrete curve to the continuous ones. The final position of a projected mesh point is the average position of its projections.

There are two types of faces in the simplified B-rep after defeaturing, if all the tiny faces introduced by filling operations are merged with their neighbours. A real face corresponds to a face of the input model and has a unique continuous representation. It can be meshed in its intrinsic parametric space by a mapping-based mesher. However, a virtual face refers to a combination of faces and has no intrinsic parametric space, and the mapping-based mesher cannot be applied directly [27–29]. Therefore, an indirect approach is adopted, which meshes the discrete model of the virtual face first, and then project mesh points onto the continuous model.

The discrete model of a virtual face is represented by a group of triangular facets. By computing an average vector of all normal vectors of these facets, a parametric plane is determined perpendicular to this average normal vector. The mesh is firstly generated on the parametric plane. Its interior points are then projected onto the discrete model, and finally projected onto the continuous model if possible. Fig. 11
                            illustrates the projection procedure. A parametric mesh point 
                              
                                 
                                    
                                       P
                                    
                                    
                                       ″
                                    
                                 
                              
                            is contained in a host facet 
                              
                                 
                                    
                                       F
                                    
                                    
                                       ″
                                    
                                 
                              
                           . 
                              
                                 
                                    
                                       P
                                    
                                    
                                       ′
                                    
                                 
                              
                            is the projection of 
                              
                                 
                                    
                                       P
                                    
                                    
                                       ″
                                    
                                 
                              
                            on the discrete model, contained by a facet 
                              
                                 
                                    
                                       F
                                    
                                    
                                       ′
                                    
                                 
                              
                           . Here, 
                              
                                 
                                    
                                       F
                                    
                                    
                                       ″
                                    
                                 
                              
                            is the projection of 
                              
                                 
                                    
                                       F
                                    
                                    
                                       ′
                                    
                                 
                              
                            on the parametric plane. Assuming that the area coordinates of 
                              
                                 
                                    
                                       P
                                    
                                    
                                       ′
                                    
                                 
                              
                            in 
                              
                                 
                                    
                                       F
                                    
                                    
                                       ′
                                    
                                 
                              
                            and 
                              
                                 
                                    
                                       P
                                    
                                    
                                       ″
                                    
                                 
                              
                            in 
                              
                                 
                                    
                                       F
                                    
                                    
                                       ″
                                    
                                 
                              
                            are equal, we can interpolate the position of 
                              
                                 
                                    
                                       P
                                    
                                    
                                       ′
                                    
                                 
                              
                            using three vertices of 
                              
                                 
                                    
                                       F
                                    
                                    
                                       ′
                                    
                                 
                              
                           . If 
                              
                                 
                                    
                                       F
                                    
                                    
                                       ′
                                    
                                 
                              
                            is classified on a real face 
                              
                                 
                                    
                                       F
                                    
                                    
                                       i
                                    
                                 
                              
                            referred by 
                              
                                 F
                              
                           , the final position 
                              
                                 P
                              
                            is the projection of 
                              
                                 
                                    
                                       P
                                    
                                    
                                       ′
                                    
                                 
                              
                            on 
                              
                                 
                                    
                                       F
                                    
                                    
                                       i
                                    
                                 
                              
                           .

To rectify the mesh validity and quality issue due to projection distortion, the following strategies are adopted:
                              
                                 (1)
                                 A small geometry tolerance is given when tessellating the input continuous model so that the discrete model is close enough to the input model.

Flatness of a virtual face is considered when defeaturing so that the parameterisation approach for the discrete model does not induce too large projection distortion between the parametric plane and the discrete model.

A Riemann metric tool is employed when generating the mesh on the parametric plane.

@&#RESULTS@&#

The proposed surface repairing, defeaturing and meshing algorithms have been implemented and tested on many examples. Fig. 12
                      presents some results by employing these algorithms on a mechanical part model. Fig. 12a and b show the continuous input model and its discrete counterpart, respectively. As shown in Fig. 12a, small gaps and overlaps exist in the input model. After tessellating the model to a discrete one, these errors are inherited, as shown in the left of Fig. 12b. The extended B-rep records both the continuous and discrete models. Moreover, the mappings of the B-rep and the discrete model are initialised and recorded. To tackle the geometry errors, the discrete model is repaired first. The result is shown in the right of Fig. 12b, where the errors of the discrete model are resolved. Different with the algorithm proposed by Patel et al. [15,16], where the repaired discrete model is sent to a surface mesher directly, our algorithm continues to repair the B-rep. The left of Fig. 12c illustrates the repaired B-rep, where the boundary curves of all faces are rendered. The repaired model can be directly sent to the meshing procedure presented in Algorithm 4 to get a conformal surface mesh, as shown in the left of Fig. 12d. However, the repaired model contains many features, including those defined on the input model and those introduced by the repairing algorithm. The left of Fig. 12d reveals the mesh details on a narrow face introduced by filling operations, where highly stretched elements are generated because the local proximity distance is far smaller than mesh sizes.

To address this issue, the B-rep is defeatured before meshing. The right of Fig. 12c renders the wireframe of the defeatured model. After defeaturing, the number of faces decreases from 104 to 26. More importantly, the quality of the mesh generated on the defeatured model is much better. For instance, the small face shown in the left of Fig. 12d is merged with its neighbours after defeaturing, which improves local element shapes, as shown in the right of Fig. 12d.

Note that the size maps for the two meshes shown in Fig. 12d are similar. Therefore, the element numbers of these two meshes are very close, containing 3327 and 3192 elements, respectively. Table 1
                      compares the quality of the two meshes. If the minimal interior angle (α) of an element is less than 30°, the element is identified as low-quality. The mesh without model defeaturing contains 250 low-quality elements, about 7.5% of the total elements. The minimal and maximal interior angles (α
                     min and α
                     max) of all elements are 0.01° and 176.5°, respectively; the average angle of all α values (α
                     ave) is 47.5°. With model defeaturing, all indices are improved remarkably. The mesh contains only 35 low-quality elements, about 1.1% of the total number; α
                     min, α
                     max and α
                     ave are improved to 13.4°, 143.2° and 52.2°, respectively.


                     Fig. 13
                      presents the results for a flying minnow model, which was also used by Patel et al. [15,16] to demonstrate their repairing algorithm for discrete models. The input model is supposed to be closed. However, many boundary edges are detected on the initial discrete model, which are painted in thick lines in the left of Fig. 13b. After repairing, no boundary edges are detected, as shown in the right of Fig. 13b. This means that the repaired discrete model is conformal and watertight. Besides, the initial and defeatured models and the meshes on both models are compared in Fig. 13c and d, respectively. Table 1 lists the quality data of the two meshes. With model defeaturing, remarkable improvement are observed as well. The mesh of the initial model contains 679 low-quality elements, about 3.85% of the total number. α
                     min, α
                     max and α
                     ave are 0.93°, 47.9° and 169.4°, respectively. With model defeaturing, the mesh contains only 321 low-quality elements, about 1.93% of the total number; α
                     min, α
                     max and α
                     ave are improved to 12.1°, 49.5° and 138.5°, respectively.

In addition, Fig. 13e enlarges some local mesh details. In the initial model, 
                        
                           
                              
                                 G
                              
                              
                                 1
                              
                              
                                 1
                              
                           
                        
                      and 
                        
                           
                              
                                 G
                              
                              
                                 2
                              
                              
                                 1
                              
                           
                        
                      are boundary curves of a tiny face 
                        
                           
                              
                                 G
                              
                              
                                 2
                              
                              
                                 2
                              
                           
                        
                     . Besides the proximity feature between these two curves, small angles are defined on the corners where the curves meet. After defeaturing, these features are removed, and as a result the element quality is improved significantly.

Finally, given a CRH (China Railway High-speed) train model (Fig. 14
                     a), three different meshing approaches are compared.
                        
                           (1)
                           The proposed approach first repairs simultaneously the tessellated model and the B-rep and then simplifies the repaired B-rep through virtual face combination. The final mesh is generated on the simplified B-rep and the mesh points are projected back to the continuous input geometry.

The second approach is adopted by many commercial tools [10]. It first repairs directly the gaps of the input model by redefining the curves and surfaces in the neighbourhood and then defeatures the repaired model through real face combination. The continuous geometry is modified in both steps and the final mesh is generated on this modified geometry.

The third approach repairs the tessellated model by using the algorithm proposed by Patel et al. [15,16], and then meshes the repaired discrete model [27]. Because the B-rep of the input model is lost after tessellation, the meshing procedure needs to rebuild the geometry features of the discrete model. With these feature edges and some other mesh edges, the discrete model is subdivided into many meshable patches.

To facilitate the comparison, the defeatured model in the second approach has the same B-rep structure as that in the first approach. Meanwhile, an equal element size value (i.e., 0.15) is used in the three meshing approaches to ensure the meshes have nearly similar element numbers.


                     Fig. 14b enlarges a geometric error of the input CAD model and its repairing result using the second approach. This error is inherited after tessellation, and both the first and third approaches need to repair this error in the discrete model. Fig. 14c enlarges the inherited error and its repairing result.

Both the first and second approaches obtain a valid B-rep after repairing, and need to simplify this B-rep by combining neighbouring faces. Differently, the first approach modifies only the topology using virtual operations while the second approach modifies both topology and geometry using real operations. Fig. 15
                     a and b render the simplified B-rep on the continuous and discrete models, respectively. However, the third approach does not output a valid B-rep after repairing and cannot employ the B-rep based defeaturing algorithm.


                     Fig. 16
                      presents the surface meshes generated through different approaches. Both meshes output by the first and the second approaches respect the simplified B-rep. Meanwhile, the first approach does not modify the continuous geometry in the repairing and defeaturing steps; therefore, the mesh points are located on the input CAD model exactly. In contrast, the mesh points output by the second approach are located on a modified CAD model. Different with the first and second approaches, the third approach generates the mesh on the discrete model directly. The mesh it outputs does not respect the simplified B-rep, and many mesh lines cross over the boundary curves, as shown in Fig. 16c.

Although the element shapes of the three meshes shown in Fig. 16 are all qualified for downstream volume meshing and numerical simulations, the quality data of the three meshes in terms of the geometry accuracy are quite different, which may have a significant impact on the simulation accuracy. Here, two scalar variables are calculated to evaluate the geometry accuracy of a surface mesh. They are respectively named as the node distance and element distance, evaluating how far a node or an element of the mesh deviates from the continuous input model. The node distance is the minimal value of the distances between a node and different surface patches of the input model, and the element distance is approximated by the maximal values of the node distances of the forming points and centroid point of an element.

The node distances are mainly determined by how far the geometry on which the surface mesh is generated deviates from the input geometry. The proposed approach ensures the mesh points are loyal to the input geometry; therefore, all node distances are zero. However, the second approach modifies the input geometry in both repairing and defeaturing steps. As a result, nonzero node distances exist in the region where the geometry is modified, and the maximal node distance is 0.075. The third approach generates the mesh on the repaired discrete model. The node distance sources from both the tessellation and repairing steps, and its maximal value is 0.16. Compared to the average length of mesh edges (about 0.15), the node distances of the meshes output by the second and third approaches are clearly noticeable, as presented in Fig. 17
                     a and b.

The mesh elements of a curved surface deviate from the surface significantly even when the mesh nodes are exactly located on the surface. For the proposed approach, the element distance mainly depends on the element size and surface curvature. However, for the other two approaches, the element distance is also impacted by the node distance. Fig. 18
                     b–d present the colour maps of the element distance for the three meshes shown in Fig. 16. To highlight the difference, the head part of the train is enlarged for comparison, and the values represented by the colour legends are clipped into [0,0.06].

Because a uniform mesh size is specified, the variation of the element distance for the mesh output by the proposed approach is mainly related to the surface curvature. Fig. 18a renders a colour map for the surface curvature, where a curvature value is defined for each element, and this value is approximated by the average value of the curvatures of the three forming points of the element. To improve the geometry fidelity of this mesh further, adaptive meshing techniques [30] can be employed to set small element sizes at high curvature regions, or curved elements instead of planar elements can be used to compose the mesh [31].


                     Fig. 19
                      compares the distributions of element distance for the three meshes. Because planar elements always deviate from curved surfaces due to the surface curvature, the elements deviating from the input geometry by less than 0.01 are excluded from the comparison to highlight the difference of the three approaches. It is evident that the mesh output by the third approach deviates from the input geometry most, where the maximum element distance is 0.16, and about 64.1% elements deviate from the input geometry by more than 0.01. This also explains why many simulations that require meshes with high geometry fidelity do not adopt the meshes defined on discrete models as inputs. The second approach defines the mesh on the modified CAD model and improves the geometry accuracy of the output mesh remarkably, where the maximum element distance is 0.081, and about 16.0% elements deviate from the input geometry by more than 0.01. Not surprisingly, the proposed approach outputs the best mesh in terms of the geometry accuracy, where the maximum element distance is reduced to 0.0302, and only about 0.5% elements deviate from the input geometry by more than 0.01.

@&#CONCLUSIONS@&#

A new data structure named hybrid surface B-rep is proposed to represent a composite surface model. In this extended B-rep, each topology entity has a dual geometric representation in default, i.e., a continuous representation and its discrete counterpart. The inclusion of dual geometry data enables a sequence of repairing, defeaturing and meshing algorithms for an input CAD model with small gaps and overlaps on its surface boundaries. The continuous input geometry remains untouched in the entire process, and the output mesh is loyal to the input model. This feature is desirable in many simulations that require meshes with high geometry fidelity. Meanwhile, most geometry computations are defined on the discrete model in the proposed approach, avoiding their tedious, expensive and unreliable counterparts defined on the continuous model.

@&#ACKNOWLEDGEMENTS@&#

The authors would like to thank the support from the National Natural Science Foundation of China (Grant Nos. 11172267, 11432013, 10872182 and 11272285), Zhejiang Provincial Natural Science Foundation of China (Grant No. Y1110038) and High Performance Computing Wales. The first author acknowledges the joint support from Zhejiang University and China Scholarship Council and the host of Professor Oubay Hassan and Professor Kenneth Morgan for his visiting research at Swansea University, UK.

@&#REFERENCES@&#

