@&#MAIN-TITLE@&#Motion-capture-based walking simulation of digital human adapted to laser-scanned 3D as-is environments for accessibility evaluation

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           An adaptive walking simulation algorithm of the digital human was developed.


                        
                        
                           
                           The environment models are automatically generated from laser-scanned point clouds.


                        
                        
                           
                           A digital human can walk autonomously in various as-built environment models.


                        
                        
                           
                           Simulated walking motion of the digital human is similar to one of real human.


                        
                        
                           
                           Elapsed time of modeling and simulation is short enough for practical application.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Digital human model

Walking simulation

Laser-scanning

Accessibility evaluation

Motion-capture

Human behavior simulation

@&#ABSTRACT@&#


               
               
                  Owing to our rapidly aging society, accessibility evaluation to enhance the ease and safety of access to indoor and outdoor environments for the elderly and disabled is increasing in importance. Accessibility must be assessed not only from the general standard aspect but also in terms of physical and cognitive friendliness for users of different ages, genders, and abilities. Meanwhile, human behavior simulation has been progressing in the areas of crowd behavior analysis and emergency evacuation planning. However, in human behavior simulation, environment models represent only “as-planned” situations. In addition, a pedestrian model cannot generate the detailed articulated movements of various people of different ages and genders in the simulation. Therefore, the final goal of this research was to develop a virtual accessibility evaluation by combining realistic human behavior simulation using a digital human model (DHM) with “as-is” environment models. To achieve this goal, we developed an algorithm for generating human-like DHM walking motions, adapting its strides, turning angles, and footprints to laser-scanned 3D as-is environments including slopes and stairs. The DHM motion was generated based only on a motion-capture (MoCap) data for flat walking. Our implementation constructed as-is 3D environment models from laser-scanned point clouds of real environments and enabled a DHM to walk autonomously in various environment models. The difference in joint angles between the DHM and MoCap data was evaluated. Demonstrations of our environment modeling and walking simulation in indoor and outdoor environments including corridors, slopes, and stairs are illustrated in this study.
               
            

@&#INTRODUCTION@&#

Owing to our rapidly aging society, accessibility evaluation to enhance the ease and safety of access to indoor and outdoor environments for the elderly and disabled is increasing in importance. In the International Organization for Standardization (ISO) 21452, “accessibility” is defined as “provision of buildings or parts of buildings for people, regardless of disability, age or gender, to be able to gain access to them, into them, to use them and exit from them” [1]. Accessibility must be assessed not only from the general standard aspect specified in ISO 21542 [1] but also in terms of physical and cognitive friendliness for users of different ages, genders, and abilities, as recommended in ISO/IEC Guide 71 [2]. An example of the former is dimensional criteria such as corridor width and slope angle, which can be evaluated only by taking account of the shape of the environment. Physical and Cognitive friendliness involves more human-centered criteria, such as tripping risk and ease of wayfinding, which can be evaluated by taking account of both human movement and the environment.

Conversely, human behavior simulation has been progressing recently in the areas of crowd behavior analysis and emergency evacuation planning [3], and there is a high possibility that the simulation can be applied to accessibility evaluation. In human behavior simulation, the activities of a pedestrian model can be predicted in 2D indoor and outdoor environment models [4]. Moreover, human behavior simulation using kinematic digital human models (DHMs) even in a 3D environment model has become possible because of recent advances in computer performance [5].

However, in previous human behavior simulations [3–5], environment models represent only “as-planned” situations, in contrast to “as-is” environments. Furthermore, in the simulation, a pedestrian model cannot generate the detailed articulated movements of various groups of people including the elderly, children, males, and females. In contrast to an “as-planned” environment, an “as-is” environment exhibits the following characteristics:
                        
                           –
                           It represents the current environment correctly.

It includes extra objects which were placed in the environment after building construction (e.g., furniture, dust bins, and fire extinguishers).

It includes small barriers and obstacles on the floor that were ignored in the CAD data.

The presence of extra objects, small barriers, and small obstacles strongly affects the accessibility of an environment. Basing the accessibility evaluation on really existing facilities is therefore important. However, 2D or 3D CAD data of the existing state of the facility are not always available. In this situation, we have to construct the 3D environment model manually by measuring the environment. This is labor-intensive and tedious, and the constructed environment model is sometimes inaccurate. Using an as-is environment model, which is automatically constructed from the laser-scanned point clouds, therefore offers advantages in terms of both cost and accuracy.

Accessibility evaluation based on an as-is environment model is also easily applied to as-planned environments by converting the 3D mesh or solid model to dense point clouds. Therefore, accessibility evaluation systems using as-is environment models have a wide range of applications. For these reasons, the as-is environment model is superior for accessibility evaluation of a current environment.

Considering this background, the final goal of our research was to develop a virtual accessibility evaluation by combining realistic human behavior simulation using DHMs with “as-is” environment models. As shown in 
                     Fig. 1, our research group has already developed a prototype system of environment modeling and basic walking simulation for a DHM to achieve the first step of this goal [6]. In this system, the walking simulation algorithm used only single reference motion-capture (MoCap) data for flat walking and enabled a DHM to walk autonomously in as-is and flat indoor environments while adapting its strides and turning angles accordingly. However, the algorithm does not allow the DHM to walk on non-flat terrain surfaces such as slopes and stairs.

Therefore, in this research, we develop an algorithm that enables a DHM to walk autonomously even on the non-flat terrain of as-is indoor and outdoor environments. The strides, turning angles and footprints of the DHM can be adapted to different laser-scanned environment models including corridors, slopes, and stairs. In the algorithm, first, a flat walking motion of the DHM is generated using our previous algorithm [6] based on single reference MoCap data for flat walking. Then, the pelvis and swing ankle joint positions during flat walking are changed to adapt to walking on the non-flat terrain by increasing or decreasing the positions based on our analysis of a preliminary experiment, in which real human walking motions in various environments were measured using a MoCap system. Finally, all the joint angles are determined by analytically solving inverse kinematics (IK) to achieve the adapted pelvis and swing ankle joint positions.

Moreover, we develop an algorithm that extracts a stair tread boundary for enabling the DHM to walk on stairs while estimating suitable footprints on the treads. Demonstrations of our environment modeling and walking simulation in indoor and outdoor environments including corridors, slopes and stairs are illustrated. Modeling and simulation efficiency and accuracy are also evaluated.

The rest of this paper is organized as follows. In Section 2, related work of the research is introduced and our contributions are clarified. In Section 3, the 3D environmental modeling algorithm for the human behavior simulation is described. In Section 4, the preliminary experiment and the MoCap-based adaptive walking simulation algorithm is described in detail. Finally, the demonstrations, efficiency, and accuracy of the environmental modeling and walking simulation are shown in Section 5.

@&#RELATED WORK@&#

This research primarily relates to three areas: human behavior simulation, 3D environment modeling from laser-scanned point clouds, and digital human modeling for walking simulation. Human behavior simulation must deal with the interactions between the pedestrian models and the environment models, for example in navigation and footprint estimation. In addition, the presence of extra objects, small barriers, and small obstacles, which are included in an “as-is” environment model, strongly affects accessibility evaluations based on human behavior simulation. For these reasons, in Section 2.1, the previous work on human behavior simulation is summarized with reference to the type of environment modeling and representation used (i.e., as-is or as-planned). Conversely, the previous work on walking simulation in Section 2.3 is summarized without reference to the type of environment modeling and representation used.

In human behavior simulation, studies have been conducted on crowd behavior analysis and emergency evacuation planning [3,4]. Many different methods exist for pedestrian simulation, such as social forces [7] and cellular automata [8], as reviewed by Duives et al. [4]. However, these simulation algorithms are in 2D environments, and precise 3D simulation in as-is environment models is basically unfeasible. Recently, an evacuation-planning simulator that enables kinematics-based walking simulation in a 3D environment model was proposed by Kakizaki et al. [5]. However, their work used only “as-planned” CAD data of a building as the environment model. In addition, the pedestrian model cannot generate the detailed articulated movements of various groups of people including the elderly, children, males, and females. This is because the generation of pedestrian motion is based only on solving IK without the measurement data of a real human. On the other hand, as in the simulation by Pettre et al. [9], a navigation graph representing free space and environmental connectivity can be generated automatically from a 3D mesh model. In their research, the walking path of each pedestrian model is automatically selected by specifying start and goal points on the navigation graph. Each pedestrian model can then walk automatically along the path. However, in their study, there is no discussion as to whether the 3D mesh model was as-is or as-planned. Additionally, they used a simple-shaped 3D mesh model, which is too rough to capture the detail of an as-is environment.

In contrast to these studies, our proposed human behavior simulation focuses on generating detailed articulated movements of a DHM in 3D “as-is” environment models using novel laser-scanning technology. Furthermore, to achieve reliable accessibility evaluation based on human behavior simulation, our proposed human behavior simulation integrates the following technologies:
                           
                              –
                              Automatic construction of an “as-is” environment model from the laser-scanned point clouds, which is used for the simulation.

Automatic estimation of the walking path, walking trajectory, and footprints of the DHM in the as-is environment.

Adaptation of the flat walking motion of various people of different ages, genders, and body dimensions to various as-is walking environments, including stairs and slopes.

3D as-is environment modeling from massive laser-scanned point clouds has been actively studied. The goal of these studies was to automatically reconstruct indoor environments [10] and extract semantic objects such as floors, walls and ceilings [11,12], household goods [13], and a constructive solid geometry model of environments [14] from massive laser-scanned point clouds. Existing algorithms and related techniques have been reviewed in the literature [15]. However, these studies focus on general object recognition for environmental modeling and do not necessarily aim for human-like walking navigation in the environment models. Moreover, these algorithms neglect to model small barriers and obstacles on a floor as part of the environment model, which is an important element for accessibility evaluation.

In contrast to these studies, our environment model, which is automatically constructed from laser-scanned point clouds, can represent walk surfaces that include small barriers, obstacles, and navigation information for the human behavior simulation required for accessibility evaluation.

Many algorithms have been developed in digital human modeling for walking simulation. Among them, a variety of human walking patterns can be synthesized using PCA [16]. Although such simulation systems can generate human-like walking motion, they still require a large collection of MoCap data in advance. Therefore, many researchers tackle generating an arbitrary human motion from only a small number of existing MoCap data. Motion synthesis and editing [17], motion rings [18], and machine learning [19] are typical examples. They require a small number of MoCap data to adapt the DHM׳s strides, turning angles, and footprints to its walking environment models. However, it is generally difficult to persuade elderly persons, who are the main targets of accessibility evaluation, to join prolonged MoCap data collection experiments. Conversely, human-like walking motions have been generated in recent physics-based walking simulations using motion controllers and game-engines [20,
                        21]. The review literature also summarizes a physics-based walking simulation [22]. However, the naturalness of a walking motion is sensitive to motion controller parameters, which are difficult to tune. In addition, Al-Asqhar et al. [23] proposed a motion-retargeting algorithm in which joint positions relative to the walking surface can be flexibly adapted even to dynamically changing walking terrains. However, in their study, the resultant motion is not validated. On the other hand, Reed et al. [24] introduced stair-ascending and stair-descending algorithms into a motion simulator called human motion simulation framework (HUMOSIM). HUMOSIM generates lower-limb motions based on behavior-based IK to achieve realistic motions. However, in their study, MoCap data collections are still required for solving behavior-based IK.

In contrast to these studies, our walking simulation algorithm
                           
                              –
                              Generates human-like walking motion even on non-flat walking terrain such as slopes and stairs, using only the single reference MoCap data for flat walking.

Adapts the strides, turning angles, and footprints of the DHM to different as-is environment models including corridors, slopes, and stairs, even on non-flat terrain.

Used the analysis of MoCap data from a real human subject, acquired in various walking environments including slopes and stairs.

Provides fast and autonomous walking simulation directly in the point cloud-based environment models including slopes and stairs.

Was validated by MoCap data of a real human acquired in non-flat walking terrain.

Provides a small difference in joint angles between the DHM and MoCap data.


                     
                     Fig. 2 shows an overview of the 3D environmental modeling and walking simulation of the DHM in our study. For the walking simulation of the DHM, first, a 3D environment model was constructed automatically from the 3D laser-scanned point clouds of the as-is environment [6].

As shown in the “Environmental modeling” section of Fig. 2, the 3D environment model consists of two point clouds 
                        
                           Q
                        
                      and 
                        
                           W
                        
                     , navigation graph 
                        
                           
                              G
                           
                           
                              N
                           
                        
                     , and tread boundary of staircase 
                        
                           
                              B
                           
                           
                              m
                              ,
                              n
                           
                        
                     , where 
                        
                           
                              B
                           
                           
                              m
                              ,
                              n
                           
                        
                      represents the boundary lines of the 
                        
                           n
                        
                     th stair step in the 
                        
                           m
                        
                     th stair. 
                        
                           Q
                           =
                        
                        
                           {
                           (
                        
                        
                           
                              q
                           
                           
                              i
                           
                        
                        
                           ,
                        
                        
                           
                              n
                           
                           
                              i
                           
                        
                        
                           )
                           }
                        
                      represents the down-sampled points with normal vectors, and 
                        
                           W
                        
                        
                           =
                           {
                        
                        
                           
                              W
                           
                           
                              k
                           
                        
                        
                           ⊂
                        
                        
                           Q
                        
                        
                           }
                        
                      is the set of walk surface points, where 
                        
                           
                              q
                           
                           
                              i
                           
                        
                      and 
                        
                           
                              n
                           
                           
                              i
                           
                        
                      represent a down-sampled point and a normal vector at 
                        
                           
                              q
                           
                           
                              i
                           
                        
                     , respectively.

In this study, we developed a novel algorithm for estimating the tread boundary of staircase 
                        
                           
                              B
                           
                           
                              m
                              ,
                              n
                           
                        
                     . The rest of this section is organized as follows. First, the algorithms of the environment modeling, which were already described in a previous paper [6], are briefly introduced in Sections 3.1, 3.2, and 3.3. Then, the details of the proposed algorithm for tread boundary estimation are described in Section 3.4.

Multiple laser-scanned point clouds are first merged to make one registered point cloud. This registered point clouds contain huge number of points; hence, it is down-sampled using a voxel grid. In this study, about 1000 points per square meter is sufficient for modeling and simulation. Normal vectors at the down-sampled points are then estimated using principal component analysis (PCA) on the local neighboring points [25]. These point clouds with normal vectors 
                           
                              Q
                              =
                           
                           
                              {
                              (
                           
                           
                              
                                 q
                              
                              
                                 i
                              
                           
                           
                              ,
                           
                           
                              
                                 n
                              
                              
                                 i
                              
                           
                           
                              )
                              }
                           
                         are used as a part of the 3D environment model to express the geometry of the entire environment [6].

The set of walk surface points representing walkable surfaces such as floors and stair steps is automatically extracted from the down-sampled points 
                           
                              Q
                           
                         
                        [6].

First, if the angle between a normal vector 
                           
                              
                                 n
                              
                              
                                 i
                              
                           
                         at a point 
                           
                              
                                 q
                              
                              
                                 i
                              
                           
                         and a vertical vector 
                           
                              v
                           
                           
                              =
                              [
                              0
                              ,
                              0
                              ,
                              +
                              1
                              ]
                           
                         is smaller than the threshold 
                           
                              ε
                           
                         (we set 
                           
                              ε
                           
                        = 20°), then the point is added into horizontal points 
                           
                              
                                 
                                    Q
                                 
                                 
                                    H
                                 
                              
                              
                                 =
                                 {
                              
                              
                                 
                                    q
                                 
                                 
                                    jH
                                 
                              
                              
                                 }
                              
                           
                         located on a horizontal plane. Finally, the horizontal points 
                           
                              
                                 Q
                              
                              
                                 H
                              
                           
                         are clustered into a set of walk surface points 
                           
                              W
                           
                           
                              =
                              {
                           
                           
                              
                                 W
                              
                              
                                 k
                              
                           
                           
                              ⊂
                           
                           
                              
                                 Q
                              
                              
                                 H
                              
                           
                           
                              }
                           
                         using a region-growing algorithm based on a k-nearest search [6].

A navigation graph representing the environmental pathways for navigating the DHM during walking simulation is generated from walk surface points 
                           
                              
                                 
                                    W
                                 
                                 
                                    k
                                 
                              
                              
                                 ⊂
                                 W
                              
                           
                        . To generate a navigation graph from laser-scanned point clouds, we extend the algorithm of Pettre et al. [9], which generates a navigation graph from a simple-shaped 3D mesh model [6].

In our algorithm, the navigation graph is generated from the walk surface image 
                           
                              
                                 I
                              
                              
                                 k
                              
                           
                        , which is generated by projecting walk surface points 
                           
                              
                                 W
                              
                              
                                 k
                              
                           
                         onto a horizontal plane. As shown in 
                        Fig. 3(a), the navigation graph 
                           
                              
                                 
                                    G
                                 
                                 
                                    N
                                 
                              
                              
                                 =
                              
                              
                                 〈
                                 
                                    
                                       V
                                       ,
                                       E
                                       ,
                                       c
                                       ,
                                    
                                    
                                       t
                                    
                                 
                                 〉
                              
                           
                         comprises a set of graph nodes 
                           
                              V
                           
                         and a set of edges 
                           
                              E
                           
                        . Each node 
                           
                              
                                 
                                    v
                                 
                                 
                                    k
                                 
                              
                              
                                 ∈
                                 V
                              
                           
                         represents free space in the environment and is generated on a medial pixel obtained from the image 
                           
                              
                                 I
                              
                              
                                 k
                              
                           
                        . Each has a position vector 
                           
                              t
                           
                           
                              (
                           
                           
                              
                                 v
                              
                              
                                 k
                              
                           
                           
                              )
                           
                         and the attributes of a cylinder 
                           
                              c
                           
                           
                              (
                           
                           
                              
                                 v
                              
                              
                                 k
                              
                           
                           
                              )
                           
                        , whose radius 
                           
                              r
                           
                           
                              (
                           
                           
                              
                                 v
                              
                              
                                 k
                              
                           
                           
                              )
                           
                         and height 
                           
                              
                                 h
                              
                              
                                 v
                              
                           
                         represent the distance to the wall and walkable step height, respectively. Each edge 
                           
                              
                                 e
                              
                              
                                 k
                              
                           
                         represents the connectivity of the environment and is generated between two adjacent nodes with a common region [6].

The down-sampled points 
                           
                              Q
                           
                        , walk surface points 
                           
                              W
                           
                        , and navigation graph 
                           
                              
                                 G
                              
                              
                                 N
                              
                           
                         were also used in our previous walking simulation [6]. In this study, the tread boundary 
                           
                              
                                 B
                              
                              
                                 m
                                 ,
                                 n
                              
                           
                         is newly estimated as part of the 3D environment model for the walking simulation on stairs. Details are described in the following subsection.

The tread boundary estimation is an essential function in realizing autonomous walking simulation of a DHM. This is especially true in indoor environments including stairs since the original point clouds do not contain any semantic information about the environment. The tread boundary 
                           
                              
                                 B
                              
                              
                                 m
                                 ,
                                 n
                              
                           
                         is estimated from walk surface points 
                           
                              
                                 
                                    W
                                 
                                 
                                    k
                                 
                              
                              
                                 ⊂
                                 W
                              
                           
                         for estimating suitable footprints of the DHM and avoiding swing foot collisions with treads when the DHM walks on stairs, where 
                           
                              
                                 B
                              
                              
                                 m
                                 ,
                                 n
                              
                           
                         represents the boundary lines of the 
                           
                              n
                           
                        th stair step in the 
                           
                              m
                           
                        th stair. In our algorithm, the tread boundary was estimated from the walk surface points 
                           
                              
                                 W
                              
                              
                                 k
                              
                           
                         which were extracted by a region-growing algorithm based on the normal vectors of each point, as described in Section 3.2. These normal vectors were estimated by PCA. However, the normal vector at a point located near the actual boundary of a stair tread is often tilted toward the neighboring region due to the nature of PCA. As a result, the extracted walk surface points 
                           
                              
                                 W
                              
                              
                                 k
                              
                           
                         of a stair tread will often miss the point clouds near the actual tread boundaries. Therefore, in our algorithm, the point clouds on the actual tread boundary of stairs are first extracted at high speed and with high precision using a neighboring search algorithm. The actual tread boundary is estimated using these points. The details of the algorithm are given below.

As shown in Fig. 3(b), first, a convex hull 
                           
                              
                                 H
                              
                              
                                 m
                                 ,
                                 n
                              
                           
                         is generated from the walk surface points 
                           
                              
                                 W
                              
                              
                                 m
                                 ,
                                 n
                              
                           
                        , where 
                           
                              
                                 W
                              
                              
                                 m
                                 ,
                                 n
                              
                           
                         represents the walk surface points of the 
                           
                              n
                           
                        th stair step in the 
                           
                              m
                           
                        th stair. In the figure, 
                           
                              
                                 p
                              
                              
                                 k
                              
                           
                         represents the 
                           
                              k
                           
                        th vertex of 
                           
                              
                                 H
                              
                              
                                 m
                                 ,
                                 n
                              
                           
                        . Then, a set of neighboring points 
                           
                              
                                 N
                              
                              
                                 k
                              
                           
                         of 
                           
                              
                                 p
                              
                              
                                 k
                              
                           
                         is extracted from 
                           
                              Q
                           
                         using a k-dimensional tree [25] to exactly extract the entire set of points of the 
                           
                              n
                           
                        th stair step. These points 
                           
                              
                                 
                                    p
                                 
                                 
                                    u
                                 
                              
                              
                                 ⊂
                              
                              
                                 
                                    N
                                 
                                 
                                    k
                                 
                              
                           
                         are inserted into 
                           
                              
                                 W
                              
                              
                                 m
                                 ,
                                 n
                              
                           
                        . Finally, as shown in Fig. 3(b), the tread boundary 
                           
                              
                                 B
                              
                              
                                 m
                                 ,
                                 n
                              
                           
                         is constructed as a convex hull of 
                           
                              
                                 W
                              
                              
                                 m
                                 ,
                                 n
                              
                           
                        . In this research, the Ramer Douglas Peucker algorithm [26] is applied to 
                           
                              
                                 B
                              
                              
                                 m
                                 ,
                                 n
                              
                           
                         in order to reduce the number of vertices in 
                           
                              
                                 B
                              
                              
                                 m
                                 ,
                                 n
                              
                           
                        .

After environmental modeling, a walking simulation of the DHM was performed directly in the point clouds-based environment models. As shown in the “walking simulation” section of Fig. 2, to generate human-like walking motion, we could select and use only single reference MoCap data for flat walking from the gait database (DB) containing the data of 139 subjects provided by the DHRC [29]. As shown in 
                     Fig. 4, our DHM has 41 degrees of freedom (DOF) in total and the same body dimensions as the subjects in the gait DB.

As shown in Fig. 2, the walking simulation consists both of macro- and micro-level simulations. The macro-level simulation computes the macro-level behavior of the DHM, including the walking path and walking trajectory of the DHM during the simulation. In contrast, the micro-level simulation computes the micro-level behavior of the DHM, including the joint-level synthesis of the DHM during one-step walking. In addition, a preliminary experiment is conducted to construct our simulation algorithm and to validate resultant walking motion of the DHM. Details are given in the following subsections.

We conducted a preliminary experiment to discover the differences in real human walking motion between various walking environments in cooperation with the Digital Human Research Center (DHRC) of the National Institute of Advanced Industrial Science and Technology (AIST). As shown in 
                        Fig. 5, we acquired MoCap data of human walking motion on a flat terrain, 3-deg slope, 6-deg slope, and stairs using a MoCap system (Vicon MX system and Vicon Nexus [27]) for three male subjects (All subjects are 23 years old). These MoCap data were analyzed using commercial software (Visual 3D [28]) to obtain the joint angles of the subject during walking. These data and acquired knowledge were used to design our walking simulation algorithm and validate the DHM walking motion. In particular, these data were used in the following processes:
                           
                              –
                              As described in Section 4.3.3, the swing ankle trajectory of the DHM is adapted to non-flat walking terrain using a cubic curve, which was modeled on our analysis of the preliminary experiment.

As described in Section 4.3.5, the swing ankle trajectory of the DHM is modified to avoid collisions with stairs based on a cubic spline interpolation, again modeled on our analysis of the preliminary experiment.

As described in Section 5.3, the simulated walking motion was validated by comparing the knee and hip joint angles of the DHM with the MoCap data on actual human motion.

As shown in 
                        Fig. 6(a), in the macro-level simulation, first, the user is asked to input start and goal positions as a start node 
                           
                              
                                 v
                              
                              
                                 s
                              
                           
                         and a goal node 
                           
                              
                                 v
                              
                              
                                 g
                              
                           
                        , respectively. Then, a set of DHM׳s walking paths 
                           
                              
                                 
                                    V
                                 
                                 
                                    W
                                 
                              
                              
                                 =
                                 {
                              
                              
                                 
                                    V
                                 
                                 
                                    i
                                 
                              
                              
                                 }
                              
                           
                         is found automatically using a depth-first search repeatedly over the navigation graph 
                           
                              
                                 G
                              
                              
                                 N
                              
                           
                        . Each path 
                           
                              
                                 V
                              
                              
                                 i
                              
                           
                         consists of a set of graph nodes and edges, which are connected from 
                           
                              
                                 v
                              
                              
                                 s
                              
                           
                         to 
                           
                              
                                 v
                              
                              
                                 g
                              
                           
                        . If multiple walking paths exist between 
                           
                              
                                 v
                              
                              
                                 s
                              
                           
                         and 
                           
                              
                                 v
                              
                              
                                 g
                              
                           
                        , all of them can be extracted. Then, one suitable walking path 
                           
                              
                                 
                                    V
                                 
                                 
                                    P
                                 
                              
                              
                                 ∈
                              
                              
                                 
                                    V
                                 
                                 
                                    W
                                 
                              
                           
                         is automatically selected from 
                           
                              
                                 V
                              
                              
                                 W
                              
                           
                         by using the equation
                           
                              (1)
                              
                                 
                                    P
                                 
                                 
                                    =
                                    arg
                                 
                                 
                                    
                                       min
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       (
                                    
                                    
                                       
                                          c
                                       
                                       
                                          i
                                       
                                    
                                    
                                       ·
                                    
                                    
                                       B
                                    
                                    
                                       )
                                    
                                 
                              
                           
                        where 
                           
                              B
                              =
                           
                           
                              [
                              
                                 
                                    
                                       β
                                    
                                    
                                       1
                                    
                                 
                                 
                                    ,
                                 
                                 
                                    
                                       β
                                    
                                    
                                       2
                                    
                                 
                              
                              ]
                           
                           
                              (
                           
                           
                              
                                 β
                              
                              
                                 k
                              
                           
                           
                              ∈
                           
                           
                              [
                              0
                              ,
                              1
                              ]
                           
                           
                              )
                           
                         and 
                           
                              
                                 
                                    c
                                 
                                 
                                    i
                                 
                              
                              
                                 =
                                 [
                              
                              
                                 
                                    d
                                 
                                 
                                    i
                                 
                              
                              
                                 ,
                              
                              
                                 
                                    b
                                 
                                 
                                    i
                                 
                              
                              
                                 ]
                              
                           
                         represent the user׳s path preference and path cost vector of the path 
                           
                              
                                 V
                              
                              
                                 i
                              
                           
                        . Each element 
                           
                              
                                 β
                              
                              
                                 k
                              
                           
                         specifies the degree of preference between the travel distance and the narrowness of the path. In the vector 
                           
                              
                                 c
                              
                              
                                 i
                              
                           
                        , 
                           
                              
                                 
                                    d
                                 
                                 
                                    i
                                 
                              
                              
                                 ∈
                              
                              
                                 [
                                 0
                                 ,
                                 1
                                 ]
                              
                           
                         and 
                           
                              
                                 
                                    b
                                 
                                 
                                    i
                                 
                              
                              
                                 ∈
                              
                              
                                 [
                                 0
                                 ,
                                 1
                                 ]
                              
                           
                         represent the normalized travel distance along 
                           
                              
                                 V
                              
                              
                                 i
                              
                           
                         and the normalized narrowness of 
                           
                              
                                 V
                              
                              
                                 i
                              
                           
                        , respectively. Each path cost vector 
                           
                              
                                 c
                              
                              
                                 i
                              
                           
                         is automatically estimated from each path 
                           
                              
                                 V
                              
                              
                                 i
                              
                           
                        .

Once the walking path 
                           
                              
                                 V
                              
                              
                                 P
                              
                           
                         has been determined, as shown in Fig. 6(b), DHM׳s walking trajectory 
                           
                              
                                 
                                    S
                                 
                                 
                                    O
                                 
                              
                              
                                 =
                                 {
                              
                              
                                 
                                    s
                                 
                                 
                                    i
                                 
                              
                              
                                 }
                              
                           
                         is generated automatically, where 
                           
                              
                                 S
                              
                              
                                 O
                              
                           
                         represents a sparsely discretized sequence of the DHM pelvis positions 
                           
                              
                                 s
                              
                              
                                 i
                              
                           
                         during the walking simulation. The trajectory 
                           
                              
                                 S
                              
                              
                                 O
                              
                           
                         is initialized as a sequence of the center points 
                           
                              
                                 
                                    s
                                 
                                 
                                    2
                                    k
                                 
                              
                              
                                 =
                              
                              
                                 t
                              
                              
                                 (
                                 
                                    
                                       
                                          v
                                       
                                       
                                          i
                                       
                                    
                                 
                                 )
                              
                              
                                 +
                              
                              
                                 
                                    h
                                 
                                 
                                    P
                                 
                              
                              
                                 Z
                              
                           
                         of each node 
                           
                              
                                 
                                    v
                                 
                                 
                                    i
                                 
                              
                              
                                 ∈
                              
                              
                                 
                                    V
                                 
                                 
                                    P
                                 
                              
                           
                         and interpolated points 
                           
                              
                                 
                                    s
                                 
                                 
                                    2
                                    k
                                    +
                                    1
                                 
                              
                              
                                 =
                              
                              
                                 I
                              
                              
                                 (
                              
                              
                                 
                                    v
                                 
                                 
                                    i
                                 
                              
                              
                                 ,
                              
                              
                                 
                                    v
                                 
                                 
                                    j
                                 
                              
                              
                                 )
                                 +
                              
                              
                                 
                                    h
                                 
                                 
                                    P
                                 
                              
                              
                                 Z
                              
                           
                        , where 
                           
                              I
                           
                           
                              (
                           
                           
                              
                                 v
                              
                              
                                 i
                              
                           
                           
                              ,
                           
                           
                              
                                 v
                              
                              
                                 j
                              
                           
                           
                              )
                           
                        , 
                           
                              
                                 h
                              
                              
                                 P
                              
                           
                        , and 
                           
                              Z
                              =
                           
                           
                              (
                              0,0
                              ,
                              +
                              1
                              )
                           
                         represent a point located at the centroid of the common region between two adjacent nodes 
                           
                              
                                 
                                    v
                                 
                                 
                                    i
                                 
                              
                              
                                 ,
                              
                              
                                 
                                    v
                                 
                                 
                                    j
                                 
                              
                              
                                 ∈
                              
                              
                                 
                                    V
                                 
                                 
                                    P
                                 
                              
                           
                        , a vertical distance between the heel and the pelvis of the selected DHM, and a vertical unit vector, respectively. Finally, an optimization algorithm is applied to make the trajectory 
                           
                              
                                 S
                              
                              
                                 O
                              
                           
                         more natural and smooth, while avoiding contact with the walls [6].

After the walking trajectory 
                           
                              
                                 S
                              
                              
                                 O
                              
                           
                         is determined, the one-step walking motion of the selected DHM is generated along the trajectory 
                           
                              
                                 S
                              
                              
                                 O
                              
                           
                         in the micro-level simulation.

The processes (A7-A12) in Fig. 2 show an overview of the walking simulation algorithm. In our algorithm, first, a next footprint 
                           
                              
                                 x
                              
                              
                                 f
                              
                           
                         is determined on the walk surface points 
                           
                              W
                           
                         (Fig. 2(A7)). Then, a virtual flat walking motion of the DHM is pre-generated using our previous algorithm [6] based on the single reference MoCap data for flat walking (Fig. 2(A8)). As a result, a pelvis position trajectory 
                           
                              
                                 
                                    f
                                 
                                 
                                    P
                                 
                              
                              
                                 (
                                 
                                    ϕ
                                 
                                 )
                              
                           
                         and an ankle position trajectory of a swing leg (hereafter, called swing ankle position trajectory) 
                           
                              
                                 
                                    f
                                 
                                 
                                    A
                                 
                              
                              
                                 (
                                 
                                    ϕ
                                 
                                 )
                              
                           
                         for one-step virtual flat walking are obtained, where 
                           
                              ϕ
                              ∈
                              [
                              0,1
                              ]
                           
                         is the normalized phase of one-step walking. Next, the trajectories 
                           
                              
                                 
                                    f
                                 
                                 
                                    P
                                 
                              
                              
                                 (
                                 
                                    ϕ
                                 
                                 )
                              
                           
                         and 
                           
                              
                                 
                                    f
                                 
                                 
                                    A
                                 
                              
                              
                                 (
                                 
                                    ϕ
                                 
                                 )
                              
                           
                         are adapted to the actual walking environment of the DHM (Fig. 2(A9)). Consequently, the adapted trajectories 
                           
                              
                                 
                                    f
                                 
                                 
                                    P
                                 
                                 
                                    ′
                                 
                              
                              
                                 (
                                 
                                    ϕ
                                 
                                 )
                              
                           
                         and 
                           
                              
                                 
                                    f
                                 
                                 
                                    A
                                 
                                 
                                    ′
                                 
                              
                              
                                 (
                                 
                                    ϕ
                                 
                                 )
                              
                           
                         are obtained. At the same time, the stance foot angle 
                           
                              
                                 
                                    θ
                                 
                                 
                                    E
                                 
                                 
                                    st
                                 
                              
                              
                                 (
                                 
                                    ϕ
                                 
                                 )
                              
                           
                         and swing foot angle 
                           
                              
                                 
                                    θ
                                 
                                 
                                    E
                                 
                                 
                                    sw
                                 
                              
                              
                                 (
                                 
                                    ϕ
                                 
                                 )
                              
                           
                         are interpolated based on the “elevation angle” representation of each foot (Fig. 2(A10)). After that, in the case of walking on stairs, a collision-free ankle position trajectory 
                           
                              
                                 
                                    f
                                 
                                 
                                    A
                                 
                                 
                                    ′
                                    ′
                                 
                              
                              
                                 (
                                 
                                    ϕ
                                 
                                 )
                              
                           
                        , which has no collisions with stairs, can be further obtained by modifying the adapted ankle trajectory 
                           
                              
                                 
                                    f
                                 
                                 
                                    A
                                 
                                 
                                    ′
                                 
                              
                              
                                 (
                                 
                                    ϕ
                                 
                                 )
                              
                           
                         (Fig. 2(A11)). By contrast, in the case of walking on other terrains, 
                           
                              
                                 
                                    f
                                 
                                 
                                    A
                                 
                                 
                                    ′
                                    ′
                                 
                              
                              
                                 (
                                 
                                    ϕ
                                 
                                 )
                              
                           
                         is directly copied from 
                           
                              
                                 
                                    f
                                 
                                 
                                    A
                                 
                                 
                                    ′
                                 
                              
                              
                                 (
                                 
                                    ϕ
                                 
                                 )
                              
                           
                        . Finally, the one-step motion of the DHM is generated based on the adapted pelvis trajectory 
                           
                              
                                 
                                    f
                                 
                                 
                                    P
                                 
                                 
                                    ′
                                 
                              
                              
                                 (
                                 
                                    ϕ
                                 
                                 )
                              
                           
                        , swing ankle trajectory 
                           
                              
                                 
                                    f
                                 
                                 
                                    A
                                 
                                 
                                    ′
                                    ′
                                 
                              
                              
                                 (
                                 
                                    ϕ
                                 
                                 )
                              
                           
                        , and interpolated elevation angles 
                           
                              
                                 
                                    θ
                                 
                                 
                                    E
                                 
                                 
                                    st
                                 
                              
                              
                                 (
                                 
                                    ϕ
                                 
                                 )
                              
                           
                         and 
                           
                              
                                 
                                    θ
                                 
                                 
                                    E
                                 
                                 
                                    sw
                                 
                              
                              
                                 (
                                 
                                    ϕ
                                 
                                 )
                              
                           
                         using IK (Fig. 2(A12)). Details are given in the following subsections:

As shown in 
                           Fig. 7, when the DHM passes through a point on the trajectory 
                              
                                 
                                    
                                       s
                                    
                                    
                                       k
                                    
                                 
                                 
                                    ∈
                                 
                                 
                                    
                                       S
                                    
                                    
                                       O
                                    
                                 
                              
                           , the system sets a next subgoal position 
                              
                                 
                                    x
                                 
                                 
                                    t
                                 
                              
                            as 
                              
                                 
                                    
                                       x
                                    
                                    
                                       t
                                    
                                 
                                 
                                    =
                                 
                                 
                                    
                                       s
                                    
                                    
                                       k
                                       +
                                       2
                                    
                                 
                              
                           , which serves as a temporal target position during the simulation. The subgoal position 
                              
                                 
                                    x
                                 
                                 
                                    t
                                 
                              
                            is continuously updated as the DHM walks along the trajectory 
                              
                                 
                                    S
                                 
                                 
                                    O
                                 
                              
                           . Then, as shown in the figure, the next locomotion vector 
                              
                                 v
                              
                            is determined as 
                              
                                 v
                                 =
                              
                              
                                 (
                                 
                                    
                                       
                                          x
                                       
                                       
                                          t
                                       
                                    
                                    
                                       −
                                    
                                    
                                       
                                          x
                                       
                                       
                                          c
                                       
                                    
                                 
                                 )
                              
                              
                                 /
                              
                              
                                 ‖
                                 
                                    
                                       
                                          x
                                       
                                       
                                          t
                                       
                                    
                                    
                                       −
                                    
                                    
                                       
                                          x
                                       
                                       
                                          c
                                       
                                    
                                 
                                 ‖
                              
                           , where 
                              
                                 
                                    x
                                 
                                 
                                    c
                                 
                              
                            represents the current pelvis position of the DHM.

After that, as shown in 
                           Fig. 8, the next footprint point 
                              
                                 
                                    x
                                 
                                 
                                    f
                                 
                              
                           , which represents a heel placement of the swing leg, is determined on the set of walk surface points 
                              
                                 W
                              
                           . The following algorithms are executed to locate 
                              
                                 
                                    x
                                 
                                 
                                    f
                                 
                              
                            on different terrains: staircase treads and others such as flat, sloping or bumpy terrain.

As shown in Fig. 8(a), in the case of walking on a flat, sloping or bumpy terrain, a cylindrical search space 
                              
                                 
                                    C
                                 
                                 
                                    F
                                 
                              
                            is generated centered at a point 
                              
                                 
                                    p
                                 
                                 
                                    f
                                 
                              
                            horizontally located ahead of the current heel position 
                              
                                 
                                    x
                                 
                                 
                                    hs
                                 
                              
                            by a specified stride length 
                              
                                 w
                              
                           . If the multiple walk surface points are included in 
                              
                                 
                                    C
                                 
                                 
                                    F
                                 
                              
                           , the walk surface points having the maximum point number 
                              
                                 
                                    W
                                 
                                 
                                    s
                                 
                              
                            are extracted from 
                              
                                 W
                              
                            in order to locate the heel of the swing leg on the widest walkable region inside of 
                              
                                 
                                    C
                                 
                                 
                                    F
                                 
                              
                           . Finally, the next footprint point 
                              
                                 
                                    x
                                 
                                 
                                    f
                                 
                              
                            is determined as a centroid of 
                              
                                 
                                    W
                                 
                                 
                                    s
                                 
                              
                           . Note that any user-defined stride length 
                              
                                 w
                              
                            that is different from the original stride length in the reference MoCap data from the gait DB can be specified in our simulation.

On the other hand, as shown in Fig. 8(b), in the case of walking on stairs, the next footprint point 
                              
                                 
                                    x
                                 
                                 
                                    f
                                 
                              
                            is located so that 3/4 of the total foot length 
                              
                                 
                                    L
                                 
                                 
                                    f
                                 
                              
                            is placed on the tread according to a previous observational result of the HUMOSIM study [24].

After determining the next footprint point 
                              
                                 
                                    x
                                 
                                 
                                    f
                                 
                              
                           , a one-step virtual flat walking motion of the DHM with a stride length 
                              
                                 
                                    w
                                 
                                 
                                    ′
                                 
                              
                           , which is different from 
                              
                                 w
                              
                           , is pre-generated on the basis of the following procedure. Since 
                              
                                 
                                    x
                                 
                                 
                                    f
                                 
                              
                            is determined by searching for walk surface points as described in previous section, the horizontal distance between 
                              
                                 
                                    x
                                 
                                 
                                    f
                                 
                              
                            and 
                              
                                 
                                    x
                                 
                                 
                                    hs
                                 
                              
                            is different from 
                              
                                 w
                              
                           , where 
                              
                                 
                                    x
                                 
                                 
                                    hs
                                 
                              
                            represents the heel position of the swing leg of the DHM. Therefore, the stride length 
                              
                                 
                                    w
                                 
                                 
                                    ′
                                 
                              
                            is newly determined as 
                              
                                 
                                    
                                       w
                                    
                                    
                                       ′
                                    
                                 
                                 
                                    =
                                 
                                 
                                    
                                       dist
                                    
                                    
                                       H
                                    
                                 
                                 
                                    (
                                 
                                 
                                    
                                       x
                                    
                                    
                                       f
                                    
                                 
                                 
                                    ,
                                 
                                 
                                    
                                       x
                                    
                                    
                                       hs
                                    
                                 
                                 
                                    )
                                 
                              
                           , where 
                              
                                 
                                    
                                       dist
                                    
                                    
                                       H
                                    
                                 
                                 
                                    (
                                 
                                 
                                    
                                       x
                                    
                                    
                                       f
                                    
                                 
                                 
                                    ,
                                 
                                 
                                    
                                       x
                                    
                                    
                                       hs
                                    
                                 
                                 
                                    )
                                 
                              
                            is the horizontal distance between 
                              
                                 
                                    x
                                 
                                 
                                    f
                                 
                              
                            and 
                              
                                 
                                    x
                                 
                                 
                                    hs
                                 
                              
                           .


                           
                           Fig. 9 shows an overview of our method. In that method, single reference MoCap data selected from the gait DB is used for generating human-like walking motion. In the figure, an initial posture 
                              
                                 
                                    F
                                 
                                 
                                    I
                                 
                              
                           , representing the full-body posture at the initial contact frame of the next walking step (
                              
                                 ϕ
                                 =
                                 1
                              
                           ), is obtained from the reference MoCap data. In the algorithm of this method:
                              
                                 –
                                 a target posture 
                                       
                                          
                                             F
                                          
                                          
                                             t
                                          
                                       
                                     with the stride length 
                                       
                                          
                                             w
                                          
                                          
                                             ′
                                          
                                       
                                     at the next walking step can be generated by applying a cyclic-coordinate-descent IK (CCDIK) [30], which is an iterative IK solver for redundant link-mechanisms, to the initial posture 
                                       
                                          
                                             F
                                          
                                          
                                             I
                                          
                                       
                                    
                                 

a range of motion (ROM) of the joint angles of the DHM can be satisfied by introducing the ROM constrains into the CCDIK

the 
                                       
                                          i
                                       
                                    th joint angle of the DHM׳s stance leg 
                                       
                                          
                                             
                                                θ
                                             
                                             
                                                i
                                             
                                             
                                                DHM
                                             
                                          
                                          
                                             (
                                             ϕ
                                             )
                                          
                                       
                                     is estimated by cubic spline interpolation only using the stance leg angles 
                                       
                                          
                                             
                                                θ
                                             
                                             
                                                i
                                             
                                             
                                                DB
                                             
                                          
                                          
                                             (
                                          
                                          
                                             
                                                ϕ
                                             
                                             
                                                j
                                             
                                          
                                          
                                             )
                                          
                                       
                                     at the middle-stance phase 
                                       
                                          
                                             
                                                ϕ
                                             
                                             
                                                j
                                             
                                          
                                          
                                             ∈
                                             {
                                             0
                                             .
                                             4
                                             ,
                                             0
                                             .
                                             5
                                             ,
                                             0
                                             .
                                             6
                                             }
                                          
                                       
                                     obtained from the single reference MoCap data

the swing leg motions are estimated by solving the IK analytically to achieve interpolated ankle positions 
                                       
                                          
                                             
                                                f
                                             
                                             
                                                A
                                             
                                             
                                                DHM
                                             
                                          
                                          
                                             (
                                             ϕ
                                             )
                                          
                                       
                                    , where 
                                       
                                          
                                             
                                                f
                                             
                                             
                                                A
                                             
                                             
                                                DHM
                                             
                                          
                                          
                                             (
                                             ϕ
                                             )
                                          
                                       
                                     are estimated by cubic spline interpolation of the original ankle positions 
                                       
                                          
                                             
                                                f
                                             
                                             
                                                A
                                             
                                             
                                                DB
                                             
                                          
                                          
                                             (
                                          
                                          
                                             
                                                ϕ
                                             
                                             
                                                j
                                             
                                          
                                          
                                             )
                                          
                                       
                                     from the MoCap data

small angle differences in joint angles can be provided between the DHM and reference MoCap data, which are approximately 10° and 5° (maximum) in the knee and hip joints, respectively.

As shown in Fig. 8(a), a pelvis position trajectory 
                              
                                 
                                    
                                       f
                                    
                                    
                                       P
                                    
                                 
                                 
                                    (
                                    
                                       ϕ
                                    
                                    )
                                 
                                 
                                    =
                                    [
                                 
                                 
                                    
                                       x
                                    
                                    
                                       P
                                    
                                 
                                 
                                    (
                                    
                                       ϕ
                                    
                                    )
                                 
                                 
                                    ,
                                 
                                 
                                    
                                       y
                                    
                                    
                                       P
                                    
                                 
                                 
                                    (
                                    
                                       ϕ
                                    
                                    )
                                 
                                 
                                    ,
                                 
                                 
                                    
                                       z
                                    
                                    
                                       P
                                    
                                 
                                 
                                    (
                                    
                                       ϕ
                                    
                                    )
                                 
                                 
                                    ]
                                 
                              
                            and ankle position trajectory of the swing leg 
                              
                                 
                                    
                                       f
                                    
                                    
                                       A
                                    
                                 
                                 
                                    (
                                    
                                       ϕ
                                    
                                    )
                                 
                                 
                                    =
                                    [
                                 
                                 
                                    
                                       x
                                    
                                    
                                       A
                                    
                                 
                                 
                                    (
                                    
                                       ϕ
                                    
                                    )
                                 
                                 
                                    ,
                                 
                                 
                                    
                                       y
                                    
                                    
                                       A
                                    
                                 
                                 
                                    (
                                    
                                       ϕ
                                    
                                    )
                                 
                                 
                                    ,
                                 
                                 
                                    
                                       z
                                    
                                    
                                       A
                                    
                                 
                                 
                                    (
                                    
                                       ϕ
                                    
                                    )
                                 
                                 
                                    ]
                                 
                              
                            for one-step virtual flat walking can be obtained as results of this process (A8). The details of this process are described in our previous paper [6].

After generating the virtual flat walking motion of the DHM, the trajectories 
                              
                                 
                                    
                                       f
                                    
                                    
                                       P
                                    
                                 
                                 
                                    (
                                    
                                       ϕ
                                    
                                    )
                                 
                              
                            and 
                              
                                 
                                    
                                       f
                                    
                                    
                                       A
                                    
                                 
                                 
                                    (
                                    
                                       ϕ
                                    
                                    )
                                 
                              
                            of the virtual flat walking motion are adapted to actual walking environments. 
                           Fig. 10 shows an overview of the adaptation for the ankle trajectory 
                              
                                 
                                    
                                       f
                                    
                                    
                                       A
                                    
                                 
                                 
                                    (
                                    
                                       ϕ
                                    
                                    )
                                 
                              
                            as an example. An adapted pelvis position trajectory 
                              
                                 
                                    
                                       f
                                    
                                    
                                       P
                                    
                                    
                                       ′
                                    
                                 
                                 
                                    (
                                    
                                       ϕ
                                    
                                    )
                                 
                                 
                                    =
                                 
                                 
                                    [
                                    
                                       
                                          
                                             x
                                          
                                          
                                             P
                                          
                                          
                                             ′
                                          
                                       
                                       
                                          (
                                          
                                             ϕ
                                          
                                          )
                                       
                                       
                                          ,
                                       
                                       
                                          
                                             y
                                          
                                          
                                             P
                                          
                                          
                                             ′
                                          
                                       
                                       
                                          (
                                          
                                             ϕ
                                          
                                          )
                                       
                                       
                                          ,
                                       
                                       
                                          
                                             z
                                          
                                          
                                             P
                                          
                                          
                                             ′
                                          
                                       
                                       
                                          (
                                          
                                             ϕ
                                          
                                          )
                                       
                                    
                                    ]
                                 
                              
                            and adapted ankle position trajectory 
                              
                                 
                                    
                                       f
                                    
                                    
                                       A
                                    
                                    
                                       ′
                                    
                                 
                                 
                                    (
                                    
                                       ϕ
                                    
                                    )
                                 
                                 
                                    =
                                 
                                 
                                    [
                                    
                                       
                                          
                                             x
                                          
                                          
                                             A
                                          
                                          
                                             ′
                                          
                                       
                                       
                                          (
                                          
                                             ϕ
                                          
                                          )
                                       
                                       
                                          ,
                                       
                                       
                                          
                                             y
                                          
                                          
                                             A
                                          
                                          
                                             ′
                                          
                                       
                                       
                                          (
                                          
                                             ϕ
                                          
                                          )
                                       
                                       
                                          ,
                                       
                                       
                                          
                                             z
                                          
                                          
                                             A
                                          
                                          
                                             ′
                                          
                                       
                                       
                                          (
                                          
                                             ϕ
                                          
                                          )
                                       
                                    
                                    ]
                                 
                              
                           , which are adapted to the changes in the terrain height 
                              
                                 
                                    h
                                 
                                 
                                    t
                                 
                              
                            per step, are obtained from
                              
                                 (2)
                                 
                                    
                                       {
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  x
                                                               
                                                               
                                                                  P
                                                               
                                                               
                                                                  ′
                                                               
                                                            
                                                            
                                                               (
                                                               
                                                                  ϕ
                                                               
                                                               )
                                                            
                                                            
                                                               =
                                                            
                                                            
                                                               
                                                                  x
                                                               
                                                               
                                                                  P
                                                               
                                                            
                                                            
                                                               (
                                                               
                                                                  ϕ
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  y
                                                               
                                                               
                                                                  P
                                                               
                                                               
                                                                  ′
                                                               
                                                            
                                                            
                                                               (
                                                               
                                                                  ϕ
                                                               
                                                               )
                                                            
                                                            
                                                               =
                                                            
                                                            
                                                               
                                                                  y
                                                               
                                                               
                                                                  P
                                                               
                                                            
                                                            
                                                               (
                                                               
                                                                  ϕ
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         z
                                                      
                                                      
                                                         P
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         ϕ
                                                      
                                                      )
                                                   
                                                   
                                                      =
                                                   
                                                   
                                                      
                                                         z
                                                      
                                                      
                                                         P
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         0
                                                      
                                                      )
                                                   
                                                   
                                                      +
                                                   
                                                   
                                                      
                                                         d
                                                      
                                                      
                                                         P
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            
                                                               ϕ
                                                            
                                                            
                                                               P
                                                            
                                                            
                                                               ′
                                                            
                                                         
                                                      
                                                      )
                                                   
                                                   
                                                      +
                                                   
                                                   
                                                      
                                                         g
                                                      
                                                      
                                                         P
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            
                                                               ϕ
                                                            
                                                            
                                                               P
                                                            
                                                            
                                                               ′
                                                            
                                                         
                                                      
                                                      )
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         ϕ
                                                      
                                                      
                                                         P
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   
                                                      =
                                                      (
                                                   
                                                   
                                                      
                                                         y
                                                      
                                                      
                                                         P
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         ϕ
                                                      
                                                      )
                                                   
                                                   
                                                      −
                                                   
                                                   
                                                      
                                                         y
                                                      
                                                      
                                                         P
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         0
                                                      
                                                      )
                                                   
                                                   
                                                      )
                                                      /
                                                      (
                                                   
                                                   
                                                      
                                                         y
                                                      
                                                      
                                                         P
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         1
                                                      
                                                      )
                                                   
                                                   
                                                      −
                                                   
                                                   
                                                      
                                                         y
                                                      
                                                      
                                                         P
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         0
                                                      
                                                      )
                                                   
                                                   
                                                      )
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                           
                              
                                 (3)
                                 
                                    
                                       {
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  x
                                                               
                                                               
                                                                  A
                                                               
                                                               
                                                                  ′
                                                               
                                                            
                                                            
                                                               (
                                                               
                                                                  ϕ
                                                               
                                                               )
                                                            
                                                            
                                                               =
                                                            
                                                            
                                                               
                                                                  x
                                                               
                                                               
                                                                  A
                                                               
                                                            
                                                            
                                                               (
                                                               
                                                                  ϕ
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  y
                                                               
                                                               
                                                                  A
                                                               
                                                               
                                                                  ′
                                                               
                                                            
                                                            
                                                               (
                                                               
                                                                  ϕ
                                                               
                                                               )
                                                            
                                                            
                                                               =
                                                            
                                                            
                                                               
                                                                  y
                                                               
                                                               
                                                                  A
                                                               
                                                            
                                                            
                                                               (
                                                               
                                                                  ϕ
                                                               
                                                               )
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         z
                                                      
                                                      
                                                         A
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         ϕ
                                                      
                                                      )
                                                   
                                                   
                                                      =
                                                   
                                                   
                                                      
                                                         z
                                                      
                                                      
                                                         A
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         0
                                                      
                                                      )
                                                   
                                                   
                                                      +
                                                   
                                                   
                                                      
                                                         d
                                                      
                                                      
                                                         A
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            
                                                               ϕ
                                                            
                                                            
                                                               A
                                                            
                                                            
                                                               ′
                                                            
                                                         
                                                      
                                                      )
                                                   
                                                   
                                                      +
                                                   
                                                   
                                                      
                                                         g
                                                      
                                                      
                                                         A
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            
                                                               ϕ
                                                            
                                                            
                                                               A
                                                            
                                                            
                                                               ′
                                                            
                                                         
                                                      
                                                      )
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         ϕ
                                                      
                                                      
                                                         A
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   
                                                      =
                                                      (
                                                   
                                                   
                                                      
                                                         y
                                                      
                                                      
                                                         A
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         ϕ
                                                      
                                                      )
                                                   
                                                   
                                                      −
                                                   
                                                   
                                                      
                                                         y
                                                      
                                                      
                                                         A
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         0
                                                      
                                                      )
                                                   
                                                   
                                                      )
                                                      /
                                                      (
                                                   
                                                   
                                                      
                                                         y
                                                      
                                                      
                                                         A
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         1
                                                      
                                                      )
                                                   
                                                   
                                                      −
                                                   
                                                   
                                                      
                                                         y
                                                      
                                                      
                                                         A
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         0
                                                      
                                                      )
                                                   
                                                   
                                                      )
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           where
                              
                                 (4)
                                 
                                    
                                       {
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         d
                                                      
                                                      
                                                         P
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            
                                                               ϕ
                                                            
                                                            
                                                               P
                                                            
                                                            
                                                               ′
                                                            
                                                         
                                                      
                                                      )
                                                   
                                                   
                                                      =
                                                   
                                                   
                                                      
                                                         z
                                                      
                                                      
                                                         P
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            
                                                               ϕ
                                                            
                                                            
                                                               P
                                                            
                                                            
                                                               ′
                                                            
                                                         
                                                      
                                                      )
                                                   
                                                   
                                                      −
                                                   
                                                   
                                                      
                                                         z
                                                      
                                                      
                                                         P
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         0
                                                      
                                                      )
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         g
                                                      
                                                      
                                                         P
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            
                                                               ϕ
                                                            
                                                            
                                                               P
                                                            
                                                            
                                                               ′
                                                            
                                                         
                                                      
                                                      )
                                                   
                                                   
                                                      =
                                                   
                                                   
                                                      
                                                         
                                                            (
                                                         
                                                         
                                                            
                                                               y
                                                            
                                                            
                                                               P
                                                            
                                                         
                                                         
                                                            (
                                                            
                                                               1
                                                            
                                                            )
                                                         
                                                         
                                                            −
                                                         
                                                         
                                                            
                                                               y
                                                            
                                                            
                                                               P
                                                            
                                                         
                                                         
                                                            (
                                                            
                                                               0
                                                            
                                                            )
                                                         
                                                         
                                                            )
                                                         
                                                      
                                                      
                                                         
                                                            (
                                                         
                                                         
                                                            
                                                               y
                                                            
                                                            
                                                               A
                                                            
                                                         
                                                         
                                                            (
                                                            
                                                               1
                                                            
                                                            )
                                                         
                                                         
                                                            −
                                                         
                                                         
                                                            
                                                               y
                                                            
                                                            
                                                               A
                                                            
                                                         
                                                         
                                                            (
                                                            
                                                               0
                                                            
                                                            )
                                                         
                                                         
                                                            )
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         h
                                                      
                                                      
                                                         t
                                                      
                                                   
                                                   
                                                      
                                                         ϕ
                                                      
                                                      
                                                         P
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                           
                              
                                 (5)
                                 
                                    
                                       {
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         d
                                                      
                                                      
                                                         A
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            
                                                               ϕ
                                                            
                                                            
                                                               A
                                                            
                                                            
                                                               ′
                                                            
                                                         
                                                      
                                                      )
                                                   
                                                   
                                                      =
                                                   
                                                   
                                                      
                                                         z
                                                      
                                                      
                                                         A
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            
                                                               ϕ
                                                            
                                                            
                                                               A
                                                            
                                                            
                                                               ′
                                                            
                                                         
                                                      
                                                      )
                                                   
                                                   
                                                      −
                                                   
                                                   
                                                      
                                                         z
                                                      
                                                      
                                                         A
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         0
                                                      
                                                      )
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         g
                                                      
                                                      
                                                         A
                                                      
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            
                                                               ϕ
                                                            
                                                            
                                                               A
                                                            
                                                            
                                                               ′
                                                            
                                                         
                                                      
                                                      )
                                                   
                                                   
                                                      =
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            
                                                               v
                                                            
                                                            
                                                               
                                                                  A
                                                               
                                                               
                                                                  1
                                                               
                                                            
                                                         
                                                         
                                                            +
                                                         
                                                         
                                                            
                                                               v
                                                            
                                                            
                                                               
                                                                  A
                                                               
                                                               
                                                                  2
                                                               
                                                            
                                                         
                                                         
                                                            −
                                                            2
                                                         
                                                         
                                                            
                                                               h
                                                            
                                                            
                                                               t
                                                            
                                                         
                                                      
                                                      )
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               ϕ
                                                            
                                                            
                                                               A
                                                            
                                                            
                                                               ′
                                                            
                                                         
                                                      
                                                      
                                                         3
                                                      
                                                   
                                                   
                                                      +
                                                   
                                                   
                                                      (
                                                      
                                                         
                                                            −
                                                            2
                                                         
                                                         
                                                            
                                                               v
                                                            
                                                            
                                                               
                                                                  A
                                                               
                                                               
                                                                  1
                                                               
                                                            
                                                         
                                                         
                                                            −
                                                         
                                                         
                                                            
                                                               v
                                                            
                                                            
                                                               
                                                                  A
                                                               
                                                               
                                                                  2
                                                               
                                                            
                                                         
                                                         
                                                            +
                                                            3
                                                         
                                                         
                                                            
                                                               h
                                                            
                                                            
                                                               t
                                                            
                                                         
                                                      
                                                      )
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               ϕ
                                                            
                                                            
                                                               A
                                                            
                                                            
                                                               ′
                                                            
                                                         
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   
                                                      +
                                                   
                                                   
                                                      
                                                         v
                                                      
                                                      
                                                         
                                                            A
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         ϕ
                                                      
                                                      
                                                         A
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        

In the above equations, the adapted pelvis height 
                              
                                 
                                    
                                       z
                                    
                                    
                                       P
                                    
                                    
                                       ′
                                    
                                 
                                 
                                    (
                                    
                                       ϕ
                                    
                                    )
                                 
                              
                            is obtained by increasing or decreasing the original 
                              
                                 
                                    
                                       z
                                    
                                    
                                       P
                                    
                                 
                                 
                                    (
                                    
                                       ϕ
                                    
                                    )
                                 
                              
                            by the linear function 
                              
                                 
                                    
                                       g
                                    
                                    
                                       P
                                    
                                 
                                 
                                    (
                                 
                                 
                                    
                                       ϕ
                                    
                                    
                                       P
                                    
                                    
                                       ′
                                    
                                 
                                 
                                    )
                                 
                              
                            of Eq. (4) depending on the changes in the terrain height 
                              
                                 
                                    h
                                 
                                 
                                    t
                                 
                              
                           . By contrast, as shown in Fig. 10, the adapted ankle height 
                              
                                 
                                    
                                       z
                                    
                                    
                                       A
                                    
                                    
                                       ′
                                    
                                 
                                 
                                    (
                                    
                                       ϕ
                                    
                                    )
                                 
                              
                            is obtained by increasing or decreasing the original 
                              
                                 
                                    
                                       z
                                    
                                    
                                       A
                                    
                                 
                                 
                                    (
                                    
                                       
                                          
                                             ϕ
                                          
                                          
                                             A
                                          
                                          
                                             ′
                                          
                                       
                                    
                                    )
                                 
                              
                            by the cubic function 
                              
                                 
                                    
                                       g
                                    
                                    
                                       A
                                    
                                 
                                 
                                    (
                                 
                                 
                                    
                                       ϕ
                                    
                                    
                                       A
                                    
                                    
                                       ′
                                    
                                 
                                 
                                    )
                                 
                              
                            of Eq. (5) to respect the original ankle positions of the swing leg at the beginning of the swing phase. This is because the swing foot of a real human is rotated about a toe contact position (toe locker) during the phase, as observed in [31]. In Eq. (5), the cubic function 
                              
                                 
                                    
                                       g
                                    
                                    
                                       A
                                    
                                 
                                 
                                    (
                                 
                                 
                                    
                                       ϕ
                                    
                                    
                                       A
                                    
                                    
                                       ′
                                    
                                 
                                 
                                    )
                                 
                              
                            is determined so as to satisfy its boundary conditions 
                              
                                 
                                    
                                       g
                                    
                                    
                                       A
                                    
                                 
                                 
                                    (
                                    
                                       0
                                    
                                    )
                                 
                                 
                                    =
                                    0
                                 
                              
                           , 
                              
                                 
                                    
                                       g
                                    
                                    
                                       A
                                    
                                 
                                 
                                    (
                                    
                                       1
                                    
                                    )
                                 
                                 
                                    =
                                 
                                 
                                    
                                       h
                                    
                                    
                                       t
                                    
                                 
                              
                           , 
                              
                                 
                                    
                                       
                                          
                                             g
                                          
                                          
                                             A
                                          
                                       
                                    
                                    ̇
                                 
                                 
                                    (
                                    
                                       0
                                    
                                    )
                                 
                                 
                                    =
                                 
                                 
                                    
                                       v
                                    
                                    
                                       A
                                       1
                                    
                                 
                              
                           , and 
                              
                                 
                                    
                                       
                                          
                                             g
                                          
                                          
                                             A
                                          
                                       
                                    
                                    ̇
                                 
                                 
                                    (
                                    
                                       1
                                    
                                    )
                                 
                                 
                                    =
                                 
                                 
                                    
                                       v
                                    
                                    
                                       A
                                       2
                                    
                                 
                              
                           . We set 
                              
                                 
                                    
                                       v
                                    
                                    
                                       A
                                       1
                                    
                                 
                                 
                                    =
                                    0
                                 
                              
                            and 
                              
                                 
                                    
                                       v
                                    
                                    
                                       A
                                       2
                                    
                                 
                                 
                                    =
                                 
                                 
                                    
                                       h
                                    
                                    
                                       t
                                    
                                 
                              
                            based on our analysis of the preliminary experiment to measure human walking motion on the stairs described in Section 5.1.

The stance and swing foot elevation angles 
                              
                                 
                                    
                                       θ
                                    
                                    
                                       E
                                    
                                    
                                       st
                                    
                                 
                                 
                                    (
                                    
                                       ϕ
                                    
                                    )
                                 
                              
                            and 
                              
                                 
                                    
                                       θ
                                    
                                    
                                       E
                                    
                                    
                                       sw
                                    
                                 
                                 
                                    (
                                    
                                       ϕ
                                    
                                    )
                                 
                              
                            are then interpolated to determine the ankle joint angles during one-step walking.

As shown in 
                           Fig. 11(a), a foot elevation angle 
                              
                                 
                                    θ
                                 
                                 
                                    E
                                 
                              
                            represents the angle between the sole and the vertical axis 
                              
                                 
                                    l
                                 
                                 
                                    z
                                 
                              
                           , whereas an ankle joint angle 
                              
                                 
                                    θ
                                 
                                 
                                    J
                                 
                              
                            represents the relative angle between the foot and the lower leg. Using the elevation angle representation enables the DHM to adapt the foot orientation to the actual walking environment.

As shown in Fig. 11(b), the foot elevation angles 
                              
                                 
                                    
                                       θ
                                    
                                    
                                       E
                                    
                                    
                                       st
                                    
                                 
                                 
                                    (
                                    
                                       ϕ
                                    
                                    )
                                 
                              
                            and 
                              
                                 
                                    
                                       θ
                                    
                                    
                                       E
                                    
                                    
                                       sw
                                    
                                 
                                 
                                    (
                                    
                                       ϕ
                                    
                                    )
                                 
                              
                            are interpolated using cubic spline curves so that they satisfy 
                              
                                 
                                    
                                       θ
                                    
                                    
                                       E
                                    
                                    
                                       st
                                    
                                 
                                 
                                    (
                                    
                                       
                                          
                                             ϕ
                                          
                                          
                                             i
                                          
                                          
                                             st
                                          
                                       
                                    
                                    )
                                 
                                 
                                    =
                                 
                                 
                                    
                                       θ
                                    
                                    
                                       E_flat
                                    
                                    
                                       st
                                    
                                 
                                 
                                    (
                                    
                                       
                                          
                                             ϕ
                                          
                                          
                                             i
                                          
                                          
                                             st
                                          
                                       
                                    
                                    )
                                 
                              
                            and 
                              
                                 
                                    
                                       θ
                                    
                                    
                                       E
                                    
                                    
                                       sw
                                    
                                 
                                 
                                    (
                                    
                                       
                                          
                                             ϕ
                                          
                                          
                                             j
                                          
                                          
                                             sw
                                          
                                       
                                    
                                    )
                                 
                                 
                                    =
                                 
                                 
                                    
                                       θ
                                    
                                    
                                       E_flat
                                    
                                    
                                       sw
                                    
                                 
                                 
                                    (
                                    
                                       
                                          
                                             ϕ
                                          
                                          
                                             j
                                          
                                          
                                             sw
                                          
                                       
                                    
                                    )
                                 
                              
                           , where 
                              
                                 
                                    
                                       θ
                                    
                                    
                                       E_flat
                                    
                                    
                                       sw
                                    
                                 
                                 
                                    (
                                    
                                       
                                          
                                             ϕ
                                          
                                          
                                             i
                                          
                                          
                                             st
                                          
                                       
                                    
                                    )
                                 
                              
                            and 
                              
                                 
                                    
                                       θ
                                    
                                    
                                       E_flat
                                    
                                    
                                       st
                                    
                                 
                                 
                                    (
                                    
                                       
                                          
                                             ϕ
                                          
                                          
                                             j
                                          
                                          
                                             sw
                                          
                                       
                                    
                                    )
                                 
                              
                            are the elevation angles of the pre-generated virtual flat walking at 
                              
                                 
                                    ϕ
                                 
                                 
                                    i
                                 
                                 
                                    st
                                 
                              
                            (
                              
                                 i
                                 =
                                 1,2,3,4
                              
                           ) and 
                              
                                 
                                    ϕ
                                 
                                 
                                    j
                                 
                                 
                                    sw
                                 
                              
                            (
                              
                                 j
                                 =
                                 1,2
                              
                           ), respectively.
                              
                                 
                                    
                                       ϕ
                                    
                                    
                                       1
                                    
                                    
                                       sw
                                    
                                 
                                 
                                    =
                                 
                                 
                                    
                                       ϕ
                                    
                                    
                                       min
                                    
                                 
                              
                            is dynamically determined, whereas 
                              
                                 
                                    ϕ
                                 
                                 
                                    2
                                 
                                 
                                    sw
                                 
                              
                            is fixed as 0.6. The walking phase 
                              
                                 
                                    ϕ
                                 
                                 
                                    min
                                 
                              
                            is determined as the walking phase when 
                              
                                 
                                    
                                       θ
                                    
                                    
                                       E_flat
                                    
                                    
                                       sw
                                    
                                 
                                 
                                    (
                                    
                                       ϕ
                                    
                                    )
                                 
                              
                            takes a minimum value between 
                              
                                 ϕ
                                 =
                                 0.1
                              
                            and 
                              
                                 ϕ
                                 =
                                 0.5
                              
                           . By contrast, 
                              
                                 
                                    ϕ
                                 
                                 
                                    i
                                 
                                 
                                    st
                                 
                              
                            is determined as fixed values 
                              
                                 
                                    
                                       ϕ
                                    
                                    
                                       i
                                    
                                    
                                       st
                                    
                                 
                                 
                                    =
                                 
                                 
                                    0.2
                                    ×
                                    i
                                 
                              
                           . The angles 
                              
                                 
                                    θ
                                 
                                 
                                    E_DHM
                                 
                                 
                                    sw
                                 
                              
                           , 
                              
                                 
                                    
                                       θ
                                    
                                    
                                       E_flat
                                    
                                    
                                       sw
                                    
                                 
                                 
                                    (
                                    
                                       1
                                    
                                    )
                                 
                              
                           , 
                              
                                 
                                    θ
                                 
                                 
                                    E_DHM
                                 
                                 
                                    st
                                 
                              
                           , and 
                              
                                 
                                    
                                       θ
                                    
                                    
                                       E_flat
                                    
                                    
                                       st
                                    
                                 
                                 
                                    (
                                    
                                       1
                                    
                                    )
                                 
                              
                            and the angular velocities 
                              
                                 
                                    
                                       
                                          
                                             θ
                                          
                                          ̇
                                       
                                    
                                    
                                       E_flat
                                    
                                    
                                       sw
                                    
                                 
                                 
                                    (
                                    
                                       0
                                    
                                    )
                                 
                              
                           , 
                              
                                 
                                    
                                       
                                          
                                             θ
                                          
                                          ̇
                                       
                                    
                                    
                                       E_flat
                                    
                                    
                                       sw
                                    
                                 
                                 
                                    (
                                    
                                       1
                                    
                                    )
                                 
                              
                           , 
                              
                                 
                                    
                                       
                                          
                                             θ
                                          
                                          ̇
                                       
                                    
                                    
                                       E_flat
                                    
                                    
                                       st
                                    
                                 
                                 
                                    (
                                    
                                       0
                                    
                                    )
                                 
                              
                           , and 
                              
                                 
                                    
                                       
                                          
                                             θ
                                          
                                          ̇
                                       
                                    
                                    
                                       E_flat
                                    
                                    
                                       st
                                    
                                 
                                 
                                    (
                                    
                                       1
                                    
                                    )
                                 
                              
                            are also used as boundary conditions for the swing and stance foot of the DHM, respectively. The angles 
                              
                                 
                                    θ
                                 
                                 
                                    E_DHM
                                 
                                 
                                    sw
                                 
                              
                            and 
                              
                                 
                                    θ
                                 
                                 
                                    E_DHM
                                 
                                 
                                    st
                                 
                              
                            represent the current elevation angles of the swing and stance foot, respectively. The angular velocities are estimated by fitting a line locally to each of the angles 
                              
                                 
                                    
                                       θ
                                    
                                    
                                       E_flat
                                    
                                    
                                       st
                                    
                                 
                                 
                                    (
                                    
                                       ϕ
                                    
                                    )
                                 
                              
                            and 
                              
                                 
                                    
                                       θ
                                    
                                    
                                       E_flat
                                    
                                    
                                       st
                                    
                                 
                                 
                                    (
                                    
                                       ϕ
                                    
                                    )
                                 
                              
                            between 
                              
                                 ϕ
                                 =
                                 0.9
                              
                            and 
                              
                                 ϕ
                                 =
                                 1.0
                              
                           .

In addition, as shown in Fig. 11(b), when the DHM walks on stairs, we update 
                              
                                 
                                    
                                       θ
                                    
                                    
                                       E_flat
                                    
                                    
                                       sw
                                    
                                 
                                 
                                    (
                                    
                                       1
                                    
                                    )
                                 
                              
                            as 
                              
                                 
                                    
                                       θ
                                    
                                    
                                       E_flat
                                    
                                    
                                       sw
                                    
                                 
                                 
                                    (
                                    
                                       1
                                    
                                    )
                                 
                                 
                                    =
                                    π
                                    /
                                    2
                                 
                              
                           , which represents a foot orientation parallel to the horizontal plane, to realize the sole-contact on the tread.

By executing the previous processes (A7–A10) with next process (A12), the DHM could walk in flat, sloping, and bumpy terrains. However, if the DHM walks on stairs using only these processes, collision of the swing foot with a stair nosing may occur. Thus, to avoid collision, after determining the adapted swing ankle trajectory 
                              
                                 
                                    
                                       f
                                    
                                    
                                       A
                                    
                                    
                                       ′
                                    
                                 
                                 
                                    (
                                    
                                       ϕ
                                    
                                    )
                                 
                                 
                                    =
                                 
                                 
                                    [
                                    
                                       
                                          
                                             x
                                          
                                          
                                             A
                                          
                                          
                                             ′
                                          
                                       
                                       
                                          (
                                          
                                             ϕ
                                          
                                          )
                                       
                                       
                                          ,
                                       
                                       
                                          
                                             y
                                          
                                          
                                             A
                                          
                                          
                                             ′
                                          
                                       
                                       
                                          (
                                          
                                             ϕ
                                          
                                          )
                                       
                                       
                                          ,
                                       
                                       
                                          
                                             z
                                          
                                          
                                             A
                                          
                                          
                                             ′
                                          
                                       
                                       
                                          (
                                          
                                             ϕ
                                          
                                          )
                                       
                                    
                                    ]
                                 
                              
                            and swing foot elevation angle 
                              
                                 
                                    
                                       θ
                                    
                                    
                                       E
                                    
                                    
                                       sw
                                    
                                 
                                 
                                    (
                                    
                                       ϕ
                                    
                                    )
                                 
                              
                           , the swing ankle height 
                              
                                 
                                    
                                       z
                                    
                                    
                                       A
                                    
                                    
                                       ′
                                    
                                 
                                 
                                    (
                                    
                                       ϕ
                                    
                                    )
                                 
                              
                            should be accordingly modified. As shown in 
                           Fig. 12(a), the nosing represents the edge of a tread.

As shown in Fig. 12(a), first, the swing foot motion during one-step walking is virtually generated using both 
                              
                                 
                                    
                                       f
                                    
                                    
                                       A
                                    
                                    
                                       ′
                                    
                                 
                                 
                                    (
                                    
                                       ϕ
                                    
                                    )
                                 
                              
                            and 
                              
                                 
                                    
                                       θ
                                    
                                    
                                       E
                                    
                                    
                                       sw
                                    
                                 
                                 
                                    (
                                    
                                       ϕ
                                    
                                    )
                                 
                              
                           . Then, as a result, the penetration depths 
                              
                                 
                                    d
                                 
                                 
                                    1
                                 
                                 
                                    t
                                 
                              
                            and 
                              
                                 
                                    d
                                 
                                 
                                    2
                                 
                                 
                                    t
                                 
                              
                            are obtained along with the walking phases 
                              
                                 
                                    ϕ
                                 
                                 
                                    1
                                 
                              
                            and 
                              
                                 
                                    ϕ
                                 
                                 
                                    2
                                 
                              
                           , where the toe of the swing foot is located just under the nosing of the stairs. These penetration depths 
                              
                                 
                                    d
                                 
                                 
                                    1
                                 
                                 
                                    t
                                 
                              
                            and 
                              
                                 
                                    d
                                 
                                 
                                    2
                                 
                                 
                                    t
                                 
                              
                            are estimated as 
                              
                                 
                                    
                                       d
                                    
                                    
                                       1
                                    
                                    
                                       t
                                    
                                 
                                 
                                    =
                                 
                                 
                                    
                                       dist
                                    
                                    
                                       V
                                    
                                 
                                 
                                    (
                                 
                                 
                                    
                                       p
                                    
                                    
                                       t
                                    
                                    
                                       sw
                                    
                                 
                                 
                                    (
                                    
                                       
                                          
                                             ϕ
                                          
                                          
                                             1
                                          
                                       
                                    
                                    )
                                 
                                 
                                    ,
                                 
                                 
                                    
                                       n
                                    
                                    
                                       m
                                       ,
                                       n
                                    
                                 
                                 
                                    )
                                 
                              
                            and 
                              
                                 
                                    
                                       d
                                    
                                    
                                       2
                                    
                                    
                                       t
                                    
                                 
                                 
                                    =
                                 
                                 
                                    
                                       dist
                                    
                                    
                                       V
                                    
                                 
                                 
                                    (
                                 
                                 
                                    
                                       p
                                    
                                    
                                       t
                                    
                                    
                                       sw
                                    
                                 
                                 
                                    (
                                    
                                       
                                          
                                             ϕ
                                          
                                          
                                             2
                                          
                                       
                                    
                                    )
                                 
                                 
                                    ,
                                 
                                 
                                    
                                       n
                                    
                                    
                                       m
                                       ,
                                       n
                                       +
                                       1
                                    
                                 
                                 
                                    )
                                 
                              
                           , where 
                              
                                 
                                    
                                       p
                                    
                                    
                                       t
                                    
                                    
                                       sw
                                    
                                 
                                 
                                    (
                                    
                                       ϕ
                                    
                                    )
                                 
                              
                           , 
                              
                                 
                                    n
                                 
                                 
                                    m
                                    ,
                                    n
                                 
                              
                           , and 
                              
                                 
                                    
                                       dist
                                    
                                    
                                       V
                                    
                                 
                                 
                                    (
                                 
                                 
                                    
                                       p
                                    
                                    
                                       t
                                    
                                    
                                       sw
                                    
                                 
                                 
                                    (
                                    
                                       ϕ
                                    
                                    )
                                 
                                 
                                    ,
                                 
                                 
                                    
                                       n
                                    
                                    
                                       m
                                       ,
                                       n
                                    
                                 
                                 
                                    )
                                 
                              
                            represent the toe position of the swing foot, a nosing point estimated from the tread boundary 
                              
                                 
                                    B
                                 
                                 
                                    m
                                    ,
                                    n
                                 
                              
                            and the vertical distance between 
                              
                                 
                                    
                                       p
                                    
                                    
                                       t
                                    
                                    
                                       sw
                                    
                                 
                                 
                                    (
                                    
                                       ϕ
                                    
                                    )
                                 
                              
                            and 
                              
                                 
                                    n
                                 
                                 
                                    m
                                    ,
                                    n
                                 
                              
                           , respectively. Finally, as shown in Fig. 12(b), the collision-free ankle height 
                              
                                 
                                    
                                       z
                                    
                                    
                                       A
                                    
                                    
                                       ′
                                       ′
                                    
                                 
                                 
                                    (
                                    
                                       ϕ
                                    
                                    )
                                 
                              
                            is obtained by cubic spline interpolation of 
                              
                                 
                                    
                                       z
                                    
                                    
                                       A
                                    
                                    
                                       ′
                                    
                                 
                                 
                                    (
                                    
                                       ϕ
                                    
                                    )
                                 
                              
                           , so that it satisfies 
                              
                                 
                                    
                                       z
                                    
                                    
                                       A
                                    
                                    
                                       ′
                                       ′
                                    
                                 
                                 
                                    (
                                    
                                       
                                          
                                             ϕ
                                          
                                          
                                             1
                                          
                                       
                                    
                                    )
                                 
                                 
                                    =
                                 
                                 
                                    
                                       z
                                    
                                    
                                       A
                                    
                                    
                                       ′
                                    
                                 
                                 
                                    (
                                    
                                       
                                          
                                             ϕ
                                          
                                          
                                             1
                                          
                                       
                                    
                                    )
                                 
                                 
                                    +
                                 
                                 
                                    
                                       d
                                    
                                    
                                       1
                                    
                                    
                                       t
                                    
                                 
                              
                            and 
                              
                                 
                                    
                                       z
                                    
                                    
                                       A
                                    
                                    
                                       ′
                                       ′
                                    
                                 
                                 
                                    (
                                    
                                       
                                          
                                             ϕ
                                          
                                          
                                             2
                                          
                                       
                                    
                                    )
                                 
                                 
                                    =
                                 
                                 
                                    
                                       z
                                    
                                    
                                       A
                                    
                                    
                                       ′
                                    
                                 
                                 
                                    (
                                    
                                       
                                          
                                             ϕ
                                          
                                          
                                             2
                                          
                                       
                                    
                                    )
                                 
                                 
                                    +
                                 
                                 
                                    
                                       d
                                    
                                    
                                       2
                                    
                                    
                                       t
                                    
                                 
                              
                            at phases 
                              
                                 
                                    ϕ
                                 
                                 
                                    1
                                 
                              
                            and 
                              
                                 
                                    ϕ
                                 
                                 
                                    2
                                 
                              
                           , respectively. The positions 
                              
                                 
                                    
                                       z
                                    
                                    
                                       A
                                    
                                    
                                       ′
                                    
                                 
                                 
                                    (
                                    
                                       0
                                    
                                    )
                                 
                              
                            and 
                              
                                 
                                    
                                       z
                                    
                                    
                                       A
                                    
                                    
                                       ′
                                    
                                 
                                 
                                    (
                                    
                                       1
                                    
                                    )
                                 
                              
                            and velocities 
                              
                                 
                                    v
                                 
                                 
                                    0
                                 
                              
                            and 
                              
                                 
                                    v
                                 
                                 
                                    1
                                 
                              
                            are also used as boundary conditions. We set 
                              
                                 
                                    
                                       v
                                    
                                    
                                       0
                                    
                                 
                                 
                                    =
                                    0
                                 
                              
                            and 
                              
                                 
                                    
                                       v
                                    
                                    
                                       1
                                    
                                 
                                 
                                    =
                                 
                                 
                                    
                                       
                                          
                                             z
                                          
                                          
                                             A
                                          
                                          
                                             ′
                                          
                                       
                                    
                                    ̇
                                 
                                 
                                    (
                                    
                                       1
                                    
                                    )
                                 
                              
                           , based on our analysis in the preliminary experiment, to measure human walking motion on the stairs described in Section 5.1.

As a result of this process (A11), a collision-free ankle position trajectory 
                              
                                 
                                    
                                       f
                                    
                                    
                                       A
                                    
                                    
                                       ′
                                       ′
                                    
                                 
                                 
                                    (
                                    
                                       ϕ
                                    
                                    )
                                 
                                 
                                    =
                                 
                                 
                                    [
                                    
                                       
                                          
                                             x
                                          
                                          
                                             A
                                          
                                          
                                             ′
                                             ′
                                          
                                       
                                       
                                          (
                                          
                                             ϕ
                                          
                                          )
                                       
                                       
                                          ,
                                       
                                       
                                          
                                             y
                                          
                                          
                                             A
                                          
                                          
                                             ′
                                             ′
                                          
                                       
                                       
                                          (
                                          
                                             ϕ
                                          
                                          )
                                       
                                       
                                          ,
                                       
                                       
                                          
                                             z
                                          
                                          
                                             A
                                          
                                          
                                             ′
                                             ′
                                          
                                       
                                       
                                          (
                                          
                                             ϕ
                                          
                                          )
                                       
                                    
                                    ]
                                 
                              
                           , which has no collisions of the swing foot with the staircase treads, can be completely determined.

Finally, as shown in the “walking simulation” section of Fig. 2, all the joint angles of the stance and swing legs are determined based on the results of previous processes (A9–A11).

As shown in 
                           Fig. 13, first, the pelvis position of the DHM moves to 
                              
                                 
                                    
                                       f
                                    
                                    
                                       P
                                    
                                    
                                       ′
                                    
                                 
                                 
                                    (
                                    
                                       ϕ
                                    
                                    )
                                 
                              
                            at the walking phase 
                              
                                 ϕ
                              
                           , where 
                              
                                 
                                    
                                       f
                                    
                                    
                                       P
                                    
                                    
                                       ′
                                    
                                 
                                 
                                    (
                                    
                                       ϕ
                                    
                                    )
                                 
                              
                            was already adapted to the actual walking environment by the process (A9) mentioned in Section 4.3.3. The swing and stance foot orientations are determined by applying 
                              
                                 
                                    
                                       θ
                                    
                                    
                                       E
                                    
                                    
                                       sw
                                    
                                 
                                 
                                    (
                                    
                                       ϕ
                                    
                                    )
                                 
                              
                            and 
                              
                                 
                                    
                                       θ
                                    
                                    
                                       E
                                    
                                    
                                       st
                                    
                                 
                                 
                                    (
                                    
                                       ϕ
                                    
                                    )
                                 
                              
                            to each foot, which were interpolated by the process (A10) mentioned in Section 4.3.4. All the joint angles of the stance leg are then determined by solving IK analytically to achieve the current contact position 
                              
                                 
                                    p
                                 
                                 
                                    c
                                 
                              
                            between the sole and the walking terrain surface. 
                              
                                 
                                    p
                                 
                                 
                                    c
                                 
                              
                            is initialized as the heel position of the stance leg at the phase 
                              
                                 ϕ
                                 =
                                 0
                              
                           . Finally, all the joint angles of the swing leg are also determined by solving IK analytically to achieve 
                              
                                 
                                    
                                       f
                                    
                                    
                                       A
                                    
                                    
                                       ′
                                       ′
                                    
                                 
                                 
                                    (
                                    
                                       ϕ
                                    
                                    )
                                 
                              
                           . In the case of walking on stairs, 
                              
                                 
                                    
                                       f
                                    
                                    
                                       A
                                    
                                    
                                       ′
                                       ′
                                    
                                 
                                 
                                    (
                                    
                                       ϕ
                                    
                                    )
                                 
                              
                            has been already adapted to the stairs so as to avoid collision of the swing foot with a stair nosing in the process (A11) in Section 4.3.5. Contrastingly, in the case of walking in the other terrains, 
                              
                                 
                                    
                                       f
                                    
                                    
                                       A
                                    
                                    
                                       ′
                                       ′
                                    
                                 
                                 
                                    (
                                    
                                       ϕ
                                    
                                    )
                                 
                              
                            is directly copied from 
                              
                                 
                                    
                                       f
                                    
                                    
                                       A
                                    
                                    
                                       ′
                                    
                                 
                                 
                                    (
                                    
                                       ϕ
                                    
                                    )
                                 
                              
                            which has been already adapted to an actual walking environment by the process (A9) mentioned in Section 4.3.3.

In this process, both leg motions are determined by solving the inverse kinematics analytically. The details of this inverse kinematics calculation are given below.

As shown in 
                           Fig. 14, given a pelvis point and an ankle point, we need to compute the hip joint angle (3 DOF) and knee joint angle (1 DOF). To estimate all of these joint angles, we first determine the internal/external rotation angle of the hip joint 
                              
                                 
                                    θ
                                 
                                 
                                    hip
                                 
                                 
                                    inter
                                 
                              
                           . The internal/external rotation angle of the hip joint obtained from the pre-generated flat walking motion of the DHM is copied to the hip joint of the DHM 
                              
                                 
                                    θ
                                 
                                 
                                    hip
                                 
                                 
                                    inter
                                 
                              
                           . In cases where a turning or steering motion is required, the 
                              
                                 
                                    θ
                                 
                                 
                                    hip
                                 
                                 
                                    inter
                                 
                              
                            of the stance leg is increased gradually in each frame during one-step walking until the rotation angle 
                              
                                 
                                    θ
                                 
                                 
                                    rot
                                 
                              
                            is reached. 
                              
                                 
                                    θ
                                 
                                 
                                    rot
                                 
                              
                            represents the angle between the current locomotion vector 
                              
                                 v
                              
                            and the locomotion vector 
                              
                                 
                                    v
                                 
                                 
                                    pre
                                 
                              
                            in the previous one-step walking. Finally, the three joint angles (the flexion/extension rotation angle 
                              
                                 
                                    θ
                                 
                                 
                                    hip
                                 
                                 
                                    flex
                                 
                              
                            and adduction/abduction rotation angle 
                              
                                 
                                    θ
                                 
                                 
                                    hip
                                 
                                 
                                    add
                                 
                              
                            of the hip joint and the flexion/extension rotation angle 
                              
                                 
                                    θ
                                 
                                 
                                    knee
                                 
                                 
                                    flex
                                 
                              
                            of the knee joint) are computed to achieve the given ankle point by simple geometric computation using trigonometric functions.

In addition, as shown in Fig. 13, a collision check between the stance toe position 
                              
                                 
                                    
                                       p
                                    
                                    
                                       t
                                    
                                    
                                       st
                                    
                                 
                                 
                                    (
                                    
                                       ϕ
                                    
                                    )
                                 
                              
                            and a local terrain surface 
                              
                                 P
                              
                            is performed at every walking step. When a collision occurs, the contact position 
                              
                                 
                                    p
                                 
                                 
                                    c
                                 
                              
                            is updated as 
                              
                                 
                                    
                                       p
                                    
                                    
                                       c
                                    
                                 
                                 
                                    =
                                 
                                 
                                    
                                       p
                                    
                                    
                                       t
                                    
                                    
                                       st
                                    
                                 
                                 
                                    (
                                    
                                       ϕ
                                    
                                    )
                                 
                              
                            to realize the transition from heel to toe contact. The local terrain surface 
                              
                                 P
                              
                            is estimated by applying the least-square method to the walk surface points 
                              
                                 
                                    W
                                 
                                 
                                    k
                                 
                              
                            locally.

@&#RESULTS@&#

We validated our proposed modeling and simulation algorithm in the two types of complex laser-scanned environments, one is an indoor environment including stairs (around 42 million points were scanned by a terrestrial laser scanner (FARO Focus3D S120)) and the other is an outdoor environment consisting paved slopes (around 41 million points were scanned by a terrestrial laser scanner (RIEGL VZ-1000)).

Results of the 3D environmental modeling are shown in 
                        Fig. 15. Fig. 15(a)–(e) are the modeling results from the laser-scanned point clouds of the indoor environment, and Fig. 15(f)–(h) are those of the outdoor environment. As shown in Fig. 15(b) and (g), walkable surfaces such as floors, slopes, and staircase treads are extracted as the walk surface points. Moreover, as shown in Fig. 15(c), (d), and (h), the free space and its connectivity in the environments could be successfully modeled as the navigation graph. In addition, as shown in Fig. 15(e), the boundary lines of each tread could be reproduced as the tread boundaries. These environment models were automatically generated from the original laser-scanned point clouds.


                        
                        Fig. 16 shows walking simulation results in the generated 3D environment models. Fig. 16(a)–(d) show the results of the walking simulation in a corridor with corners, 3-deg slope, 6-deg slope, and stairs, respectively. In the figure, the motion of the DHM was generated based on different three-reference MoCap data selected from the gait DB [29] (female aged 13, male aged 23, and female aged 72).

As shown in Fig. 16, the DHM was able to walk in different complex environments automatically, while adapting its strides, turning angles, and footprints to the point clouds-based environment models. Moreover, as shown in Fig. 16(c) and (d), the stance and swing foot of the DHM could avoid collisions with the point clouds such as slopes and stairs during the walking simulation.

In addition, Fig. 16(e) and (f) show the results of the walking simulation in the case of changing stride of the DHM. As shown in the figures, our proposed simulation algorithm could reasonably recreate the oscillation of the pelvis even though the stride was changed, which has been observed as a feature of human walking [31]. This result shows the effectiveness of generating human-like walking motion while respecting human walking features.


                        
                        Fig. 17 shows a comparison of the DHM walking motion with MoCap data of a human subject (male, aged 23). The motion of the DHM was estimated based on our proposed walking simulation algorithm using single reference MoCap data of the subject during flat walking. We then performed a walking simulation on a 6-deg slope, and obtained the walking motion of the DHM on the slope. Finally, its joint angle patterns of the DHM on the 6-deg slope were compared with MoCap data actually measured from the subject on the 6-deg slope.

As shown in Fig. 17, the DHM can generate joint angle patterns similar to those of the human subject on a 6-deg slope. The averaged angle differences between the simulation and reference MoCap data are approximately 5° and 6° in the hip and knee joints, respectively. This shows that our proposed walking simulation algorithm can generate human-like walking motion even in the different environments based only on single reference MoCap data for flat walking for young subject.

Regrettably, a comparison with an elderly person׳s gait on non-flat walking terrain could not be performed because MoCap data for an elderly subject acquired in non-flat walking terrain is not available in the gait database [29]. As noted in Section 2.3, it is both practically and ethically difficult to persuade elderly persons to join a prolonged experiment on walking motion in various walking environments including flat, 3-deg and 6-deg slopes, and stairs. We leave this comparison to future work.

In a previous paper [6], we confirmed that the DHM could generate joint angle patterns similar to those of human subjects of different ages and genders (male aged 22, female aged 13, male aged 73, and female aged 72), at least on flat walking terrain.


                        
                        Table 1 shows the elapsed time of the 3D environmental modeling from the original point clouds and of the walking simulation. The Point Cloud Library [32] was partly used for point cloud processing, and OpenGL was used for rendering. The 3D environmental modeling required approximately 12s for the indoor environment and 20s for the outdoor environment, which is significantly faster than manual modeling.

The elapsed time for the macro-level simulation, a preparation for beginning the micro-level simulation, was less than a few three-hundredths seconds. In addition, the elapsed time for one-step walking motion simulation with 100-frame interpolation in the micro-level simulation required approximately 0.4s in the indoor environment and 1.2s in the outdoor environments. In the outdoor environments, the elapsed time of the simulation dropped to a lower value. This is because the number of down-sampled points was greater than that of the indoor environments. This caused a high-computational load for the point clouds rendering and searching in Section 4.3.1. Therefore, our proposed walking simulation has a possibility of simulating real-time walking for one DHM in the one-floor indoor environment. However, the computational time still needs to be improved for real-time walking simulation of the DHM in more large-scale environments.

@&#CONCLUSIONS@&#

In this study, we developed an algorithm for generating human-like walking motion for a DHM in various as-is environments including slopes and stairs. The walking motion of the DHM was generated based on single reference MoCap data for flat walking selected from the gait DB. The DHM could walk autonomously, while adapting its strides, turning angles and footprints to different as-is environment models automatically constructed from laser-scanned point clouds. The simulation results on a 6-deg slope were validated through comparison with MoCap data acquired for the same slope. The differences in joint angles between the DHM and MoCap data were achieved at 5° and 6° for the hip and knee joints on average, respectively. This showed that our proposed walking simulation algorithm could generate human-like walking motion even in the different environments based only on reference MoCap data for flat walking. Additionally, as shown in Fig. 16, it was confirmed that the DHM could walk autonomously in indoor and outdoor environment models based on single reference MoCap data for flat walking acquired from various types of people of different ages and genders. Moreover, an algorithm for 3D as-is environmental modeling from massive laser-scanned point clouds of real environments was also proposed. The 3D environmental modeling required a few seconds, which is significantly faster than manual modeling. Additionally, the elapsed time for one-step walking motion simulation was approximately one second, which is short enough for practical application.

In a previous paper [6], we confirmed that the DHM could generate joint angle patterns similar to those of human subjects of different ages and genders (male aged 22, female aged 13, male aged 73, and female aged 72) on flat walking terrain. In this study, the simulated walking motion of the DHM on non-flat terrain was compared only with MoCap data for young subjects acquired in the same non-flat environment. However, as mentioned in Section 5.3, we were unable to compare the simulated walking motion of the DHM on non-flat terrain with MoCap data for elderly subjects. This validation will be addressed in future work.

Moreover, in this paper, we have reported only the technologies for the accessibility evaluation, and the concrete results of the evaluation have not been shown. In future work, we plan to develop the accessibility evaluation function in terms of physical friendliness for various people of different ages, genders, and body dimensions by making use of the proposed walking simulation. In particular, we will evaluate tripping risks in the environment, based on the toe-clearance of the DHM during walking simulations.

In the proposed human behavior simulation, we used a depth-first search algorithm for walking path selection. This is a “brute force” and is therefore an inefficient approach. However, as shown in Table 1, the elapsed time of this process was less than 0.1s, so it is not a serious problem at this stage. It is possible that the elapsed time will become longer as the walking path structure becomes more complex. Therefore, to achieve efficient and reliable walking path selection in a larger-scale and more complex environment, we plan to introduce a more efficient path selection algorithm, such as an A* algorithm.

@&#ACKNOWLEDGMENTS@&#

This work was supported by JSPS KAKENHI Grant no. 15J01552 and JSPS Grant-in-Aid for Challenging Exploratory Research under Project no. 26560168.

Our preliminary experiment was conducted in cooperation with the Digital Human Research Center (DHRC) of the National Institute of Advanced Industrial Science and Technology (AIST). Additionally, the RIEGL JAPAN Corporation provided the outdoor environment point clouds. We would like to express our gratitude to A. Sawatome and Y. Nakamura of the AIST DHRC, and S. Matsuda of the RIEGL JAPAN Corporation, for their support.

@&#REFERENCES@&#

