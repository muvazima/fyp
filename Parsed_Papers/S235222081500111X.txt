@&#MAIN-TITLE@&#Kernels, in a nutshell

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           A total function on an initial algebra is a homomorphism iff its kernel is a congruence.


                        
                        
                           
                           An earlier paper (CMCS 2001) elaborates on that classical result.


                        
                        
                           
                           We extend the result from total to partial functions.


                        
                        
                           
                           We simplify the proofs using the relational calculus.


                        
                        
                           
                           We generalise the setting to regular categories.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

@&#ABSTRACT@&#


               
               
                  A classical result in algebraic specification states that a total function defined on an initial algebra is a homomorphism if and only if the kernel of that function is a congruence. We expand on the discussion of that result from an earlier paper: extending it from total to partial functions, simplifying the proofs using relational calculus, and generalising the setting to regular categories.
               
            

@&#INTRODUCTION@&#

When is a function a fold? In one sense, the definition of fold says it all:
                        
                           
                        
                     A function 
                        h
                        :
                        μ
                        F
                        →
                        a
                      can be written in the form of a fold precisely when there exists an 
                        f
                        :
                        F
                        A
                        →
                        A
                      such that 
                        h
                        =
                        
                           
                              fold
                           
                           
                              F
                           
                        
                        f
                     . For example, with 
                        L
                        A
                        =
                        1
                        +
                        
                           Nat
                        
                        ×
                        A
                      as the shape functor for lists of naturals, 
                        
                           sum
                        
                        :
                        μ
                        L
                        →
                        
                           Nat
                        
                      is a fold: indeed, 
                        
                           sum
                        
                        =
                        
                           
                              fold
                           
                           
                              L
                           
                        
                        
                           add
                        
                      where
                        
                           
                        
                     But 
                        
                           allEqual
                        
                        :
                        μ
                        L
                        →
                        
                           Bool
                        
                     , the predicate testing that all elements of a list have the same value, is not a fold: with a little effort (for example, considering lists of length 0, 1, and 2), one can convince oneself that there exists no f with 
                        
                           allEqual
                        
                        =
                        
                           
                              fold
                           
                           
                              L
                           
                        
                        f
                     .

However, this criterion is a little unsatisfying. One can use the existence of f as a criterion to prove that h is a fold, by exhibiting the f; but it is harder to use it to disprove that h is a fold, since it is harder to provide evidence for the non-existence of any such f. The criterion is intensional, referring to some property f of the implementation of h, which we may not yet have to hand. We might hope for an extensional criterion instead, expressed purely in terms of the behaviour of h rather than of any possible implementation.

An extensional but incomplete answer is given by the observation that if h is injective, so that there exists a post-inverse 
                        
                           
                              h
                           
                           
                              ′
                           
                        
                      with 
                        
                           
                              h
                           
                           
                              ′
                           
                        
                        ∘
                        h
                        =
                        
                           id
                        
                     , then
                        
                           
                        
                     and so h is a fold. But injectivity is only a sufficient condition, not a necessary one—indeed, sum is a fold, despite not being injective. So again this observation is no help in showing that a function is not a fold.

In this paper, we discuss a necessary and sufficient condition for h to be a fold. The result was presented in an earlier paper [6]. It turns out to be a standard result in algebraic specification; see for example [4, §3.10]. We elaborate on that earlier work here. Our original presentation was purely in set-theoretic terms, treating functions as sets of pairs, and limited to total functions. Here, we point out a straightforward extension to partial functions, and we consider an allegorical (that is, axiomatic relational) presentation, which turns out to be rather simpler, and one in terms of regular categories, which is a bit more flexible.

In the interests of brevity, we talk only about folds and postfactors. There's a dual story about prefactors, but the most useful connection with unfolds isn't quite one of duality (because dualising ‘partial function’ isn't very helpful). We leave the details for the curious reader to explore for themselves.

In this section, we work in the category 
                        S
                        
                           et
                        
                     , in which the objects are sets and the arrows are total functions between sets. In particular, a function 
                        f
                        :
                        A
                        →
                        B
                      is a triple consisting of the source A, the target B, and the graph, the set of pairs 
                        {
                        (
                        a
                        ,
                        b
                        )
                        |
                        a
                        ∈
                        A
                        ∧
                        b
                        =
                        f
                        a
                        ∈
                        B
                        }
                     . We write 
                        
                           ran
                        
                        
                        f
                        ⊆
                        B
                      for the range of f.

A crucial ingredient in the construction is the notion of the kernel of a function, that is, the set of pairs of arguments identified by the function. 
                        Definition 1
                        The kernel 
                              
                                 ker
                              
                              
                              f
                            of a total function 
                              f
                              :
                              A
                              →
                              B
                            is the set of pairs
                              
                                 
                              
                            ⋄

It is easy to see that this definition yields an equivalence relation on A.

Given 
                        h
                        :
                        A
                        →
                        C
                      and 
                        f
                        :
                        A
                        →
                        B
                     , when can h be factorised into 
                        g
                        ∘
                        f
                      for some 
                        g
                        :
                        B
                        →
                        C
                     ? It is clearly necessary for the function space 
                        B
                        →
                        C
                      to be non-empty, that is, either 
                        C
                        ≠
                        ∅
                      or 
                        B
                        =
                        ∅
                     ; otherwise, there can be no such g. Given that proviso, a necessary and sufficient condition for the existence of such a postfactor g is for the kernel of h to include the kernel of f: 
                        Theorem 2
                        
                           Given 
                           
                              h
                              :
                              A
                              →
                              C
                            
                           and 
                           
                              f
                              :
                              A
                              →
                              B
                            
                           such that 
                           
                              B
                              →
                              C
                              ≠
                              ∅
                           
                           ,
                           
                              
                                 
                              
                           
                            ⋄


                     
                        Proof
                        From left to right, suppose that 
                              h
                              =
                              g
                              ∘
                              f
                           . Then
                              
                                 
                              
                           which establishes the inclusion. From right to left, suppose that 
                              
                                 ker
                              
                              
                              h
                              ⊇
                              
                                 ker
                              
                              
                              f
                           ; we construct g as follows. For 
                              b
                              ∈
                              
                                 ran
                              
                              
                              f
                           , pick any a such that 
                              f
                              a
                              =
                              b
                           , and define 
                              g
                              b
                              =
                              h
                              a
                           ; by the hypothesis, the choice of a does not affect the value of 
                              g
                              b
                           . For 
                              b
                              ∉
                              
                                 ran
                              
                              
                              f
                           , define 
                              g
                              b
                            arbitrarily; by the assumption that 
                              B
                              →
                              C
                              ≠
                              ∅
                           , this is possible (classically).   ⋄

From this follows the main result of [6]: 
                        Corollary 3
                        
                           For functor 
                           
                              F
                            
                           such that the initial algebra 
                           
                              (
                              μ
                              F
                              ,
                              
                                 
                                    in
                                 
                                 
                                    F
                                 
                              
                              )
                            
                           exists, and for 
                           
                              h
                              :
                              μ
                              F
                              →
                              A
                           
                           ,
                           
                              
                                 
                              
                           
                            ⋄


                     
                        Proof
                        The connection to Theorem 2 comes from the universal property of fold:
                              
                                 
                              
                           (Note that the side condition 
                              F
                              A
                              →
                              A
                              ≠
                              ∅
                            follows from 
                              μ
                              F
                              →
                              A
                              ≠
                              ∅
                            
                           [6], which follows in turn from the existence of h.)   ⋄


                     
                        Remark 4
                        One can show that 
                              
                                 ker
                              
                              
                              (
                              F
                              h
                              )
                              =
                              
                                 
                                    Rel
                                 
                                 
                                    F
                                 
                              
                              (
                              
                                 ker
                              
                              
                              h
                              )
                           , where 
                              
                                 
                                    Rel
                                 
                                 
                                    F
                                 
                              
                              R
                            denotes the relational lifting of the relation R on A to a relation acting pointwise on 
                              F
                              A
                           . Moreover, since 
                              
                                 
                                    in
                                 
                                 
                                    F
                                 
                              
                            is a bijection, 
                              
                                 ker
                              
                              
                              (
                              h
                              ∘
                              
                                 
                                    in
                                 
                                 
                                    F
                                 
                              
                              )
                            is equivalent to just 
                              
                                 ker
                              
                              
                              h
                           . Finally, given an 
                              F
                           -algebra 
                              f
                              :
                              F
                              A
                              →
                              A
                           , we say that a relation R is an 
                              F
                           
                           -congruence for f if pointwise-related arguments are taken by f to related results:
                              
                                 
                              
                           Then the condition 
                              
                                 ker
                              
                              
                              (
                              h
                              ∘
                              
                                 
                                    in
                                 
                                 
                                    F
                                 
                              
                              )
                              ⊇
                              
                                 ker
                              
                              
                              (
                              F
                              h
                              )
                            in Corollary 3 is equivalent to saying that 
                              
                                 ker
                              
                              
                              h
                            is an 
                              F
                           -congruence for 
                              
                                 
                                    in
                                 
                                 
                                    F
                                 
                              
                           , which is the more traditional but less manipulable formulation.  ⋄

The simple characterisation above of the kernel of a total function needs adaptation, if it is to continue to serve as an equivalence relation on the source of a partial function:


                     
                        Definition 5
                        The kernel 
                              
                                 ker
                              
                              
                              f
                              ⊆
                              A
                              ×
                              A
                            of a partial function 
                              f
                              :
                              A
                              
                                 
                                    
                                 
                              
                              B
                            is the set of pairs
                              
                                 
                              
                            ⋄

A postfactor theorem similar to Theorem 2 can be proved for partial functions. The conditions need to be strengthened in one sense: clearly now it is necessary for 
                        
                           dom
                        
                        
                        f
                      to include 
                        
                           dom
                        
                        
                        h
                     . But they may be weakened in another sense: we no longer need to assume a non-empty space of results, because partial functions exist even to empty sets. 
                        Theorem 6
                        
                           Given partial functions 
                           
                              h
                              :
                              A
                              
                                 
                                    
                                 
                              
                              C
                            
                           and 
                           
                              f
                              :
                              A
                              
                                 
                                    
                                 
                              
                              B
                           
                           ,
                           
                              
                                 
                              
                           
                            ⋄

However, the proof is rather more awkward. It depends on the fact that 
                        
                           dom
                        
                        
                        (
                        g
                        ∘
                        f
                        )
                        =
                        {
                        a
                        ∈
                        
                           dom
                        
                        
                        f
                        |
                        f
                        a
                        ∈
                        
                           dom
                        
                        
                        g
                        }
                     .


                     
                        Proof
                        From left to right, suppose that 
                              h
                              =
                              g
                              ∘
                              f
                           . Then
                              
                                 
                              
                           As for the kernel inclusion, suppose 
                              (
                              a
                              ,
                              
                                 
                                    a
                                 
                                 
                                    ′
                                 
                              
                              )
                              ∈
                              
                                 ker
                              
                              
                              f
                           , so either (i) 
                              a
                              ,
                              
                                 
                                    a
                                 
                                 
                                    ′
                                 
                              
                              ∈
                              
                                 dom
                              
                              
                              f
                            and 
                              f
                              a
                              =
                              f
                              
                                 
                                    a
                                 
                                 
                                    ′
                                 
                              
                           , or (ii) 
                              a
                              ,
                              
                                 
                                    a
                                 
                                 
                                    ′
                                 
                              
                              ∉
                              
                                 dom
                              
                              
                              f
                           . In case (i), either 
                              f
                              a
                              ,
                              f
                              
                                 
                                    a
                                 
                                 
                                    ′
                                 
                              
                              ∈
                              
                                 dom
                              
                              
                              g
                           , when 
                              a
                              ,
                              
                                 
                                    a
                                 
                                 
                                    ′
                                 
                              
                              ∈
                              
                                 dom
                              
                              
                              h
                            and 
                              h
                              a
                              =
                              g
                              (
                              f
                              a
                              )
                              =
                              g
                              (
                              f
                              
                                 
                                    a
                                 
                                 
                                    ′
                                 
                              
                              )
                              =
                              h
                              
                                 
                                    a
                                 
                                 
                                    ′
                                 
                              
                           , so 
                              (
                              a
                              ,
                              
                                 
                                    a
                                 
                                 
                                    ′
                                 
                              
                              )
                              ∈
                              
                                 ker
                              
                              
                              h
                           ; or 
                              f
                              a
                              ,
                              f
                              
                                 
                                    a
                                 
                                 
                                    ′
                                 
                              
                              ∉
                              
                                 dom
                              
                              
                              g
                           , when 
                              a
                              ,
                              
                                 
                                    a
                                 
                                 
                                    ′
                                 
                              
                              ∉
                              
                                 dom
                              
                              
                              h
                           , so 
                              (
                              a
                              ,
                              
                                 
                                    a
                                 
                                 
                                    ′
                                 
                              
                              )
                              ∈
                              
                                 ker
                              
                              
                              h
                           . Finally, in case (ii), again 
                              a
                              ,
                              
                                 
                                    a
                                 
                                 
                                    ′
                                 
                              
                              ∉
                              
                                 dom
                              
                              
                              h
                            and so 
                              (
                              a
                              ,
                              
                                 
                                    a
                                 
                                 
                                    ′
                                 
                              
                              )
                              ∈
                              
                                 ker
                              
                              
                              h
                           .

From right to left, suppose that 
                              
                                 ker
                              
                              
                              h
                              ⊇
                              
                                 ker
                              
                              
                              f
                            and 
                              
                                 dom
                              
                              
                              h
                              ⊆
                              
                                 dom
                              
                              
                              f
                           ; we construct g with 
                              
                                 dom
                              
                              
                              g
                              =
                              {
                              f
                              a
                              |
                              a
                              ∈
                              
                                 dom
                              
                              
                              h
                              }
                            as follows. For 
                              b
                              ∈
                              
                                 dom
                              
                              
                              g
                           , pick any 
                              a
                              ∈
                              
                                 dom
                              
                              
                              h
                            such that 
                              f
                              a
                              =
                              b
                           , and define 
                              g
                              b
                              =
                              h
                              a
                           ; by the hypothesis, the choice of a does not affect the result (for if 
                              a
                              ,
                              
                                 
                                    a
                                 
                                 
                                    ′
                                 
                              
                              ∈
                              
                                 dom
                              
                              
                              h
                              ⊆
                              
                                 dom
                              
                              
                              f
                            with 
                              f
                              a
                              =
                              f
                              
                                 
                                    a
                                 
                                 
                                    ′
                                 
                              
                           , then 
                              (
                              a
                              ,
                              
                                 
                                    a
                                 
                                 
                                    ′
                                 
                              
                              )
                              ∈
                              
                                 ker
                              
                              
                              f
                              ⊆
                              
                                 ker
                              
                              
                              h
                            and so 
                              h
                              a
                              =
                              h
                              
                                 
                                    a
                                 
                                 
                                    ′
                                 
                              
                           ). Of course, we do not have to consider 
                              b
                              ∉
                              
                                 dom
                              
                              
                              g
                           , so we need no longer resort to classical reasoning.   ⋄

The construction in the proof of Theorem 2 essentially involves inverting f; this suggests that it might be worth exploring a presentation in terms of the relational calculus [2]. Rather than work concretely with relations as sets of pairs, as we did in Section 2 and in [6], we use the axiomatic presentation of a division allegory 
                     [5], falling back on sets of pairs only for the purposes of illustration. Formally, we consider typed relations 
                        R
                        :
                        A
                        ∼
                        B
                      ‘from A to B’; intersection 
                        R
                        ∩
                        S
                      forming a semi-lattice, and inducing inclusion 
                        R
                        ⊆
                        S
                      as a preorder on relations of a common type; identity id and composition 
                        R
                        ∘
                        S
                     , forming a monoid, with composition monotonic with respect to ⊆; converse 
                        
                           
                              R
                           
                           
                              ∘
                           
                        
                      forming an involution, contravariant with respect to composition and monotonic with respect to inclusion; and division operators 
                        R
                        /
                        S
                     , 
                        R
                        \
                        S
                      discussed in more detail below. One additional and non-obvious axiom is required, the so-called modular law 
                     
                        (
                        R
                        ∘
                        S
                        )
                        ∩
                        T
                        ⊆
                        (
                        R
                        ∩
                        (
                        T
                        ∘
                        
                           
                              S
                           
                           
                              ∘
                           
                        
                        )
                        )
                        ∘
                        S
                     .

Four special classes of relations are identified as follows:
                        
                           
                              
                              
                              
                              
                              
                                 
                                    
                                       R injective:
                                    
                                       R
                                       ∘∘R
                                       ⊆
                                       id
                                    
                                    
                                       R simple:
                                    
                                       R∘R
                                       ∘
                                       ⊆
                                       id
                                    
                                 
                                 
                                    
                                       R entire:
                                    
                                       R
                                       ∘∘R
                                       ⊇
                                       id
                                    
                                    
                                       R surjective:
                                    
                                       R∘R
                                       ∘
                                       ⊇
                                       id
                                    
                                 
                              
                           
                        
                     
                  

We say that R is coreflexive if 
                        R
                        ⊆
                        
                           id
                        
                     . The domain of a relation is defined by
                        
                           
                        
                     with the universal property that 
                        
                           dom
                        
                        
                        R
                      is the smallest coreflexive S that may be extracted as a prefactor:
                        
                           
                        
                     
                  


                     
                        Lemma 7
                        
                           
                              R
                              ∘
                              
                                 dom
                              
                              
                              R
                              =
                              R
                            
                            ⋄


                     
                        Proof
                        We have:
                              
                                 
                              
                             ⋄

Right and left division are characterised by their universal properties
                        
                           
                        
                     These are the least familiar of the operators of the relational calculus, but they are truly central: 
                        (
                        /
                        S
                        )
                      forms a Galois connection with 
                        (
                        ∘
                        S
                        )
                     , and 
                        (
                        S
                        \
                        )
                      with 
                        (
                        S
                        ∘
                        )
                     , and Galois connections—more generally, adjunctions—underlie most of the structural equivalences we use in program calculation [9].

The appropriate notion of kernel for relations in general is as follows [1]: 
                        Definition 8
                        The kernel 
                              
                                 ker
                              
                              
                              R
                            of a relation R is given by
                              
                                 
                              
                            ⋄

In terms of concrete sets of pairs, the quotients reduce to the following constructions:
                        
                           
                        
                     and therefore
                        
                           
                        
                     In particular, when R is simple, so equivalent to a partial function, this agrees with the definition of kernels in Section 3.

We identify three useful lemmas about kernels, which we will need for the proof of Theorem 12 on postfactors for simple relations, analogous to Theorem 2 and Theorem 6.


                     
                        Lemma 9
                        
                           Kernels enjoy the universal property that
                           
                              
                                 
                              
                           
                            ⋄


                     
                        Proof
                        This follows from the universal properties of the components:
                              
                                 
                              
                             ⋄


                     
                        Lemma 10
                        
                           
                              
                                 
                                    R
                                 
                                 
                                    ∘
                                 
                              
                              ∘
                              R
                              ⊆
                              
                                 ker
                              
                              
                              R
                            
                           for simple R.  ⋄


                     
                        Proof
                        We have
                              
                                 
                              
                           □


                     
                        Lemma 11
                        
                           
                              R
                              ∘
                              
                                 ker
                              
                              
                              R
                              ⊆
                              R
                            
                            ⋄


                     
                        Proof
                        We have:
                              
                                 
                              
                             ⋄


                     
                        Theorem 12
                        
                           For simple 
                           
                              T
                              :
                              A
                              ∼
                              C
                            
                           and 
                           
                              R
                              :
                              A
                              ∼
                              B
                           
                           , there exists simple 
                           
                              S
                              :
                              B
                              ∼
                              C
                            
                           with 
                           
                              T
                              =
                              S
                              ∘
                              R
                            
                           iff 
                           
                              
                                 ker
                              
                              
                              R
                              ⊆
                              
                                 ker
                              
                              
                              T
                            
                           and 
                           
                              
                                 dom
                              
                              
                              R
                              ⊇
                              
                                 dom
                              
                              
                              T
                           
                           .  ⋄


                     
                        Proof
                        From left to right, suppose 
                              T
                              =
                              S
                              ∘
                              R
                           . Then
                              
                                 
                              
                           and
                              
                                 
                              
                           (We don't actually need the assumption that R, S, and hence T are simple.) Conversely, suppose the kernel and domain inclusions on 
                              R
                              ,
                              T
                           , and define 
                              S
                              =
                              T
                              ∘
                              
                                 
                                    R
                                 
                                 
                                    ∘
                                 
                              
                           . Then 
                              T
                              =
                              S
                              ∘
                              R
                           :
                              
                                 
                              
                           Moreover, S is simple:
                              
                                 
                              
                             ⋄

Note that this proof establishes the result in the more general setting of simple relations, that is, partial rather than total functions, with no extra fuss. In contrast, the proof of Theorem 6 is rather more complicated than the proof of Theorem 2, with an awkward case analysis.

One might wonder whether the full structure of a division allegory is necessary for the postfactors result to hold: the proof in Section 4 uses division heavily, but the more concrete one in Section 2 does not. What abstract structure is actually required?


                     
                        Definition 13
                        Kernel pair


                        The categorical analogue of the kernel of a function is the kernel pair of an arrow, the pullback of the arrow along itself:
                              
                                 
                                    
                                       
                                          
                                             
                                          
                                       
                                    
                                 
                              
                            That is, the kernel pair of 
                              f
                              :
                              A
                              →
                              B
                            is an object X and arrows 
                              
                                 
                                    p
                                 
                                 
                                    0
                                 
                              
                              ,
                              
                                 
                                    p
                                 
                                 
                                    1
                                 
                              
                              :
                              X
                              →
                              A
                            satisfying 
                              f
                              ∘
                              
                                 
                                    p
                                 
                                 
                                    0
                                 
                              
                              =
                              f
                              ∘
                              
                                 
                                    p
                                 
                                 
                                    1
                                 
                              
                           , with the universal property that, for any other object Y with arrows 
                              
                                 
                                    q
                                 
                                 
                                    0
                                 
                              
                              ,
                              
                                 
                                    q
                                 
                                 
                                    1
                                 
                              
                              :
                              Y
                              →
                              A
                            satisfying 
                              f
                              ∘
                              
                                 
                                    q
                                 
                                 
                                    0
                                 
                              
                              =
                              f
                              ∘
                              
                                 
                                    q
                                 
                                 
                                    1
                                 
                              
                           , there is a unique mediating arrow 
                              r
                              :
                              Y
                              →
                              X
                            such that 
                              
                                 
                                    q
                                 
                                 
                                    0
                                 
                              
                              =
                              
                                 
                                    p
                                 
                                 
                                    0
                                 
                              
                              ∘
                              r
                            and 
                              
                                 
                                    q
                                 
                                 
                                    1
                                 
                              
                              =
                              
                                 
                                    p
                                 
                                 
                                    1
                                 
                              
                              ∘
                              r
                           .  ⋄

Such pullbacks do not always exist. They always do in 
                        S
                        
                           et
                        
                     , when the object X is just the set of pairs 
                        
                           ker
                        
                        
                        f
                      from Definition 1, and 
                        
                           
                              p
                           
                           
                              0
                           
                        
                        ,
                        
                           
                              p
                           
                           
                              1
                           
                        
                      are the left and right projections; that justifies the use of ‘
                        
                           ker
                        
                        
                        f
                     ’ for X in the commuting diagram above. More generally, a finitely complete category possesses all finite limits, and in particular pullbacks and hence kernel pairs. But for these kernel pairs to be in some sense well behaved, we need a couple of extra conditions as well.


                     
                        Definition 14
                        Epimorphism, monomorphism


                        An arrow 
                              g
                              :
                              B
                              →
                              C
                            is an epimorphism if it is right-cancellable, in the sense that for any 
                              
                                 
                                    h
                                 
                                 
                                    0
                                 
                              
                              ,
                              
                                 
                                    h
                                 
                                 
                                    1
                                 
                              
                              :
                              C
                              →
                              D
                           , if 
                              
                                 
                                    h
                                 
                                 
                                    0
                                 
                              
                              ∘
                              g
                              =
                              
                                 
                                    h
                                 
                                 
                                    1
                                 
                              
                              ∘
                              g
                            then 
                              
                                 
                                    h
                                 
                                 
                                    0
                                 
                              
                              =
                              
                                 
                                    h
                                 
                                 
                                    1
                                 
                              
                           .
                              
                                 
                                    
                                       
                                          
                                             
                                          
                                       
                                    
                                 
                              
                            Dually, g is a monomorphism if it is left-cancellable: for any 
                              
                                 
                                    f
                                 
                                 
                                    0
                                 
                              
                              ,
                              
                                 
                                    f
                                 
                                 
                                    1
                                 
                              
                              :
                              A
                              →
                              B
                           , if 
                              g
                              ∘
                              
                                 
                                    f
                                 
                                 
                                    0
                                 
                              
                              =
                              g
                              ∘
                              
                                 
                                    f
                                 
                                 
                                    1
                                 
                              
                            then 
                              
                                 
                                    f
                                 
                                 
                                    0
                                 
                              
                              =
                              
                                 
                                    f
                                 
                                 
                                    1
                                 
                              
                           .  ⋄


                     
                        Definition 15
                        Coequaliser


                        We say that arrow 
                              g
                              :
                              B
                              →
                              C
                            
                           coequalises a parallel pair of arrows 
                              
                                 
                                    f
                                 
                                 
                                    0
                                 
                              
                              ,
                              
                                 
                                    f
                                 
                                 
                                    1
                                 
                              
                              :
                              A
                              →
                              B
                            if 
                              g
                              ∘
                              
                                 
                                    f
                                 
                                 
                                    0
                                 
                              
                              =
                              g
                              ∘
                              
                                 
                                    f
                                 
                                 
                                    1
                                 
                              
                           . The coequaliser of 
                              
                                 
                                    f
                                 
                                 
                                    0
                                 
                              
                              ,
                              
                                 
                                    f
                                 
                                 
                                    1
                                 
                              
                            is a universal such C and g—that is, for any other object D and arrow 
                              h
                              :
                              B
                              →
                              D
                            that coequalises 
                              
                                 
                                    f
                                 
                                 
                                    0
                                 
                              
                              ,
                              
                                 
                                    f
                                 
                                 
                                    1
                                 
                              
                           , there is a unique mediating arrow 
                              r
                              :
                              C
                              →
                              D
                            such that 
                              h
                              =
                              r
                              ∘
                              g
                           .
                              
                                 
                                    
                                       
                                          
                                             
                                          
                                       
                                    
                                 
                              
                             ⋄

In 
                        S
                        
                           et
                        
                     , the coequaliser object C is the quotient of B by the smallest equivalence relation ≡ such that 
                        ∀
                        a
                        ∈
                        A
                        ∘
                        
                           
                              f
                           
                           
                              0
                           
                        
                        a
                        ≡
                        
                           
                              f
                           
                           
                              1
                           
                        
                        a
                     ; that is, the reflexive, symmetric, transitive closure of the relation induced by 
                        
                           
                              f
                           
                           
                              0
                           
                        
                        ,
                        
                           
                              f
                           
                           
                              1
                           
                        
                     . It is an instructive exercise to verify that the coequaliser is necessarily an epimorphism (whatever the category). Not all epimorphisms arise as coequalisers; those that do are called the regular epimorphisms.


                     
                        Definition 16
                        Regular category


                        A regular category is one: that is finitely complete (so in particular has all kernel pairs); in which every kernel pair has a coequaliser; and in which regular epimorphisms are stable under pullbacks—that is, if g in the commuting diagram below is a regular epimorphism, then so is 
                              
                                 
                                    p
                                 
                                 
                                    1
                                 
                              
                           .
                              
                                 
                                    
                                       
                                          
                                             
                                          
                                       
                                    
                                 
                              
                            The category 
                              S
                              
                                 et
                              
                            is regular.  ⋄


                     
                        Definition 17
                        Relation


                        One can define a notion of ‘relation’ 
                              R
                              :
                              A
                              ∼
                              B
                            via a span 
                              A
                              ←
                              R
                              →
                              B
                           : in a Cartesian category (that is, one with products), R is modelled as a monomorphism 
                              
                            into the product:
                              
                                 
                                    
                                       
                                          
                                             
                                          
                                       
                                    
                                 
                              
                            (To be more precise, one should consider equivalence classes of such spans under isomorphisms between their apices R. One can also remove the dependence on products by requiring that the two legs of the span are jointly monic, suitably defined.)  ⋄

In 
                        S
                        
                           et
                        
                     , this directly corresponds to thinking of R as a subset of 
                        A
                        ×
                        B
                     . But constructing the composition of relations involves taking a pullback of spans:
                        
                           
                              
                                 
                                    
                                       
                                    
                                 
                              
                           
                        
                      (and then taking the ‘image’, as discussed above: the arrow from the apex to 
                        A
                        ×
                        C
                      is typically not a monomorphism); in order for this composition to be associative, one needs the additional well-behavedness properties of a regular category [5, §1.569]. So regular categories are a somewhat necessary phenomenon in thinking about relational programming; for a recent crisp summary, see [7, Section 2].


                     
                        Definition 18
                        Partial map


                        Similarly, one can define a partial map 
                           
                              f
                              :
                              A
                              
                                 
                                    
                                 
                              
                              B
                            in a category as a span with a monomorphic left leg:
                              
                                 
                                    
                                       
                                          
                                             
                                          
                                       
                                    
                                 
                              
                            writing 
                              
                                 
                                    f
                                 
                                 ‾
                              
                              :
                              
                                 dom
                              
                              
                              f
                              →
                              B
                            for the restriction of f to its domain (again, up to equivalences arising from isomorphisms on the apices). Composition is again constructed by pullbacks of spans.  ⋄


                     
                        Lemma 19
                        Image factorisation


                        
                           An important result about regular categories is that every arrow 
                           
                              f
                              :
                              A
                              →
                              B
                            
                           factorises into a regular epimorphism followed by a monomorphism.
                           
                              
                                 
                                    
                                       
                                          
                                             
                                          
                                       
                                    
                                 
                              
                            
                           Indeed, an alternative chacterisation of regular categories is that they have finite limits and image factorisations, stable under pullbacks.  ⋄

In 
                        S
                        
                           et
                        
                     , 
                        
                           img
                        
                        
                        f
                      is 
                        
                           
                              A
                           
                           
                              /
                              f
                           
                        
                     , the quotient of A into equivalence classes according to f; that is, two elements 
                        a
                        ,
                        
                           
                              a
                           
                           
                              ′
                           
                        
                        ∈
                        A
                      are equivalent iff 
                        f
                        a
                        =
                        f
                        
                           
                              a
                           
                           
                              ′
                           
                        
                      (in other words, 
                        (
                        a
                        ,
                        
                           
                              a
                           
                           
                              ′
                           
                        
                        )
                        ∈
                        
                           ker
                        
                        
                        f
                     ). So one can think of e as taking an element of A to its equivalence class, and m mapping this class into B. Equivalently, one can think of e as being f but with the target restricted precisely to the range of f, and m as the embedding of the range back into the target: 
                        
                           
                              A
                           
                           
                              /
                              f
                           
                        
                      is isomorphic to 
                        
                           ran
                        
                        
                        f
                     . For more about image factorisation, see Taylor [13].


                     
                        Theorem 20
                        
                           Given arrows 
                           
                              f
                              :
                              A
                              →
                              B
                            
                           and 
                           
                              h
                              :
                              A
                              →
                              C
                            
                           in a regular category, there exists a partial map 
                           
                              g
                              :
                              B
                              
                                 
                                    
                                 
                              
                              C
                            
                           such that 
                           
                              h
                              =
                              g
                              ∘
                              f
                            
                           if and only if there exists an arrow 
                           
                              i
                              :
                              
                                 ker
                              
                              
                              f
                              →
                              
                                 ker
                              
                              
                              h
                            
                           satisfying 
                           
                              
                                 
                                    p
                                 
                                 
                                    0
                                 
                              
                              =
                              
                                 
                                    q
                                 
                                 
                                    0
                                 
                              
                              ∘
                              i
                            
                           and 
                           
                              
                                 
                                    p
                                 
                                 
                                    1
                                 
                              
                              =
                              
                                 
                                    q
                                 
                                 
                                    1
                                 
                              
                              ∘
                              i
                           
                           , where 
                           
                              
                                 
                                    p
                                 
                                 
                                    0
                                 
                              
                              ,
                              
                                 
                                    p
                                 
                                 
                                    1
                                 
                              
                            
                           and 
                           
                              
                                 
                                    q
                                 
                                 
                                    0
                                 
                              
                              ,
                              
                                 
                                    q
                                 
                                 
                                    1
                                 
                              
                            
                           are the kernel pairs of f and h respectively.  ⋄


                     
                        Proof
                        The situation is illustrated in the diagram below:
                              
                                 
                                    
                                       
                                          
                                             
                                          
                                       
                                    
                                 
                              
                            From right to left, suppose we are given i making the two upper left triangles commute; we construct g as follows. Let 
                              m
                              ∘
                              e
                            be the image factorisation of f (making the lower left triangle commute), so that e is the coequaliser of 
                              
                                 
                                    p
                                 
                                 
                                    0
                                 
                              
                              ,
                              
                                 
                                    p
                                 
                                 
                                    1
                                 
                              
                           . Now h also coequalises 
                              
                                 
                                    p
                                 
                                 
                                    0
                                 
                              
                              ,
                              
                                 
                                    p
                                 
                                 
                                    1
                                 
                              
                           :
                              
                                 
                              
                           so by the universal property of the coequaliser there exists a unique mediating arrow 
                              k
                              :
                              
                                 img
                              
                              
                              f
                              →
                              C
                            making the upper right triangle commute. We define partial map 
                              g
                              :
                              B
                              
                                 
                                    
                                 
                              
                              C
                            to be the span 
                              
                           .

We have to show that 
                              h
                              =
                              g
                              ∘
                              f
                            as partial maps. Since f and h are in fact total, their domain coincides with their source, and the monomorphic left legs of the spans are the identity. So for the composition 
                              g
                              ∘
                              f
                           , we have the following situation:
                              
                                 
                                    
                                       
                                          
                                             
                                          
                                       
                                    
                                 
                              
                            and we have to show that the outer span equals h. Let us factor f into 
                              m
                              ∘
                              e
                           , and see what effect this has on the pullback diamond:
                              
                                 
                                    
                                       
                                          
                                             
                                          
                                       
                                    
                                 
                              
                            We use two simple standard facts about pullbacks, both of which are straightforward to prove. Firstly, the pullback of a monomorphism along itself is the identity; so 
                              Y
                              =
                              
                                 img
                              
                              
                              f
                           , and 
                              c
                              =
                              d
                              =
                              
                                 id
                              
                           . Secondly, a pullback of the identity (c) is again the identity; so 
                              a
                              =
                              
                                 id
                              
                           , and hence 
                              X
                              =
                              A
                            and 
                              b
                              =
                              e
                           . Therefore, the outer span is indeed 
                              
                            as required.

Conversely, given 
                              h
                              =
                              g
                              ∘
                              f
                           , and kernel pairs 
                              
                                 
                                    p
                                 
                                 
                                    0
                                 
                              
                              ,
                              
                                 
                                    p
                                 
                                 
                                    1
                                 
                              
                            for f and 
                              
                                 
                                    q
                                 
                                 
                                    0
                                 
                              
                              ,
                              
                                 
                                    q
                                 
                                 
                                    1
                                 
                              
                            for h, we construct the mapping 
                              i
                              :
                              
                                 ker
                              
                              
                              f
                              →
                              
                                 ker
                              
                              
                              h
                            as follows:
                              
                                 
                                    
                                       
                                          
                                             
                                          
                                       
                                    
                                 
                              
                            We have that 
                              
                                 
                                    p
                                 
                                 
                                    0
                                 
                              
                              ,
                              
                                 
                                    p
                                 
                                 
                                    1
                                 
                              
                            form a cone over 
                              
                           :
                              
                                 
                              
                           so by the universal property of the pullback, there exists a (unique) mediating arrow 
                              i
                              :
                              
                                 ker
                              
                              
                              f
                              →
                              
                                 ker
                              
                              
                              h
                            making the triangles 
                              
                                 
                                    p
                                 
                                 
                                    0
                                 
                              
                              =
                              
                                 
                                    q
                                 
                                 
                                    0
                                 
                              
                              ∘
                              i
                            and 
                              
                                 
                                    p
                                 
                                 
                                    1
                                 
                              
                              =
                              
                                 
                                    q
                                 
                                 
                                    1
                                 
                              
                              ∘
                              i
                            commute.   ⋄

Have we gained anything by abstracting from 
                        S
                        
                           et
                        
                      to regular categories? If 
                        S
                        
                           et
                        
                      were the only regular category, the answer would be ‘no’ (or at least, ‘not much’: it is still nice to see precisely which axioms are used, even if those axioms admit just one model). However, it is a standard result [3] that any category of Eilenberg–Moore algebras over 
                        S
                        
                           et
                        
                      is also regular. In particular, one can think of partial functions over sets as point-preserving total functions over pointed sets, which are the homomorphisms between algebras for the monad 
                        (
                        1
                        +
                        )
                     ; therefore the category 
                        P
                        
                           fun
                        
                      of sets and partial functions is equivalent to the category of Eilenberg–Moore algebras for this monad, and hence is regular. So the categorical story is more flexible; we can instantiate it for free at least to partial functions.

@&#CONCLUSIONS@&#

I presented a preliminary version of Section 2 at Meeting #55 of IFIP WG2.1 in Cochabamba in January 2001; Lambert Meertens simplified my proofs there. The work was subsequently published at CMCS 2001 [6], jointly written with Graham Hutton and Thorsten Altenkirch, whose contributions were invaluable. Bart Jacobs also made some helpful observations about congruences and images, pointing me towards his paper [8].

Thanks to comments received at CMCS, I saw how to generalise from total functions to partial functions; I presented the more general results at Meeting #56 of WG2.1, in Ameland in September 2001—precisely while the tragedy of the twin towers was unfolding. Roland Backhouse encouraged me there to use the relational definition 
                        
                           ker
                        
                        
                        R
                        =
                        (
                        R
                        \
                        R
                        )
                        ∩
                        
                           
                              (
                              R
                              \
                              R
                              )
                           
                           
                              ∘
                           
                        
                      of kernels from Section 4, but we didn't manage to complete the proof in the relational style at the meeting. (This notion of kernel turns out to date back at least to 1948 [12]; it is a special case 
                        
                           ker
                        
                        
                        R
                        =
                        
                           syq
                        
                        (
                        R
                        ,
                        R
                        )
                      of the ‘symmetric quotient’ used by Schmidt and by Winter in this volume.) In October 2005, José Oliveira invited me to take part in a PURe Workshop in Braga; that was the spur I needed to complete the relational proofs (helped by Shin-Cheng Mu), which I presented there. José liked the results, because it turned out to be related to work he was doing on pointfree functional dependency theory [10]; he encouraged me to write those results up, but I've never had the excuse to make time for it—until now! (Note that the relational definition of kernels used here is in general incomparable to the definition 
                        
                           ker
                        
                        
                        R
                        =
                        
                           
                              R
                           
                           
                              ∘
                           
                        
                        ∘
                        R
                      used by José himself [10,11]
                  

as a stepping stone towards his ‘injectivity preorder’ on relations.)

For help with the categorical construction, I am indebted to Maciej Piróg for pointing me towards regular categories; to James McKinna, Ohad Kammar, and Bob Harper, for enlightening discussions; and especially to Sam Staton, who sketched out the proof of Theorem 20 for me.

@&#ACKNOWLEDGEMENTS@&#

This work was partially supported by EPSRC grants Datatype-Generic Programming (GR/S27078/01) and A Theory of Least Change for Bidirectional Transformations (EP/K020919/1).

@&#REFERENCES@&#

