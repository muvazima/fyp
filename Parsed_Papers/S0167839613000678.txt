@&#MAIN-TITLE@&#A second order geometric method for ray/parametric surface intersection

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           A novel second order method is proposed to compute the intersection between a ray and a parametric surface using the second order approximation.


                        
                        
                           
                           It is a geometric iteration scheme which is less sensitive to initial conditions than Newton–Raphson and Halley methods.


                        
                        
                           
                           It handles cases that Newton–Raphson or Halley method fails to do: inappropriate initial condition, tangential and multiple intersections.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Ray/surface intersection

Curvature

Numerical method

Second order approximation

Newton–Raphson method

Halley method

@&#ABSTRACT@&#


               
               
                  In this paper, a new method for computing intersection between a ray and a parametric surface is proposed, which finds many applications in computer graphics, robotics and geometric modeling. The method uses the second order derivative of the surface, which can handle inherent problems that Newton–Raphson and Halley methods have such as instability caused by inappropriate initial conditions and tangential intersection. Case examples are presented to demonstrate the capability of the proposed method.
               
            

@&#INTRODUCTION@&#

Ray and surface intersection has been an important topic for various applications in computer graphics, robotics and geometric modeling including ray tracing, point classification, collision detection and surface interrogation, where efficient and robust computation of accurate intersection between them is a key issue.

The ray and surface intersection problem is formulated as a system of equations, which can be solved in various ways. The analytic solution, however, is hard to obtain in most cases. Therefore, numerical techniques, which are designed to compute approximate solutions with some accuracy, are widely used.

The existing numerical solution methods can be categorized with respect to the order of derivatives required for solving the governing equation of the ray and surface intersection: the category of the zeroth order includes those based on subdivision. They use geometric information of the ray and the surface without derivatives. Methods by Fougerolle et al. (2008), Nishita et al. (1990), Rogers (1985), Whitted (1980), Woodward (1989) belong to this category. The convex hull of Bézier representation is used as a surface bound for intersection computation (Nishita et al., 1990; Whitted, 1980; Woodward, 1989). The quasi-interpolating scheme (Rogers, 1985) is considered to approximately represent a surface with a set of polygons for efficient approximate intersection, which can be given as input to an iteration-based root finding method. These algorithms are a global scheme in that they can compute all the intersections in the domain. They are frequently used in order to provide the starting condition for Newton–Raphson based iteration methods. However, they are time consuming since all the algorithms require bound computation and subdivision of the underlying surface, which are expensive operations. Also, the convergence to the solution is slow.

The representative algorithm using the first order derivatives of the surface and the ray is Newton–Raphson method. Since it is easy to implement and shows quadratic convergence to a local solution, it has been widely used for various applications from ray tracing to collision detection. Many approaches (Barth et al., 1994; Barth and Sturzlinger, 1993; Fougerolle et al., 2008; Giger, 1989; Joy and Bhetanabhotla, 1986; Lischinski and Gonczarowski, 1990; Sweeney and Bartels, 1986; Toth, 1985; Woodward, 1989) in the literature are based on Newton–Raphson method for computing ray–surface intersection. Despite several advantages that Newton–Raphson method can provide, there are a couple of problems still addressed in the literature. The convergence to the correct solution is not guaranteed when the given initial condition for iteration is inappropriate. Or even the method may crash depending on the initial conditions. Much research has been performed to improve robustness of Newton–Raphson method by using interval arithmetic (Barth and Sturzlinger, 1993; Fougerolle et al., 2008; Giger, 1989) or quasi-Newton method (Toth, 1985). Another limitation of Newton–Raphson method is that it is not able to handle the case when a ray intersects a surface tangentially. In this case, the Jacobian matrix of Newton–Raphson scheme becomes ill-conditioned as the iteration approaches the solution, resulting in unstable behaviors and eventually crashing the computation. However, this limitation is not sufficiently discussed in the previous related studies. Qin et al. (1997) improved the efficiency of Newton–Raphson scheme by introducing the polynomial extrapolation. But, the robustness of Newton–Raphson method is not addressed.

As a second order derivative algorithm, Halley method is frequently considered. The basic scheme is similar to Newton–Raphson method. However, by incorporating the second order derivative terms in the iteration, Halley method shows a faster rate of convergence for finding a single isolated root. Multivariate Halley method and its implementation strategy are presented in the paper by Cuyt and Rall (1985). However, this method requires Jacobian matrix in the computation. Therefore, it cannot avoid the issues associated with singular Jacobian matrix that Newton–Raphson method experiences.

The objective of this paper is to propose a novel algorithm of computing the ray–surface intersection. The surface is given as a parametric form such as NURBS, which is widely used in computer graphics and CAD. The method can handle cases that Newton–Raphson and Halley methods cannot do at a small amount of additional cost compared to Newton–Raphson or Halley method. The proposed method is a local iterative scheme similar to Newton–Raphson method. However, the proposed method uses the second order approximation which approximates the surface more accurately, making it more robust than Newton–Raphson or Halley method.

A ray 
                           l
                           (
                           t
                           )
                         in a space is defined as 
                           l
                           (
                           t
                           )
                           =
                           O
                           +
                           d
                           t
                        , t⩾ 0, where O is the starting point and d is the direction. When 
                           t
                           <
                           0
                        , it is assumed that the ray is not defined and no intersection is considered for the region.

Consider a parametric curve 
                           c
                           (
                           s
                           )
                         (
                           0
                           ⩽
                           s
                           ⩽
                           1
                        ), where s is a parameter. At a point on the curve at 
                           s
                           =
                           
                              
                                 s
                              
                              
                                 0
                              
                           
                        , the curve around the point is expressed by the Taylor expansion as follows:
                           
                              (1)
                              
                                 c
                                 (
                                 s
                                 )
                                 =
                                 c
                                 (
                                 
                                    
                                       s
                                    
                                    
                                       0
                                    
                                 
                                 )
                                 +
                                 
                                    
                                       d
                                       c
                                    
                                    
                                       d
                                       s
                                    
                                 
                                 Δ
                                 s
                                 +
                                 
                                    1
                                    
                                       2
                                       !
                                    
                                 
                                 
                                    
                                       
                                          
                                             d
                                          
                                          
                                             2
                                          
                                       
                                       c
                                    
                                    
                                       d
                                       
                                          
                                             s
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 Δ
                                 
                                    
                                       s
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 
                                    1
                                    
                                       3
                                       !
                                    
                                 
                                 
                                    
                                       
                                          
                                             d
                                          
                                          
                                             3
                                          
                                       
                                       c
                                    
                                    
                                       d
                                       
                                          
                                             s
                                          
                                          
                                             3
                                          
                                       
                                    
                                 
                                 Δ
                                 
                                    
                                       s
                                    
                                    
                                       3
                                    
                                 
                                 +
                                 HOT
                                 .
                              
                           
                         The shape of the curve in the neighborhood of 
                           c
                           (
                           
                              
                                 s
                              
                              
                                 0
                              
                           
                           )
                         can be approximated by Eq. (1) while the high order terms (HOT) are ignored. If s is the arc length parameter λ, then
                           
                              (2)
                              
                                 
                                    
                                       c
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 
                                    
                                       d
                                       c
                                    
                                    
                                       d
                                       λ
                                    
                                 
                                 =
                                 t
                                 ,
                                 
                                 
                                    
                                       c
                                    
                                    
                                       ″
                                    
                                 
                                 =
                                 
                                    
                                       d
                                       t
                                    
                                    
                                       d
                                       λ
                                    
                                 
                                 =
                                 κ
                                 n
                                 .
                              
                           
                         Here the prime ′ indicates the differentiation with respect to λ, t and n are the unit tangent and normal vectors and κ is the curvature.

Given a parametric surface 
                           r
                           (
                           u
                           ,
                           v
                           )
                         (
                           0
                           ⩽
                           u
                           ,
                           v
                           ⩽
                           1
                        ), a curve on the surface with the arc length parameter λ is given by 
                           c
                           (
                           λ
                           )
                           =
                           r
                           (
                           u
                           (
                           λ
                           )
                           ,
                           v
                           (
                           λ
                           )
                           )
                        . Then the local shape of the curve near a point on the curve is represented by using Eq. (1). Note that instead of representing exact 
                           c
                           (
                           λ
                           )
                         explicitly, the local shape of the curve can be approximated by taking the terms of the zero, first and second derivatives in Eq. (1), which are computed by using the surface as follows:
                           
                              (3)
                              
                                 
                                    
                                       c
                                    
                                    
                                       ′
                                    
                                 
                                 (
                                 λ
                                 )
                                 =
                                 
                                    
                                       r
                                    
                                    
                                       u
                                    
                                 
                                 
                                    
                                       u
                                    
                                    
                                       ′
                                    
                                 
                                 +
                                 
                                    
                                       r
                                    
                                    
                                       v
                                    
                                 
                                 
                                    
                                       v
                                    
                                    
                                       ′
                                    
                                 
                                 ,
                              
                           
                        
                        
                           
                              (4)
                              
                                 
                                    
                                       c
                                    
                                    
                                       ″
                                    
                                 
                                 (
                                 λ
                                 )
                                 =
                                 
                                    
                                       r
                                    
                                    
                                       u
                                       u
                                    
                                 
                                 
                                    
                                       (
                                       
                                          
                                             u
                                          
                                          
                                             ′
                                          
                                       
                                       )
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 2
                                 
                                    
                                       r
                                    
                                    
                                       u
                                       v
                                    
                                 
                                 
                                    
                                       u
                                    
                                    
                                       ′
                                    
                                 
                                 
                                    
                                       v
                                    
                                    
                                       ′
                                    
                                 
                                 +
                                 
                                    
                                       r
                                    
                                    
                                       v
                                       v
                                    
                                 
                                 
                                    
                                       (
                                       
                                          
                                             v
                                          
                                          
                                             ′
                                          
                                       
                                       )
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 
                                    
                                       r
                                    
                                    
                                       u
                                       u
                                    
                                 
                                 
                                    
                                       u
                                    
                                    
                                       ″
                                    
                                 
                                 +
                                 
                                    
                                       r
                                    
                                    
                                       v
                                       v
                                    
                                 
                                 
                                    
                                       v
                                    
                                    
                                       ″
                                    
                                 
                                 .
                              
                           
                         Here, the subscripts indicate the partial derivatives.

Newton–Raphson method can be used to solve a system of multivariate nonlinear equations. Consider a system of equations 
                           F
                           (
                           X
                           )
                           =
                           0
                           ,
                           F
                           :
                           
                              
                                 R
                              
                              
                                 k
                              
                           
                           →
                           
                              
                                 R
                              
                              
                                 k
                              
                           
                        , 
                           X
                           ∈
                           
                              
                                 R
                              
                              
                                 k
                              
                           
                        , where k is a positive integer. Suppose that 
                           X
                           +
                           Δ
                           X
                         is the root of the equations, namely 
                           F
                           (
                           X
                           +
                           Δ
                           X
                           )
                           =
                           0
                        . Using the expression of 
                           F
                           (
                           X
                           +
                           Δ
                           X
                           )
                         by the Taylor expansion around X, the following equation is obtained:
                           
                              (6)
                              
                                 F
                                 (
                                 X
                                 +
                                 Δ
                                 X
                                 )
                                 =
                                 F
                                 (
                                 X
                                 )
                                 +
                                 J
                                 ⋅
                                 Δ
                                 X
                                 +
                                 HOT
                                 ,
                              
                           
                         where J is the Jacobian matrix of F and HOT indicates the high order terms. Ignoring HOT, the equation becomes
                           
                              (7)
                              
                                 F
                                 (
                                 X
                                 )
                                 +
                                 J
                                 ⋅
                                 Δ
                                 X
                                 =
                                 0
                                 .
                              
                           
                         The amount of update 
                           Δ
                           X
                         is computed by
                           
                              (8)
                              
                                 Δ
                                 X
                                 =
                                 −
                                 
                                    
                                       J
                                    
                                    
                                       −
                                       1
                                    
                                 
                                 ⋅
                                 F
                                 (
                                 X
                                 )
                                 .
                              
                           
                         The updated root is given by 
                           
                              
                                 X
                              
                              
                                 new
                              
                           
                           =
                           
                              
                                 X
                              
                              
                                 old
                              
                           
                           +
                           Δ
                           X
                        . This process starts with an initial vector of 
                           
                              
                                 X
                              
                              
                                 0
                              
                           
                         and is repeated until 
                           |
                           Δ
                           X
                           |
                         becomes small. Newton–Raphson method shows the quadratic convergence to an isolated single root. It is, however, a local scheme. So, it is usually employed for computing one solution of interest in the domain of interest.

The basic idea of Halley method is to use the second order derivative terms to achieve the cubic convergence for finding a root. For a single isolated root, this method shows the cubic convergence. Consider a system of equations 
                           F
                           (
                           X
                           )
                           =
                           0
                        ,
                           F
                           :
                           
                              
                                 R
                              
                              
                                 k
                              
                           
                           →
                           
                              
                                 R
                              
                              
                                 k
                              
                           
                        , 
                           X
                           ∈
                           
                              
                                 R
                              
                              
                                 k
                              
                           
                        , where k is a positive integer. Then 
                           F
                           =
                           (
                           
                              
                                 f
                              
                              
                                 1
                              
                           
                           ,
                           
                              
                                 f
                              
                              
                                 2
                              
                           
                           ,
                           …
                           ,
                           
                              
                                 f
                              
                              
                                 k
                              
                           
                           )
                         and 
                           X
                           =
                           (
                           
                              
                                 x
                              
                              
                                 1
                              
                           
                           ,
                           …
                           ,
                           
                              
                                 x
                              
                              
                                 k
                              
                           
                           )
                        . The update for the Halley method 
                           Δ
                           X
                         is formulated as:
                           
                              (9)
                              
                                 Δ
                                 X
                                 =
                                 
                                    
                                       
                                          Q
                                       
                                       
                                          2
                                       
                                    
                                    
                                       Q
                                       +
                                       
                                          1
                                          2
                                       
                                       b
                                    
                                 
                                 .
                              
                           
                         Here, Q is the Newton–Raphson update given by
                           
                              (10)
                              
                                 Q
                                 =
                                 −
                                 
                                    
                                       J
                                    
                                    
                                       −
                                       1
                                    
                                 
                                 ⋅
                                 F
                                 (
                                 X
                                 )
                                 ,
                              
                           
                         
                        b is the combination of Q and Hessian matrix H of 
                           
                              
                                 f
                              
                              
                                 i
                              
                           
                         such that
                           
                              (11)
                              
                                 b
                                 =
                                 
                                    
                                       J
                                    
                                    
                                       −
                                       1
                                    
                                 
                                 ⋅
                                 
                                    [
                                    
                                       
                                          Q
                                       
                                       
                                          T
                                       
                                    
                                    ⊗
                                    H
                                    ]
                                 
                                 Q
                                 .
                              
                           
                         Here,
                           
                              (12)
                              
                                 
                                    
                                       Q
                                    
                                    
                                       T
                                    
                                 
                                 ⊗
                                 H
                                 =
                                 
                                    [
                                    
                                       
                                          
                                             
                                                
                                                   Q
                                                
                                                
                                                   T
                                                
                                             
                                             ⋅
                                             H
                                             (
                                             
                                                
                                                   f
                                                
                                                
                                                   1
                                                
                                             
                                             )
                                          
                                       
                                       
                                          
                                             
                                                
                                                   Q
                                                
                                                
                                                   T
                                                
                                             
                                             ⋅
                                             H
                                             (
                                             
                                                
                                                   f
                                                
                                                
                                                   2
                                                
                                             
                                             )
                                          
                                       
                                       
                                          
                                             ⋯
                                          
                                       
                                       
                                          
                                             
                                                
                                                   Q
                                                
                                                
                                                   T
                                                
                                             
                                             ⋅
                                             H
                                             (
                                             
                                                
                                                   f
                                                
                                                
                                                   k
                                                
                                             
                                             )
                                          
                                       
                                    
                                    ]
                                 
                                 ,
                                 
                                 H
                                 (
                                 
                                    
                                       f
                                    
                                    
                                       l
                                    
                                 
                                 )
                                 =
                                 
                                    [
                                    
                                       
                                          
                                             
                                                ∂
                                             
                                             
                                                2
                                             
                                          
                                          
                                             
                                                f
                                             
                                             
                                                l
                                             
                                          
                                       
                                       
                                          ∂
                                          
                                             
                                                x
                                             
                                             
                                                m
                                             
                                          
                                          ∂
                                          
                                             
                                                x
                                             
                                             
                                                n
                                             
                                          
                                       
                                    
                                    ]
                                 
                                 
                                 (
                                 l
                                 ,
                                 m
                                 ,
                                 n
                                 =
                                 1
                                 ,
                                 …
                                 ,
                                 k
                                 )
                                 .
                              
                           
                         In Eq. (9), the component-wise operations are employed. If 
                           V
                           =
                           (
                           
                              
                                 v
                              
                              
                                 1
                              
                           
                           ,
                           
                              
                                 v
                              
                              
                                 2
                              
                           
                           ,
                           …
                           ,
                           
                              
                                 v
                              
                              
                                 k
                              
                           
                           )
                         and 
                           W
                           =
                           (
                           
                              
                                 w
                              
                              
                                 1
                              
                           
                           ,
                           
                              
                                 w
                              
                              
                                 2
                              
                           
                           ,
                           …
                           ,
                           
                              
                                 w
                              
                              
                                 k
                              
                           
                           )
                        , then
                           
                              
                                 
                                    VW
                                 
                                 =
                                 (
                                 
                                    
                                       v
                                    
                                    
                                       1
                                    
                                 
                                 
                                    
                                       w
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       v
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       w
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    
                                       v
                                    
                                    
                                       k
                                    
                                 
                                 
                                    
                                       w
                                    
                                    
                                       k
                                    
                                 
                                 )
                                 ,
                                 
                                 
                                    
                                       V
                                    
                                    
                                       2
                                    
                                 
                                 =
                                 
                                    VV
                                 
                              
                           
                         and
                           
                              
                                 
                                    V
                                    W
                                 
                                 =
                                 
                                    (
                                    
                                       
                                          
                                             v
                                          
                                          
                                             1
                                          
                                       
                                       
                                          
                                             w
                                          
                                          
                                             1
                                          
                                       
                                    
                                    ,
                                    
                                       
                                          
                                             v
                                          
                                          
                                             2
                                          
                                       
                                       
                                          
                                             w
                                          
                                          
                                             2
                                          
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       
                                          
                                             v
                                          
                                          
                                             k
                                          
                                       
                                       
                                          
                                             w
                                          
                                          
                                             k
                                          
                                       
                                    
                                    )
                                 
                                 ,
                                 
                                 
                                    
                                       w
                                    
                                    
                                       l
                                    
                                 
                                 ≠
                                 0
                                 .
                              
                           
                         The updated root is 
                           
                              
                                 X
                              
                              
                                 new
                              
                           
                           =
                           
                              
                                 X
                              
                              
                                 old
                              
                           
                           +
                           Δ
                           X
                        . This process is repeated until 
                           |
                           Δ
                           X
                           |
                         is less than a user-defined tolerance.

In this section, ray–planar curve intersection is discussed. This problem is introduced in order to provide the basic idea of the proposed method of solving the ray–surface intersection problem.

The intersection between a ray and a planar curve is obtained by solving
                        
                           (13)
                           
                              F
                              (
                              s
                              ,
                              t
                              )
                              =
                              c
                              (
                              s
                              )
                              −
                              l
                              (
                              t
                              )
                              =
                              0
                              .
                           
                        
                      Here, 
                        F
                        (
                        s
                        ,
                        t
                        )
                        =
                        
                           
                              (
                              
                                 
                                    F
                                 
                                 
                                    x
                                 
                              
                              (
                              s
                              ,
                              t
                              )
                              ,
                              
                                 
                                    F
                                 
                                 
                                    y
                                 
                              
                              (
                              s
                              ,
                              t
                              )
                              )
                           
                           
                              T
                           
                        
                      and if either s or t is out of range then they do not intersect. For solving Eq. (13), we consider four methods: Newton–Raphson, Halley, the first order and the second order methods.

Given 
                           X
                           =
                           
                              
                                 (
                                 s
                                 ,
                                 t
                                 )
                              
                              
                                 T
                              
                           
                        , the amount of update for X, denoted by 
                           Δ
                           X
                        , is computed by solving Eq. (8). The Jacobian matrix J of F is given by
                           
                              (14)
                              
                                 J
                                 =
                                 
                                    [
                                    
                                       
                                          
                                             
                                                
                                                   ∂
                                                   
                                                      
                                                         F
                                                      
                                                      
                                                         x
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   s
                                                
                                             
                                          
                                          
                                             
                                                
                                                   ∂
                                                   
                                                      
                                                         F
                                                      
                                                      
                                                         x
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   t
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   ∂
                                                   
                                                      
                                                         F
                                                      
                                                      
                                                         y
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   s
                                                
                                             
                                          
                                          
                                             
                                                
                                                   ∂
                                                   
                                                      
                                                         F
                                                      
                                                      
                                                         y
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   t
                                                
                                             
                                          
                                       
                                    
                                    ]
                                 
                                 .
                              
                           
                         The updated 
                           
                              
                                 X
                              
                              
                                 new
                              
                           
                         is 
                           
                              
                                 X
                              
                              
                                 new
                              
                           
                           =
                           
                              
                                 X
                              
                              
                                 old
                              
                           
                           +
                           Δ
                           X
                        . Given the initial vector 
                           
                              
                                 X
                              
                              
                                 0
                              
                           
                        , the prescribed procedure is performed iteratively until 
                           |
                           Δ
                           X
                           |
                           <
                           δ
                        , where δ is the user defined tolerance.

Given 
                           X
                           =
                           
                              
                                 (
                                 s
                                 ,
                                 t
                                 )
                              
                              
                                 T
                              
                           
                        , two Hessian matrices are obtained to be
                           
                              (15)
                              
                                 H
                                 (
                                 
                                    
                                       F
                                    
                                    
                                       x
                                    
                                 
                                 )
                                 =
                                 
                                    [
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         ∂
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   
                                                      
                                                         F
                                                      
                                                      
                                                         x
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         s
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         ∂
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   
                                                      
                                                         F
                                                      
                                                      
                                                         x
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   s
                                                   ∂
                                                   t
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         ∂
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   
                                                      
                                                         F
                                                      
                                                      
                                                         x
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   t
                                                   ∂
                                                   s
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         ∂
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   
                                                      
                                                         F
                                                      
                                                      
                                                         x
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    ]
                                 
                                 ,
                                 
                                 H
                                 (
                                 
                                    
                                       F
                                    
                                    
                                       x
                                    
                                 
                                 )
                                 =
                                 
                                    [
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         ∂
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   
                                                      
                                                         F
                                                      
                                                      
                                                         y
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         s
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         ∂
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   
                                                      
                                                         F
                                                      
                                                      
                                                         y
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   s
                                                   ∂
                                                   t
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         ∂
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   
                                                      
                                                         F
                                                      
                                                      
                                                         y
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   t
                                                   ∂
                                                   s
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         ∂
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   
                                                      
                                                         F
                                                      
                                                      
                                                         y
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    ]
                                 
                                 .
                              
                           
                         Then, b is computed by substituting (15) into (12) and subsequently (11). The amount of update for X, 
                           Δ
                           X
                        , is obtained from Eq. (9). Given the initial vector 
                           
                              
                                 X
                              
                              
                                 0
                              
                           
                        , the prescribed procedure is performed iteratively until 
                           |
                           Δ
                           X
                           |
                           <
                           δ
                        , where δ is the user defined tolerance.

Consider a point 
                           P
                           =
                           c
                           (
                           
                              
                                 s
                              
                              
                                 0
                              
                           
                           )
                         on 
                           c
                           (
                           s
                           )
                        . The first two terms in the right-hand side of Eq. (1) are taken as the approximation of 
                           c
                           (
                           s
                           )
                         near P. The intersection equation between them is given by
                           
                              (16)
                              
                                 O
                                 +
                                 d
                                 t
                                 =
                                 P
                                 +
                                 
                                    
                                       d
                                       c
                                    
                                    
                                       d
                                       s
                                    
                                 
                                 Δ
                                 s
                                 .
                              
                           
                         The root of these equations can be computed analytically since there are two equations and two unknowns and they are linear. Then the parameter value is updated by Δs to yield 
                           
                              
                                 s
                              
                              
                                 new
                              
                           
                           =
                           
                              
                                 s
                              
                              
                                 old
                              
                           
                           +
                           Δ
                           s
                        . The iteration begins with 
                           s
                           =
                           
                              
                                 s
                              
                              
                                 0
                              
                           
                         and continues until 
                           |
                           Δ
                           s
                           |
                           <
                           δ
                        . This process is equivalent to finding the intersection between the ray and the tangent line at P as illustrated in Fig. 1
                        . As the tangential line at P is formulated as 
                           
                              
                                 T
                              
                              
                                 l
                              
                           
                           (
                           σ
                           )
                           =
                           P
                           +
                           t
                           σ
                         with a parameter σ, the intersection between 
                           
                              
                                 T
                              
                              
                                 l
                              
                           
                           (
                           σ
                           )
                         and 
                           l
                           (
                           t
                           )
                         is computed analytically, yielding 
                           
                              
                                 q
                              
                              
                                 1
                              
                           
                         as shown in Fig. 1. Subsequently, 
                           
                              
                                 q
                              
                              
                                 1
                              
                           
                           =
                           P
                           +
                           t
                           Δ
                           σ
                         and Δσ is computed:
                           
                              (17)
                              
                                 Δ
                                 σ
                                 =
                                 
                                    
                                       t
                                       ⋅
                                       (
                                       
                                          
                                             q
                                          
                                          
                                             1
                                          
                                       
                                       −
                                       P
                                       )
                                    
                                    
                                       t
                                       ⋅
                                       t
                                    
                                 
                                 =
                                 t
                                 ⋅
                                 (
                                 
                                    
                                       q
                                    
                                    
                                       1
                                    
                                 
                                 −
                                 P
                                 )
                                 .
                              
                           
                         Here, an assumption is made that 
                           Δ
                           s
                           ≈
                           Δ
                           σ
                        , which is used as the amount of update for the parameter s. In this method, the local shape of the curve at P is approximated by the tangent line 
                           
                              
                                 T
                              
                              
                                 l
                              
                           
                           (
                           σ
                           )
                        , where 
                           σ
                           =
                           s
                        . The point 
                           
                              
                                 q
                              
                              
                                 1
                              
                           
                         is treated as approximation to the true intersection.

In this method, the first three terms of the approximated expression of Eq. (1) are used to approximate c near the point P, which is illustrated as 
                           
                              
                                 c
                              
                              
                                 2
                              
                           
                         in Fig. 1. Therefore, the intersection equation is formulated as
                           
                              (18)
                              
                                 O
                                 +
                                 d
                                 t
                                 =
                                 P
                                 +
                                 
                                    
                                       d
                                       c
                                    
                                    
                                       d
                                       s
                                    
                                 
                                 Δ
                                 s
                                 +
                                 
                                    1
                                    2
                                 
                                 
                                    
                                       
                                          
                                             d
                                          
                                          
                                             2
                                          
                                       
                                       c
                                    
                                    
                                       d
                                       
                                          
                                             s
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 Δ
                                 
                                    
                                       s
                                    
                                    
                                       2
                                    
                                 
                                 .
                              
                           
                         Eq. (18) consists of two equations and two unknowns. The unknown t can be eliminated to derive a quadratic equation for Δs. The roots of the equation, 
                           Δ
                           
                              
                                 s
                              
                              
                                 1
                              
                           
                         and 
                           Δ
                           
                              
                                 s
                              
                              
                                 2
                              
                           
                        , are computed, among which the value which yields a point on the curve closer to 
                           O
                           ,
                           
                              
                                 q
                              
                              
                                 2
                              
                           
                         as shown in Fig. 1, is selected. The new parameter value s is then updated by s
                        new 
                        
                           =
                           
                              
                                 s
                              
                              
                                 old
                              
                           
                           +
                           Δ
                           s
                        . This process is repeated until 
                           |
                           Δ
                           s
                           |
                           <
                           δ
                        .

Similar to the ray and curve intersection, the ray and parametric surface intersection can be solved by using the four methods: Newton–Raphson, Halley, the first and the second order methods.

Given a parametric surface 
                        r
                        (
                        u
                        ,
                        v
                        )
                      (
                        0
                        ⩽
                        u
                        ,
                        v
                        ⩽
                        1
                     ) and a ray 
                        l
                        (
                        t
                        )
                      in 3D space the intersection between them is formulated as:
                        
                           (19)
                           
                              G
                              (
                              u
                              ,
                              v
                              ,
                              t
                              )
                              =
                              r
                              (
                              u
                              ,
                              v
                              )
                              −
                              l
                              (
                              t
                              )
                              =
                              0
                              .
                           
                        
                     
                  

The basic approach to solve Eq. (19) is identical to the case of finding intersection between a ray and a planar curve. Given 
                           X
                           =
                           
                              
                                 (
                                 u
                                 ,
                                 v
                                 ,
                                 t
                                 )
                              
                              
                                 T
                              
                           
                        , the amount of update for X, 
                           Δ
                           X
                           =
                           (
                           Δ
                           u
                           ,
                           Δ
                           v
                           ,
                           Δ
                           t
                           )
                        , is obtained by solving Eq. (8). The Jacobian matrix of G is given by
                           
                              (20)
                              
                                 J
                                 =
                                 
                                    [
                                    
                                       
                                          
                                             
                                                
                                                   ∂
                                                   
                                                      
                                                         G
                                                      
                                                      
                                                         x
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   u
                                                
                                             
                                          
                                          
                                             
                                                
                                                   ∂
                                                   
                                                      
                                                         G
                                                      
                                                      
                                                         x
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   v
                                                
                                             
                                          
                                          
                                             
                                                
                                                   ∂
                                                   
                                                      
                                                         G
                                                      
                                                      
                                                         x
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   t
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   ∂
                                                   
                                                      
                                                         G
                                                      
                                                      
                                                         y
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   u
                                                
                                             
                                          
                                          
                                             
                                                
                                                   ∂
                                                   
                                                      
                                                         G
                                                      
                                                      
                                                         y
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   v
                                                
                                             
                                          
                                          
                                             
                                                
                                                   ∂
                                                   
                                                      
                                                         G
                                                      
                                                      
                                                         y
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   t
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   ∂
                                                   
                                                      
                                                         G
                                                      
                                                      
                                                         z
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   u
                                                
                                             
                                          
                                          
                                             
                                                
                                                   ∂
                                                   
                                                      
                                                         G
                                                      
                                                      
                                                         z
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   v
                                                
                                             
                                          
                                          
                                             
                                                
                                                   ∂
                                                   
                                                      
                                                         G
                                                      
                                                      
                                                         z
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   t
                                                
                                             
                                          
                                       
                                    
                                    ]
                                 
                                 .
                              
                           
                         The updated 
                           
                              
                                 X
                              
                              
                                 new
                              
                           
                         is computed by 
                           
                              
                                 X
                              
                              
                                 new
                              
                           
                           =
                           
                              
                                 X
                              
                              
                                 old
                              
                           
                           +
                           Δ
                           X
                        . Starting with 
                           
                              
                                 X
                              
                              
                                 0
                              
                           
                        , the iteration continues until 
                           |
                           Δ
                           X
                           |
                           <
                           δ
                        .

Given 
                           X
                           =
                           
                              
                                 (
                                 u
                                 ,
                                 v
                                 ,
                                 t
                                 )
                              
                              
                                 T
                              
                           
                        , three 3 by 3 Hessian matrices are obtained to be 
                           H
                           (
                           
                              
                                 G
                              
                              
                                 x
                              
                           
                           )
                        , 
                           H
                           (
                           
                              
                                 G
                              
                              
                                 y
                              
                           
                           )
                         and 
                           H
                           (
                           
                              
                                 G
                              
                              
                                 z
                              
                           
                           )
                         for u, v and t. As an example, 
                           H
                           (
                           
                              
                                 G
                              
                              
                                 x
                              
                           
                           )
                         is given by
                           
                              (21)
                              
                                 H
                                 (
                                 
                                    
                                       G
                                    
                                    
                                       x
                                    
                                 
                                 )
                                 =
                                 
                                    [
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         ∂
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   
                                                      
                                                         G
                                                      
                                                      
                                                         x
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         u
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         ∂
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   
                                                      
                                                         G
                                                      
                                                      
                                                         x
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   u
                                                   ∂
                                                   v
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         ∂
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   
                                                      
                                                         G
                                                      
                                                      
                                                         x
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   u
                                                   ∂
                                                   t
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         ∂
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   
                                                      
                                                         G
                                                      
                                                      
                                                         x
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   v
                                                   ∂
                                                   u
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         ∂
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   
                                                      
                                                         G
                                                      
                                                      
                                                         x
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         v
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         ∂
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   
                                                      
                                                         G
                                                      
                                                      
                                                         x
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   v
                                                   ∂
                                                   t
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         ∂
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   
                                                      
                                                         G
                                                      
                                                      
                                                         x
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   t
                                                   ∂
                                                   u
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         ∂
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   
                                                      
                                                         G
                                                      
                                                      
                                                         x
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   t
                                                   ∂
                                                   v
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         ∂
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   
                                                      
                                                         G
                                                      
                                                      
                                                         x
                                                      
                                                   
                                                
                                                
                                                   ∂
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    ]
                                 
                                 .
                              
                           
                         Using the Hessian matrices, 
                           Δ
                           X
                         is obtained by Eq. (9). The updated 
                           
                              
                                 X
                              
                              
                                 new
                              
                           
                         is then computed by using 
                           
                              
                                 X
                              
                              
                                 new
                              
                           
                           =
                           
                              
                                 X
                              
                              
                                 old
                              
                           
                           +
                           Δ
                           X
                        . Starting with 
                           
                              
                                 X
                              
                              
                                 0
                              
                           
                        , the iteration continues until 
                           |
                           Δ
                           X
                           |
                           <
                           δ
                        .

Consider a point P on the surface. Then the tangent plane at P is given by 
                           (
                           
                              
                                 X
                              
                              
                                 T
                              
                           
                           −
                           P
                           )
                           ⋅
                           N
                           =
                           0
                        , where 
                           
                              
                                 X
                              
                              
                                 T
                              
                           
                           =
                           
                              
                                 (
                                 x
                                 ,
                                 y
                                 ,
                                 z
                                 )
                              
                              
                                 T
                              
                           
                         and N is the unit surface normal vector at P:
                           
                              (22)
                              
                                 N
                                 =
                                 
                                    
                                       
                                          
                                             r
                                          
                                          
                                             u
                                          
                                       
                                       ×
                                       
                                          
                                             r
                                          
                                          
                                             v
                                          
                                       
                                    
                                    
                                       |
                                       
                                          
                                             r
                                          
                                          
                                             u
                                          
                                       
                                       ×
                                       
                                          
                                             r
                                          
                                          
                                             v
                                          
                                       
                                       |
                                    
                                 
                                 .
                              
                           
                         The intersection between the ray and the tangent plane is computed by plugging the ray equation into the tangent plane equations, yielding the value of t as follows:
                           
                              (23)
                              
                                 t
                                 =
                                 
                                    
                                       (
                                       P
                                       −
                                       O
                                       )
                                       ⋅
                                       N
                                    
                                    
                                       d
                                       ⋅
                                       N
                                    
                                 
                                 .
                              
                           
                         Substituting Eq. (23) into the ray equation generates the intersection point q. The update values for u and v are computed by solving the following equations.
                           
                              (24)
                              
                                 
                                    (
                                    q
                                    −
                                    P
                                    )
                                    ⋅
                                    
                                       
                                          r
                                       
                                       
                                          u
                                       
                                    
                                    =
                                    
                                       
                                          r
                                       
                                       
                                          u
                                       
                                    
                                    ⋅
                                    
                                       
                                          r
                                       
                                       
                                          u
                                       
                                    
                                    Δ
                                    u
                                    +
                                    
                                       
                                          r
                                       
                                       
                                          v
                                       
                                    
                                    ⋅
                                    
                                       
                                          r
                                       
                                       
                                          u
                                       
                                    
                                    Δ
                                    v
                                    ,
                                 
                              
                              
                                 
                                    (
                                    q
                                    −
                                    P
                                    )
                                    ⋅
                                    
                                       
                                          r
                                       
                                       
                                          v
                                       
                                    
                                    =
                                    
                                       
                                          r
                                       
                                       
                                          u
                                       
                                    
                                    ⋅
                                    
                                       
                                          r
                                       
                                       
                                          v
                                       
                                    
                                    Δ
                                    u
                                    +
                                    
                                       
                                          r
                                       
                                       
                                          v
                                       
                                    
                                    ⋅
                                    
                                       
                                          r
                                       
                                       
                                          v
                                       
                                    
                                    Δ
                                    v
                                    .
                                 
                              
                           
                         Then the new parameter values for u and v are 
                           
                              
                                 u
                              
                              
                                 new
                              
                           
                           =
                           
                              
                                 u
                              
                              
                                 old
                              
                           
                           +
                           Δ
                           u
                         and 
                           
                              
                                 v
                              
                              
                                 new
                              
                           
                           =
                           
                              
                                 v
                              
                              
                                 old
                              
                           
                           +
                           Δ
                           v
                        . This process continues until 
                           
                              
                                 (
                                 
                                    
                                       |
                                       Δ
                                       u
                                       |
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 
                                    
                                       |
                                       Δ
                                       v
                                       |
                                    
                                    
                                       2
                                    
                                 
                                 )
                              
                              
                                 1
                                 /
                                 2
                              
                           
                           <
                           δ
                         is satisfied.

Given a point P and a ray, a plane containing them can be created as illustrated in Fig. 2
                        . Then the intersection of the generated plane and the surface produces a curve c, which indicated as a dotted curve in Fig. 2. Since the intersection curve is on the plane, it becomes a planar curve and subsequently the intersection point between the ray and the surface should lie on the intersection curve c. So, the same method developed for the ray and 2D planar curve intersection case is directly applicable for this problem.

The curve c is a curve on the surface 
                           
                              
                                 r
                              
                              
                                 B
                              
                           
                        . Therefore, it is obvious that 
                           c
                           (
                           λ
                           )
                           =
                           
                              
                                 r
                              
                              
                                 B
                              
                           
                           (
                           u
                           (
                           λ
                           )
                           ,
                           v
                           (
                           λ
                           )
                           )
                         as explained in Section 2.1. Here, λ is the arc length of c. There are two ways to construct c. One method is to find the functions 
                           u
                           (
                           λ
                           )
                         and 
                           v
                           (
                           λ
                           )
                        , which would be a curve in the 
                           u
                           –
                           v
                         parametric space. The other way is to directly construct 
                           c
                           (
                           λ
                           )
                         in 3D space. In this work, the latter approach is taken since it is computationally simple and more importantly consistent with the proposed method. The shape of c in the neighborhood of 
                           P
                           =
                           c
                           (
                           0
                           )
                         is represented by using the Taylor expansion:
                           
                              (25)
                              
                                 c
                                 (
                                 λ
                                 )
                                 =
                                 c
                                 (
                                 0
                                 )
                                 +
                                 
                                    
                                       c
                                    
                                    
                                       ′
                                    
                                 
                                 Δ
                                 λ
                                 +
                                 
                                    1
                                    2
                                 
                                 
                                    
                                       c
                                    
                                    
                                       ″
                                    
                                 
                                 Δ
                                 
                                    
                                       λ
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 HOT
                                 .
                              
                           
                         Therefore, by specifying the coefficients of each term, the curve c can be explicitly constructed. In the proposed method, the exact shape of the intersection curve is not necessary. Instead, an approximate to the second order is considered as presented in Section 3.4. Therefore, the first three terms are taken from the right-hand side of Eq. (25) to approximate the curve c:
                           
                              (26)
                              
                                 c
                                 (
                                 λ
                                 )
                                 ≈
                                 P
                                 +
                                 Δ
                                 λ
                                 t
                                 +
                                 
                                    κ
                                    2
                                 
                                 Δ
                                 
                                    
                                       λ
                                    
                                    
                                       2
                                    
                                 
                                 n
                                 ,
                              
                           
                         where t and n are the tangent and the normal vectors of the intersection curve c at P using Eq. (2), respectively. The tangent vector t is computed as
                           
                              (27)
                              
                                 t
                                 =
                                 
                                    
                                       
                                          
                                             N
                                          
                                          
                                             A
                                          
                                       
                                       ×
                                       
                                          
                                             N
                                          
                                          
                                             B
                                          
                                       
                                    
                                    
                                       |
                                       
                                          
                                             N
                                          
                                          
                                             A
                                          
                                       
                                       ×
                                       
                                          
                                             N
                                          
                                          
                                             B
                                          
                                       
                                       |
                                    
                                 
                              
                           
                         where 
                           
                              
                                 N
                              
                              
                                 A
                              
                           
                         and 
                           
                              
                                 N
                              
                              
                                 B
                              
                           
                         are the unit normal vectors of the plane A and the surface 
                           
                              
                                 r
                              
                              
                                 B
                              
                           
                         at P, which are computed by
                           
                              (28)
                              
                                 
                                    
                                       N
                                    
                                    
                                       A
                                    
                                 
                                 =
                                 
                                    
                                       (
                                       P
                                       −
                                       O
                                       )
                                       ×
                                       d
                                    
                                    
                                       |
                                       (
                                       P
                                       −
                                       O
                                       )
                                       ×
                                       d
                                       |
                                    
                                 
                                 ,
                                 
                                 
                                    
                                       N
                                    
                                    
                                       B
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             r
                                          
                                          
                                             B
                                             u
                                          
                                       
                                       ×
                                       
                                          
                                             r
                                          
                                          
                                             B
                                             v
                                          
                                       
                                    
                                    
                                       |
                                       
                                          
                                             r
                                          
                                          
                                             B
                                             u
                                          
                                       
                                       ×
                                       
                                          
                                             r
                                          
                                          
                                             B
                                             v
                                          
                                       
                                       |
                                    
                                 
                                 .
                              
                           
                         Since t is the unit tangent vector of the intersection curve c that lies on the surface 
                           
                              
                                 r
                              
                              
                                 B
                              
                           
                        , we have
                           
                              (29)
                              
                                 t
                                 =
                                 
                                    
                                       r
                                    
                                    
                                       B
                                       u
                                    
                                 
                                 
                                    
                                       u
                                    
                                    
                                       ′
                                    
                                 
                                 +
                                 
                                    
                                       r
                                    
                                    
                                       B
                                       v
                                    
                                 
                                 
                                    
                                       v
                                    
                                    
                                       ′
                                    
                                 
                                 .
                              
                           
                         The normal curvature κ and the normal vector n of the intersection curve is (Patrikalakis and Maekawa, 2002)
                           
                              (30)
                              
                                 κ
                                 n
                                 =
                                 
                                    
                                       
                                          κ
                                       
                                       
                                          B
                                       
                                    
                                    
                                       (
                                       1
                                       −
                                       
                                          
                                             cos
                                          
                                          
                                             2
                                          
                                       
                                       θ
                                       )
                                    
                                 
                                 
                                    (
                                    −
                                    cos
                                    θ
                                    
                                       
                                          N
                                       
                                       
                                          A
                                       
                                    
                                    +
                                    
                                       
                                          N
                                       
                                       
                                          B
                                       
                                    
                                    )
                                 
                                 .
                              
                           
                         Here, 
                           cos
                           
                           θ
                           =
                           
                              
                                 N
                              
                              
                                 A
                              
                           
                           ⋅
                           
                              
                                 N
                              
                              
                                 B
                              
                           
                         and 
                           
                              
                                 κ
                              
                              
                                 B
                              
                           
                         is the normal curvature of the surface at P in the direction of t, which is obtained by projecting Eq. (30) onto the surface unit normal 
                           
                              
                                 N
                              
                              
                                 B
                              
                           
                        . Using the second fundamental form for 
                           
                              
                                 r
                              
                              
                                 B
                              
                           
                        ,
                           
                              (31)
                              
                                 
                                    
                                       κ
                                    
                                    
                                       B
                                    
                                 
                                 =
                                 L
                                 
                                    
                                       (
                                       
                                          
                                             u
                                          
                                          
                                             ′
                                          
                                       
                                       )
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 2
                                 M
                                 
                                    
                                       u
                                    
                                    
                                       ′
                                    
                                 
                                 
                                    
                                       v
                                    
                                    
                                       ′
                                    
                                 
                                 +
                                 N
                                 
                                    
                                       (
                                       
                                          
                                             v
                                          
                                          
                                             ′
                                          
                                       
                                       )
                                    
                                    
                                       2
                                    
                                 
                                 ,
                              
                           
                         where L, M, and N are the second fundamental form coefficients of 
                           
                              
                                 r
                              
                              
                                 B
                              
                           
                        :
                           
                              
                                 L
                                 =
                                 
                                    
                                       r
                                    
                                    
                                       B
                                       u
                                       u
                                    
                                 
                                 ⋅
                                 
                                    
                                       N
                                    
                                    
                                       B
                                    
                                 
                                 ,
                                 
                                 M
                                 =
                                 
                                    
                                       r
                                    
                                    
                                       B
                                       u
                                       v
                                    
                                 
                                 ⋅
                                 
                                    
                                       N
                                    
                                    
                                       B
                                    
                                 
                                 ,
                                 
                                 N
                                 =
                                 
                                    
                                       r
                                    
                                    
                                       B
                                       v
                                       v
                                    
                                 
                                 ⋅
                                 
                                    
                                       N
                                    
                                    
                                       B
                                    
                                 
                                 .
                              
                           
                         By taking the dot product on both sides of (29) with 
                           
                              
                                 r
                              
                              
                                 B
                                 u
                              
                           
                         and 
                           
                              
                                 r
                              
                              
                                 B
                                 v
                              
                           
                         and 
                           
                              
                                 c
                              
                              
                                 ′
                              
                           
                           =
                           t
                        , we have
                           
                              (32)
                              
                                 
                                    t
                                    ⋅
                                    
                                       
                                          r
                                       
                                       
                                          B
                                          u
                                       
                                    
                                    =
                                    
                                       
                                          r
                                       
                                       
                                          B
                                          u
                                       
                                    
                                    ⋅
                                    
                                       
                                          r
                                       
                                       
                                          B
                                          u
                                       
                                    
                                    
                                       
                                          u
                                       
                                       
                                          ′
                                       
                                    
                                    +
                                    
                                       
                                          r
                                       
                                       
                                          B
                                          v
                                       
                                    
                                    ⋅
                                    
                                       
                                          r
                                       
                                       
                                          B
                                          u
                                       
                                    
                                    
                                       
                                          v
                                       
                                       
                                          ′
                                       
                                    
                                    ,
                                 
                              
                              
                                 
                                    t
                                    ⋅
                                    
                                       
                                          r
                                       
                                       
                                          B
                                          v
                                       
                                    
                                    =
                                    
                                       
                                          r
                                       
                                       
                                          B
                                          u
                                       
                                    
                                    ⋅
                                    
                                       
                                          r
                                       
                                       
                                          B
                                          v
                                       
                                    
                                    
                                       
                                          u
                                       
                                       
                                          ′
                                       
                                    
                                    +
                                    
                                       
                                          r
                                       
                                       
                                          B
                                          v
                                       
                                    
                                    ⋅
                                    
                                       
                                          r
                                       
                                       
                                          B
                                          v
                                       
                                    
                                    
                                       
                                          v
                                       
                                       
                                          ′
                                       
                                    
                                    .
                                 
                              
                           
                         Solving Eq. (32) yields 
                           
                              
                                 u
                              
                              
                                 ′
                              
                           
                         and 
                           
                              
                                 v
                              
                              
                                 ′
                              
                           
                        .

The intersection between the ray and the approximated intersection curve given by Eq. (26) is
                           
                              (33)
                              
                                 P
                                 +
                                 Δ
                                 λ
                                 t
                                 +
                                 
                                    κ
                                    2
                                 
                                 Δ
                                 
                                    
                                       λ
                                    
                                    
                                       2
                                    
                                 
                                 n
                                 =
                                 O
                                 +
                                 d
                                 t
                                 .
                              
                           
                         The dot products of Eq. (33) with t and n yield two equations:
                           
                              (34)
                              
                                 Δ
                                 λ
                                 −
                                 d
                                 ⋅
                                 t
                                 t
                                 =
                                 (
                                 O
                                 −
                                 P
                                 )
                                 ⋅
                                 t
                                 ,
                              
                           
                        
                        
                           
                              (35)
                              
                                 
                                    κ
                                    2
                                 
                                 Δ
                                 
                                    
                                       λ
                                    
                                    
                                       2
                                    
                                 
                                 −
                                 d
                                 ⋅
                                 n
                                 t
                                 =
                                 (
                                 O
                                 −
                                 P
                                 )
                                 ⋅
                                 n
                                 .
                              
                           
                         After eliminating t, a quadratic equation of Δλ is obtained, which has 
                           Δ
                           
                              
                                 λ
                              
                              
                                 1
                              
                           
                         and 
                           Δ
                           
                              
                                 λ
                              
                              
                                 2
                              
                           
                         as solutions in general. This means that there exist at most two intersection points, 
                           
                              
                                 q
                              
                              
                                 1
                              
                           
                         and 
                           
                              
                                 q
                              
                              
                                 2
                              
                           
                        , among which the one closer to O is selected as an approximated intersection point. For the selection of points, a plane passing the center point of the two candidates, 
                           
                              
                                 q
                              
                              
                                 mid
                              
                           
                           =
                           (
                           
                              
                                 q
                              
                              
                                 1
                              
                           
                           +
                           
                              
                                 q
                              
                              
                                 2
                              
                           
                           )
                           /
                           2.0
                        , and perpendicular to the ray direction d is computed, which subdivides the space into two parts. Then, the candidate point, which is in the same space as O, is selected as q. Given q and the corresponding Δλ, the increments to both u and v directions are obtained from 
                           Δ
                           u
                           =
                           
                              
                                 u
                              
                              
                                 ′
                              
                           
                           Δ
                           λ
                         and 
                           Δ
                           v
                           =
                           
                              
                                 v
                              
                              
                                 ′
                              
                           
                           Δ
                           λ
                         and the new parameter values for u and v are updated as 
                           
                              
                                 u
                              
                              
                                 new
                              
                           
                           =
                           
                              
                                 u
                              
                              
                                 old
                              
                           
                           +
                           Δ
                           u
                         and 
                           
                              
                                 v
                              
                              
                                 new
                              
                           
                           =
                           
                              
                                 v
                              
                              
                                 old
                              
                           
                           +
                           Δ
                           v
                        . This process continues until the convergence criterion 
                           
                              
                                 (
                                 
                                    
                                       |
                                       Δ
                                       u
                                       |
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 
                                    
                                       |
                                       Δ
                                       v
                                       |
                                    
                                    
                                       2
                                    
                                 
                                 )
                              
                              
                                 1
                                 /
                                 2
                              
                           
                           <
                           δ
                         is satisfied. If the updated 
                           
                              
                                 u
                              
                              
                                 new
                              
                           
                         and 
                           
                              
                                 v
                              
                              
                                 new
                              
                           
                         are out of the parametric range, then the estimated values in the parametric domain calculated from the line segment connecting (
                           
                              
                                 u
                              
                              
                                 old
                              
                           
                        , 
                           
                              
                                 v
                              
                              
                                 old
                              
                           
                        ) and (
                           
                              
                                 u
                              
                              
                                 new
                              
                           
                           ,
                           
                              
                                 v
                              
                              
                                 new
                              
                           
                        ) are computed and used instead.

@&#DISCUSSION@&#

The first order method is identical to Newton–Raphson method. From Eq. (8), we have
                              
                                 (36)
                                 
                                    
                                       J
                                       ⋅
                                       Δ
                                       X
                                       =
                                       −
                                       G
                                       (
                                       X
                                       )
                                       ,
                                    
                                 
                                 
                                    
                                       
                                          
                                             r
                                          
                                          
                                             B
                                             u
                                          
                                       
                                       Δ
                                       u
                                       +
                                       
                                          
                                             r
                                          
                                          
                                             B
                                             v
                                          
                                       
                                       Δ
                                       v
                                       −
                                       d
                                       Δ
                                       t
                                       =
                                       (
                                       O
                                       +
                                       d
                                       
                                          
                                             t
                                          
                                          
                                             0
                                          
                                       
                                       )
                                       −
                                       P
                                       ,
                                    
                                 
                              
                            where 
                              
                                 
                                    r
                                 
                                 
                                    B
                                    u
                                 
                              
                            and 
                              
                                 
                                    r
                                 
                                 
                                    B
                                    v
                                 
                              
                            are evaluated at (
                              
                                 
                                    u
                                 
                                 
                                    0
                                 
                              
                              ,
                              
                                 
                                    v
                                 
                                 
                                    0
                                 
                              
                           ) and 
                              
                                 
                                    t
                                 
                                 
                                    0
                                 
                              
                            and 
                              
                                 
                                    u
                                 
                                 
                                    0
                                 
                              
                           , 
                              
                                 
                                    v
                                 
                                 
                                    0
                                 
                              
                            are the initial guesses. Leaving the first two terms in the left-hand side, Eq. (36) becomes
                              
                                 (37)
                                 
                                    
                                       
                                          r
                                       
                                       
                                          B
                                          u
                                       
                                    
                                    Δ
                                    u
                                    +
                                    
                                       
                                          r
                                       
                                       
                                          B
                                          v
                                       
                                    
                                    Δ
                                    v
                                    =
                                    
                                       (
                                       O
                                       +
                                       d
                                       (
                                       
                                          
                                             t
                                          
                                          
                                             0
                                          
                                       
                                       +
                                       Δ
                                       t
                                       )
                                       )
                                    
                                    −
                                    P
                                    .
                                 
                              
                            Now, this equation is the intersection between the tangent plane and the ray, which is the same as the first order method. Despite the fact that both are equivalent, the first order method is convenient compared to Newton–Raphson method in that it does not require the initial guess for t and the inverse computation of a 
                              3
                              ×
                              3
                            Jacobian matrix.

The first order method given in Section 4.3 can also be formulated from Eq. (25). If the first order approximation of Eq. (25) is taken, then the procedure becomes finding the intersection between the ray and the tangent line of c, which is the same as the core idea of the first order method.

Consider a case that there are two intersection points between a ray and a surface as shown in Fig. 3
                           (a). Then the intersection point closer to the ray origin, 
                              
                                 
                                    q
                                 
                                 
                                    1
                                 
                              
                           , is important for various applications. However, without proper initial guesses, Newton–Raphson, Halley or the first order method may end up with a wrong intersection point, 
                              
                                 
                                    q
                                 
                                 
                                    2
                                 
                              
                           , and there is no means to identify if another intersection which is closer to the ray origin may exist or not. However, the second order method provides a way to circumvent this problem. The second order term in Eq. (25) creates a quadratic surface which approximates closer to the local shape of the surface in the neighborhood of a point than the first order term alone does. So, when a ray intersects a surface at more than one point, more than one intersection points can be obtained due to the quadratic nature of the approximation, among which the proper intersection can be selected. This type of selection cannot be done for the first order method which approximates the local shape of the surface using a tangent plane, yielding at most one intersection.

There are three special cases which should be addressed separately.


                           
                              Case 1
                              Inappropriate initial guess


                              Newton–Raphson, Halley and the first order methods fail when the tangent plane at the initial point is parallel to the ray direction as illustrated in Fig. 3(b). For Newton–Raphson method, no unique solution is determined. The first order method does not work since the denominator in Eq. (8) is zero. However, the second order method can handle this case. The value of 
                                    d
                                    ⋅
                                    n
                                  is zero in Eq. (35) and the equations can be solved with no problem.


                           
                              Case 2
                              Tangential intersection


                              Newton–Raphson or Halley method does not work for the tangent intersection case as shown in Fig. 3(c). When a ray intersects a surface in a tangential manner, the Jacobian matrix becomes close to singular as the iteration converges to the solution and eventually the methods fail to find a solution. The first order method also fails since the determinant of J in Eq. (8) becomes zero. The second order method can handle this case efficiently. In Eq. (35), two terms (
                                    d
                                    ⋅
                                    n
                                  and 
                                    (
                                    O
                                    −
                                    P
                                    )
                                    ⋅
                                    n
                                 ) become zero, leaving 
                                    Δ
                                    λ
                                    =
                                    0
                                 . So, the iteration converges with no problem.


                           
                              Case 3
                              Tangential intersection with inappropriate initial guess


                              The third case happens when the ray intersects the surface tangentially and the initial point is given such that 
                                    
                                       
                                          N
                                       
                                       
                                          A
                                       
                                    
                                  and 
                                    
                                       
                                          N
                                       
                                       
                                          B
                                       
                                    
                                  are parallel, resulting in zero tangent vector 
                                    t
                                    =
                                    0
                                 . When this case is encountered, the vector 
                                    P
                                    −
                                    O
                                  is projected onto the ray and the projected point is considered as the approximated intersection point for iteration.

@&#LIMITATIONS@&#

The proposed method can handle various cases that the first order or Newton–Raphson method fails to do. However, there are some drawbacks of the proposed method.
                              
                                 1.
                                 Due to the second order approximation, at most two intersections are expected. If there are more than two intersections, the proposed method may struggle to converge to a correct solution. However, this problem could be handled by segmenting the surface into elliptic components off-line and given as input to the proposed method.

The process is a bit complicated compared with Newton–Raphson or the first order method. However, the number of iterations of the proposed method is less or the same as the first order method and no significant computational burden is expected to be needed for the proposed method.

The proposed method can lessen the sensitivity of the initial value compared to Newton–Raphson or Halley method. However, there is still no mathematical guarantee that it converges to the correct solution in all cases. This is an inherent problem of the iteration based schemes which can only be handled by a different method such as interval based or subdivision based methods using local approximation.

In order to show the effectiveness and efficiency of the proposed method, three case examples are presented as follows; (1) simple intersection, (2) intersect with two points and (3) tangential intersection. More complicated surfaces can be subdivided into simple components, which are given as input surfaces. For these examples, a Macintosh computer with 2.7 GHz i5 CPU, 4 GB RAM and OS X 10.7 is used.

The first example is a case that a ray intersects a parametric surface at one point as shown in Fig. 4
                     . The surface is defined by B-spline of order 4 in the u and v directions. The control points of the surface are 
                        (
                        0.0
                        ,
                        0.0
                        ,
                        −
                        5.0
                        )
                     , 
                        (
                        1.0
                        ,
                        3.0
                        ,
                        −
                        5.0
                        )
                     , 
                        (
                        2.0
                        ,
                        3.0
                        ,
                        −
                        5.0
                        )
                     , 
                        (
                        3.0
                        ,
                        0.0
                        ,
                        −
                        5.0
                        )
                     , 
                        (
                        0.0
                        ,
                        0.0
                        ,
                        −
                        1.0
                        )
                     , 
                        (
                        1.0
                        ,
                        3.0
                        ,
                        −
                        1.0
                        )
                     , 
                        (
                        2.0
                        ,
                        3.0
                        ,
                        −
                        1.0
                        )
                     , 
                        (
                        3.0
                        ,
                        0.0
                        ,
                        −
                        1.0
                        )
                     , 
                        (
                        0.0
                        ,
                        0.0
                        ,
                        1.0
                        )
                     , 
                        (
                        1.0
                        ,
                        3.0
                        ,
                        1.0
                        )
                     , 
                        (
                        2.0
                        ,
                        3.0
                        ,
                        1.0
                        )
                     , 
                        (
                        3.0
                        ,
                        0.0
                        ,
                        1.0
                        )
                     , 
                        (
                        0.0
                        ,
                        0.0
                        ,
                        5.0
                        )
                     , 
                        (
                        1.0
                        ,
                        3.0
                        ,
                        5.0
                        )
                     , 
                        (
                        2.0
                        ,
                        3.0
                        ,
                        5.0
                        )
                     , 
                        (
                        3.0
                        ,
                        0.0
                        ,
                        5.0
                        )
                     . The knot vectors 
                        
                           
                              T
                           
                           
                              u
                           
                        
                      and 
                        
                           
                              T
                           
                           
                              v
                           
                        
                      for the u and v directions are 
                        
                           
                              T
                           
                           
                              u
                           
                        
                        =
                        
                           
                              T
                           
                           
                              v
                           
                        
                        =
                        {
                        0.0
                        ,
                        0.0
                        ,
                        0.0
                        ,
                        0.0
                        ,
                        1.0
                        ,
                        1.0
                        ,
                        1.0
                        ,
                        1.0
                        }
                     . The origin of the ray is 
                        O
                        =
                        (
                        5.0
                        ,
                        2.0
                        ,
                        2.0
                        )
                      and its direction from the origin is given by 
                        d
                        =
                        (
                        −
                        1.0
                        ,
                        −
                        0.5
                        ,
                        0.3
                        )
                     . Newton–Raphson, Halley and the proposed methods were employed to compute the intersection point and they gave the same solution of 
                        (
                        u
                        ,
                        v
                        )
                        =
                        (
                        0.788660789
                        ,
                        0.895380221
                        )
                     . In this example, the initial parametric u and v values for iteration were chosen from 0.0 to 1.0 with a step of 0.1 to generate 121 cases. Newton–Raphson and Halley methods successfully find the correct intersection for 66 and 65 cases, respectively, whereas the proposed method finds the intersection for all cases. Only considering the successful cases for the three methods, the average numbers of iterations are 4.58, 3.89 and 5.56 for Newton–Raphson, Halley and the proposed methods, respectively. This implies that Halley method needs the least number of iterations for convergence and the second order method requires more than one iteration compared with Halley method. In order to compare the CPU computation time, one case that the methods succeed in finding the correct root was executed more than one million times. The average elapsed times for each method to find a root are 42.21, 35.43 and 88.59 milliseconds for Newton–Raphson, Halley and the proposed methods. The proposed method takes more time than Newton–Raphson method, which is caused by the additional computation steps involved in the proposed method.

The second example is the case that a ray intersects a parametric surface at two different points as shown in Fig. 5
                     . The surface is defined by B-spline of order 4 in the u and v directions. The control points of the surface are 
                        (
                        0.0
                        ,
                        0.0
                        ,
                        −
                        5.0
                        )
                     , 
                        (
                        1.0
                        ,
                        0.0
                        ,
                        −
                        5.0
                        )
                     , 
                        (
                        2.0
                        ,
                        0.0
                        ,
                        −
                        5.0
                        )
                     , 
                        (
                        3.0
                        ,
                        0.0
                        ,
                        −
                        5.0
                        )
                     , 
                        (
                        0.0
                        ,
                        0.0
                        ,
                        −
                        1.0
                        )
                     , 
                        (
                        1.0
                        ,
                        3.0
                        ,
                        −
                        1.0
                        )
                     , 
                        (
                        2.0
                        ,
                        3.0
                        ,
                        −
                        1.0
                        )
                     , 
                        (
                        3.0
                        ,
                        0.0
                        ,
                        −
                        1.0
                        )
                     , 
                        (
                        0.0
                        ,
                        0.0
                        ,
                        1.0
                        )
                     , 
                        (
                        1.0
                        ,
                        3.0
                        ,
                        1.0
                        )
                     , 
                        (
                        2.0
                        ,
                        3.0
                        ,
                        1.0
                        )
                     , 
                        (
                        3.0
                        ,
                        0.0
                        ,
                        1.0
                        )
                     , 
                        (
                        0.0
                        ,
                        0.0
                        ,
                        5.0
                        )
                     , 
                        (
                        1.0
                        ,
                        0.0
                        ,
                        5.0
                        )
                     , 
                        (
                        2.0
                        ,
                        0.0
                        ,
                        5.0
                        )
                     , 
                        (
                        3.0
                        ,
                        0.0
                        ,
                        5.0
                        )
                     . The knot vectors 
                        
                           
                              T
                           
                           
                              u
                           
                        
                      and 
                        
                           
                              T
                           
                           
                              v
                           
                        
                      for the u and v directions are 
                        
                           
                              T
                           
                           
                              u
                           
                        
                        =
                        
                           
                              T
                           
                           
                              v
                           
                        
                        =
                        {
                        0.0
                        ,
                        0.0
                        ,
                        0.0
                        ,
                        0.0
                        ,
                        1.0
                        ,
                        1.0
                        ,
                        1.0
                        ,
                        1.0
                        }
                     . The origin of the ray is 
                        O
                        =
                        (
                        5.0
                        ,
                        2.0
                        ,
                        0.0
                        )
                      and its direction from the origin is given by 
                        d
                        =
                        (
                        −
                        10.0
                        ,
                        −
                        3.0
                        ,
                        1.0
                        )
                     . Among the two intersection points, the one closer to the origin is selected as the correct solution. The parametric values for the u and v of the correct intersection point are found to be 0.529890614 and 0.769592159. Using the same starting parametric values for iteration, Newtonʼs method successfully finds the correct intersection for 75 cases out of 121 and Halley method succeeds in finding the correct solutions for 70 out of 121 cases, whereas the proposed method finds the intersection for all cases. Only for the successful cases, the average numbers of iterations for Newton–Raphson, Halley and the proposed methods are 5.43, 4.33 and 6.56, respectively.

The third example is the case that a ray intersects a surface tangentially as shown in Fig. 6
                     . The same surface used for the first example is used again in this example, but the ray is adjusted to meet the surface tangentially. The origin of the ray is 
                        O
                        =
                        (
                        5.0
                        ,
                        2.25
                        ,
                        0.0
                        )
                      and the direction 
                        d
                        =
                        (
                        −
                        1.0
                        ,
                        0.0
                        ,
                        0.0
                        )
                     . There exists one intersection point and at the intersection the ray is embedded in the tangent plane of the surface at 
                        
                           
                              q
                           
                           
                              int
                           
                        
                     . For this example, the starting parametric values for u and v are 0.6 and 0.5, respectively. After 5 iterations, the parametric values of the intersection 
                        (
                        0.5
                        ,
                        0.5
                        )
                      are obtained. Since Newton–Raphson and Halley methods cannot handle this case, the comparison was not made for this case.

@&#CONCLUSIONS@&#

In this paper, the second order geometric iteration algorithm for computing the intersection between a ray and a parametric surface is proposed. The proposed one uses the second order terms which provide better approximation to the local shape of the surface. Although the proposed method does not guarantee that it always converge to the correct solution, it can handle broader cases for ray–surface intersection than Newton–Raphson or Halley method, resulting in improved overall performance in the ray vs. parametric surface intersection.

The proposed method takes more time than Newton–Raphson or Halley method for convergence. This performance drawback, however, can be offset by the robustness of the proposed method. The cases that Newton–Raphson or Halley method fails to converge may require ways totally different from Newton–Raphson scheme to handle, making its algorithm more complicated and expensive. Therefore, the proposed method is advantageous for those applications that require robust computation of intersection between a ray and a surface.

@&#ACKNOWLEDGEMENTS@&#

This research was supported by the Basic Science Research Program through the National Research Foundation of Korea (NRF) funded by the Ministry of Education, Science and Technology (2011-0010099) and by the Basic Research Project through a grant provided by GIST, 2012.

@&#REFERENCES@&#

