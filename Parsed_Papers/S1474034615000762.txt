@&#MAIN-TITLE@&#Integrate multi-agent planning in hinterland transport: Design, implementation and evaluation

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           An integrated platform for efficient hinterland transport planning.


                        
                        
                           
                           A novel formulation of planning problem with a bi-level leader–follower model.


                        
                        
                           
                           Information sharing is achieved using a mediator-based multi agent system.


                        
                        
                           
                           Feasibility and effectiveness are validated through case study.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Hinterland transport

Bi-level optimization

Multi-agent system

Integrate planning

@&#ABSTRACT@&#


               
               
                  This paper addresses the planning issue in hinterland barge transport domain, characterized by limited information sharing, lack of cooperation and conflict of interest among different parties (terminal and barge party). The planning problem is formulated as a novel Stackelberg game to model a leader–followers bi-level optimization problem. A hybrid algorithm is developed that concerns different objectives (vessel turn around and terminal berthing capacity) simultaneously while fulling pre-defined operational constraints. The presented algorithm is outlined in a hierarchical way and embedded into dedicated agents as decision-making kernel. We describe the architecture and the implementation of the proposed mediator-based multi agent system and overall coupling framework include agent identification, coordination and decision making. A case study evaluates the performance of our approach in terms of global optimality compared with other related approach.
               
            

@&#INTRODUCTION@&#

Container terminal is an important node in the whole supply chain. Recent port development presents the fact that its competitive position not only relies on its efficiency for serving sea-going vessels, but also on its connections with hinterland [1]. It is discussed that inland shipping has become an inexpensive and reliable link in the logistics chain [2]. This quickly growing field could offer multiple opportunities and challenges. Efficient operation of hinterland transport from sea side to inland side will be emphasized on both time and costs [3]. Stakeholders involved in the hinterland transport are eager to find new ICT technologies (e.g., automated communication and planning system) to get rid of old fashioned management system (e.g., paper-based method) and as a result achieve better efficiency and economic promotion [4].

In general, hinterland transport consists of truck transport, barge transport and rail transport. Rotterdam is located at the delta of the rivers Rhine and Meuse which makes inland barge the ideal way for reliable and cost-effective transportation of containers. It is estimated that the usage of barge will command a share of 45 percentage in the future hinterland transport (year of 2035) in the port of Rotterdam and this number is expected to keep growing [5]. Presently, a barge rotation consists of several terminal visits with loading and unloading operations at each terminal. The lack of coordination between terminal and barge party [6], inefficient communication [7] and irrational behavior [8] lead to long waiting time of barge within port region and low utilization of terminal resources [9]. The mentioned problem has already become an important and emergent issue in the Port of Rotterdam recently.

Typical scenarios of hinterland barge transport (HBT) planning problem are depicted in Fig. 1
                     . In scenario one, the barge operator is working on issuing a rotation visit plan about when to call at which terminal. With respect to terminal operator, the primary task is to make a decision on when to serve the barge call concerning its resource availability and efficiency. From an operational research (OR) perspective, each operator has its own objective. The barge operator always satisfies result with best turn around time while the terminal operator cares more about its resources utilization. In real planning, however, a full terminal utilization (in terms of 100 percent berth occupancy) could be guaranteed only at the expense of a continuous queuing of coming vessels. Likewise, to ensure the vessel never wait before berthing is given at the cost of considerably low terminal resource utilization [10]. For an efficient plan, none of these extremes are acceptable, thus certain level of compromising between these two conditions is required.

Another scenario at right hand side of Fig. 1 reveals the challenge from an IT perspective. It often happens that the barge arrived at a terminal which has already been occupied by another activity. The barge operator has no knowledge about the terminal occupation status thus lead to an unpredictable waiting time. Information sharing is a critical intrinsic factor that influent the interaction between barge operator and terminal operator. In current practice, no trusted and efficient information platform exists among joined parties (terminal and barge company). A barge visit is planned in an old-fashioned ways include telephone calls and emails. Multiple attempts are performed between barge and terminal operators as long as a feasible plan is reached which is time-consuming and error-prone. Moreover, the inherited competitive nature prevents joined parties from sharing their operational information to each other which makes an efficient planning process even more difficult.

To sum it up, the mentioned challenges stimulate two questions: how to ensure the generated plan is satisfied by both terminal operator and barge operator; how to make information sharing more efficient between terminal side and barge side.

To overcome the above mentioned problem, a variety of projects have been developed or under development to improve the overall HBT performance in industry domain. A first important initiative towards HBT planning problem in the port of Rotterdam was established in 2003 which was called APPROACH [2]. The project aimed at establishing a decentralized system that generates a rotation plan off-line. The design of the system created a multi-agent communication environment where terminal agent and barge agent could negotiate with each other to achieve a feasible plan and the system feasibility was also validated in the work of [11]. In 2007, A BTS (barge traffic system [12]) web application was put into practice in the port of Antwerp. It supported the barge operators to make appointments with terminals with announcement of their call size and estimated arrival time. The terminal operators then gave feedback regarding the terminal planning and possibly refuse or harmonize the planning. Also the terminal operators can acquire real time information regarding the position of the barge within terminal region. The supported functionaries included barge planning request, consult lock planning, request barge position and terminal planning inland barge. A new project called “Next Logic” [13] was launched since September 2013, it involved different parties includes the port of Rotterdam authority, barge company, terminal company, shipper and Dutch government. The project focused on reducing inefficiencies in inland container shipping by providing a centralized integral platform in which all of the related parties would join. Currently, the project is under feasibility study. It aims at developing a neutral and integrated planning platform where all relevant data and information gathered together, and further feed to a central decision module called “brain”. The proposed platform was a good start towards centralized plan but great efforts would be taken to harmonize interest for different parties.

Apart from industrial effort, the HBT planning issue also receives attentions from scientific community recently. A so-called barge hub terminal in or near the port of Rotterdam was proposed to build in work of [14]. It will serve as a collection and distribution point for containers to and from the hinterland. The main point of the barge hub terminal (BHT) was to reduce the average terminal calls of barge by move all required containers to a dedicated position. Same concept was also discussed in [1] which explored the concept of hinterland transport with an additional barge hub terminals by focusing on the type of transport system to operate the barges. The authors overview the new transport technologies such as automated trucks, multi trailer system, automated trains and automated barge handling systems. They came to a conclusion that the innovative transport technologies will promote the efficiency of the hinterland transport and support the concept of additional inland terminals with the commercial viability. In the work of [15], the HBT alignment issues was addressed with a fully distributed MAS architecture. The author investigated how different level of information exchange influent the tardiness of barge rotation and also introduces the concept of “slack time” to increase the flexibility of terminal planning. A simulation game [16] was developed to validate the effectiveness of the proposed system which helped the potential users to get a helicopter view about the solution it provides. The system inherits the concept of multi-agent decentralized coordination between different parties. The final rotation plan will be made by barge operator according to the information (waiting profile) provided by terminal operator. The authors of [17] proposed to solve the barge rotation planning problem by means of distributed constraints optimization in a distributed agent environment. The research aimed at generating optimal plan for barge operators in terms of minimum waiting time.

In short, the state-of-art can be categorized to two folds. One by shifting the HBT operation to an inland location and it will bring great benefits and opportunities for future port construction [1,14]. It could release traffic congestion within port region and reduce waiting time of barge, thus improve the overall performance and enhance the competitive position of the port. However, this concept is a long term strategy for future port design which cannot solve the current problems immediately, thus not the scope of this paper. Another one is use IT to cope with the problem. Both centralized and distributed approaches are developed or under development. In terms of centralization [13,12], it could provide centralized control with well established technology. It is especially efficient when information flows within the domain of single organization. However, the information flow of addressed HBT problem crosses inter-organizational, it could be foreseen that convincing different parties to joint the central platform and harmonizing the conflict interests would be the major obstacles. In terms of distributed approach [15–17], it could maximumly maintain the single party autonomy by establishing self-organizing agents for negotiating and goal-pursuing. But it could bring problem that the final result considers a local best for single agent rather than the one for the group as a whole. For instance, the mentioned works focused on minimizing the barge turn-around time, which ignore the objective from terminal part. As a result, the generated plan cannot be recognized as the global optimal plan.

Continuing the discussion above, it is found that there always a decision to make whether to adapt centralized system or distributed system from practical perspective [18]. In terms of centralization, it is especially efficient when information flows within the domain of single organization. When information flows across inter-organization, distributed system is more in favor given the fact that individual business units autonomy could be optimally maintained [19]. As a result, system architecture selection is a problem-specific decision. Specifically, for our HBT planning system, four primary goals should be taken into account which include efficiency, privacy, flexibility and global optimality. They are given as follows:
                        
                           •
                           How to make communication more efficient.

How to make required information flow available without invasion of business privacy.

How to flexibly deploy the planning system into the current management system without any significant modifications.

How to guarantee the global performance of the planning system.

The objective of this work is to design and implement a new integrated planning system to solve the aforementioned questions. From an OR point of view, a Stackelberg game [20] model is introduced to deal with the interplay of two self-interested decision makers (terminal and barge operator) who decide sequentially. A bi-level optimization problem [21] is formulated in terms of barge turn-around time and terminal berthing capacity. Concerning their role in HBT, the terminal operators and barge operators have been modeled by two kinds of players: the leader (terminal operator) and the follower (barge operator). Each player aims at achieving its own objective optimality. Decision variables provided by one player will play a role in the other player’s decision making process. Attempt to resolve the joint decision-making dilemma leading to a coupled decision model. The proposed method contributes to the state-of-art by concerning different objectives involved in the HBT planning simultaneously. The ultimate goal is to reach a global optimal solution that could be benefit for all participants rather than single party and eventually get economic promotions. We will elaborate the details of the model construction and solving process in the following sections.

From an IT point of view, we contribute to the literature by presenting a MAS with mediator-based architecture. The mediator-based MAS is composed of autonomous agents that are capable of communicating and negotiating with each other, extended with one or group of mediator agents to coordinate and control the behavior of distributed agents to achieve global optimality [22]. In our case, the system aims at achieving information sharing and decision making that will lead to a globally optimized solutions for joined parties who posses different interests and criterion to the HBT. It is designed such that distributed agents, which are representing leaders (terminal operators) and followers (barge operators) respectively, would sustain their local autonomous with their best strategies while the mediator agent is incorporated that responsible for controlling the negotiation process and guaranteeing the plan performance and communication efficiency.

In summary, the main contributions of this work are as follows:
                        
                           (1)
                           A novel formulation of the HBT planning problem with a bi-level leader follower model.

A mediator-based MAS been developed aims at achieving efficient information sharing and optimal solution for the reactive planning problems.

The rest of paper is organized as follows. In Section 2, we will discuss the advantage of mediator based multi agent system by comparing it with other viable options. Section 3 provides the problem statement. Section 4 elaborates the design of proposed system, where each element and decision making algorithm are explained in detail. Section 5 will demonstrate the system implementation issues together with a case study to show the system performance. Conclusion and future work will be given in Section 6.

We would like to begin by providing an argument about different viable system architectures based on the criterion aforementioned. Three system architectures are considered (Fig. 2
                     ) in this section.

Intuitively, a centralized framework can easily solve the communication intensive problem by integrating information to a single location for planning purposes. However, the mentioned difficulties in information sharing make it hard to achieve. Centralized planning means parties have to change their traditional data management infrastructure by duplicating its information to a remote terminal which will in turn cause autonomy loose. Currently, terminals in port of Rotterdam, barge companies and other related parties are reaching a preliminary agreement to establish an central planning system [13] to support HBT planning. Its flexibility, effectiveness and efficiency are yet to be determined.

The middle one shown in Fig. 2 gives a fully distribute peer–peer architecture. We have discussed that the existing works for HBT planning takes advantage of this type of framework by modeling the terminal and barge into self-organized and locally-intelligent agent. On one hand, sensitive information is preserved with well organized rules and self-interested objective is achieved with local intelligent algorithms. On another hand, this type of system provides a highly flexible and effortless solution that compatible with existing information management system. However, its practicality is still limited by several factors. Firstly, the fully distributed architecture is characterized by communication overhead in presence of a large number of agents. Moreover, they usually face the problem of reaching universal optimal solutions given the fact that each agent only interested with its local profit but the sum of local optimal is sometimes not equal to the global optimal. For instance, if the terminal only provides time windows by achieving maximum utilization, then no matter how intelligent the barge can do to seek its rotation sequence, the given result will not improve too much.

The one depicted in the left side of Fig. 2 presents a mediator-based agent framework. The authors of [23] give the definition of mediator agent as “a distributed decision-making support system for coordinating the activities of a multi-agent system”. A considerable stream of researches advocate mediator-based agent system as a sound tool to facilitate real-world planning problems. A generic mediator architecture for distributed task planning and coordination using multi agent paradigms is developed in [23]. An MAS to integrate process planning and shop-floor scheduling (IPPS) is presented in [24]. It adapts the hierarchical architecture where each machine and each part is modeled as an agent and a so-called supervisory agent is added to handle multiple-task and many-to-many negotiation. A mediator architecture based MAS for parallel machines scheduling with multi objectives is developed [25] in the domain of electro-etching process. In order to create machine schedule, each job and machine is modeled as an agent and coordinated by a management agent (mediator). The work of [26] addresses the issue of real-time production scheduling by introducing the close loop production planning and control by means of hierarchical based MAS. A cluster of mediator agents are developed to monitor the scheduling process, evaluate the scheduling efficiency and embedded re-planning and exception handling mechanisms. Other relevant works for adapting mediator-based MAS system to solve complex engineering problems can be found in [27–31].

In our case, the mediator agent group is introduced to the fully distributed agent framework. It is assumed to be the system coordinator that promotes cooperations among distributed agents. The presented framework copes with the previously mentioned goals as follows:
                           
                              •
                              Communication efficiency: According to [32], the mediator agent is able to adapt brokering and recruiting communication mechanisms to find related agents for establishing collaborative work. In another word, it works as a guidance to help sender agent found destination agent which enables a fully automatic communication set-up process.

Information privacy: The introduction of mediator agent will not interfere the information privacy since each party is still represented by distributed agent which is in nature same as the fully distributed architecture. Local-intelligence and self-organization still apply to it.

Flexibility: The agent system can be added, modified and rebuilt without any significant reconstruction of current running applications, thus is recognized as an extremely flexible solution [33]. One may argue about the introduction about the mediator agent group will increase the complexity of the system. However, compared with centralized framework with highly coupled nature, the mediator agent isolates the complex tasks from local agent. Therefore, tactically, any modification about decision making or coordination happens in mediator level will influent the decision chosen at local agent, but technically, not interfere the flexibility of local agent. Each agent could still make best reactions in response to the changing environment. In case new agent/agents will join the system, only update to do is create an interface for mediator agent to accept newly agent and nothing more.

Global performance: The fully distributed agent system usually faces problems in providing global optimized solutions in presence of multiple agents (different role actor) with own interest [34]. The problem studied in this paper also has the same issue since terminal and barge operator have different views regarding the planning performance. To cope with the conflict, an extra module is needed to monitor the overall performance of the plan and thus provide certain guidance to adjust the player’s strategy such that the final solution is reaching global optimal. The described task cannot be embedded into any local agent since none of them treat global performance as their own preference. As a result, the mediator agent will be the ideal candidate to perform the coordination task. It could stand at a mutual level to provide coordination as a service to multiple distributed organizations.

As discussed, a distributed system coordinated by a group of mediators is termed a mediator-based multi agent system. It is more representative of the real world problem compared with centralized or fully distributed system especially when addressed problem crosses multiple-organizations. The following sections will focus on how to develop efficient solutions to adapt mediator-based multi agent system to the addressed HBT planning problem.


                     
                        Definition
                        Given a set of barges which are to be operated on a set of terminals with operations including loading and unloading containers. A plan should be determined that explicitly specify the sequence of terminal visits and the time window to be available at each terminal such that the operation constrains can be satisfied and the corresponding objectives can be achieved.

Assumptions are made as follows:
                        
                           •
                           Sea-vessel operation has a fixed time window at each terminal that cannot be changed.

Terminal operation rate is fixed, time to load or unload a container is constant.

Sailing speed for each barge is a constant value.

Mooring time for each barge is a constant value.

Each terminal has 1 quay in operation.

Barge operation is non-preemptive, meaning a barge operation cannot be interrupted by another barge.

The essential elements of barge rotation plan include barge call profile and terminal service profile. With respect to barge call profile, it will provide information about the expected terminals to be visited, number of containers to be loaded/unloaded at each terminal and the arrival time at port region. It is constructed as a tuple where 
                        
                           
                              
                                 bcp
                              
                              
                                 i
                              
                           
                           =
                           {
                           {
                           
                              
                                 TC
                              
                              
                                 i
                                 ,
                                 j
                              
                           
                           |
                           j
                           ∈
                           (
                           1
                           ,
                           2
                           ,
                           …
                           ,
                           N
                           )
                           }
                           ,
                           
                              
                                 AT
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 DT
                              
                              
                                 i
                              
                           
                           }
                        
                     ,
                        1
                        The tuple structure will be extensively used throughout this paper. To obtain one of the element from the tuple, a dot operator is used. For example, to get the arrival time 
                              
                                 
                                    
                                       AT
                                    
                                    
                                       i
                                    
                                 
                              
                            from 
                              
                                 
                                    
                                       bcp
                                    
                                    
                                       i
                                    
                                 
                              
                           , we can write as 
                              
                                 
                                    
                                       bcp
                                    
                                    
                                       i
                                    
                                 
                                 .
                                 
                                    
                                       AT
                                    
                                    
                                       i
                                    
                                 
                              
                           .
                     
                     
                        1
                      
                     
                        
                           
                              
                                 TC
                              
                              
                                 i
                                 ,
                                 j
                              
                           
                           =
                           {
                           
                              
                                 L
                              
                              
                                 i
                                 ,
                                 j
                              
                           
                           ,
                           
                              
                                 UL
                              
                              
                                 i
                                 ,
                                 j
                              
                           
                           ,
                           
                              
                                 AR
                              
                              
                                 i
                                 ,
                                 j
                              
                           
                           }
                           ,
                           
                           N
                        
                      is the total number of terminals to be visited. With respect to terminal, it will provide information of its available time window based on its service profile and requested 
                        
                           
                              
                                 TC
                              
                              
                                 i
                                 ,
                                 j
                              
                           
                        
                     . The service profile is defined as 
                        
                           
                              
                                 tsp
                              
                              
                                 i
                              
                           
                           =
                           {
                           α
                           ,
                           
                              
                                 MT
                              
                              
                                 j
                              
                           
                           ,
                           
                              
                                 OR
                              
                              
                                 j
                              
                           
                           }
                        
                     . An example is given in Fig. 3
                      where barge 1 and barge 2 send requests within the request issuing period to plan rotations in the period of 
                        
                           [
                           T
                           0
                           ,
                           T
                           1
                           ]
                        
                     . The purpose of the system is to ensure that the barge calls are properly processed such that certain objectives are fulfilled. The variables used in this paper are presented in Table 1
                     . The Integrated HBT planning problem is explicitly defined in Table 2
                     .

The system architecture is shown in Fig. 4
                        , it is depicted with a hierarchical structure where three layers can be distinguished. Terminal agent (TA) resides at the upper level and barge agent (BA) resides at lower level. The mediator agent community together with other administration service modules are deployed at middler level. In this section, we will first elaborate the internal decision model of TA and BA respectively. Afterwards, the coupling nature of the system will be analyzed together with the introduction of leader–follower model. Lastly, algorithms will be designed to facilitate the overall decision making process.

BA is an agent type that stands for the barge calls. As shown in Fig. 5
                        , it will send call for proposal (CFP) to targeting TAs one by one. The CFP is defined as the proposal send from BA to request operation time window at targeting terminals. Responses from TA will be aggregated and evaluated inside BA. Negotiations will continue till all terminal calls 
                           
                              
                                 
                                    TC
                                 
                                 
                                    i
                                    ,
                                    j
                                 
                              
                           
                         are considered. Decisions are made based on the turn around time. The decision model is constructed as follows.


                              
                                 
                                    1.
                                    Route selection variable:
                                          
                                             (1)
                                             
                                                
                                                   
                                                      X
                                                   
                                                   
                                                      pq
                                                   
                                                   
                                                      i
                                                   
                                                
                                                =
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  1
                                                               
                                                               
                                                                  if
                                                                  
                                                                  barge
                                                                  
                                                                  i
                                                                  
                                                                  visit
                                                                  
                                                                  terminal
                                                                  
                                                                  q
                                                                  
                                                                  after
                                                                  
                                                                  terminal
                                                                  
                                                                  p
                                                               
                                                            
                                                            
                                                               
                                                                  0
                                                               
                                                               
                                                                  otherwise
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    

Arrival time of barge i at terminal 
                                          
                                             j
                                             +
                                             1
                                          
                                       :
                                          
                                             (2)
                                             
                                                
                                                   
                                                      AR
                                                   
                                                   
                                                      i
                                                      ,
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                =
                                                
                                                   
                                                      OS
                                                   
                                                   
                                                      i
                                                      ,
                                                      j
                                                   
                                                
                                                +
                                                
                                                   
                                                      OD
                                                   
                                                   
                                                      i
                                                      ,
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                +
                                                
                                                   
                                                      S
                                                   
                                                   
                                                      j
                                                      ,
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                +
                                                ε
                                                (
                                                1
                                                -
                                                
                                                   
                                                      X
                                                   
                                                   
                                                      j
                                                      ,
                                                      j
                                                      +
                                                      1
                                                   
                                                   
                                                      i
                                                   
                                                
                                                )
                                             
                                          
                                       
                                    

Operation start time of barge i at terminal 
                                          
                                             j
                                             +
                                             1
                                          
                                       :
                                          
                                             (3)
                                             
                                                
                                                   
                                                      OS
                                                   
                                                   
                                                      i
                                                      ,
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                =
                                                max
                                                [
                                                
                                                   
                                                      AR
                                                   
                                                   
                                                      i
                                                      ,
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                ,
                                                
                                                   
                                                      a
                                                   
                                                   
                                                      i
                                                      ,
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                ]
                                                ,
                                             
                                          
                                       
                                    

Operation duration of barge i at terminal 
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       
                                          
                                             (4)
                                             
                                                
                                                   
                                                      OD
                                                   
                                                   
                                                      i
                                                      ,
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                =
                                                OR
                                                
                                                ∗
                                                
                                                (
                                                
                                                   
                                                      L
                                                   
                                                   
                                                      i
                                                      ,
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                +
                                                
                                                   
                                                      UL
                                                   
                                                   
                                                      i
                                                      ,
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                )
                                             
                                          
                                       
                                    

Waiting time of barge i at terminal 
                                          
                                             j
                                             +
                                             1
                                          
                                       :
                                          
                                             (5)
                                             
                                                
                                                   
                                                      W
                                                   
                                                   
                                                      i
                                                      ,
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                =
                                                max
                                                [
                                                0
                                                ,
                                                
                                                   
                                                      OS
                                                   
                                                   
                                                      i
                                                      ,
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                -
                                                
                                                   
                                                      AR
                                                   
                                                   
                                                      i
                                                      ,
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                ]
                                             
                                          
                                       
                                    

Departure time of barge i at terminal 
                                          
                                             j
                                             +
                                             1
                                          
                                       :
                                          
                                             (6)
                                             
                                                
                                                   
                                                      D
                                                   
                                                   
                                                      i
                                                      ,
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                =
                                                
                                                   
                                                      OS
                                                   
                                                   
                                                      i
                                                      ,
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                +
                                                
                                                   
                                                      OD
                                                   
                                                   
                                                      i
                                                      ,
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                             
                                          
                                       
                                    

Turn around time of barge i:
                                          
                                             (7)
                                             
                                                
                                                   
                                                      TR
                                                   
                                                   
                                                      i
                                                   
                                                
                                                =
                                                
                                                   
                                                      D
                                                   
                                                   
                                                      i
                                                      ,
                                                      N
                                                   
                                                
                                                -
                                                
                                                   
                                                      AR
                                                   
                                                   
                                                      i
                                                      ,
                                                      1
                                                   
                                                
                                             
                                          
                                       
                                    

The turn-around time 
                                 
                                    
                                       
                                          TR
                                       
                                       
                                          i
                                       
                                    
                                 
                               refers to the period from the instance barge enters into the port region to the instance barge finished all operations and leave the port.
                                 
                                    (8)
                                    
                                       Minimize
                                       
                                       (
                                       
                                          
                                             TR
                                          
                                          
                                             i
                                          
                                       
                                       )
                                    
                                 
                              
                           


                              
                                 
                                    1.
                                    Sequence constraints: A barge cannot call at two terminals simultaneously.
                                          
                                             (9)
                                             
                                                
                                                   
                                                      AR
                                                   
                                                   
                                                      i
                                                      ,
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                -
                                                
                                                   
                                                      AR
                                                   
                                                   
                                                      i
                                                      ,
                                                      j
                                                   
                                                
                                                +
                                                ε
                                                (
                                                1
                                                -
                                                
                                                   
                                                      X
                                                   
                                                   
                                                      j
                                                      ,
                                                      j
                                                      +
                                                      1
                                                   
                                                   
                                                      i
                                                   
                                                
                                                )
                                                ⩾
                                                
                                                   
                                                      OD
                                                   
                                                   
                                                      i
                                                      ,
                                                      j
                                                   
                                                
                                             
                                          
                                       
                                    

Timing constraints: A barge operation has to be finished within the given time window.
                                          
                                             (10)
                                             
                                                
                                                   
                                                      OS
                                                   
                                                   
                                                      i
                                                      ,
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                ⩾
                                                
                                                   
                                                      a
                                                   
                                                   
                                                      i
                                                      ,
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                
                                                ∩
                                                
                                                
                                                   
                                                      OS
                                                   
                                                   
                                                      i
                                                      ,
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                +
                                                
                                                   
                                                      OD
                                                   
                                                   
                                                      i
                                                      ,
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                ⩽
                                                
                                                   
                                                      b
                                                   
                                                   
                                                      i
                                                      ,
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                             
                                          
                                       
                                    

Period constraints: the finish time of final terminal call should be within the deadline.
                                          
                                             (11)
                                             
                                                
                                                   
                                                      D
                                                   
                                                   
                                                      i
                                                      ,
                                                      N
                                                   
                                                
                                                ⩽
                                                Deadline
                                             
                                          
                                       
                                    

The decision variable of barge agent should include an ordered terminal visit sequence with exact operation start and departure time at each terminal. A tuple with three elements are attached to the barge call profile to represent the decision model. For each 
                                 
                                    
                                       
                                          TC
                                       
                                       
                                          i
                                          ,
                                          j
                                       
                                    
                                 
                              , the decision is given as:
                                 
                                    (12)
                                    
                                       
                                          
                                             DM
                                          
                                          
                                             i
                                             ,
                                             
                                                
                                                   TC
                                                
                                                
                                                   i
                                                   ,
                                                   j
                                                
                                             
                                          
                                       
                                       =
                                       [
                                       
                                          
                                             VO
                                          
                                          
                                             j
                                          
                                       
                                       ,
                                       
                                          
                                             OS
                                          
                                          
                                             i
                                             ,
                                             j
                                          
                                       
                                       ,
                                       
                                          
                                             D
                                          
                                          
                                             i
                                             ,
                                             j
                                          
                                       
                                       ]
                                    
                                 
                              where 
                                 
                                    
                                       
                                          VO
                                       
                                       
                                          j
                                       
                                    
                                 
                               is the visit order at terminal j (
                                 
                                    
                                       
                                          VO
                                       
                                       
                                          j
                                       
                                    
                                    =
                                    3
                                 
                               indicates the terminal j would be the third one to visit by barge i), 
                                 
                                    
                                       
                                          OS
                                       
                                       
                                          i
                                          ,
                                          j
                                       
                                    
                                 
                               is the operation start time of barge i at terminal j and 
                                 
                                    
                                       
                                          D
                                       
                                       
                                          i
                                          ,
                                          j
                                       
                                    
                                 
                               is the departure time of barge i at terminal j.

The decision making process includes two stages. As shown in the decision making block of Fig. 5, the first stage is used to validate the completeness and feasibility of the plan. The term completeness refers to the one that has all terminal calls considered. The feasibility refers to the one meets required deadline. The plan survived from the first stage will be further evaluated with respect to performance. The evaluation engine is built upon the framework of simulated annealing (SA) [35]. It is a generic probabilistic method for the optimization problem that been widely applied in solving complex engineering problems [36,37]. The basic procedure is explained in Algorithm 1. The generated plan will be taken as the input and directly transformed to energy by applying Eq. (7). The new energy eNew is compared with the best energy e and accepted as the best solution with a probability p. An improved solution is obtained by considering the neighborhood of the current plan sequence s, namely reordering the visit sequence 
                              
                                 neighborhood
                                 (
                                 s
                                 )
                              
                           . The stop criterion are given when (1) the temperature is cooling down to a pre-defined threshold; (2) the best energy cannot be improved during a pre-defined iterations. Upon the termination of evaluation, it will return the decision whether re-plan is needed. If it is true, then a new round of negotiation is initiated. The negotiation will continue till a good solution is found.
                              Algorithm 1
                              Solution Evaluation and Decision Making for 
                                    
                                       
                                          
                                             bcp
                                          
                                          
                                             i
                                          
                                       
                                    
                                  (Simulated Annealing Process) 
                                    
                                       
                                          
                                          
                                             
                                                
                                                   1: Input: terminal visit plan for 
                                                      
                                                         
                                                            
                                                               bcp
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                      
                                                   , denote as 
                                                      
                                                         s
                                                         1
                                                      
                                                   ;
                                             
                                             
                                                
                                                   2: Output: Decision for rescheduling(reSchedulelDecision) and new visit sequence 
                                                      
                                                         
                                                            
                                                               bcp
                                                            
                                                            
                                                               i
                                                            
                                                            
                                                               ★
                                                            
                                                         
                                                      
                                                   ;
                                             
                                             
                                                
                                                   3: Initialization: 
                                                      
                                                         s
                                                         ←
                                                         s
                                                         0
                                                         ;
                                                         e
                                                         ←
                                                         E
                                                         (
                                                         s
                                                         )
                                                      
                                                    ;
                                             
                                             
                                                
                                                   4: 
                                                      
                                                         
                                                            
                                                               T
                                                            
                                                            
                                                               0
                                                            
                                                         
                                                         ←
                                                         100
                                                         ;
                                                         n
                                                         ←
                                                         0
                                                         ;
                                                         coolingRate
                                                         ←
                                                         0.01
                                                      
                                                    //initial state and energy (turn around time for 
                                                      
                                                         
                                                            
                                                               bcp
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                      
                                                   )
                                             
                                             
                                                
                                                   5: if 
                                                   
                                                      
                                                         n
                                                         <
                                                         NumMax
                                                      
                                                    and 
                                                      
                                                         e
                                                         >
                                                         emin
                                                      
                                                    and 
                                                      
                                                         T
                                                         <
                                                         
                                                            
                                                               T
                                                            
                                                            
                                                               threshold
                                                            
                                                         
                                                      
                                                    
                                                   then
                                                
                                             
                                             
                                                
                                                   6: // while counter not reach maximum and energy is not reaching minimum;
                                             
                                             
                                                
                                                   7: 
                                                   
                                                      
                                                         eNew
                                                         ←
                                                         E
                                                         (
                                                         s
                                                         1
                                                         )
                                                      
                                                   
                                                   ;//compute new sequence energy
                                             
                                             
                                                
                                                   8: 
                                                   if 
                                                   
                                                      
                                                         P
                                                         (
                                                         e
                                                         ,
                                                         eNew
                                                         ,
                                                         T
                                                         )
                                                         >
                                                         random
                                                         (
                                                         )
                                                      
                                                    
                                                   then
                                                
                                             
                                             
                                                
                                                   9: //calculate the probability of accept new solution
                                             
                                             
                                                10: 
                                                   
                                                      
                                                         s
                                                         ←
                                                         s
                                                         1
                                                         ;
                                                         e
                                                         ←
                                                         eNew
                                                      
                                                   ;
                                             
                                             
                                                
                                                   
                                                   
                                                   
                                                   accept and change state
                                             
                                             
                                                11: 
                                                   
                                                      
                                                         n
                                                         ←
                                                         n
                                                         +
                                                         1
                                                      
                                                   
                                                   ;//update iteration counter
                                             
                                             
                                                12: 
                                                   end if
                                                
                                             
                                             
                                                13: 
                                                   
                                                      
                                                         RePlanDecision
                                                         ←
                                                         true
                                                      
                                                   
                                                   ;// reschedule is required
                                             
                                             
                                                14: 
                                                   
                                                      
                                                         T
                                                         ←
                                                         temperatureUpdate
                                                         (
                                                         coolingRate
                                                         )
                                                      
                                                   
                                                   ;//update temperature by cooling rate
                                             
                                             
                                                15: 
                                                   
                                                      
                                                         newSequence
                                                         ←
                                                         neighbor
                                                         (
                                                         s
                                                         )
                                                      
                                                   
                                                   ;//pick neighborhood from input solution
                                             
                                             
                                                16: else
                                                
                                             
                                             
                                                17: 
                                                   
                                                      
                                                         RePlanDecision
                                                         ←
                                                         false
                                                      
                                                   
                                                   ;//solution is validated and optimized, negotiation ends
                                             
                                             
                                                18: end if
                                                
                                             
                                             
                                                19: Return RescPlanDecision and 
                                                      
                                                         
                                                            
                                                               bcp
                                                            
                                                            
                                                               i
                                                            
                                                            
                                                               ★
                                                            
                                                         
                                                      
                                                    with newSequence;
                                             
                                          
                                       
                                    
                                 
                              

With respect to terminal agent (TA), corresponding obligation is to assign resource and time period for severing pickup and delivery activities at minimum cost and maximum utilizations. As shown in the activity diagram Fig. 6
                        , the chosen actions are related to the incoming message type. Typical activities include process BA call, evaluate current berth capacity utilization and update its own strategies. This section will explain how TA makes decision to handle BA call and how berth capacity is evaluated.

Let us denote the operating time window at terminal node j as 
                           
                              [
                              
                                 
                                    T
                                 
                                 
                                    a
                                 
                                 
                                    j
                                 
                              
                              ,
                              
                                 
                                    T
                                 
                                 
                                    b
                                 
                                 
                                    j
                                 
                              
                              ]
                           
                         and name it an operating time window. The operating time window is further divided into several sub time windows that for the corresponding barge service time, denote as barge handling time window 
                        
                           
                              [
                              
                                 
                                    T
                                 
                                 
                                    a
                                    (
                                    i
                                    )
                                 
                                 
                                    j
                                 
                              
                              ,
                              
                                 
                                    T
                                 
                                 
                                    b
                                    (
                                    i
                                    )
                                 
                                 
                                    j
                                 
                              
                              ]
                           
                        . Fig. 7
                         shows an example of time window structure of terminal j, the gray eclipse is the period been occupied by either sea-vessels, planned barges or other activities (maintenance, terminal closed operations). It should be notified that either sea-going vessels operations or other activities (include maintenance or closed operation) posses priorities over barge and thus non-changeable. As a result, only the gap between consecutive eclipses are available for barge handling and the problem is further identified as a multiple nodes with multiple time window problem. This problem is similar as a classical vehicle routing problem with time windows (VRPTW) [38,39] which involves the routing of a set of vehicles from a central depot to a set of geographically distributed customers with known demands and pre-defined time windows. In VRPTW, the time window is recognized as a fixed constrains that should be fulfilled when routing vehicle to customers. In our case, the time window provided by terminals are not only imposed as a constrains to barge plan, but also played a role in determine the terminal utilization level. Select which time window to serve which barge call is a crucial decision for optimizing the overall terminal performance.

To illustrate the time window selection, two scenario studies are provided. As show in Fig. 8
                           , it is assumed that there is only one quay in operation and one berth location available. 
                              
                                 [
                                 
                                    
                                       T
                                    
                                    
                                       a
                                    
                                 
                                 ,
                                 
                                    
                                       T
                                    
                                    
                                       b
                                    
                                 
                                 ]
                              
                            denotes the operating time window and 
                              
                                 [
                                 
                                    
                                       T
                                    
                                    
                                       a
                                    
                                 
                                 (
                                 1
                                 )
                                 ,
                                 
                                    
                                       T
                                    
                                    
                                       b
                                    
                                 
                                 (
                                 1
                                 )
                                 ]
                              
                            denotes the barge handling time window. In scenario 1, the barge i arrives during an event operation (where 
                              
                                 
                                    
                                       AT
                                    
                                    
                                       i
                                    
                                 
                                 ⩽
                                 
                                    
                                       T
                                    
                                    
                                       a
                                    
                                 
                                 (
                                 1
                                 )
                              
                           ). It is a simple case since the barge has no choice but waiting till the event operation complete. It is also a simple decision for terminal to plan the barge call right after the event. Decision-making becomes complex when barge arrives between 
                              
                                 [
                                 
                                    
                                       T
                                    
                                    
                                       a
                                    
                                 
                                 (
                                 1
                                 )
                                 ,
                                 
                                    
                                       T
                                    
                                    
                                       b
                                    
                                 
                                 (
                                 1
                                 )
                                 ]
                              
                            (scenario 2). The terminal could serve the barge immediately upon its arrival thus lead to minimum waiting time (scenario 2.1), but may sacrifice the berth occupancy (ships are not tightly planned). Or the planner could postpone the barge call to a certain point that could result in a maximum berth occupancy by putting the barge into waiting queue, which in turn tremendously increases the waiting time (scenario 2.2). Alternatively, the planner could find a compromise between two extremes by inserting the barge call into a neural place where adequate berth occupancy is achieved with acceptable waiting time (shown in scenario 2.3). Finally, the terminal decision model is given as below:


                              
                                 
                                    1.
                                    Available time window calculation:
                                          
                                             (13)
                                             
                                                
                                                   
                                                      A
                                                   
                                                   
                                                      j
                                                   
                                                   
                                                      k
                                                   
                                                
                                                =
                                                
                                                   
                                                      E
                                                   
                                                   
                                                      k
                                                   
                                                
                                                .
                                                OF
                                                ,
                                                
                                                
                                                   
                                                      B
                                                   
                                                   
                                                      j
                                                   
                                                   
                                                      k
                                                   
                                                
                                                =
                                                
                                                   
                                                      E
                                                   
                                                   
                                                      k
                                                      +
                                                      1
                                                   
                                                
                                                .
                                                OS
                                             
                                          
                                       where 
                                          
                                             
                                                
                                                   E
                                                
                                                
                                                   k
                                                
                                             
                                          
                                        is a tuple structure that represents the 
                                          
                                             
                                                
                                                   k
                                                
                                                
                                                   th
                                                
                                             
                                          
                                        event already been planned in the terminal j plan board. It is written as 
                                          
                                             
                                                
                                                   E
                                                
                                                
                                                   k
                                                
                                             
                                             (
                                             OS
                                             ,
                                             OF
                                             )
                                             ,
                                             
                                             OS
                                          
                                        is operation start time and OF is the operation finish time.

Barge handling time window


                                       2.1 Scenario 1 (see 
                                       
                                          Fig. 8
                                       
                                       ): In this case, barge is pushed into the waiting queue, its start time 
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   i
                                                   ,
                                                   j
                                                
                                             
                                          
                                        equals to the finish time of previous event, and finish time 
                                          
                                             
                                                
                                                   b
                                                
                                                
                                                   i
                                                   ,
                                                   j
                                                
                                             
                                          
                                        equals to the sum of start time and operation duration time.
                                          
                                             (14)
                                             
                                                
                                                   
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  a
                                                               
                                                               
                                                                  i
                                                                  ,
                                                                  j
                                                               
                                                            
                                                            =
                                                            
                                                               
                                                                  E
                                                               
                                                               
                                                                  k
                                                               
                                                            
                                                            .
                                                            OF
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  b
                                                               
                                                               
                                                                  i
                                                                  ,
                                                                  j
                                                               
                                                            
                                                            =
                                                            
                                                               
                                                                  a
                                                               
                                                               
                                                                  i
                                                                  ,
                                                                  j
                                                               
                                                            
                                                            +
                                                            
                                                               
                                                                  OR
                                                               
                                                               
                                                                  j
                                                               
                                                            
                                                            
                                                            ∗
                                                            
                                                            (
                                                            
                                                               
                                                                  TC
                                                               
                                                               
                                                                  i
                                                                  ,
                                                                  j
                                                               
                                                            
                                                            .
                                                            
                                                               
                                                                  L
                                                               
                                                               
                                                                  i
                                                                  ,
                                                                  j
                                                                  +
                                                                  1
                                                               
                                                            
                                                            +
                                                            
                                                               
                                                                  TC
                                                               
                                                               
                                                                  i
                                                                  ,
                                                                  j
                                                               
                                                            
                                                            .
                                                            
                                                               
                                                                  UL
                                                               
                                                               
                                                                  i
                                                                  ,
                                                                  j
                                                                  +
                                                                  1
                                                               
                                                            
                                                            )
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    


                                       2.2 Scenario 2 (see 
                                       
                                          Fig. 8
                                       
                                       ): In this case, we first calculate the gap time 
                                          
                                             
                                                
                                                   ϕ
                                                
                                                
                                                   i
                                                   ,
                                                   j
                                                
                                                
                                                   ★
                                                
                                             
                                          
                                        for terminal call 
                                          
                                             
                                                
                                                   TC
                                                
                                                
                                                   i
                                                   ,
                                                   j
                                                
                                             
                                          
                                        in the 
                                          
                                             
                                                
                                                   k
                                                
                                                
                                                   th
                                                
                                             
                                          
                                        available time window at terminal j. Upper chart of Fig. 9
                                        depicts how it works. It assumes that the barge will be served immediately upon its arrival without waiting. Then the 
                                          
                                             
                                                
                                                   ϕ
                                                
                                                
                                                   i
                                                   ,
                                                   j
                                                
                                                
                                                   ★
                                                
                                             
                                          
                                        is updated to 
                                          
                                             
                                                
                                                   ϕ
                                                
                                                
                                                   i
                                                   ,
                                                   j
                                                
                                             
                                          
                                        by multiplying the berth occupancy level 
                                          
                                             α
                                          
                                        which can be seen at the lower chart of Fig. 9. It calculates the reduced gap time that can be used to improve berth occupancy. Afterwards, this value will be added to the 
                                          
                                             
                                                
                                                   AR
                                                
                                                
                                                   i
                                                   ,
                                                   j
                                                
                                             
                                          
                                        to postpone the start time.
                                          
                                             
                                                
                                                   
                                                      ϕ
                                                   
                                                   
                                                      i
                                                      ,
                                                      j
                                                   
                                                   
                                                      ★
                                                   
                                                
                                                (
                                                
                                                   
                                                      TC
                                                   
                                                   
                                                      i
                                                      ,
                                                      j
                                                   
                                                
                                                ,
                                                [
                                                
                                                   
                                                      A
                                                   
                                                   
                                                      j
                                                   
                                                   
                                                      k
                                                   
                                                
                                                ,
                                                
                                                   
                                                      B
                                                   
                                                   
                                                      j
                                                   
                                                   
                                                      k
                                                   
                                                
                                                ]
                                                )
                                                =
                                                (
                                                
                                                   
                                                      B
                                                   
                                                   
                                                      j
                                                   
                                                   
                                                      k
                                                   
                                                
                                                -
                                                (
                                                
                                                   
                                                      TC
                                                   
                                                   
                                                      i
                                                      ,
                                                      j
                                                   
                                                
                                                .
                                                
                                                   
                                                      AR
                                                   
                                                   
                                                      i
                                                      ,
                                                      j
                                                   
                                                
                                                +
                                                
                                                   
                                                      OR
                                                   
                                                   
                                                      j
                                                   
                                                
                                                
                                                ∗
                                                
                                                (
                                                
                                                   
                                                      TC
                                                   
                                                   
                                                      i
                                                      ,
                                                      j
                                                   
                                                
                                                .
                                                
                                                   
                                                      L
                                                   
                                                   
                                                      i
                                                      ,
                                                      j
                                                   
                                                
                                                +
                                                
                                                   
                                                      TC
                                                   
                                                   
                                                      i
                                                      ,
                                                      j
                                                   
                                                
                                                .
                                                
                                                   
                                                      UL
                                                   
                                                   
                                                      i
                                                      ,
                                                      j
                                                   
                                                
                                                )
                                                )
                                                )
                                             
                                          
                                       
                                       
                                          
                                             (15)
                                             
                                                
                                                   
                                                      ϕ
                                                   
                                                   
                                                      i
                                                      ,
                                                      j
                                                   
                                                
                                                (
                                                
                                                   
                                                      TC
                                                   
                                                   
                                                      i
                                                      ,
                                                      j
                                                   
                                                
                                                ,
                                                [
                                                
                                                   
                                                      A
                                                   
                                                   
                                                      j
                                                   
                                                   
                                                      k
                                                   
                                                
                                                ,
                                                
                                                   
                                                      B
                                                   
                                                   
                                                      j
                                                   
                                                   
                                                      k
                                                   
                                                
                                                ]
                                                ,
                                                
                                                   
                                                      α
                                                   
                                                   
                                                      j
                                                   
                                                
                                                )
                                                =
                                                
                                                   
                                                      ϕ
                                                   
                                                   
                                                      i
                                                      ,
                                                      j
                                                   
                                                
                                                
                                                   
                                                      (
                                                      
                                                         
                                                            TC
                                                         
                                                         
                                                            i
                                                            ,
                                                            j
                                                         
                                                      
                                                      ,
                                                      [
                                                      
                                                         
                                                            A
                                                         
                                                         
                                                            j
                                                         
                                                         
                                                            k
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            B
                                                         
                                                         
                                                            j
                                                         
                                                         
                                                            k
                                                         
                                                      
                                                      ]
                                                      )
                                                   
                                                   
                                                      ★
                                                   
                                                
                                                
                                                ∗
                                                
                                                
                                                   
                                                      α
                                                   
                                                   
                                                      j
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             (16)
                                             
                                                
                                                   
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  a
                                                               
                                                               
                                                                  j
                                                               
                                                               
                                                                  k
                                                               
                                                            
                                                            =
                                                            
                                                               
                                                                  TC
                                                               
                                                               
                                                                  i
                                                                  ,
                                                                  j
                                                               
                                                            
                                                            .
                                                            
                                                               
                                                                  AR
                                                               
                                                               
                                                                  i
                                                                  ,
                                                                  j
                                                               
                                                            
                                                            +
                                                            
                                                               
                                                                  ϕ
                                                               
                                                               
                                                                  i
                                                                  ,
                                                                  j
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  b
                                                               
                                                               
                                                                  j
                                                               
                                                               
                                                                  k
                                                               
                                                            
                                                            =
                                                            
                                                               
                                                                  a
                                                               
                                                               
                                                                  j
                                                               
                                                               
                                                                  k
                                                               
                                                            
                                                            +
                                                            
                                                               
                                                                  OR
                                                               
                                                               
                                                                  j
                                                               
                                                            
                                                            
                                                            ∗
                                                            
                                                            (
                                                            
                                                               
                                                                  TC
                                                               
                                                               
                                                                  i
                                                                  ,
                                                                  j
                                                               
                                                            
                                                            .
                                                            
                                                               
                                                                  L
                                                               
                                                               
                                                                  i
                                                                  ,
                                                                  j
                                                                  +
                                                                  1
                                                               
                                                            
                                                            +
                                                            
                                                               
                                                                  TC
                                                               
                                                               
                                                                  i
                                                                  ,
                                                                  j
                                                               
                                                            
                                                            .
                                                            
                                                               
                                                                  UL
                                                               
                                                               
                                                                  i
                                                                  ,
                                                                  j
                                                                  +
                                                                  1
                                                               
                                                            
                                                            )
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    

Gap time calculation for terminal j: This calculates the gap time between two consecutive events.
                                          
                                             (17)
                                             
                                                
                                                   
                                                      GT
                                                   
                                                   
                                                      k
                                                      ,
                                                      k
                                                      +
                                                      1
                                                   
                                                
                                                =
                                                
                                                   
                                                      E
                                                   
                                                   
                                                      k
                                                      +
                                                      1
                                                   
                                                
                                                .
                                                OS
                                                -
                                                
                                                   
                                                      E
                                                   
                                                   
                                                      k
                                                   
                                                
                                                .
                                                OF
                                             
                                          
                                       
                                    

Tightness condition: The use of tightness value 
                                          
                                             
                                                
                                                   TN
                                                
                                                
                                                   k
                                                   ,
                                                   k
                                                   +
                                                   1
                                                
                                             
                                          
                                        is to give an indication with respect to terminal berthing capacity status. Its meaning lies in two hands. On one hand, it verifies whether events in the terminal plan board are tightly planned. On the other hand, it will give an indication to determine whether the remaining available time space is large enough to handle more incoming requests. For that purpose, the reciprocal of the gap time 
                                          
                                             
                                                
                                                   GT
                                                
                                                
                                                   k
                                                   ,
                                                   k
                                                   +
                                                   1
                                                
                                             
                                          
                                        is used to calculate the tightness condition, see Eq. (18). The parameter 
                                          
                                             β
                                          
                                        is a threshold that been used to decide if the given gap time impose an influence on the overall conditions. Namely, if the value is under 
                                          
                                             β
                                          
                                       , it is treated as a slack time added between two events which enhance the robustness of the plan thus play a positive role for the tightness condition. A relative large value could result in a waste of resources given the fact that no more events could be inserted in the gap thus will put a negative effect on the tightness condition. Finally, a large gap space is also welcome since it enables the terminal capable of accepting more requests. The gap time selection is depicted in Fig. 10
                                       . The relational mappings between 
                                          
                                             
                                                
                                                   TN
                                                
                                                
                                                   k
                                                   ,
                                                   k
                                                   +
                                                   1
                                                
                                             
                                          
                                        and 
                                          
                                             
                                                
                                                   GT
                                                
                                                
                                                   k
                                                   ,
                                                   k
                                                   +
                                                   1
                                                
                                             
                                          
                                        is given in Fig. 11
                                       . The smaller the gap time, the large the tightness value.
                                          
                                             (18)
                                             
                                                
                                                   
                                                      TN
                                                   
                                                   
                                                      k
                                                      ,
                                                      k
                                                      +
                                                      1
                                                   
                                                
                                                =
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  1
                                                                  /
                                                                  
                                                                     
                                                                        GT
                                                                     
                                                                     
                                                                        k
                                                                        ,
                                                                        k
                                                                        +
                                                                        1
                                                                     
                                                                  
                                                               
                                                               
                                                                  if
                                                                  
                                                                  
                                                                     
                                                                        GT
                                                                     
                                                                     
                                                                        k
                                                                        ,
                                                                        k
                                                                        +
                                                                        1
                                                                     
                                                                  
                                                                  >
                                                                  β
                                                               
                                                            
                                                            
                                                               
                                                                  0
                                                               
                                                               
                                                                  otherwise
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    

In general, the terminal party wishes to minimize the tightness value to obtain better berthing capacity. As a result, the objective is given as follows where ne is the total number of events per terminal.
                                 
                                    (19)
                                    
                                       Minimize
                                       
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                1
                                             
                                             
                                                ne
                                             
                                          
                                       
                                       
                                          
                                             TN
                                          
                                          
                                             k
                                             ,
                                             k
                                             +
                                             1
                                          
                                       
                                    
                                 
                              
                           


                              
                                 
                                    1.
                                    Terminal available time window constrains, Eq. (20) for scenario 1 and Eq. (21) for scenario 2:
                                          
                                             (20)
                                             
                                                
                                                   
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  A
                                                               
                                                               
                                                                  j
                                                               
                                                               
                                                                  k
                                                               
                                                            
                                                            >
                                                            
                                                               
                                                                  TC
                                                               
                                                               
                                                                  i
                                                                  ,
                                                                  j
                                                               
                                                            
                                                            .
                                                            
                                                               
                                                                  AR
                                                               
                                                               
                                                                  i
                                                                  ,
                                                                  j
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  B
                                                               
                                                               
                                                                  j
                                                               
                                                               
                                                                  k
                                                               
                                                            
                                                            ⩾
                                                            
                                                               
                                                                  A
                                                               
                                                               
                                                                  j
                                                               
                                                               
                                                                  k
                                                               
                                                            
                                                            +
                                                            
                                                               
                                                                  OR
                                                               
                                                               
                                                                  j
                                                               
                                                            
                                                            
                                                            ∗
                                                            
                                                            (
                                                            
                                                               
                                                                  TC
                                                               
                                                               
                                                                  i
                                                                  ,
                                                                  j
                                                               
                                                            
                                                            .
                                                            
                                                               
                                                                  L
                                                               
                                                               
                                                                  i
                                                                  ,
                                                                  j
                                                               
                                                            
                                                            +
                                                            
                                                               
                                                                  TC
                                                               
                                                               
                                                                  i
                                                                  ,
                                                                  j
                                                               
                                                            
                                                            .
                                                            
                                                               
                                                                  UL
                                                               
                                                               
                                                                  i
                                                                  ,
                                                                  j
                                                               
                                                            
                                                            )
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             (21)
                                             
                                                
                                                   
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  A
                                                               
                                                               
                                                                  j
                                                               
                                                               
                                                                  k
                                                               
                                                            
                                                            ⩽
                                                            
                                                               
                                                                  TC
                                                               
                                                               
                                                                  i
                                                                  ,
                                                                  j
                                                               
                                                            
                                                            .
                                                            
                                                               
                                                                  AR
                                                               
                                                               
                                                                  i
                                                                  ,
                                                                  j
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  B
                                                               
                                                               
                                                                  j
                                                               
                                                               
                                                                  k
                                                               
                                                            
                                                            ⩾
                                                            
                                                               
                                                                  TC
                                                               
                                                               
                                                                  i
                                                                  ,
                                                                  j
                                                               
                                                            
                                                            .
                                                            
                                                               
                                                                  AR
                                                               
                                                               
                                                                  i
                                                                  ,
                                                                  j
                                                               
                                                            
                                                            +
                                                            
                                                               
                                                                  OR
                                                               
                                                               
                                                                  j
                                                               
                                                            
                                                            
                                                            ∗
                                                            
                                                            (
                                                            
                                                               
                                                                  TC
                                                               
                                                               
                                                                  i
                                                                  ,
                                                                  j
                                                               
                                                            
                                                            .
                                                            
                                                               
                                                                  L
                                                               
                                                               
                                                                  i
                                                                  ,
                                                                  j
                                                               
                                                            
                                                            +
                                                            
                                                               
                                                                  TC
                                                               
                                                               
                                                                  i
                                                                  ,
                                                                  j
                                                               
                                                            
                                                            .
                                                            
                                                               
                                                                  UL
                                                               
                                                               
                                                                  i
                                                                  ,
                                                                  j
                                                               
                                                            
                                                            )
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    

Gap time constrains: it should be stressed out that the berth capacity can be beneficial by adding extra time 
                                          
                                             
                                                
                                                   ϕ
                                                
                                                
                                                   i
                                                   ,
                                                   j
                                                
                                             
                                          
                                        over the barge operation start time, shown in Eq. (15). If keeps increasing, however, it will no longer contribute to tightness condition given the fact that there is no difference by putting barge to waiting queue or immediate serving. It can be seen from Fig. 12
                                        where 
                                          
                                             
                                                
                                                   gap
                                                
                                                
                                                   front
                                                
                                             
                                          
                                        equals to 
                                          
                                             
                                                
                                                   gap
                                                
                                                
                                                   back
                                                
                                             
                                          
                                       . The constraints of 
                                          
                                             
                                                
                                                   ϕ
                                                
                                                
                                                   i
                                                   ,
                                                   j
                                                
                                             
                                          
                                        is given as below:
                                          
                                             (22)
                                             
                                                0
                                                ⩽
                                                
                                                   
                                                      ϕ
                                                   
                                                   
                                                      i
                                                      ,
                                                      j
                                                   
                                                
                                                (
                                                
                                                   
                                                      TC
                                                   
                                                   
                                                      i
                                                      ,
                                                      j
                                                   
                                                
                                                ,
                                                [
                                                
                                                   
                                                      A
                                                   
                                                   
                                                      j
                                                   
                                                   
                                                      k
                                                   
                                                
                                                ,
                                                
                                                   
                                                      B
                                                   
                                                   
                                                      j
                                                   
                                                   
                                                      k
                                                   
                                                
                                                ]
                                                ,
                                                
                                                   
                                                      α
                                                   
                                                   
                                                      j
                                                   
                                                
                                                )
                                                ⩽
                                                
                                                   
                                                      TC
                                                   
                                                   
                                                      i
                                                      ,
                                                      j
                                                   
                                                
                                                .
                                                
                                                   
                                                      AR
                                                   
                                                   
                                                      i
                                                      ,
                                                      j
                                                   
                                                
                                                -
                                                
                                                   
                                                      A
                                                   
                                                   
                                                      j
                                                   
                                                   
                                                      k
                                                   
                                                
                                             
                                          
                                       
                                    

The decision variable made by terminal planner should include the specified barge handling time window 
                                 
                                    [
                                    
                                       
                                          T
                                       
                                       
                                          a
                                          (
                                          i
                                          )
                                       
                                       
                                          j
                                       
                                    
                                    ,
                                    
                                       
                                          T
                                       
                                       
                                          b
                                          (
                                          i
                                          )
                                       
                                       
                                          j
                                       
                                    
                                    ]
                                 
                               for barge call 
                                 
                                    
                                       
                                          TC
                                       
                                       
                                          j
                                       
                                    
                                 
                              . Based on the above analysis, we can identify that the suitable time window is determined by two factors: terminal call 
                                 
                                    
                                       
                                          TC
                                       
                                       
                                          i
                                          ,
                                          j
                                       
                                    
                                 
                               and berth occupancy level 
                                 
                                    
                                       
                                          α
                                       
                                       
                                          j
                                       
                                    
                                 
                               as expressed in Eqs. (15) and (16).

In summary, Eqs. (13)–(16) and constrains (20) and (21) are relevant to the calculation of available time window for 
                                 
                                    
                                       
                                          TC
                                       
                                       
                                          i
                                          ,
                                          j
                                       
                                    
                                 
                              . As shown in Fig. 6, these equations will be invoked when the coming message type is CFP(call for proposal). Eqs. (17) and (18) together with constrains (22) are equivalent to the evaluation of terminal berthing capacity and been invoked when the message type is request.

The decision making process of TA includes four phases:
                           
                              1.
                              
                                 Find available time window: When receive the barge call, the decision making process activated. The first step is to seek idle period from current plan board. It is denoted as 
                                    
                                       [
                                       
                                          
                                             A
                                          
                                          
                                             j
                                          
                                          
                                             k
                                          
                                       
                                       ,
                                       
                                          
                                             B
                                          
                                          
                                             j
                                          
                                          
                                             k
                                          
                                       
                                       ]
                                    
                                  where obtained by Eq. (13).


                                 Find available time window for barge handling: A list of available time window created at phase 1 will be evaluated by Eqs. (20) and (21). It aims at targeting the appropriate one for coming request.


                                 Applying berth occupancy level: The given time window selected at phase 2 will be further processed by taking into consideration the berth occupancy level 
                                    
                                       
                                          
                                             α
                                          
                                          
                                             j
                                          
                                       
                                    
                                 . It is calculated by Eqs. (15) and (16). By doing so, the best inserted position is found in favor of terminal’s objective. During the negotiation, the 
                                    
                                       
                                          
                                             α
                                          
                                          
                                             j
                                          
                                       
                                    
                                  will be updated accordingly. This update will be instructed by mediator agent, details will be covered in later section. We only provide the update procedure which is shown as:
                                    
                                       (23)
                                       
                                          
                                             
                                                α
                                             
                                             
                                                j
                                             
                                             
                                                ★
                                             
                                          
                                          =
                                          
                                             
                                                α
                                             
                                             
                                                j
                                             
                                          
                                          
                                          ∗
                                          
                                          (
                                          1
                                          -
                                          θ
                                          )
                                       
                                    
                                 where 
                                    
                                       θ
                                    
                                  is constant value specify the step size of the update process.


                                 Issuing time window: The final step is to package the created information and send it back to corresponding BA.

Up to now, the decision models of BA and TA are explained. It should be stressed out that either BA or TA has its own objective and both of them want their interests always be satisfied. However, these two objective are conflict with each other by showing the improvement of one is obtained by sacrificing the other one. As stated before, a full terminal utilization (in terms of 100 percent berth occupancy) is guaranteed at the expense of a continuous queuing of coming vessels which tremendously increase the turn around time. Likewise, to ensure the barge never wait before berthing is given at the cost of considerably low terminal utilization. To be concluded, when and how to issue trade-off between multi objectives decision making that could be beneficial for all parties is a complex problem that needs to be solved.

To cope with the mentioned problem, in this paper, we model BA-TA interaction as a leader–follower Stacklberg game. The Stacklberg game is a two-person game proposed by economist Von Stacklberg [20] wherein one person (the leader) is able to impose his decision on the other person (the follower(s)). It is a tool to analyze the interaction of strategic decision makers which has been extensively applied in economics, politics, computer science and biology. Recent research outputs reflect the potential usage of game theoretic approach to solve complex engineering problem, especially for decision making and multi objective optimization [40–42]. In general, several well-established two-player game models are available which includes Stackelberg, Cournot and Bertrand model. The major difference between Stackelberg model and other models (Cournot and Bertrand model) is the timing properties [43]. To be specific, in Stackelberg model, players make movement in a sequential manner while the others in a simultaneous manner. Certain type of competition may engage in Stackelberg game if one player has advantage enabling it to move first and force followers to take actions sequentially. In the addressed HBT planning problem, the interests conflict between terminal and barge operator is in nature a leader–follower competition for which the terminal operator (leader) possess advantages by issuing time window first. Afterwards the barge operator (follower) will obtain the time window and make decisions by sequencing the best visit order to obtain its objective. The two stage decision making process best matches the Stackelberg model properties. Moreover, the sequential movement enables a perfect information sharing structure [44] for both players, which is an ideal context for the negotiation between BA and TA since both players need others decision variables to make movement. In contrast, the decision-making in Cournot and Bertrand are independent and the information sharing depicts an incomplete structure. Based on the above discussion, it is a reasonable choice for choosing Stackelberg model in this research.

In the process of decision making, the leader will first move by choosing decision variables in an attempt to achieving his own objective optimality. The follower will perceive the decision vector from the leader and response by selecting decision variables that fulfill his own objective. In turn, the decision made by follower will be anticipated by the leader and force leader to make decision again. The model proposed for HBT planning is shown in Fig. 13
                         where TA is modeled as leader and BA is modeled as follower. In the model, multiple terminals make decisions simultaneously which lead to a multi-leader structure in the upper level. Intuitively, each terminal j will have its own berth occupancy level 
                           
                              
                                 
                                    α
                                 
                                 
                                    j
                                 
                              
                           
                        . Thus the decision vector proposed by upper-level is as 
                           
                              [
                              
                                 
                                    α
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                                 
                                    α
                                 
                                 
                                    2
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    α
                                 
                                 
                                    j
                                 
                              
                              ]
                           
                        . In this paper, we configure the berth occupancy level as an identical number for each terminal which means 
                           
                              
                                 
                                    α
                                 
                                 
                                    1
                                 
                              
                              =
                              
                                 
                                    α
                                 
                                 
                                    2
                                 
                              
                              =
                              ⋯
                              =
                              
                                 
                                    α
                                 
                                 
                                    j
                                 
                              
                              =
                              α
                           
                         where 
                           
                              α
                           
                         is a real value between 
                           
                              [
                              0
                              ,
                              1
                              ]
                           
                        . A decision vector from upper-level is added to the planning process in the form of time window constrains, found in Eq. (15) and (16). Given the time window constrains, the follower will make response by seeking his route to obtain best turn around time. The generated route plan will be inserted on the terminal plan board thus impose an influence on the tightness condition (Eq. (18)). The smaller the tightness, the better the terminal berthing capacity utilization. In consequence, the leader could update its berth occupancy rate that force the lower-level barge response again.

The fundamental of enabling an efficient leader–follower coordination is that the utility value of each game player is transferable. To be exact, the one with high utility value is capable and willingly to compensate the other one with low utility. In our case, the leader makes a decision that result in an improved tightness condition where it could lead to a long turn rotation time for follower. Thus in the following negotiation round, the leader is able to reduce its own utility to compensate the follower’s interest. One should note that this structure leads to a more complicated iterative negotiation, since both leader and follower have no guarantee to be able to find its best strategy that confront with global optimality in one negotiation phase. In order to support corporative decision making between BA and TA, the mediator is introduced. Its role is essentially as a negotiation hub that provide coordination as a service to BA and TA.

The major task of MA is to give instructions to guide the generated plan achieve global optimal. In general, the most common way is to transform the multi objectives problem into a single one by applying weighs to each objective and sum them in one function. The main disadvantage here is that the weights are hard to determine, it highly depends on nature of the problem. In our case, we search the feasible space that is controlled by the utility of BA and TA. As shown in Fig. 14
                           , the red arrow represents the inner loop where TA and BA interact with each other to create plan. The blue arrow represents the outer loop where mediation is introduced to asses the multi objectives and provide guidance if current performance is not reaching optimal, the decision making detail is given as follows:


                           
                              
                                 
                                    
                                       x
                                    
                                    
                                       1
                                    
                                 
                              
                            denotes as the strategy of upper-level leader, referred to as the berth occupancy level.


                           
                              
                                 
                                    
                                       x
                                    
                                    
                                       2
                                    
                                 
                              
                            denotes as the strategy of lower-level follower, referred to as the rotation sequence of barges.


                           
                              
                                 
                                    
                                       U
                                    
                                    
                                       L
                                    
                                 
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       x
                                    
                                    
                                       2
                                    
                                 
                                 )
                              
                            denotes as the utility function of leader by taken 
                              
                                 
                                    
                                       x
                                    
                                    
                                       1
                                    
                                 
                              
                            and 
                              
                                 
                                    
                                       x
                                    
                                    
                                       2
                                    
                                 
                              
                            into account, it is calculated as:
                              
                                 (24)
                                 
                                    
                                       
                                          U
                                       
                                       
                                          L
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    
                                       
                                          x
                                       
                                       
                                          2
                                       
                                    
                                    )
                                    =
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               ∑
                                                            
                                                            
                                                               j
                                                               =
                                                               1
                                                            
                                                            
                                                               NT
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               ∑
                                                            
                                                            
                                                               k
                                                               =
                                                               1
                                                            
                                                            
                                                               NE
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            TN
                                                         
                                                         
                                                            {
                                                            k
                                                            ,
                                                            k
                                                            +
                                                            1
                                                            }
                                                         
                                                         
                                                            j
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    NT
                                 
                              
                           where NT is the total number of terminals, TN is obtained in Eq. (18).


                           
                              
                                 
                                    
                                       U
                                    
                                    
                                       F
                                    
                                 
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       x
                                    
                                    
                                       2
                                    
                                 
                                 )
                              
                            denotes as the utility function of follower by taken 
                              
                                 
                                    
                                       x
                                    
                                    
                                       1
                                    
                                 
                              
                            and 
                              
                                 
                                    
                                       x
                                    
                                    
                                       2
                                    
                                 
                              
                            into account, it is calculated as:
                              
                                 (25)
                                 
                                    
                                       
                                          U
                                       
                                       
                                          F
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    
                                       
                                          x
                                       
                                       
                                          2
                                       
                                    
                                    )
                                    =
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               ∑
                                                            
                                                            
                                                               i
                                                               =
                                                               1
                                                            
                                                            
                                                               NB
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            TR
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    NB
                                 
                              
                           where NB is the total number of barge calls, TR is calculated in Eq. (7).


                           
                              
                                 
                                    
                                       D
                                    
                                    
                                       F
                                    
                                 
                                 (
                                 x
                                 1
                                 ,
                                 x
                                 2
                                 )
                              
                            denotes the decision strategy chosen by follower which takes the decision of leader into consideration, where 
                              
                                 
                                    
                                       x
                                    
                                    
                                       2
                                    
                                 
                                 ⊆
                                 
                                    
                                       D
                                    
                                    
                                       F
                                    
                                 
                                 (
                                 x
                                 1
                                 ,
                                 x
                                 2
                                 )
                              
                           .

The optimal strategy of follower is obtained when:
                              
                                 (26)
                                 
                                    
                                       
                                          D
                                       
                                       
                                          F
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    
                                       
                                          x
                                       
                                       
                                          2
                                       
                                    
                                    )
                                    =
                                    {
                                    
                                       
                                          x
                                       
                                       
                                          2
                                       
                                       
                                          ★
                                       
                                    
                                    |
                                    
                                       
                                          U
                                       
                                       
                                          F
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    
                                       
                                          x
                                       
                                       
                                          2
                                       
                                       
                                          ★
                                       
                                    
                                    )
                                    ⩾
                                    
                                       
                                          U
                                       
                                       
                                          F
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    
                                       
                                          x
                                       
                                       
                                          2
                                       
                                    
                                    )
                                    ,
                                    
                                       
                                          x
                                       
                                       
                                          1
                                       
                                    
                                    ⊆
                                    
                                       
                                          D
                                       
                                       
                                          L
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    
                                       
                                          x
                                       
                                       
                                          2
                                       
                                    
                                    )
                                    }
                                 
                              
                           
                           
                              
                                 
                                    
                                       D
                                    
                                    
                                       L
                                    
                                 
                                 (
                                 x
                                 1
                                 ,
                                 x
                                 2
                                 )
                              
                            denotes the decision strategy chosen by leader which taken the decision of follower into consideration, where 
                              
                                 
                                    
                                       x
                                    
                                    
                                       1
                                    
                                 
                                 ⊆
                                 
                                    
                                       D
                                    
                                    
                                       L
                                    
                                 
                                 (
                                 x
                                 1
                                 ,
                                 x
                                 2
                                 )
                              
                           .

The Stacklberg equilibrium is obtained as 
                              
                                 
                                    
                                       D
                                    
                                    
                                       ★
                                    
                                 
                                 =
                                 (
                                 
                                    
                                       D
                                    
                                    
                                       L
                                    
                                    
                                       ★
                                    
                                 
                                 ,
                                 
                                    
                                       D
                                    
                                    
                                       F
                                    
                                    
                                       ★
                                    
                                 
                                 )
                              
                            when:
                              
                                 (27)
                                 
                                    
                                       
                                          D
                                       
                                       
                                          L
                                       
                                       
                                          ★
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          1
                                       
                                       
                                          ★
                                       
                                    
                                    ,
                                    
                                       
                                          x
                                       
                                       
                                          2
                                       
                                       
                                          ★
                                       
                                    
                                    )
                                    =
                                    {
                                    
                                       
                                          x
                                       
                                       
                                          1
                                       
                                       
                                          ★
                                       
                                    
                                    |
                                    
                                       
                                          U
                                       
                                       
                                          L
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          1
                                       
                                       
                                          ★
                                       
                                    
                                    ,
                                    
                                       
                                          x
                                       
                                       
                                          2
                                       
                                       
                                          ★
                                       
                                    
                                    )
                                    -
                                    
                                       
                                          U
                                       
                                       
                                          L
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    
                                       
                                          x
                                       
                                       
                                          2
                                       
                                       
                                          ★
                                       
                                    
                                    )
                                    ⩽
                                    
                                       
                                          ε
                                       
                                       
                                          L
                                       
                                    
                                    ,
                                    
                                       
                                          x
                                       
                                       
                                          2
                                       
                                    
                                    ⊆
                                    
                                       
                                          D
                                       
                                       
                                          F
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    
                                       
                                          x
                                       
                                       
                                          2
                                       
                                    
                                    )
                                    }
                                 
                              
                           
                           
                              
                                 (28)
                                 
                                    
                                       
                                          D
                                       
                                       
                                          F
                                       
                                       
                                          ★
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          1
                                       
                                       
                                          ★
                                       
                                    
                                    ,
                                    
                                       
                                          x
                                       
                                       
                                          2
                                       
                                       
                                          ★
                                       
                                    
                                    )
                                    =
                                    {
                                    
                                       
                                          x
                                       
                                       
                                          2
                                       
                                       
                                          ★
                                       
                                    
                                    |
                                    
                                       
                                          U
                                       
                                       
                                          F
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          1
                                       
                                       
                                          ★
                                       
                                    
                                    ,
                                    
                                       
                                          x
                                       
                                       
                                          2
                                       
                                       
                                          ★
                                       
                                    
                                    )
                                    -
                                    
                                       
                                          U
                                       
                                       
                                          F
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          1
                                       
                                       
                                          ★
                                       
                                    
                                    ,
                                    
                                       
                                          x
                                       
                                       
                                          2
                                       
                                    
                                    )
                                    ⩽
                                    
                                       
                                          ε
                                       
                                       
                                          F
                                       
                                    
                                    ,
                                    
                                       
                                          x
                                       
                                       
                                          1
                                       
                                    
                                    ⊆
                                    
                                       
                                          D
                                       
                                       
                                          L
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    
                                       
                                          x
                                       
                                       
                                          2
                                       
                                    
                                    )
                                    }
                                 
                              
                           where 
                              
                                 
                                    
                                       ε
                                    
                                    
                                       F
                                    
                                 
                              
                            and 
                              
                                 
                                    
                                       ε
                                    
                                    
                                       L
                                    
                                 
                              
                            is a small number to identify the convergence.

The strategies of leader and follower will be converged to equilibrium when neither leader’s nor follower’s utility can be further improved by sacrificing other’s. In other words, no one’s strategy can dominate the decision making process and the final solution is beneficial for both.


                        
                           Algorithm 2
                           Solution algorithm 
                                 
                                    
                                       
                                       
                                          
                                             
                                                1: Input: BCP: a set of barge call profiles. 
                                                   
                                                      
                                                         
                                                            bcp
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                   
                                                : single barge call profile contains a set of terminal call 
                                                   
                                                      
                                                         
                                                            TC
                                                         
                                                         
                                                            j
                                                         
                                                      
                                                   
                                                , where 
                                                   
                                                      j
                                                      ⊆
                                                      [
                                                      1
                                                      ,
                                                      2
                                                      ,
                                                      …
                                                      ,
                                                      N
                                                      ]
                                                   
                                                 and N is the total number of terminal calls of 
                                                   
                                                      
                                                         
                                                            bcp
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                   
                                                . 
                                                   
                                                      
                                                         
                                                            ∊
                                                         
                                                         
                                                            L
                                                         
                                                      
                                                   
                                                 and 
                                                   
                                                      
                                                         
                                                            ∊
                                                         
                                                         
                                                            L
                                                         
                                                      
                                                   
                                                 optimization threshold (Eqs. (20) and (21)); 
                                                   
                                                      θ
                                                   
                                                 the step size of 
                                                   
                                                      α
                                                   
                                                .
                                          
                                          
                                             
                                                2: Output: An ordered terminal visit sequence for each 
                                                   
                                                      
                                                         
                                                            bcp
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                   
                                                .
                                          
                                          
                                             
                                                3: Initialization: 
                                                   
                                                      α
                                                   
                                                : berth occupancy level for terminals, m a game play stage counter, where start from 1;
                                          
                                          
                                             
                                                4: for All 
                                                   
                                                      
                                                         
                                                            bcp
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                   
                                                 in BCP 
                                                do
                                             
                                          
                                          
                                             
                                                5: 
                                                for All 
                                                   
                                                      
                                                         
                                                            TC
                                                         
                                                         
                                                            j
                                                         
                                                      
                                                   
                                                 in 
                                                   
                                                      
                                                         
                                                            bcp
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                   
                                                 
                                                do
                                             
                                          
                                          
                                             
                                                6: //Phase 1: Find feasible visit sequence for each 
                                                
                                                   
                                                      
                                                         
                                                            bcp
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                   
                                                
                                                .
                                             
                                          
                                          
                                             
                                                7: Find available time window from terminal j (based on Eqs. (13)–(16));
                                          
                                          
                                             
                                                8: 
                                                end for
                                             
                                          
                                          
                                             
                                                9: //Phase 2: Evaluate the generated plan for each 
                                                
                                                   
                                                      
                                                         
                                                            bsp
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                   
                                                 
                                                using 
                                                Algorithm 1.
                                          
                                          
                                             10: Evaluate rotation plan performance, return decisions;
                                          
                                          
                                             11: 
                                                if 
                                                
                                                   
                                                      RePlanDecision
                                                      
                                                      ≠
                                                      
                                                      false
                                                   
                                                 
                                                then
                                             
                                          
                                          
                                             12: acquire update call sequence 
                                                   
                                                      
                                                         
                                                            bcp
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                   
                                                 to 
                                                   
                                                      
                                                         
                                                            bcp
                                                         
                                                         
                                                            i
                                                         
                                                         
                                                            ★
                                                         
                                                      
                                                   
                                                 and go to step 5;
                                          
                                          
                                             13: 
                                                else
                                             
                                          
                                          
                                             14: plan is validated for 
                                                   
                                                      
                                                         
                                                            bcp
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                   
                                                , continue to step 4 with 
                                                   
                                                      
                                                         
                                                            bcp
                                                         
                                                         
                                                            i
                                                            +
                                                            1
                                                         
                                                      
                                                   
                                                ;
                                          
                                          
                                             15: 
                                                end if
                                             
                                          
                                          
                                             16: end for
                                             
                                          
                                          
                                             17: //Phase 3: Assess the global objective of the plan.
                                             
                                          
                                          
                                             18: calculate average turn around time TR for BCP (Eq. (8));
                                          
                                          
                                             19: calculate average tightness value GT of terminals (Eq. (19));
                                          
                                          
                                             20: //Phase 4: If necessary, update 
                                                
                                                   
                                                      α
                                                   
                                                 
                                                and initiate a new game stage 
                                                
                                                   
                                                      m
                                                      =
                                                      m
                                                      +
                                                      1
                                                   
                                                
                                                , otherwise, plan complete for BCP
                                             
                                          
                                          
                                             21: if conditions (27) and (28) 
                                                
                                                   
                                                      holds
                                                   
                                                 
                                                then
                                             
                                          
                                          
                                             22: Plan complete;
                                          
                                          
                                             23: else
                                             
                                          
                                          
                                             24: 
                                                
                                                   
                                                      
                                                         
                                                            α
                                                         
                                                         
                                                            j
                                                         
                                                         
                                                            ★
                                                         
                                                      
                                                      =
                                                      
                                                         
                                                            α
                                                         
                                                         
                                                            j
                                                         
                                                      
                                                      
                                                      ∗
                                                      
                                                      (
                                                      1
                                                      -
                                                      θ
                                                      )
                                                      ,
                                                      
                                                      m
                                                      =
                                                      m
                                                      +
                                                      1
                                                   
                                                , go to step 4//Update berth occupancy level and game iterations
                                          
                                          
                                             25: end if
                                             
                                          
                                       
                                    
                                 
                              
                           

Up to now, all fundamental elements of the proposed MAS system have been explained. In this section, we present the integrated decision making process. In the process of decision making, a follower problem is linked to the leader via the berth occupancy level (will transfer to available time window) and operation rate. Since the operation rate is assumed a constant number, thus the interface leads to a straightforward collaboration mechanism between leader and follower. The leader has full knowledge about the response from followers, it can adjust its strategy. As a result, by manipulating the berth occupancy level, the leader can guide the followers to optimize their own objectives. The idea motivates Algorithm 2. Its solving process include 4 phases:
                           
                              
                                 Phase 1:
                                 After acquiring the information about barge call profiles and terminal service profiles, a initial feasible plan can be generated for each 
                                    
                                       
                                          
                                             bcp
                                          
                                          
                                             i
                                          
                                       
                                    
                                 . The generated plan will include the decision variable of visit sequence, start and departure time (see Eq. (12)). The term ‘feasible’ indicates the generated plan meets the predefined constrains listed in Eqs. (9)–(11).


                                 Phase 2:
                                 Every iteration loop (lines 5–8), a feasible plan is generated and Algorithm 1 will be called. If the decision variable RePlanDecision is true, then a newly created sequence will be attached to the decision and initiate a new round of phase 1.


                                 Phase 3:
                                 When all followers in set BCP have found their best strategies (denote as the optimal strategy of followers Eq. (26)) under current leaders’ strategies (the choice of 
                                    
                                       α
                                    
                                 ), the global objectives are calculated by Eqs. (8) and (19) in this phase.


                                 Phase 4:
                                 Every iteration m (lines 5–19, Algorithm 2) is one game stage, wherein all barges are seeking their best visit sequence with minimum turn around time. Their decisions (rotation plan) will influence the terminal tightness conditions. Phase 3 (lines 17–20) calculate the objectives for both barge and terminals. In phase 4, these two objectives are evaluated based on Eqs. (27) and (28). The variable 
                                    
                                       
                                          
                                             ∊
                                          
                                          
                                             L
                                          
                                       
                                    
                                  and 
                                    
                                       
                                          
                                             ∊
                                          
                                          
                                             F
                                          
                                       
                                    
                                  are used to control the number of game stages and the degree of optimization. If the condition at line 21 is met, it indicates that the performance improvement cannot be gained by further adjusting players’ strategies thus a equilibrium is reached. Otherwise, a new game stage is initiated and corresponding strategy of leader is modified.

The multi-agent based intelligent HBT planing system was implemented as a test bench to verify the correctness and effectiveness of the proposed framework and solution by using JADE framework [45]. The system architecture shown in Fig. 15
                        
                         is spring from the abstract model depicted in Fig. 4. In the upper (leader) layer, the TA is permanently deployed at the local resource management system. In the middle layer, the mediator agent group is developed. The administration service in abstract model is instantiated as two services called yellow page service and gate way service. The yellow page service is used to manage all registered agents. The gate way service is designed for routing data from sender to receiver. Another one is implemented as the mediator agent. Besides these two, a decision agent is also added to this layer. In principle, the decision agent is designed to incorporate heuristics engine to asses the performance of obtained plan which should be part of BA. In practice, its functionality is identical to all BAs. By extracting the decision making function from local agent and moving it to middle level, the distributed BA could share the same functionalities and system elasticity and feasibility are improved. The decision agent is designed specifically for BA, since it needs to have identifier for BA to locate, we name it an agent rather than a service. Finally, at lower (follower) layer, the BA is created and configured in run time.

To demonstrate the usefulness and performance of our proposed bi-level optimization algorithm and developed mediator-based agent system, a case study is presented in this section. For the purpose of demonstration, the context was simplified compared to real scenario. Only 6 independent barges and 8 geographically distributed terminals are created.

We present the barge call profile in Table 3
                              . In the setting, a rotation visit consists of a visit between minimum 5 and maximum 8 terminals. The arrival time is defined as the time instance that barge enter into port region, it is assumed equal to the time arrived at the first planned terminal. The deadline is latest time when barge has to leave the port region. It regards as a critical constraints that the planning system should fulfill with. A feasible plan generally refers to the one that has all terminal call planned and the departure time of final terminal call is within the deadline. The initial visit sequence is defined as the preference of barge operators. The planning system will start with it and gradually converged to the optimal sequence.

As discussed previously, the major tasks of terminal operator are to provide suitable time window such that their resources are properly utilized. In the course of decision making, despite the barge call profiles, other related factors include operation rate, mooring time, number of operation quays, threshold for gap time selection and berth occupancy level (shown in Table 4
                              ). In our case study, the number of quay for each terminal is set to 1. The operation rate and mooring time are configured as constant number. The threshold of gap time selection in the case is configured as 10min. The berth occupancy level is a real number varied between 0 and 1 with a step size of 0.05.

The decision making parameter of followers are given in Table 5
                              . It specifies the basic elements for the running of simulated annealing heuristics (Algorithm 1). It can be adjusted manually. The increase of the parameter could lead to better result but also makes the solving process become more time-consuming. Table 6
                               presents the decision making parameter of mediator agent. The given parameters are used to control the number of game playing round and determine the convergent condition of the solution. Particular usage of the parameters can be found in Algorithm 2.

The case study considers the port network layout as a line structure which mimic the shape of port of Rotterdam. Table 7
                               contains the sailing time between 8 terminals. Each terminal has the capacity to handle one barge at one time. It should be pointed out that the data we used in this case study is not correspond to the real port but is good enough for our demonstration purpose.


                           Fig. 17
                            plots the rotation plan generated by the proposed system which depicted in gantt chart. The dark blue box represents the already planned activities such as terminal closed, maintenance events, sea-vessel operation or other already planned barge calls. The upper gantt chart gives the result of first game stage where all terminals has the largest berth occupancy level which lead to optimal tightness conditions. It can be clearly identified that the turn around time is extremely large at this initial stage. Even all the required deadline are met and all the terminal call are planned, the result is still not satisfied. The lower gantt chart depicts the plan generated at final game stage where the turn around time of each barge is improved significantly. It is obtained by loosing the berth occupancy level of terminals thus lead to a reduced tightness condition. Our proposed algorithm could guarantee that neither the turnaround time nor the tightness condition can dominant the game playing, individual selfish will be balanced to mutual benefits. This can be seen in Fig. 18
                           . The horizontal axis shows the number of game stages played and the vertical axis shows the average turn around time and average tightness conditions respectively. Initially, the tightness condition is at a favor level where turn around time is extremely large. After 10 game stage, both objectives are approaching the stable region where no further improvement can be achieved.


                           Fig. 16 shows a screen snapshot of system running process. The left one shows the message exchange and negotiation between agents. It is generated by a sniffer agent which is a build in tool of JADE. Right hand one is a decision making process by barge agent and it is basically a simulated annealing process.

To present the performance of approach, we compare the result with different strategies as follows:
                              
                                 •
                                 No information: Neither barge nor terminal would provide information to each other. Under such circumstance, barge will plan their trip according to its initial sailing plan regardless of terminal availability. Terminal would serve the barge only when the resources are available.

Feasible plan: The planning process will be proceeded by means of distributed agent. This scenario follows the idea of Approach [11]. Local agent aids the negotiation process, the generated plan will ensure a feasible terminal visit. Except feasibility, we also made a little refinement compared with Approach by emphasize the dominant position of terminal operator during planning process by configure the berth occupancy level as maximum.

Local optimal plan: Same as the previous strategy, the planning process is also done via agent negotiation. A major improvement is that multiple negotiation rounds is allowed to produce a rotation plan with best turn around time. The idea is similar with the work [7] but the negotiation protocol is different. By means of multiple negotiation round, a plan with best turn around time is produced for each barge call.

Global optimal plan: The global optimality is the goal we pursuit in this work. The mediator based agent tool will facilitate the negotiation process and the proposed bi-level algorithm will guarantee the global optimality of generate plan.

In order to maintain the consistency of the experiment, the test case presented in Tables 3, 4 and 7 will be taken as input source for all strategies designed above. The result and discussion will be given in next section.

@&#DISCUSSION@&#


                           
                              
                                 •
                                 Global optimal VS No-information: Fig. 19
                                     depicted the gantt chart plan generated by global optimal strategy and no-information strategy. An observation is found that the performance of no-information is somehow as good as the global-optimal one. The plan generated by no-information strictly follows the original sailing plan and in some scenario it will yields good performance by chance. But this coincident result is not stand under different cases. Moreover, since no information exchange, the barge operator has no idea how long should he wait. Thus, there is a high probability that the barge will skip terminal when they found it has been blocked by some other activities when they arrived. This can be seen from figure “No-Infor” in Fig. 19 marked by the black eclipse where barge 2 could skip the call at terminal 5 since it is blocked. As a result the completeness and feasibility of no-information strategy cannot be ensured.

Global optimal VS feasible-plan: The feasible plan promises the barge can be served at given time window and all constrains are fulfilled. The gantt chart “Feasible” in Fig. 19 depicted a feasible plan where all barges are planned as tight as possible. Under such circumstance, the turn around time is extreme high. Another series problem raised to this plan is that its robustness is vulnerable because barge calls are planned too close to each other and there is no time for exception handling. Thus the performance and robustness of the feasible-plan cannot be ensured. If we take a closer look at the plan of global-optimal one, random slack time are added upon some activities and thus the robustness is improved.

Global optimal VS local-optimal: The local-optimal strategy aims at finding best rotation sequence to achieve minimum turn around time. Each barge looks for its own route selfishly without considering the terminal perspective. As shown in chart “Local optimal” of Fig. 19, the local-optimal strategy planned barge calls loosely distributed at terminal 5 compared with the one in global-optimal plan. Thus the performance is not globally optimal.

Given a set of barge call profiles and terminal service profile, plans that generated by different strategies yield different performances. Fig. 20
                            presents a general overview regards follower concern (turn around time) and leader concern (terminal tightness condition). A short turn around time is obtained by a high tightness condition where a low tightness condition result in a long turn around time. Among all strategies our proposed approach is capable of providing a non-dominant solution which is also known as Pareto optimal [46].

In this paper, the main issue exists in the HBT process is studied and a bi-level model and mediator-based agent framework is presented for integrated planning. Approaches are split into two perspectives. Form OR perspective, self-interested nature makes coordination hard to obtain. A leader–follower model is constructed and a hierarchical algorithm is proposed to resolve the problem. The ultimate goal is to search non-dominant strategies such that the obtained solution is subject to global optimal. From IT perspective, a mediator-based agent system is proposed and implemented to carry out information sharing, communication and decision making tasks. The given system posses advantages over other methods from the aspects of privacy, flexibility and efficiency.

A case study is used to demonstrate the performance of proposed approach. It illustrates how the mediator based MAS manages the trade-off between turn around time and terminal berth capacity utilization. Different strategies have also been used to compare with our approach, and the result reveals that the developed solution is capable of providing Pareto optimal result which outperform other approaches in terms of global optimality.

Though the case and comparative study yield satisfied performance, barriers still exist from conceptual design to practical implementation from both technical and strategical perspective. Technically, the design of soft agent is a relatively effortless process compared to centralization method by given the fact that soft agent can be easily deployed on top of current terminal/barge ERP system without significant modifications. However, the coordination layer is not possible to reside on either part. Our suggestion is to deploy the coordination layer onto the cloud server. It could provide coordination to both terminal and barge party as a service which best matches the current trend in the IT system design [47]. It also possesses advantages include scalability, effective computation capability and high flexibility. Strategically, the designed coordination solution inherits the game theoretic concept where each game player (terminal and barge operator) would have lost its partial benefits in order to maintain the global optimally. Certain policies need to be established for guiding independent party to accept the proposed system. A viable suggestion is to have third party to perform the coordination tasks which could be port authority or government. Currently, lots of undergoing projects in the Port of Rotterdam (inland shipping, new terminal construction) are under a unified coordination either by port authority or administrations [48]. They are striving to achieve further financial promotions from a global point of view. To this end, we believe our designed system would have a significant position in the further hinterland transport planning.

Except the vertical coordination among barge and terminal, interest between terminal and terminal, barge and barge are also different which lead to a multi leaders and multi followers structure where horizontal coordination is required. In addition, other parties include port authority and customer could also play a role in the planning process which is worth to take into consideration. From OR view, the future work will focus on extending the current model to cope with more interest conflicting and harmonize interests for addition stakeholders. From IT perspective, the current developed system can be categorized as a pre-planning system. It should be the initial phase towards efficient HBT operation. A coming phase will focus on adding real-time handling mechanism into the soft agent to handle exceptions during operation. Namely, it enables system make reactions when the generated plan cannot be proceeded due to unexpected events occurrence. Advanced technologies include Internet of things and cloud computing would play a role subsequently.

@&#ACKNOWLEDGMENT@&#

This research is supported by the China Scholarship Council under Grant 201307720072.

@&#REFERENCES@&#

