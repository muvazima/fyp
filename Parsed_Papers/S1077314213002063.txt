@&#MAIN-TITLE@&#Facial expression recognition based on anatomy

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           A set of anatomy based features are proposed for facial expression recognition.


                        
                        
                           
                           We decompose a facial action into a unique set of muscle activity scores.


                        
                        
                           
                           We tested these features on CK+ database through three classifiers.


                        
                        
                           
                           Our results are close to human performance in expression recognition.


                        
                        
                           
                           Muscle-based features allow exploration of unknown mechanisms of expressions.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Facial anatomy

Muscle force

Features

Facial action coding system

@&#ABSTRACT@&#


               
               
                  In this study, we propose a novel approach to facial expression recognition that capitalizes on the anatomical structure of the human face. We model human face with a high-polygon wireframe model that embeds all major muscles. Influence regions of facial muscles are estimated through a semi-automatic customization process. These regions are projected to the image plane to determine feature points. Relative displacement of each feature point between two image frames is treated as an evidence of muscular activity. Feature point displacements are projected back to the 3D space to estimate the new coordinates of the wireframe vertices. Muscular activities that would produce the estimated deformation are solved through a least squares algorithm. We demonstrate the representative power of muscle force based features on three classifiers; NB, SVM and Adaboost. Ability to extract muscle forces that compose a facial expression will enable detection of subtle expressions, replicating an expression on animated characters and exploration of psychologically unknown mechanisms of facial expressions.
               
            

@&#INTRODUCTION@&#

Emotions are often conveyed through the gestures of face and body rather than verbal communication. A pronounced feeling may be countered by a facial expression, emphasizing the feeling conveyed by the expression through sarcasm. Mehrabian [1] points out an irrefutable example; it is possible to verbally express hatred and pass on exactly the opposite feeling. In his later works he goes one step further and claims that the feeling or attitude conveyed by a speaker is 55% facial, 38% vocal and only 7% verbal [2].

Many forms of non-verbal behavior such as physical contact, distance from the listener and posture influence the message to be conveyed. Nevertheless, it is true that we mostly stare on the face of a speaker to infer the exact feeling in uttered words. In perception, visual component frequently dominates the auditory component even when the auditory information is clear; sometimes changing what we believe to hear. An intriguing illustration of this phenomenon is the McGurk effect [3]. It has been demonstrated that what is heard by the audience on a spoken syllable can be influenced by the displayed video of speech. In McGurk’s experiment the visual stimulus is so overwhelming that subjects believe to hear what they see.

As technology replaced human professionals with machines and established new channels of communication between humans, we were forced to abandon naturally evolved means of conveying our emotions, i.e. non-verbal communication. The lack of non-verbal communication degrades the performance of many implementations such as intelligent tutoring systems. It has been demonstrated that increased number of modalities in computer–human communication has a positive impact on learners’ perception of the learning experience [4].

Social intelligence in computing, i.e. ability to interpret a human user’s social signals and behaviors, is an emerging field that has many uses [5,6]. Identification of states of interest, boredom, confusion and stress can lead to new leaps in the field of human–computer interaction. Detection of fatigue or inattention has important implications for human operators who handle critical assignments. It has been reported that 80% of the crashes are related to driver inattention [7]. In recent studies up to 95% accuracy is reported in detecting driver drowsiness based mostly on facial behavior [8,9].

Current research on facial expression analysis revolves around recognition of six globally common facial expressions by use of geometric and appearance based features. These basic expressions are happiness, sadness, surprise, fear, anger and disgust, as defined by Ekman in 1976 [10]. Appearance based methods process the texture of the face, reducing its complexity and making it suitable for comparison with templates. Choosing the right preprocessing methods and the extent of dimensionality reduction is critical in appearance based methods.

Geometric features are derived from distinctive regions of the face, such as eyes, nostrils and mouth. The chosen set of feature points can be tracked, and classified with neural networks (NNs) [11], hidden Markov models (HMMs) [12], AdaBoost [13] along with many other classification algorithms. Choosing the right set of geometric features for description of facial expressions remains an open question. It is unfeasible to simply choose all pixels on a face image due to high dimensionality of data and limited number of examples. On the other hand, we need to choose a minimal set of base functions that would span all possible facial expressions. Facial action coding system (FACS) provides a good and intuitive set of such features called action units (AUs) [14].

Action units are derived by human experts based on experiments in psychology. Studies that use FACS approach have reported classification accuracies that range from 70% to 95% on six basic facial expressions [15–17]. The best performances achieved so far are well above the recognition ceiling of humans, which is estimated to be in the range 87.0% [18] to 91.7% [10].

These figures are very promising, but most algorithms fail to perform as successfully on novel examples, such as expressions of unseen subjects. For that reason facial expression recognition is still not a solved problem in a real world scenario, except for simple expressions such as smile. In this paper, we are investigating possible setbacks in current approach to facial expression recognition and propose a new set of features that have one to one correspondence to facial anatomy.

We start our discussion in Section 2 with current research on facial expression recognition, emphasizing major hurdles in this field. In Section 3 we will elucidate the inherent limitations of FACS based approaches, addressing how we propose to eliminate these limitations. Section 4 will introduce a set of novel features for facial expression detection. We will report our results in Section 5 and conclude this report in Section 6.

The process of facial expression recognition commonly commences with detection of the face region in an input image. When the input is a video, the face or features detected in the first frame are tracked throughout the rest of the frames. Detection of faces is considered a solved problem for less cluttered scenes, by use of wavelet coefficient histograms and their positions [19], NNs [20] and rectangle features with Adaboost [21].

It is unfeasible to classify expressions through pixel-wise comparison between detected face images due to the dimensionality of data and limited number of examples. In order to reduce the complexity of classification, feature detection or extraction becomes a necessity. An intuitive method to identify features is to locate distinctive regions on the face image such as brows, eye corners, nostrils, and lip corners. These regions can be detected using specialized feature detectors [22,23]. Gabor filters are frequently used to detect edges in varying scales and orientations [24,25]. Face alignment and registration methods offer global solutions to feature detection problem [26–31]. Although face detectors are remarkably successful, detection of facial features is still an open problem.

When the input to the expression recognition system is a video, it is possible to make use of the temporal dynamics of features by tracking them. Tracking can be done relying upon the similarity of texture in susequent frames [32–34].

The primary focus of facial expression recognition systems is to classify the displacement of features in the progress of video or their deviation from a defined template of neutral face. SVMs [35,36] have shown to be effective for modeling the non-Gaussian distribution of classes. Michel and Kaliouby [37] utilized displacements of 22 feature points to train a SVM classifier and achieved 72% accuracy in person independent classification. Littlewort et al. [13] used Adaboost to select a subset of Gabor filters, trained SVM on this subset and classifed FACS AUs.

Model based approaches offer an alternative by defining a parametric deformable model of the human face. Active Shape Model (ASM) [38] is a statistical method that derives the variation modes of a shape through a set of training examples. Transformation and shape parameters are estimated iteratively to fit the mean shape to the observed object. Active Appearance Model (AAM) [39,40] integrates texture in the derived statistical model. The parameterized model is projected onto the face image and iteratively modified for a better fit. It was shown that the training stage can be sped up using spherical representation of 3D feature vectors and rotation invariant kernels [41]. Matthews and Baker [42] proposed a computationally efficient algorithm with high convergence rate to improve the fitting performance. AAM algorithm can also be applied on video for improved accuracy [43].

Model based trackers make use of prior information on the face, by integrating its shape, orientation and features in a holistic face model. One of the earliest facial expression recognition studies using ASM was carried out by Lanitis et al. [44]. Researchers reported 74% accuracy over six basic emotions and neutral expression on a dataset of 118 test images. Ahlberg [45], and Dornaika and Davoine [46] demonstrated tracking of head orientation and facial features through AAM. Sung et al. [47] combined AAM with cylinder head models for an initial estimation of global motion parameters, achieving significantly improved tracking rates. Huang et al. [48] incorporated temporal filters in AAM to cover large pose deviations and fast motion in face tracking. Cheon and Kim [49] utilized differential AAM features and manifold learning to categorize six basic emotions and reported 86.5% recognition performance.

Shape, appearance and model-based features can be exploited to extract metadata that is more expressive of facial expressions. FACS takes extraction of metadata one step further with 46 predefined action bases for expressions. Although it was not originally intended for automated classification of expressions, FACS provides one of the most frequently used sets of features in the literature [50–54].

FACS AUs have been shown to be features with high discrimination power in a multitude of studies. Sebe et al. [17] defined motion units that are similar to AUs but continuous in nature. They achieved 93.0% accuracy in classification of six basic expressions and neutral on the Cohn–Kanade (CK) [55] dataset. Kotsia et al. [56] chose 17 action units, achieving up to 92.3% accuracy on the same set of expressions and dataset. Lucey et al. [16] reported up to 83.3% accuracy in classification of seven emotions (including contempt) on the extended Cohn–Kanade (CK+) [16] dataset.

In this paper we report a hybrid 2D appearance and 3D model based approach for extracting facial muscle forces, which are proposed as novel features. We use a computationally efficient, non-iterative method to customize a generic face model to the face image on the first frame of the video. Vertices on the customized face model that fall in a muscular region of influence are projected onto the face image. These projections are initialized as feature points that are to be tracked based on appearance in the subsequent video frames. Coordinates of the tracked feature points on the image plane are projected back onto the customized model to estimate 3D deformations due to facial expressions. We model the skin as a system of springs and solve muscle forces in a linear, over-determined system of equations.

@&#MOTIVATION@&#

FACS defines 46 AUs based on psychological studies of expressions. Each AU is defined with the motivation to represent a head, eye or face activity that is empirically known to relate to an emotion. The majority of facial muscle actions are covered by FACS, with 9 AUs in the upper face, 18 AUs in the lower face and 5 unclassified AUs. Since the basis of FACS coding is humans’ perception of emotions and not the anatomical structure of the face, an AU may refer to the action of a unique muscle or the compound visual effect of a set of muscles. Presence of AUs that correspond to compound effect of muscles renders identification and scoring of an action an intricate task, either by experts or by computers. It is known that achieving minimal competency in FACS requires around 300 hours of training, and a FACS expert can score one minute of a video in approximately two hours [57].

The intricacy of FACS AUs present themselves in various aspects of automated recognition of facial expressions. We will enumerate these hindrances in the following paragraphs.

FACS defines a non-continuous and non-uniform scale for intensity scoring of facial activities. As illustrated in Fig. 1
                        , larger activity ranges fall into intensity scores of C and D. Due to this scheme of scoring, valuable information for discrimination of subtle expression changes can be lost.

It has been more or less straightforward to work around this limitation by defining a continuous scale of activities in implementation. Most studies in the literature define AUs in the range 
                           
                              [
                              0
                              ,
                              1
                              ]
                           
                         where the boundaries stand for no evidence and maximum intensity, respectively.

Most spontaneous expressions are produced by a compound effect of AUs. Investigation of facial expressions revealed more than 7,000 possible combinations of AUs [58]. It has been asserted by Tian et al. [59] that the compound effect of AUs can be non-additive, changing the individual appearances of constituent AUs. As shown in Fig. 2
                        , the compound effect of AU1 and AU4 is an emphasis of inner brow raise, passing through the emotions of sadness or fear. The compound effect of AUs 1, 2 and 4 is accentuated brow raise and may correspond to the emotion of anxiety. Once AUs are compounded, it is extremely difficult to decompose an expression back to AUs unless a large rule base is made available.

Decomposition of an observation to individual action units is not only hard, but also may not be unique. Consider the expression represented with AU 1+2 in Fig. 2. The influence of AU1 on the compound expression is almost unnoticeable, nevertheless the inner Frontalis muscle is active. Many different combinations of muscle activities may result in the same vectoral displacement of specific feature points, identified as the activity of the same AUs. This is particularly valid for mouth corners, which are the insertion points of multiple muscles.

In other words, observed displacements of a very limited set of feature points do not necessarily imply a unique set of AUs. In recognizing an expression it is important to identify the muscles that actively produce the observed expression, omitting those that move idly with the skin.

In this paper, we propose to identify the activation levels of facial muscles in the progress of an expression by observing the displacements of multiple feature points that are distributed over a region. Obviously the actual forces applied by the facial muscles are not observable unless electrical activity sensors such as electromyograph (EMG) are utilized. However, it is possible to derive them given an accurate model of the face, the physical properties of skin and muscles, and the observed displacements of carefully selected feature points.

There are approximately 46 identified muscles beneath the skin of a human face. Muscles are fiber structures that can only contract, producing pulling forces on the attached skin. The attachment of a muscle to the skin is not a single spot but a region. This is the region of influence, where the muscular force is distributed in varying intensities.

Although human faces vary drastically between individuals and races, the anatomy of the human face defines a topology of muscles that are exactly the same for all humans. Given a set of facial landmarks such as eye and lip corners, it is possible to estimate quite accurately the muscular layout beneath the skin. The layout of the facial muscles provides us an estimate of distribution of forces on the skin for each muscle.

Displacement of each point on the skin provides us an evidence for activation levels of muscles that influence that region. We propose to model the dependency between force and displacement as a linear system, for which we can obtain an over-determined linear system of equations. We can solve this system using convex optimization methods and determine the activation levels of muscles.

Defining facial expressions with the activities of underlying facial muscles solves all 3 limitations of FACS approaches: (1) The activation level of each muscle is determined on a continuous scale and its accuracy would increase with the number of feature points that are precisely tracked. (2) By carefully dispersing sufficient number of feature points on the face surface, we can identify the activation levels of all constituent muscles, regardless of the number of muscles that are active. (3) Most importantly, using the knowledge of muscle activities as a behavioral measure, we can explore new mechanisms of emotions, which would have tremendous implications for behavioral science research.

We propose a set of new features that represent the activation levels of facial muscles. The input to our feature extraction system is a facial expression video with marked facial landmarks on the first frame (Fig. 3
                     ). We assume that the face is neutral and oriented towards the camera in the first frame of the video. This frame is used for semi-automatic customization of an anatomically accurate and generic wireframe model on the subject. The output of the proposed system is a set of activation levels for each facial muscle. In this section we will elucidate each stage of this feature extraction system, starting with the generic wireframe model used in our experiments.

We estimate the activation levels of facial muscles through observation and prior knowledge in facial anatomy. As such, availability of a high resolution and anatomically accurate wireframe model is critical for our task. A well known wireframe model, Candide, contains 75 vertices and 100 triangular surfaces [60]. Modified versions of this model [61] and multi-layered models [62] were proposed in the literature. Sifakis et al. [63] built a highly detailed face model that embeds 32 muscles, 30 thousand triangular faces in the skull layer and 850 thousand tetrahedra in the skin layer. This model was built using MRI scans for analysis and synthesis of facial expressions.

We chose a moderately detailed wireframe model for our experiments. Our model, HIgh polygon GEneric face Model (HIGEM), consists of 612 vertices and 1128 faces [64]. It also defines 18 major muscles of the human face through attachment (on the skull) and insertion (on the skin) vertices. These points enable us to place muscles and determine the directions of muscle forces for a subject, once the wireframe model is customized. The structure of muscles on HIGEM is illustrated in Fig. 4
                        .

Based on Waters’ research on 3 dimensional animation of facial expressions [65], we define our muscles as linear springs with distributed forces in their regions of influence. A fiber muscle can be described with vector 
                           
                              
                                 
                                    OI
                                 
                                 
                                    →
                                 
                              
                           
                         as shown in Fig. 5
                        . Contraction of a muscle affects all vertices of the wireframe model that fall in this conic region.

In Fig. 5, V is any wireframe vertex, 
                           
                              β
                           
                         is the angle of deviation from the muscle fiber, 
                           
                              ϕ
                           
                         is the angular limit for region of influence. The force exerted by the muscle on wireframe vertices is faded as the angle of deviation 
                           
                              β
                           
                         approaches angular limit 
                           
                              ϕ
                           
                        . On the radial axis, the muscle force increases until the insertion point 
                           
                              I
                           
                         and fades back to zero in the outer band of the region.

We define two fading coefficients for the muscular force; angular fading that is based on the angle of deviation and radial fading that is based on the length of 
                           
                              
                                 
                                    OI
                                 
                                 
                                    →
                                 
                              
                           
                         vector. Angular fading coefficient 
                           
                              
                                 
                                    δ
                                 
                                 
                                    A
                                 
                              
                           
                         is computed with;
                           
                              (1)
                              
                                 
                                    
                                       
                                          
                                             cos
                                             β
                                             =
                                             
                                                
                                                   OI
                                                
                                                
                                                   →
                                                
                                             
                                             ·
                                             
                                                
                                                   OV
                                                
                                                
                                                   →
                                                
                                             
                                             /
                                             (
                                             |
                                             |
                                             
                                                
                                                   OI
                                                
                                                
                                                   →
                                                
                                             
                                             |
                                             |
                                             ×
                                             |
                                             |
                                             
                                                
                                                   OV
                                                
                                                
                                                   →
                                                
                                             
                                             |
                                             |
                                             )
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   δ
                                                
                                                
                                                   A
                                                
                                             
                                             =
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     cos
                                                                     β
                                                                     -
                                                                     cos
                                                                     ϕ
                                                                  
                                                                  
                                                                     1
                                                                     -
                                                                     cos
                                                                     ϕ
                                                                  
                                                               
                                                            
                                                            
                                                               if
                                                               
                                                               cos
                                                               β
                                                               ⩾
                                                               cos
                                                               ϕ
                                                            
                                                         
                                                         
                                                            
                                                               0
                                                            
                                                            
                                                               otherwise
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Denoting the fiber length 
                           
                              |
                              |
                              
                                 
                                    OI
                                 
                                 
                                    →
                                 
                              
                              |
                              |
                           
                         and maximum radial distance of influence 
                           
                              |
                              |
                              
                                 
                                    OE
                                 
                                 
                                    →
                                 
                              
                              |
                              |
                           
                         with r and 
                           
                              
                                 
                                    r
                                 
                                 
                                    max
                                 
                              
                           
                         respectively, we define radial fading coefficient 
                           
                              
                                 
                                    δ
                                 
                                 
                                    R
                                 
                              
                           
                         as;
                           
                              (2)
                              
                                 
                                    
                                       δ
                                    
                                    
                                       R
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   cos
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  r
                                                                  -
                                                                  |
                                                                  |
                                                                  
                                                                     
                                                                        OV
                                                                     
                                                                     
                                                                        →
                                                                     
                                                                  
                                                                  |
                                                                  |
                                                               
                                                               
                                                                  r
                                                               
                                                            
                                                            
                                                               
                                                                  π
                                                               
                                                               
                                                                  2
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   if
                                                   
                                                   |
                                                   |
                                                   
                                                      
                                                         OV
                                                      
                                                      
                                                         →
                                                      
                                                   
                                                   |
                                                   |
                                                   ⩽
                                                   r
                                                
                                             
                                             
                                                
                                                   cos
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  |
                                                                  |
                                                                  
                                                                     
                                                                        OV
                                                                     
                                                                     
                                                                        →
                                                                     
                                                                  
                                                                  |
                                                                  |
                                                                  -
                                                                  r
                                                               
                                                               
                                                                  
                                                                     
                                                                        r
                                                                     
                                                                     
                                                                        max
                                                                     
                                                                  
                                                                  -
                                                                  r
                                                               
                                                            
                                                            
                                                               
                                                                  π
                                                               
                                                               
                                                                  2
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   if
                                                   
                                                   r
                                                   <
                                                   |
                                                   |
                                                   
                                                      
                                                         OV
                                                      
                                                      
                                                         →
                                                      
                                                   
                                                   |
                                                   |
                                                   ⩽
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         max
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   0
                                                
                                                
                                                   otherwise
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

The overall fading in the region of influence is the product of angular and radial fading coefficients;
                           
                              (3)
                              
                                 δ
                                 =
                                 
                                    
                                       δ
                                    
                                    
                                       A
                                    
                                 
                                 ·
                                 
                                    
                                       δ
                                    
                                    
                                       R
                                    
                                 
                              
                           
                        
                     

This model distributes muscle forces conforming with the physical reality of spreading muscle fibers beneath a region of influence. A sample distribution of force for the Procerus muscle is illustrated in Fig. 6
                        . The sizes of the red dots represent the magnitude of forces exerted by the muscle. Muscle forces are always directed towards vertex 
                           
                              O
                           
                        , where the muscle attaches to the skull.

We consolidate the effects of muscles on wireframe vertices in matrix 
                           
                              A
                           
                        , which serves as our muscle map. This is a 
                           
                              3
                              n
                              ×
                              m
                           
                         matrix where n is the number of vertices and m is the number of muscles. The first three rows of matrix 
                           
                              A
                           
                         stand for the components of unit force of each muscle on the first vertex in 
                           
                              x
                              ,
                              
                              y
                           
                         and z axes. The product of 
                           
                              A
                           
                         with the 
                           
                              m
                              ×
                              1
                           
                         vector of muscle force magnitudes gives us 
                           
                              3
                              n
                              ×
                              1
                           
                         vector of muscle forces on each vertex in each axis.

Our feature extraction method commences with customization of the generic wireframe model (HIGEM) to a subject’s face. We use the nearest neighbor weighted average customization (NNWA) in this stage, which is computationally efficient for customization of high-polygon models and sufficiently accurate for our purposes [64]. This procedure is done once for a subject and only on the first frame of the video. We will briefly introduce the NNWA method in the following paragraphs.

HIGEM includes 32 landmark vertices that delineate the shape of subject’s face. This set of landmarks were empirically identified for more accurate customization. We manually mark the corresponding facial landmarks on the first frame of the video. We will use these correspondences for alignment, scaling and morphing of the HIGEM model.

We map the facial landmarks on 2D image plane to 3D coordinate system of the generic face model by inverse perspective projection, which is the first stage of well known ray tracing algorithm (Fig. 7
                        ). Perspective projection from the 3D coordinate system to 2D camera plane is defined with;
                           
                              (4)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                
                                                   x
                                                
                                                
                                                   p
                                                
                                             
                                             =
                                             x
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  z
                                                               
                                                               
                                                                  prp
                                                               
                                                            
                                                            -
                                                            
                                                               
                                                                  z
                                                               
                                                               
                                                                  vp
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  z
                                                               
                                                               
                                                                  prp
                                                               
                                                            
                                                            -
                                                            z
                                                         
                                                      
                                                   
                                                
                                             
                                             +
                                             
                                                
                                                   x
                                                
                                                
                                                   prp
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  z
                                                               
                                                               
                                                                  vp
                                                               
                                                            
                                                            -
                                                            z
                                                         
                                                         
                                                            
                                                               
                                                                  z
                                                               
                                                               
                                                                  prp
                                                               
                                                            
                                                            -
                                                            z
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                                
                                                   y
                                                
                                                
                                                   p
                                                
                                             
                                             =
                                             y
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  z
                                                               
                                                               
                                                                  prp
                                                               
                                                            
                                                            -
                                                            
                                                               
                                                                  z
                                                               
                                                               
                                                                  vp
                                                               
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  z
                                                               
                                                               
                                                                  prp
                                                               
                                                            
                                                            -
                                                            z
                                                         
                                                      
                                                   
                                                
                                             
                                             +
                                             
                                                
                                                   y
                                                
                                                
                                                   prp
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  z
                                                               
                                                               
                                                                  vp
                                                               
                                                            
                                                            -
                                                            z
                                                         
                                                         
                                                            
                                                               
                                                                  z
                                                               
                                                               
                                                                  prp
                                                               
                                                            
                                                            -
                                                            z
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

In these equations, 
                           
                              
                                 
                                    z
                                 
                                 
                                    vp
                                 
                              
                           
                         is the z-coordinate of the view (camera) plane and 
                           
                              (
                              
                                 
                                    x
                                 
                                 
                                    prp
                                 
                              
                              ,
                              
                                 
                                    y
                                 
                                 
                                    prp
                                 
                              
                              ,
                              
                                 
                                    z
                                 
                                 
                                    prp
                                 
                              
                              )
                           
                         point stand for the projection reference point. We can simplify this equation by choosing the projection reference point on z axis 
                           
                              (
                              
                                 
                                    x
                                 
                                 
                                    prp
                                 
                              
                              =
                              
                                 
                                    y
                                 
                                 
                                    prp
                                 
                              
                              =
                              0
                              )
                           
                        ;
                           
                              (5)
                              
                                 
                                    
                                       f
                                    
                                    
                                       p
                                    
                                 
                                 (
                                 x
                                 ,
                                 y
                                 ,
                                 z
                                 )
                                 =
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       p
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       p
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   x
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        z
                                                                     
                                                                     
                                                                        prp
                                                                     
                                                                  
                                                                  -
                                                                  
                                                                     
                                                                        z
                                                                     
                                                                     
                                                                        vp
                                                                     
                                                                  
                                                               
                                                               
                                                                  
                                                                     
                                                                        z
                                                                     
                                                                     
                                                                        prp
                                                                     
                                                                  
                                                                  -
                                                                  z
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   ,
                                                   
                                                   y
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        z
                                                                     
                                                                     
                                                                        prp
                                                                     
                                                                  
                                                                  -
                                                                  
                                                                     
                                                                        z
                                                                     
                                                                     
                                                                        vp
                                                                     
                                                                  
                                                               
                                                               
                                                                  
                                                                     
                                                                        z
                                                                     
                                                                     
                                                                        prp
                                                                     
                                                                  
                                                                  -
                                                                  z
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Any vertex on the wireframe model must be on the ray that emanates from the projection reference point and passes through the facial landmark on the camera view plane, as illustrated in Fig. 7. If the depth of the vertex z is known and fixed, we can invert Eq. 5 to find its exact location in 3 dimensional coordinate system;
                           
                              (6)
                              
                                 
                                    
                                       f
                                    
                                    
                                       p
                                    
                                    
                                       -
                                       1
                                    
                                 
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       p
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       p
                                    
                                 
                                 ,
                                 z
                                 )
                                 =
                                 (
                                 x
                                 ,
                                 y
                                 ,
                                 z
                                 )
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         p
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        z
                                                                     
                                                                     
                                                                        prp
                                                                     
                                                                  
                                                                  -
                                                                  z
                                                               
                                                               
                                                                  
                                                                     
                                                                        z
                                                                     
                                                                     
                                                                        prp
                                                                     
                                                                  
                                                                  -
                                                                  
                                                                     
                                                                        z
                                                                     
                                                                     
                                                                        vp
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         y
                                                      
                                                      
                                                         p
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     
                                                                        z
                                                                     
                                                                     
                                                                        prp
                                                                     
                                                                  
                                                                  -
                                                                  z
                                                               
                                                               
                                                                  
                                                                     
                                                                        z
                                                                     
                                                                     
                                                                        prp
                                                                     
                                                                  
                                                                  -
                                                                  
                                                                     
                                                                        z
                                                                     
                                                                     
                                                                        vp
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   z
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

The semi-automatic customization algorithm is depicted in Fig. 8
                        . Customization process starts with alignment and scaling of the wireframe model. Alignment is carried out by translating the generic wireframe in 3D coordinates so that the projection of the center of gravity of the model landmarks collides with that of target image.

The model is scaled in 
                           
                              x
                              ,
                              
                              y
                           
                         and z axes separately. Scales in x and y axes are calculated with the ratio of range of projected vertices and observed facial landmarks. Scale factor for the depth of the head is assumed to be 1.15 times the scaling factor of the width of the head. This ratio was empirically found and reported by Luximon et al. [66].

Next, the landmark vertices of the wireframe model are translated so that their projections coincide with facial landmarks (Eq. (6)). The remaining 576 non-landmark vertices are translated with a weighted sum of vectorial displacement of neighboring landmark vertices, inversely weighted by their 3D distances to the vertex under consideration.

Given a model that has been customized for a subject, we can identify its vertices that are in the region of influence of at least one muscle using Eq. (3). We obtain feature points by projecting these vertices onto the image plane, as illustrated in Fig. 9
                        . These features will be tracked and their displacements will be used both to estimate the rigid body motion of the subject’s head and the relative motion of skin points due to a facial expression. We track feature points on the image plane using the optical flow algorithm proposed by Lucas and Kanade [32].

Drifting of feature points is a major source of error both for estimating the rigid body motion of the head and deformations based on expressions. In an uncontrolled drift, the topology of feature point and its neighbors will be altered. Fig. 10
                         depicts drifting of feature 
                           
                              
                                 
                                    p
                                 
                                 
                                    0
                                 
                              
                           
                         at time 
                           
                              
                                 
                                    t
                                 
                                 
                                    k
                                 
                              
                           
                        . Note that any feature point is a projection of its corresponding wireframe vertex and without folding the 2D topology on the right is not permissible.

To identify the drifting feature points, we record the directions of cross-products on triangles formed by the feature point with its neighbors. The two vectors to identify this point as a drifting feature are 
                           
                              
                                 
                                    
                                       
                                          v
                                       
                                       
                                          →
                                       
                                    
                                 
                                 
                                    0
                                    ,
                                    1
                                 
                              
                           
                         and 
                           
                              
                                 
                                    
                                       
                                          v
                                       
                                       
                                          →
                                       
                                    
                                 
                                 
                                    1
                                    ,
                                    2
                                 
                              
                           
                        . We compute cross-products in each frame, after tracking of feature points;
                           
                              (7)
                              
                                 
                                    
                                       
                                          
                                             c
                                          
                                          
                                             →
                                          
                                       
                                    
                                    
                                       1
                                       ,
                                       2
                                    
                                    
                                       
                                       
                                          
                                             t
                                          
                                          
                                             k
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             v
                                          
                                          
                                             →
                                          
                                       
                                    
                                    
                                       0
                                       ,
                                       1
                                    
                                    
                                       
                                       
                                          
                                             t
                                          
                                          
                                             k
                                          
                                       
                                    
                                 
                                 ×
                                 
                                    
                                       
                                          
                                             v
                                          
                                          
                                             →
                                          
                                       
                                    
                                    
                                       1
                                       ,
                                       2
                                    
                                    
                                       
                                       
                                          
                                             t
                                          
                                          
                                             k
                                          
                                       
                                    
                                 
                              
                           
                        
                     

This calculation is repeated for all faces the vertex resides on. We identify inversion of the direction of a cross-product as a state (topology) change. All feature points that undergo a state change are marked as untrusted. Our experiments on the CK+ dataset reveal that 
                           
                              10.3
                              ±
                              4.6
                           
                         feature points become untrusted in one expression sequence. Depending on the customization of the wireframe model, 
                           
                              169.6
                              ±
                              6.1
                           
                         feature points are under the influence of at least one muscle and are being tracked. The remaining (trusted) feature points and their corresponding wireframe vertices are used for estimating the orientation of the head.

Precise alignment of the face model with the observed face image is mandatory for estimation of relative displacements of vertices. Orientation of the subject’s head is determined by greedy search on trusted feature points and their corresponding vertices in 6 degrees of freedom, as depicted in Fig. 11
                        . A similar greedy search algorithm for finding the head orientation was implemented by Dornaika and Ahlberg [67].

The 3 dimensional rigid body motion of the subject’s head is defined by rotations (
                           
                              θ
                           
                        ) and translations (T) on 
                           
                              x
                              ,
                              y
                           
                         and z axis;
                           
                              (8)
                              
                                 b
                                 =
                                 [
                                 
                                    
                                       θ
                                    
                                    
                                       x
                                    
                                 
                                 
                                    
                                       θ
                                    
                                    
                                       y
                                    
                                 
                                 
                                    
                                       θ
                                    
                                    
                                       z
                                    
                                 
                                 
                                    
                                       T
                                    
                                    
                                       x
                                    
                                 
                                 
                                    
                                       T
                                    
                                    
                                       y
                                    
                                 
                                 
                                    
                                       T
                                    
                                    
                                       z
                                    
                                 
                                 ]
                              
                           
                        
                     

Our search algorithm iteratively seeks for a suitable transformation in each degree of freedom in positive and negative directions. An iteration ends with applying on the model the transformation that produces maximum reduction in error. Iterations will end if the error reduction for each degree of freedom is less than a predefined threshold. We define error as the sum squared distance between the projected vertices and tracked feature points. The pseudocode of greedy search is presented in Algorithm 4.1.

This algorithm successfully tracked the head motion in all image sequences in the CK+ dataset. It is unreliable however, when the motion of the subject is normal to the image plane. Note that in this case the same set of error minimizing projections can be obtained by displacement in z axis or rotations around the axes of the image plane (pitch and yaw).
                           Algorithm 4.1
                           
                              RigidMotion (V, P) 
                              
                                 
                                    
                                 
                              
                           

Greedy search aligns the face model with the observed face on the image plane. Note that the projections of the wireframe vertices still would not precisely overlap with the image feature points. The major causes of these deviations are (1) inaccuracies in the estimation of head orientation, (2) drifting feature points (untrusted features) and (3) deformations or relative motion of facial feature points due to facial expressions.

Our greedy search algorithm works successfully for small displacements and rotations of the head (Section 4.4). We identified the drifting feature points and labeled them as untrusted (Section 4.3). The deviations between the trusted tracking points and the projections of corresponding vertices serve as indicators of facial expressions. We once again turn to ray tracing to extract the 3D displacements of vertices due to facial expressions.


                        Fig. 12
                         depicts a landmark vertex 
                           
                              
                                 
                                    x
                                 
                                 
                                    0
                                 
                              
                           
                         and its neighbors on the wireframe model. Assuming that the surfaces are small enough so that they do not bulge or wrinkle, this vertex hypothetically moves on one of the faces it resides on. In this illustration, 
                           
                              
                                 
                                    x
                                 
                                 
                                    0
                                 
                              
                           
                         moves on the surface defined by 
                           
                              
                                 
                                    x
                                 
                                 
                                    0
                                 
                              
                              ,
                              
                              
                                 
                                    x
                                 
                                 
                                    1
                                 
                              
                           
                         and 
                           
                              
                                 
                                    x
                                 
                                 
                                    2
                                 
                              
                           
                        .

Note that unlike model customization, it is not possible to assume fixed depth for vertices in this stage. However, if we can identify the plane of motion for the vertex, we can estimate its new coordinates through a line-plane intersection. The plane of motion can be any of the faces the vertex resides on. We find the intersection of the ray with each of these planes. The intersection point 
                           
                              
                                 
                                    x
                                 
                                 
                                    0
                                 
                              
                              ′
                           
                         may be found within or outside the boundaries of a triangular face as depicted in Fig. 13
                        .

We determine three normal vectors for each face;
                           
                              (9)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         n
                                                      
                                                      
                                                         →
                                                      
                                                   
                                                
                                                
                                                   1
                                                
                                             
                                             =
                                             
                                                
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                
                                                
                                                   →
                                                
                                             
                                             ×
                                             
                                                
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                   ′
                                                
                                                
                                                   →
                                                
                                             
                                             /
                                             |
                                             |
                                             
                                                
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                
                                                
                                                   →
                                                
                                             
                                             ×
                                             
                                                
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                   ′
                                                
                                                
                                                   →
                                                
                                             
                                             |
                                             |
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         n
                                                      
                                                      
                                                         →
                                                      
                                                   
                                                
                                                
                                                   2
                                                
                                             
                                             =
                                             
                                                
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                   ′
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                
                                                
                                                   →
                                                
                                             
                                             ×
                                             
                                                
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                                
                                                   →
                                                
                                             
                                             /
                                             |
                                             |
                                             
                                                
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                   ′
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                
                                                
                                                   →
                                                
                                             
                                             ×
                                             
                                                
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                                
                                                   →
                                                
                                             
                                             |
                                             |
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         n
                                                      
                                                      
                                                         →
                                                      
                                                   
                                                
                                                
                                                   3
                                                
                                             
                                             =
                                             
                                                
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                
                                                
                                                   →
                                                
                                             
                                             ×
                                             
                                                
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                                
                                                   →
                                                
                                             
                                             /
                                             |
                                             |
                                             
                                                
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                
                                                
                                                   →
                                                
                                             
                                             ×
                                             
                                                
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                                
                                                   →
                                                
                                             
                                             |
                                             |
                                          
                                       
                                    
                                 
                              
                           
                        where 
                           
                              
                                 
                                    x
                                 
                                 
                                    0
                                 
                              
                              ,
                              
                              
                                 
                                    x
                                 
                                 
                                    1
                                 
                              
                           
                         and 
                           
                              
                                 
                                    x
                                 
                                 
                                    2
                                 
                              
                           
                         are the vertex and its neighbors on the aligned wireframe model. The intersection point 
                           
                              
                                 
                                    x
                                 
                                 
                                    0
                                 
                              
                              ′
                           
                         is the back projection of the tracked feature point which was found through line plane intersection. Note that for 
                           
                              
                                 
                                    x
                                 
                                 
                                    0
                                 
                              
                              ′
                           
                         to be in the region bounded by the face, normal vectors must point to the same direction;
                           
                              (10)
                              
                                 
                                    
                                       
                                          
                                             n
                                          
                                          
                                             →
                                          
                                       
                                    
                                    
                                       1
                                    
                                 
                                 ·
                                 
                                    
                                       
                                          
                                             n
                                          
                                          
                                             →
                                          
                                       
                                    
                                    
                                       3
                                    
                                 
                                 >
                                 1
                                 -
                                 ∊
                                 
                                 and
                                 
                                 
                                    
                                       
                                          
                                             n
                                          
                                          
                                             →
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                                 ·
                                 
                                    
                                       
                                          
                                             n
                                          
                                          
                                             →
                                          
                                       
                                    
                                    
                                       3
                                    
                                 
                                 >
                                 1
                                 -
                                 ∊
                              
                           
                        
                     

These two conditions enable us to identify the plane of motion and the new coordinates of the corresponding vertex for all trusted vertices. Note that these conditions do not restrict the vertex to move across the 
                           
                              
                                 
                                    
                                       
                                          x
                                       
                                       
                                          1
                                       
                                    
                                    
                                       
                                          x
                                       
                                       
                                          2
                                       
                                    
                                 
                                 
                                    →
                                 
                              
                           
                         edge. In fact, this vertex may be moving in the same same direction with its neighbors and it may cross this edge, which is defined by vertices on the aligned model.

An untrusted feature point is considered to be drifting and lost in tracking, therefore; (1) we update the coordinates of its corresponding vertex with the arithmetic average of vertex neighbors and (2) we project the vertex back to the image plane and relocate the drifting feature point at this location.

We solve the muscle forces using the anatomical muscle map (Section 4.1), estimated displacements of the wireframe vertices (Section 4.5) and the stiffness of the wireframe. The wireframe is modeled as a 3D surface that is composed of polygons. Each face on the wireframe model is defined by three vertices, representing a triangular plane in the 3D space. The edges between each neighboring vertices are modeled with springs as illustrated in Fig. 14
                        .

The spring force vector on vertex i, exerted by the contraction of the spring between vertices i and j, can be represented using Hooke’s elasticity law;
                           
                              (11)
                              
                                 
                                    
                                       
                                          
                                             f
                                          
                                          
                                             →
                                          
                                       
                                    
                                    
                                       ij
                                    
                                 
                                 =
                                 
                                    
                                       k
                                    
                                    
                                       ij
                                    
                                 
                                 (
                                 
                                    
                                       l
                                    
                                    
                                       ij
                                    
                                 
                                 -
                                 |
                                 |
                                 
                                    
                                       x
                                    
                                    
                                       i
                                    
                                 
                                 -
                                 
                                    
                                       x
                                    
                                    
                                       j
                                    
                                 
                                 |
                                 |
                                 )
                                 
                                    
                                       
                                          
                                             x
                                          
                                          
                                             i
                                          
                                       
                                       -
                                       
                                          
                                             x
                                          
                                          
                                             j
                                          
                                       
                                    
                                    
                                       |
                                       |
                                       
                                          
                                             x
                                          
                                          
                                             i
                                          
                                       
                                       -
                                       
                                          
                                             x
                                          
                                          
                                             j
                                          
                                       
                                       |
                                       |
                                    
                                 
                              
                           
                        
                     

In Eq. (11), 
                           
                              
                                 
                                    k
                                 
                                 
                                    ij
                                 
                              
                           
                         is the stiffness of the spring attached to vertices i and 
                           
                              j
                              ,
                              
                                 
                                    l
                                 
                                 
                                    ij
                                 
                              
                           
                         is the rest length of this spring, 
                           
                              
                                 
                                    x
                                 
                                 
                                    i
                                 
                              
                           
                         and 
                           
                              
                                 
                                    x
                                 
                                 
                                    j
                                 
                              
                           
                         are the 3D coordinates of the vertices. Note that the first parenthesis in this equation represents the extension or contraction magnitude of the spring. The ratio forms the unit vector from 
                           
                              
                                 
                                    x
                                 
                                 
                                    j
                                 
                              
                           
                         to 
                           
                              
                                 
                                    x
                                 
                                 
                                    i
                                 
                              
                           
                        , which represents the direction of the spring force. We can factor out the scalar terms in this equation to obtain;
                           
                              (12)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         f
                                                      
                                                      
                                                         →
                                                      
                                                   
                                                
                                                
                                                   ij
                                                
                                             
                                             =
                                             
                                                
                                                   α
                                                
                                                
                                                   ij
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             -
                                             
                                                
                                                   x
                                                
                                                
                                                   j
                                                
                                             
                                             )
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                                
                                                   α
                                                
                                                
                                                   ij
                                                
                                             
                                             =
                                             
                                                
                                                   k
                                                
                                                
                                                   ij
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         l
                                                      
                                                      
                                                         ij
                                                      
                                                   
                                                   -
                                                   |
                                                   |
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   |
                                                   |
                                                
                                                
                                                   |
                                                   |
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   |
                                                   |
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

The effective stiffness value, 
                           
                              
                                 
                                    α
                                 
                                 
                                    ij
                                 
                              
                           
                         depends on the displacements of both vertices. Mutual effective stiffness values 
                           
                              
                                 
                                    α
                                 
                                 
                                    ij
                                 
                              
                           
                         and 
                           
                              
                                 
                                    α
                                 
                                 
                                    ji
                                 
                              
                           
                         are equal to each other. To represent the entire model with a linear set of equations, we collect the effective stiffness values in a stiffness matrix. If multiple vertices exert force on a single vertex, the effective stiffness values are summed.
                           
                              (13)
                              
                                 F
                                 =
                                 -
                                 Kx
                              
                           
                        
                     

The stiffness matrix 
                           
                              K
                           
                         is an 
                           
                              n
                              ×
                              n
                           
                         matrix of effective stiffness values, where n is the number of vertices. The resultant force matrix 
                           
                              F
                           
                         and vertex coordinates 
                           
                              x
                           
                         consist of n rows and 3 columns, representing the 
                           
                              x
                              ,
                              y
                           
                         and z axes.

An illustrative example is shown in Fig. 15
                        . Without loss of generality this grid can be considered as 3 dimensional, i.e. perpendicular forces can move the vertices in an out of the plane. We assume that the vertices that are on the boundaries of the grid are fixed.

Both neighbors of vertex 
                           
                              
                                 
                                    x
                                 
                                 
                                    1
                                 
                              
                           
                         are fixed. Since there can be no extension or contraction on the attached springs, their effective stiffness on 
                           
                              
                                 
                                    x
                                 
                                 
                                    1
                                 
                              
                           
                         are zero. Consequently, the first row of the stiffness matrix 
                           
                              K
                           
                         will be zero. The second vertex, 
                           
                              
                                 
                                    x
                                 
                                 
                                    2
                                 
                              
                           
                         has only one non-static neighbor, which is 
                           
                              
                                 
                                    x
                                 
                                 
                                    6
                                 
                              
                           
                        . The force exerted on 
                           
                              
                                 
                                    x
                                 
                                 
                                    2
                                 
                              
                           
                         by motion of 
                           
                              
                                 
                                    x
                                 
                                 
                                    6
                                 
                              
                           
                         is calculated with;
                           
                              (14)
                              
                                 
                                    
                                       
                                          
                                             f
                                          
                                          
                                             →
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             f
                                          
                                          
                                             →
                                          
                                       
                                    
                                    
                                       26
                                    
                                 
                                 =
                                 
                                    
                                       α
                                    
                                    
                                       26
                                    
                                 
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       2
                                    
                                 
                                 -
                                 
                                    
                                       x
                                    
                                    
                                       6
                                    
                                 
                                 )
                              
                           
                        
                     

Consequently, the second row second column and second row sixth column entries of stiffness matrix 
                           
                              K
                           
                         become 
                           
                              
                                 
                                    α
                                 
                                 
                                    26
                                 
                              
                           
                         and 
                           
                              -
                              
                                 
                                    α
                                 
                                 
                                    26
                                 
                              
                           
                        , respectively. Note that since vertex 
                           
                              
                                 
                                    x
                                 
                                 
                                    2
                                 
                              
                           
                         is pinned this force will have to be balanced with an external stabilizing force, which will appear in the second row of force matrix 
                           
                              F
                           
                        .

When multiple vertices produce spring forces on a single vertex, we sum their effective stiffness values. As an example, both 
                           
                              
                                 
                                    x
                                 
                                 
                                    6
                                 
                              
                           
                         and 
                           
                              
                                 
                                    x
                                 
                                 
                                    7
                                 
                              
                           
                         may produce spring forces on 
                           
                              
                                 
                                    x
                                 
                                 
                                    3
                                 
                              
                           
                        , so the resultant force is computed as;
                           
                              (15)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         f
                                                      
                                                      
                                                         →
                                                      
                                                   
                                                
                                                
                                                   3
                                                
                                             
                                             
                                          
                                       
                                       
                                          
                                             =
                                             
                                                
                                                   
                                                      
                                                         f
                                                      
                                                      
                                                         →
                                                      
                                                   
                                                
                                                
                                                   36
                                                
                                             
                                             +
                                             
                                                
                                                   
                                                      
                                                         f
                                                      
                                                      
                                                         →
                                                      
                                                   
                                                
                                                
                                                   37
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             =
                                             
                                                
                                                   α
                                                
                                                
                                                   36
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   3
                                                
                                             
                                             -
                                             
                                                
                                                   x
                                                
                                                
                                                   6
                                                
                                             
                                             )
                                             +
                                             
                                                
                                                   α
                                                
                                                
                                                   37
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   3
                                                
                                             
                                             -
                                             
                                                
                                                   x
                                                
                                                
                                                   7
                                                
                                             
                                             )
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             =
                                             (
                                             
                                                
                                                   α
                                                
                                                
                                                   36
                                                
                                             
                                             +
                                             
                                                
                                                   α
                                                
                                                
                                                   37
                                                
                                             
                                             )
                                             
                                                
                                                   x
                                                
                                                
                                                   3
                                                
                                             
                                             -
                                             
                                                
                                                   α
                                                
                                                
                                                   36
                                                
                                             
                                             
                                                
                                                   x
                                                
                                                
                                                   6
                                                
                                             
                                             -
                                             
                                                
                                                   α
                                                
                                                
                                                   37
                                                
                                             
                                             
                                                
                                                   x
                                                
                                                
                                                   7
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Eq. (15) sets the third row third column of the stiffness matrix to 
                           
                              
                                 
                                    α
                                 
                                 
                                    36
                                 
                              
                              +
                              
                                 
                                    α
                                 
                                 
                                    37
                                 
                              
                           
                        . The third row sixth and seventh columns of the stiffness matrix become 
                           
                              -
                              
                                 
                                    α
                                 
                                 
                                    36
                                 
                              
                           
                         and 
                           
                              -
                              
                                 
                                    α
                                 
                                 
                                    37
                                 
                              
                           
                        , respectively.

We carry out the same analysis on each vertex to put together the stiffness matrix of the entire wireframe. The stiffness matrix for the system shown in Fig. 15 consists of 16 rows and columns. Due to space restrictions, we only show the first six rows and columns of the stiffness matrix. Note that in this model, external forces on boundary vertices are the stabilizing forces that keep the model pinned in the coordinate system, whereas the external forces on vertices 6, 7, 10 and 11 represent muscles that act on these vertices.
                           
                              (16)
                              
                                 K
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   0
                                                
                                                
                                                   0
                                                
                                                
                                                   0
                                                
                                                
                                                   0
                                                
                                                
                                                   0
                                                
                                                
                                                   0
                                                
                                                
                                             
                                             
                                                
                                                   0
                                                
                                                
                                                   
                                                      
                                                         α
                                                      
                                                      
                                                         26
                                                      
                                                   
                                                
                                                
                                                   0
                                                
                                                
                                                   0
                                                
                                                
                                                   0
                                                
                                                
                                                   -
                                                   
                                                      
                                                         α
                                                      
                                                      
                                                         26
                                                      
                                                   
                                                
                                                
                                             
                                             
                                                
                                                   0
                                                
                                                
                                                   0
                                                
                                                
                                                   
                                                      
                                                         α
                                                      
                                                      
                                                         36
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         α
                                                      
                                                      
                                                         37
                                                      
                                                   
                                                
                                                
                                                   0
                                                
                                                
                                                   0
                                                
                                                
                                                   -
                                                   
                                                      
                                                         α
                                                      
                                                      
                                                         36
                                                      
                                                   
                                                
                                                
                                                   …
                                                
                                             
                                             
                                                
                                                   0
                                                
                                                
                                                   0
                                                
                                                
                                                   0
                                                
                                                
                                                   
                                                      
                                                         α
                                                      
                                                      
                                                         47
                                                      
                                                   
                                                
                                                
                                                   0
                                                
                                                
                                                   0
                                                
                                                
                                             
                                             
                                                
                                                   0
                                                
                                                
                                                   0
                                                
                                                
                                                   0
                                                
                                                
                                                   0
                                                
                                                
                                                   
                                                      
                                                         α
                                                      
                                                      
                                                         56
                                                      
                                                   
                                                
                                                
                                                   -
                                                   
                                                      
                                                         α
                                                      
                                                      
                                                         56
                                                      
                                                   
                                                
                                                
                                             
                                             
                                                
                                                   0
                                                
                                                
                                                   -
                                                   
                                                      
                                                         α
                                                      
                                                      
                                                         26
                                                      
                                                   
                                                
                                                
                                                   -
                                                   
                                                      
                                                         α
                                                      
                                                      
                                                         36
                                                      
                                                   
                                                
                                                
                                                   0
                                                
                                                
                                                   -
                                                   
                                                      
                                                         α
                                                      
                                                      
                                                         56
                                                      
                                                   
                                                
                                                
                                                   (
                                                   
                                                      
                                                         α
                                                      
                                                      
                                                         26
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         α
                                                      
                                                      
                                                         36
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         α
                                                      
                                                      
                                                         56
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                
                                                
                                                
                                                
                                                
                                                   +
                                                   
                                                      
                                                         α
                                                      
                                                      
                                                         67
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         α
                                                      
                                                      
                                                         69
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         α
                                                      
                                                      
                                                         6
                                                         ,
                                                         10
                                                      
                                                   
                                                   )
                                                
                                                
                                             
                                             
                                                
                                                
                                                
                                                
                                                   ⋮
                                                
                                                
                                                
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Given the 3D coordinates of wireframe vertices (Section 4.5) and the stiffness matrix (Eq. (16)) we can calculate the external forces on each vertex using Eq. (13). Recall that our muscle map 
                           
                              A
                           
                         is a 
                           
                              3
                              n
                              ×
                              m
                           
                         matrix in which each triplet of rows represents the effect of all muscles on a single vertex in 
                           
                              x
                              ,
                              
                              y
                           
                         and z axes (Section 4.1). We therefore reorganize the 
                           
                              n
                              ×
                              3
                           
                         force matrix 
                           
                              F
                           
                         to generate a column vector 
                           
                              
                                 
                                    
                                       
                                          f
                                       
                                       
                                          →
                                       
                                    
                                 
                                 
                                    s
                                 
                              
                           
                         of 
                           
                              x
                              ,
                              
                              y
                           
                         and z components of forces. Thus our anatomy based model for unknown muscle forces 
                           
                              
                                 
                                    
                                       
                                          f
                                       
                                       
                                          →
                                       
                                    
                                 
                                 
                                    m
                                 
                              
                           
                         becomes;
                           
                              (17)
                              
                                 A
                                 
                                    
                                       
                                          
                                             f
                                          
                                          
                                             →
                                          
                                       
                                    
                                    
                                       m
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             f
                                          
                                          
                                             →
                                          
                                       
                                    
                                    
                                       s
                                    
                                 
                              
                           
                        
                     

This is a linear, over-determined system of equations with 
                           
                              3
                              n
                           
                         equations and m unknowns. We use least squares to solve this system of equations;
                           
                              (18)
                              
                                 
                                    
                                       
                                          
                                             f
                                          
                                          
                                             →
                                          
                                       
                                    
                                    
                                       m
                                    
                                 
                                 =
                                 
                                    
                                       (
                                       
                                          
                                             A
                                          
                                          
                                             T
                                          
                                       
                                       A
                                       )
                                    
                                    
                                       -
                                       1
                                    
                                 
                                 ·
                                 
                                    
                                       A
                                    
                                    
                                       T
                                    
                                 
                                 ·
                                 
                                    
                                       
                                          
                                             f
                                          
                                          
                                             →
                                          
                                       
                                    
                                    
                                       s
                                    
                                 
                              
                           
                        
                     

The accuracy of least squares method depends on the condition number of the coefficient matrix. The condition number of our muscle map 
                           
                              A
                           
                         differs for each subject due to customization of the wireframe model. We found the condition number of the muscle map to be in the range 
                           
                              4.50
                              ±
                              0.4
                           
                        , which indicates a reliable system to be solved with the least squares method.

@&#EXPERIMENTAL RESULTS@&#

We carried out our classification experiments using naive Bayes (NB), support vector machine (SVM) and AdaBoost classifiers on the original CK [55] and extended CK+ [16] datasets. Our experiments on the CK dataset were on seven classes; six basic expressions and neutral. We replaced the neutral expression with contempt when experimenting with the CK+ dataset. These two scenarios were designed for impartial comparison with the state-of-the-art algorithms. We consistently used leave-sequence-out cross-validation scheme in these experiments.

Additionally, we performed 10-fold random cross-validation for comparing our method with that of Sebe et al. [17]. As a final experiment, we evaluated the person dependency of our method through a leave-subject-out cross-validation scheme.

We will proceed with descriptions of the CK and CK+ datasets and the details of the leave-sequence-out cross-validation approach. Next, we will present the results of our classification experiments. We will conclude this section with a comparative analysis of our algorithm and the state-of-the-art approaches.

We experimented with the CK and CK+ datasets as they are the most frequently used datasets in the literature. The original CK dataset contains 228 image sequences labeled as one of the six basic expressions, performed by 91 different subjects. The extended version, CK+, contains 327 image sequences of seven expressions including contempt. These expressions were performed by 118 different subjects. Table 1
                         presents the distribution of observations to expression classes in CK and CK+ datasets.

Recordings in both datasets end at the apex (peak) of the expression. Discriminative muscle forces are observed as the expression reaches its apex. We tracked feature points and derived muscle forces for each frame of a sequence, but used the muscle forces collected in the last frame for classification of the expression.

Processing of each sequence starts with customization of the wireframe model to the subject in the first frame (Section 4.2). Vertices that are in the region of influence of at least one muscle are determined (Section 4.1), projected onto the image plane and the feature points are initialized. Tracking of feature points using optical flow (Section 4.3) provides us an estimate of head orientation (Section 4.4) and new coordinates of wireframe vertices (Section 4.5). These coordinates are used to calculate the external forces on each vertex, from which the muscle forces are solved (Section 4.6).


                        Fig. 16
                         presents a visual demonstration of our results. The strength of activity for each muscle is coded with the thickness of its identifier. We observe muscular activity in the forehead for anger and surprise expressions. Disgust is clearly separated from other expressions with muscular activity on both sides of the nose. Muscular activities in fear and happiness are very similar, as are the observed expressions. Sadness is distinguishable with muscular activity on the chin.

In our first set of experiments we held out the last frame of one video sequence for testing and used the last frames of the remaining video sequences for training. Cross-validation was achieved by applying this procedure for 228 rounds on the CK dataset,and 327 rounds on the CK+ dataset. This is essentially leave-one-out cross-validation, where each sequence is represented by a single frame. Since only the last frame of each video sequence is utilized, distribution of frames from a video sequence to train and test sets is avoided.

Naive Bayes is particularly suitable when the distribution of the samples to classes is non-uniform as observed in the CK and CK+ datasets. We approximated the probability distributions of features through kernel density estimation. The confusion matrices on CK and CK+ datasets are depicted in Tables 2 and 3
                        
                        . The values in bold in our confusion matrices depict the number of observations that were correctly classified. We find the overall classification performances in CK and CK+ as 77.8% and 72.9%, respectively.

SVM was proposed originally as a binary classifier, but it is adaptable to the multi-class classification problem. We implemented multi-class SVM using one-vs-one strategy, training a SVM classifier for each pairwise combinations of classes. We feed muscle forces extracted from the apex of an expression sequence to these classifiers. The class that was voted most frequently among these classifiers, in other words the mode of the returned class labels, is decided as the class of the frame.


                        Tables 4 and 5
                        
                         present our results for the multi-class SVM classifier on CK and CK+ datasets. The overall classification performances of multi-class SVM on the CK and CK+ datasets are calculated as 87.0% and 75.5%, respectively.

We evaluated muscle forces as features using the Adaboost classifier, which is also a feature selection technique. Adaboost treats each muscle as a potential weak classifier, selecting the best discriminator, and boosting the weights of those examples that are incorrectly classified. The trained classifier is a weighted sum of weak muscle force based classifiers. The results of this experiment are presented in Tables 6 and 7
                        
                        . We observed that the performance of Adaboost is consistently slightly higher than multi-class SVM both on the CK (89.0%) and CK+ (76.0%) datasets.

It is possible to extract the muscle forces in the last k frames of a video sequence to expand the training and testing datasets. We used the last five frames of each sequence and a 10-fold random cross-validation strategy, sampling the test set with respect to the distributions of observations to classes. We tested the results of this cross-validation scheme on the CK dataset with SVM and kNN classifiers. The dataset and classifiers are chosen in accordance with Sebe et al. [17] for an impartial comparative evaluation. Tables 8 and 9
                        
                         present the classification performances in this experiment.

The overall classification rates in this experiment are found as 94.8% (SVM) and 96.0% (kNN). Although we attained much higher performances with this scheme, it must be noted that this outcome is not as reliable as the preceding ones. It merely indicates that the features obtained for a sequence of images is consistent and are mostly separable from features of other sequences. We leave this discussion to the next section, with a final remark that for a novel image sequence, our system guarantees performance levels that were achieved with the leave-sequence-out technique.

Our leave-sequence-out cross-validation scheme guarantees that when a test sequence is selected, frames that belong to the same video do not exist in the training set. Note however that sequences belonging to other expressions of the same subject may in fact exist. We analyzed the dependency of our experimental results on specific persons by removing all image sequences of the subject of the test sequence from the training set. The results of this experiment using the SVM and Adaboost classifiers on the CK+ dataset are presented in Tables 10 and 11
                        
                        . The performances of SVM and Adaboost on person-independent classification are found as 76.8% and 76.3%, respectively.

The performance varies only slightly between leave-sequence-out and leave-subject-out classification schemes (+1.3% for SVM and +0.3% for Adaboost). We conclude by comparison of the leave-sequence-out and leave-subject-out classification results that muscle force based features are person independent; i.e. the knowledge of distinct expressions of the same subject does not have significant effect on the classification performance.

@&#DISCUSSION@&#

Muscle based features proposed with this paper produced best results through Adaboost with classification performances of 89.0% on CK and 76.0% on CK+ datasets. Classification accuracy achieved on the CK dataset approaches the human ceiling of recognition [10,18]. Our method competes with the state-of-the-art algorithms that use geometric, appearance or FACS based features in classification.

A recent study by Goeleven et al. [68] provides a good benchmark for evaluating the performance of automated expression recognition algorithms. This study reports the recognition accuracy of human subjects on basic expressions. They used Karolinska directed emotional faces dataset, a very similar dataset to CK that includes six basic expressions and neutral. The recognition rates of humans and our algorithm are presented in Table 12
                        . These figures indicate that classification with muscle based features can be more successful than an average person. The only two exceptions are happiness and sadness, in which the classification rates are quite similar.


                        Table 13
                         presents comparative evaluation of our approach with Kotsia et al. [56] and Cheon and Kim [49]. These studies were carried out using leave-sequence-out strategy on the CK dataset. We observe that muscle based features can achieve better performance than texture (difference images) and shape (FACS action units) based features when they are used alone. Kotsia et al. achieved higher classification rates only when they combined texture and shape based features through decision-level fusion. Cheon and Kim used AAM and differential AAM features for classification of six basic expressions. Again, we observe better performance with muscle based features using the SVM and Adaboost classifiers.

Lucey et al. [16] used FACS AUs as shape features and experimented on the more challenging CK+ dataset using leave-subject-out cross-validation strategy. Once again, muscle based features outperform classification with texture and shape features when used in isolation (Table 14
                        ). Researchers also combined SVM output probabilities through decision-level fusion. Consistent with our previous observation, texture and shape features can perform better than muscle based features only when they are combined.


                        Table 15
                         compares our method with the work of Sebe et al. [17]. The features in this work are geometric features, which are the motion vectors of Bezier volume control parameters. Researchers term these vectors as motion units and state that they are similar to FACS AUs in nature. The experimental results were obtained on the CK dataset through 10-fold random cross-validation. In this approach all frames were consolidated and randomly split into train and test sets. In other words, during training the classifier could have been provided examples that are in the same sequence with a test frame. Using last five frames of each expression sequence and this cross-validation strategy, we obtained significantly higher classification performance with the SVM classifier (94.8% vs. 75.4%). The performance of muscle based features with the kNN classifier was also slightly higher than that of Sebe et al. (96.0% vs. 93.0%).

Our method performs better than the state-of-the-art approaches that use texture or shape based features in isolation. The comparative evaluation presented in the preceding paragraphs indicates that muscle based features could be better discriminators than the conventional shape and texture based features.

We observe a significant classification performance difference on the CK and CK+ datasets (89.0% vs. 76.0%). The biggest challenges on the CK+ dataset are to discriminate between Anger vs. Sad, Anger vs. Contempt and Happy vs. Fear classes. We observed the misclassified examples to understand the reasons behind this fact. Fig. 17
                         presents samples of fear and happiness expressions in the CK+ dataset. In this image, the frames were annotated as Fear, Fear, Happy and Fear, in the same order. Note that the first three frames are hard to distinguish even for a human observer. They are very similar in appearance, especially around the mouth corners. The fear expression of the third subject is significantly different than the others, which is easily distinguishable from her happiness expression.

We cannot include in this paper hard to classify examples from other expressions due to terms of use of the CK+ dataset. Researchers of this field can see similar examples among the anger, sadness, fear and happiness sequences of subjects 011, 045, 095 and 112 in this dataset.

@&#CONCLUSION@&#

Action Units of FACS and geometric features derived from them have been used frequently in facial expression recognition research. Many FACS AUs correspond to a compound effect of multiple facial muscles. This characteristic of FACS AUs makes identification and scoring of a facial action an intricate task both for human experts and computers. Specifically, (1) it is hard to identify subtle facial activities, (2) it is hard to identify the individual action units in compound expressions and (3) AUs restrict the analysis to psychologically known mechanisms of emotions.

In this research we propose a novel set of muscle force based features for facial expression recognition. The strength of these features come from decomposition of an observed facial expression to the anatomical base functions that compose the expression. We define 18 major muscles (features) based on the anatomy of the human face. The number of muscles can be easily expanded by extending the face model.

The generic face model used in this research is HIGEM, which consists of 612 vertices, 1128 faces and 18 muscles. Muscles are modeled as linear fibers that have conic regions of influence. Muscles have overlapping regions of influence, conforming with the human face anatomy.

The proposed feature extraction system consists of; (1) semi-automatic customization of the face model to the subject, (2) identification and tracking of facial features that reside in the region of influence of a muscle, (3) estimation of head orientation and alignment of the face model with the observed face, (4) estimation of relative displacements of vertices that produce facial expressions, and (5) solving an over-determined system of equations to obtain muscle forces.

We demonstrate the representative power of the proposed features on three classifiers; NB, SVM and Adaboost. The best performance on the classification problem of six basic expressions and neutral was 89.0%, obtained on the CK dataset through Adaboost. This performance approaches the human ceiling of recognition which was reported as 87–91.7%. When we used the CK+ dataset and included contempt in the classification problem we obtained 76.0% recognition rate, once again through Adaboost. Our results both on CK and CK+ datasets are significantly better than FACS AU and texture based studies in the literature.

The proposed feature extraction system obtains its strength from customization of a generic anatomical model to subject’s face and tracking of multiple points on regions of influence. The generic face model embeds prior knowledge in the anatomy of the human face and customization enables us to precisely locate muscles on a given face. We track all feature points that reside in the regions of influence of muscles as evidences of muscle actions. Discarding those points that were unreliably tracked, we obtain an over-determined system of equations, which can be solved to minimize error in calculation of muscle forces.

Availability of muscle forces has important implications in the domain of facial expression recognition. With increased reliability in tracking of facial features, extracted muscle forces will enable detection of subtle expressions as in twitching of an eye. Such advances in automated expression recognition research may lead to detection of harder or even concealed expressions such as boredom and deception in a real world scenario. Moreover, accurate identification of muscle activations will make exploration of unknown mechanisms of facial expressions possible, which will have significant impacts on behavioral science research.

@&#ACKNOWLEDGMENT@&#

This research is part of project “Expression Recognition based on Facial Anatomy”, Grant No. 109E061, supported by The Support Programme for Scientific and Technological Research Projects of The Scientific and Technological Research Council of Turkey (TÜBİTAK).

@&#REFERENCES@&#

