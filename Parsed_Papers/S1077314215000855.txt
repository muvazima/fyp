@&#MAIN-TITLE@&#Efficient height measurements in single images based on the detection of vanishing points

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           We propose a detector for identifying vanishing points in single images.


                        
                        
                           
                           We apply the detector to the problem of computing heights in single images.


                        
                        
                           
                           The height of a person was measured in several images.


                        
                        
                           
                           The mean observed error was 0.58 cm.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Photogrammetry

Vanishing point

Height measurement

Projective space

@&#ABSTRACT@&#


               
               
                  Surveillance cameras have become a customary security equipment in buildings and streets worldwide. It is up to the field of Computational Forensics to provide automated methods for extracting and analyzing relevant image data captured by such equipment. In this article, we describe an effective and semi-automated method for detecting vanishing points, with their subsequent application to the problem of computing heights in single images. With no necessary camera calibration, our method iteratively clusters segments in the bi-dimensional projective space, identifying all vanishing points – finite and infinite – in an image. We conduct experiments on images of man-made environments to evaluate the output of the proposed method and we also consider its application on a photogrammetry framework.
               
            

@&#INTRODUCTION@&#

By analyzing certain image properties – known object size, occlusion, stereoscopic vision, focus, gradient, texture and vergence – we can infer three-dimensional (3D) information of the geometry portrayed in the images. This inferred 3D data can be employed in various computer vision applications: image-based rendering [1,2], automated driving [3], object detection [4], and forensic science [5].

The process of extracting, from images, geometric properties, such as heights, areas, and angles, is denominated by photogrammetry. Photogrammetry methods are widely used in forensic investigations, where it can help corroborate pieces of evidence [5]. Analysis of car accidents and of human height are the two main examples of forensic activities that involve photogrammetry [5].

Considering images captured by surveillance cameras, for instance, with the aid of photogrammetry we can estimate the height of objects and people, useful identification characteristic when the face of the suspects cannot be identified or the details in their clothes are not relevant. Conversely, the suspects are often not on the crime scene at the time of the investigation, or the scene has changed. In these cases, the images themselves are the only source of information.

When only one image depicting the scene is available, the essential problem is the recovery of the third dimension, given that this information was not captured in the acquisition process, in which the 3D scene was projected onto the 2D image plane. In particular, perspective distortions also occur. For example, objects that are away from the camera appear smaller in the image than objects that are closer.

To solve this problem, the first photogrammetrists assumed some a priori information: internal camera parameters (focal length, optical center, scale, distortions, and skew factor), and the camera position in relation to the scene. However, this is only valid when the accuracy of these values is high, since any deviation can generate large measurement errors [6].

Recent works on photogrammetry can be generally classified into two categories: the ones that exploit 3D information from multiple images and the ones that analyze geometric properties in a single image. The first category deals with 3D reconstruction of the scene, from multiple views, to estimate homography or to calibrate the camera [7–9]. Single-view based methods can only rely on the analysis of geometric properties [10–13] but, in this scenario, they often use previously positioned markers for calibration purposes [11,12]. Although these methods attain high accuracy, they cannot be used in forensic applications, where often a previously taken image is the only source of information.

Here we propose a single-view method that detects vanishing points – invariant geometric features that can aid photogrammetry. A vanishing point can be defined as an image point where the projection of a set of real-world parallel lines converges, assuming perspective projection. A vanishing line is a line that contains two vanishing points.

The credit for discovering linear perspective is given to renaissance artist Leon Battista Alberti and architect Filippo Brunelleschi [14]. Alberti’s treatise, De pictura 
                     [15], published in 1435, encloses the first scientific study of perspective. By the 1470s, several artists were able to produce their works of art demonstrating a full understanding of the principles of linear perspective. Leonardo da Vinci, beginning in 1481, also studied and employed perspective in his earlier paintings (Fig. 1
                     ).

In this article, we use a geometric approach to effectively estimate the location of vanishing points – finite and infinite ones – in images of urban and indoor spaces, with the Manhattan-world assumption. We are assuming that the scene has a natural cartesian 3D coordinate system, which is plausible for indoor, outdoor city, and even some country scenes [16].

By representing segments, initially in the image plane, in the bi-dimensional projective space 
                        
                           
                              RP
                              2
                           
                           ,
                        
                      our method clusters them into groups of segments that converge to a unique vanishing point locality. The detected features are then used to identify the ground plane and the vertical direction of the scene. This information is finally inserted into a photogrammetry algorithm proposed by Criminisi [10], with the ultimate goal of measuring the height of objects and people in single images.

This article starts by presenting, in Section 2, a background on the measurement of heights in single images based on vanishing points. In Section 3, we present our vanishing point detector. In Section 4, we show how to estimate the scene vertical direction and also how to detect the ground plane vanishing line. The experiments and their results are provided in Section 5. Finally, Section 6 states the conclusions of this work.

@&#BACKGROUND@&#

The projection of a world point 
                        
                           X
                           ∈
                           
                              R
                              3
                           
                        
                      into an image point 
                        
                           x
                           ∈
                           
                              R
                              2
                           
                           ,
                        
                      considering perspective projection, is described by projection matrix 
                        
                           P
                           ∈
                           
                              R
                              
                                 3
                                 ×
                                 4
                              
                           
                        
                      as
                        
                           (1)
                           
                              
                                 
                                    x
                                    ˜
                                 
                                 =
                                 P
                                 
                                    X
                                    ˜
                                 
                                 =
                                 K
                                 
                                    [
                                    R
                                    |
                                    T
                                    ]
                                 
                                 
                                    X
                                    ˜
                                 
                                 =
                                 
                                    [
                                    
                                       p
                                       1
                                    
                                    
                                    
                                       p
                                       2
                                    
                                    
                                    
                                       p
                                       3
                                    
                                    
                                    
                                       p
                                       4
                                    
                                    ]
                                 
                                 
                                    X
                                    ˜
                                 
                                 ,
                              
                           
                        
                     where 
                        
                           X
                           ˜
                        
                      and 
                        
                           x
                           ˜
                        
                      are the points X and x in homogeneous coordinates, respectively; 
                        K
                      is the matrix representing the intrinsic parameters of the camera; the extrinsic parameters are 
                        R
                      – rotation matrix – and 
                        T
                      – translation vector from the world to the camera system; p
                     1, p
                     2, p
                     3 and p
                     4 are the columns of 
                        P
                     ; and the equality is up to scale.

In [17], the authors prove that p
                     1, p
                     2 and p
                     3 are the orthogonal vanishing points corresponding to the world coordinate system, and that p
                     4 is the image of the world origin. Here we denote these orthogonal vanishing points as vx, vy, vz
                     .

Considering that vx
                      and vy
                      are the two vanishing points on the vanishing line, we can say that p
                     4 must not be on the same line. If it does, then vx, vy
                     , and p
                     4 are linearly dependent. Hence the fourth column can be set to 
                        
                           
                              p
                              4
                           
                           =
                           m
                           /
                           
                              ∥
                              m
                              ∥
                           
                           =
                           
                              m
                              ¯
                           
                           ,
                        
                      where m is the vanishing line [6]. The final projection matrix is
                        
                           (2)
                           
                              
                                 P
                                 =
                                 [
                                 
                                    v
                                    x
                                 
                                 
                                 
                                    v
                                    y
                                 
                                 
                                 α
                                 
                                    v
                                    z
                                 
                                 
                                 
                                    m
                                    ¯
                                 
                                 ]
                                 ,
                              
                           
                        
                     where α is an unknown scalar referred as metric factor. If vz
                      and m are available, then the metric factor α is the only unknown value.

To measure heights in images, we must compute the distance between points in two different planes. Let vz
                      be the vanishing point that indicates the scene vertical direction, and m the ground vanishing line. Considering the projection matrix P 
                     (Eq. 2), Criminisi [18] proved that for an arbitrary object λ, with height Zλ
                      and delimited by image points tλ
                      and bλ
                      (top and bottom points), it holds that
                        
                           (3)
                           
                              
                                 α
                                 
                                    Z
                                    λ
                                 
                                 =
                                 −
                                 
                                    
                                       ∥
                                       
                                          b
                                          λ
                                       
                                       ×
                                       
                                          t
                                          λ
                                       
                                       ∥
                                    
                                    
                                       
                                          (
                                          
                                             m
                                             ¯
                                          
                                          ·
                                          
                                             b
                                             λ
                                          
                                          )
                                       
                                       
                                          ∥
                                          
                                             v
                                             z
                                          
                                          ×
                                          
                                             t
                                             λ
                                          
                                          ∥
                                       
                                    
                                 
                                 .
                              
                           
                        
                     
                  


                     Fig. 2
                      illustrates Eq. (3). Point oλ
                      represents the intersection between vanishing line m and the line that contains tλ
                      and bλ
                     . This intersection point helps to define a ratio of distances between planes and, using this value, one can compute 
                        
                           
                              
                                 Z
                                 λ
                              
                              
                                 Z
                                 c
                              
                           
                           ,
                        
                      where Zc
                      is the camera’s distance. However, it is simpler to compute Zλ
                      via a reference measurement in the image with a known length [6].

Thus, if we want to measure height Zobj
                      of an object obj, and Zref
                      is a known distance on the same image, i.e., it is a reference distance between points tref
                      and bref
                     , then Eq. (3) allows the computation of the scale factor α and subsequently the distance Zobj
                      between tobj
                      and bobj
                     . The following steps can be used to compute height Zobj
                     :
                        
                           1.
                           Detect vanishing points in image I.

Identify vanishing point vz
                               associated with the scene vertical direction.

Estimate vanishing line m associated with the ground plane.

Compute scale factor α by applying Eq. (3) with object ref, i.e., λ = ref.

Compute Zobj
                               by applying Eq. (3) with object obj, i.e., λ = obj, and α.

The process of computing heights in images is illustrated in Fig. 3
                     
                     . According to Criminisi [10], efficient measurements in images can be done by accurately detecting the vanishing points, and estimating vertical vanishing point vz
                      and vanishing line m that represents the ground plane (steps 1, 2 and 3). Therefore, we can use the output of our detector to estimate vz
                      and m.

In the subsequent sections, we describe our method to detect vanishing points and how to estimate, from them, vertical vanishing point vz
                     , and ground vanishing line, m.

The problem of locating vanishing points in 2D perspective projection images has been studied since the 80s. This task is generally seen as the computation of line intersections but, due to quantization errors, lines that correspond to a single vanishing point intersect inside an area denominated vanishing region.

To confront the vanishing region problem, methods often divide the vanishing point detection in three main stages: detection of segments in the image, clustering of the these segments in groups that converge to a vanishing point, and vanishing point estimation for each cluster.

The first stage can be accomplished using an edge detector subsequently grouping the edges to form segments, e.g., Canny operator [19] and Hough transform [20]. Methods can perform the other stages in two ways: using accumulator spaces [21–25] or using the image plane directly [26,27].

Since Barnard’s seminal work on the detection of vanishing points [21], methods have been employing different Hough transform techniques in quantized Gaussian spheres [22]. The problem in such methods are the artifacts often present in digital images, producing erroneous maxima on the quantized space [23].

The methods that use the image plane directly do not need accumulator techniques [26,27]. In this case, the accuracy of the vanishing point location is not limited by the space and the distances are preserved. However, it may be necessary to incorporate additional criteria to work with the infinite vanishing points.

Against these works, our method uses the bi-dimensional projective space 
                        
                           
                              RP
                              2
                           
                           ,
                        
                      or projective plane, transformed directly from the image space, to cluster the segments and detect all vanishing points, including the infinite ones, without additional criteria. Moreover, the space is not bounded, meaning it does no limit the location accuracy.

The proposed detector also has three stages:
                        
                           1.
                           Extracting line segments from the input image.

Clustering of the segments that converge to the same vanishing point (repeated until convergence):
                                 
                                    2.1.
                                    Selection of seeds.

Grouping of segments based on the seeds and the intersection points.

Detection of a vanishing point for each final cluster.


                     Fig. 4 illustrates the three steps to estimate the vanishing points, numerated as shown above. Each one of the steps is described in a following subsection.

We start by extracting line segments from the input image using a method proposed by Desolneaux et al. [28,29]. They deal with the extracting problem by exploring the Helmholtz Principle [29]. Besides line segments, their method also produce, for each segment, its number of false alarms, which will be used to compute the quality of this segment.

The Helmholtz principle declares that if, in an image, the expectation of a certain observed configuration is small, then this grouping is a Gestalt, i.e, it is meaningful [29].
                           Definition 1
                           ε-meaningful configuration


                           A configuration is ε-meaningful if it occurs in an image in a number less than ε.

Let I be a N × N image, and A ∈ I a segment formed by a set of pixels {xi
                        }, i = 1, …, l. Consider a random variable Xi
                         where Xi
                         = 1 if the direction of pixel
                           1
                        
                        
                           1
                           The direction of a pixel is defined by Desolneux et al. [29] as the direction orthogonal to the direction of the gradient at the pixel.
                         
                        xi
                         is aligned to the direction of A, and Xi
                         = 0 otherwise. Therefore, Xi
                         has the following distribution with precision level p:
                           
                              (4)
                              
                                 
                                    P
                                    
                                       [
                                       
                                          X
                                          i
                                       
                                       =
                                       1
                                       ]
                                    
                                    =
                                    p
                                    
                                    and
                                    
                                    P
                                    
                                       [
                                       
                                          X
                                          i
                                       
                                       =
                                       0
                                       ]
                                    
                                    =
                                    1
                                    −
                                    p
                                    .
                                 
                              
                           
                        
                     

The direction of xi
                         is aligned to the direction of A with precision p when
                           
                              (5)
                              
                                 
                                    
                                       D
                                       
                                          a
                                          n
                                          g
                                       
                                    
                                    
                                       (
                                       d
                                       i
                                       r
                                       
                                          (
                                          
                                             x
                                             i
                                          
                                          )
                                       
                                       ,
                                       d
                                       i
                                       r
                                       
                                          (
                                          A
                                          )
                                       
                                       )
                                    
                                    ≤
                                    π
                                    p
                                    ,
                                 
                              
                           
                        where function dir(α) outputs the direction of a pixel or segment α, and Dang
                         outputs the smallest angle between the two directions.

The number of aligned pixels in segment A is represented by random variable Sl
                         = X
                        1 + X
                        2 + … + Xl
                        . Because random variables Xi
                         are independent, Sl
                         has the following binomial distribution:
                           
                              (6)
                              
                                 
                                    P
                                    
                                       [
                                       
                                          S
                                          l
                                       
                                       =
                                       k
                                       ]
                                    
                                    =
                                    
                                       (
                                       
                                          l
                                          k
                                       
                                       )
                                    
                                    
                                       p
                                       k
                                    
                                    
                                       
                                          (
                                          1
                                          −
                                          p
                                          )
                                       
                                       
                                          l
                                          −
                                          k
                                       
                                    
                                    .
                                 
                              
                           
                        
                     

To consider segment A as a primitive for our method, we need to know if A is ε-meaningful among all segments in I.
                           Definition 2
                           ε-meaningful segment


                           A l-length segment A is ε-meaningful if it contains a minimum of k(l) aligned pixels, where
                                 
                                    (7)
                                    
                                       
                                          k
                                          
                                             (
                                             l
                                             )
                                          
                                          =
                                          m
                                          i
                                          n
                                          
                                             {
                                             k
                                             ∈
                                             N
                                             ,
                                             P
                                             
                                                [
                                                
                                                   S
                                                   l
                                                
                                                ≥
                                                k
                                                ]
                                             
                                             ≤
                                             
                                                ϵ
                                                
                                                   N
                                                   4
                                                
                                             
                                             }
                                          
                                          .
                                       
                                    
                                 
                              
                           

The value N
                        4 is the number of oriented segments (defined by their initial and end pixels) in a N × N image.

Consider the ith segment, with length li
                        , and the event ei
                         meaning “the ith segment is ε-meaningful”. Let 
                           
                              χ
                              
                                 e
                                 i
                              
                           
                         denote the characteristic function of this event, so that
                           
                              (8)
                              
                                 
                                    P
                                    
                                       [
                                       
                                          χ
                                          
                                             e
                                             i
                                          
                                       
                                       =
                                       1
                                       ]
                                    
                                    =
                                    P
                                    
                                       [
                                       
                                          S
                                          
                                             l
                                             i
                                          
                                       
                                       ≥
                                       k
                                       
                                          (
                                          
                                             l
                                             i
                                          
                                          )
                                       
                                       ]
                                    
                                    =
                                    
                                       ∑
                                       
                                          k
                                          =
                                          k
                                          (
                                          
                                             l
                                             i
                                          
                                          )
                                       
                                       
                                          l
                                          i
                                       
                                    
                                    
                                       (
                                       
                                          
                                             l
                                             i
                                          
                                          k
                                       
                                       )
                                    
                                    
                                       p
                                       k
                                    
                                    
                                       
                                          (
                                          1
                                          −
                                          p
                                          )
                                       
                                       
                                          
                                             l
                                             i
                                          
                                          −
                                          k
                                       
                                    
                                    .
                                 
                              
                           
                        
                     

Then the total of ε-meaningful segments is represented by variable 
                           
                              R
                              =
                              
                                 χ
                                 
                                    e
                                    1
                                 
                              
                              +
                              
                                 χ
                                 
                                    e
                                    2
                                 
                              
                              +
                              ⋯
                              +
                              
                                 χ
                                 
                                    e
                                    
                                       N
                                       4
                                    
                                 
                              
                              ,
                           
                         and expectation E(R) relates to the number of false alarms.
                           Definition 3
                           number of false alarms in a segment


                           Considering a l
                              0-length segment A with at least k
                              0 aligned pixels, the number of false alarms of A is
                                 
                                    (9)
                                    
                                       
                                          F
                                          
                                             (
                                             
                                                k
                                                0
                                             
                                             ,
                                             
                                                l
                                                0
                                             
                                             )
                                          
                                          =
                                          
                                             N
                                             4
                                          
                                          P
                                          
                                             [
                                             
                                                S
                                                
                                                   l
                                                   0
                                                
                                             
                                             ≥
                                             
                                                k
                                                0
                                             
                                             ]
                                          
                                          =
                                          
                                             N
                                             4
                                          
                                          
                                             ∑
                                             
                                                k
                                                =
                                                
                                                   k
                                                   0
                                                
                                             
                                             
                                                l
                                                0
                                             
                                          
                                          
                                             (
                                             
                                                
                                                   l
                                                   0
                                                
                                                k
                                             
                                             )
                                          
                                          
                                             p
                                             k
                                          
                                          
                                             
                                                (
                                                1
                                                −
                                                p
                                                )
                                             
                                             
                                                
                                                   l
                                                   0
                                                
                                                −
                                                k
                                             
                                          
                                          .
                                       
                                    
                                 
                              
                           

If we take into account all ε-meaningful segments as primitives for our method, we will have several low quality segments. To avoid these equivocal segments, we finally take into account only some of the ε-meaningful segments, the maximal ones.
                           Definition 4
                           Maximal segment


                           A segment A is maximal if:
                                 
                                    1.
                                    ∀B, B ⊂ A ⇒ F(B) ≥ F(A).

∀B, B ⊃ A ⇒ F(B) > F(A).

The two parameters of the method by Desolneux et al. [29], threshold ε and precision level p, are not critical. Values ε = 1 and 
                           
                              p
                              =
                              
                                 1
                                 16
                              
                           
                         work well for all images [24].

We group the detected maximal segments in a set 
                           
                              S
                              =
                              {
                              
                                 s
                                 1
                              
                              ,
                              …
                              ,
                              
                                 s
                                 
                                    |
                                    S
                                    |
                                 
                              
                              }
                              ,
                           
                         and each maximal segment 
                           
                              
                                 s
                                 i
                              
                              ∈
                              S
                           
                         has a number of false alarms denoted by Fi
                        .

Consider the end points (x
                        1, y
                        1) and (x
                        2, y
                        2), in the image plane 
                           
                              
                                 R
                                 2
                              
                              ,
                           
                         that specify an arbitrary maximal segment. If we represent these points in 
                           
                              
                                 RP
                                 2
                              
                              ,
                           
                         we get (x
                        1, y
                        1, 1) and (x
                        2, y
                        2, 1), respectively, using homogeneous coordinates. Here we are also interested in the lines that correspond to the maximal segments, (x
                        1, y
                        1, 1) × (x
                        2, y
                        2, 1). So, for each maximal segment si
                        , we compute the correspondent line as shown above, resulting in li
                        . The computed lines form a set 
                           
                              L
                              =
                              {
                              
                                 l
                                 1
                              
                              ,
                              …
                              ,
                              
                                 l
                                 
                                    |
                                    S
                                    |
                                 
                              
                              }
                           
                        .

The clustering process consists in assigning each segment 
                           
                              
                                 s
                                 i
                              
                              ∈
                              S
                           
                         to a cluster h. Each cluster h is a set formed by line segments assigned to it.

The clustering process has three main steps: determination of the first seeds, assignment of segments to clusters, and update of the seeds.

The selection of the first seeds is done by considering a quality value for segments. The quality value qi
                            of segment si
                            is defined as
                              
                                 (10)
                                 
                                    
                                       
                                          q
                                          i
                                       
                                       =
                                       1
                                       −
                                       
                                          (
                                          
                                             
                                                
                                                   F
                                                   i
                                                
                                                −
                                                m
                                                i
                                                n
                                                F
                                             
                                             
                                                m
                                                a
                                                x
                                                F
                                                −
                                                m
                                                i
                                                n
                                                F
                                             
                                          
                                          )
                                       
                                       ,
                                    
                                 
                              
                           where maxF and minF are the maximum and minimum numbers of false alarms among segments in 
                              
                                 S
                                 ,
                              
                            respectively. Note that the quality value of a segment is inversely proportional to its number of false alarms, i.e., the lower the number of false alarms, higher its quality.

The number of clusters, H, is chosen by the user. The 2H higher quality segments are randomly selected, in pairs, to be the seeds for the H clusters. The two segment seeds of cluster h are denoted by αh
                            and βh
                           .

The method converges in fewer steps when the first seeds are selected based on the quality of the segments. If random segments are chosen as the first seeds instead, the method yields the same results, except that it takes more steps.

The assignment step is responsible for selecting a cluster for each segment in 
                              S
                           . This is done by computing the distance between pseudo-centroids 
                              
                                 
                                    c
                                    h
                                 
                                 =
                                 
                                    l
                                    
                                       α
                                       h
                                    
                                 
                                 ×
                                 
                                    l
                                    
                                       β
                                       h
                                    
                                 
                                 ,
                              
                            defined for each cluster h = 1, …, H, and lines in 
                              L
                           .

The distance between an arbitrary point c and an arbitrary line l in 
                              
                                 RP
                                 2
                              
                            can be computed as
                              
                                 (11)
                                 
                                    
                                       
                                          D
                                          
                                             p
                                             r
                                             o
                                             j
                                          
                                       
                                       
                                          (
                                          c
                                          ,
                                          l
                                          )
                                       
                                       =
                                       
                                          
                                             |
                                             c
                                             ·
                                             l
                                             |
                                          
                                          
                                             ∥
                                             c
                                             ∥
                                             ∥
                                             l
                                             ∥
                                          
                                       
                                       .
                                    
                                 
                              
                           
                        

The formula for distance Dproj
                            is obtained by considering the angle between the line that corresponds to c and the plane that corresponds to l in 
                              
                                 RP
                                 3
                              
                           . Distance Dproj
                            only measures the symmetry between points and lines, because it is not a complete metric. Note that Dproj
                            can be used arbitrarily also between two points in 
                              
                                 RP
                                 2
                              
                           .

The cluster selected for line segment si
                            is the one with the closest pseudo-centroid, i.e,
                              
                                 (12)
                                 
                                    
                                       c
                                       l
                                       u
                                       s
                                       t
                                       e
                                       r
                                       
                                          (
                                          
                                             s
                                             i
                                          
                                          )
                                       
                                       =
                                       
                                          argmin
                                          
                                             j
                                             ∈
                                             [
                                             1
                                             ,
                                             H
                                             ]
                                          
                                       
                                       
                                       
                                          D
                                          
                                             p
                                             r
                                             o
                                             j
                                          
                                       
                                       
                                          (
                                          
                                             c
                                             j
                                          
                                          ,
                                          
                                             l
                                             i
                                          
                                          )
                                       
                                       .
                                    
                                 
                              
                           
                        

In this step, the method selects new seeds αh
                            and βh
                            for each cluster h = 1, …, H.

New seed αh
                            is chosen as the segment in cluster h with closest orientation to the weighted circular mean [30] orientation 
                              
                                 
                                    θ
                                    h
                                 
                                 ¯
                              
                            of the cluster, computed as
                              
                                 (13)
                                 
                                    
                                       
                                          
                                             θ
                                             h
                                          
                                          ¯
                                       
                                       =
                                       a
                                       r
                                       c
                                       t
                                       a
                                       n
                                       
                                          (
                                          
                                             
                                                S
                                                h
                                             
                                             
                                                C
                                                h
                                             
                                          
                                          )
                                       
                                       ,
                                    
                                 
                              
                           where Sh
                            and Ch
                            correspond to
                              
                                 (14)
                                 
                                    
                                       
                                          S
                                          h
                                       
                                       =
                                       
                                          ∑
                                          
                                             
                                                s
                                                i
                                             
                                             ∈
                                             
                                             cluster
                                             
                                             h
                                          
                                       
                                       
                                          
                                             q
                                             i
                                          
                                          sin
                                          
                                             (
                                             2
                                             
                                                θ
                                                i
                                             
                                             )
                                          
                                       
                                       ,
                                    
                                 
                              
                           
                           
                              
                                 (15)
                                 
                                    
                                       
                                          C
                                          h
                                       
                                       =
                                       
                                          ∑
                                          
                                             
                                                s
                                                i
                                             
                                             ∈
                                             
                                             cluster
                                             
                                             h
                                          
                                       
                                       
                                          
                                             q
                                             i
                                          
                                          cos
                                          
                                             (
                                             2
                                             
                                                θ
                                                i
                                             
                                             )
                                          
                                       
                                       .
                                    
                                 
                              
                           In Eqs. (14) and (15), θi
                            is the orientation of segment si
                           .

Formally,
                              
                                 (16)
                                 
                                    
                                       
                                          α
                                          h
                                       
                                       =
                                       
                                          argmin
                                          
                                             
                                                s
                                                i
                                             
                                             ∈
                                             
                                             cluster
                                             
                                             h
                                          
                                       
                                       
                                          D
                                          
                                             a
                                             n
                                             g
                                          
                                       
                                       
                                          (
                                          
                                             
                                                θ
                                                h
                                             
                                             ¯
                                          
                                          ,
                                          
                                             θ
                                             i
                                          
                                          )
                                       
                                       ,
                                    
                                 
                              
                           where Dang
                            gives the minimum angle between the orientations.

By selecting αh
                           , the possible new pseudo-centroids for cluster h are the points 
                              
                                 
                                    l
                                    
                                       α
                                       h
                                    
                                 
                                 ×
                                 
                                    l
                                    i
                                 
                                 ,
                              
                            with si
                            ∈ cluster h. New seed βh
                            is selected as the one that permits new pseudo-centroid ch
                            to be the closest point to all other possible pseudo-centroids of the cluster. Formally,
                              
                                 (17)
                                 
                                    
                                       
                                          β
                                          h
                                       
                                       =
                                       
                                          argmin
                                          
                                             
                                                s
                                                i
                                             
                                             ∈
                                             
                                             cluster
                                             
                                             h
                                          
                                       
                                       
                                       
                                          ∑
                                          
                                             
                                                
                                                   
                                                      
                                                         s
                                                         j
                                                      
                                                      ∈
                                                      
                                                      cluster
                                                      
                                                      h
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      i
                                                      ≠
                                                      j
                                                   
                                                
                                             
                                          
                                       
                                       
                                          D
                                          
                                             p
                                             r
                                             o
                                             j
                                          
                                       
                                       
                                          (
                                          
                                             l
                                             
                                                α
                                                h
                                             
                                          
                                          ×
                                          
                                             l
                                             j
                                          
                                          ,
                                          
                                             l
                                             
                                                α
                                                h
                                             
                                          
                                          ×
                                          
                                             l
                                             i
                                          
                                          )
                                       
                                       .
                                    
                                 
                              
                           
                        


                           Fig. 5
                            illustrates a cluster h with its new seeds αh
                            and βh
                           . The dashed segments are the candidates prior to the selection of βh
                           .

The method converges when pseudo-centroids are the same in two consecutive steps.

After the convergence, the possible vanishing points associated with cluster h are all intersection points in the cluster: li
                         × lj
                        , with si, sj
                         ∈ cluster h. The vanishing point vh
                         is the closest intersection point to all segments in the cluster, i.e.,
                           
                              (18)
                              
                                 
                                    
                                       v
                                       h
                                    
                                    =
                                    
                                       argmin
                                       
                                          
                                             
                                                
                                                   
                                                      l
                                                      i
                                                   
                                                   ×
                                                   
                                                      l
                                                      j
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      s
                                                      i
                                                   
                                                   ,
                                                   
                                                      s
                                                      j
                                                   
                                                   ∈
                                                   
                                                   cluster
                                                   
                                                   h
                                                
                                             
                                          
                                       
                                    
                                    
                                    
                                       ∑
                                       
                                          
                                             s
                                             k
                                          
                                          ∈
                                          
                                          cluster
                                          
                                          h
                                       
                                    
                                    
                                       D
                                       
                                          p
                                          r
                                          o
                                          j
                                       
                                    
                                    
                                       (
                                       
                                          l
                                          k
                                       
                                       ,
                                       
                                          l
                                          i
                                       
                                       ×
                                       
                                          l
                                          j
                                       
                                       )
                                    
                                    .
                                 
                              
                           
                        
                     

According to [31], vertical vanishing points have two characteristics:
                        
                           1.
                           They usually are observed near the image y-axis, considering typical camera positions;

They are well separated from non-vertical vanishing points.

By considering these two characteristics as our premise, we can determine the vertical vanishing vz
                     , and the ground vanishing line m.

Regarding the first characteristic studied by [31], vz
                      should be related to the cluster that has the closest mean orientation (Eq. (13)) to the y-axis of the image. But this condition alone does not suffice.


                     Fig. 6
                      shows two possible clusters with their mean orientation represented by a dashed line. Note that the mean orientation in both clusters has no deviation from the y-axis. Nonetheless, a cluster associated with a vertical direction should have all segments with similar orientation, eliminating the possibility of choosing the first cluster.

Consequently, another characteristic that has to be analyzed is the distribution of the segments orientation in a cluster. For example, considering the segments orientation in Fig. 6, the first cluster has greater standard deviation than the second cluster. This observation leads us to the second necessary condition for associating a cluster with the vertical direction: the segments orientation in the cluster must have low circular standard deviation [30], defined as
                        
                           (19)
                           
                              
                                 
                                    σ
                                    h
                                 
                                 =
                                 
                                    
                                       
                                          −
                                          2
                                          l
                                          n
                                          (
                                          
                                             
                                                R
                                                h
                                             
                                             ¯
                                          
                                          )
                                       
                                    
                                    2
                                 
                                 ,
                              
                           
                        
                     where 
                        
                           
                              R
                              h
                           
                           ¯
                        
                      corresponds to
                        
                           (20)
                           
                              
                                 
                                    
                                       R
                                       h
                                    
                                    ¯
                                 
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   S
                                                   h
                                                
                                             
                                             2
                                          
                                          +
                                          
                                             
                                                
                                                   C
                                                   h
                                                
                                             
                                             2
                                          
                                       
                                    
                                    
                                       
                                          ∑
                                          
                                             
                                                s
                                                i
                                             
                                             ∈
                                             
                                             cluster
                                             
                                             h
                                          
                                       
                                       
                                          q
                                          i
                                       
                                    
                                 
                                 .
                              
                           
                        
                     
                  

Combining these two conditions, we can select cluster z associated with the vertical direction. Formally,
                        
                           (21)
                           
                              
                                 z
                                 =
                                 
                                    argmin
                                    
                                       h
                                       ∈
                                       [
                                       1
                                       ,
                                       H
                                       ]
                                    
                                 
                                 
                                 
                                    D
                                    
                                       a
                                       n
                                       g
                                    
                                 
                                 
                                    (
                                    
                                       
                                          θ
                                          h
                                       
                                       ¯
                                    
                                    ,
                                    
                                       π
                                       2
                                    
                                    )
                                 
                                 +
                                 
                                    σ
                                    h
                                 
                                 ,
                              
                           
                        
                     where 
                        
                           
                              θ
                              h
                           
                           ¯
                        
                      is the circular mean orientation of cluster h (Eq. (13)) and σh
                      is the circular standard deviation of cluster h (Eq. (19)).

Then vertical vanishing point vz
                      is the one associated with cluster z.

To estimate the ground vanishing line m, we recall the second characteristic studied by [31]: all vanishing points are well separated from vz
                     . So, there are three cases to be considered, depending on the number of clusters chosen by the user:
                        
                           •
                           Two: the ground vanishing line is the one that contains the non-vertical vanishing point, and with orientation given by the mean orientation of its cluster.

Three: the ground vanishing line is the one that connects the two non-vertical vanishing points.

Four or more: in this case, it is not clear through which two vanishing points the ground vanishing line passes. By graphically showing the possible vanishing lines, the user can select the one that corresponds to the ground plane.

@&#EXPERIMENTS@&#

We tested the effectiveness of the vanishing point detector in the York Urban database [32], an image database with a hundred images of man-made environments. Together with the images, the authors of the database also provided the intrinsic camera parameters, and the vanishing points computed with hand-detected segments and a Gaussian sphere method.

In Fig. 7
                        , we provide some visual examples of the obtained results. The first column presents the input images together with the line segments in black, detected as shown in Section 3.1. The second column presents the results of the segment clustering algorithm associated with each input image of the first column, computed as shown in Section 3.2. Each cluster is represented in a different color (red, green, and blue) and the colored squares represent the finite vanishing points, detected as shown in Section 3.3.

Note
                         that we are considering the Manhattan-world assumption, i.e., the images must depict scenes with a cartesian 3D coordinate system. Scenes with few parallel lines or lines not aligned with the coordinate system axis cannot be considered here.

Besides the visual inspection of the results, we conducted two experiments. First, we computed the orthogonality error to quantify the deviation of the most orthogonal vanishing points
                           2
                        
                        
                           2
                           The most orthogonal vanishing points are the ones with the lowest orthogonality error (Eq. (25)).
                         from the actual orthogonality.

The second experiment measured the focal length error using the camera intrinsic parameters, provided by the database. We compared the focal length computed with the most orthogonal vanishing points to the real expected one.

The authors of the database provided the intrinsic parameters of the camera: focal length f, pixel dimension (mx, my
                           ), principal point (px, py
                           ), and skew factor ς. With this information, we can construct the camera
                            intrinsic matrix:
                              
                                 (22)
                                 
                                    
                                       K
                                       =
                                       
                                          [
                                          
                                             
                                                
                                                   
                                                      f
                                                      /
                                                      
                                                         m
                                                         x
                                                      
                                                   
                                                
                                                
                                                
                                                   ς
                                                
                                                
                                                
                                                   
                                                      p
                                                      x
                                                   
                                                
                                             
                                             
                                                
                                                   0
                                                
                                                
                                                
                                                   
                                                      f
                                                      /
                                                      
                                                         m
                                                         y
                                                      
                                                   
                                                
                                                
                                                
                                                   
                                                      p
                                                      y
                                                   
                                                
                                             
                                             
                                                
                                                   0
                                                
                                                
                                                
                                                   0
                                                
                                                
                                                
                                                   1
                                                
                                             
                                          
                                          ]
                                       
                                       ,
                                    
                                 
                              
                           
                        

Given that we have matrix 
                              K
                           , it is trivial to obtain the Image of the Absolute Conic ω:
                              
                                 (23)
                                 
                                    
                                       ω
                                       =
                                       
                                          K
                                          
                                             −
                                             T
                                          
                                       
                                       
                                          K
                                          
                                             −
                                             1
                                          
                                       
                                       .
                                    
                                 
                              
                           
                        

Considering two arbitrary orthogonal vanishing points vp
                            and vq
                           , it is true that
                              
                                 (24)
                                 
                                    
                                       
                                          v
                                          p
                                       
                                       ω
                                       
                                          v
                                          q
                                       
                                       =
                                       0
                                       .
                                    
                                 
                              
                           
                        

Therefore, to find the most orthogonal vanishing points among all detected vanishing points vi, i = 1, …, H, we select the triplet (vp, vq, vr
                           ) that minimizes the orthogonality error
                              
                                 (25)
                                 
                                    
                                       
                                          e
                                          
                                             p
                                             ,
                                             q
                                             ,
                                             r
                                          
                                       
                                       =
                                       
                                          
                                             (
                                             
                                                v
                                                p
                                             
                                             ω
                                             
                                                v
                                                q
                                             
                                             )
                                          
                                          2
                                       
                                       +
                                       
                                          
                                             (
                                             
                                                v
                                                q
                                             
                                             ω
                                             
                                                v
                                                r
                                             
                                             )
                                          
                                          2
                                       
                                       +
                                       
                                          
                                             (
                                             
                                                v
                                                r
                                             
                                             ω
                                             
                                                v
                                                p
                                             
                                             )
                                          
                                          2
                                       
                                       .
                                    
                                 
                              
                           
                        

For each image on the York Urban database, we selected the most orthogonal vanishing point triplet. We then constructed a histogram of the cumulative orthogonality error for these triplets, shown in Fig. 8. We compared our method with the one provided in the database [32], named here as York Urban method, where the segments are hand detected and the computation is done by considering a cumulative space represented in a Gaussian Sphere.

For this experiment, consider that the focal length f is unknown, but instead we have the most orthogonal vanishing point triplet for each image. With this information, we can estimate the unknown f and compare it with the real value. In order to do this, it is necessary to retrieve matrix K by decomposing matrix ω.

For each image of the database, we selected the most orthogonal vanishing point triplet, and estimated a focal length from them. We then constructed a histogram of the cumulative focal length, shown in Fig. 9. We compared our obtained focal length with the one obtained by York Urban method and two other detectors:
                              
                                 •
                                 Almansa et al. [24] considers the Helmholtz principle to detect segments and estimate vanishing regions. We selected the center of these regions to locate the vanishing points. This extension is named here as Almansa et al. + vpe.

Tardif [27] considers a Canny edge detector and a flood fill algorithm to extract segments. Vanishing points are detected by a J-Linkage algorithm.

Note that York Urban method [32] provides in general a better estimation of the focal length. This is justified by the fact that, in this method, the segments are hand detected, eliminating a major source of errors.

With the knowledge of the vanishing points locality, we can select which one is vanishing direction vz
                         and also determine the ground line m, as detailed in Section 4. This information can be inputed into Criminisi’s photogrammetry framework [6], as described in 2, to make height measurements in single images.

Because we are dealing only with a single view of the scenes, it is necessary to obtain the height of reference objects in order to compute absolute values. This cannot be done with images of scenes we don’t have access to make reference measurements. Therefore we constructed a database of twenty images (750 × 563 pixels) with reference objects in the real world. The vanishing points detected on these images generate focal length errors of less than 25 pixels.

In order to measure the real height of an object obj depicted in the image, the user must inform its top and bottom points, tobj
                         and bobj
                        , and the top and bottom points of a reference ref, tref
                         and bref
                        , with known height Zref
                        .

In an error-free case, the points tα
                         and bα, α = obj, ref, have to be aligned with vz
                         
                        [6]. Therefore, to compute height Zobj
                        , we replace the location of the selected points bobj
                         and bref
                         with their perpendicular projection onto lines 
                           
                              
                                 
                                    v
                                    z
                                 
                                 
                                    t
                                    
                                       o
                                       b
                                       j
                                    
                                 
                              
                              ↔
                           
                         and 
                           
                              
                                 
                                    
                                       v
                                       z
                                    
                                    
                                       t
                                       
                                          r
                                          e
                                          f
                                       
                                    
                                 
                                 ↔
                              
                              ,
                           
                         respectively, generating the scenario depicted in Fig. 3.

The errors associated with the choice of points tobj, bobj, tref
                         and bref
                         were considered by computing the height using all possible combinations of points inside a range of 
                           
                              
                                 1
                                 %
                                 ·
                                 |
                              
                              
                                 
                                    
                                       t
                                       α
                                    
                                    
                                       b
                                       α
                                    
                                 
                                 ¯
                              
                              
                                 |
                              
                           
                         around each point, for α = obj, ref. For example, Fig. 10 shows the considered range around tobj
                         (top of object obj). Each point inside the depicted range was considered once as tobj
                        . The final height is the average between every obtained height.

The height of a person was measured comparatively to a known reference height in twenty images taken in urban environments. The ground truth height is 171.5 cm and the mean observed error across all images was ± 0.58 cm. Some of the results are shown in Figs. 11, 12, and 13. In each one of these figures, the first column contains the input image with the segment clustering result, where each color represents a cluster associated with a vanishing point. The second column shows a zoomed crop with the vanishing line in green, the reference object height, and the computed height.

@&#CONCLUSION@&#

In this article, we described a method to detect vanishing points in an image and showed how to apply it to make efficient height measurements. The proposed method works with uncalibrated cameras, and can detect all vanishing points. Since it is performed in a bi-dimensional projective space, the detected points have accurate locations with no loss of information in transformations between spaces.

However, the method is only effective when applied to images of man-made environments, in which it is possible to extract straight segments corresponding to different 3D orientations.

Several applications can benefit from the proposed method. In forensic investigations, for example, images from CCTV cameras – Closed-circuit television – can be used to estimate the height of suspects. CCTV cameras are widely employed in streets of major cities like New York and London.

The results show visually and experimentally the effectiveness of the method and its application to a photogrammetry framework, allowing the estimation of heights in images.

The presented method is useful in computing the height of rigid objects or people standing in a straight position. However, the height of animated objects tend to change while they move. This study will be included in a future work.

@&#ACKNOWLEDGMENTS@&#

This work was primarily supported by CNPq (grants 201238/2010-1 and 308882/2013-0), with additional support by FAPERJ and CAPES (grant E-26/103.665/2012), NSF (grants IIS-0808718, CCF-0915661, and IIP-1330139), and FAPESP (grant 2012/50468-6).

@&#REFERENCES@&#

