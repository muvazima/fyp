@&#MAIN-TITLE@&#OvaSpec – A vision-based instrument for assessing concentration and developmental stage of Trichuris suis parasite egg suspensions

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           A scalable, objective method for in-process drug testing was developed.


                        
                        
                           
                           OvaSpec automatically assess concentration and embryonation percentage of TSO.


                        
                        
                           
                           Algorithms were tested on a large, annotated dataset of 42,894 eggs in 2970 images.


                        
                        
                           
                           Darkfield scattering and larval morphology enables classification accuracies of 99%.


                        
                        
                           
                           Computer vision agrees with manual microscopy but has superior precision.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Parasite egg classification

Computer vision

Image analysis

Darkfield microscopy

Embryonation percentage

Concentration




                     Trichuris suis eggs

@&#ABSTRACT@&#


               
               
                  Background
                  OvaSpec is a new, fully automated, vision-based instrument for assessing the quantity (concentration) and quality (embryonation percentage) of Trichuris suis parasite eggs in liquid suspension. The eggs constitute the active pharmaceutical ingredient in a medicinal drug for the treatment of immune-mediated diseases such as Crohn׳s disease, ulcerative colitis, and multiple sclerosis.
               
               
                  Methods
                  This paper describes the development of an automated microscopy technology, including methodological challenges and design decisions of relevance for the future development of comparable vision-based instruments. Morphological properties are used to distinguish eggs from impurities and two features of the egg contents under brightfield and darkfield illumination are used in a statistical classification to distinguish eggs with undifferentiated contents (non-embryonated eggs) from eggs with fully developed larvae inside (embryonated eggs).
               
               
                  Results
                  For assessment of the instrument׳s performance, six egg suspensions of varying quality were used to generate a dataset of unseen images. Subsequently, annotation of the detected eggs and impurities revealed a high agreement with the manual, image-based assessments for both concentration and embryonation percentage (both error rates <1.0%). Similarly, a strong correlation was demonstrated in a final, blinded comparison with traditional microscopic assessments performed by an experienced laboratory technician.
               
               
                  Conclusions
                  The present study demonstrates the applicability of computer vision in the production, analysis, and quality control of T. suis eggs used as an active pharmaceutical ingredient for the treatment of autoimmune diseases.
               
            

@&#INTRODUCTION@&#


                     Trichuris suis ova (TSO), eggs of the pig whipworm, constitute the active pharmaceutical ingredient in a new medicinal product intended for the treatment of immune-mediated diseases such as Crohn׳s disease [1], ulcerative colitis [2], and multiple sclerosis [3]. The treatment, known as helminthic therapy, has been inspired by the hygiene hypothesis, which suggests a connection between the improved hygiene and the resulting lack of childhood exposure to pathogens and intestinal parasites and the rising incidence of immune-mediated diseases in industrialized countries [4,5]. Based on positive results from animal studies [4,6,7] and early human studies [1–3], the treatment is currently being evaluated in several clinical trials [8].

Only the fully developed (embryonated) eggs that contain distinct larvae have the potential to hatch and invade the intestinal mucosa, which is believed to be the key factor inducing immunomodulation in the patients [9]. Eggs without visible larvae (see 
                     Fig. 1) do not have this effect, and therefore determination of the concentration of embryonated eggs in an egg suspension is essential for the dosing of the pharmaceutical ingredient.

The concentration of embryonated eggs is often estimated as the product of two critical quality parameters of an egg suspension; the concentration (eggs/ml) and the embryonation percentage (embryonated eggs/total eggs). Traditionally, concentration and embryonation percentage (emb. pct.) of eggs in an egg suspension are assessed by manual microscopy of subsamples. The present OvaSpec instrument (see 
                     Fig. 2) was developed specifically for the analysis of T. suis eggs as an automated alternative to the manual process to improve objectivity (reduce subjectivity of operator), reproducibility, scalability (analyze thousands of eggs/day), and allow for validation of the process. In conjunction with ongoing clinical trials [8,10], the active pharmaceutical ingredient is subject to extensive regulatory requirements including the establishment of analytical methods for in-process control as well as potency-indicating assays. Thus, an important milestone was to develop a fully automated system for analyzing suspensions of T. suis eggs.

Embryonated eggs are produced under controlled conditions by incubating egg suspensions at 25°C for 100 days. Depending on the quality of the egg suspension the embryonation percentage may be up to 95%. The standard concentrations used in the production are 20,000 and 40,000eggs/ml. Thus, the instrument should be able to assess egg concentrations from 15,000 to 50,000eggs/ml and embryonation percentages from 0% to 100%. In the blinded experiment described later, incubated and non-incubated eggs are mixed to obtain suspensions with a range of embryonation percentages for the study participants to assess.

Coulter counters [11], known from cell counting, have been proposed for the task of automated egg counting, but their impedance change detection does not allow for distinction of eggs and impurities. Their size gating can exclude some of the small and large impurities, but it cannot sort out the egg-sized particles, which constitute the majority of impurities after a comprehensive sieving during egg isolation.

Until recently, image analysis of eggs of helminths – parasitic worms – like T. suis was predominantly investigated for medical or veterinary diagnostic purposes, where eggs were detected and grouped according to genus, and in a few instances to species. Both the egg detection and the species recognition are based primarily on size and shape of the eggs [12–15], although the addition of texture features was shown to improve the classification of strongyle eggs [16]. Several of the systems target only the classification step and work directly with images of individual parasite eggs [13–16] or work only with a small number of images [12,14,15]. A notable exception is the recent work by Suzuki et al. [17] where elaborate machine learning algorithms were used to detect and distinguish 15 species of helminth eggs and protozoa in 793 images based on more than 20 geometric and textural features. In a follow-up paper [18] this analysis was optimized for speed and combined with an automated image acquisition system allowing for analysis of 7859 images containing 1791 parasites and 6068 impurities.

The application of image analysis for analyzing the developmental stages of helminth eggs, specifically T. suis eggs, was introduced recently by Bruun et al. [19,20], who initially proposed the application of darkfield illumination. With the exception of Suzuki et al. [18], all previous papers [12–17,19] rely on manual image acquisition and focusing under a microscope in contrast to the fully automated system presented in this paper, which enables the acquisition of larger data sets leading to better characterization of the biological variation of the eggs and more robust analyses.

The present paper describes the instrument development (Section 2.1) and applied image analysis (Section 2.2), and evaluates the assessment of concentration and embryonation percentage against image annotations at the individual egg level (Sections 3.1 and 3.2) and microscopic assessment at the egg suspension level (Section 3.3).

The OvaSpec instrument was developed in collaboration with the Danish computer vision company Videometer A/S and uses several hardware and software components from the VideometerLab [21,22], a multispectral vision instrument for assessment food quality and related applications, e.g. of vegetables [23,24], meat [25,26], rice [27], and fish feed [28]. Like in the VideometerLab, the principle of multispectral imaging is used in OvaSpec, where a monochrome image sensor captures the transmission and scattering of LED light at various wavelengths. The main components of the instrument are the camera, the optics, the illumination, and the mechanics. The quality of the produced images is influenced by all of these as well as the choice of sample container, acquisition pattern, and autofocus strategy. The chosen components are presented in 
                        Fig. 3.

An early proof-of-concept analysis indicated that an egg length of at least 80 pixels, but preferably 120–180 pixels, was required to achieve an image quality appropriate for assessing the developmental stage of individual eggs. Since the eggs are approximately 60μm long, this corresponds to a resolution of 2–3pixels/μm. The chosen camera and optics resulted in a resolution of 2.87pixels/μm. Since the eggs sediment at the bottom of the sample container, the instrument is constructed as an inverted microscope. In order not to stir up the sample during acquisition, which could lead to some eggs being imaged multiple times, it was decided to have the motors move the camera and optics instead of the sample container unlike typical automated microscopy that uses a motorized stage.

The standard method of counting T. suis eggs is to examine a known small volume of an egg suspension on a microscope slide, but this method is not suitable for automated imaging since the optimal focus level varies across the droplet and furthermore changes over time as the droplet evaporates. Instead, a single flat-bottomed well from an 8-well ELISA strip (Greiner Bio-One, Frickenhausen, Germany) is used, see 
                           Fig. 4.

To prepare the sample, two-thirds of the well is filled with degassed, purified water, and the egg suspension sample is pipetted out into the water near the bottom of the well, where the eggs will settle quickly. The rest of the well is then filled with water until surface tension is reached and a cover glass is placed on top of the well to make the surface of the water flat, thereby reducing spatial focus differences. The pipetting of the sample is done using an electronic pipette in reverse pipetting mode where it aspirates 5μl more than the targeted amount and only dispenses the targeted amount, thereby avoiding having to use air blow-out to empty the pipette tip. Combined with the sample preparation above, this pipetting technique greatly reduces the risk of air bubbles forming at the bottom.

To image the entire bottom of the sample container at the chosen resolution, a set of 99 multispectral images is acquired in an 11×9 grid pattern, see 
                           Fig. 5. An overlap zone of 120μm, corresponding to two egg lengths, was chosen in order to make sure that all eggs were imaged. The object extraction process, described in Section 2.2, keeps track of the positions of all detected foreground objects so that no object is counted twice.

Getting the eggs in focus is crucial for the quality of the acquired images. Despite the above-mentioned measures for reducing focus variability across the sample, the small egg width of approx. 25μm makes it necessary to use autofocusing to make sure that all eggs are in acceptable focus.

The autofocus strategy consists of two parts; an initial autofocusing and a local autofocusing. The initial autofocusing establishes the overall focus plane reference value. This is done by acquiring a tall z-stack (stack of images at different focus levels) at the center of the well (marked blue in Fig. 5) and selecting the focus level from the image best in focus. Following the initial autofocus, the actual acquisition of the multispectral images is carried out. At each position in the acquisition pattern, a smaller, local z-stack around the initial reference focus value is acquired and the best of these images is chosen. This has to be done for all 99 positions in the pattern and is the main contributing factor to the instrument׳s total runtime. Further analysis and possibly modeling of the focus distribution inside a well is believed to be essential for reducing the acquisition time.

The instrument is built as a device plugin for the VideometerLab software stack with a custom front-end. It utilizes VideometerLab׳s underlying libraries for controlling illumination, mechanics, and the camera, as well as its set of image analysis libraries for segmentation, object handling, feature extraction, and classification. The software saves the acquired multispectral images in raw format and as color representations, see 
                           Fig. 6. For each of the five multispectral bands, see 
                           Fig. 7, an overview image of the entire well is saved at a quarter the original resolution. Additionally, all detected foreground objects are saved as individual subimages and a report of the classification results are produced. The saving of the raw image files makes it possible to go back and analyze earlier image sets when the classification model or image analysis routines are updated.

The purpose of the image analysis is to detect all foreground objects in the acquired images and categorize them. The objects are detected using image segmentation, discussed below, and the categorization is constructed as a decision tree, illustrated in 
                        Fig. 8. It consists of two main subtrees; one for assessment of egg quantity (right) and one for assessment of egg quality (left). The two subtrees are summarized here and further explained in detail in Sections 2.2.3 and 2.2.4.

Each of the resulting foreground objects from the segmentation (called blobs) can contain zero or more eggs, since clumps of touching or overlapping eggs and impurities are detected as single objects. The first decision in the tree is used to identify the lateral, singularized eggs (denoted LS-eggs) among the extracted foreground objects. This is done using size and shape properties, as explained in Section 2.2.2.

The quantity-related subtree is used to estimate the total number of eggs in the sample. In this subtree the number of eggs in each of the remaining, non-LS-egg objects is estimated using size and shape properties. These egg counts are added to the number of identified LS-eggs to get an estimate of the total egg count in the sample. The total egg count can then be divided by the sample volume to assess the concentration of eggs in the sample. For instance, 1600 eggs in a sample of 80μl correspond to a concentration of 20eggs/μl or 20,000eggs/ml, which is the common unit for concentrations of T. suis eggs.

The quality-related subtree is used to assess the embryonation percentage of the sample. This is done by classifying each LS-egg as being either an embryonated egg (EE) or a non-embryonated egg (NEE). All non-incubated, partly developed, and degenerated eggs are considered non-embryonated in this classification. An estimate of the emb. pct. is then computed as the proportion of embryonated eggs out of all identified LS-eggs.

Note that only the lateral, singularized eggs are used for the embryonation assessment, since upright, clumping, and especially overlapping eggs often make it harder to see if there are fully developed larvae inside the eggs, see 
                        Fig. 9. This assessment therefore assumes that the LS-eggs are representative with regards to embryonation of the sample, i.e. that embryonated and non-embryonated eggs are equally likely to clump, overlap, or position themselves upright at the bottom of the analyzed well. A small investigation showed that this assumption seemed reasonable; the proportion of embryonated upright eggs was very close to the proportion of embryonated lateral eggs for three investigated wells.

The following sections describe the image segmentation and object categorization in further detail.


                           Fig. 6 shows a color rendition of one of the 99 positions of the well in Fig. 5. The color image is composed from the red, green, and blue brightfield bands of the multispectral image, scaled to improve the white balance. The five multispectral bands are illustrated for a region of the image in Fig. 7. It is seen that the internal egg structures are best distinguished in the red band, while the contrast between foreground and background is largest in the blue band, so the blue band is used for segmentation.

The first step in the segmentation is thresholding. Since the entire image acquisition process and illumination is under control, a fixed threshold value is used. Fixed thresholding reduces the influence of the image contents on the segmentation. In this case, the value was experimentally chosen to be 135 of 255 based on manual and adaptive thresholding of a set of “extreme” images. After the thresholding, holes in the binary image are filled up to an area corresponding to three eggs (30,000pixels or 3633μm2). The result of the segmentation process is shown in 
                           Fig. 10(b). Following the segmentation, blobs representing the segmented foreground objects are extracted using connected component labeling with 4-connectivity. Blobs smaller than the area of a single polar plug (500pixels or 60.6μm2) are discarded.

The segmentation and blob extraction is done for all 99 images in the set. During image acquisition, the software keeps track of the motor coordinates for each image. These coordinates are used to calculate the exact position of each blob, which is then used to discard already identified blobs from the overlap zone of neighboring images, thereby avoiding to extract the same blob multiple times. The identified blobs are passed on to the decision tree.

The first decision in the tree identifies the LS-eggs from all other foreground objects based on 10 size and shape features. In order for an object to be classified as an LS-egg, the scores for each of these features have to be within predefined intervals, given in 
                           Table 1.

The endpoints of the intervals were chosen based on an earlier training set, where all proposed LS-eggs were marked and their feature scores were computed. For each feature in the list, the initial endpoints were defined to be the minimum and maximum feature score of the marked LS-eggs. After plotting the scores of the LS-eggs and the remaining objects, some of these intervals were manually tightened to remove false positives. The definition of an LS-egg is not completely clear, so the intervals just had to make sure that no non-eggs or eggs with obscured contents were included. The approach was inspired by the idea of combining several weak classifiers into a stronger classifier, known from machine learning techniques such as ensemble learning and boosting [29].

The objects remaining after the first decision in the tree are a mixture of touching, overlapping, and clumping eggs and impurities of various sizes and shapes. In order to assess the egg concentration of the sample, all eggs in the sample have to be counted. The proposed approach is to estimate the total egg count by summing the computed number of eggs in each of the detected objects.

Six classes are introduced to aid the egg counting process, called C0, C1, C2, C3, C4, and C5+, where the C is short for Count. They represent the number of eggs identified in a given object. Ideally, all singularized and clumping impurities get assigned to C0, all pairs of touching or overlapping eggs get assigned to C2, and all clumps of five or more eggs are assigned to C5+ etc. The class C1 is for instance given to an object that is believed to be a single egg but which does not fulfill the criteria for being an LS-eggs, for instance because a small impurity touches the egg.

The employed approach is to first identify all singularized eggs and then deal with clumps of eggs and particles. To do this, the remaining objects are divided into a “small” and “big” group, where the “big” group consists of all objects larger than the maximum size of a single egg (area≥13,460pixels or 1630μm2).

The lateral, singularized eggs are already identified in the initial step of the decision tree, but both upright and inclined eggs occur in the images as well, as seen in the upper left corner of Fig. 6. So from the “small” group, these are identified by the features listed under “Upright eggs” in Table 1. The interval endpoints were again chosen based on an earlier training set, but with some manual tweaking and inspiration from the LS-egg intervals. The remaining objects in the “small” group are then finally divided between the classes C0 and C1, see Table 1. This step introduces a number of misclassifications, which should potentially be eliminated in the future.

Finally, the group of “big” objects is classified, primarily based on area. First, oblong impurities such as long, thin hairs or fibers are classified as C0 if either Width<26μm or RatioWidthLength<0.24. The remaining blobs are classified based on their area (in μm2): C1 [1630; 2000[, C2 [2000; 3100[, C3 [3100; 4500[, C4 [4500; 5500[, and C5+ [5500; ∞[. A more sophisticated approach using template matching with egg-shaped templates was initially considered, but the low classification error of the area-based approach made it unnecessary to introduce additional complexity at this step.

The embryonation percentage of the sample is computed as the proportion of LS-eggs that have a visible larva inside. The classification is based on two biologically inspired features, the longitudinal anisotropy and the darkfield glow, first introduced by Bruun et al. [19,20].

Longitudinal anisotropy (LA) is a measure of linear structures of the egg contents in the longitudinal direction of the egg. It is defined as the ratio between the strength of longitudinal linear structures and the strength of the transverse linear structures. Due to the typical positioning of the larvae inside the eggs, this measure is on average high for embryonated eggs, as shown by Bruun et al. [19]. A slight modification was made to the earlier presented method in that background-correction with a kernel size of 21 pixels was applied before calculation of the orientation energy.

Darkfield glow (DFG) is a measure of the mean scattering intensity of the egg contents under darkfield illumination. It was previously observed that the fine-grained structures of non-embryonated egg contents scatter light significantly more than those of embryonated eggs, and this can be used to distinguish the two [19]. Also here, a slight modification was introduced in that the glow was measured as a robust mean of the egg content region where the 0.5% smallest and largest values were removed. The classification performance of these features is presented in Section 3. An example of the darkfield illumination and corresponding classification results can be seen in Fig. 10(c and d).

The VideometerLab Calibration Development Tool was used to create the egg classification models and inspect individual eggs and their features, see 
                           Fig. 11. The actual image acquisition and combined analysis of concentration and embryonation percentage are carried out as a batch process when the OvaSpec application is executed.

A blinded data set was prepared in order to evaluate the performance of the instrument. It consists of six vials of TSO suspensions at a concentration of approximately 20,000eggs/ml with embryonation percentages ranging from 0% to 85%. They were obtained by mixing two stock suspensions; one of non-incubated eggs (0% embryonation) and one of incubated eggs (85% embryonation).

The T. suis eggs are from a GMP-validated egg production, where they were isolated from fecal material of inoculated Göttingen minipigs under clean and controlled conditions. Cleaning procedures include sieving, flotation, and sedimentation [30], after which the eggs were re-suspended in sulfuric acid pH 1 to avoid bacterial growth and stored at 5°C. In principle, the procedure can be adapted to stool/fecal samples from a range of animals.

An experienced laboratory technician analyzed the two stock suspensions microscopically before mixing. This was done according to the standard operating procedures for microscopic analysis of TSO suspensions. To assess concentration, a subsample of 10μl is pipetted out onto a microscope slide and the total number of eggs in the sample is counted. This is repeated 10 times and the concentration estimate is computed as the average of the 10 counts multiplied with 100 to get the number of eggs per ml. To assess embryonation percentage, a subsample of 10μl is pipetted out onto a microscope slide and the number of embryonated eggs out of the first 100 eggs on the slide is counted. This is repeated 10 times and the emb. pct. estimate is the average of the 10 embryonation counts. It is not possible to know the true concentration and emb. pct. of an egg suspension, so the results of the experienced technician׳s microscopic assessments are the current best estimates.

The vial setup can be seen in 
                        Table 2. The mixing ratio and expected embryonation percentages were kept blinded until all analyses were carried out. The mixing ratios of all vials except vial 4 were decided up front, while the person in charge of mixing and blinding decided the ratio of vial 4 at the time of mixing.

The six vials were analyzed using microscopy by an experienced laboratory technician and using computer vision by OvaSpec. From each of the six vials, five subsamples of 80μl were analyzed using OvaSpec, each in a separate sample container well. An analysis of a single well produces 99 images, resulting in 2970 images for 30 imaged wells with five wells per vial. A second laboratory technician later annotated all images in a separate software program by assigning one of the earlier presented categories to each detected object in the images. Due to a large number of objects in the data set (43,133), this annotation process took approximately seven days.

As explained in Section 2.2, OvaSpec counts all eggs in the sample to estimate concentration and uses all lateral, singularized eggs in the sample to estimate embryonation percentage. The decision tree and embryonation classifier used in the instrument was constructed before the start of the experiment and trained on a separate training set, consisting of 594 images from six fully imaged wells. The images in the training set contain 8868 eggs of which 6538 are LS-eggs. Of these, 5223 are embryonated and 1315 are non-embryonated, resulting in an emb. pct. of 79.9%. This emb. pct. lies within the typical range of analyzed TSO suspensions.

The performance of the image analysis is evaluated by overall accuracy and other measures derived from the concentration and embryonation percentage confusion matrices. Additionally, the instrument outcomes for the 30 wells are compared to their annotations by a paired t-test. The instrument estimates of concentration and emb. pct. for six blinded vials are both compared to manual microscopy using a two-way analysis of variance with repetitions (R 3.0.2, Vienna, Austria).

@&#RESULTS@&#

The result analysis is divided into three parts. In Section 3.1, the results of a single representative well are presented and compared to its annotations. In Section 3.2, the results of all 30 wells are evaluated against their annotations, and in Section 3.3, the combined estimates of the six vials are compared to the laboratory technician׳s microscopy estimates.

The evaluation of a single sample is illustrated on well 5 from vial 6, shown in Fig. 5. The classification results for the well are summarized in a confusion matrix in 
                        Table 3. The predicted total number of eggs is 1412, while the actual total number of eggs is 1406, resulting in an error of 6 eggs or 0.4%. The 807+277=1084 predicted lateral, singularized eggs are used for assessment of embryonation percentage. It is predicted to be 74.4%, while it actually is 72.9%, resulting in an absolute error of 1.6% (percentage points) or a relative error of 2.2%. Since embryonation percentages sometimes are zero, their errors are generally expressed in absolute terms, i.e. as percentage points.

A graph of the qualitative classification of the 1084 LS-eggs is shown in 
                        Fig. 12. The classifier is a 2D linear model with the formula DFG<185.26⋅LA−158.91. The model was constructed using logistic regression on the separate training set, where a classification accuracy of 97.4% was obtained. For this well, the embryonation classification accuracy is 97.3% and the corresponding error is 2.7%. Since some false positives and false negatives cancel out, this error is, as expected, somewhat larger than the above-mentioned error on the emb. pct. estimate of 1.6%.

The confusion matrix in Table 3 can also be used to compute the classification accuracy of the egg counting. The number of false positives (non-eggs counted as eggs) is 2+5+4+1=12 and the number of false negatives (missed eggs) is 1+5=6. The accuracy of the egg counting is therefore 1−(6+12)/1406=98.7% and the corresponding error is 1.3%. Again, this error is larger than the above-mentioned egg count error of 0.4% due to negating misclassifications.

Only a small number of objects were assigned to wrong categories in the prediction, but had there for instance been some C1 objects predicted to be C4, each one of these would have counted as three false positives. Note also that the upright eggs and the C1 objects contribute equally to the egg counts, so these 24 and 2 misclassifications have no influence on the total egg count.

The resulting concentration and embryonation percentage of the 30 wells and the corresponding annotations are presented in 
                        Table 4 and graphically in 
                        Fig. 13. The vial means are plotted as red dots, and the annotations are plotted in black with the prediction deviation illustrated by a thin, black line. The orange microscopy entries in the graphs are discussed in Section 3.3.

As seen from the results, the concentration predictions agree very well with the annotations. On average, the egg count is 7.9 eggs too high out of 1430 eggs/well, so the concentration estimates are on average 0.6% higher than the annotations. All six concentration estimates are within 0.9% of the annotations. A paired t-test of the 30 pairs show that this positive bias is highly significant (p<0.001), although small (100eggs/ml or 0.6%).

Embryonation percentage estimates are on average 0.1 percentage points lower than the annotations, and all six emb. pct. estimates are within 0.8 pct. points of the annotations. A paired t-test of the individual well differences show that the small embryonation differences are not significant (p=0.67). Vial 5 was excluded since the distribution cannot be considered normal close to zero.

The concentration assessment achieves an overall accuracy of 98%, sensitivity of 99%, specificity of 87%, and Matthews correlation coefficient (MCC) [31,32] of 0.89. The embryonation percentage assessment achieves an overall accuracy of 98%, sensitivity of 98%, specificity of 99%, and MCC of 0.96. Both of these assessments are in very high agreement with the annotations, which indicates that the variability between samples from the same vial comes from the sampling rather than the analysis.

When comparing concentration variability of the two methods (Fig. 13 and Table 4), it should be taken into account that fewer samples from each suspension are analyzed by OvaSpec than by manual microscopy (5 vs. 10), although each sample is larger (80 vs. 10μl). So instead of comparing the relative standard deviation directly (3.4% vs. 7.6%), a more appropriate comparison is between relative standard errors of the mean (1.5% vs. 2.4%) or between the half width of 95%-confidence intervals of the mean (5.2% vs. 6.5%). In any case, the concentration variability of the instrument is seen to be lower than that of the manual microscopy, although only moderately, even with only half the number of samples analyzed. Additionally, the deterministic nature of the automated analysis greatly reduces the influence of inter-operator variability.

Since the largest variance is associated with the largest group size (microscopy), the violation of the homogeneity of variance assumption of ANOVA is somewhat mitigated, so a regular two-way ANOVA with repetitions is used to analyze concentration vs. vial and method at a 5% significance level. No significant interaction effects are present (p=0.892), so this term is removed from the model. The vial effects (mean 2%, max 6%) are not significant (p=0.117), and the method effect of 1% is not significant either (p=0.488), so it is concluded that the instrument׳s concentration assessment is in agreement with the microscopic assessment.

Comparison of embryonation percentage variability of the instrument and microscopy has the same issues as the concentration with unequal variability (SD of 1.7 vs. 3.5 pct. points) and unequal sample sizes. But with more similar SEs (0.8 vs. 1.1) and half confidence interval widths (2.7 vs. 3.0), the situation is the close to the above. Within each vial (excluding vial 5 like the previous section), the data appears normally distributed, so a similar two-way ANOVA is applied with vial 5 excluded. It shows that the vial effect is highly significant (p<0.001) as expected, and that the method effect is not significant (p=0.283). So also here the instrument is in agreement with the manual microscopy and has moderately lower variability.

@&#DISCUSSION@&#

As evident from Table 4 and Fig. 13, both the concentration and the embryonation percentage estimates are very accurate, each being within 1% of the annotations. As mentioned earlier, an estimate is the average of five analyzed samples from a given egg suspension. Individual sample results differ on average 0.6% but up to 1.8% for concentration and on average 0.1 pct. points but up to 3.9 pct. points for embryonation.

For the concentration, a small but highly significant positive bias is observed, averaging at 0.6%. This primarily stems from the C0–C1 decision regarding the remaining “small” objects (see Table 1), where irregular and impurity-touching eggs are sought separated from egg-sized impurities. The addition of texture features might reduce the number of misclassifications at this step. Egg-sized impurities clumping with actual eggs also contribute to the counting bias, so additional processing of these could help as well, e.g. by template matching [33] as mentioned earlier or by clump splitting [34–36] followed by additional shape characterization.

The incentive to develop OvaSpec was the lack of automated and objective systems for assessing concentration and embryonation percentage of helminth egg suspensions. In spite of this, it is of interest to compare the egg detection step of OvaSpec to other systems that include egg detection. The presented detection accuracy of 98% clearly outperforms the 86.1% achieved using artificial neural networks (ANN) by Yang et al. [12], although part of the difference stems from the higher purity of the egg suspensions analyzed in the present study. In the work by Suzuki et al. [17,18], the segmentation results are evaluated using a maximum error criterion expressing that 99.1% of the parasite eggs have a pixel-wise segmentation error below 0.35 [17]. The reported diagnostic accuracies of 90% [12], 97.7% [14], 93.5% [15], and 98.2% [17] are not directly comparable with the achieved embryonation assessment accuracy of 98% due to the difference in objective.

Modifications to the image analysis routines are needed if other species of eggs are to be analyzed or distinguished by OvaSpec, but no changes in hardware or to the image acquisition routines are required.

The lack of a known “true” value of the suspension concentration and the destructive sampling process pose a challenge when comparing methods for concentration assessment. Small variations in sampling between the instrument operator and the laboratory technician performing the microscopy could easily induce a bias, despite the employed measures for reducing this effect such as standardized shaking before sampling, electronic pipetting etc.

Compared with manual microscopy, the instrument׳s concentration estimates are on average 1.0% lower, but this difference is neither consistent nor statistically significant, given the variability of the samples. It is seen from the concentration annotations in Fig. 13 (left) that the sampling variability clearly exceeds the uncertainty on the individual concentration estimates, so reducing this variability might actually be more important than improving the classification algorithms.

Beside the employed variability-reducing measures, a way to counteract the sampling variability is to analyze more samples. This is a trade-off with analysis time. The current analysis time is 15min/sample, of which the vast majority is spent on image acquisition, especially the acquisition of local z-stacks during autofocusing at the 99 positions. Maintaining spatial and temporal focus of microscopic specimens in a liquid suspension is a difficult task, so the proposed local autofocusing is one possible compromise for solving it. The optimal focus distribution is observed to vary non-linearly and non-radially inside the wells, but could potentially be modeled if analyzed further in order to eliminate the local autofocusing and reduce analysis time as done for linear focus variations in the latest work by Suzuki et al. [18].

Another option to reduce the acquisition time would be to employ a smaller sample container. The replacement should be flat-bottomed and transparent, have a diameter smaller than 7mm, allow for near-uniform darkfield illumination, and should possibly be disposable to prevent cross-contamination, which in combination turned out to be difficult to find. So improving the autofocusing and image acquisition is more likely the way to proceed.

For the embryonation percentage assessment, no consistent bias is observed, although the variability seems to increase a bit with the emb. pct. Combined with the nearly perfect classification of the undifferentiated eggs of the non-incubated egg suspension (vial 5), this indicates that it is the degenerated eggs and not the non-incubated eggs with completely undifferentiated contents that pose a challenge for the classification, so these should be the focus of future work. Examples of these can be seen in Fig. 9.

The embryonation percentages are assessed based on the LS-eggs, which constitute around 76% (±1.3%) of the eggs in the well, averaging at 1090 LS-eggs. Interestingly, despite analyzing over a 1000 eggs/well, samples from the same suspension still differ in annotated embryonation percentage by up to 4.5 percentage points and predicted embryonation percentage by up to 6.7 percentage points.

It is currently not known if it is the homogeneous structure of the non-embryonated egg internals or some kind of chemical components that cause the darkfield glow only in non-embryonated eggs. But in combination with the proposed quantification of larval structures, it enables an intuitive and effective classification of the eggs as seen in Fig. 12 without the need for opaque machine learning techniques such as artificial neural networks (ANNs) or support vector machines (SVMs).

The assessment of concentration and embryonation percentage represent two quite different problems, each imposing a separate set of requirements on an automated measurement system, so the instrument׳s ability to assess both of these simultaneously in an objective manner is a clear advantage over traditional manual and automated techniques.

All embryonated eggs in the blinded experiment came from a single incubated stock suspension, so in order to validate OvaSpec׳s performance and robustness on eggs with additional biological variation, more diverse egg suspensions should be analyzed in future studies. Utilizing the presented multispectral vision platform it would also be of interest to further characterize or classify the impurities encountered in the suspension based on morphology and spectral characteristics. Finally, it would be of interest to investigate the connection between eggs with uncompleted development or early visual signs of degeneration and the biological potency of the eggs.

@&#CONCLUSION@&#

A novel computer vision instrument has been developed for quantitative and qualitative analysis of T. suis egg suspensions. Several challenges were addressed, including preparation, presentation, and illumination of samples, as well as autofocused image acquisition that allow for both detailed analysis of individual eggs׳ development as well as full egg counts to determine concentration. The core image analysis and classification system is based on morphological and spectral features and shows solid results on a large, annotated dataset of 2970 images containing 42,894 T. suis eggs. The results were also shown to agree with established microscopic assessment over which the instrument possesses many advantages including objectivity, scalability, and higher precision. The presented work clearly demonstrates the applicability of computer vision in the production, analysis, and quality control of T. suis eggs for helminthic therapy, and serves as inspiration for related vision-based instruments and applications.

The development of the OvaSpec instrument has been financed and facilitated by Parasite Technologies A/S as part of an Industrial Ph.D. collaboration, who also supplied egg suspensions for the experiments. J.M. Bruun, A. Roepstorff, and C.M.O. Kapel are employees of Parasite Technologies A/S and J.M. Carstensen is an employee of Videometer A/S, Hørsholm, Denmark. The Danish Agency for Science, Technology and Innovation played no role in the study design or the collection or analysis of data.

@&#ACKNOWLEDGMENTS@&#

The authors would like to thank laboratory technicians Charlotte Fischer and Niels Peter Hansen for assistance with annotations and microscopic counting, as well as the engineers from Videometer for valuable technical guidance. The Danish Agency for Science, Technology and Innovation is thanked for the Grant (No. 10-078150).

@&#REFERENCES@&#

