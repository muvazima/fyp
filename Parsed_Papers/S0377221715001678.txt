@&#MAIN-TITLE@&#Accommodating heterogeneity and nonlinearity in price effects for predicting brand sales and profits

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           We propose a sales response model that accounts for heterogeneity and nonlinearity.


                        
                        
                           
                           Our model shows a higher predictive performance relative to benchmark models.


                        
                        
                           
                           Prediction improvements from accommodating heterogeneity alone turn out very small.


                        
                        
                           
                           Addressing nonlinearity and heterogeneity can markedly improve predictive validity.


                        
                        
                           
                           The new model leads to higher expected profits and different pricing implications.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Forecasting

Sales response modeling

Heterogeneity

Functional flexibility

Expected profits

@&#ABSTRACT@&#


               
               
                  We propose a hierarchical Bayesian semiparametric approach to account simultaneously for heterogeneity and functional flexibility in store sales models. To estimate own- and cross-price response flexibly, a Bayesian version of P-splines is used. Heterogeneity across stores is accommodated by embedding the semiparametric model into a hierarchical Bayesian framework that yields store-specific own- and cross-price response curves. More specifically, we propose multiplicative store-specific random effects that scale the nonlinear price curves while their overall shape is preserved. Estimation is fully Bayesian and based on novel MCMC techniques. In an empirical study, we demonstrate a higher predictive performance of our new flexible heterogeneous model over competing models that capture heterogeneity or functional flexibility only (or neither of them) for nearly all brands analyzed. In particular, allowing for heterogeneity in addition to functional flexibility can improve the predictive performance of a store sales model considerably, while incorporating heterogeneity alone only moderately improved or even decreased predictive validity. Taking into account model uncertainty, we show that the proposed model leads to higher expected profits as well as to materially different pricing recommendations.
               
            

In recent years, two streams of research for estimating sales response models based on store-level data have evolved: on the one hand, researchers have proposed hierarchical Bayesian (HB) store sales models allowing for heterogeneity of marketing effects across stores (e.g., Andrews, Currim, Leeflang, & Lim, 2008; Blattberg & George, 1991; Boatwright, McCulloch, & Rossi, 1999; Hruschka, 2006b; Montgomery, 1997; Montgomery & Rossi, 1999). While some of these studies have shown that considering heterogeneity can improve model fit, the accuracy of sales forecasts, or expected profits (e.g., Hruschka, 2006b; Montgomery, 1997), recent research of Andrews et al. (2008) has demonstrated rather marginal improvements in fit and predictive performance from incorporating store heterogeneity. One possible reason for this latter finding is that the HB models mentioned above assume a strictly parametric functional form thereby limiting the scope for model calibration to an a priori fixed parametrization. Hence, although accounting for heterogeneity, a source of bias remains if the assumed parametric form differs from the true underlying function.

On the other hand, researchers have proposed nonparametric regression models in order to accommodate potential nonlinearities in store sales response (e.g., Brezger & Steiner, 2008; Haupt, Kagerer, & Steiner, 2014; van Heerde, Leeflang, & Wittink, 2001; Kalyanam & Shively, 1998; Steiner, Brezger, & Belitz, 2007). The empirical results of this second stream indicate that own- and cross-price effects may show complex nonlinearities which are difficult or not at all to capture by parametric models. The main potential weakness of this second group of nonparametric approaches, however, is that heterogeneity across stores has not been considered. Consequently, bias due to potential heterogeneity across stores here remains.

There is so far only one approach that has consolidated the two streams: Hruschka (2006a, 2007) proposed a hierarchical Bayesian multilayer perceptron (MLP) that allows for nonlinearity in price effects and yields store-specific coefficients. In an empirical study, his flexible heterogenous MLP turned out to be superior in terms of posterior model probability (Hruschka, 2006a) and further with respect to predictive validity (Hruschka, 2007) compared to a heterogeneous parametric multiplicative model, respectively. In addition, Hruschka (2007) analyzed profit implications for the flexible heterogeneous MLP from a retailer’s point of view. Specifically, he shows that taking menu costs into account a moderately risk averse retailer may prefer a clusterwise pricing strategy to a store-specific pricing strategy. If menu costs are ignored, expected profits however increase with the number of clusters and reach their maximum for a store-specific pricing strategy.
                        3
                     
                     
                        3
                        The advantages of using nonparametric or seminonparametric techniques for estimating response functions were demonstrated previously by Hruschka in the context of market share modeling (Hruschka, 2002), brand choice modeling (Hruschka, Fettes, & Probst, 2004) and catalog allocation modeling (Baumgartner & Hruschka, 2005), too.
                      Our approach proposed here differs from that of Hruschka (2006a, 2007) in several ways: First, we will show that accounting for store heterogeneity alone might not be advantageous per se (as is assumed by Hruschka), and that accounting for functional flexibility is the primary driver for model improvement (at least for our data). In particular, we find that allowing for heterogeneity in addition to functional flexibility can improve the predictive performance of a store sales model considerably, while incorporating heterogeneity alone only moderately improves or even decreases predictive validity. Second, we illustrate why accommodating store heterogeneity may pay off only once nonlinearity in price response is modeled appropriately. And third, we compare our flexible heterogeneous model in terms of expected profits to competing models that capture heterogeneity or functional flexibility only (or neither of them). This way, we investigate how much loss in expected profits management incurs by not using the model with the highest predictive performance.

In the following, we develop a store sales model which accommodates both functional flexibility and heterogeneity within a unified regression framework. We propose a structured additive approach where own- and cross-price response is estimated flexibly using P-splines, while heterogeneity in price response across stores is simultaneously accommodated by multiplicative store-specific random effects that scale the nonlinear price curves while their overall shape is preserved.

The rest of the paper is organized as follows. In Section 2, we introduce our hierarchical Bayesian semiparametric model. Using store-level data from Dominick’s Finer Foods we analyze in Section 3 whether, how much, and why the performance of a store sales model can be improved from considering either heterogeneity, functional flexibility, or both features. Our results indicate that the most complex model accommodating both heterogeneity and functional flexibility outperforms competing models in predictive validity for most brands, and provides substantial increases in expected profits for those brands. We further show that the proposed model leads to materially different pricing implications. We conclude in Section 4 with an outlook on future research perspectives.

To model store sales response, we use weekly store-level scanner data for eight brands of orange juice offered by Dominick’s Finer Foods (DFF), a major supermarket chain in the Chicago metropolitan area. The data were provided by the James M. Kilts Center, GSB, University of Chicago, and include unit sales (Qst
                        ), price (pricest
                        ) and a deal code indicating the use of a display (displayst
                        ) for each of the eight brands in each of 
                           
                              s
                              =
                              1
                              ,
                              ⋯
                              ,
                              81
                           
                         stores of the chain over a time horizon of 
                           
                              t
                              =
                              1
                              ,
                              ⋯
                              ,
                              89
                           
                         weeks (resulting in about 7,000 data points per brand). The price data further reveal whether a 9- or 99-ending price (end9
                           st
                        , end99
                           st
                        ) has been set. The brands can be grouped into three price-quality tiers: the premium brands which are made from freshly squeezed oranges, the national brands which are reconstituted from frozen orange juice concentrate, and the retailer’s own store brand. Table 1 provides summary statistics pooled across stores for weekly prices, market shares and unit sales of the individual brands.

Since cross-item price effects are usually much weaker than own-item price effects (e.g., see Hanssens, Parsons, & Schultz, 2003), we capture them in our demand equation in a more parsimonious way at the tier level. Following Brezger and Steiner (2008), we define 
                           
                              p
                              r
                              i
                              c
                              e
                              _
                              n
                              a
                              t
                              i
                              o
                              n
                              a
                              
                                 l
                                 
                                    s
                                    t
                                 
                              
                           
                         (
                           
                              p
                              r
                              i
                              c
                              e
                              _
                              p
                              r
                              e
                              m
                              i
                              u
                              
                                 m
                                 
                                    s
                                    t
                                 
                              
                           
                        ) as the lowest price of a competing national (premium) brand in store s and week t. For example, if a store sales model is estimated for the national brand Citrus Hill, 
                           
                              p
                              r
                              i
                              c
                              e
                              _
                              n
                              a
                              t
                              i
                              o
                              n
                              a
                              
                                 l
                                 
                                    s
                                    t
                                 
                              
                           
                         captures the lowest price level of either of the other national brands in store s and week t.
                           4
                        
                        
                           4
                           Note that for the computation of 
                                 
                                    p
                                    r
                                    i
                                    c
                                    e
                                    _
                                    n
                                    a
                                    t
                                    i
                                    o
                                    n
                                    a
                                    
                                       l
                                       
                                          s
                                          t
                                       
                                    
                                    ,
                                 
                               we consider Sunny Delight as another national brand in the refrigerated orange juice category. However, we did not estimate store sales models for Sunny Delight due to the lack of (substantial) price variation of this brand.
                        
                        
                           
                              p
                              r
                              i
                              c
                              e
                              _
                              d
                              o
                              m
                              i
                              n
                              i
                              c
                              k
                              
                                 s
                                 
                                    s
                                    t
                                 
                              
                           
                         denotes the observed price for Dominick’s, the only private label brand in our data.

We further use 11 characteristics (collected in the vector 
                           v
                        
                        
                           s
                        ) of each store’s trading area to explain possible store-level variation in price response due to sociodemographic and competitive effects. A detailed description of these background covariates (among others relating to age, education, family size, income, distances to nearest competing supermarkets or warehouses) can be found in Hoch, Kim, Montgomery, and Rossi (1995).

To make sure that our results are not driven by a few outliers, we did not consider the following observations in the subsequent analysis: pricest
                         < 1.50 for Florida Natural (4 observations); pricest
                         < 1.40 for Tropicana SB (3 observations); 
                           
                              p
                              r
                              i
                              c
                              e
                              _
                              n
                              a
                              t
                              i
                              o
                              n
                              a
                              
                                 l
                                 
                                    s
                                    t
                                 
                              
                              <
                              1.50
                           
                         when modeling sales for Tropicana Pure (4 observations); 
                           
                              p
                              r
                              i
                              c
                              e
                              _
                              n
                              a
                              t
                              i
                              o
                              n
                              a
                              
                                 l
                                 
                                    s
                                    t
                                 
                              
                              >
                              3.20
                           
                         (6 observations) when modeling sales for Citrus Hill, Florida Gold, Dominick’s, Minute Maid, Tree Fresh, and Tropicana SB.

We propose the following additive model with multiplicative random effects

                           
                              (1)
                              
                                 
                                    
                                       
                                          
                                             l
                                             n
                                             
                                             
                                                Q
                                                
                                                   s
                                                   t
                                                
                                             
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             
                                                η
                                                
                                                   s
                                                   t
                                                
                                             
                                             +
                                             
                                                
                                                   ɛ
                                                
                                                
                                                   s
                                                   t
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                          =
                                       
                                       
                                          
                                             
                                                f
                                                0
                                             
                                             
                                                (
                                                
                                                   m
                                                   t
                                                
                                                )
                                             
                                             +
                                             
                                                (
                                                1
                                                +
                                                
                                                   α
                                                   
                                                      s
                                                      1
                                                   
                                                
                                                )
                                             
                                             
                                                f
                                                1
                                             
                                             
                                                (
                                                p
                                                r
                                                i
                                                c
                                                
                                                   e
                                                   
                                                      s
                                                      t
                                                   
                                                
                                                )
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             +
                                             
                                             
                                                (
                                                1
                                                +
                                                
                                                   α
                                                   
                                                      s
                                                      2
                                                   
                                                
                                                )
                                             
                                             
                                             
                                                f
                                                2
                                             
                                             
                                                (
                                                p
                                                r
                                                i
                                                c
                                                e
                                                _
                                                p
                                                r
                                                e
                                                m
                                                i
                                                u
                                                
                                                   m
                                                   
                                                      s
                                                      t
                                                   
                                                
                                                )
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             +
                                             
                                             
                                                (
                                                1
                                                +
                                                
                                                   α
                                                   
                                                      s
                                                      3
                                                   
                                                
                                                )
                                             
                                             
                                             
                                                f
                                                3
                                             
                                             
                                                (
                                                p
                                                r
                                                i
                                                c
                                                e
                                                _
                                                n
                                                a
                                                t
                                                i
                                                o
                                                n
                                                a
                                                
                                                   l
                                                   
                                                      s
                                                      t
                                                   
                                                
                                                )
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                       
                                          
                                             +
                                             
                                             
                                                (
                                                1
                                                +
                                                
                                                   α
                                                   
                                                      s
                                                      4
                                                   
                                                
                                                )
                                             
                                             
                                             
                                                f
                                                4
                                             
                                             
                                                (
                                                p
                                                r
                                                i
                                                c
                                                e
                                                _
                                                d
                                                o
                                                m
                                                i
                                                n
                                                i
                                                c
                                                k
                                                
                                                   s
                                                   
                                                      s
                                                      t
                                                   
                                                
                                                )
                                             
                                             +
                                             
                                             
                                                x
                                                
                                                   s
                                                   t
                                                
                                                ′
                                             
                                             
                                                
                                                   γ
                                                
                                                s
                                             
                                             +
                                             
                                                
                                                   ɛ
                                                
                                                
                                                   s
                                                   t
                                                
                                             
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                        where

                           
                              •
                              
                                 f
                                 0 is an unknown smooth nonlinear time trend of month mt
                                  of the year;


                                 f
                                 1 is an unknown smooth nonlinear decreasing function of the brand’s own price (pricest
                                 ), and f
                                 2, f
                                 3, f
                                 4 are unknown smooth nonlinear increasing functions for cross-price effects captured at the tier level;


                                 
                                    
                                       1
                                       +
                                       
                                          α
                                          
                                             s
                                             1
                                          
                                       
                                       ,
                                       ⋯
                                       ,
                                       1
                                       +
                                       
                                          α
                                          
                                             s
                                             4
                                          
                                       
                                    
                                  are store-specific scaling factors accommodating heterogeneity of the nonparametric own- and cross-item price effects across stores (while the overall functional forms remain constant from store to store);


                                 
                                    
                                       
                                          x
                                          
                                             s
                                             t
                                          
                                          ′
                                       
                                       
                                          
                                             γ
                                          
                                          s
                                       
                                    
                                  comprises a store-specific random intercept γ
                                 
                                    s0 and store-specific random slopes 
                                    
                                       
                                          γ
                                          
                                             s
                                             1
                                          
                                       
                                       ,
                                       ⋯
                                       ,
                                       
                                          γ
                                          
                                             s
                                             3
                                          
                                       
                                    
                                  of the own-item dummy variables displayst, end9st
                                  and end99st
                                  indicating the use of a display and/or of price levels ending in ‘9’ or ‘99’ (yes = 1/no = 0);

ɛ
                                    st
                                  ∼ N(0, σ
                                 2) is an i.i.d Gaussian error term with mean zero and variance σ
                                 2.

Note that the term 
                           
                              
                                 (
                                 1
                                 +
                                 
                                    α
                                    
                                       s
                                       1
                                    
                                 
                                 )
                              
                              
                                 f
                                 1
                              
                              
                                 (
                                 p
                                 r
                                 i
                                 c
                                 
                                    e
                                    
                                       s
                                       t
                                    
                                 
                                 )
                              
                           
                         (and the analogous terms for cross price effects) is a direct generalization of traditional random slopes which are obtained as a special case if f
                        1 is linear.
                           5
                        
                        
                           5
                           Writing 
                                 
                                    1
                                    +
                                    
                                       α
                                       
                                          s
                                          
                                          j
                                       
                                    
                                 
                               instead of α
                              
                                 s 
                                 j
                               directly indicates the nested structure of our model framework for competing models with vs. without heterogeneity. If there is no heterogeneity across stores, the term α
                              
                                 s 
                                 j
                               completely drops out of the model (i.e., 
                                 
                                    
                                       α
                                       
                                          s
                                          
                                          j
                                       
                                    
                                    =
                                    0
                                 
                              ), and the additive model with multiplicative random effects reduces to an additive model with equal own- and cross-item price effects across stores.
                        
                     

The store-specific scaling factors 
                           
                              
                                 α
                                 
                                    s
                                    1
                                 
                              
                              ,
                              ⋯
                              ,
                              
                                 α
                                 
                                    s
                                    4
                                 
                              
                           
                         are parametrized as additive models, too:

                           
                              (2)
                              
                                 
                                    
                                       
                                          
                                             α
                                             
                                                s
                                                
                                                j
                                             
                                          
                                       
                                       
                                          =
                                       
                                       
                                          
                                             
                                                f
                                                
                                                   j
                                                   1
                                                
                                             
                                             
                                                (
                                                
                                                   v
                                                   
                                                      s
                                                      1
                                                   
                                                
                                                )
                                             
                                             +
                                             ⋯
                                             +
                                             
                                                f
                                                
                                                   j
                                                   11
                                                
                                             
                                             
                                                (
                                                
                                                   v
                                                   
                                                      s
                                                      11
                                                   
                                                
                                                )
                                             
                                             +
                                             
                                                u
                                                
                                                   s
                                                   
                                                   j
                                                
                                             
                                             ,
                                             
                                             s
                                             =
                                             1
                                             ,
                                             ⋯
                                             ,
                                             81
                                             ,
                                          
                                       
                                    
                                    
                                       
                                          j
                                       
                                       
                                          =
                                       
                                       
                                          
                                             1
                                             ,
                                             ⋯
                                             ,
                                             4
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                        where 
                           
                              
                                 f
                                 
                                    j
                                    1
                                 
                              
                              ,
                              ⋯
                              ,
                              
                                 f
                                 
                                    j
                                    11
                                 
                              
                           
                         are unknown smooth nonlinear functions of the 11 store-specific sociodemographic and competitive covariates 
                           v
                        
                        
                           s
                         that may affect the scaling of the own- and cross-item price response curves, respectively. An increasing effect fjr
                         of a particular covariate vsr
                         in 
                           v
                        
                        
                           s
                         causes an overall increase of the scaling factor 
                           
                              1
                              +
                              
                                 α
                                 
                                    s
                                    
                                    j
                                 
                              
                              ,
                           
                         leading to an increased (cross) price sensitivity, i.e. to a steeper (cross) price response curve. 
                           
                              
                                 u
                                 
                                    s
                                    
                                    j
                                 
                              
                              
                                 ∼
                                 
                                    i
                                    .
                                    i
                                    .
                                    d
                                    .
                                 
                              
                              N
                              
                                 (
                                 0
                                 ,
                                 
                                    σ
                                    j
                                    2
                                 
                                 )
                              
                           
                         is a Gaussian random effect that models unobserved store-specific heterogeneity not accounted for by available covariates.

The nonlinear functions fj
                         of the first stage as well as the functions fjr
                        , 
                           
                              j
                              =
                              1
                              ,
                              ⋯
                              ,
                              4
                              ,
                           
                        
                        
                           
                              r
                              =
                              1
                              ,
                              ⋯
                              ,
                              11
                              ,
                           
                         with respect to the scaling factors are modeled by Bayesian P(enalized)-splines introduced by Lang and Brezger (2004). To obtain monotonically decreasing (increasing) functions for own (cross) price response we follow the approach proposed by Brezger and Steiner (2008).
                           6
                        
                        
                           6
                           Imposing monotonicity on flexibly estimated price effects is motivated from an economic point of view (e.g., see Rao, 1993) and not necessary for established parametric price response models which are inherently monotonic.
                         We choose P-splines as compared to other flexible estimation techniques like MLPs or support vector machines as P-splines and random effects models are conceptually close. In fact, P-splines can be seen as a special case of the general class of mixed models. The close connection between the various model parts greatly enhance model estimation, implementation and in particular Bayesian inference via MCMC.

Finally, it would also be possible to additionally model the random store intercept γ
                        
                           s0 and/or the store-specific random slopes 
                           
                              
                                 γ
                                 
                                    s
                                    1
                                 
                              
                              ,
                              …
                              ,
                              
                                 γ
                                 
                                    s
                                    3
                                 
                              
                           
                         in the parametric part of the model as to depend on background covariates according to Eq. (2). If not, as we basically assume in the following, 
                           
                              
                                 γ
                                 
                                    s
                                    0
                                 
                              
                              
                                 ∼
                                 
                                    i
                                    .
                                    i
                                    .
                                    d
                                    .
                                 
                              
                              N
                              
                                 (
                                 0
                                 ,
                                 
                                    σ
                                    
                                       γ
                                       0
                                    
                                    2
                                 
                                 )
                              
                           
                         and 
                           
                              
                                 γ
                                 
                                    s
                                    r
                                 
                              
                              
                                 ∼
                                 
                                    i
                                    .
                                    i
                                    .
                                    d
                                    .
                                 
                              
                              N
                              
                                 (
                                 
                                    
                                       γ
                                       ˜
                                    
                                    r
                                 
                                 ,
                                 
                                    σ
                                    
                                       γ
                                       r
                                    
                                    2
                                 
                                 )
                              
                              ,
                           
                        
                        
                           
                              r
                              =
                              1
                              ,
                              2
                              ,
                              3
                              ,
                           
                         where 
                           
                              
                                 γ
                                 ˜
                              
                              r
                           
                         are fixed mean effects with noninformative priors 
                           
                              p
                              (
                              
                                 
                                    γ
                                    ˜
                                 
                                 r
                              
                              )
                              ∝
                              const
                           
                        .

Estimation of the model is fully Bayesian using a Gibbs sampler to draw samples from the posterior. While the Gibbs steps to update the random effects γsr
                         and also the nonlinear functions fjr
                         in (2) are standard (see e.g. Lang, Umlauf, Wechselberger, Hartgen, & Kneib, 2014, in the context of our modeling framework), updates of the parameters for the nonlinear price functions with store-specific scaling factors are new and therefore fully described in the appendix. An implementation of our model for an arbitrary number of nonlinear price effects, usual random and fixed effects is provided in the software BayesX (Brezger, Kneib, & Lang, 2005), see also the R interface R2BayesX (Zeileis, Lang, Kneib, Adler, & Umlauf, 2015).
                           7
                        
                        
                           7
                           The software BayesX is available free of charge at http://www.stat.uni-muenchen.de/~bayesx/bayesx.html. To the best of our knowledge, the type of analysis in our paper is currently not possible with other existing software.
                        
                     

In the following, we refer to the most complex model (1) with multiplicative random effects (2) and nonlinear effects of the sociodemographic and competitive variables as extended flexible heterogeneous store sales model (EFHetM). To provide benchmarks for its performance, we compare it in our empirical application to several other models (nested in EFHetM):

                           
                              (a)
                              a flexible heterogeneous model (EFHetM2) where background effects are captured more parsimoniously by replacing the unknown smooth nonlinear functions in (2) by simple parametric effects of the store-specific covariates;

a flexible heterogeneous model (FHetM) which accounts for unobserved heterogeneity only (i.e., not considering sociodemographic and competitive store characteristics);

a flexible homogeneous model (FHomM) that accommodates functional flexibility in price response but does not account for heterogeneity in marketing effects across stores, i.e. setting 
                                    
                                       
                                          α
                                          
                                             s
                                             
                                             j
                                          
                                       
                                       =
                                       0
                                       ,
                                    
                                 
                                 
                                    
                                       j
                                       =
                                       1
                                       ,
                                       ⋯
                                       ,
                                       4
                                       ,
                                    
                                  and 
                                    
                                       
                                          γ
                                          
                                             s
                                             r
                                          
                                       
                                       =
                                       
                                          
                                             γ
                                             ˜
                                          
                                          r
                                       
                                       ,
                                    
                                 
                                 
                                    
                                       r
                                       =
                                       1
                                       ,
                                       ⋯
                                       ,
                                       3
                                       ,
                                    
                                  in Eq. (1);

a parametric heterogeneous model (PHetM) that accommodates heterogeneity across stores but (except for the seasonal effect) does not account for functional flexibility, i.e. the unknown smooth price functions in Eq. (1) are replaced by parametric linear effects;

a parametric homogeneous model (PHomM) that neither accounts for heterogeneity in marketing effects across stores nor for functional flexibility in price response.

The parametric models are specified either as multiplicative or exponential models (e.g., Montgomery, 1997; Andrews et al., 2008). Since the exponential model turned out to be inferior we restrict the following discussion to the multiplicative model. Note that the random store intercept is kept in all model versions to account for differences in baseline sales across stores. Also, we keep the nonlinear time trend in all models to enable a fair model comparison.

We compare the performance of the different models with respect to forecasting accuracy as well as profit and pricing implications. Based on a nine-fold cross-validation, predictive performance is assessed in terms of the Average Root Mean Squared Sales Prediction Error (ARMSE) in holdout samples (e.g., Brezger & Steiner, 2008; van Heerde et al., 2001). Conditional mean predictions for a brand’s unit sales from the estimated log-normal models were obtained as 
                           
                              
                                 
                                    Q
                                    ^
                                 
                                 
                                    s
                                    t
                                 
                              
                              =
                              exp
                              
                                 (
                                 
                                    
                                       η
                                       ^
                                    
                                    
                                       s
                                       t
                                    
                                 
                                 +
                                 
                                    
                                       σ
                                       ^
                                    
                                    2
                                 
                                 /
                                 2
                                 )
                              
                              ,
                           
                         where 
                           
                              
                                 η
                                 ^
                              
                              
                                 s
                                 t
                              
                           
                         is the estimated predictor and 
                           
                              
                                 σ
                                 ^
                              
                              2
                           
                         denotes the overall error variance of the respective log-normal model. By eliminating the few outliers as noted in Section 2.1, we stay conservative in evaluating the predictive performance of the flexible models against the strictly parametric models. As P-splines in general react on outliers only locally while parametric models are globally affected, leaving outliers in our data would favour the flexible models.
                           8
                        
                        
                           8
                           
                              Azme, Zuhaimy, Khalid, and Ahmad (2005) have shown that MLPs behave similarly robust against outliers both in estimation and validation samples, as far as the number of outliers in the data is moderate.
                         Additionally, we assessed model fit by the deviance information criterion (DIC), one of the most widely used criteria for model selection in hierarchical Bayesian models (Spiegelhalter, Best, Carlin, & van der Linde, 2002). Since the results based on the DIC closely resemble those on ARMSE we restrain in the following from presenting and discussing DIC measures.

To explore more formally the economic pricing implications of the competing models we assume that management wants to maximize the chain-level profit Πt
                         of a brand in each week t over a given time span 
                           
                              t
                              =
                              1
                              ,
                              ⋯
                              ,
                              T
                           
                         (e.g., Hruschka, 2006b):

                           
                              (3)
                              
                                 
                                    
                                       Π
                                       t
                                    
                                    =
                                    
                                       ∑
                                       
                                          s
                                          =
                                          1
                                       
                                       S
                                    
                                    
                                       (
                                       p
                                       r
                                       i
                                       c
                                       
                                          e
                                          
                                             s
                                             t
                                          
                                       
                                       −
                                       
                                          c
                                          t
                                       
                                       )
                                    
                                    
                                       Q
                                       
                                          s
                                          t
                                       
                                    
                                    ,
                                    
                                    t
                                    =
                                    1
                                    ,
                                    ⋯
                                    ,
                                    T
                                    ,
                                 
                              
                           
                        where ct
                         is the retailer’s variable unit cost of the brand in week t
                        
                           9
                        
                        
                           9
                           Unit cost information is available in the data base. For all brands, unit costs differ across periods.
                        . We follow the concept of fictitious play (Brown, 1951) and search for optimal prices 
                           
                              p
                              r
                              i
                              c
                              
                                 e
                                 
                                    s
                                    t
                                 
                                 *
                              
                           
                         of a brand given the observed promotional and competitive pricing scenario in store s and week t. Accordingly, management plans to set future prices for competing brands with frequencies as observed in the past 
                           
                              t
                              =
                              1
                              ,
                              ⋯
                              ,
                              89
                           
                         weeks. As usual, prices are further optimized conditional on a fixed promotional calendar (e.g., Chintagunta, Dube, & Singh, 2003; Kim, Blattberg, & Rossi, 1995), relating to the use of displays in our data.

Optimal prices in week t are determined by an explicit enumeration of all possible price levels within the observed price range of the brand considered (i.e., searching in 1 cent steps). To account for model uncertainty, expected profits in week t are computed as the arithmetic mean across J Gibbs draws of estimated coefficients (e.g., Montgomery, 1997; Hruschka, 2006b)

                           
                              (4)
                              
                                 
                                    E
                                    
                                       [
                                       
                                          Π
                                          t
                                       
                                       ]
                                    
                                    =
                                    
                                       1
                                       J
                                    
                                    
                                       ∑
                                       
                                          j
                                          =
                                          1
                                       
                                       J
                                    
                                    
                                       ∑
                                       
                                          s
                                          =
                                          1
                                       
                                       81
                                    
                                    
                                       (
                                       p
                                       r
                                       i
                                       c
                                       
                                          e
                                          
                                             s
                                             t
                                          
                                       
                                       −
                                       
                                          c
                                          t
                                       
                                       )
                                    
                                    
                                       
                                          Q
                                          ^
                                       
                                       
                                          s
                                          t
                                       
                                       j
                                    
                                    ,
                                 
                              
                           
                        where 
                           
                              
                                 Q
                                 ^
                              
                              
                                 s
                                 t
                              
                              j
                           
                         denotes the predicted unit sales of the brand in store s and week t evaluated for the sample of coefficients drawn in iteration j of our Gibbs sampler (after the burn-in phase). Finally, total expected chain profit for the brand is obtained by summing over weeks 
                           
                              t
                              =
                              1
                              ,
                              ⋯
                              ,
                              89
                           
                        :

                           
                              (5)
                              
                                 
                                    E
                                    
                                       [
                                       Π
                                       ]
                                    
                                    =
                                    
                                       ∑
                                       
                                          t
                                          =
                                          1
                                       
                                       89
                                    
                                    
                                       1
                                       J
                                    
                                    
                                       ∑
                                       
                                          j
                                          =
                                          1
                                       
                                       J
                                    
                                    
                                       ∑
                                       
                                          s
                                          =
                                          1
                                       
                                       81
                                    
                                    
                                       (
                                       p
                                       r
                                       i
                                       c
                                       
                                          e
                                          
                                             s
                                             t
                                          
                                       
                                       −
                                       
                                          c
                                          t
                                       
                                       )
                                    
                                    
                                       
                                          Q
                                          ^
                                       
                                       
                                          s
                                          t
                                       
                                       j
                                    
                                    .
                                 
                              
                           
                        
                     


                        Table 2 displays the validation results for all models and brands including percentage improvements in ARMSE over the PHomM, the most parsimonious model. We first notice that incorporating heterogeneity did hardly or not at all improve the predictive performance of the homogeneous store sales model. This finding resembles recent empirical insights gained by Andrews et al. (2008) who found that accommodating store-level heterogeneity in the SCAN*PRO model of store sales did not provide substantial benefits relative to the original homogeneous SCAN*PRO model. Second, our results indicate a substantial improvement in the forecasting accuracy of models that account for functional flexibility. In particular, the FHomM outperforms its parametric counterpart PHomM for six brands, with improvements in ARMSE ranging from 4percent for Tropicana SB up to 13 percent and 14 percent for Florida Gold and Tree Fresh, respectively. The most striking result from Table 2, however, is that accounting for heterogeneity in an already flexible model can provide an additional boost in prediction accuracy. This result comes quite unexpected given that addressing heterogeneity in the parametric model did not provide any (substantial) benefit (see Section 3.3 for an explanation). In particular, the brands Citrus Hill, Florida Natural and Florida Gold benefit most from additionally incorporating heterogeneity with a further improvement of 12, 12 and 9 percentage points in ARMSE compared to the FHomM, respectively. Compared to the PHetM which allows for heterogeneity only, the FHetM provides large additional improvements in predictive performance of 24, 21 and 15 percentage points for the brands Florida Gold, Citrus Hill and Tree Fresh, respectively. Moreover, no brand suffers from a loss in predictive validity when extending the FHomM to the FHetM. Overall, the FHetM provides the best predictive performance for 6 out of 8 brands, and performs not worse than other models for the national brand Tropicana SB. Note that for the store brand Dominick’s, in contrast, neither considering heterogeneity nor functional flexibility nor combining both features (really) pays off. Note also that in terms of the DIC the FHetM performs superior to the other models for all 8 brands considered.

To make sure that our results are robust we further estimated a series of PHetM and FHetM models augmented by parametric two-way interactions between own price and competitive prices (nonparametric interactions would require a larger data base). As a rule, predictive performance is improved for both models PHetM and FHetM while the difference in performance and thus the superiority of FHetM over PHetM is preserved.

Accounting for sociodemographic and competitive characteristics of a store’s trading area does not provide further (substantial) benefits or even decreases predictive performance compared to FHetM (see the columns labeled EFHetM and EFHetM2 in Table 2). We expected this result in accordance to the study of Montgomery (1997) who found that demographic variables were only mildly predictive. While the extended model variant EFHetM2 (linear effects of background covariates) performs consistently better than the EFHetM (nonlinear effects of background covariates), it still provides a lower predictive performance compared to the FHetM (no background covariates) for six of eight brands. To distinguish between the roles of non-linearity in price response and non-linearity in the store characteristics’ impact on heterogeneity, we further extended the parametric heterogeneous model PHetM to account for background effects in a nonlinear way according to Eq. (2)
                        
                           10
                        
                        
                           10
                           A similar model has been proposed by Shively, Allenby, and Kohn (2000) in the context of preference modeling. Shively et al. (2000) have reparametrized consumer preferences for product features as to depend nonparametrically on observed consumer covariates.
                         and refer to this model as EPHetM in Table 2. A comparison between EPHetM and EFHetM2 clearly demonstrates the dominant role of non-linearity in prices on predictive performance. Nonlinearity in the store characteristics’ impact on heterogeneity is almost negligible. Finally, we estimated two further extensions of the FHetM where now (instead of the store-specific scaling factors for the nonlinear price effects) the random store intercept was reparametrized once as a nonlinear and once as a linear function of the background covariates (not shown in Table 2). Whereas both model extensions perform similarly well (as opposed to EFHetM vs. EFHetM2), they again do not perform (substantially) better or even decrease predictive performance compared to FHetM.
                           11
                        
                        
                           11
                           In particular, only Tree Fresh slightly benefitted from those model extensions with further improvements in ARMSE of about 1.6percent compared to FHetM, respectively. In contrast, ARMSE values decreased by about 3 percent for Florida Natural, respectively, and by 2.3 percent for Citrus Hill when nonlinear background effects are considered. For the other five brands, differences in ARMSE values are negligible between the FHetM and those two extended variants of the FHetM.
                         The following discussion of results is therefore limited to the four basic models PHomM, PHetM, FHomM, and FHetM.

To shed more light on the combined roles of store heterogeneity and functional flexibility, we compare in Fig. 1
                         the FHetM (panel d) to its nested versions PHetM (panel a) and FHomM (panel c) as well as to individually estimated store models (panel b) exemplarily for the brand Citrus Hill. For ease of presentation the illustration is based on a model with own-item price as the only independent variable. Estimated price effects from the PHomM are not displayed as they virtually coincide with those from PHetM. From the comparison between PHetM on the one hand and FHomM and FHetM on the other hand it becomes clear why the more flexible models provide more accurate forecasts. The parametric models are simply not able to capture the strong nonlinearity in price response contained in the sales data. Furthermore, the FHetM is not only able to capture that nonlinearity but also to represent the large store-specific differences in own price response across stores. This becomes particularly evident for the sales data observed at the lower bound of the price range which are ”reached” much better by the FHetM as compared to the FHomM, but also holds for medium and higher price levels. In contrast to the FHetM, the PHetM cannot reproduce this heterogeneity just due to its lack of functional flexibility: there is just one single parameter estimate that determines the shape of the price effect in the PHetM, as opposed to a linear combination of several weighted B-Spline basis functions in the FHetM. As could be expected, estimating a separate nonparametric model for each store in the sense of fixed effects estimates can provide a better representation of heterogeneity. However, those individually estimated store models obviously fail to capture the strong nonlinearity in own price response (this issue is explained below in more detail). In addition, estimates of separate regressions for each store are known to be more noisy and less stable compared to estimates of hierarchical Bayes store-level models which borrow information across stores and shrink the estimates toward one another. Not unexpected therefore, separate model estimation performs by far worse here compared to all other models (with a corresponding ARMSE of 163.33 for Citrus Hill).

The bottom two panels (e) and (f) in Fig. 1 illustrate the discussed phenomena for one specific store (outlet 63), where the sales data for Citrus Hill in this store is highlighted. The left panel (e) contrasts the three own price effects estimated by the PHetM (short dashed line), PHomM (long dashed line) and the individual store model (solid line), the right panel (f) compares PHetM (short dashed line), FHomM (long dashed line) and FHetM (solid line) estimates. Differences in predictive performance between models for Citrus Hill are well-represented in those two panels. In particular, it becomes apparent why addressing heterogeneity alone does not increase the forecasting accuracy (left panel, PHomM vs. PHetM), and that we need nonlinearity in the model here before we can find evidence for heterogeneity (right panel). It further becomes clear why the individual store model fails to catch the two kinks suggested by the pooled sales data: there is simply not enough data in that one store such that the spline can adjust to those nonlinearities (e.g. between 2.20 and 2.40, or for prices at the lower bound of the price range). And, the individual model cannot borrow this relevant information from other stores.


                        Fig. 2
                         depicts estimated own price response curves for further brands (Florida Natural, Tree Fresh, Florida Gold, Dominick’s). As managers are interested in sales effects rather than log sales effects, the plots now display the relationship between a brand’s own price on the x-axis and the conditional mean predictions for the brand’s unit sales on the y-axis, as obtained from the estimated log-normal models, respectively. We selected those four brands to give examples for brands belonging to the three different tiers and to provide evidence why some brands may benefit more and other brands less from using the more complex model versions. The premium brand Florida Natural and the national brands Florida Gold and Tree Fresh are the brands that experienced the most noticeable improvements in predictive validity in their tiers when accounting for functional flexibility in price response. On the other hand, the store brand Dominick’s did not benefit at all from addressing functional flexibility. Furthermore, those brands benefitted differently from accommodating heterogeneity in addition to functional flexibility.

Each panel in Fig. 2 contrasts the three own price response curves estimated by the FHetM (solid line), FHomM (dotted line) and PHomM (dashed line), respectively. For a clear representation, we abstain from plotting the own price response curves for the PHetM since they virtually coincide with those from PHomM. We further provide three different panels per brand in order to illustrate the amount of heterogeneity across stores of the chain, as suggested by the FHetM estimation results. Specifically, we choose three stores based on the estimated store-specific scaling factors α
                        
                           s1 which quote the level of heterogeneity in own price response across the 81 stores. The left and right panels titled Minimum scaling and Maximum scaling exhibit those two stores which have assigned the lowest and highest estimated scaling factors, i.e., which are most heterogeneous in own price response. In addition, the middle panel refers to that store where the estimated scaling factor takes its median level. Consequently, the panel labeled “Median Scaling” characterizes an “average” store.

First, a comparison of the PHomM estimates on the one hand with the FHomM and FHetM estimates on the other hand again shows why the flexible models may provide much more accurate forecasts than the parametric model. As a rule, the flexibly estimated own price response curves show an L-shape for the brands Florida Natural, Tree Fresh, and Florida Gold, indicating strong price thresholds at (very) low price levels that cannot be captured adequately by the multiplicative model. In contrast, FHetM, FHomM and PHomM yield quite similar own price response curves for the store brand Dominick’s corresponding to the much smaller discrepancy in predictive performance between the three models. Therefore, using a more flexible store sales model is recommendable, if strong nonlinear effects in price response exist.

Second, contrasting the FHetM and FHomM results once more reveals why accommodating heterogeneity in addition to functional flexibility can further improve the predictive performance of a store sales model. The larger (smaller) the scaling factor the more (less) distinct are existing threshold effects. Further, the more heterogeneity in price response across stores is observed, as reflected by the minimum and maximum scaling scenarios as well as by the estimated density of the scaling factors (not shown), the larger the additional improvement of FHetM in predictive validity for a respective brand over FHomM (compare Table 2). In particular, while the premium brand Florida Natural (12 percent improvement) and the national brand Florida Gold (9 percent improvement) benefitted strongly in their tiers from addressing heterogeneity, no improvement is obtained for the store brand Dominick’s. The improvements in predictive performance from accommodating functional flexibility and heterogeneity are therefore well-represented in the panels of Fig. 2. Furthermore, heterogeneity in own price response seems an issue especially for prices at the lower bound of the price ranges (i.e., below the threshold levels of the brands).

Marketing managers should use the model with the highest prediction accuracy (e.g., van Heerde, Leeflang, & Wittink, 2002). As shown in Section 3.2, the proposed flexible heterogeneous model FHetM outperformed competing models in predictive performance for all premium and national brands except Tropicana SB, where FHetM and FHomM performed equally well. For those six brands where the FHetM shows the best predictions, we want to know how much profit management benefits from using the FHetM as compared to “a world without it”, i.e., as compared to the best model among FHomM, PHetM and PHomM. Therefore, we first determined optimal prices 
                           
                              p
                              FHetM
                              *
                           
                         and total expected chain profit 
                           
                              
                                 E
                                 FHetM
                              
                              
                                 [
                                 Π
                              
                              
                                 (
                                 
                                    p
                                    FHetM
                                    *
                                 
                                 )
                              
                           
                         based on the estimated FHetM, as well as optimal prices 
                           
                              p
                              2nd
                              *
                           
                         based on the second-best performing model, respectively. We then computed the loss in total expected chain profit when using 
                           
                              p
                              2nd
                              *
                           
                         instead of 
                           
                              p
                              FHetM
                              *
                           
                         for expected profit calculations, i.e. we computed 
                           
                              
                                 E
                                 FHetM
                              
                              
                                 [
                                 Π
                                 
                                    (
                                    
                                       p
                                       FHetM
                                       *
                                    
                                    )
                                 
                                 ]
                              
                              −
                              
                                 E
                                 FHetM
                              
                              
                                 [
                                 Π
                                 
                                    (
                                    
                                       p
                                       2nd
                                       *
                                    
                                    )
                                 
                                 ]
                              
                           
                        . As a result, total expected chain profit can be increased through the FHetM on average by 4.2 percent across the six brands. Based on the marginal posterior distribution of the expected profit function, we further obtained a probability of at least 0.94 that the FHetM increase expected profits over the second-best predicting model, respectively. To test whether the profit maximization results are robust we further replicated our out-of-sample validation study as conducted for prediction (see Section 3.2) for expected profits, too. Accordingly, based on nine-fold cross-validation, we determined total expected chain profits as described above now in holdout samples. For each holdout, we then computed the loss in total expected chain profit when using the second-best model instead of the FHetM. As a result here, the increase in total expected chain profit through the FHetM ranges between 3.4 percent and 5.2 percent across the six brands indicating that expected profit calculations are highly robust across the nine holdouts.

Pricing implications from the different models are shown in Fig. 3 again exemplarily for the brand Citrus Hill. Since the heterogeneous models (FHetM, PHetM) allow for multiple optimal price levels across stores in a given week, we additionally quote the percentage of stores that were assigned the respective optimal price level in such weeks. We first notice that optimal prices based on the two homogeneous models (PHomM vs. FHomM) are the same in about three-fourth of all weeks. For the remaining weeks, the parametric model provides an optimal price of 1.99$, while the flexible model suggests a higher optimal price of 2.99$. The tendency that the flexible model favors a larger number of higher optimal price levels across weeks is still more clear-cut for the heterogeneous models (FHetM vs. PHetM). This becomes particularly evident in the period between week 45 and week 82 where (except in week 52) the PHetM suggests a unique optimal price level of 1.99$ across stores, while the FHetM yields a higher optimal price of again 2.99$ in at least 33 percent of the stores.
                           12
                        
                        
                           12
                           Note that all models extremely favor 99-ending optimal prices (except for some stores in some weeks under the PHetM) for Citrus Hill, as 99-ending prices turned out to be especially effective for this brand (with a corresponding multiplier effect of 2.18). This does not hold for most other brands.
                         Note further that multiple optimal price levels are obtained in 56 percent of the weeks under the FHetM, but only in 36 percent of the weeks under the PHetM. Interestingly, the FHetM leads to a lower number of multiple optimal price levels for Citrus Hill in a given week (at most 2) than PHetM (up to 4). This holds for all brands except Florida Gold and Florida Natural. Thus, pricing decisions based on the FHetM would increase expected profits substantially relative to PHetM for all premium and national brands (not detailed here), while leading at the same time to a (much) more parsimonious number of store-specific price levels for some brands, which constitutes an important finding from a managerial point of view. Finally, differences in optimal pricing between FHetM and FHomM can also be largely attributed to the fact that the FHetM enables higher optimal price levels in many stores through price differentiation. Overall, the proposed model not only outpredicts competing models for the majority of brands but also provides materially different pricing implications.

In this paper, we propose a hierarchical Bayesian semiparametric model to simultaneously accommodate functional flexibility and heterogeneity in store sales models. We develop a structured additive regression model where own- and cross-price response is estimated flexibly using P-splines, while heterogeneity in price response across stores is accommodated by multiplicative store-specific random effects that scale the nonlinear price curves while their overall shape is preserved.

An extensive empirical study based on store-level data of the Dominick’s Finer Foods data base shows, that the new model class reveals improved predictive performance and materially different pricing implications compared to a series of competing models (nested in the new model class). A key finding of our study is that allowing for multiplicative heterogeneity in addition to functional flexibility can improve the predictive validity of a store sales model and expected profits obtained considerably.

In future research more empirical research based on other data sources is necessary to generalize the findings of this paper. Moreover, the statistical model can be extended in various ways. In particular, we plan to extend the model by tensor product spline interactions of the form 
                        
                           
                              (
                              1
                              +
                              
                                 α
                                 s
                              
                              )
                           
                           f
                           
                              (
                              
                                 z
                                 
                                    s
                                    t
                                    1
                                 
                              
                              ,
                              
                                 z
                                 
                                    s
                                    t
                                    2
                                 
                              
                              )
                           
                           ,
                        
                      where z
                     
                        st1 and z
                     
                        st2 are price variables and 
                        
                           (
                           1
                           +
                           
                              α
                              s
                           
                           )
                        
                      is a store specific scaling factor that scales the two dimensional function f. A particular challenge here will be the incorporation of appropriate monotonicity constraints. It would further be interesting to allow the functional shapes of price response functions to vary across stores but still keep them tied together through a hierarchical Bayesian model in order to borrow strength. Such an extension would make the model still more flexible.
                        13
                     
                     
                        13
                        We thank one of the anonymous reviewers for this idea.
                      One promising approach to accomplish this may be the development of models with multiple random effects (e.g., Russo, Willemsen, Leao, & Lesaffre, 2014). Other possible improvements are models that consider correlations in sales across brands of a product category and automated model choice and variable selection procedures.

@&#ACKNOWLEDGMENTS@&#

The data for our empirical study was provided by the James M. Kilts Center, GSB, University of Chicago. We further thank two anonymous referees for their valuable comments and suggestions on our way toward a publishable manuscript.

In this appendix we describe Gibbs updates for the novel parts of this paper, i.e. the random scaling terms in the model given by Eqs. (1) and (2). For the sake of a more compact notation, we relabel the observations by the index 
                        
                           i
                           =
                           1
                           ,
                           ⋯
                           ,
                           n
                           ,
                        
                      where now 
                        
                           
                              s
                              i
                           
                           ∈
                           
                              {
                              1
                              ,
                              ⋯
                              ,
                              S
                              }
                           
                        
                      denotes the store of the ith observation, ti
                      denotes the week of the ith observation and n is the total number of observations. For illustration, we consider a model of the form

                        
                           (A.1)
                           
                              
                                 
                                    
                                       
                                          y
                                          i
                                       
                                    
                                    
                                       =
                                    
                                    
                                       
                                          
                                             (
                                             1
                                             +
                                             
                                                α
                                                
                                                   s
                                                   i
                                                
                                             
                                             )
                                          
                                          f
                                          
                                             (
                                             
                                                z
                                                i
                                             
                                             )
                                          
                                          +
                                          
                                             
                                                η
                                                ˜
                                             
                                             i
                                          
                                          +
                                          
                                             
                                                ɛ
                                             
                                             i
                                          
                                          ,
                                          
                                          i
                                          =
                                          1
                                          ,
                                          ⋯
                                          ,
                                          n
                                          ,
                                       
                                    
                                 
                                 
                                    
                                       
                                          α
                                          s
                                       
                                    
                                    
                                       =
                                    
                                    
                                       
                                          
                                             f
                                             1
                                          
                                          
                                             (
                                             
                                                v
                                                
                                                   s
                                                   1
                                                
                                             
                                             )
                                          
                                          +
                                          …
                                          +
                                          
                                             f
                                             p
                                          
                                          
                                             (
                                             
                                                v
                                                
                                                   s
                                                   p
                                                
                                             
                                             )
                                          
                                          +
                                          
                                             u
                                             s
                                          
                                          ,
                                          
                                          s
                                          =
                                          1
                                          ,
                                          ⋯
                                          ,
                                          S
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     where yi
                      are the observed log unit sales for the brand analyzed, f is a nonlinear function of price z, 
                        
                           1
                           +
                           
                              α
                              s
                           
                        
                      is the store-specific scaling factor that depends on p covariates vsr
                     , 
                        
                           r
                           =
                           1
                           ,
                           ⋯
                           ,
                           p
                        
                      through the second equation, 
                        
                           
                              η
                              ˜
                           
                           i
                        
                      is the remaining part of the model (capturing time trend, further nonlinear price functions, random intercept and random slopes, etc.), 
                        
                           
                              
                                 ɛ
                              
                              i
                           
                           
                              ∼
                              
                                 i
                                 .
                                 i
                                 .
                                 d
                              
                           
                           N
                           
                              (
                              0
                              ,
                              
                                 σ
                                 2
                              
                              )
                           
                        
                      and 
                        
                           
                              u
                              s
                           
                           
                              ∼
                              
                                 i
                                 .
                                 i
                                 .
                                 d
                              
                           
                           N
                           
                              (
                              0
                              ,
                              
                                 σ
                                 α
                                 2
                              
                              )
                           
                        
                      are error terms.

We assume Bayesian P-splines for the nonlinear price function f as well as for 
                        
                           
                              f
                              1
                           
                           ,
                           ⋯
                           ,
                           
                              f
                              p
                           
                        
                      in the equation for αs
                     . P-splines assume that the unknown functions can be approximated by a polynomial spline which can be written in terms of a linear combination of B-spline basis functions. Hence, the columns of the design matrix 
                        Z
                      for function f (and analogously for the fr
                     ) are given by the B-spline basis functions evaluated at the observations. Lang and Brezger (2004) propose to use second order random walks as smoothness priors for the regression coefficients, i.e. 
                        
                           
                              β
                              k
                           
                           =
                           2
                           
                              β
                              
                                 k
                                 −
                                 1
                              
                           
                           −
                           
                              β
                              
                                 k
                                 −
                                 2
                              
                           
                           +
                           
                              ν
                              k
                           
                           ,
                        
                     
                     
                        
                           k
                           =
                           3
                           ,
                           ⋯
                           ,
                           K
                           ,
                        
                      with Gaussian errors νk
                      ∼ N(0, τ
                     2) and diffuse priors p(β
                     1)∝const and p(β
                     2)∝const, for initial values. This implies a partially improper multivariate Gaussian prior for 
                        β
                      of the form 
                        
                           p
                           
                              (
                              
                                 β
                              
                              
                              |
                              
                              
                                 τ
                                 2
                              
                              )
                           
                           ∝
                           
                              
                                 (
                                 
                                    1
                                    
                                       τ
                                       2
                                    
                                 
                                 )
                              
                              
                                 rk
                                 (
                                 K
                                 )
                                 /
                                 2
                              
                           
                           exp
                           
                              (
                              −
                              
                                 1
                                 
                                    2
                                    
                                       τ
                                       2
                                    
                                 
                              
                              
                                 
                                    
                                       β
                                    
                                 
                                 ′
                              
                              K
                              
                                 β
                              
                              )
                           
                           ,
                        
                      where 
                        
                           K
                           =
                           
                              
                                 D
                              
                              ′
                           
                           D
                           ,
                        
                      and 
                        D
                      denotes the second order difference matrix. Monotonically decreasing (increasing) functions for own (cross) price response can be obtained as described in Brezger and Steiner (2008). For identifiability reasons all nonlinear functions are constrained such that the function evaluations sum to zero. For the scaled nonlinear function f, the additional constraint 
                        
                           
                              ∑
                              
                                 k
                                 =
                                 1
                              
                              K
                           
                           
                              β
                              k
                              2
                           
                           =
                           c
                        
                      together with the monotonicity constraint for the price effect ensures the identifiability of the scaling factor and the nonlinear price response curve. The constant c can, for example, be chosen such that the squared sum of the coefficients is identical to that of a model without scaling factors.

For a fully Bayesian analysis, hyperpriors for variances τ
                     2, 
                        
                           τ
                           r
                           2
                        
                      of the nonlinear functions as well as the error variances σ
                     2, 
                        
                           σ
                           α
                           2
                        
                      are introduced. We use highly dispersed inverse gamma priors IG(a, b) with hyperparameters a and b. Our standard choice with standardized responses is 
                        
                           a
                           =
                           b
                           =
                           0.001
                           ,
                        
                      leading to almost diffuse priors (on the log scale). Usually results are quite unsensitive with respect to the prior choice of a and b. However, a sensitivity analysis should always be undertaken to assess the dependence of results on the choice of a and b. We have used 
                        
                           a
                           =
                           b
                           =
                           0.01
                        
                      and 
                        
                           a
                           =
                           b
                           =
                           0.0001
                        
                      in our sensitivity analysis with negligible differences to the standard choice.

The following Gibbs updates rely on the usual conditional independence assumptions for the priors for nonlinear functions, random effects and hyperpriors for variances. The description of posterior inference is facilitated by rewriting the model equations (A.1) in matrix notation. We obtain for the top level equation

                        
                           (A.2)
                           
                              
                                 y
                                 =
                                 D
                                 Z
                                 
                                    β
                                 
                                 +
                                 
                                    
                                       η
                                    
                                    ˜
                                 
                                 +
                                 ɛ
                                 ,
                              
                           
                        
                     where 
                        y
                      is the stacked vector of log unit sales for the brand analyzed, 
                        Z
                      is a P-spline design matrix for the price effect, 
                        
                           D
                           =
                           diag
                           (
                           1
                           +
                           
                              α
                              
                                 s
                                 1
                              
                           
                           ,
                           ⋯
                           ,
                           1
                           +
                           
                              α
                              
                                 s
                                 n
                              
                           
                           )
                        
                      is an n × n diagonal matrix with the random scaling factors in the main diagonal, and 
                        β
                      is a vector of regression coefficients. The P-spline term of the price effect in (A.2) is formally in the form of a varying coefficient term (Hastie & Tibshirani, 1993) with effect modifier matrix 
                        Z
                      and (pseudo) values of the interacting variable stored in the diagonal matrix 
                        D
                     .

An alternative formulation in terms of the scaling parameter vectors 
                        
                           
                              α
                           
                           =
                           
                              
                                 (
                                 
                                    α
                                    1
                                 
                                 ,
                                 ⋯
                                 ,
                                 
                                    α
                                    S
                                 
                                 )
                              
                              ′
                           
                        
                      is given by

                        
                           (A.3)
                           
                              
                                 y
                                 =
                                 f
                                 +
                                 
                                    D
                                    α
                                 
                                 
                                    Z
                                    α
                                 
                                 
                                    α
                                 
                                 +
                                 
                                    
                                       η
                                    
                                    ˜
                                 
                                 +
                                 ɛ
                                 ,
                              
                           
                        
                     where 
                        f
                      is a vector of function evaluations at the observed price values, and 
                        
                           
                              D
                              α
                           
                           
                              =
                              diag
                              (
                              f
                           
                           
                              (
                              
                                 z
                                 1
                              
                              )
                           
                           ,
                        
                     
                     
                        
                           ⋯
                           ,
                           f
                           (
                           
                              z
                              n
                           
                           )
                           )
                        
                      is a n × n diagonal matrix with diagonal elements now given by the function evaluations of the nonlinear price effect. 
                        Z
                     
                     
                        α
                      is a matrix indicating if observation i belongs to store s (in this case 
                        Z
                     
                     
                        α
                     (i, s) equals 1, otherwise it equals 0). Again, the expression 
                        D
                     
                     
                        α
                     
                     
                        Z
                     
                     
                        α
                     
                     
                        α
                      in (A.3) is in the form of a varying coefficient term now with values for the interacting variable given in 
                        D
                     
                     
                        α
                     .

For the random scaling factor equations (2) we obtain

                        
                           (A.4)
                           
                              
                                 
                                    α
                                 
                                 =
                                 
                                    
                                       η
                                    
                                    α
                                 
                                 +
                                 u
                                 =
                                 
                                    V
                                    1
                                 
                                 
                                    
                                       β
                                    
                                    1
                                 
                                 +
                                 ⋯
                                 +
                                 
                                    V
                                    p
                                 
                                 
                                    
                                       β
                                    
                                    p
                                 
                                 +
                                 u
                                 ,
                              
                           
                        
                     where 
                        
                           
                              V
                              1
                           
                           ,
                           ⋯
                           ,
                           
                              V
                              p
                           
                        
                      are P-spline design matrices for the nonlinear effects 
                        
                           
                              f
                              1
                           
                           ,
                           ⋯
                           ,
                           
                              f
                              p
                           
                        
                      of the demographic and competitive store covariates, 
                        
                           
                              
                                 β
                              
                              1
                           
                           ,
                           ⋯
                           ,
                           
                              
                                 β
                              
                              p
                           
                        
                      are the corresponding vectors of regression coefficients and 
                        u
                      is the vector of i.i.d. random effects.

Gibbs updates for the random scaling term are employed by obeying the two different varying coefficient representations (A.2) and (A.3) of the model. The full conditionals of the regression parameters 
                        β
                      are easily derived from (A.2) and are multivariate Gaussian 
                        β
                      | · ∼ N(
                        μ, Σ
                     ) with

                        
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   Σ
                                                
                                             
                                             
                                                −
                                                1
                                             
                                          
                                          =
                                          
                                             1
                                             
                                                σ
                                                2
                                             
                                          
                                          
                                             (
                                             
                                                
                                                   Z
                                                
                                                ′
                                             
                                             
                                                
                                                   D
                                                
                                                2
                                             
                                             Z
                                             +
                                             
                                                
                                                   σ
                                                   2
                                                
                                                
                                                   τ
                                                   2
                                                
                                             
                                             K
                                             )
                                          
                                          ,
                                          
                                          
                                             
                                                
                                                   Σ
                                                
                                             
                                             
                                                −
                                                1
                                             
                                          
                                          
                                             μ
                                          
                                          =
                                          
                                             1
                                             
                                                σ
                                                2
                                             
                                          
                                          
                                             
                                                Z
                                             
                                             ′
                                          
                                          D
                                          
                                             (
                                             y
                                             −
                                             
                                                
                                                   η
                                                
                                                ˜
                                             
                                             )
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     Adapting for monotonically increasing or decreasing functions is easily possible, see Brezger and Steiner (2008) for details.

The full conditionals for the scaling factors are derived from (A.3) with 
                        α
                      | · ∼ N(
                        μ
                     
                     
                        
                           α
                        
                     , 
                        Σ
                     
                     
                        
                           α
                        
                     ) and

                        
                           
                              
                                 
                                    
                                       
                                          
                                             Σ
                                          
                                          
                                             
                                                α
                                             
                                          
                                          
                                             −
                                             1
                                          
                                       
                                    
                                    
                                       =
                                    
                                    
                                       
                                          
                                             1
                                             
                                                σ
                                                2
                                             
                                          
                                          
                                             (
                                             
                                                Z
                                                
                                                   
                                                      α
                                                   
                                                
                                                ′
                                             
                                             
                                                D
                                                
                                                   
                                                      α
                                                   
                                                
                                                2
                                             
                                             
                                                Z
                                                
                                                   α
                                                
                                             
                                             +
                                             
                                                
                                                   σ
                                                   2
                                                
                                                
                                                   σ
                                                   
                                                      α
                                                   
                                                   2
                                                
                                             
                                             I
                                             )
                                          
                                          ,
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                Σ
                                             
                                             
                                                
                                                   α
                                                
                                             
                                             
                                                −
                                                1
                                             
                                          
                                          
                                             
                                                μ
                                             
                                             
                                                α
                                             
                                          
                                       
                                    
                                    
                                       =
                                    
                                    
                                       
                                          
                                             1
                                             
                                                σ
                                                2
                                             
                                          
                                          
                                             Z
                                             
                                                
                                                   α
                                                
                                             
                                             ′
                                          
                                          
                                             D
                                             
                                                α
                                             
                                          
                                          
                                             (
                                             y
                                             −
                                             f
                                             −
                                             
                                                
                                                   η
                                                
                                                ˜
                                             
                                             )
                                          
                                          +
                                          
                                             1
                                             
                                                σ
                                                
                                                   α
                                                
                                                2
                                             
                                          
                                          
                                             
                                                η
                                             
                                             
                                                α
                                             
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     In contrast to “usual” varying coefficients terms, the diagonal matrices 
                        D
                      and 
                        D
                     
                     
                        α
                      of the (pseudo) interacting variables are not constant during the Gibbs sampler. Hence cross products and other quantities cannot be computed and stored in advance and numerical efficient updating is considerably complicated. However, the methodology for highly efficient Gibbs updates described in Lang et al. (2014) can be applied.

Finally the full conditionals for the variance parameters are inverse Gamma and are given by

                        
                           
                              
                                 
                                    
                                    
                                    
                                       
                                          
                                             τ
                                             2
                                          
                                          
                                             
                                             |
                                             
                                             ∼
                                             I
                                             G
                                          
                                          
                                             (
                                             
                                                a
                                                ′
                                             
                                             ,
                                             
                                                b
                                                ′
                                             
                                             )
                                          
                                          ,
                                          
                                          
                                             a
                                             ′
                                          
                                          =
                                          a
                                          +
                                          
                                          0.5
                                          
                                          rk
                                          
                                             (
                                             K
                                             )
                                          
                                          ,
                                          
                                          
                                             b
                                             ′
                                          
                                          =
                                          b
                                          +
                                          
                                          0.5
                                          
                                          
                                             
                                                
                                                   β
                                                
                                             
                                             ′
                                          
                                          K
                                          
                                             β
                                          
                                          ,
                                       
                                    
                                 
                                 
                                    
                                    
                                    
                                       
                                          
                                             σ
                                             
                                                α
                                             
                                             2
                                          
                                          
                                             
                                             |
                                             
                                             ∼
                                             I
                                             G
                                          
                                          
                                             (
                                             
                                                a
                                                
                                                   σ
                                                   
                                                      α
                                                   
                                                   2
                                                
                                                ′
                                             
                                             ,
                                             
                                                b
                                                
                                                   σ
                                                   
                                                      α
                                                   
                                                   2
                                                
                                                ′
                                             
                                             )
                                          
                                          ,
                                          
                                          
                                             a
                                             
                                                
                                                   σ
                                                   
                                                      α
                                                   
                                                   2
                                                
                                             
                                             ′
                                          
                                          =
                                          a
                                          +
                                          
                                          0.5
                                          
                                          S
                                          ,
                                       
                                    
                                 
                                 
                                    
                                    
                                    
                                       
                                          
                                             b
                                             
                                                
                                                   σ
                                                   
                                                      α
                                                   
                                                   2
                                                
                                             
                                             ′
                                          
                                          =
                                          b
                                          +
                                          
                                          0.5
                                          
                                          
                                             
                                                (
                                                
                                                   α
                                                
                                                −
                                                
                                                   
                                                      η
                                                   
                                                   
                                                      α
                                                   
                                                
                                                )
                                             
                                             ′
                                          
                                          
                                             (
                                             
                                                α
                                             
                                             −
                                             
                                                
                                                   η
                                                
                                                
                                                   α
                                                
                                             
                                             )
                                          
                                          ,
                                       
                                    
                                 
                                 
                                    
                                    
                                    
                                       
                                          
                                             σ
                                             2
                                          
                                          
                                             
                                             |
                                             
                                             ∼
                                             I
                                             G
                                          
                                          
                                             (
                                             
                                                a
                                                
                                                   σ
                                                   2
                                                
                                                ′
                                             
                                             ,
                                             
                                                b
                                                
                                                   σ
                                                   2
                                                
                                                ′
                                             
                                             )
                                          
                                          ,
                                          
                                          
                                             a
                                             
                                                
                                                   σ
                                                   2
                                                
                                             
                                             ′
                                          
                                          =
                                          a
                                          +
                                          
                                          0.5
                                          
                                          n
                                          ,
                                       
                                    
                                 
                                 
                                    
                                    
                                    
                                       
                                          
                                             b
                                             
                                                
                                                   σ
                                                   2
                                                
                                             
                                             ′
                                          
                                          =
                                          b
                                          +
                                          
                                          0.5
                                          
                                          
                                             
                                                (
                                                y
                                                −
                                                
                                                   η
                                                
                                                )
                                             
                                             ′
                                          
                                          
                                             (
                                             y
                                             −
                                             
                                                η
                                             
                                             )
                                          
                                          .
                                       
                                    
                                 
                              
                           
                        
                     
                  

@&#REFERENCES@&#

