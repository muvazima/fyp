@&#MAIN-TITLE@&#Stochastic programming analysis and solutions to schedule overcrowded operating rooms in China

@&#HIGHLIGHTS@&#


               
                  
                  
                     
                        
                           
                           Presents multi-stage stochastic programming models the complex stochastic nature of operating room scheduling in overcrowded Chinese big city hospitals.


                        
                        
                           
                           Develops mathematical results and techniques to solve the formulated models to almost optimality.


                        
                        
                           
                           Attains substantial and significant schedule improvements for single operating room instances derived from real life data.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Operating room scheduling

3-Stage stochastic programming

Sample average approximation

China's hospital reform

@&#ABSTRACT@&#


               
               
                  As a result of the growing demand for health services, China's large city hospitals have become markedly overstretched, resulting in delicate and complex operating room scheduling problems. While the operating rooms are struggling to meet demand, they face idle times because of (human) resources being pulled away for other urgent demands, and cancellations for economic and health reasons. In this research we analyze the resulting stochastic operating room scheduling problems, and the improvements attainable by scheduled cancellations to accommodate the large demand while avoiding the negative consequences of excessive overtime work. We present a three-stage recourse model which formalizes the scheduled cancellations and is anticipative to further uncertainty. We develop a solution method for this three-stage model which relies on the sample average approximation and the L-shaped method. The method exploits the structure of optimal solutions to speed up the optimization. Scheduled cancellations can significantly and substantially improve the operating room schedule when the costs of cancellations are close to the costs of overtime work. Moreover, the proposed methods illustrate how the adverse impact of cancellations (by patients) for economic and health reasons can be largely controlled. The (human) resource unavailability however is shown to cause a more than proportional loss of solution value for the surgery scheduling problems occurring in China's large city hospitals, even when applying the proposed solution techniques, and requires different management measures.
               
            

@&#INTRODUCTION@&#

In the first decade of the present millennium, China's GDP has grown at an average rate of more than 10% [35]. These economic developments have gone hand in hand with social and demographic developments. The urban population grew from 452 million to 721 million [45], the public transportation system improved considerably, and health insurance coverage grew from below 30% around the turn of the millennium to over 95% in 2011 [34]. These changes have driven an enormous growth in demand for health services, and in health expenditures of which 71% are accounted for by hospitals [2]. As a result of these developments, particularly the demand for services at the large (level 3) hospitals in big cities increased [38]. Despite a tenfold growth in government spending on health [28] and a growth in the number of hospitals by more than 40% since the year 2000 [36], the increase in health service capacity has not been able to cope with the rising demand. The level 3 hospitals in big cities have become markedly overstretched [41]. These phenomena are concretely illustrated by the 2013 data provided for the purpose of the analysis presented in this manuscript by Shanghai General Hospital, where the actual average surgical workload exceeded the daily capacity by as much as 20%, and average operating room opening hours are almost 14h daily.

Because a referral system is lacking, an important part of the increased demand directly reaches the hospitals in the form of ever higher numbers of outpatients, which tend to pull away physicians and other staff from wards and operating rooms. The number of outpatient visits to hospitals has grown from 2.12 billion per year to 3.45 billion per year in the first decade of the new millennium [29]. The increase in outpatient services may cause physicians to be late for operating room shifts or to be called away during operating room shifts, causing idle time at the operating room. (From the complete operating room data for the year 2013, we estimate that idle time at Shanghai General Hospital is around 17%.) In the same decade, the number of inpatient visits in China has more than doubled from 53 million to 133 million annually. Meara et al. [33] recently conservatively estimated the annually needed number of surgeries in China at 57 million, of which they considered 27 million to be unmet. The already overstretched operating rooms are therefore likely to face considerable further increases in demand in the coming years. Hence Chinese hospitals face severe operational problems, now and in the coming years.

Our aim is to develop scheduling methods to solve the urgent capacity management problems in China's large city hospitals – which form a priority in the current health system reform – and see how their effectiveness interacts with accompanying operations management measures. As we outline more extensively in the literature review in the next section, current losses of scarce capacity are mostly not due to poor scheduling, but to other causes such as unavailability of scarce (human) resources, and cancellations of planned surgeries. Scheduled surgeries may be canceled for a variety of reasons which are beyond the locus of control of operating room management, such as no-show, deteriorating health conditions, and hospital logistics. In anticipation of such exogenous cancellations, operating room management may choose to schedule more patients than capacity allows, potentially resulting in capacity problems when cancellations are fewer than expected, or surgeries take longer than expected. The schedulers may subsequently solve the capacity problems by cancelling one or more of the final patients for which surgery was scheduled at the end of the day. Such cancellations may cause dissatisfaction, anxiety and loss of health for the patients, and have led to tense relations between patients and staff. The alternative to further extend overtime hours, on the other hand, is associated with increased risks of complications and medical errors, as well as dissatisfaction among scarce staff ([39] and references therein). The scheduling of operating rooms in the overstretched Chinese hospitals is therefore a stochastic balancing act which is complicated by resource unavailability and exogenous cancellations.

Operating room schedules are typically constructed one or several days in advance. Because of the stochastic nature of surgical services and the related health service processes, schedules are subsequently often adjusted as the day progresses. For operating rooms for elective surgeries, such adjustments are primarily constrained to changes in surgery start times and, when needed, to cancellations of one or more surgeries of the final patients of the day. It is preferable to take such scheduling decisions to cancel one or more of the final patients early, so as to limit the negative effects for patients and staff mentioned above. In practice, such cancellations may also take the form of redirecting patients to another hospital.

The first research objective is now to optimize the operating room schedules. This starts with the optimization of the schedules created one or more days in advance per single elective operating room, henceforth referred to as the first stage problem. Secondly, we consider the optimization of early scheduled cancellations, cancellations initiated by the operating room schedulers after an initial part of the daily schedule has been completed (see for instance [39]), referred to as the second stage problem. In particular, we analyze the improvements attainable by introducing a two stage approach (in which the first stage solution takes into account that a second stage follows) over the common practice of a single stage approach which disregards cancellation until the end of the day. The objective will be to balance the benefits from performing surgeries with the costs of overtime work and negative effects of scheduled cancellations. Our modelling of overtime costs reflects the empirical findings that overtime work is increasingly undesirable for patients and staff as the duration lengthens. Moreover, we model resource unavailability and exogenous cancellations as independent stochastic processes and consider surgical durations to be stochastic as well, fitting real life data. As we are interested in the performance improvement possible by adopting a two stage approach, we develop solution methods which solve the problem with and without scheduled cancellations (almost) to optimality. (See Fig. 1 in Section 3.1 for a visualization of the multi-stage model.)

With these solution methods at hand, the second research objective is then to analyze the extent to which scheduling can overcome the difficulties posed by stochastic resource unavailabilities and exogenous cancellations or, alternatively, whether additional operations management measures are required for this purpose. This second research objective is particularly relevant as the literature review below shows that resource unavailability and exogenous cancellations are, to a certain extent, under the control of hospital management. Hence, our results provide insight in how operating room scheduling and hospital management can interact to alleviate China's hospital overcrowding problems.


                     Section 2 reviews related literature on (surgical) scheduling with cancellations as well as literature on the occurrence and causes of surgical cancellation. Section 3 formally defines the problem and formulates it as a general three-stage model with integer recourse. Section 4 analyzes theoretical model properties which can help to reduce solution times. Section 5 proposes specific solution algorithms for the problem, and finally Section 6 presents numerical results and analysis. The numerical analysis tests the newly developed 3-stage stochastic programming approach by (almost) optimally solving instances derived from 2013 operating room data of Shanghai General Hospital. To this purpose, we fit distributions to the underlying stochastic processes using a complete data set on surgical operations. QQ-plots show that log-normal distributions fit these surgical durations well, and the proposed SAA approach is able to deal with these analytically inconvenient distributions. The computational results provide insight in the benefits attainable by scheduled cancellations for current rates of resource unavailability and exogenous cancellations. Moreover, we consider scenarios in which additional measures are taken to reduce resource unavailability and exogenous cancellations. We conclude by considering practical implications for operating room management and scheduling in China's overcrowded hospitals.

@&#LITERATURE REVIEW@&#

The phenomena of cancellation, no-show and overbooking have been studied extensively in the operations management literature, mostly originating from revenue management applications in the airline industry [42]. In this setting, no-show refers to passengers not showing up for a flight without giving prior notice, and cancellation to passengers cancelling their booked flights in advance (which is different from the definitions for cancellations provided above). Like it is the case in the surgical scheduling problem we consider, revenue management models typically exploit the expected benefits from overbooking capacity, taking into account that penalties must be paid when the eventual number of patients showing up exceeds capacity. For instance Subramanian et al. [40] consider an application which includes no-show, cancellation and overbooking. While the revenue management problems considered in the airline and hotel industry are essentially different from surgical scheduling, they share general properties and solution approaches. For instance, Karaesmen and Van Ryzin [20] present a two-stage stochastic program to model no-show and overbooking, where cancellations have become known in the second stage (as is partially the case in our model). Lai and Ng [25] propose a stochastic network optimization model for hotel revenue management and use robust optimization techniques to deal with cancellations, no-show and over-booking of hotel guests. Overbooking has also been introduced in health care, first and foremost in appointment scheduling for outpatients. For instance LaGanga and Lawrence [24] and Berg et al. [4] use overbooking to hedge against patient no-show and present simulation results showing a significant improvement in access and provider productivity, while increasing both patient wait times and provider overtime.

With regard to surgery scheduling, May et al. [32] conclude from a literature review that ‘it remains to be seen if the existing results and observations regarding manufacturing replanning and rescheduling would extend to surgery’ (where rescheduling refers to the possibility to adjust the initial schedule during execution). Much of the literature on surgical scheduling optimizes the sequence and schedule for a fixed pool of patients while taking the stochastic nature of several problem parameters, especially surgery duration, into account. Mancilla and Storer [31], Denton et al. [12] and Berg et al. [4] simultaneously consider patient waiting time, resource idle time, and overtime. Xiao et al. [47] propose an adaptive scheduling approach for a problem that is closely related to the one considered in this paper, yet without considering cancellation. Stepaniak et al. [39] present a simulation study on cancellation, which they refer to as ‘patient rejection’. Formal scheduling models which explicitly include cancellation, as is particularly relevant for overcrowded hospitals, appear to have received little or no attention in operating room scheduling so far.

The scheduling process we adopt matches a multiple stage stochastic programming approach. Standard two-stage stochastic programs with linear or convex functions are often solved using the L-shaped method or Bender's decomposition [44,6,7]. However, our recourse decision (scheduled cancellations) is still anticipative to further uncertainty, namely the second shift surgery durations, unavailability and cancellations. As such, the decision problem can be viewed as a three-stage recourse model [5,6]. Solving the scheduling problem is further complicated because the recourse function is integer. Laporte and Louveaux [26] propose modified L-shaped decomposition with adjusted optimal cuts for two stage stochastic program with integer recourse. Angulo et al. [1] alternately generate optimal cuts of the linear sub-problem and the integer sub-problem, which improves the practical convergence (see also [15,8]). We follow a sample average approximation approach (SAA) which uses this framework. Moreover, we prove and exploit a specific relationship between the first-stage realization and the optimal number of scheduled cancellations to speed up the computation of integer cuts. We use Jensen's inequality [17] to upper bound the minus second (and third) stage cost, a technique that was proposed by Batun et al. [3].

We now review studies on the occurrence and cause of surgery cancellations. Cancellation of surgery is a common phenomenon globally and appears to be more frequent in developing counties. For instance, Kumar and Gandhi [23] (India) report that 17.6% of scheduled surgeries are canceled on the day of surgery. Several authors, e.g., Kumar and Gandhi [23], Kolawole and Bolaji [22] (Nigeria), Chiu et al. [10] (China), Chalya et al. [9] (Tanzania), analyze causes of cancellation, citing variations and prolonged durations of previous surgeries as a prime source. A Daily Briefing [11] report discusses a case study in the USA in which 6.7% of scheduled surgeries in 2009 are canceled, one-third of which was due to hospital related causes, such as poor scheduling. In addition, Yoon et al. [49] (Korea), Hussain and Khan [16] (Pakistan), Perroca et al. [37] (Brazil) and Fernando et al. [14] (UK) explore cancellations. The latter authors point at the management role to address the inefficiencies that cancellations may cause. The Lancet Commission on Global Surgery posits that management might be even more important in settings in which maximal use of the few available resources is a practical necessity to advance on meeting the unmet global need of 143 million surgeries yearly [33].

Various authors report cancellation rates of between 10% and 15% for Chinese hospitals. Jiang et al. [18] report that 12.88% of children's elective surgeries are canceled in Hunan children's hospital in 2010 due to emergent infection (70.30%), inappropriate preoperative preparation (15.12%), poor scheduling and other factors (14.58%). Jie et al. [19] take a statistical analysis on Guangdong General Hospital, which is a large general hospital, and show that the cancellation rate is at 11.2%. Causes for cancellations are patients' illnesses (65.97%), lack of preoperative preparations (14.03%), economic reasons and risk concerns (10.99%), and accidents (9.01%). (Economic reasons refer to the patients inability to pay.) Li et al. [27] study cancellation at Zunyi Medical College, and report as main causes of cancellation: upper respiratory tract infection (18.39%), high blood pressure (12.86%), lack of preoperative preparation (11.79%), and economic concerns (9.64%). Xiang et al. [46] report a cancellation rate of 5.1% caused by recent changes in health conditions (55.8%), patients' determination changes (23.1%), and poor scheduling. Zhang et al. [50] report a 2010 case study and find that the cancellation rate is 13.9%, due to illnesses (68.7%), exogenous cancellations (20.3%), and preoperative preparations (7.7%). The reader may refer to Xu et al. [48] for related work. Next to scheduling related reasons, several of these authors mention the length of schedules and workload as reasons for scheduled cancellations.

Briefly reflecting on these causes of cancellations, we notice that they are mostly attributed to emergent infection, illness, recent changes in health condition and the like. It is not uncommon that these conditions relate to hospital acquired infections, which are preventable. Procedures for hospitalization and infection prevention may reduce the prevalence of these cancellations. Another important source of cancellation stems from the high out-of-pocket (co-)payments patients have difficulty to effectuate. Improvements in health insurance coverage, as currently in progression, may reduce the number of these economically driven cancellations. In our computational experiments we explore scenarios in which exogenous cancellations are less frequent.

For the single operating room scheduling problem under consideration, we denote by 
                           
                              
                                 t
                              
                              
                                 ^
                              
                           
                         the regular working time. For example, in Shanghai General Hospital, 
                           
                              
                                 t
                              
                              
                                 ^
                              
                           
                         equals 570min (9.5h). An initial schedule is made at least one day ahead. This initial schedule specifies a sequence for the patients and expected starting times of their surgeries. The patients to be scheduled are selected from a given set 
                           
                              I
                              =
                              {
                              1
                              ,
                              2
                              ,
                              …
                              ,
                              
                                 
                                    n
                                 
                                 
                                    p
                                 
                              
                              }
                           
                        . The reward of performing surgery on patient 
                           
                              i
                              ∈
                              I
                           
                         equals r
                        
                           i
                        . This reward can be interpreted strictly financially, in which case it corresponds to the associated hospital revenue [13], or can be defined more broadly to incorporate for instance also the benefits for the patients (see also [47]). Notice that in the latter case, the corresponding values may not be readily available from hospital information systems. Scheduled cancellation of surgery for patient 
                           
                              i
                              ∈
                              I
                           
                         leads to a penalty of c
                        
                           i
                        , which can in turn be a financial penalty incurred by the insurer, including wasted pre-operative costs, and more generally including patient inconveniences and losses of health.

Each patient 
                           
                              i
                              ∈
                              I
                           
                         has an associated surgical time distribution, which will be denoted by 
                           
                              
                                 ξ
                              
                              
                                 i
                              
                              
                                 ′
                              
                           
                        . We assume that the surgery times for different patients are independent. We also include a probability of exogenous cancellation, which will be denoted by 
                           pi
                         for all 
                           
                              i
                              ∈
                              I
                           
                        . There are no rewards for exogenously canceled surgeries and they do not take time except for a constant t
                        
                           d
                         switching time. For each patient 
                           
                              i
                              ∈
                              I
                           
                        , selecting patient i thus consumes 
                           
                              
                                 ξ
                              
                              
                                 i
                              
                              
                                 ′
                              
                           
                         time units of operating theater capacity with probability 
                           
                              1
                              −
                              
                                 
                                    p
                                 
                                 
                                    i
                                 
                              
                           
                        , and t
                        
                           d
                         time units of capacity with probability 
                           pi
                        . We let ξ
                        
                           i
                         represent this compound random variable which equals 
                           
                              
                                 ξ
                              
                              
                                 i
                              
                              
                                 ′
                              
                           
                         with probability 
                           
                              1
                              −
                              
                                 
                                    p
                                 
                                 
                                    i
                                 
                              
                           
                         and t
                        
                           d
                         with probability 
                           pi
                        .

In many practical contexts, a number of patients may have the same characteristics (from the perspective of scheduling), because they have to undergo the same procedure. To accommodate this, if for patients i and 
                           
                              
                                 i
                              
                              
                                 ′
                              
                           
                         we have that 
                           
                              
                                 
                                    r
                                 
                                 
                                    i
                                 
                              
                              =
                              
                                 
                                    r
                                 
                                 
                                    
                                       
                                          i
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                           
                        , 
                           
                              
                                 
                                    c
                                 
                                 
                                    i
                                 
                              
                              =
                              
                                 
                                    c
                                 
                                 
                                    
                                       
                                          i
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                           
                        , 
                           
                              
                                 
                                    p
                                 
                                 
                                    i
                                 
                              
                              =
                              
                                 
                                    p
                                 
                                 
                                    
                                       
                                          i
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                           
                        , and that 
                           
                              
                                 ξ
                              
                              
                                 i
                              
                              
                                 ′
                              
                           
                         and 
                           
                              
                                 ξ
                              
                              
                                 
                                    
                                       i
                                    
                                    
                                       ′
                                    
                                 
                              
                              
                                 ′
                              
                           
                         are identically distributed, then we will say that patients i and 
                           
                              
                                 i
                              
                              
                                 ′
                              
                           
                         belong to the same surgery class. This will be denoted by 
                           
                              i
                              ∼
                              
                                 
                                    i
                                 
                                 
                                    ′
                                 
                              
                           
                        . Let it be noted however that 
                           
                              
                                 ξ
                              
                              
                                 i
                              
                              
                                 ′
                              
                           
                         and 
                           
                              
                                 ξ
                              
                              
                                 
                                    
                                       i
                                    
                                    
                                       ′
                                    
                                 
                              
                              
                                 ′
                              
                           
                         will still be independent. More explicitly, while patients may share characteristics, the surgery time distributions 
                           
                              
                                 ξ
                              
                              
                                 i
                              
                              
                                 ′
                              
                           
                         and 
                           
                              
                                 ξ
                              
                              
                                 
                                    
                                       i
                                    
                                    
                                       ′
                                    
                                 
                              
                              
                                 ′
                              
                           
                         of each pair of patients i and 
                           
                              
                                 i
                              
                              
                                 ′
                              
                           
                         are independent, even if 
                           
                              
                                 ξ
                              
                              
                                 i
                              
                              
                                 ′
                              
                           
                         and 
                           
                              
                                 ξ
                              
                              
                                 
                                    
                                       i
                                    
                                    
                                       ′
                                    
                                 
                              
                              
                                 ′
                              
                           
                         are identically distributed.

As outlined in the introduction, unavailability of surgical resources (staff and/or facilities) is another important source of uncertainty which reduces the effective time available for surgery in the operating room. We thus introduce η
                        1 and η
                        2, which represent the total length of such interruptions in the first and second shift, respectively.

In practice, decision making regarding scheduled cancellations may for instance take place daily at a fixed moment in time (see e.g. [39] for example set this moment at 2 PM). We adopt a different approach, which guarantees a first shift of patients that their surgeries will be scheduled, and allows to inform a second shift of scheduled patients that they will either receive final confirmation or notification of cancellation after the first shift is completed. We consider this approach to be more patient centered as it eliminates uncertainty for the first shift patients and provides clarity to all others after this first shift has been completed. To this purpose, we set the moment of decision making on scheduled cancellations upon completion of half of the scheduled patients (rounded down in case of an odd number of patients). The time of completion of the first shift therefore forms the recourse moment in the proposed multi-stage stochastic programming approach. The second stage thus entails to decide on possible scheduled cancellations of surgeries for patients scheduled in the second shift. After this recourse moment, the second shift surgery durations are revealed and final costs are incurred, making the problem a three-stage recourse model [6].

Following current practice, we assume that scheduled cancellations always regard the last patients in the sequence implied by the surgical schedule, working backwards through the sequence if more than one scheduled patient is canceled. To model the scheduled cancellations we introduce positions. All patients scheduled in the first shift are considered to be in position j=0, because their order is inconsequential from the viewpoint of our model. For the second shift, we introduce positions 
                           
                              j
                              ∈
                              {
                              1
                              ,
                              …
                              ,
                              κ
                              }
                           
                        , that are to be filled sequentially, starting from position 1. We later comment on how to set κ. The set of all positions will be denoted by 
                           
                              {
                              0
                              ,
                              1
                              ,
                              …
                              ,
                              κ
                              }
                           
                        ; this includes the first and second shifts.

We introduce binary decision variables x
                        
                           ij
                        , 
                           
                              i
                              ∈
                              I
                              ,
                              j
                              ∈
                              {
                              0
                              ,
                              1
                              ,
                              …
                              ,
                              κ
                              }
                           
                        , where x
                        
                           ij
                         equals 1 if patient i is scheduled in the jth position, and 0 otherwise. For convenience, let 
                           
                              x
                              =
                              {
                              
                                 
                                    x
                                 
                                 
                                    ij
                                 
                              
                              |
                              i
                              ∈
                              I
                              ,
                              j
                              ∈
                              {
                              0
                              ,
                              1
                              ,
                              …
                              ,
                              κ
                              }
                              }
                           
                        . By interpretation, 
                           
                              
                                 
                                    ∑
                                 
                                 
                                    i
                                    =
                                    1
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          p
                                       
                                    
                                 
                              
                              
                                 
                                    x
                                 
                                 
                                    i
                                    0
                                 
                              
                           
                         represents the number of patients scheduled for the first shift. Second shift slots 
                           
                              j
                              ∈
                              {
                              1
                              ,
                              …
                              ,
                              κ
                              }
                           
                         may contain at most a single patient. To balance the patient numbers between the shifts as described above, we use the restriction 
                           
                              
                                 
                                    ∑
                                 
                                 
                                    i
                                    =
                                    1
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          p
                                       
                                    
                                 
                              
                              
                                 
                                    x
                                 
                                 
                                    i
                                    0
                                 
                              
                              =
                              ⌊
                              
                                 
                                    ∑
                                 
                                 
                                    i
                                    =
                                    1
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          p
                                       
                                    
                                 
                              
                              
                                 
                                    ∑
                                 
                                 
                                    j
                                    =
                                    0
                                 
                                 
                                    κ
                                 
                              
                              
                                 
                                    x
                                 
                                 
                                    ij
                                 
                              
                              /
                              2
                              ⌋
                           
                        , where 
                           
                              ⌊
                              x
                              ⌋
                           
                         is the largest integer no greater than x. We thus need no more than 
                           
                              ⌊
                              
                                 
                                    n
                                 
                                 
                                    p
                                 
                              
                              /
                              2
                              ⌋
                              +
                              1
                           
                         second shift positions, and may set 
                           
                              κ
                              =
                              ⌊
                              
                                 
                                    n
                                 
                                 
                                    p
                                 
                              
                              /
                              2
                              ⌋
                              +
                              1
                           
                         accordingly.

To specify the three-stage recourse model with (integer) recourse, we create i.i.d. copies s
                        
                           i
                         of each random variable ξ
                        
                           i
                        , which will represent the surgery times in the first shift. Variables s
                        
                           i
                         and ξ
                        
                           i
                         follow the same distribution but are independent. We then denote the first shift of the schedule by 
                           
                              s
                              =
                              (
                              
                                 
                                    s
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    s
                                 
                                 
                                    2
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    s
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          p
                                       
                                    
                                 
                              
                              ,
                              
                                 
                                    η
                                 
                                 
                                    1
                                 
                              
                              )
                           
                        , and the second shift by 
                           
                              ξ
                              =
                              (
                              
                                 
                                    ξ
                                 
                                 
                                    1
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    ξ
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          p
                                       
                                    
                                 
                              
                              ,
                              
                                 
                                    η
                                 
                                 
                                    2
                                 
                              
                              )
                           
                        . We set the rewards for patients corresponding to exogenous cancellations to zero. Thus, reward loss due to exogenous cancellations can be modeled as 
                           
                              
                                 
                                    ∑
                                 
                                 
                                    i
                                    =
                                    1
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          p
                                       
                                    
                                 
                              
                              
                                 
                                    I
                                 
                                 
                                    0
                                 
                              
                              (
                              
                                 
                                    s
                                 
                                 
                                    i
                                 
                              
                              )
                              
                                 
                                    r
                                 
                                 
                                    i
                                 
                              
                              
                                 
                                    x
                                 
                                 
                                    i
                                    0
                                 
                              
                           
                        , and the indicator function 
                           
                              
                                 
                                    I
                                 
                                 
                                    0
                                 
                              
                              (
                              
                                 
                                    s
                                 
                                 
                                    i
                                 
                              
                              )
                              =
                              1
                           
                         if s
                        
                           i
                        =t
                        
                           d
                        , and 0 otherwise. Next consider the binary decision variables 
                           
                              
                                 
                                    y
                                 
                                 
                                    ij
                                 
                              
                              (
                              s
                              )
                           
                        , 
                           
                              i
                              ∈
                              I
                              ,
                              j
                              ∈
                              {
                              1
                              ,
                              …
                              ,
                              κ
                              }
                           
                        , which depend on the outcome of 
                           s
                        . We let 
                           
                              
                                 
                                    y
                                 
                                 
                                    ij
                                 
                              
                              (
                              s
                              )
                              =
                              1
                           
                         if treatment of patient i in slot j is canceled under scenario 
                           s
                        , and 
                           
                              
                                 
                                    y
                                 
                                 
                                    ij
                                 
                              
                              (
                              s
                              )
                              =
                              0
                           
                         otherwise. For convenience, let 
                           
                              y
                              =
                              {
                              
                                 
                                    y
                                 
                                 
                                    ij
                                 
                              
                              |
                              i
                              ∈
                              I
                              ,
                              j
                              ∈
                              {
                              1
                              ,
                              …
                              ,
                              κ
                              }
                              }
                           
                        . Scheduled cancellation of patient i results in a penalty 
                           
                              
                                 r
                              
                              
                                 i
                              
                              
                                 ′
                              
                           
                        . Moreover, scheduled cancellations require zero time. The total amount of time that schedule 
                           
                              (
                              x
                              ,
                              y
                              )
                           
                         takes is therefore 
                           
                              
                                 
                                    ∑
                                 
                                 
                                    i
                                    =
                                    1
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          p
                                       
                                    
                                 
                              
                              
                                 
                                    s
                                 
                                 
                                    i
                                 
                              
                              
                                 
                                    x
                                 
                                 
                                    i
                                    0
                                 
                              
                              +
                              
                                 
                                    η
                                 
                                 
                                    1
                                 
                              
                              +
                              
                                 
                                    ∑
                                 
                                 
                                    i
                                    =
                                    1
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          p
                                       
                                    
                                 
                              
                              
                                 
                                    ∑
                                 
                                 
                                    j
                                    =
                                    1
                                 
                                 
                                    κ
                                 
                              
                              [
                              
                                 
                                    x
                                 
                                 
                                    ij
                                 
                              
                              −
                              
                                 
                                    y
                                 
                                 
                                    ij
                                 
                              
                              (
                              s
                              )
                              ]
                              
                                 
                                    ξ
                                 
                                 
                                    i
                                 
                              
                              +
                              
                                 
                                    η
                                 
                                 
                                    2
                                 
                              
                           
                        . The loss of reward in the second stage due to exogenous cancellation is 
                           
                              
                                 
                                    ∑
                                 
                                 
                                    i
                                    =
                                    1
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          p
                                       
                                    
                                 
                              
                              
                                 
                                    ∑
                                 
                                 
                                    j
                                    =
                                    1
                                 
                                 
                                    κ
                                 
                              
                              [
                              
                                 
                                    x
                                 
                                 
                                    ij
                                 
                              
                              −
                              
                                 
                                    y
                                 
                                 
                                    ij
                                 
                              
                              (
                              s
                              )
                              ]
                              
                                 
                                    r
                                 
                                 
                                    i
                                 
                              
                              
                                 
                                    I
                                 
                                 
                                    0
                                 
                              
                              (
                              
                                 
                                    ξ
                                 
                                 
                                    i
                                 
                              
                              )
                           
                        .
                     

We assume that overtime work incurs a cost, which may include financial costs such as salary, employee dissatisfaction, and patient safety risks, which increase with the duration of overtime (see also Section 1). We therefore model the overtime cost function to be piecewise linear and convex, as illustrated in the example in Fig. 2
                        . In the example overtime starts after 570min and overtime cost per time unit becomes more expensive per time unit after 120min of overtime.

We now formulate the scheduling problem as a stochastic program with recourse. For ease of reference, we repeat that 
                           
                              s
                              =
                              (
                              
                                 
                                    s
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    s
                                 
                                 
                                    2
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    s
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          p
                                       
                                    
                                 
                              
                              ,
                              
                                 
                                    η
                                 
                                 
                                    1
                                 
                              
                              )
                           
                         and 
                           
                              ξ
                              =
                              (
                              
                                 
                                    ξ
                                 
                                 
                                    1
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    ξ
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          p
                                       
                                    
                                 
                              
                              ,
                              
                                 
                                    η
                                 
                                 
                                    2
                                 
                              
                              )
                           
                         are the random variables pertaining to the first and second shift, respectively. Note that the recourse decision (scheduled cancellations) must be made after 
                           s
                         is revealed, but based on distributional information on 
                           ξ
                         alone. We obtain the following formulation:
                           
                              (1)
                              
                                 
                                    
                                       
                                          max
                                       
                                       
                                          x
                                          ∈
                                          X
                                       
                                    
                                 
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       =
                                       1
                                    
                                    
                                       
                                          
                                             n
                                          
                                          
                                             p
                                          
                                       
                                    
                                 
                                 
                                    
                                       ∑
                                    
                                    
                                       j
                                       =
                                       0
                                    
                                    
                                       κ
                                    
                                 
                                 
                                    
                                       r
                                    
                                    
                                       i
                                    
                                 
                                 ·
                                 
                                    
                                       x
                                    
                                    
                                       ij
                                    
                                 
                                 −
                                 
                                    
                                       E
                                    
                                    
                                       s
                                    
                                 
                                 Q
                                 (
                                 x
                                 ,
                                 s
                                 )
                              
                           
                        where
                           
                              (2)
                              
                                 
                                    Q
                                    (
                                    
                                       x
                                    
                                    ,
                                    
                                       s
                                    
                                    )
                                    =
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                p
                                             
                                          
                                       
                                    
                                    
                                       
                                          I
                                       
                                       
                                          0
                                       
                                    
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    
                                       
                                          r
                                       
                                       
                                          i
                                       
                                    
                                    
                                       
                                          x
                                       
                                       
                                          i
                                          0
                                       
                                    
                                    +
                                    
                                       
                                          
                                             min
                                          
                                          
                                             
                                                y
                                             
                                             (
                                             
                                                s
                                             
                                             )
                                             ∈
                                             Y
                                             (
                                             
                                                x
                                             
                                             )
                                          
                                       
                                    
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                p
                                             
                                          
                                       
                                    
                                    
                                       
                                          ∑
                                       
                                       
                                          j
                                          =
                                          1
                                       
                                       
                                          κ
                                       
                                    
                                    
                                       
                                          c
                                       
                                       
                                          i
                                       
                                    
                                    
                                       
                                          y
                                       
                                       
                                          ij
                                       
                                    
                                    (
                                    
                                       s
                                    
                                    )
                                    +
                                    
                                       
                                          E
                                       
                                       
                                          ξ
                                       
                                    
                                    [
                                    
                                       D
                                       (
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                i
                                                =
                                                1
                                             
                                             
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      p
                                                   
                                                
                                             
                                          
                                          
                                             
                                                s
                                             
                                             
                                                i
                                             
                                          
                                          
                                             
                                                x
                                             
                                             
                                                i
                                                0
                                             
                                          
                                          +
                                          
                                             
                                                η
                                             
                                             
                                                1
                                             
                                          
                                          +
                                          
                                             
                                                ∑
                                             
                                             
                                                i
                                                =
                                                1
                                             
                                             
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      p
                                                   
                                                
                                             
                                          
                                          
                                             
                                                ∑
                                             
                                             
                                                j
                                                =
                                                1
                                             
                                             
                                                κ
                                             
                                          
                                          [
                                          
                                             
                                                x
                                             
                                             
                                                ij
                                             
                                          
                                          −
                                          
                                             
                                                y
                                             
                                             
                                                ij
                                             
                                          
                                          (
                                          
                                             s
                                          
                                          )
                                          ]
                                          
                                             
                                                ξ
                                             
                                             
                                                i
                                             
                                          
                                          +
                                          
                                             
                                                η
                                             
                                             
                                                2
                                             
                                          
                                       
                                       )
                                       +
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                             =
                                             1
                                          
                                          
                                             
                                                
                                                   n
                                                
                                                
                                                   p
                                                
                                             
                                          
                                       
                                       
                                          
                                             ∑
                                          
                                          
                                             j
                                             =
                                             1
                                          
                                          
                                             κ
                                          
                                       
                                       
                                          
                                             I
                                          
                                          
                                             0
                                          
                                       
                                       (
                                       
                                          
                                             ξ
                                          
                                          
                                             i
                                          
                                       
                                       )
                                       
                                          
                                             r
                                          
                                          
                                             i
                                          
                                       
                                       [
                                       
                                          
                                             x
                                          
                                          
                                             ij
                                          
                                       
                                       −
                                       
                                          
                                             y
                                          
                                          
                                             ij
                                          
                                       
                                       (
                                       
                                          s
                                       
                                       )
                                       ]
                                    
                                    ]
                                    .
                                 
                              
                           
                        
                        
                           X
                         and 
                           
                              Y
                              (
                              x
                              )
                           
                         will be detailed below: They represent the feasible domain for the first and second stage decisions, respectively. In particular, we have
                           
                              (3)
                              
                                 
                                    X
                                    =
                                    
                                       {
                                       
                                          x
                                       
                                       |
                                       (
                                       3
                                       )
                                       –
                                       (
                                       8
                                       )
                                       }
                                    
                                    
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                p
                                             
                                          
                                       
                                    
                                    
                                       
                                          x
                                       
                                       
                                          i
                                          1
                                       
                                    
                                    ≤
                                    1
                                 
                              
                           
                        
                        
                           
                              (4)
                              
                                 
                                    
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                p
                                             
                                          
                                       
                                    
                                    
                                       
                                          x
                                       
                                       
                                          
                                             ij
                                          
                                          +
                                          1
                                       
                                    
                                    −
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                p
                                             
                                          
                                       
                                    
                                    
                                       
                                          x
                                       
                                       
                                          ij
                                       
                                    
                                    ≤
                                    0
                                    ,
                                    
                                    ∀
                                    j
                                    ∈
                                    {
                                    1
                                    ,
                                    …
                                    ,
                                    κ
                                    −
                                    1
                                    }
                                 
                              
                           
                        
                        
                           
                              (5)
                              
                                 
                                    
                                    0
                                    ≤
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                p
                                             
                                          
                                       
                                    
                                    
                                       
                                          ∑
                                       
                                       
                                          j
                                          =
                                          1
                                       
                                       
                                          κ
                                       
                                    
                                    
                                       
                                          x
                                       
                                       
                                          ij
                                       
                                    
                                    −
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                p
                                             
                                          
                                       
                                    
                                    
                                       
                                          x
                                       
                                       
                                          i
                                          0
                                       
                                    
                                    ≤
                                    1
                                 
                              
                           
                        
                        
                           
                              (6)
                              
                                 
                                    
                                    
                                       
                                          ∑
                                       
                                       
                                          j
                                          =
                                          0
                                       
                                       
                                          κ
                                       
                                    
                                    
                                       
                                          x
                                       
                                       
                                          ij
                                       
                                    
                                    ≤
                                    1
                                    ,
                                    
                                    ∀
                                    i
                                    ∈
                                    I
                                 
                              
                           
                        
                        
                           
                              (7)
                              
                                 
                                    
                                    
                                       
                                          x
                                       
                                       
                                          
                                             ij
                                          
                                          +
                                          1
                                       
                                    
                                    ≤
                                    
                                       
                                          ∑
                                       
                                       
                                          k
                                          =
                                          1
                                       
                                       
                                          j
                                       
                                    
                                    
                                       
                                          x
                                       
                                       
                                          
                                             
                                                i
                                             
                                             
                                                ′
                                             
                                          
                                          k
                                       
                                    
                                    ,
                                    
                                    ∀
                                    i
                                    ,
                                    
                                       
                                          i
                                       
                                       
                                          ′
                                       
                                    
                                    ∈
                                    I
                                    :
                                    i
                                    ∼
                                    
                                       
                                          i
                                       
                                       
                                          ′
                                       
                                    
                                    ,
                                    i
                                    <
                                    
                                       
                                          i
                                       
                                       
                                          ′
                                       
                                    
                                    ,
                                     
                                    j
                                    ∈
                                    {
                                    0
                                    ,
                                    …
                                    ,
                                    κ
                                    −
                                    1
                                    }
                                 
                              
                           
                        
                        
                           
                              (8)
                              
                                 
                                    
                                    
                                       
                                          x
                                       
                                       
                                          ij
                                       
                                    
                                    ∈
                                    {
                                    0
                                    ,
                                    1
                                    }
                                    ,
                                    
                                    ∀
                                    i
                                    ∈
                                    I
                                    ,
                                     
                                    j
                                    ∈
                                    {
                                    0
                                    ,
                                    …
                                    ,
                                    κ
                                    }
                                 
                              
                           
                        Combining (3) and (4) ensures that second shift positions 
                           
                              j
                              ∈
                              {
                              1
                              ,
                              …
                              ,
                              κ
                              }
                           
                         are filled sequentially, and with at most a single patient. The workload is balanced by (5), which ensures that the number of patients scheduled in the first shift is equal to the number of patients in the second shift, or one less. Each patient is scheduled at most once by (6). While (7) is not necessary, it greatly reduces the search space by reducing symmetry.

The feasible domain for the second stage decisions depends on the first stage decision 
                           x
                        , and is given by:
                           
                              (9)
                              
                                 
                                    Y
                                    (
                                    
                                       x
                                    
                                    )
                                    =
                                    {
                                    
                                       y
                                    
                                    |
                                    (
                                    9
                                    )
                                    –
                                    (
                                    11
                                    )
                                    }
                                    
                                    
                                       
                                          y
                                       
                                       
                                          
                                             
                                                i
                                             
                                             
                                                ′
                                             
                                          
                                          j
                                       
                                    
                                    −
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                p
                                             
                                          
                                       
                                    
                                    
                                       
                                          y
                                       
                                       
                                          
                                             ij
                                          
                                          +
                                          1
                                       
                                    
                                    ≤
                                    1
                                    −
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                p
                                             
                                          
                                       
                                    
                                    
                                       
                                          x
                                       
                                       
                                          
                                             ij
                                          
                                          +
                                          1
                                       
                                    
                                    ,
                                    
                                    ∀
                                    
                                       
                                          i
                                       
                                       
                                          ′
                                       
                                    
                                    ∈
                                    I
                                    ,
                                     
                                    ∀
                                    j
                                    ∈
                                    {
                                    1
                                    ,
                                    …
                                    ,
                                    κ
                                    −
                                    1
                                    }
                                 
                              
                           
                        
                        
                           
                              (10)
                              
                                 
                                    
                                    
                                       
                                          y
                                       
                                       
                                          ij
                                       
                                    
                                    ≤
                                    
                                       
                                          x
                                       
                                       
                                          ij
                                       
                                    
                                    ,
                                    
                                    ∀
                                    i
                                    ∈
                                    I
                                    ,
                                     
                                    j
                                    ∈
                                    {
                                    1
                                    ,
                                    …
                                    ,
                                    κ
                                    }
                                 
                              
                           
                        
                        
                           
                              (11)
                              
                                 
                                    
                                    
                                       
                                          y
                                       
                                       
                                          ij
                                       
                                    
                                    ∈
                                    {
                                    0
                                    ,
                                    1
                                    }
                                    ,
                                    
                                    ∀
                                    i
                                    ∈
                                    I
                                    ,
                                     
                                    j
                                    ∈
                                    {
                                    1
                                    ,
                                    …
                                    ,
                                    κ
                                    }
                                 
                              
                           
                        We may not cancel a patient in a position unless all patients with higher position are also canceled, which is enforced by (9). Indeed, if a patient is scheduled in position 
                           
                              j
                              +
                              1
                           
                        , then 
                           
                              
                                 
                                    ∑
                                 
                                 
                                    i
                                    =
                                    1
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          p
                                       
                                    
                                 
                              
                              
                                 
                                    x
                                 
                                 
                                    ij
                                    +
                                    1
                                 
                              
                              =
                              1
                           
                        , and (9) enforces that a treatment at position j can only be canceled if a treatment at position 
                           
                              j
                              +
                              1
                           
                         is canceled as well. If no patient is scheduled at position 
                           
                              j
                              +
                              1
                           
                        , then 
                           
                              
                                 
                                    ∑
                                 
                                 
                                    i
                                    =
                                    1
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          p
                                       
                                    
                                 
                              
                              
                                 
                                    x
                                 
                                 
                                    ij
                                    +
                                    1
                                 
                              
                              =
                              0
                           
                        , and we are free to cancel the treatment at position j. Only patients who are actually scheduled may be canceled, which is enforced by (10).

For later convenience, define 
                           
                              
                                 X
                              
                              
                                 ¯
                              
                           
                         and 
                           
                              
                                 Y
                              
                              
                                 ¯
                              
                           
                         as the continuous relaxation of 
                           X
                         and 
                           Y
                        , respectively. Hence, 
                           
                              
                                 
                                    X
                                 
                                 
                                    ¯
                                 
                              
                              =
                              
                                 {
                              
                              
                                 x
                              
                              |
                              (
                              (
                              3
                              )
                              –
                              (
                              7
                              )
                              )
                              +
                              (
                              12
                              )
                              
                                 }
                              
                           
                        , with
                           
                              (12)
                              
                                 
                                    
                                       
                                          x
                                       
                                       
                                          ij
                                       
                                    
                                    ∈
                                    [
                                    0
                                    ,
                                    1
                                    ]
                                    ,
                                    
                                    ∀
                                    i
                                    ∈
                                    I
                                    ,
                                     
                                    j
                                    ∈
                                    {
                                    0
                                    ,
                                    …
                                    ,
                                    κ
                                    }
                                 
                              
                           
                        and 
                           
                              
                                 
                                    Y
                                 
                                 
                                    ¯
                                 
                              
                              (
                              
                                 x
                              
                              )
                              =
                              {
                              
                                 y
                              
                              |
                              (
                              (
                              9
                              )
                              –
                              (
                              10
                              )
                              )
                              +
                              (
                              13
                              )
                              
                                 }
                              
                           
                        , with
                           
                              (13)
                              
                                 
                                    
                                       
                                          y
                                       
                                       
                                          ij
                                       
                                    
                                    ∈
                                    [
                                    0
                                    ,
                                    1
                                    ]
                                    ,
                                    
                                    ∀
                                    i
                                    ∈
                                    I
                                    ,
                                     
                                    j
                                    ∈
                                    {
                                    1
                                    ,
                                    …
                                    ,
                                    κ
                                    }
                                 
                              
                           
                        
                     

For any first stage solution 
                           x
                        , let 
                           
                              
                                 
                                    k
                                 
                                 
                                    max
                                 
                              
                              =
                              
                                 
                                    ∑
                                 
                                 
                                    i
                                    =
                                    1
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          p
                                       
                                    
                                 
                              
                              
                                 
                                    ∑
                                 
                                 
                                    j
                                    =
                                    1
                                 
                                 
                                    κ
                                 
                              
                              
                                 
                                    x
                                 
                                 
                                    ij
                                 
                              
                           
                        . We now present an equivalent formulation of the second stage problem 
                           
                              Q
                              (
                              x
                              ,
                              s
                              )
                           
                        :
                           
                              (14)
                              
                                 
                                    
                                       
                                          Q
                                       
                                       
                                          ˜
                                       
                                    
                                    (
                                    
                                       x
                                    
                                    ,
                                    
                                       s
                                    
                                    )
                                    =
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                p
                                             
                                          
                                       
                                    
                                    
                                       
                                          I
                                       
                                       
                                          0
                                       
                                    
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    
                                       
                                          r
                                       
                                       
                                          i
                                       
                                    
                                    
                                       
                                          x
                                       
                                       
                                          i
                                          0
                                       
                                    
                                    +
                                    
                                       
                                          
                                             min
                                          
                                          
                                             
                                                
                                                   k
                                                
                                                
                                                   s
                                                
                                             
                                             ∈
                                             
                                                Z
                                             
                                             ,
                                             0
                                             ≤
                                             
                                                
                                                   k
                                                
                                                
                                                   s
                                                
                                             
                                             ≤
                                             
                                                
                                                   k
                                                
                                                
                                                   max
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                p
                                             
                                          
                                       
                                    
                                    
                                       
                                          ∑
                                       
                                       
                                          j
                                          =
                                          
                                             
                                                k
                                             
                                             
                                                s
                                             
                                          
                                          +
                                          1
                                       
                                       
                                          κ
                                       
                                    
                                    
                                       
                                          c
                                       
                                       
                                          i
                                       
                                    
                                    
                                       
                                          x
                                       
                                       
                                          ij
                                       
                                    
                                    +
                                    
                                       
                                          E
                                       
                                       
                                          ξ
                                       
                                    
                                    [
                                    
                                       D
                                       [
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                             =
                                             1
                                          
                                          
                                             
                                                
                                                   n
                                                
                                                
                                                   p
                                                
                                             
                                          
                                       
                                       
                                          
                                             s
                                          
                                          
                                             i
                                          
                                       
                                       
                                          
                                             x
                                          
                                          
                                             i
                                             0
                                          
                                       
                                       +
                                       
                                          
                                             η
                                          
                                          
                                             1
                                          
                                       
                                       +
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                             =
                                             1
                                          
                                          
                                             
                                                
                                                   n
                                                
                                                
                                                   p
                                                
                                             
                                          
                                       
                                       
                                          
                                             ∑
                                          
                                          
                                             j
                                             =
                                             1
                                          
                                          
                                             
                                                
                                                   k
                                                
                                                
                                                   s
                                                
                                             
                                          
                                       
                                       
                                          
                                             ξ
                                          
                                          
                                             i
                                          
                                       
                                       
                                          
                                             x
                                          
                                          
                                             ij
                                          
                                       
                                       +
                                       
                                          
                                             η
                                          
                                          
                                             2
                                          
                                       
                                       ]
                                       +
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                             =
                                             1
                                          
                                          
                                             
                                                
                                                   n
                                                
                                                
                                                   p
                                                
                                             
                                          
                                       
                                       
                                          
                                             ∑
                                          
                                          
                                             j
                                             =
                                             1
                                          
                                          
                                             
                                                
                                                   k
                                                
                                                
                                                   s
                                                
                                             
                                          
                                       
                                       
                                          
                                             I
                                          
                                          
                                             0
                                          
                                       
                                       (
                                       
                                          
                                             ξ
                                          
                                          
                                             i
                                          
                                       
                                       )
                                       
                                          
                                             r
                                          
                                          
                                             i
                                          
                                       
                                       
                                          
                                             x
                                          
                                          
                                             ij
                                          
                                       
                                    
                                    ]
                                    ,
                                 
                              
                           
                        (where 
                           
                              
                                 
                                    ∑
                                 
                                 
                                    j
                                    =
                                    1
                                 
                                 
                                    
                                       
                                          k
                                       
                                       
                                          s
                                       
                                    
                                 
                              
                              ≔
                              0
                           
                         when 
                           
                              
                                 
                                    k
                                 
                                 
                                    s
                                 
                              
                              =
                              0
                           
                        ). Clearly, the decision variable 
                           
                              
                                 k
                              
                              
                                 s
                              
                           
                        , which appears as a summation index, makes this formulation non-standard and less suitable for computational purposes. The formulation nevertheless allows to deduce some structural properties.
                           Lemma 1
                           
                              The second stage decision problems 
                              
                                 
                                    Q
                                    (
                                    x
                                    ,
                                    s
                                    )
                                 
                               
                              and 
                              
                                 
                                    
                                       
                                          Q
                                       
                                       
                                          ˜
                                       
                                    
                                    (
                                    x
                                    ,
                                    s
                                    )
                                 
                               
                              are equivalent for any 
                              
                                 
                                    x
                                    ∈
                                    X
                                 
                               
                              and realization of 
                              
                                 s
                              .

In this section we develop a relation between the capacity used by the first shift and the cancellations in the second shift for a fixed schedule 
                           
                              x
                              ∈
                              X
                           
                        . Firstly, we introduce some notations:
                           
                              (16)
                              
                                 
                                    
                                       
                                          s
                                       
                                       
                                          ^
                                       
                                    
                                    =
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                p
                                             
                                          
                                       
                                    
                                    
                                       
                                          x
                                       
                                       
                                          i
                                          0
                                       
                                    
                                    
                                       
                                          s
                                       
                                       
                                          i
                                       
                                    
                                    +
                                    
                                       
                                          η
                                       
                                       
                                          1
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (17)
                              
                                 
                                    R
                                    (
                                    s
                                    )
                                    =
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                p
                                             
                                          
                                       
                                    
                                    
                                       
                                          I
                                       
                                       
                                          0
                                       
                                    
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    
                                       
                                          r
                                       
                                       
                                          i
                                       
                                    
                                    
                                       
                                          x
                                       
                                       
                                          i
                                          0
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (18)
                              
                                 
                                    g
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          ^
                                       
                                    
                                    ,
                                    
                                       
                                          k
                                       
                                       
                                          
                                             
                                                s
                                             
                                             
                                                ^
                                             
                                          
                                       
                                    
                                    )
                                    =
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                p
                                             
                                          
                                       
                                    
                                    
                                       
                                          ∑
                                       
                                       
                                          j
                                          =
                                          
                                             
                                                k
                                             
                                             
                                                
                                                   
                                                      s
                                                   
                                                   
                                                      ^
                                                   
                                                
                                             
                                          
                                          +
                                          1
                                       
                                       
                                          κ
                                       
                                    
                                    
                                       
                                          c
                                       
                                       
                                          i
                                       
                                    
                                    
                                       
                                          x
                                       
                                       
                                          ij
                                       
                                    
                                    +
                                    
                                       
                                          E
                                       
                                       
                                          ξ
                                       
                                    
                                    [
                                    
                                       D
                                       [
                                       
                                          
                                             s
                                          
                                          
                                             ^
                                          
                                       
                                       +
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                             =
                                             1
                                          
                                          
                                             
                                                
                                                   n
                                                
                                                
                                                   p
                                                
                                             
                                          
                                       
                                       
                                          
                                             ∑
                                          
                                          
                                             j
                                             =
                                             1
                                          
                                          
                                             
                                                
                                                   k
                                                
                                                
                                                   
                                                      
                                                         s
                                                      
                                                      
                                                         ^
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             ξ
                                          
                                          
                                             i
                                          
                                       
                                       
                                          
                                             x
                                          
                                          
                                             ij
                                          
                                       
                                       +
                                       
                                          
                                             η
                                          
                                          
                                             2
                                          
                                       
                                       ]
                                       +
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                             =
                                             1
                                          
                                          
                                             
                                                
                                                   n
                                                
                                                
                                                   p
                                                
                                             
                                          
                                       
                                       
                                          
                                             ∑
                                          
                                          
                                             j
                                             =
                                             1
                                          
                                          
                                             
                                                
                                                   k
                                                
                                                
                                                   
                                                      
                                                         s
                                                      
                                                      
                                                         ^
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             I
                                          
                                          
                                             0
                                          
                                       
                                       (
                                       
                                          
                                             ξ
                                          
                                          
                                             i
                                          
                                       
                                       )
                                       
                                          
                                             r
                                          
                                          
                                             i
                                          
                                       
                                       
                                          
                                             x
                                          
                                          
                                             ij
                                          
                                       
                                    
                                    ]
                                 
                              
                           
                        
                        
                           
                              (19)
                              
                                 
                                    f
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          ^
                                       
                                    
                                    )
                                    =
                                    
                                       
                                          
                                             min
                                          
                                          
                                             0
                                             ≤
                                             
                                                
                                                   k
                                                
                                                
                                                   
                                                      
                                                         s
                                                      
                                                      
                                                         ^
                                                      
                                                   
                                                
                                             
                                             ≤
                                             
                                                
                                                   k
                                                
                                                
                                                   max
                                                
                                             
                                          
                                       
                                    
                                    g
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          ^
                                       
                                    
                                    ,
                                    
                                       
                                          k
                                       
                                       
                                          
                                             
                                                s
                                             
                                             
                                                ^
                                             
                                          
                                       
                                    
                                    )
                                 
                              
                           
                        
                        
                           
                              (20)
                              
                                 
                                    
                                       
                                          k
                                       
                                       
                                          
                                             
                                                s
                                             
                                             
                                                ^
                                             
                                          
                                       
                                       
                                          *
                                       
                                    
                                    =
                                    max
                                    [
                                    arg
                                    
                                       
                                          
                                             min
                                          
                                          
                                             0
                                             ≤
                                             
                                                
                                                   k
                                                
                                                
                                                   
                                                      
                                                         s
                                                      
                                                      
                                                         ^
                                                      
                                                   
                                                
                                             
                                             ≤
                                             
                                                
                                                   k
                                                
                                                
                                                   max
                                                
                                             
                                          
                                       
                                    
                                    g
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          ^
                                       
                                    
                                    ,
                                    
                                       
                                          k
                                       
                                       
                                          
                                             
                                                s
                                             
                                             
                                                ^
                                             
                                          
                                       
                                    
                                    )
                                    ]
                                 
                              
                           
                        Thus, we let 
                           
                              
                                 s
                              
                              
                                 ^
                              
                           
                         denote the total realized time of the first shift for a given first stage solution 
                           x
                         and we let 
                           
                              g
                              (
                              
                                 
                                    s
                                 
                                 
                                    ^
                                 
                              
                              ,
                              
                                 
                                    k
                                 
                                 
                                    
                                       
                                          s
                                       
                                       
                                          ^
                                       
                                    
                                 
                              
                              )
                           
                         be the corresponding second stage cost (excluding 
                           
                              R
                              (
                              s
                              )
                           
                        ) when 
                           
                              
                                 k
                              
                              
                                 
                                    
                                       s
                                    
                                    
                                       ^
                                    
                                 
                              
                           
                         patients are kept in the second shift. By 
                           
                              
                                 k
                              
                              
                                 
                                    
                                       s
                                    
                                    
                                       ^
                                    
                                 
                              
                              
                                 *
                              
                           
                        , we denote the optimal number of patients to keep (not scheduled for cancellation), i.e., the index minimizing 
                           
                              g
                              (
                              
                                 
                                    s
                                 
                                 
                                    ^
                                 
                              
                              ,
                              
                                 
                                    k
                                 
                                 
                                    
                                       
                                          s
                                       
                                       
                                          ^
                                       
                                    
                                 
                              
                              )
                           
                        , choosing the largest possible index in case of a tie. The associated minimum cost is denoted by 
                           
                              f
                              (
                              
                                 
                                    s
                                 
                                 
                                    ^
                                 
                              
                              )
                           
                        .
                           Proposition 1
                           
                              Let 
                              
                                 
                                    x
                                    ∈
                                    X
                                 
                               
                              be given, and conditioned on 
                              
                                 
                                    
                                       s
                                    
                                    
                                       ^
                                    
                                 
                              , then 
                              
                                 
                                    g
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          ^
                                       
                                    
                                    ,
                                    
                                       
                                          k
                                       
                                       
                                          
                                             
                                                s
                                             
                                             
                                                ^
                                             
                                          
                                       
                                    
                                    )
                                 
                               
                              is a supermodular function.


                              Let 
                              
                                 
                                    x
                                    ∈
                                    X
                                 
                               
                              be given, and consider two realizations of the total time of the first shift: 
                                 
                                    
                                       
                                          
                                             s
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       1
                                    
                                 
                               
                              and 
                              
                                 
                                    
                                       
                                          
                                             s
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                               
                              with 
                              
                                 
                                    
                                       
                                          
                                             
                                                s
                                             
                                             
                                                ^
                                             
                                          
                                       
                                       
                                          1
                                       
                                    
                                    ≤
                                    
                                       
                                          
                                             
                                                s
                                             
                                             
                                                ^
                                             
                                          
                                       
                                       
                                          2
                                       
                                    
                                 
                              , then 
                              
                                 
                                    
                                       
                                          k
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      s
                                                   
                                                   
                                                      ^
                                                   
                                                
                                             
                                             
                                                1
                                             
                                          
                                       
                                       
                                          *
                                       
                                    
                                    ≥
                                    
                                       
                                          k
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      s
                                                   
                                                   
                                                      ^
                                                   
                                                
                                             
                                             
                                                2
                                             
                                          
                                       
                                       
                                          *
                                       
                                    
                                 
                              .

We now rewrite the second stage cost function (18) conditioned on 
                           
                              
                                 s
                              
                              
                                 ^
                              
                           
                         as follows: 
                           
                              F
                              (
                              
                                 
                                    s
                                 
                                 
                                    ^
                                 
                              
                              ,
                              y
                              )
                              =
                              
                                 
                                    ∑
                                 
                                 
                                    i
                                    =
                                    1
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          p
                                       
                                    
                                 
                              
                              
                                 
                                    ∑
                                 
                                 
                                    j
                                    =
                                    1
                                 
                                 
                                    κ
                                 
                              
                              
                                 
                                    c
                                 
                                 
                                    i
                                 
                              
                              ·
                              
                                 
                                    y
                                 
                                 
                                    ij
                                 
                              
                              +
                           
                           
                              
                                 
                                    E
                                 
                                 
                                    ξ
                                 
                              
                              [
                              
                                 D
                                 [
                                 
                                    
                                       s
                                    
                                    
                                       ^
                                    
                                 
                                 +
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       =
                                       1
                                    
                                    
                                       
                                          
                                             n
                                          
                                          
                                             p
                                          
                                       
                                    
                                 
                                 
                                    
                                       ∑
                                    
                                    
                                       j
                                       =
                                       1
                                    
                                    
                                       κ
                                    
                                 
                                 
                                    
                                       ξ
                                    
                                    
                                       i
                                    
                                 
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       ij
                                    
                                 
                                 −
                                 
                                    
                                       y
                                    
                                    
                                       ij
                                    
                                 
                                 )
                                 +
                                 
                                    
                                       η
                                    
                                    
                                       2
                                    
                                 
                                 ]
                                 +
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       =
                                       1
                                    
                                    
                                       
                                          
                                             n
                                          
                                          
                                             p
                                          
                                       
                                    
                                 
                                 
                                    
                                       ∑
                                    
                                    
                                       j
                                       =
                                       1
                                    
                                    
                                       κ
                                    
                                 
                                 
                                    
                                       I
                                    
                                    
                                       0
                                    
                                 
                                 (
                                 
                                    
                                       ξ
                                    
                                    
                                       i
                                    
                                 
                                 )
                                 
                                    
                                       r
                                    
                                    
                                       i
                                    
                                 
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       ij
                                    
                                 
                                 −
                                 
                                    
                                       y
                                    
                                    
                                       ij
                                    
                                 
                                 )
                              
                              ]
                           
                        . Because the L-shaped method requires convexity, the following result is helpful to solve the relaxed model with continuous recourse:
                           Lemma 2
                           
                              Let 
                              
                                 
                                    x
                                    ∈
                                    
                                       
                                          X
                                       
                                       
                                          ¯
                                       
                                    
                                 
                               
                              be given and 
                              
                                 
                                    
                                       s
                                    
                                    
                                       ^
                                    
                                 
                               
                              be defined by 
                              (16), then 
                              
                                 
                                    F
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          ^
                                       
                                    
                                    ,
                                    y
                                    )
                                 
                               
                              is convex in 
                              
                                 
                                    y
                                    ∈
                                    
                                       
                                          Y
                                       
                                       
                                          ¯
                                       
                                    
                                    (
                                    x
                                    )
                                 
                              .

We conclude this section by a general convexity result for the minimum cost function of the continuous relaxation of the second stage problem, which is further used in Section 4.2.
                           Proposition 3
                           
                              Let 
                              
                                 
                                    x
                                    ∈
                                    X
                                 
                               
                              be given and 
                              
                                 
                                    
                                       s
                                    
                                    
                                       ^
                                    
                                 
                               
                              be defined by 
                              (16), then 
                              
                                 
                                    f
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          ^
                                       
                                    
                                    )
                                    =
                                    
                                       
                                          min
                                       
                                       
                                          y
                                          ∈
                                          
                                             
                                                Y
                                             
                                             
                                                ¯
                                             
                                          
                                       
                                    
                                    F
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          ^
                                       
                                    
                                    ,
                                    y
                                    )
                                 
                               
                              and 
                              
                                 
                                    f
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          ^
                                       
                                    
                                    )
                                 
                               
                              is convex in 
                              
                                 
                                    
                                       s
                                    
                                    
                                       ^
                                    
                                 
                              . Besides, 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                p
                                             
                                          
                                       
                                    
                                    
                                       
                                          I
                                       
                                       
                                          0
                                       
                                    
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    
                                       
                                          r
                                       
                                       
                                          i
                                       
                                    
                                    
                                       
                                          x
                                       
                                       
                                          i
                                          0
                                       
                                    
                                 
                               
                              is also convex in 
                              
                                 s
                              .

We now proceed to derive optimality cuts for the integral master problem and its continuous relaxation on the basis of Jensen's inequality. By Proposition 3 and Lemma 1, we can apply Jensen's inequality [17] to obtain
                           
                              (21)
                              
                                 
                                    E
                                    (
                                    f
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          ^
                                       
                                    
                                    )
                                    +
                                    R
                                    (
                                    s
                                    )
                                    )
                                    ≥
                                    f
                                    (
                                    E
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          ^
                                       
                                    
                                    )
                                    )
                                    +
                                    R
                                    (
                                    E
                                    (
                                    s
                                    )
                                    )
                                 
                              
                           
                        By definition, 
                           
                              
                                 
                                    min
                                 
                                 
                                    y
                                    ∈
                                    Y
                                 
                              
                              F
                              (
                              
                                 
                                    s
                                 
                                 
                                    ^
                                 
                              
                              ,
                              y
                              )
                              ≥
                              f
                              (
                              
                                 
                                    s
                                 
                                 
                                    ^
                                 
                              
                              )
                           
                         for 
                           
                              ∀
                              
                                 
                                    s
                                 
                                 
                                    ^
                                 
                              
                           
                        . Now, by taking expectation on both sides and using inequality (21), we can further derive that
                           
                              (22)
                              
                                 
                                    E
                                    (
                                    
                                       
                                          
                                             
                                                min
                                             
                                             
                                                y
                                                ∈
                                                Y
                                             
                                          
                                       
                                       F
                                       (
                                       
                                          
                                             s
                                          
                                          
                                             ^
                                          
                                       
                                       ,
                                       y
                                       )
                                       +
                                       R
                                       (
                                       s
                                       )
                                    
                                    )
                                    ≥
                                    f
                                    (
                                    E
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          ^
                                       
                                    
                                    )
                                    )
                                    +
                                    R
                                    (
                                    E
                                    (
                                    s
                                    )
                                    )
                                 
                              
                           
                        We will use inequalities (21) and (22) to strengthen our L-shaped algorithm by formulating valid inequalities for continuous and integral master problems, cf. Batun et al. [3].

As our research questions require to compare the optimal solutions of various models and parameter settings, we now set out to describe solution techniques designed to present near to optimal solutions. More specifically we present a solution method based on SAA in Section 5.2. Because of the stochasticity still involved after the second stage, we require many samples to accurately represent the stochastic nature of the problem, which makes the SAA approach non-standard and computationally challenging. We use the theoretical results derived in Section 4 to reduce the computation times required to solve the SAA in Section 5.3. In Appendix B.2, the resulting formulation is strengthened using Jensen's inequalities.

In order to formulate the SAA as a MIP, we linearize the objective function by writing the overtime cost function as follows:
                           
                              
                                 
                                    D
                                    (
                                    x
                                    )
                                    =
                                    
                                       
                                          
                                             min
                                          
                                          
                                             
                                                
                                                   ϕ
                                                
                                                
                                                   v
                                                
                                             
                                          
                                       
                                    
                                    
                                    
                                       
                                          ∑
                                       
                                       
                                          v
                                          =
                                          0
                                       
                                       
                                          q
                                       
                                    
                                    
                                       
                                          τ
                                       
                                       
                                          v
                                       
                                    
                                    
                                       
                                          ϕ
                                       
                                       
                                          v
                                       
                                    
                                    s.t.
                                    
                                    
                                       
                                          ∑
                                       
                                       
                                          v
                                          =
                                          0
                                       
                                       
                                          q
                                       
                                    
                                    
                                       
                                          ϕ
                                       
                                       
                                          v
                                       
                                    
                                    =
                                    x
                                    
                                    
                                       
                                          ϕ
                                       
                                       
                                          v
                                       
                                    
                                    ∈
                                    [
                                    0
                                    ,
                                    
                                       
                                          l
                                       
                                       
                                          v
                                       
                                    
                                    ]
                                 
                              
                           
                        Note that each piecewise linear convex function on 
                           
                              [
                              0
                              ,
                              ∞
                              )
                           
                         with 
                           
                              q
                              +
                              1
                           
                         breakpoints can be written in this fashion. Here, the length of interval 
                           
                              v
                              ∈
                              {
                              0
                              ,
                              …
                              ,
                              q
                              }
                           
                         is l
                        
                           v
                        , and its slope is τ
                        
                           v
                        . The slopes should satisfy 
                           
                              
                                 
                                    τ
                                 
                                 
                                    u
                                 
                              
                              ≥
                              
                                 
                                    τ
                                 
                                 
                                    v
                                 
                              
                           
                         for 
                           
                              u
                              ≥
                              v
                           
                        .

For the SAA, we use 
                           
                              
                                 n
                              
                              
                                 ^
                              
                           
                         independent samples of 
                           s
                        , for which we will use the index 
                           
                              n
                              ∈
                              {
                              1
                              ,
                              …
                              ,
                              
                                 
                                    n
                                 
                                 
                                    ^
                                 
                              
                              }
                           
                        , and 
                           
                              
                                 m
                              
                              
                                 ^
                              
                           
                         independent samples of 
                           ξ
                        , for which we will use the index 
                           
                              m
                              ∈
                              {
                              1
                              ,
                              …
                              ,
                              
                                 
                                    m
                                 
                                 
                                    ^
                                 
                              
                              }
                           
                        . Denote the first shift surgery time for patient i for sample n by s
                        
                           in
                        , and the time lost due to resource unavailability by η
                        1n
                        . Denote the second shift surgery time and time lost due to resource unavailability for sample m by ξ
                        
                           im
                         and η
                        2m
                        , respectively. Solving the problem consists in finding first stage decisions 
                           
                              x
                              =
                              {
                              
                                 
                                    x
                                 
                                 
                                    ij
                                 
                              
                              |
                              i
                              ∈
                              I
                              ,
                              j
                              ∈
                              {
                              0
                              ,
                              1
                              ,
                              …
                              ,
                              κ
                              }
                              }
                           
                        , and for each sample 
                           
                              n
                              ∈
                              {
                              1
                              ,
                              …
                              ,
                              
                                 
                                    n
                                 
                                 
                                    ^
                                 
                              
                              }
                           
                         a second stage decision 
                           
                              y
                              (
                              n
                              )
                              =
                              {
                              
                                 
                                    y
                                 
                                 
                                    ij
                                 
                              
                              (
                              n
                              )
                              |
                              i
                              ∈
                              I
                              ,
                              j
                              ∈
                              {
                              0
                              ,
                              1
                              ,
                              …
                              ,
                              κ
                              }
                              }
                           
                        , such that each 
                           
                              y
                              (
                              n
                              )
                              ∈
                              Y
                              (
                              x
                              )
                           
                        . Here, 
                           
                              y
                              (
                              n
                              )
                           
                         is short for 
                           
                              y
                              (
                              
                                 
                                    s
                                 
                                 
                                    n
                                 
                              
                              )
                           
                        .

We now formulate the associated sample average approximation (SAA) for (1):
                           
                              (23)
                              
                                 
                                    
                                       
                                          max
                                       
                                       
                                          x
                                          ∈
                                          X
                                       
                                    
                                 
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       =
                                       1
                                    
                                    
                                       
                                          
                                             n
                                          
                                          
                                             p
                                          
                                       
                                    
                                 
                                 
                                    
                                       ∑
                                    
                                    
                                       j
                                       =
                                       0
                                    
                                    
                                       κ
                                    
                                 
                                 
                                    
                                       r
                                    
                                    
                                       i
                                    
                                 
                                 ·
                                 
                                    
                                       x
                                    
                                    
                                       ij
                                    
                                 
                                 −
                                 
                                    
                                       1
                                    
                                    
                                       
                                          
                                             n
                                          
                                          
                                             ^
                                          
                                       
                                    
                                 
                                 
                                    
                                       ∑
                                    
                                    
                                       n
                                       =
                                       1
                                    
                                    
                                       
                                          
                                             n
                                          
                                          
                                             ^
                                          
                                       
                                    
                                 
                                 Q
                                 (
                                 x
                                 ,
                                 n
                                 )
                              
                           
                        where
                           
                              (24)
                              
                                 
                                    Q
                                    (
                                    x
                                    ,
                                    n
                                    )
                                    =
                                    
                                       
                                          
                                             min
                                          
                                          
                                             y
                                             (
                                             n
                                             )
                                             ,
                                             l
                                          
                                       
                                    
                                    
                                    l
                                    +
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                p
                                             
                                          
                                       
                                    
                                    
                                       
                                          ∑
                                       
                                       
                                          j
                                          =
                                          1
                                       
                                       
                                          κ
                                       
                                    
                                    
                                       
                                          c
                                       
                                       
                                          i
                                       
                                    
                                    
                                       
                                          y
                                       
                                       
                                          ij
                                       
                                    
                                    (
                                    n
                                    )
                                    +
                                    
                                       
                                          1
                                       
                                       
                                          
                                             
                                                m
                                             
                                             
                                                ^
                                             
                                          
                                       
                                    
                                    
                                       
                                          ∑
                                       
                                       
                                          m
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                m
                                             
                                             
                                                ^
                                             
                                          
                                       
                                    
                                    [
                                    
                                       (
                                       
                                          
                                             ∑
                                          
                                          
                                             v
                                             =
                                             0
                                          
                                          
                                             q
                                          
                                       
                                       
                                          
                                             τ
                                          
                                          
                                             v
                                          
                                       
                                       
                                          
                                             ϕ
                                          
                                          
                                             v
                                          
                                       
                                       (
                                       n
                                       ,
                                       m
                                       )
                                       )
                                       
                                       −
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                             =
                                             1
                                          
                                          
                                             
                                                
                                                   n
                                                
                                                
                                                   p
                                                
                                             
                                          
                                       
                                       
                                          
                                             ∑
                                          
                                          
                                             j
                                             =
                                             1
                                          
                                          
                                             κ
                                          
                                       
                                       
                                          
                                             I
                                          
                                          
                                             0
                                          
                                       
                                       (
                                       
                                          
                                             ξ
                                          
                                          
                                             mi
                                          
                                       
                                       )
                                       
                                          
                                             r
                                          
                                          
                                             i
                                          
                                       
                                       
                                          
                                             y
                                          
                                          
                                             ij
                                          
                                       
                                       (
                                       n
                                       )
                                    
                                    ]
                                 
                              
                           
                        
                        
                           
                              (25)
                              
                                 
                                    s.t.
                                    
                                    l
                                    ≥
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                p
                                             
                                          
                                       
                                    
                                    
                                       
                                          I
                                       
                                       
                                          0
                                       
                                    
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          in
                                       
                                    
                                    )
                                    
                                       
                                          r
                                       
                                       
                                          i
                                       
                                    
                                    
                                       
                                          x
                                       
                                       
                                          i
                                          0
                                       
                                    
                                    +
                                    
                                       
                                          1
                                       
                                       
                                          
                                             
                                                m
                                             
                                             
                                                ^
                                             
                                          
                                       
                                    
                                    
                                       
                                          ∑
                                       
                                       
                                          m
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                m
                                             
                                             
                                                ^
                                             
                                          
                                       
                                    
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                p
                                             
                                          
                                       
                                    
                                    
                                       
                                          ∑
                                       
                                       
                                          j
                                          =
                                          1
                                       
                                       
                                          κ
                                       
                                    
                                    
                                       
                                          I
                                       
                                       
                                          0
                                       
                                    
                                    (
                                    
                                       
                                          ξ
                                       
                                       
                                          mi
                                       
                                    
                                    )
                                    
                                       
                                          r
                                       
                                       
                                          i
                                       
                                    
                                    
                                       
                                          x
                                       
                                       
                                          ij
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (26)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          v
                                          =
                                          0
                                       
                                       
                                          q
                                       
                                    
                                    
                                       
                                          φ
                                       
                                       
                                          v
                                       
                                    
                                    (
                                    n
                                    ,
                                    m
                                    )
                                    =
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                p
                                             
                                          
                                       
                                    
                                    
                                       
                                          ∑
                                       
                                       
                                          j
                                          =
                                          1
                                       
                                       
                                          κ
                                       
                                    
                                    
                                       
                                          ξ
                                       
                                       
                                          mi
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          ij
                                       
                                    
                                    −
                                    
                                       
                                          y
                                       
                                       
                                          ij
                                       
                                    
                                    (
                                    n
                                    )
                                    )
                                    +
                                    
                                       
                                          η
                                       
                                       
                                          2
                                          m
                                       
                                    
                                    +
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          1
                                       
                                       
                                          p
                                       
                                    
                                    
                                       
                                          s
                                       
                                       
                                          in
                                       
                                    
                                    
                                       
                                          x
                                       
                                       
                                          i
                                          0
                                       
                                    
                                    +
                                    
                                       
                                          η
                                       
                                       
                                          1
                                          n
                                       
                                    
                                    ,
                                    
                                    ∀
                                    n
                                    ∈
                                    {
                                    1
                                    ,
                                    …
                                    ,
                                    
                                       
                                          n
                                       
                                       
                                          ^
                                       
                                    
                                    }
                                    ,
                                     
                                    m
                                    ∈
                                    {
                                    1
                                    ,
                                    …
                                    ,
                                    
                                       
                                          m
                                       
                                       
                                          ^
                                       
                                    
                                    }
                                 
                              
                           
                        
                        
                           
                              (27)
                              
                                 
                                    
                                       
                                          φ
                                       
                                       
                                          v
                                       
                                    
                                    (
                                    n
                                    ,
                                    m
                                    )
                                    ∈
                                    [
                                    0
                                    ,
                                    
                                       
                                          l
                                       
                                       
                                          v
                                       
                                    
                                    ]
                                    ,
                                    
                                    ∀
                                    n
                                    ∈
                                    {
                                    1
                                    ,
                                    …
                                    ,
                                    
                                       
                                          n
                                       
                                       
                                          ^
                                       
                                    
                                    }
                                    ,
                                     
                                    m
                                    ∈
                                    {
                                    1
                                    ,
                                    …
                                    ,
                                    
                                       
                                          m
                                       
                                       
                                          ^
                                       
                                    
                                    }
                                    ,
                                     
                                    v
                                    ∈
                                    {
                                    0
                                    ,
                                    …
                                    ,
                                    q
                                    }
                                 
                              
                           
                        
                        
                           
                              (28)
                              
                                 
                                    y
                                    (
                                    n
                                    )
                                    ∈
                                    Y
                                    (
                                    x
                                    )
                                    ,
                                    
                                    ∀
                                    n
                                    ∈
                                    {
                                    1
                                    ,
                                    …
                                    ,
                                    n
                                    }
                                 
                              
                           
                        where l is introduced to simplify the formulation. Note that by definition, the set inclusions 
                           
                              x
                              ∈
                              X
                           
                         and 
                           
                              y
                              (
                              n
                              )
                              ∈
                              Y
                              (
                              x
                              )
                           
                         can be expressed using linear inequalities and binary variables. For example, 
                           
                              y
                              (
                              n
                              )
                              ∈
                              Y
                              (
                              x
                              )
                           
                         can be expressed using (9)–(11), with y
                        
                           ij
                        (n) taking the place of y
                        
                           ij
                        . We let 
                           
                              Q
                              (
                              x
                              )
                              =
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          n
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                ^
                                             
                                          
                                       
                                    
                                    Q
                                    (
                                    x
                                    ,
                                    n
                                    )
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          ^
                                       
                                    
                                 
                              
                           
                        .

For the L-shaped method introduced in Section 5.3 we will also use the continuous recourse relaxation 
                           
                              
                                 
                                    Q
                                 
                                 
                                    LP
                                 
                              
                              (
                              x
                              ,
                              n
                              )
                           
                         of 
                           
                              Q
                              (
                              x
                              ,
                              n
                              )
                           
                        , which is obtained by relaxing (28) to
                           
                              (29)
                              
                                 
                                    y
                                    (
                                    n
                                    )
                                    ∈
                                    
                                       
                                          Y
                                       
                                       
                                          ¯
                                       
                                    
                                    (
                                    x
                                    )
                                    .
                                 
                              
                           
                        We let 
                           
                              
                                 
                                    Q
                                 
                                 
                                    LP
                                 
                              
                              (
                              x
                              )
                              =
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          n
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                ^
                                             
                                          
                                       
                                    
                                    
                                       
                                          Q
                                       
                                       
                                          LP
                                       
                                    
                                    (
                                    x
                                    ,
                                    n
                                    )
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          ^
                                       
                                    
                                 
                              
                           
                        .

The L-shaped method iteratively generates feasibility and optimality cuts. For the problem under consideration, only optimality cuts are needed. Denote the set of generated optimality cuts by Θ. Each optimality cut provides a lower bound to the second stage cost. That is, for every 
                           
                              x
                              ∈
                              X
                           
                         and 
                           
                              (
                              
                                 
                                    v
                                 
                                 
                                    k
                                 
                              
                              ,
                              
                                 
                                    ρ
                                 
                                 
                                    k
                                 
                              
                              )
                              ∈
                              Θ
                           
                         we have that 
                           
                              Q
                              (
                              x
                              )
                              ≥
                              
                                 
                                    v
                                 
                                 
                                    k
                                 
                                 
                                    T
                                 
                              
                              x
                              +
                              
                                 
                                    ρ
                                 
                                 
                                    k
                                 
                              
                           
                         and 
                           
                              −
                              Q
                              (
                              x
                              )
                              ≤
                              −
                              
                                 
                                    v
                                 
                                 
                                    k
                                 
                                 
                                    T
                                 
                              
                              x
                              −
                              
                                 
                                    ρ
                                 
                                 
                                    k
                                 
                              
                           
                         
                        [26] (here 
                           
                              
                                 v
                              
                              
                                 k
                              
                              
                                 T
                              
                           
                         is the transpose of 
                           
                              
                                 
                                    v
                                 
                                 
                                    k
                                 
                              
                              )
                           
                        .
                           
                              (30)
                              
                                 
                                    
                                       
                                          max
                                       
                                       
                                          x
                                       
                                    
                                 
                                 
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       =
                                       1
                                    
                                    
                                       
                                          
                                             n
                                          
                                          
                                             p
                                          
                                       
                                    
                                 
                                 
                                    
                                       ∑
                                    
                                    
                                       j
                                       =
                                       0
                                    
                                    
                                       κ
                                    
                                 
                                 
                                    
                                       r
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       x
                                    
                                    
                                       ij
                                    
                                 
                                 +
                                 θ
                              
                           
                        
                        
                           
                              (31)
                              
                                 
                                    
                                       s.t.
                                    
                                    
                                    θ
                                    ≤
                                    −
                                    
                                       
                                          v
                                       
                                       
                                          k
                                       
                                       
                                          T
                                       
                                    
                                    
                                       x
                                    
                                    −
                                    
                                       
                                          ρ
                                       
                                       
                                          k
                                       
                                    
                                    ,
                                    
                                    ∀
                                    (
                                    
                                       
                                          v
                                       
                                       
                                          k
                                       
                                    
                                    ,
                                    
                                       
                                          ρ
                                       
                                       
                                          k
                                       
                                    
                                    )
                                    ∈
                                    Θ
                                 
                              
                           
                        
                        
                           
                              (32)
                              
                                 
                                    x
                                    ∈
                                    X
                                 
                              
                           
                        Notice that θ bounds the minus of the second stage cost, i.e., θ bounds 
                           
                              −
                              Q
                              (
                              x
                              )
                           
                        . We will also refer to the relaxed master problem, in which (32) is replaced by 
                           
                              x
                              ∈
                              
                                 
                                    X
                                 
                                 
                                    ¯
                                 
                              
                           
                        . In order to strengthen both the master problem and the relaxed master problem, Jensen's inequality is added in the form of an additional constraint involving θ (cf. Appendix B.2).

In the course of our algorithm, we will generate two types of cuts. For the first type, which will be referred to as continuous recourse optimality cuts, we note that for every 
                           
                              
                                 
                                    x
                                 
                                 
                                    l
                                 
                              
                              ∈
                              
                                 
                                    X
                                 
                                 
                                    ¯
                                 
                              
                           
                        , we can use Benders' decomposition [6] to obtain a cut 
                           
                              (
                              v
                              ,
                              ρ
                              )
                           
                         such that 
                           
                              
                                 
                                    v
                                 
                                 
                                    T
                                 
                              
                              
                                 
                                    x
                                 
                                 
                                    l
                                 
                              
                              +
                              ρ
                              =
                              
                                 
                                    Q
                                 
                                 
                                    LP
                                 
                              
                              (
                              
                                 
                                    x
                                 
                                 
                                    l
                                 
                              
                              )
                           
                        . That is, at 
                           
                              
                                 x
                              
                              
                                 l
                              
                           
                         the cut is tight for the continuous recourse relaxation.

For the second type, which will be referred to as integer optimality cuts, note that for every 
                           
                              
                                 
                                    x
                                 
                                 
                                    l
                                 
                              
                              ∈
                              X
                           
                         we may compute 
                           
                              Q
                              (
                              
                                 
                                    x
                                 
                                 
                                    l
                                 
                              
                              )
                           
                         by solving the integer second-stage problems. We can then generate a cut 
                           
                              (
                              v
                              ,
                              ρ
                              )
                           
                         that represents the inequality 
                           
                              θ
                              ≤
                              −
                              (
                              Q
                              (
                              
                                 
                                    x
                                 
                                 
                                    l
                                 
                              
                              )
                              −
                              
                                 
                                    l
                                 
                                 
                                    0
                                 
                              
                              )
                              (
                              
                                 
                                    ∑
                                 
                                 
                                    (
                                    i
                                    ,
                                    j
                                    )
                                    ∈
                                    S
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          l
                                       
                                    
                                    )
                                 
                              
                              
                                 
                                    x
                                 
                                 
                                    ij
                                 
                              
                              −
                              
                                 
                                    ∑
                                 
                                 
                                    (
                                    i
                                    ,
                                    j
                                    )
                                    ∉
                                    S
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          l
                                       
                                    
                                    )
                                 
                              
                              
                                 
                                    x
                                 
                                 
                                    ij
                                 
                              
                              −
                              |
                              S
                              (
                              
                                 
                                    x
                                 
                                 
                                    l
                                 
                              
                              )
                              |
                              )
                              −
                              Q
                              (
                              
                                 
                                    x
                                 
                                 
                                    l
                                 
                              
                              )
                           
                        . Here 
                           
                              S
                              (
                              
                                 
                                    x
                                 
                                 
                                    l
                                 
                              
                              )
                              =
                              {
                              (
                              i
                              ,
                              j
                              )
                              |
                              
                                 
                                    x
                                 
                                 
                                    lij
                                 
                              
                              =
                              1
                              }
                           
                        . The constant l
                        0 is a lower bound of 
                           
                              Q
                              (
                              x
                              )
                           
                         over 
                           
                              x
                              ∈
                              X
                           
                         
                        [1]. We can set 
                           
                              
                                 
                                    l
                                 
                                 
                                    0
                                 
                              
                              =
                              0
                           
                         in our case.

To efficiently compute 
                           
                              Q
                              (
                              x
                              )
                           
                        , we apply the submodularity result derived in Section 4.1. More precisely, the procedure can be described as follows:
                           
                              (a)
                              Let Π be a set containing information on cancellations, and initially 
                                    
                                       Π
                                       =
                                       ∅
                                    
                                 , x is a given first stage solution, n=1;

If n=1, calculate its first stage realization 
                                    
                                       
                                          
                                             
                                                s
                                             
                                             
                                                ^
                                             
                                          
                                       
                                       
                                          n
                                       
                                    
                                  by (16), get its objective value 
                                    
                                       Q
                                       (
                                       x
                                       ,
                                       n
                                       )
                                    
                                  and cancellation decision 
                                    
                                       y
                                       (
                                       n
                                       )
                                    
                                  by integer subproblem (24)–(28), and meanwhile store a triple (
                                    
                                       
                                          
                                             
                                                s
                                             
                                             
                                                ^
                                             
                                          
                                       
                                       
                                          n
                                       
                                    
                                 , 
                                    
                                       
                                          
                                             
                                                s
                                             
                                             
                                                ^
                                             
                                          
                                       
                                       
                                          n
                                       
                                    
                                 , 
                                    
                                       y
                                       (
                                       n
                                       )
                                    
                                 ) into Π, here 
                                    
                                       
                                          
                                             
                                                s
                                             
                                             
                                                ^
                                             
                                          
                                       
                                       
                                          n
                                       
                                    
                                  acts as both a lower bound (LB) and an upper bound (UB) of first stage realization values that lead to cancellation decision 
                                    
                                       y
                                       (
                                       n
                                       )
                                    
                                 , 
                                    
                                       n
                                       =
                                       n
                                       +
                                       1
                                    
                                 ;

If 
                                    
                                       n
                                       ≤
                                       
                                          
                                             n
                                          
                                          
                                             ^
                                          
                                       
                                    
                                 , calculate first stage realization 
                                    
                                       
                                          
                                             
                                                s
                                             
                                             
                                                ^
                                             
                                          
                                       
                                       
                                          n
                                       
                                    
                                  by (16),
                                    
                                       1. if 
                                             
                                                
                                                   
                                                      
                                                         s
                                                      
                                                      
                                                         ^
                                                      
                                                   
                                                
                                                
                                                   n
                                                
                                             
                                           falls in 
                                             
                                                [
                                                
                                                   
                                                      LB
                                                   
                                                   
                                                      π
                                                   
                                                
                                                ,
                                                
                                                   
                                                      UB
                                                   
                                                   
                                                      π
                                                   
                                                
                                                ]
                                             
                                           of any triple π in Π, then we directly get its optimal cancellation decision the same as 
                                             
                                                
                                                   y
                                                
                                                
                                                   π
                                                
                                             
                                          , evaluate its objective value 
                                             
                                                Q
                                                (
                                                x
                                                ,
                                                n
                                                )
                                             
                                          ;

2. otherwise, calculate its 
                                             
                                                y
                                                (
                                                n
                                                )
                                             
                                           by integer subproblem (24)–(28) and get its objective value 
                                             
                                                Q
                                                (
                                                x
                                                ,
                                                n
                                                )
                                             
                                          . If the newly calculated 
                                             
                                                y
                                                (
                                                n
                                                )
                                             
                                           equals 
                                             
                                                
                                                   y
                                                
                                                
                                                   π
                                                
                                             
                                           in any triple π in Π, we update its 
                                             
                                                
                                                   
                                                      UB
                                                   
                                                   
                                                      π
                                                   
                                                
                                                =
                                                max
                                                {
                                                
                                                   
                                                      UB
                                                   
                                                   
                                                      π
                                                   
                                                
                                                ,
                                                
                                                   
                                                      
                                                         
                                                            s
                                                         
                                                         
                                                            ^
                                                         
                                                      
                                                   
                                                   
                                                      n
                                                   
                                                
                                                }
                                             
                                          , 
                                             
                                                
                                                   
                                                      LB
                                                   
                                                   
                                                      π
                                                   
                                                
                                                =
                                                min
                                                
                                                {
                                                
                                                   
                                                      LB
                                                   
                                                   
                                                      π
                                                   
                                                
                                                ,
                                                
                                                   
                                                      
                                                         
                                                            s
                                                         
                                                         
                                                            ^
                                                         
                                                      
                                                   
                                                   
                                                      n
                                                   
                                                
                                                }
                                             
                                          , otherwise add triple 
                                             
                                                (
                                                
                                                   
                                                      
                                                         
                                                            s
                                                         
                                                         
                                                            ^
                                                         
                                                      
                                                   
                                                   
                                                      n
                                                   
                                                
                                                ,
                                                
                                                   
                                                      
                                                         
                                                            s
                                                         
                                                         
                                                            ^
                                                         
                                                      
                                                   
                                                   
                                                      n
                                                   
                                                
                                                ,
                                                y
                                                (
                                                n
                                                )
                                                )
                                             
                                           to Π, let 
                                             
                                                n
                                                =
                                                n
                                                +
                                                1
                                             
                                           and then go to step (c).

Our overall L-shaped algorithm follows the same general structure as the algorithm described in Angulo et al. [1] and can be found in Appendix B.1.

In this section, we will apply the methods and algorithms developed in this paper to solve instances derived from Shanghai General Hospital data, and analyze how reductions of resource unavailability and exogenous cancellation can alleviate the problems caused by overcrowding. Moreover, we present comparative analysis on the ESC model which allows scheduled cancellations and the ECO model which does not. To this end, we employ the methods developed in previous sections to obtain lower and upper bounds on the performance of these models, cf. Appendix D. Before discussing the results in Section 6.3, we consider the setup of the experiments in this section.

We consider two scheduling models:
                        
                           1.
                           Exogenous Cancellations Only (ECO): Patients are scheduled a day ahead, and processed accordingly. (Exogenous cancellations still occur.)

Exogenous and Scheduled Cancellations (ESC): Cancellation of surgeries (in reverse order of the scheduled sequence) is allowed after the completion of the first shift (as introduced in Section 3).


                     Surgery time distribution: To apply the methods developed in this paper, we fit surgery time distributions to surgery data collected between October 2013 and October 2014 at Shanghai General Hospital. For practical and statistical reasons, we consider instances containing the six surgery classes with highest volumes over this period. Our tests revealed that the log-normal distribution fits the data well, as is confirmed by the QQ-plots depicted in Appendix C. The corresponding parameters are given in Table 1
                     . Note that the flexibility of the SAA approach can easily deal with the log-normal distribution that is difficult to handle analytically.


                     The base case: Having estimated these surgery time distributions, we now first construct a basic problem instance, referred to as base case, and consider variations for the purpose of sensitivity analysis. For the base case, we set surgical time distributions for six patient classes based on Table 1. To account for surgery specific set-up times, we add 5min to the surgery durations, which is close to the median reported setup time. We assume that 3 patients are available for each of the six classes, so n
                     
                        p
                     =18. On the basis of the evidence reported in Section 2, we set the probability of exogenous cancellations to 15%. Following personal communication and data analysis regarding the time between surgeries which exceeds the regular setup time, we estimate the time lost per exogenous cancellation to be 15min. Adding 5min of normal setup time reserved for the next patient, this gives 20min in total to prepare the next patient in case of exogenous cancellation. Resource unavailability is also derived from Shanghai General Hospital data. We estimate the average daily resource unavailability to equal 2h, which we divide evenly over the shifts. Specifically, we set resource unavailability for both first and second shift as i.i.d log-normal distributions with parameters 
                        
                           μ
                           =
                           4
                        
                      and 
                        
                           σ
                           =
                           0.5
                        
                     , and thus a mean of approximately 62min. Table 2
                      gives the intervals on which the overtime cost function is linear, as well as the slopes for those intervals. Overtime costs are thus only incurred after regular working hours, which has a duration of 9.5h, and additional costs for excessive overtime are occurred after 11.5h. Lacking specific financial data, as well as data on health benefits from surgery, we normalize the reward r for each of the surgeries to equal the expected surgical duration 
                        
                           
                              m
                           
                           
                              ′
                           
                        
                     , where 
                        
                           
                              m
                           
                           
                              ′
                           
                        
                      equals m plus the five minutes' preparation time. The penalty associated with scheduled cancellation is set to 1.05 times the reward in the base case.

@&#RESULTS@&#


                        Section 6.1.1 investigates the performance of the developed solution methods for the base case and three variations. It also presents the comparative analysis between ESC and ECO in terms of optimal solution values. Section 6.1.2 investigates the impact of decreasing resource unavailability and reducing exogenous cancellations as means to alleviate the problems caused by overcrowding.

We consider four cases in order to compare the performances of the ESC and ECO policies. The three variations of the base case are obtained by varying the rewards and penalties of the surgery classes. Note that overtime costs, rewards, and cancellation costs should be understood relative to each other: the cost coefficients measure the relative importance of achieving the various conflicting objectives. The final objective is referred to as yield. Table 3
                            lists the variations and the base case. Remember that 
                              
                                 
                                    m
                                 
                                 
                                    ′
                                 
                              
                            is the average surgical time including preparation time, which is set at 
                              
                                 
                                    
                                       m
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 m
                                 +
                                 5
                              
                           . For the resulting cases, we determine the yields obtained by our algorithms for ESC and ECO, as well as associated upper bounds. The results are summarized in Table 4
                           . The table shows that, with one mild exception, our algorithm consistently finds solutions that are within 1% from the corresponding upper bound. In view of the stochasticity involved in the third stage of the three-stage recourse model, after the scheduled cancellations are decided, we consider this performance satisfactory.


                           Table 5
                            compares the solution values obtained for ESC and ECO and provides insight on the benefits of allowing scheduled cancellations. Naturally, these benefits depend on the cancellation cost. The benefit of scheduled cancellations is as much as 11.23% in the base case, and then reduces as scheduled cancellations become penalized heavier. In comparison to a weak and simple upper bound which assumes that there is a revenue of 1 for every expected non-idle unit of regular operating room time and no cost of cancellation or overtime work, ESC closes around 50% of the gap between this bound and the solution value for ECO. A similar result holds for case B. ESC closes less than 25% of this gap for the cases A and C.

To allow the reader to appreciate the effects of increasing the costs of scheduled cancellations, we tabulate the cost ratio between performing a surgery in overtime and cancelling the surgery, as well as the ratio between performing a surgery in excessive overtime and cancelling the surgery. (Note that the cancellation decision is nontrivial even though these ratios are known: At the moment of deciding on scheduled cancellations there is considerable uncertainty regarding the starting times of second shift surgeries.) These ratios vary case by case. They also depend to a limited extent on the surgery class, but relative variation is less than 8.86% over the six surgery classes. Table 5 gives the average ratio over the six surgery classes for each case. The calculated ratios account for the probability of exogenous cancellation in the expected surgery durations. Overtime is associated with increased risks of complications and medical errors, as well as dissatisfaction among scarce staff. By consequence, hospitals may prefer scheduled cancellations and delays of the corresponding patients to the next day to performing the surgery in overtime. The base case assumes that it is 
                              
                                 
                                    1.275
                                 
                                 
                                    1.05
                                 
                              
                            times more desirable to cancel a surgery than to perform it in regular overtime. For the base case, the yield improvement of ESC over ECO is 
                              
                                 (
                                 11.23
                                 ±
                                 0.32
                                 )
                                 %
                              
                           , which shows that there is considerable value in allowing scheduled cancellations, even if the cancellation decision is to be taken already after completing the first shift of at most half of the scheduled patients. Cases A and B represent cases where scheduled cancellations are only 
                              
                                 
                                    1.275
                                 
                                 
                                    1.20
                                 
                              
                            and 
                              
                                 
                                    1.275
                                 
                                 
                                    1.41
                                 
                              
                            times more desirable than performing the corresponding surgeries in regular overtime, while excessive overtime is still much more undesirable relative to scheduled cancellation. In that case, the value of allowing cancellations reduces to 
                              
                                 (
                                 5.42
                                 ±
                                 0.37
                                 )
                                 %
                              
                            and 
                              
                                 (
                                 4.06
                                 ±
                                 0.28
                                 )
                                 %
                              
                           , respectively. In Case C, the penalty for scheduled cancellation is so high that the recourse offers little improvement opportunity. It is therefore not surprising that the value of scheduled cancellations is very limited in case C at 
                              
                                 (
                                 0.64
                                 ±
                                 0.30
                                 )
                                 %
                              
                           .

In this section, reward and penalty cost are fixed to the base case, and we explore the impact of reducing exogenous cancellations and resource unavailability to the ESC and ECO policies as means to alleviate hospital overcrowding problems. We vary the rate of exogenous cancellations to be 0%, 5% and 15%. The latter is based on existing evidence reported in the scientific literature (cf. Section 2). The 5% appears to be a lower bound among the values reported in the scientific literature. The 0% scenario merely gives insight in the overall potential of eliminating exogenous cancellations altogether. The results are shown in Fig. 3
                           . The figure shows that exogenous cancellation has a significant adverse impact on performance: For the ESC policy, yields increase by 5% as exogenous cancellation rate decreases from 15% to 0%. For the ECO policy, this increase is 8%. These results show that ESC can better control the adverse impact of cancellations than ECO. For all tested values of exogenous cancellation rate, the ESC policy significantly outperforms the ECO policy by about 9%, which underlines the potential value of scheduled cancellations in dealing with uncertainties, even if they will be reduced in the future.

Next, we investigate the sensitivity of the optimal solutions to resource unavailability. To this purpose, we vary the unavailability while keeping other parameters as in the base case. The mean resource unavailability is set to 0 (lognormal with 
                              
                                 μ
                                 =
                                 0
                              
                           , 
                              
                                 σ
                                 =
                                 0
                              
                           ), 33 (lognormal with 
                              
                                 μ
                                 =
                                 3
                              
                           , 
                              
                                 σ
                                 =
                                 1
                              
                           ) and 62 (lognormal with 
                              
                                 μ
                                 =
                                 4
                              
                           , 
                              
                                 σ
                                 =
                                 0.5
                              
                           ) minutes per shift. The latter value is derived from the provided recent data and used as benchmark. Notice that the latter value corresponds to an unavailability of slightly over two hours on a 9.5h working day, and hence to about 21.5%. Fig. 4
                            shows that resource unavailability has a more than proportional adverse impact on performance: Resource unavailability of (on average) 62min per shift reduces expected yield by around 25% for the obtained solution for ESC and even more for ECO. The ESC model significantly outperforms ECO by at least 9%, and mostly when unavailability is highest. ESC offers an increasing advantage as the unavailability increases. This is further confirmed by experiments where we compare solutions which ignore the expected resource unavailability. For the ESC model, this results in a small but highly significant decrease in solution value (of around 1%), whereas the highly significant decrease exceeds 5% for ECO.

This work considers single operating room scheduling problems as they occur in overcrowded Chinese hospitals. Overcrowding is caused by societal and economic developments which are likely to sustain for years to come. As it severely impacts access to health care, as well as the quality and safety of care when solutions are sought in working long overtime hours, adequate solution methods for these scheduling problems are urgently called for. The scheduling problems are complicated by frequent cancellations for reasons that are exogenous to operating room management, such as cancellations by patients for economic reasons, and cancellations because of recent (hospital) acquired infections. Moreover, the operating rooms suffer from human resource unavailabilities as caused by urgent demands in other departments in the overcrowded hospitals. These stochastic characteristics make the resulting scheduling problems significantly more challenging to solve than previously studied stochastic operating room scheduling problems in the scientific literature, which primarily take stochastic surgery times into account.

Our study analyzes the impact of the exogenous cancellations and resource unavailabilities on the optimal schedules, so as to understand if and how reducing the exogenous cancellations and resource unavailabilities can assist hospitals to cope with the sustained excess demand. To this purpose, we developed solution methods for the presented operating room scheduling problems. Moreover, we analyzed the known practice of scheduled cancellations, which from a modelling perspective defines a second stage recourse moment in the stochastic scheduling problem.

The resulting problem forms a three-stage scheduling problem with recourse, as the realizations of the exogenous cancellations, unavailability and surgery durations for a second shift of patients only become known after the second stage decisions on scheduled cancellations have been made. We solve the three-stage recourse problem using sample average approximation methods and corresponding optimization techniques. Because of the stochasticity involved in the third stage however, the lower and upper bounds available are slightly weaker than it is often the case in two stage problems, and computation times can become larger. To remedy these computational problems, we derive several structural properties on the optimal schedule and scheduled cancellations, which allow us to speed up the optimization. Thus the proposed sample approximation approach which relies on the L-shaped method and optimality cuts forms a nontrivial innovation in stochastic scheduling itself. The developed solution methods deliver solutions which are mostly within 1% of optimal, thus allowing comparative analysis and sensitivity analysis of the various scheduling models by considering their solutions.

In many current practices, operating room schedules are composed without explicit consideration of the stochastic processes involved (yet only considering mean surgery times), or even without evaluation of the schedule at all. Our research firstly shows that the stochasticity of human resource unavailability, exogenous cancellations and procedure times can be simultaneously included in a scheduling model, for which good quality solutions balancing overtime costs with high workloads can be found. Our results show that taking the stochasticity into account yields substantially and significantly better operating room schedules. The improvements obtained for solutions with scheduled cancellations of up to 11% are much above the upper bounds on the solutions without scheduled cancellations, thus ensuring that the optimality gaps do not invalidate the conclusions.

Implementing the approach may take prolonged effort because substantial data collection is needed. But our results indicate that significant and substantial improvements are already attainable by (a) taking unavailability and no-show explicitly into account when constructing the initial schedules, and (b) systematic use of (early) scheduled cancellations. Likely benefits are better control of operating costs, increased staff satisfaction, and improvement of patient safety and satisfaction.

With these solution methods at hand, we have further analyzed exogenous cancellation and resource unavailability. As the latter may be in the order of 20% of regular opening hours, it is clear that improving unavailability holds great potential to alleviate the problems caused by overcrowding. Our results reveal that – while scheduled cancellations can limit the negative impact of resource unavailability – the overall impact on the solution values is more than proportional to the unavailability and exceeds 25% in the presented instances. A practical implication is therefore that hospitals and patients can greatly benefit from better management and control of the operational deployment of (human) resources to reduce their unavailability.

Although evidence indicates that exogenous cancellation may apply to as much as 15% of scheduled surgeries, it poses fewer difficulties for operating room scheduling and utilization than resource availability. This holds particularly true for the ESC model as its optimal solution value does not improve beyond 5%, even when exogenous cancellation is reduced by the full 15%. The impact for the model without scheduled cancellations is larger, confirming the potential of scheduled cancellations. From a practical operating room management perspective, these results imply that reduction of exogenous cancellations is worth considering after implementation of scheduled cancellations and reducing human resource unavailability. Especially so as the causes of scheduled cancellations are beyond the control of operating room management. As exogenous cancellations often follow from financial barriers and worsening of health status, reducing exogenous cancellations remains of urgency and importance.

While our analysis relies on data from a single hospital, Shanghai General Hospital, we believe that the model, solution methods, and analyses are likely to have relevance for the many other level 3 large city hospitals in China, which are presently overcrowded and face further demand increases. Similar problems occur in other developing countries as well. Our research presents first theoretical advancements on the resulting operating room scheduling problems as well as practical improvement suggestions. At the same time, it is clear that it has limitations and poses new research questions. For example, models which set the recourse moment at a fixed moment in time, or divide the shifts based on minutes workload rather than numbers of patients are worthy of further study. Moreover, one may consider the problem of determining the optimal moment in time, workload minutes, or relative patient number after which to end the first shift. We therefore hope that our research motivates other researchers to advance the work on the presently under-researched urgent operations management problems occurring in the operating rooms of China and other – mostly developing – countries, serving the far majority of the global population.


                     
                        Lemma 1
                        
                           The second stage decision problems 
                           
                              
                                 Q
                                 (
                                 x
                                 ,
                                 s
                                 )
                              
                            
                           and 
                           
                              
                                 
                                    
                                       Q
                                    
                                    
                                       ˜
                                    
                                 
                                 (
                                 x
                                 ,
                                 s
                                 )
                              
                            
                           are equivalent for any 
                           
                              
                                 x
                                 ∈
                                 X
                              
                            
                           and realization of 
                           
                              s
                           .

Let 
                              
                                 
                                    
                                       y
                                    
                                    
                                       ij
                                    
                                 
                                 (
                                 s
                                 )
                              
                            and 
                              
                                 
                                    k
                                 
                                 
                                    s
                                 
                              
                            are, respectively, the optimal solution to 
                              
                                 Q
                                 (
                                 x
                                 ,
                                 s
                                 )
                              
                            and 
                              
                                 
                                    
                                       Q
                                    
                                    
                                       ˜
                                    
                                 
                                 (
                                 x
                                 ,
                                 s
                                 )
                              
                           . Then 
                              
                                 
                                    
                                       y
                                    
                                    
                                       ij
                                    
                                 
                                 (
                                 s
                                 )
                                 ∈
                                 Y
                                 (
                                 x
                                 )
                              
                            and 
                              
                                 
                                    
                                       k
                                    
                                    
                                       s
                                    
                                 
                                 ∈
                                 Z
                              
                           .
                              
                                 •
                                 Let k satisfy 
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                i
                                                =
                                                1
                                             
                                             
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      p
                                                   
                                                
                                             
                                          
                                          
                                             
                                                ∑
                                             
                                             
                                                j
                                                =
                                                1
                                             
                                             
                                                k
                                             
                                          
                                          
                                             
                                                x
                                             
                                             
                                                ij
                                             
                                          
                                          =
                                          
                                             
                                                k
                                             
                                             
                                                s
                                             
                                          
                                       
                                    , next we equivalently transform 
                                       
                                          
                                             k
                                          
                                          
                                             s
                                          
                                       
                                     into a solution 
                                       
                                          
                                             
                                                y
                                             
                                             
                                                ij
                                             
                                             
                                                k
                                             
                                          
                                          (
                                          s
                                          )
                                       
                                    :
                                       
                                          (A.1)
                                          
                                             
                                                
                                                   
                                                      y
                                                   
                                                   
                                                      ij
                                                   
                                                   
                                                      k
                                                   
                                                
                                                (
                                                
                                                   s
                                                
                                                )
                                                =
                                                {
                                                
                                                   
                                                      
                                                         
                                                            0
                                                            ,
                                                         
                                                         
                                                            ∀
                                                            
                                                            i
                                                            =
                                                            1
                                                            ,
                                                            …
                                                            ,
                                                            
                                                               
                                                                  n
                                                               
                                                               
                                                                  p
                                                               
                                                            
                                                            ,
                                                             
                                                            j
                                                            =
                                                            1
                                                            ,
                                                            …
                                                            ,
                                                            k
                                                            ,
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  x
                                                               
                                                               
                                                                  ij
                                                               
                                                            
                                                            ,
                                                         
                                                         
                                                            
                                                               otherwise
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    Obviously, 
                                       
                                          
                                             
                                                y
                                             
                                             
                                                ij
                                             
                                             
                                                k
                                             
                                          
                                          (
                                          s
                                          )
                                       
                                     is a feasible solution to 
                                       
                                          Q
                                          (
                                          x
                                          ,
                                          s
                                          )
                                       
                                    , and 
                                       
                                          
                                             
                                                Q
                                             
                                             
                                                ˜
                                             
                                          
                                          (
                                          x
                                          ,
                                          s
                                          )
                                          ≥
                                          Q
                                          (
                                          x
                                          ,
                                          s
                                          )
                                       
                                    .

Let
                                       
                                          (A.2)
                                          
                                             
                                                
                                                   
                                                      k
                                                   
                                                   
                                                      s
                                                   
                                                   
                                                      y
                                                   
                                                
                                                =
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   
                                                      
                                                         
                                                            n
                                                         
                                                         
                                                            p
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      j
                                                      =
                                                      1
                                                   
                                                   
                                                      κ
                                                   
                                                
                                                (
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      ij
                                                   
                                                
                                                −
                                                
                                                   
                                                      y
                                                   
                                                   
                                                      ij
                                                   
                                                
                                                (
                                                s
                                                )
                                                )
                                             
                                          
                                       
                                    then 
                                       
                                          
                                             
                                                k
                                             
                                             
                                                s
                                             
                                             
                                                y
                                             
                                          
                                          ∈
                                          Z
                                       
                                     and 
                                       
                                          
                                             
                                                Q
                                             
                                             
                                                ˜
                                             
                                          
                                          (
                                          x
                                          ,
                                          s
                                          )
                                          ≤
                                          Q
                                          (
                                          x
                                          ,
                                          s
                                          )
                                       
                                    .


                           Let 
                           
                              
                                 x
                                 ∈
                                 X
                              
                            
                           be given, and condition on 
                           
                              
                                 
                                    s
                                 
                                 
                                    ^
                                 
                              
                           , then 
                           
                              
                                 g
                                 (
                                 
                                    
                                       s
                                    
                                    
                                       ^
                                    
                                 
                                 ,
                                 
                                    
                                       k
                                    
                                    
                                       
                                          
                                             s
                                          
                                          
                                             ^
                                          
                                       
                                    
                                 
                                 )
                              
                            
                           is a supermodular function.

To prove that 
                              
                                 g
                                 (
                                 
                                    
                                       s
                                    
                                    
                                       ^
                                    
                                 
                                 ,
                                 
                                    
                                       k
                                    
                                    
                                       
                                          
                                             s
                                          
                                          
                                             ^
                                          
                                       
                                    
                                 
                                 )
                              
                            is supermodular in 
                              
                                 (
                                 
                                    
                                       s
                                    
                                    
                                       ^
                                    
                                 
                                 ,
                                 
                                    
                                       k
                                    
                                    
                                       
                                          
                                             s
                                          
                                          
                                             ^
                                          
                                       
                                    
                                 
                                 )
                              
                           , we should prove that 
                              
                                 ∀
                                 
                                    
                                       
                                          
                                             s
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       1
                                    
                                 
                                 ≥
                                 
                                    
                                       
                                          
                                             s
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 
                                    
                                       k
                                    
                                    
                                       
                                          
                                             
                                                
                                                   s
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             1
                                          
                                       
                                    
                                 
                                 ≤
                                 
                                    
                                       k
                                    
                                    
                                       
                                          
                                             
                                                
                                                   s
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                              
                           ,
                              
                                 (A.3)
                                 
                                    
                                       g
                                       (
                                       
                                          
                                             
                                                
                                                   s
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             k
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         s
                                                      
                                                      
                                                         ^
                                                      
                                                   
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                       )
                                       +
                                       g
                                       (
                                       
                                          
                                             
                                                
                                                   s
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             2
                                          
                                       
                                       ,
                                       
                                          
                                             k
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         s
                                                      
                                                      
                                                         ^
                                                      
                                                   
                                                
                                                
                                                   1
                                                
                                             
                                          
                                       
                                       )
                                       ≥
                                       g
                                       (
                                       
                                          
                                             
                                                
                                                   s
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             k
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         s
                                                      
                                                      
                                                         ^
                                                      
                                                   
                                                
                                                
                                                   1
                                                
                                             
                                          
                                       
                                       )
                                       +
                                       g
                                       (
                                       
                                          
                                             
                                                
                                                   s
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             2
                                          
                                       
                                       ,
                                       
                                          
                                             k
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         s
                                                      
                                                      
                                                         ^
                                                      
                                                   
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                       )
                                    
                                 
                              
                           Expanding their expressions and merge similar items, inequality (A.3) is equivalent to the following:
                              
                                 (A.4)
                                 
                                    
                                       
                                          
                                             E
                                          
                                          
                                             ξ
                                          
                                       
                                       D
                                       
                                       (
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                             =
                                             1
                                          
                                          
                                             
                                                
                                                   n
                                                
                                                
                                                   p
                                                
                                             
                                          
                                       
                                       
                                          
                                             ∑
                                          
                                          
                                             j
                                             =
                                             1
                                          
                                          
                                             
                                                
                                                   k
                                                
                                                
                                                   
                                                      
                                                         
                                                            
                                                               s
                                                            
                                                            
                                                               ^
                                                            
                                                         
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             x
                                          
                                          
                                             ij
                                          
                                       
                                       
                                          
                                             ξ
                                          
                                          
                                             i
                                          
                                       
                                       +
                                       
                                          
                                             
                                                
                                                   s
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             1
                                          
                                       
                                       +
                                       
                                          
                                             η
                                          
                                          
                                             2
                                          
                                       
                                       )
                                       +
                                       
                                          
                                             E
                                          
                                          
                                             ξ
                                          
                                       
                                       D
                                       (
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                             =
                                             1
                                          
                                          
                                             
                                                
                                                   n
                                                
                                                
                                                   p
                                                
                                             
                                          
                                       
                                       
                                          
                                             ∑
                                          
                                          
                                             j
                                             =
                                             1
                                          
                                          
                                             
                                                
                                                   k
                                                
                                                
                                                   
                                                      
                                                         
                                                            
                                                               s
                                                            
                                                            
                                                               ^
                                                            
                                                         
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             x
                                          
                                          
                                             ij
                                          
                                       
                                       
                                          
                                             ξ
                                          
                                          
                                             i
                                          
                                       
                                       +
                                       
                                          
                                             
                                                
                                                   s
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             2
                                          
                                       
                                       +
                                       
                                          
                                             η
                                          
                                          
                                             2
                                          
                                       
                                       )
                                       ≥
                                       
                                          
                                             E
                                          
                                          
                                             ξ
                                          
                                       
                                       D
                                       (
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                             =
                                             1
                                          
                                          
                                             
                                                
                                                   n
                                                
                                                
                                                   p
                                                
                                             
                                          
                                       
                                       
                                          
                                             ∑
                                          
                                          
                                             j
                                             =
                                             1
                                          
                                          
                                             
                                                
                                                   k
                                                
                                                
                                                   
                                                      
                                                         
                                                            
                                                               s
                                                            
                                                            
                                                               ^
                                                            
                                                         
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             x
                                          
                                          
                                             ij
                                          
                                       
                                       
                                          
                                             ξ
                                          
                                          
                                             i
                                          
                                       
                                       +
                                       
                                          
                                             
                                                
                                                   s
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             1
                                          
                                       
                                       +
                                       
                                          
                                             η
                                          
                                          
                                             2
                                          
                                       
                                       )
                                       +
                                       
                                          
                                             E
                                          
                                          
                                             ξ
                                          
                                       
                                       D
                                       (
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                             =
                                             1
                                          
                                          
                                             
                                                
                                                   n
                                                
                                                
                                                   p
                                                
                                             
                                          
                                       
                                       
                                          
                                             ∑
                                          
                                          
                                             j
                                             =
                                             1
                                          
                                          
                                             
                                                
                                                   k
                                                
                                                
                                                   
                                                      
                                                         
                                                            
                                                               s
                                                            
                                                            
                                                               ^
                                                            
                                                         
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             x
                                          
                                          
                                             ij
                                          
                                       
                                       
                                          
                                             ξ
                                          
                                          
                                             i
                                          
                                       
                                       +
                                       
                                          
                                             
                                                
                                                   s
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             2
                                          
                                       
                                       +
                                       
                                          
                                             η
                                          
                                          
                                             2
                                          
                                       
                                       )
                                    
                                 
                              
                           The convexity of function D(x) in x justifies inequality (A.4) and the proof is done.□


                           Let 
                           
                              
                                 x
                                 ∈
                                 X
                              
                            
                           be given, and consider two realizations of the total time for the first shift: 
                              
                                 
                                    
                                       
                                          s
                                       
                                       
                                          ^
                                       
                                    
                                 
                                 
                                    1
                                 
                              
                            
                           and 
                           
                              
                                 
                                    
                                       
                                          s
                                       
                                       
                                          ^
                                       
                                    
                                 
                                 
                                    2
                                 
                              
                            
                           with 
                           
                              
                                 
                                    
                                       
                                          
                                             s
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       1
                                    
                                 
                                 ≤
                                 
                                    
                                       
                                          
                                             s
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                              
                           , then 
                           
                              
                                 
                                    
                                       k
                                    
                                    
                                       
                                          
                                             
                                                
                                                   s
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             1
                                          
                                       
                                    
                                    
                                       *
                                    
                                 
                                 ≥
                                 
                                    
                                       k
                                    
                                    
                                       
                                          
                                             
                                                
                                                   s
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             2
                                          
                                       
                                    
                                    
                                       *
                                    
                                 
                              
                           .

As Proposition 1 showed, 
                              
                                 g
                                 (
                                 
                                    
                                       s
                                    
                                    
                                       ^
                                    
                                 
                                 ,
                                 
                                    
                                       k
                                    
                                    
                                       
                                          
                                             s
                                          
                                          
                                             ^
                                          
                                       
                                    
                                 
                                 )
                              
                            is supermodular in vector 
                              
                                 (
                                 
                                    
                                       s
                                    
                                    
                                       ^
                                    
                                 
                                 ,
                                 
                                    
                                       k
                                    
                                    
                                       
                                          
                                             s
                                          
                                          
                                             ^
                                          
                                       
                                    
                                 
                                 )
                              
                           , by introducing 
                              
                                 t
                                 =
                                 −
                                 
                                    
                                       s
                                    
                                    
                                       ^
                                    
                                 
                              
                           , we can get submodular function 
                              
                                 g
                                 (
                                 t
                                 ,
                                 
                                    
                                       k
                                    
                                    
                                       
                                          
                                             s
                                          
                                          
                                             ^
                                          
                                       
                                    
                                 
                                 )
                              
                           , and applying the property of submodular function [43], we can get that 
                              
                                 
                                    k
                                 
                                 
                                    
                                       
                                          s
                                       
                                       
                                          ^
                                       
                                    
                                 
                                 
                                    *
                                 
                              
                            increases in t, i.e., 
                              
                                 
                                    k
                                 
                                 
                                    
                                       
                                          s
                                       
                                       
                                          ^
                                       
                                    
                                 
                                 
                                    *
                                 
                              
                            decreases in 
                              
                                 
                                    s
                                 
                                 
                                    ^
                                 
                              
                           .□


                           Let 
                           
                              
                                 x
                                 ∈
                                 
                                    
                                       X
                                    
                                    
                                       ¯
                                    
                                 
                              
                            
                           be given and 
                           
                              
                                 
                                    s
                                 
                                 
                                    ^
                                 
                              
                            
                           be defined by 
                           (17), then 
                              
                                 F
                                 (
                                 
                                    
                                       s
                                    
                                    
                                       ^
                                    
                                 
                                 ,
                                 y
                                 )
                              
                            is convex in 
                              
                                 y
                                 ∈
                                 
                                    
                                       Y
                                    
                                    
                                       ¯
                                    
                                 
                                 (
                                 x
                                 )
                              
                           .

We will prove that 
                              
                                 ∀
                                 
                                    
                                       y
                                    
                                    
                                       1
                                    
                                 
                                 =
                                 
                                    
                                       (
                                       
                                          
                                             y
                                          
                                          
                                             ij
                                          
                                          
                                             1
                                          
                                       
                                       )
                                    
                                    
                                       
                                          
                                             n
                                          
                                          
                                             p
                                          
                                       
                                       ×
                                       κ
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       2
                                    
                                 
                                 =
                                 
                                    
                                       (
                                       
                                          
                                             y
                                          
                                          
                                             ij
                                          
                                          
                                             2
                                          
                                       
                                       )
                                    
                                    
                                       
                                          
                                             n
                                          
                                          
                                             p
                                          
                                       
                                       ×
                                       κ
                                    
                                 
                              
                            and 
                              
                                 λ
                                 ≥
                                 0
                              
                           ,
                              
                                 
                                    
                                       F
                                       (
                                       
                                          
                                             s
                                          
                                          
                                             ^
                                          
                                       
                                       ,
                                       λ
                                       
                                          
                                             y
                                          
                                          
                                             1
                                          
                                       
                                       +
                                       (
                                       1
                                       −
                                       λ
                                       )
                                       
                                          
                                             y
                                          
                                          
                                             2
                                          
                                       
                                       )
                                       ≤
                                       λ
                                       F
                                       (
                                       
                                          
                                             s
                                          
                                          
                                             ^
                                          
                                       
                                       ,
                                       
                                          
                                             y
                                          
                                          
                                             1
                                          
                                       
                                       )
                                       +
                                       (
                                       1
                                       −
                                       λ
                                       )
                                       F
                                       (
                                       
                                          
                                             s
                                          
                                          
                                             ^
                                          
                                       
                                       ,
                                       
                                          
                                             y
                                          
                                          
                                             2
                                          
                                       
                                       )
                                    
                                 
                              
                           remark that 
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       =
                                       1
                                    
                                    
                                       
                                          
                                             n
                                          
                                          
                                             p
                                          
                                       
                                    
                                 
                                 
                                    
                                       ∑
                                    
                                    
                                       j
                                       =
                                       1
                                    
                                    
                                       κ
                                    
                                 
                                 
                                    
                                       I
                                    
                                    
                                       0
                                    
                                 
                                 (
                                 
                                    
                                       ξ
                                    
                                    
                                       i
                                    
                                 
                                 )
                                 
                                    
                                       r
                                    
                                    
                                       i
                                    
                                 
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       ij
                                    
                                 
                                 −
                                 
                                    
                                       y
                                    
                                    
                                       ij
                                    
                                 
                                 )
                              
                            is linear in 
                              y
                            and make no difference in the convexity, the above inequality holds if
                              
                                 
                                    
                                       
                                          
                                             E
                                          
                                          
                                             ξ
                                          
                                       
                                       D
                                       [
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                i
                                                =
                                                1
                                             
                                             
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      p
                                                   
                                                
                                             
                                          
                                          
                                             
                                                ∑
                                             
                                             
                                                j
                                                =
                                                1
                                             
                                             
                                                κ
                                             
                                          
                                          
                                             
                                                ξ
                                             
                                             
                                                i
                                             
                                          
                                          [
                                          λ
                                          (
                                          
                                             
                                                x
                                             
                                             
                                                ij
                                             
                                          
                                          −
                                          
                                             
                                                y
                                             
                                             
                                                ij
                                             
                                             
                                                1
                                             
                                          
                                          )
                                          +
                                          (
                                          1
                                          −
                                          λ
                                          )
                                          (
                                          
                                             
                                                x
                                             
                                             
                                                ij
                                             
                                          
                                          −
                                          
                                             
                                                y
                                             
                                             
                                                ij
                                             
                                             
                                                2
                                             
                                          
                                          )
                                          ]
                                          +
                                          
                                             
                                                s
                                             
                                             
                                                ^
                                             
                                          
                                          +
                                          
                                             
                                                η
                                             
                                             
                                                2
                                             
                                          
                                       
                                       ]
                                       ≤
                                       λ
                                       
                                          
                                             E
                                          
                                          
                                             ξ
                                          
                                       
                                       D
                                       [
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                i
                                                =
                                                1
                                             
                                             
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      p
                                                   
                                                
                                             
                                          
                                          
                                             
                                                ∑
                                             
                                             
                                                j
                                                =
                                                1
                                             
                                             
                                                κ
                                             
                                          
                                          
                                             
                                                ξ
                                             
                                             
                                                i
                                             
                                          
                                          (
                                          
                                             
                                                x
                                             
                                             
                                                ij
                                             
                                          
                                          −
                                          
                                             
                                                y
                                             
                                             
                                                ij
                                             
                                             
                                                1
                                             
                                          
                                          )
                                          +
                                          
                                             
                                                s
                                             
                                             
                                                ^
                                             
                                          
                                          +
                                          
                                             
                                                η
                                             
                                             
                                                2
                                             
                                          
                                       
                                       ]
                                       +
                                       (
                                       1
                                       −
                                       λ
                                       )
                                       
                                          
                                             E
                                          
                                          
                                             ξ
                                          
                                       
                                       D
                                       [
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                i
                                                =
                                                1
                                             
                                             
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      p
                                                   
                                                
                                             
                                          
                                          
                                             
                                                ∑
                                             
                                             
                                                j
                                                =
                                                1
                                             
                                             
                                                κ
                                             
                                          
                                          
                                             
                                                ξ
                                             
                                             
                                                i
                                             
                                          
                                          (
                                          
                                             
                                                x
                                             
                                             
                                                ij
                                             
                                          
                                          −
                                          
                                             
                                                y
                                             
                                             
                                                ij
                                             
                                             
                                                2
                                             
                                          
                                          )
                                          +
                                          
                                             
                                                s
                                             
                                             
                                                ^
                                             
                                          
                                          +
                                          
                                             
                                                η
                                             
                                             
                                                2
                                             
                                          
                                       
                                       ]
                                    
                                 
                              
                           Since D(x) is convex in x, the second inequality holds for any 
                              
                                 λ
                                 ∈
                                 [
                                 0
                                 ,
                                 1
                                 ]
                              
                            and 
                              
                                 
                                    
                                       y
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       2
                                    
                                 
                              
                           , and the proposition is true.□


                           Let 
                           
                              
                                 x
                                 ∈
                                 X
                              
                            
                           be given and 
                           
                              
                                 
                                    s
                                 
                                 
                                    ^
                                 
                              
                            
                           be defined by 
                           (17), then 
                           
                              
                                 f
                                 (
                                 
                                    
                                       s
                                    
                                    
                                       ^
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       min
                                    
                                    
                                       y
                                       ∈
                                       
                                          
                                             Y
                                          
                                          
                                             ¯
                                          
                                       
                                    
                                 
                                 F
                                 (
                                 
                                    
                                       s
                                    
                                    
                                       ^
                                    
                                 
                                 ,
                                 y
                                 )
                              
                            
                           and 
                           
                              
                                 f
                                 (
                                 
                                    
                                       s
                                    
                                    
                                       ^
                                    
                                 
                                 )
                              
                            
                           is convex in 
                           
                              
                                 
                                    s
                                 
                                 
                                    ^
                                 
                              
                           . Besides, 
                              
                                 R
                                 (
                                 s
                                 )
                              
                            
                           defined in 
                           
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       =
                                       1
                                    
                                    
                                       
                                          
                                             n
                                          
                                          
                                             p
                                          
                                       
                                    
                                 
                                 
                                    
                                       I
                                    
                                    
                                       0
                                    
                                 
                                 (
                                 
                                    
                                       s
                                    
                                    
                                       i
                                    
                                 
                                 )
                                 
                                    
                                       r
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       x
                                    
                                    
                                       i
                                       0
                                    
                                 
                              
                            
                           is also convex in 
                           
                              s
                           .

We can easily get 
                              
                                 f
                                 (
                                 
                                    
                                       s
                                    
                                    
                                       ^
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       min
                                    
                                    
                                       y
                                       ∈
                                       
                                          
                                             Y
                                          
                                          
                                             ¯
                                          
                                       
                                    
                                 
                                 F
                                 (
                                 
                                    
                                       s
                                    
                                    
                                       ^
                                    
                                 
                                 ,
                                 y
                                 )
                              
                            by Lemma 1. Next we will prove that 
                              
                                 ∀
                                 
                                    
                                       
                                          
                                             s
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       
                                          
                                             s
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                              
                           , 
                              
                                 
                                    
                                       
                                          
                                             s
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       1
                                    
                                 
                                 ≥
                                 
                                    
                                       
                                          
                                             s
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                              
                            and 
                              
                                 λ
                                 ≥
                                 0
                              
                           ,
                              
                                 (A.5)
                                 
                                    
                                       f
                                       (
                                       λ
                                       
                                          
                                             
                                                
                                                   s
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             1
                                          
                                       
                                       +
                                       (
                                       1
                                       −
                                       λ
                                       )
                                       
                                          
                                             
                                                
                                                   s
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             2
                                          
                                       
                                       )
                                       ≤
                                       λ
                                       f
                                       (
                                       
                                          
                                             
                                                
                                                   s
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             1
                                          
                                       
                                       )
                                       +
                                       (
                                       1
                                       −
                                       λ
                                       )
                                       f
                                       (
                                       
                                          
                                             
                                                
                                                   s
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             2
                                          
                                       
                                       )
                                    
                                 
                              
                           Let 
                              
                                 
                                    
                                       y
                                    
                                    
                                       1
                                    
                                 
                                 ∈
                                 
                                    
                                       Y
                                    
                                    
                                       ¯
                                    
                                 
                              
                            and 
                              
                                 
                                    
                                       y
                                    
                                    
                                       2
                                    
                                 
                                 ∈
                                 
                                    
                                       Y
                                    
                                    
                                       ¯
                                    
                                 
                              
                            be, respectively, the optimal solution to 
                              
                                 f
                                 (
                                 
                                    
                                       
                                          
                                             s
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       1
                                    
                                 
                                 )
                              
                            and 
                              
                                 f
                                 (
                                 
                                    
                                       
                                          
                                             s
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                                 )
                              
                            , then 
                              
                                 λ
                                 
                                    
                                       y
                                    
                                    
                                       1
                                    
                                 
                                 +
                                 (
                                 1
                                 −
                                 λ
                                 )
                                 
                                    
                                       y
                                    
                                    
                                       2
                                    
                                 
                              
                            is a feasible solution to 
                              
                                 f
                                 (
                                 λ
                                 
                                    
                                       
                                          
                                             s
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       1
                                    
                                 
                                 +
                                 (
                                 1
                                 −
                                 λ
                                 )
                                 
                                    
                                       
                                          
                                             s
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                                 )
                              
                            and
                              
                                 
                                    
                                       f
                                       (
                                       λ
                                       
                                          
                                             
                                                
                                                   s
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             1
                                          
                                       
                                       +
                                       (
                                       1
                                       −
                                       λ
                                       )
                                       
                                          
                                             
                                                
                                                   s
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             2
                                          
                                       
                                       )
                                       ≤
                                       F
                                       (
                                       λ
                                       
                                          
                                             
                                                
                                                   s
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             1
                                          
                                       
                                       +
                                       (
                                       1
                                       −
                                       λ
                                       )
                                       
                                          
                                             
                                                
                                                   s
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             2
                                          
                                       
                                       ,
                                       λ
                                       
                                          
                                             y
                                          
                                          
                                             1
                                          
                                       
                                       +
                                       (
                                       1
                                       −
                                       λ
                                       )
                                       
                                          
                                             y
                                          
                                          
                                             2
                                          
                                       
                                       )
                                    
                                 
                              
                           What's more,
                              
                                 
                                    
                                       λ
                                       f
                                       (
                                       
                                          
                                             
                                                
                                                   s
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             1
                                          
                                       
                                       )
                                       +
                                       (
                                       1
                                       −
                                       λ
                                       )
                                       f
                                       (
                                       
                                          
                                             
                                                
                                                   s
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             2
                                          
                                       
                                       )
                                       −
                                       F
                                       (
                                       λ
                                       
                                          
                                             
                                                
                                                   s
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             1
                                          
                                       
                                       +
                                       (
                                       1
                                       −
                                       λ
                                       )
                                       
                                          
                                             
                                                
                                                   s
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             2
                                          
                                       
                                       ,
                                       λ
                                       
                                          
                                             y
                                          
                                          
                                             1
                                          
                                       
                                       +
                                       (
                                       1
                                       -
                                       λ
                                       )
                                       
                                          
                                             y
                                          
                                          
                                             2
                                          
                                       
                                       )
                                       =
                                       λ
                                       
                                          
                                             E
                                          
                                          
                                             ξ
                                          
                                       
                                       [
                                       
                                          D
                                          
                                          (
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   i
                                                   =
                                                   1
                                                
                                                
                                                   
                                                      
                                                         n
                                                      
                                                      
                                                         p
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   ∑
                                                
                                                
                                                   j
                                                   =
                                                   1
                                                
                                                
                                                   κ
                                                
                                             
                                             
                                                
                                                   ξ
                                                
                                                
                                                   i
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   ij
                                                
                                             
                                             −
                                             
                                                
                                                   y
                                                
                                                
                                                   ij
                                                
                                                
                                                   1
                                                
                                             
                                             )
                                             +
                                             
                                                
                                                   
                                                      
                                                         s
                                                      
                                                      
                                                         ^
                                                      
                                                   
                                                
                                                
                                                   1
                                                
                                             
                                             +
                                             
                                                
                                                   η
                                                
                                                
                                                   2
                                                
                                             
                                          
                                          )
                                          +
                                          
                                             
                                                ∑
                                             
                                             
                                                i
                                                =
                                                1
                                             
                                             
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      p
                                                   
                                                
                                             
                                          
                                          
                                             
                                                ∑
                                             
                                             
                                                j
                                                =
                                                1
                                             
                                             
                                                κ
                                             
                                          
                                          
                                             
                                                I
                                             
                                             
                                                0
                                             
                                          
                                          (
                                          
                                             
                                                ξ
                                             
                                             
                                                i
                                             
                                          
                                          )
                                          
                                             
                                                r
                                             
                                             
                                                i
                                             
                                          
                                          (
                                          
                                             
                                                x
                                             
                                             
                                                ij
                                             
                                          
                                          −
                                          
                                             
                                                y
                                             
                                             
                                                ij
                                             
                                             
                                                1
                                             
                                          
                                          )
                                       
                                       ]
                                       +
                                       (
                                       1
                                       −
                                       λ
                                       )
                                       
                                          
                                             E
                                          
                                          
                                             ξ
                                          
                                       
                                       [
                                       
                                          D
                                          (
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   i
                                                   =
                                                   1
                                                
                                                
                                                   
                                                      
                                                         n
                                                      
                                                      
                                                         p
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   ∑
                                                
                                                
                                                   j
                                                   =
                                                   1
                                                
                                                
                                                   κ
                                                
                                             
                                             
                                                
                                                   ξ
                                                
                                                
                                                   i
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   ij
                                                
                                             
                                             −
                                             
                                                
                                                   y
                                                
                                                
                                                   ij
                                                
                                                
                                                   2
                                                
                                             
                                             )
                                             +
                                             
                                                
                                                   
                                                      
                                                         s
                                                      
                                                      
                                                         ^
                                                      
                                                   
                                                
                                                
                                                   2
                                                
                                             
                                             +
                                             
                                                
                                                   η
                                                
                                                
                                                   2
                                                
                                             
                                          
                                          )
                                          +
                                          
                                             
                                                ∑
                                             
                                             
                                                i
                                                =
                                                1
                                             
                                             
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      p
                                                   
                                                
                                             
                                          
                                          
                                             
                                                ∑
                                             
                                             
                                                j
                                                =
                                                1
                                             
                                             
                                                κ
                                             
                                          
                                          
                                             
                                                I
                                             
                                             
                                                0
                                             
                                          
                                          (
                                          
                                             
                                                ξ
                                             
                                             
                                                i
                                             
                                          
                                          )
                                          
                                             
                                                r
                                             
                                             
                                                i
                                             
                                          
                                          (
                                          
                                             
                                                x
                                             
                                             
                                                ij
                                             
                                          
                                          −
                                          
                                             
                                                y
                                             
                                             
                                                ij
                                             
                                             
                                                2
                                             
                                          
                                          )
                                       
                                       ]
                                       −
                                       
                                          
                                             E
                                          
                                          
                                             ξ
                                          
                                       
                                       [
                                       
                                          D
                                          (
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   i
                                                   =
                                                   1
                                                
                                                
                                                   
                                                      
                                                         n
                                                      
                                                      
                                                         p
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   ∑
                                                
                                                
                                                   j
                                                   =
                                                   1
                                                
                                                
                                                   κ
                                                
                                             
                                             
                                                
                                                   ξ
                                                
                                                
                                                   i
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   ij
                                                
                                             
                                             −
                                             λ
                                             
                                                
                                                   y
                                                
                                                
                                                   ij
                                                
                                                
                                                   1
                                                
                                             
                                             −
                                             (
                                             1
                                             −
                                             λ
                                             )
                                             
                                                
                                                   y
                                                
                                                
                                                   ij
                                                
                                                
                                                   2
                                                
                                             
                                             )
                                             +
                                             λ
                                             
                                                
                                                   
                                                      
                                                         s
                                                      
                                                      
                                                         ^
                                                      
                                                   
                                                
                                                
                                                   1
                                                
                                             
                                             +
                                             (
                                             1
                                             −
                                             λ
                                             )
                                             
                                                
                                                   
                                                      
                                                         s
                                                      
                                                      
                                                         ^
                                                      
                                                   
                                                
                                                
                                                   2
                                                
                                             
                                             +
                                             
                                                
                                                   η
                                                
                                                
                                                   2
                                                
                                             
                                          
                                          )
                                       
                                       
                                          +
                                          
                                             
                                                ∑
                                             
                                             
                                                i
                                                =
                                                1
                                             
                                             
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      p
                                                   
                                                
                                             
                                          
                                          
                                             
                                                ∑
                                             
                                             
                                                j
                                                =
                                                1
                                             
                                             
                                                κ
                                             
                                          
                                          
                                             
                                                I
                                             
                                             
                                                0
                                             
                                          
                                          (
                                          
                                             
                                                ξ
                                             
                                             
                                                i
                                             
                                          
                                          )
                                          
                                             
                                                r
                                             
                                             
                                                i
                                             
                                          
                                          (
                                          
                                             
                                                x
                                             
                                             
                                                ij
                                             
                                          
                                          −
                                          λ
                                          
                                             
                                                y
                                             
                                             
                                                ij
                                             
                                             
                                                1
                                             
                                          
                                          −
                                          (
                                          1
                                          −
                                          λ
                                          )
                                          
                                             
                                                y
                                             
                                             
                                                ij
                                             
                                             
                                                2
                                             
                                          
                                          )
                                       
                                       ]
                                       =
                                       λ
                                       
                                          
                                             E
                                          
                                          
                                             ξ
                                          
                                       
                                       D
                                       [
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                i
                                                =
                                                1
                                             
                                             
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      p
                                                   
                                                
                                             
                                          
                                          
                                             
                                                ∑
                                             
                                             
                                                j
                                                =
                                                1
                                             
                                             
                                                κ
                                             
                                          
                                          
                                             
                                                ξ
                                             
                                             
                                                i
                                             
                                          
                                          (
                                          
                                             
                                                x
                                             
                                             
                                                ij
                                             
                                          
                                          −
                                          
                                             
                                                y
                                             
                                             
                                                ij
                                             
                                             
                                                1
                                             
                                          
                                          )
                                          +
                                          
                                             
                                                
                                                   
                                                      s
                                                   
                                                   
                                                      ^
                                                   
                                                
                                             
                                             
                                                1
                                             
                                          
                                          +
                                          
                                             
                                                η
                                             
                                             
                                                2
                                             
                                          
                                       
                                       ]
                                       +
                                       (
                                       1
                                       −
                                       λ
                                       )
                                       
                                          
                                             E
                                          
                                          
                                             ξ
                                          
                                       
                                       D
                                       [
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                i
                                                =
                                                1
                                             
                                             
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      p
                                                   
                                                
                                             
                                          
                                          
                                             
                                                ∑
                                             
                                             
                                                j
                                                =
                                                1
                                             
                                             
                                                κ
                                             
                                          
                                          
                                             
                                                ξ
                                             
                                             
                                                i
                                             
                                          
                                          (
                                          
                                             
                                                x
                                             
                                             
                                                ij
                                             
                                          
                                          −
                                          
                                             
                                                y
                                             
                                             
                                                ij
                                             
                                             
                                                2
                                             
                                          
                                          )
                                          +
                                          
                                             
                                                
                                                   
                                                      s
                                                   
                                                   
                                                      ^
                                                   
                                                
                                             
                                             
                                                2
                                             
                                          
                                          +
                                          
                                             
                                                η
                                             
                                             
                                                2
                                             
                                          
                                       
                                       ]
                                       −
                                       
                                          
                                             E
                                          
                                          
                                             ξ
                                          
                                       
                                       D
                                       [
                                       
                                          λ
                                          (
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   i
                                                   =
                                                   1
                                                
                                                
                                                   
                                                      
                                                         n
                                                      
                                                      
                                                         p
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   ∑
                                                
                                                
                                                   j
                                                   =
                                                   1
                                                
                                                
                                                   κ
                                                
                                             
                                             
                                                
                                                   ξ
                                                
                                                
                                                   i
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   ij
                                                
                                             
                                             −
                                             
                                                
                                                   y
                                                
                                                
                                                   ij
                                                
                                                
                                                   1
                                                
                                             
                                             )
                                             +
                                             
                                                
                                                   
                                                      
                                                         s
                                                      
                                                      
                                                         ^
                                                      
                                                   
                                                
                                                
                                                   1
                                                
                                             
                                             +
                                             
                                                
                                                   η
                                                
                                                
                                                   2
                                                
                                             
                                          
                                          )
                                          +
                                          (
                                          1
                                          −
                                          λ
                                          )
                                          (
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   i
                                                   =
                                                   1
                                                
                                                
                                                   
                                                      
                                                         n
                                                      
                                                      
                                                         p
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   ∑
                                                
                                                
                                                   j
                                                   =
                                                   1
                                                
                                                
                                                   κ
                                                
                                             
                                             
                                                
                                                   ξ
                                                
                                                
                                                   i
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   ij
                                                
                                             
                                             −
                                             
                                                
                                                   y
                                                
                                                
                                                   ij
                                                
                                                
                                                   2
                                                
                                             
                                             )
                                             +
                                             
                                                
                                                   
                                                      
                                                         s
                                                      
                                                      
                                                         ^
                                                      
                                                   
                                                
                                                
                                                   2
                                                
                                             
                                             +
                                             
                                                
                                                   η
                                                
                                                
                                                   2
                                                
                                             
                                          
                                          )
                                       
                                       ]
                                       ≥
                                       0
                                    
                                 
                              
                           Since D(x) is convex in x, the last inequality holds and inequality (A.5) is true. Moreover, 
                              
                                 
                                    
                                       I
                                    
                                    
                                       0
                                    
                                 
                                 (
                                 
                                    
                                       s
                                    
                                    
                                       i
                                    
                                 
                                 )
                              
                            is convex in 
                              s
                           , which can directly derive that 
                              
                                 R
                                 (
                                 s
                                 )
                              
                            is also convex in 
                              s
                           .□

Our overall L-shaped algorithm follows the same general structure as the algorithm described in Angulo et al. [1]. Based on the above analysis, it can be described as follows:
                           Algorithm 1
                           
                              
                                 Step 0
                                 
                                    Initiate 
                                          
                                             Θ
                                             =
                                             ∅
                                          
                                       . Throughout, Θ will be used for the master problem.

Optimize the integral master problem to obtain an optimal solution 
                                          
                                             x
                                             ∈
                                             X
                                          
                                        and corresponding objective value z and θ. If 
                                          
                                             
                                                
                                                   θ
                                                   −
                                                   (
                                                   −
                                                   
                                                      
                                                         Q
                                                      
                                                      
                                                         LP
                                                      
                                                   
                                                   (
                                                   x
                                                   )
                                                   )
                                                
                                                
                                                   (
                                                   −
                                                   
                                                      
                                                         Q
                                                      
                                                      
                                                         LP
                                                      
                                                   
                                                   (
                                                   x
                                                   )
                                                   )
                                                
                                             
                                             >
                                             ϵ
                                          
                                       , add the corresponding optimality cut 
                                          
                                             (
                                             v
                                             ,
                                             ρ
                                             )
                                          
                                        to Θ and go to Step 1, otherwise go to Step 2.

If 
                                          
                                             
                                                
                                                   θ
                                                   −
                                                   (
                                                   −
                                                   Q
                                                   (
                                                   x
                                                   )
                                                   )
                                                
                                                
                                                   (
                                                   −
                                                   Q
                                                   (
                                                   x
                                                   )
                                                   )
                                                
                                             
                                             >
                                             ϵ
                                          
                                       , add the corresponding integer optimality cut to Θ, and go to Step 1. Otherwise, if 
                                          
                                             
                                                
                                                   θ
                                                   −
                                                   (
                                                   −
                                                   Q
                                                   (
                                                   x
                                                   )
                                                   )
                                                
                                                
                                                   (
                                                   −
                                                   Q
                                                   (
                                                   x
                                                   )
                                                
                                             
                                             )
                                             ≤
                                             ϵ
                                          
                                       , terminate, designating x as the 
                                          
                                             ϵ
                                          
                                       -optimal solution.

The L-shaped method from the previous section can be enhanced by adding Jensen's inequality as a constraint to both the integral and relaxed master problem. By the results obtained in Section 4.2, the second stage costs can be bounded from below if all first shift surgeries take on their expected value (for the SAA approach, this translated to replacing the expected value by the sample mean). To explicitly give the constraints, let 
                           
                              
                                 
                                    
                                       
                                          s
                                       
                                       
                                          ¯
                                       
                                    
                                 
                                 
                                    i
                                 
                              
                              =
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          n
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                ^
                                             
                                          
                                       
                                    
                                    (
                                    
                                       
                                          s
                                       
                                       
                                          in
                                       
                                    
                                    )
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          ^
                                       
                                    
                                 
                              
                           
                        , and 
                           
                              
                                 
                                    
                                       
                                          η
                                       
                                       
                                          ¯
                                       
                                    
                                 
                                 
                                    1
                                 
                              
                              =
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          n
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                ^
                                             
                                          
                                       
                                    
                                    
                                       
                                          η
                                       
                                       
                                          1
                                          n
                                       
                                    
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          ^
                                       
                                    
                                 
                              
                           
                        , and let 
                           
                              
                                 
                                    y
                                 
                                 
                                    ¯
                                 
                              
                              =
                              {
                              
                                 
                                    
                                       
                                          y
                                       
                                       
                                          ¯
                                       
                                    
                                 
                                 
                                    ij
                                 
                              
                              |
                              i
                              ∈
                              I
                              ,
                              j
                              ∈
                              {
                              1
                              ,
                              …
                              ,
                              κ
                              }
                              }
                           
                         denote the second stage decisions if all first-stage random variables take on their expected value, in which case 
                           
                              
                                 
                                    I
                                 
                                 
                                    0
                                 
                              
                              (
                              
                                 
                                    
                                       
                                          s
                                       
                                       
                                          ¯
                                       
                                    
                                 
                                 
                                    i
                                 
                              
                              )
                              =
                              0
                           
                        . Then,
                           
                              (B.1)
                              
                                 
                                    θ
                                    ≤
                                    −
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                p
                                             
                                          
                                       
                                    
                                    
                                       
                                          ∑
                                       
                                       
                                          j
                                          =
                                          1
                                       
                                       
                                          κ
                                       
                                    
                                    
                                       
                                          c
                                       
                                       
                                          i
                                       
                                    
                                    
                                       
                                          
                                             
                                                y
                                             
                                             
                                                ¯
                                             
                                          
                                       
                                       
                                          ij
                                       
                                    
                                    −
                                    
                                       
                                          1
                                       
                                       
                                          
                                             
                                                m
                                             
                                             
                                                ^
                                             
                                          
                                       
                                    
                                    
                                       
                                          ∑
                                       
                                       
                                          m
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                m
                                             
                                             
                                                ^
                                             
                                          
                                       
                                    
                                    [
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             v
                                             =
                                             0
                                          
                                          
                                             q
                                          
                                       
                                       
                                          
                                             τ
                                          
                                          
                                             v
                                          
                                       
                                       
                                          
                                             
                                                
                                                   ϕ
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                          
                                             v
                                          
                                       
                                       (
                                       m
                                       )
                                       +
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                             =
                                             1
                                          
                                          
                                             
                                                
                                                   n
                                                
                                                
                                                   p
                                                
                                             
                                          
                                       
                                       
                                          
                                             ∑
                                          
                                          
                                             j
                                             =
                                             1
                                          
                                          
                                             κ
                                          
                                       
                                       
                                          
                                             I
                                          
                                          
                                             0
                                          
                                       
                                       (
                                       
                                          
                                             ξ
                                          
                                          
                                             im
                                          
                                       
                                       )
                                       
                                          
                                             r
                                          
                                          
                                             i
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             ij
                                          
                                       
                                       −
                                       
                                          
                                             
                                                
                                                   y
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                          
                                             ij
                                          
                                       
                                       )
                                    
                                    ]
                                 
                              
                           
                        
                        
                           
                              (B.2)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          v
                                          =
                                          0
                                       
                                       
                                          q
                                       
                                    
                                    
                                       
                                          
                                             
                                                ϕ
                                             
                                             
                                                ¯
                                             
                                          
                                       
                                       
                                          v
                                       
                                    
                                    (
                                    m
                                    )
                                    =
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                p
                                             
                                          
                                       
                                    
                                    
                                       
                                          ∑
                                       
                                       
                                          j
                                          =
                                          1
                                       
                                       
                                          κ
                                       
                                    
                                    
                                       
                                          ξ
                                       
                                       
                                          im
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          ij
                                       
                                    
                                    −
                                    
                                       
                                          
                                             
                                                y
                                             
                                             
                                                ¯
                                             
                                          
                                       
                                       
                                          ij
                                       
                                    
                                    )
                                    +
                                    
                                       
                                          η
                                       
                                       
                                          2
                                          
                                          m
                                       
                                    
                                    +
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                p
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                s
                                             
                                             
                                                ¯
                                             
                                          
                                       
                                       
                                          i
                                       
                                    
                                    
                                       
                                          x
                                       
                                       
                                          i
                                          0
                                       
                                    
                                    +
                                    
                                       
                                          
                                             
                                                η
                                             
                                             
                                                ¯
                                             
                                          
                                       
                                       
                                          1
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (B.3)
                              
                                 
                                    
                                       
                                          y
                                       
                                       
                                          ¯
                                       
                                    
                                    ∈
                                    
                                       
                                          Y
                                       
                                       
                                          ¯
                                       
                                    
                                    (
                                    x
                                    )
                                 
                              
                           
                        
                        
                           
                              (B.4)
                              
                                 
                                    
                                       
                                          
                                             
                                                φ
                                             
                                             
                                                ¯
                                             
                                          
                                       
                                       
                                          v
                                       
                                    
                                    (
                                    m
                                    )
                                    ∈
                                    [
                                    0
                                    ,
                                    
                                       
                                          l
                                       
                                       
                                          v
                                       
                                    
                                    ]
                                    ,
                                    
                                    
                                    m
                                    ∈
                                    {
                                    1
                                    ,
                                    …
                                    ,
                                    
                                       
                                          m
                                       
                                       
                                          ^
                                       
                                    
                                    }
                                    ,
                                    
                                    v
                                    ∈
                                    {
                                    0
                                    ,
                                    …
                                    ,
                                    q
                                    }
                                 
                              
                           
                        These constraints extend the results in Batun et al. [3] for our problem.

The log-normal distribution fits the surgery time data quite well, as is confirmed by the QQ-plots depicted in Fig. C1
                     .

The general method for obtaining upper and lower bound estimates from the SAA of two-stage stochastic programs has been discussed in Mak et al. [30] and Kleywegt et al. [21]. Let us recall, however, that the ESC scheduling problem is a three-stage SP. Upper and lower bounds are therefore obtained from the SAA (23)–(28) as follows. (Recall that we are maximizing.) The SAA objective averages all combinations of 
                        
                           
                              n
                           
                           
                              ^
                           
                        
                      first shift samples and 
                        
                           
                              m
                           
                           
                              ^
                           
                        
                      second shift samples, which equals a total of 
                        
                           
                              
                                 n
                              
                              
                                 ^
                              
                           
                           ×
                           
                              
                                 m
                              
                              
                                 ^
                              
                           
                        
                      combinations. Because the problem is three-stage, it requires relatively many samples to sufficiently accurately represent the randomness. In our numerical experiments we use 
                        
                           
                              
                                 n
                              
                              
                                 ^
                              
                           
                           =
                           
                              
                                 m
                              
                              
                                 ^
                              
                           
                           =
                           500
                        
                     , for a total of 250,000 combinations. The target accuracy ϵ of Algorithm 1 is set at 0.5% when running time is shorter than 24h, and is increased to 2% when this running time bound is exceeded. An upper bound estimate is obtained by averaging the upper bound on the optimal objective value for 10 collections of 
                        
                           
                              
                                 n
                              
                              
                                 ^
                              
                           
                           ×
                           
                              
                                 m
                              
                              
                                 ^
                              
                           
                        
                      samples. (Thus, the our upper bound becomes weaker as ϵ increases.)

To obtain a lower bound estimate, we select a solution 
                        
                           
                              
                                 x
                              
                              
                                 ′
                              
                           
                           ∈
                           X
                        
                      that optimizes the SAA for a 500×500 sample. We then fix the schedule to this 
                        
                           
                              x
                           
                           
                              ′
                           
                        
                     , and solve the SAA for a single first shift sample (
                        
                           
                              
                                 n
                              
                              
                                 ^
                              
                           
                           =
                           1
                        
                     ), while setting 
                        
                           
                              
                                 m
                              
                              
                                 ^
                              
                           
                           =
                           2000
                        
                     . This yields a single appropriate cancellation decision for that first shift realization. The outcome for the first shift sample with that cancellation decision is evaluated using a new, independent set of 2000 second shift realizations. This yields an unbiased lower bound estimate. A reliable lower bound estimate with associated standard deviation is obtained by averaging the result of this procedure for 2000 replications, i.e., (1) generate new first shift and second shift samples, (2) determine an appropriate cancellation decision, and (3) evaluate the outcome of the first shift sample and cancellation decision with a new second shift sample.

@&#REFERENCES@&#

