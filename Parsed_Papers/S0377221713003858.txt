@&#MAIN-TITLE@&#Two-stage vehicle routing problem with arc time windows: A mixed integer programming formulation and a heuristic approach

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           We consider two-stage vehicle routing problem with arc time windows.


                        
                        
                           
                           We propose a MIP formulation and a heuristic approach based on memetic algorithm.


                        
                        
                           
                           The MIP formulation obtains the optimal solution of small and medium-size problems.


                        
                        
                           
                           The memetic algorithm obtains good quality solutions in a short computation time.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Logistics

Vehicle routing problem with arc time windows

Memetic algorithm

Mathematical formulation

@&#ABSTRACT@&#


               
               
                  In this paper, we introduce a new variant of the Vehicle Routing Problem (VRP), namely the Two-Stage Vehicle Routing Problem with Arc Time Windows (TS_VRP_ATWs) which generally emerges from both military and civilian transportation. The TS_VRP_ATW is defined as finding the vehicle routes in such a way that each arc of the routes is available only during a predefined time interval with the objective of overall cost minimization. We propose a Mixed Integer Programming (MIP) formulation and a heuristic approach based on Memetic Algorithm (MA) to solve the TS_VRP_ATW. The qualities of both solution approaches are measured by using the test problems in the literature. Experimental results show that the proposed MIP formulation provides the optimal solutions for the test problems with 25 and 50 nodes, and some test problems with 100 nodes. Results also show that the proposed MA is promising quality solutions in a short computation time.
               
            

@&#INTRODUCTION@&#

The design of distribution systems is one of the key components of logistics systems as it offers a great potential in order to reduce costs and to improve service quality. Therefore, huge number of studies have been devoted to find good solutions for these systems. In this research area, one of the main topics is the vehicle routing problem (VRP) which involves the design of a set of minimum cost routes serving a set of customers with known demands. In classical VRPs, each customer is served exactly once, each vehicle originates and terminates at the main depot, and all customers must be assigned to only one vehicle such that the vehicle capacities are not exceeded. Following the introduction of the VRP by Dantzig and Ramser (1959), several mathematical models and exact solution procedures developed for small and medium-size VRPs in the literature (Achuthan et al., 2003; Araque et al., 1994; Augerat et al., 1998; Baldacci et al., 2012; Lysgaard et al., 2004; Ralphs, 2003). It is commonly known that VRP belongs to the class of NP-hard problems. Because of its intractability manner, a great deal of heuristic/meta-heuristic approaches have been successfully implemented for the problem. We refer the readers to the review of (Toth and Vigo, 2002) for VRPs and their applications, (Eksioglu et al., 2009) for taxonomic review of VRPs, (Funke et al., 2005) for local search algorithms, and more recently (Doerner and Schmid, 2010) for meta-heuristic algorithms.

The vehicle routing problem with time windows (VRP_TW) is a natural extension of the VRP, motivated by the availability of nodes for a specific time windows. In general form of the VRP_TW, each node must be visited in a predetermined time interval. However, in practice, time window restrictions for node routing problems (i.e. VRPs) can also be appeared on arcs in addition to nodes. Two of them can be given as follows:
                        
                           •
                           In military logistic system of Turkey, some roads can only be used in predetermined time windows. For instance, especially in eastern cities of Turkey, the roads between city centers and districts generally pass through highlands which are potential ambush locations. Therefore, these roads can only be used in daylights to avoid terrorist attack.

In addition to the military applications, time window restriction can also be appeared in civilian transportation systems. For example, the trucks cannot enter the city center in rush hours (i.e. between 7–10am and between 4–7pm), because these hours includes the beginning and ending time of shifts and the traffic density reaches at the extreme level. Therefore, the entrance of trucks to the city center in these hours is forbidden by local government to facilitate the traffic flow.

Although, there exist many studies in the node routing literature considering the node time windows, to the best of our knowledge, there is no previous study considering the arc time windows. Because of the increasing importance of these restrictions for the military and civilian transportation, this paper considers the Vehicle Routing Problem with Arc Time Windows (VRP_ATWs). Two-stage version of VRP_ATW (namely TS_VRP_ATW) is discussed as well, which is the distribution network structure of the military logistic system in Turkey. In this problem, the network is divided into three layers (facility, depots and customers) and routing operations encountered in both stages each consisting successive layers (i.e. between facility-depots, and depots-customers). We propose Mixed Integer Programming (MIP) formulations for both VRP_ATW and TS_VRP_ATW. We also develop a meta-heuristic approach called Memetic Algorithm (MA) to solve the large-size problem instances. In order to evaluate the performance of the proposed MIP formulation and MA, we carry out experimental study by using various size test problems adapted from the literature. Experimental results show that the proposed MIP formulation gives the optimal solutions for the test problems with 25 and 50 nodes, and some test problems with 100 nodes. The proposed MA also achieves good quality solutions especially for the large-size test problems. The average percentage gap values of the proposed MIP formulation and MA are 1.05 and 2.26, while the average solution times are 984.81 and 11.20s, respectively.

The main contribution of this paper is threefold. First, we define the VRP_ATW and emphasize the relationship with other node routing problems. Second, we propose a MIP formulation for VRP_ATW, and extend this formulation to TS_VRP_ATW. Although, there are several papers considering complex routing operations among stages (i.e. (Ambrosino and Graziascutella, 2005; Ambrosino et al., 2009)), to the best of our knowledge, this is the first paper dealing with multi stage VRP under time window restrictions. Finally, we propose a meta-heuristic approach (MA) to solve the large-size problem instances.

The rest of this paper is organized as follows. Related literature for the problem given in Section 2. The definition of the VRP_ATW, the mathematical formulation and the relationship with other routing problems are shown in Section 3. The definition and the mathematical formulation for the TS_VRP_ATW are given in Section 4. The detailed description of the proposed algorithm is given in Section 5. Section 6 reports computational results, and conclusion and future directions are discussed in the last section.

@&#LITERATURE REVIEW@&#


                     Hadjar and Soumis (2009) have studied the closely related problem, namely multiple depot vehicle scheduling problem with time windows, and proposed a branch-and-price algorithm for the problem. In this paper, the time windows have been transferred from nodes to the arcs for reducing the dimension of huge number of variables, and thus speed up the solution procedure. However, such a problem involves node time windows rather than arc time windows under different structure.

The concept of “time window restrictions on arcs” has been well documented in the capacitated arc routing problem (CARP) literature. In these problems, the main objective is to find a least cost traversal of all required edges in the network in such a way that service must begin and end at the same node (i.e. depot node), and the service must start and finish in a predetermined time interval for all required edges. These time window restrictions may be encountered in areas such as urban waste collection, postal deliveries, treatment of roads to remove snow or to prevent ice forming, or taking pictures of street and roads for digital maps. CARP with time windows (CARP_TW) have been introduced by Mullaseril (1997). In this paper, a heuristic algorithm and a transformation approach into a VRP_TW have been developed. Wøhlk (2005) has also considered the CARP_TW and presented two mathematical models, several heuristics, a column generation technique to obtain the lower bounds and a dynamic programming approach for the problem. Reghioui et al. (2007) have proposed a hybrid heuristic technique combining greedy randomized adaptive search procedure (GRASP) and path relinking. The authors have shown that proposed heuristic can compete with the best existing heuristic in the literature. Vansteenwegen et al. (2010) have considered the mobile mapping van problem equivalent to CARP with time soft windows and proposed a two-phase heuristic search algorithm for the problem. The authors have proven the strength of the algorithm on the test problems derived from the literature, and several real-life examples. For reference, Corbeŕn and Prins (2010) can be reviewed.

In this section, we first define the VRP_ATW and give the relationship with other related problems. We then present a Mixed Integer Programming (MIP) formulation for the problem.

The VRP_ATW can be defined as follows: Let G
                        =(N,
                        A) be a complete directed graph where N
                        ={0}∪
                        N
                        
                           C
                         is a set of nodes in which “0” and N
                        
                           C
                         represent the depot and customers, respectively, and A
                        ={(i,
                        j)∣i
                        ≠
                        j, ∀i, j
                        ∈
                        N} is the set of arcs. A fleet of homogeneous vehicles with known capacity is available at the depot. Each customer has a nonnegative demand. Each arc has a nonnegative cost, a transportation time, and a time window which identifies the availability of arc. The transition for all arcs must begin within its time window, if used. The problem is to determine the vehicle routes with minimum total cost under following constraints: (i) each vehicle is used at most one route, (ii) each customer is served exactly once, (iii) each route begins and ends at the depot, (iv) the total vehicle load at any point of the route does not exceed the vehicle capacity, and (v) the transition for each arc on any route begins within its time window.

We next introduce sets, notations and decision variables then proceed by representing the MIP formulation (referred as F1).


                           
                              
                                 
                                    
                                    
                                       
                                          
                                             N
                                             
                                                C
                                             : set of all customers
                                       
                                       
                                          
                                             N: set of all nodes (N
                                             ={0}∪
                                             N
                                             
                                                C
                                             )
                                       
                                       
                                          
                                             Q: vehicle capacity
                                       
                                       
                                          
                                             d
                                             
                                                i
                                             : demand of customer i
                                             ∈
                                             N
                                             
                                                C
                                              with d
                                             
                                                i
                                             
                                             ⩽
                                             Q
                                          
                                       
                                       
                                          
                                             c
                                             
                                                ij
                                             : cost of an arc (i,
                                             j)∈
                                             A
                                          
                                       
                                       
                                          
                                             t
                                             
                                                ij
                                             : transportation time of an arc (i,
                                             j)∈
                                             A
                                          
                                       
                                       
                                          
                                             a
                                             
                                                ij
                                             : earliest available time of an arc (i,
                                             j)∈
                                             A
                                          
                                       
                                       
                                          
                                             b
                                             
                                                ij
                                             : latest available time of an arc (i,
                                             j)∈
                                             A
                                          
                                       
                                    
                                 
                              
                           
                        


                           
                              
                                 
                                    
                                       
                                          x
                                       
                                       
                                          ij
                                       
                                    
                                    =
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      1
                                                   
                                                   
                                                      if
                                                      
                                                      a
                                                      
                                                      vehicle
                                                      
                                                      travels
                                                      
                                                      directly
                                                      
                                                      from
                                                      
                                                      node
                                                      
                                                      i
                                                      
                                                      to
                                                      
                                                      node
                                                      
                                                      j
                                                      
                                                      (
                                                      ∀
                                                      i
                                                      ,
                                                      j
                                                      ∈
                                                      N
                                                      )
                                                   
                                                
                                                
                                                   
                                                      0
                                                   
                                                   
                                                      otherwise
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        


                           
                              
                                 
                                    
                                    
                                       
                                          
                                             U
                                             
                                                i
                                             ; Load on a vehicle just before having serviced to customer i (∀i
                                             ∈
                                             N
                                             
                                                C
                                             )
                                       
                                       
                                          
                                             S
                                             
                                                i
                                             ; Departure time of a vehicle from node i (∀ i
                                             ∈
                                             N
                                             
                                                C
                                             )
                                       
                                    
                                 
                              
                           
                        


                           
                              
                                 (1)
                                 
                                    
                                       min
                                    
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                             ∈
                                             N
                                          
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             j
                                             ∈
                                             N
                                          
                                       
                                    
                                    
                                       
                                          c
                                       
                                       
                                          ij
                                       
                                    
                                    
                                       
                                          x
                                       
                                       
                                          ij
                                       
                                    
                                 
                              
                           
                           
                              
                                 (2)
                                 
                                    
                                       
                                          
                                             
                                                Subject
                                                
                                                to
                                             
                                          
                                          
                                       
                                       
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         i
                                                         ∈
                                                         N
                                                      
                                                   
                                                
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      ij
                                                   
                                                
                                                =
                                                1
                                                
                                                ∀
                                                j
                                                ∈
                                                
                                                   
                                                      N
                                                   
                                                   
                                                      C
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                           
                              
                                 (3)
                                 
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             j
                                             ∈
                                             N
                                          
                                       
                                    
                                    
                                       
                                          x
                                       
                                       
                                          ji
                                       
                                    
                                    -
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             j
                                             ∈
                                             N
                                          
                                       
                                    
                                    
                                       
                                          x
                                       
                                       
                                          ij
                                       
                                    
                                    =
                                    0
                                    
                                    ∀
                                    i
                                    ∈
                                    N
                                 
                              
                           
                           
                              
                                 (4)
                                 
                                    
                                       
                                          U
                                       
                                       
                                          j
                                       
                                    
                                    -
                                    
                                       
                                          U
                                       
                                       
                                          i
                                       
                                    
                                    +
                                    
                                       
                                          Qx
                                       
                                       
                                          ij
                                       
                                    
                                    +
                                    (
                                    Q
                                    -
                                    
                                       
                                          d
                                       
                                       
                                          i
                                       
                                    
                                    -
                                    
                                       
                                          d
                                       
                                       
                                          j
                                       
                                    
                                    )
                                    
                                       
                                          x
                                       
                                       
                                          ji
                                       
                                    
                                    ⩽
                                    Q
                                    -
                                    
                                       
                                          d
                                       
                                       
                                          i
                                       
                                    
                                    
                                    ∀
                                    i
                                    ,
                                    j
                                    ∈
                                    
                                       
                                          N
                                       
                                       
                                          C
                                       
                                    
                                    ;
                                    
                                    i
                                    
                                    ≠
                                    
                                    j
                                 
                              
                           
                           
                              
                                 (5)
                                 
                                    
                                       
                                          U
                                       
                                       
                                          i
                                       
                                    
                                    ⩾
                                    
                                       
                                          d
                                       
                                       
                                          i
                                       
                                    
                                    +
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             j
                                             ∈
                                             
                                                
                                                   N
                                                
                                                
                                                   0
                                                
                                             
                                             ,
                                             j
                                             ≠
                                             i
                                          
                                       
                                    
                                    
                                       
                                          d
                                       
                                       
                                          j
                                       
                                    
                                    
                                       
                                          x
                                       
                                       
                                          ij
                                       
                                    
                                    
                                    ∀
                                    i
                                    ∈
                                    
                                       
                                          N
                                       
                                       
                                          C
                                       
                                    
                                 
                              
                           
                           
                              
                                 (6)
                                 
                                    
                                       
                                          U
                                       
                                       
                                          i
                                       
                                    
                                    ⩽
                                    Q
                                    -
                                    (
                                    Q
                                    -
                                    
                                       
                                          d
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    
                                       
                                          x
                                       
                                       
                                          i
                                          0
                                       
                                    
                                    
                                    ∀
                                    i
                                    ∈
                                    
                                       
                                          N
                                       
                                       
                                          C
                                       
                                    
                                 
                              
                           
                           
                              
                                 (7)
                                 
                                    
                                       
                                          S
                                       
                                       
                                          i
                                       
                                    
                                    -
                                    
                                       
                                          S
                                       
                                       
                                          j
                                       
                                    
                                    +
                                    M
                                    
                                       
                                          1
                                       
                                       
                                          ij
                                       
                                    
                                    
                                       
                                          x
                                       
                                       
                                          ij
                                       
                                    
                                    ⩽
                                    M
                                    
                                       
                                          1
                                       
                                       
                                          ij
                                       
                                    
                                    -
                                    
                                       
                                          t
                                       
                                       
                                          ij
                                       
                                    
                                    
                                    ∀
                                    i
                                    ,
                                    j
                                    ∈
                                    
                                       
                                          N
                                       
                                       
                                          C
                                       
                                    
                                    ;
                                    
                                    i
                                    
                                    ≠
                                    
                                    j
                                 
                              
                           
                           
                              
                                 (8)
                                 
                                    
                                       
                                          S
                                       
                                       
                                          j
                                       
                                    
                                    ⩾
                                    (
                                    
                                       
                                          a
                                       
                                       
                                          0
                                          j
                                       
                                    
                                    +
                                    
                                       
                                          t
                                       
                                       
                                          0
                                          j
                                       
                                    
                                    )
                                    
                                       
                                          x
                                       
                                       
                                          0
                                          j
                                       
                                    
                                    
                                    ∀
                                    j
                                    ∈
                                    
                                       
                                          N
                                       
                                       
                                          C
                                       
                                    
                                 
                              
                           
                           
                              
                                 (9)
                                 
                                    
                                       
                                          S
                                       
                                       
                                          i
                                       
                                    
                                    ⩾
                                    
                                       
                                          a
                                       
                                       
                                          ij
                                       
                                    
                                    
                                       
                                          x
                                       
                                       
                                          ij
                                       
                                    
                                    
                                    ∀
                                    i
                                    ∈
                                    
                                       
                                          N
                                       
                                       
                                          C
                                       
                                    
                                    ;
                                    
                                    ∀
                                    j
                                    ∈
                                    N
                                    ;
                                    
                                    i
                                    
                                    ≠
                                    
                                    j
                                 
                              
                           
                           
                              
                                 (10)
                                 
                                    
                                       
                                          S
                                       
                                       
                                          i
                                       
                                    
                                    ⩽
                                    
                                       
                                          b
                                       
                                       
                                          ij
                                       
                                    
                                    +
                                    M
                                    
                                       
                                          2
                                       
                                       
                                          ij
                                       
                                    
                                    (
                                    1
                                    -
                                    
                                       
                                          x
                                       
                                       
                                          ij
                                       
                                    
                                    )
                                    
                                    ∀
                                    i
                                    ∈
                                    
                                       
                                          N
                                       
                                       
                                          C
                                       
                                    
                                    ;
                                    
                                    ∀
                                    j
                                    ∈
                                    N
                                    ;
                                    
                                    i
                                    
                                    ≠
                                    
                                    j
                                 
                              
                           
                           
                              
                                 (11)
                                 
                                    
                                       
                                          x
                                       
                                       
                                          ij
                                       
                                    
                                    ∈
                                    {
                                    0
                                    ,
                                    1
                                    }
                                    
                                    ∀
                                    i
                                    ,
                                    j
                                    ∈
                                    N
                                 
                              
                           
                           
                              
                                 (12)
                                 
                                    
                                       
                                          U
                                       
                                       
                                          j
                                       
                                    
                                    ,
                                    
                                       
                                          S
                                       
                                       
                                          j
                                       
                                    
                                    ⩾
                                    0
                                    
                                    ∀
                                    j
                                    ∈
                                    
                                       
                                          N
                                       
                                       
                                          C
                                       
                                    
                                 
                              
                           where M1
                              ij
                            and M2
                              ij
                            are sufficiently large numbers satisfying constraint sets (7) and (10) when x
                           
                              ij
                           
                           =0, respectively. Furthermore, we set x
                           
                              ij
                           
                           =0 whenever (d
                           
                              i
                           
                           +
                           d
                           
                              j
                           
                           >
                           Q) or (a
                           
                              ij
                           
                           +
                           t
                           
                              ij
                           
                           >max(k∈N∣k≠i)(b
                           
                              jk
                           )).

In (F1), objective function (1) minimizes the total transportation cost. Constraint sets (2) and (3) are known as degree constraints. While constraint set (2) ensures that each customer must be visited exactly once, constraint set (3) guarantees that the number of entering and leaving arcs to each node are equal. Constraint sets (4)–(6) are well known Miller–Tucker–Zemlin (MTZ) constraints eliminating the subtours, subject to the capacity restrictions. Constraint sets (7)–(10) define the time windows restrictions. While constraint set (7) determines the departure time of each customer depending on the previous node on a route, constraint sets (8) and (9) guarantee that the departure time of each node must be greater than the earliest available time of used arc. Similarly, constraint set (10) ensures that the departure time of each node must be smaller than the latest available time of used arc. And finally, constraint sets (11) and (12) are integrality and non-negativity constraints, respectively.

In most combinatorial optimization problems, the efficiency of any MIP formulation depends on the strength of the linear programming (LP) relaxation of a given formulation. There are several ways to strengthen the LP relaxations of the formulations. One of them is to lift the current constraints. Please note that constraint sets (4)–(6) are lifted version of the classical MTZ constraints. These constraints have been proposed by Miller et al. (1960) for the Traveling Salesman Problem (TSP). Kulkarni and Bhave (1985) have adapted them to the VRP and Desrochers and Laporte (1991) have lifted them and introduced new bounding constraints on additional variables. Finally, Kara et al. (2004) have corrected the lifted version of these constraints. Meanwhile, exact meanings to additional variables have been given by Kara (2008).

Another way to strengthen the LP relaxations is improving the constraints including big M constants (i.e. M1
                              ij
                            and M2
                              ij
                            in constraint sets (7) and (10)). These numbers should be as small as possible to obtain good lower bounds, which shorten the optimization process. Therefore, we set 
                              
                                 M
                                 
                                    
                                       1
                                    
                                    
                                       ij
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             S
                                          
                                          
                                             ¯
                                          
                                       
                                    
                                    
                                       i
                                    
                                 
                                 -
                                 
                                    
                                       
                                          
                                             S
                                          
                                          
                                             ̲
                                          
                                       
                                    
                                    
                                       j
                                    
                                 
                                 +
                                 
                                    
                                       t
                                    
                                    
                                       ij
                                    
                                 
                              
                            and 
                              
                                 M
                                 
                                    
                                       2
                                    
                                    
                                       ij
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             S
                                          
                                          
                                             ¯
                                          
                                       
                                    
                                    
                                       i
                                    
                                 
                                 -
                                 
                                    
                                       b
                                    
                                    
                                       ij
                                    
                                 
                              
                            where 
                              
                                 
                                    
                                       
                                          
                                             S
                                          
                                          
                                             ¯
                                          
                                       
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 
                                    
                                       max
                                    
                                    
                                       j
                                       ∈
                                       N
                                    
                                 
                                 (
                                 
                                    
                                       b
                                    
                                    
                                       ij
                                    
                                 
                                 +
                                 
                                    
                                       t
                                    
                                    
                                       ij
                                    
                                 
                                 )
                              
                            and 
                              S
                           
                           
                              j
                           
                           =min(a
                           0j
                           
                           +
                           t
                           0j
                           ).

The last way is to include the valid inequalities, one of the most practical ways to strengthen the LP relaxations of the formulations. We therefore utilize the following valid inequality for (F1).
                              
                                 (13)
                                 
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             j
                                             ∈
                                             
                                                
                                                   N
                                                
                                                
                                                   C
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          x
                                       
                                       
                                          0
                                          j
                                       
                                    
                                    ⩾
                                    
                                       
                                          r
                                       
                                       
                                          VRP
                                          _
                                          ATW
                                       
                                    
                                    (
                                    
                                       
                                          N
                                       
                                       
                                          C
                                       
                                    
                                    )
                                 
                              
                           where, 
                              
                                 
                                    
                                       r
                                    
                                    
                                       VRP
                                       _
                                       ATW
                                    
                                 
                                 (
                                 
                                    
                                       N
                                    
                                    
                                       C
                                    
                                 
                                 )
                                 =
                                 ⌈
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       ∈
                                       
                                          
                                             N
                                          
                                          
                                             C
                                          
                                       
                                    
                                 
                                 
                                    
                                       d
                                    
                                    
                                       i
                                    
                                 
                                 /
                                 Q
                                 ⌉
                              
                            and ⌈•⌉ is the smallest integer bigger than •. This constraint bounds below the number of routes originating from the depot.

In this paper, we used all of these rules to strengthen the LP relaxation of our formulation.

The VRP_ATW can be considered as the classical VRP when a
                        
                           ij
                        
                        =0 and b
                        
                           ij
                        
                        =∞. Since the VRP belongs to the class of NP-hard problems, the VRP_ATW is also NP-hard.

Any VRP_TW instance can easily be converted into a VRP_ATW by replacing the time window constraints on nodes with time window constraints on arcs, such that a
                        
                           ij
                        
                        =
                        e
                        
                           i
                         and b
                        
                           ij
                        
                        =
                        min{l
                        
                           i
                        ,l
                        
                           j
                         
                        −
                        t
                        
                           ij
                        } where e
                        
                           i
                        (l
                        
                           i
                        ) is the earliest (latest) available time of nodes for the corresponding VRP_TW instance. This transformation technique has also been used by Hadjar and Soumis (2009) for the multiple depot vehicle scheduling problem with time windows. Therefore, any solution procedure developed for the VRP_ATW can also be used directly to solve the VRP_TW after this transformation. Moreover, time window constraints can be appeared on both nodes and arcs. In this situation, the problem can be converted to the equivalent VRP_ATW by setting 
                           
                              
                                 
                                    a
                                 
                                 
                                    ij
                                 
                                 
                                    ′
                                 
                              
                              =
                              max
                              {
                              
                                 
                                    e
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                                 
                                    a
                                 
                                 
                                    ij
                                 
                              
                              }
                           
                         and 
                           
                              
                                 
                                    b
                                 
                                 
                                    ij
                                 
                                 
                                    ′
                                 
                              
                              =
                              min
                              {
                              
                                 
                                    b
                                 
                                 
                                    ij
                                 
                              
                              ,
                              min
                              {
                              
                                 
                                    l
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                                 
                                    l
                                 
                                 
                                    j
                                 
                              
                              -
                              
                                 
                                    t
                                 
                                 
                                    ij
                                 
                              
                              }
                              }
                           
                         where 
                           
                              
                                 
                                    a
                                 
                                 
                                    ij
                                 
                                 
                                    ′
                                 
                              
                              
                                 
                                    
                                       
                                          
                                             b
                                          
                                          
                                             ij
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 
                              
                           
                         is the earliest (latest) available time of arcs for the transformed VRP_ATW instance. Please note that, after these transformations any arc satisfying a
                        
                           ij
                        
                        >
                        b
                        
                           ij
                         can be removed from the problem instance.

However, as far as we search the literature, the reverse relationship (i.e. transformation from VRP_ATW to VRP_TW) does not exist, since there could be different time windows of all outgoing arcs for all nodes, and aggregating them to a single time window for origin node is not possible. Instead, we can transform any VRP_ATW instance to the Generalized Vehicle Routing Problem with Time Windows (GVRP_TW) which provides a useful modeling framework for a wide variety of applications (Baldacci et al., 2010; Moccia et al., 2011). The detailed definition of the GVRP_TW and the transformation steps are given in Appendix A.

Our interest in considering two-stage version of VRP_ATW actually stems from the logistic system of the General Commandership of Gendarmerie of Turkey. In this system, ammunitions (spare parts) stored (produced) in a main depot (factory) which is located in Ankara are firstly dispatched to the provincial gendarmerie units which are located in city centers all around country by using large trucks. Then these parts routed from the provincial gendarmerie units to the local/border units by using small pickup trucks. However, due to the “safe day” implementation which is applied for the distribution to the eastern cities in order to avoid the terrorist attack, the roads are available only during a predetermined time windows. The problem under investigation can be described as Two-Stage VRP_ATW (TS_VRP_ATW) where the network is divided into three layers (i.e. facility, depots and customers) and routing operations is encountered in both stages each consisting successive layers (i.e. between facility-depots, and depots-customers).

TS_VRP_ATW can be defined as follows: Let G
                     =(N,
                     A) be a tripartite complete directed graph where N
                     ={0}∪
                     J
                     ∪
                     K is a set of nodes in which “0”, J and K represent facility, depots and customers, respectively, and A
                     ={(i,
                     j)∣i
                     ≠
                     j, ∀i, j
                     ∈
                     N} is the set of arcs. Each arc has a nonnegative cost, a transportation time, and a time window which identifies the availability of arc. Each customer is served from a predefined depot. Facility and depots have enough capacity to meet their demands. Two types of vehicle fleet with known capacities are available to serve between facility-depots, and between depots-customers, respectively. Each customer has a nonnegative demand, The problem is to determine the vehicle routes with minimum total cost under following constraints: (i) commodities are transported from facility to depots on a route, and then from depots to the customers. The transportation from facility to customers is not permitted, (ii) each vehicle is used at most one route in only one stage, (iii) each customer/depot is served exactly once, (iv) each route begins and ends at the node where they started (i.e. facility or depot), (v) the total vehicle load at any point of the route does not exceed the vehicle capacity, and (vi) the transition for each arc on any route begins within its time window,

The TS_VRP_ATW can be considered as the VRP_ATW when the depots intermediate between facilities and customers are removed. Since the VRP_ATW belongs to the class of NP-hard problems, the TS_VRP_ATW is also NP-hard.

According to these definitions, the sets, notations, decision variables and MIP formulation (referred as F2) are given as follows (c
                     
                        ij
                     ,
                     t
                     
                        ij
                     ,
                     a
                     
                        ij
                      
                     and b
                     
                        ij
                      are as given in Section 3.2):


                        
                           
                              
                                 
                                 
                                 
                                    
                                       
                                          J
                                       
                                       Set of all depots
                                    
                                    
                                       
                                          K
                                       
                                       Set of all customers
                                    
                                    
                                       
                                          N
                                       
                                       Set of all nodes (N
                                          ={0}∪
                                          J
                                          ∪
                                          K)
                                    
                                    
                                       
                                          K
                                          
                                             j
                                          
                                       
                                       Set of customers assigned to depot j
                                          ∈
                                          J
                                       
                                    
                                    
                                       
                                          Q
                                          
                                             fd
                                          
                                       
                                       Capacity of a vehicle available to serve between facility and depots
                                    
                                    
                                       
                                          Q
                                          
                                             dc
                                          
                                       
                                       Capacity of a vehicle available to serve between depots and customers
                                    
                                    
                                       
                                          d
                                          
                                             k
                                          
                                       
                                       Demand of customer k
                                          ∈
                                          K with d
                                          
                                             k
                                          
                                          ⩽
                                          Q
                                          
                                             dc
                                           and 
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      k
                                                      ∈
                                                      
                                                         
                                                            K
                                                         
                                                         
                                                            j
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      d
                                                   
                                                   
                                                      k
                                                   
                                                
                                                ⩽
                                                
                                                   
                                                      Q
                                                   
                                                   
                                                      fd
                                                   
                                                
                                                :
                                                ∀
                                                j
                                                ∈
                                                J
                                                ,
                                                
                                                ∀
                                                k
                                                ∈
                                                
                                                   
                                                      K
                                                   
                                                   
                                                      j
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     


                        
                           
                              
                                 
                                    
                                       x
                                    
                                    
                                       ij
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   1
                                                
                                                
                                                   if
                                                   
                                                   a
                                                   
                                                   vehicle
                                                   
                                                   travels
                                                   
                                                   directly
                                                   
                                                   from
                                                   
                                                   node
                                                   
                                                   i
                                                   
                                                   to
                                                   
                                                   node
                                                   
                                                   j
                                                   
                                                   in
                                                   
                                                   the
                                                   
                                                   first
                                                   
                                                   stage
                                                   
                                                   (
                                                   ∀
                                                   i
                                                   ,
                                                   j
                                                   ∈
                                                   (
                                                   0
                                                   ∪
                                                   J
                                                   )
                                                   )
                                                
                                             
                                             
                                                
                                                   0
                                                
                                                
                                                   otherwise
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              
                                 
                                    
                                       y
                                    
                                    
                                       jkl
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   1
                                                
                                                
                                                   if
                                                   
                                                   a
                                                   
                                                   vehicle
                                                   ,
                                                   
                                                   originating
                                                   
                                                   from
                                                   
                                                   depot
                                                   
                                                   j
                                                   ,
                                                   
                                                   travels
                                                   
                                                   directly
                                                   
                                                   from
                                                   
                                                   node
                                                   
                                                   k
                                                   
                                                   to
                                                   
                                                   node
                                                   
                                                   l
                                                   
                                                   in
                                                   
                                                   the
                                                   
                                                   second
                                                   
                                                   stage
                                                   
                                                   (
                                                   ∀
                                                   j
                                                   ∈
                                                   J
                                                   ;
                                                   ∀
                                                   k
                                                   ,
                                                   l
                                                   ∈
                                                   (
                                                   j
                                                   ∪
                                                   
                                                      
                                                         K
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   )
                                                   )
                                                
                                             
                                             
                                                
                                                   0
                                                
                                                
                                                   otherwise
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     


                        
                           
                              
                                 
                                 
                                 
                                    
                                       
                                          U
                                          
                                             j
                                          
                                       
                                       Load on a vehicle just before having serviced to depot j in the first stage (∀j
                                          ∈
                                          J)
                                    
                                    
                                       
                                          V
                                          
                                             k
                                          
                                       
                                       Load on a vehicle just before having serviced to customer k in the second stage (∀k
                                          ∈
                                          K)
                                    
                                    
                                       
                                          S
                                          
                                             k
                                          
                                       
                                       Departure time of a vehicle from node k (∀k
                                          ∈(J
                                          ∪
                                          K))
                                    
                                 
                              
                           
                        
                     


                        
                           
                              (14)
                              
                                 
                                    min
                                 
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          ∈
                                          (
                                          0
                                          ∪
                                          J
                                          )
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          j
                                          ∈
                                          (
                                          0
                                          ∪
                                          J
                                          )
                                       
                                    
                                 
                                 
                                    
                                       c
                                    
                                    
                                       ij
                                    
                                 
                                 
                                    
                                       x
                                    
                                    
                                       ij
                                    
                                 
                                 +
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          j
                                          ∈
                                          J
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          k
                                          ∈
                                          (
                                          j
                                          ∪
                                          
                                             
                                                K
                                             
                                             
                                                j
                                             
                                          
                                          )
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          l
                                          ∈
                                          (
                                          j
                                          ∪
                                          
                                             
                                                K
                                             
                                             
                                                j
                                             
                                          
                                          )
                                       
                                    
                                 
                                 
                                    
                                       c
                                    
                                    
                                       kl
                                    
                                 
                                 
                                    
                                       y
                                    
                                    
                                       jkl
                                    
                                 
                              
                           
                        
                        
                           
                              (15)
                              
                                 
                                    
                                       
                                          
                                             Subject
                                             
                                             to
                                          
                                       
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      i
                                                      ∈
                                                      (
                                                      0
                                                      ∪
                                                      J
                                                      )
                                                   
                                                
                                             
                                             
                                                
                                                   x
                                                
                                                
                                                   ij
                                                
                                             
                                             =
                                             1
                                             
                                             ∀
                                             j
                                             ∈
                                             J
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (16)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          j
                                          ∈
                                          (
                                          0
                                          ∪
                                          J
                                          )
                                       
                                    
                                 
                                 
                                    
                                       x
                                    
                                    
                                       ji
                                    
                                 
                                 -
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          j
                                          ∈
                                          (
                                          0
                                          ∪
                                          J
                                          )
                                       
                                    
                                 
                                 
                                    
                                       x
                                    
                                    
                                       ij
                                    
                                 
                                 =
                                 0
                                 
                                 ∀
                                 i
                                 ∈
                                 (
                                 0
                                 ∪
                                 J
                                 )
                              
                           
                        
                        
                           
                              (17)
                              
                                 
                                    
                                       U
                                    
                                    
                                       j
                                    
                                 
                                 -
                                 
                                    
                                       U
                                    
                                    
                                       i
                                    
                                 
                                 +
                                 
                                    
                                       Q
                                    
                                    
                                       fd
                                    
                                 
                                 
                                    
                                       x
                                    
                                    
                                       ij
                                    
                                 
                                 +
                                 (
                                 
                                    
                                       Q
                                    
                                    
                                       fd
                                    
                                 
                                 -
                                 
                                    
                                       D
                                    
                                    
                                       i
                                    
                                 
                                 -
                                 
                                    
                                       D
                                    
                                    
                                       j
                                    
                                 
                                 )
                                 
                                    
                                       x
                                    
                                    
                                       ji
                                    
                                 
                                 ⩽
                                 
                                    
                                       Q
                                    
                                    
                                       fd
                                    
                                 
                                 -
                                 
                                    
                                       D
                                    
                                    
                                       i
                                    
                                 
                                 
                                 ∀
                                 i
                                 ,
                                 j
                                 ∈
                                 J
                                 ;
                                 
                                 i
                                 
                                 ≠
                                 
                                 j
                              
                           
                        
                        
                           
                              (18)
                              
                                 
                                    
                                       U
                                    
                                    
                                       i
                                    
                                 
                                 ⩾
                                 
                                    
                                       D
                                    
                                    
                                       i
                                    
                                 
                                 +
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          j
                                          ∈
                                          J
                                          ,
                                          j
                                          ≠
                                          i
                                       
                                    
                                 
                                 
                                    
                                       D
                                    
                                    
                                       j
                                    
                                 
                                 
                                    
                                       x
                                    
                                    
                                       ij
                                    
                                 
                                 
                                 ∀
                                 i
                                 ∈
                                 J
                              
                           
                        
                        
                           
                              (19)
                              
                                 
                                    
                                       U
                                    
                                    
                                       i
                                    
                                 
                                 ⩽
                                 
                                    
                                       Q
                                    
                                    
                                       fd
                                    
                                 
                                 -
                                 (
                                 
                                    
                                       Q
                                    
                                    
                                       fd
                                    
                                 
                                 -
                                 
                                    
                                       D
                                    
                                    
                                       i
                                    
                                 
                                 )
                                 
                                    
                                       x
                                    
                                    
                                       i
                                       0
                                    
                                 
                                 
                                 ∀
                                 i
                                 ∈
                                 J
                              
                           
                        
                        
                           
                              (20)
                              
                                 
                                    
                                       S
                                    
                                    
                                       j
                                    
                                 
                                 -
                                 
                                    
                                       S
                                    
                                    
                                       m
                                    
                                 
                                 +
                                 M
                                 
                                    
                                       1
                                    
                                    
                                       jm
                                    
                                 
                                 
                                    
                                       x
                                    
                                    
                                       jm
                                    
                                 
                                 ⩽
                                 M
                                 
                                    
                                       1
                                    
                                    
                                       jm
                                    
                                 
                                 -
                                 
                                    
                                       t
                                    
                                    
                                       jm
                                    
                                 
                                 
                                 ∀
                                 j
                                 ,
                                 m
                                 ∈
                                 J
                                 ;
                                 
                                 j
                                 
                                 ≠
                                 
                                 m
                              
                           
                        
                        
                           
                              (21)
                              
                                 
                                    
                                       S
                                    
                                    
                                       j
                                    
                                 
                                 ⩾
                                 (
                                 
                                    
                                       a
                                    
                                    
                                       0
                                       j
                                    
                                 
                                 +
                                 
                                    
                                       t
                                    
                                    
                                       0
                                       j
                                    
                                 
                                 )
                                 
                                    
                                       x
                                    
                                    
                                       0
                                       j
                                    
                                 
                                 
                                 ∀
                                 j
                                 ∈
                                 J
                              
                           
                        
                        
                           
                              (22)
                              
                                 
                                    
                                       S
                                    
                                    
                                       j
                                    
                                 
                                 ⩾
                                 
                                    
                                       a
                                    
                                    
                                       jm
                                    
                                 
                                 
                                    
                                       x
                                    
                                    
                                       jm
                                    
                                 
                                 
                                 ∀
                                 j
                                 ∈
                                 J
                                 ;
                                 
                                 ∀
                                 m
                                 ∈
                                 (
                                 0
                                 ∪
                                 J
                                 )
                                 ;
                                 
                                 j
                                 
                                 ≠
                                 
                                 m
                              
                           
                        
                        
                           
                              (23)
                              
                                 
                                    
                                       S
                                    
                                    
                                       j
                                    
                                 
                                 ⩽
                                 
                                    
                                       b
                                    
                                    
                                       jm
                                    
                                 
                                 +
                                 M
                                 
                                    
                                       2
                                    
                                    
                                       jm
                                    
                                 
                                 (
                                 1
                                 -
                                 
                                    
                                       x
                                    
                                    
                                       jm
                                    
                                 
                                 )
                                 
                                 ∀
                                 j
                                 ∈
                                 J
                                 ;
                                 
                                 ∀
                                 m
                                 ∈
                                 (
                                 0
                                 ∪
                                 J
                                 )
                                 ;
                                 
                                 j
                                 
                                 ≠
                                 
                                 m
                              
                           
                        
                        
                           
                              (24)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          k
                                          ∈
                                          (
                                          j
                                          ∪
                                          
                                             
                                                K
                                             
                                             
                                                j
                                             
                                          
                                          )
                                       
                                    
                                 
                                 
                                    
                                       y
                                    
                                    
                                       jkl
                                    
                                 
                                 =
                                 1
                                 
                                 ∀
                                 j
                                 ∈
                                 J
                                 ,
                                 
                                 ∀
                                 l
                                 ∈
                                 
                                    
                                       K
                                    
                                    
                                       j
                                    
                                 
                              
                           
                        
                        
                           
                              (25)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          k
                                          ∈
                                          (
                                          j
                                          ∪
                                          
                                             
                                                K
                                             
                                             
                                                j
                                             
                                          
                                          )
                                       
                                    
                                 
                                 
                                    
                                       y
                                    
                                    
                                       jkl
                                    
                                 
                                 -
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          k
                                          ∈
                                          (
                                          j
                                          ∪
                                          
                                             
                                                K
                                             
                                             
                                                j
                                             
                                          
                                          )
                                       
                                    
                                 
                                 
                                    
                                       y
                                    
                                    
                                       jlk
                                    
                                 
                                 =
                                 0
                                 
                                 ∀
                                 j
                                 ∈
                                 J
                                 ,
                                 
                                 ∀
                                 l
                                 ∈
                                 (
                                 j
                                 ∪
                                 
                                    
                                       K
                                    
                                    
                                       j
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              (26)
                              
                                 
                                    
                                       V
                                    
                                    
                                       l
                                    
                                 
                                 -
                                 
                                    
                                       V
                                    
                                    
                                       k
                                    
                                 
                                 +
                                 
                                    
                                       Q
                                    
                                    
                                       dc
                                    
                                 
                                 
                                    
                                       y
                                    
                                    
                                       jkl
                                    
                                 
                                 +
                                 (
                                 
                                    
                                       Q
                                    
                                    
                                       dc
                                    
                                 
                                 -
                                 
                                    
                                       d
                                    
                                    
                                       k
                                    
                                 
                                 -
                                 
                                    
                                       d
                                    
                                    
                                       l
                                    
                                 
                                 )
                                 
                                    
                                       y
                                    
                                    
                                       jlk
                                    
                                 
                                 ⩽
                                 
                                    
                                       Q
                                    
                                    
                                       dc
                                    
                                 
                                 -
                                 
                                    
                                       d
                                    
                                    
                                       k
                                    
                                 
                                 
                                 ∀
                                 j
                                 ∈
                                 J
                                 ,
                                 
                                 ∀
                                 k
                                 ,
                                 l
                                 ∈
                                 
                                    
                                       K
                                    
                                    
                                       j
                                    
                                 
                                 ;
                                 
                                 k
                                 
                                 ≠
                                 
                                 l
                              
                           
                        
                        
                           
                              (27)
                              
                                 
                                    
                                       V
                                    
                                    
                                       k
                                    
                                 
                                 ⩾
                                 
                                    
                                       d
                                    
                                    
                                       k
                                    
                                 
                                 +
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          l
                                          ∈
                                          
                                             
                                                K
                                             
                                             
                                                j
                                             
                                          
                                          ,
                                          k
                                          ≠
                                          l
                                       
                                    
                                 
                                 
                                    
                                       d
                                    
                                    
                                       l
                                    
                                 
                                 
                                    
                                       y
                                    
                                    
                                       jkl
                                    
                                 
                                 
                                 ∀
                                 j
                                 ∈
                                 J
                                 ,
                                 
                                 ∀
                                 k
                                 ∈
                                 
                                    
                                       K
                                    
                                    
                                       j
                                    
                                 
                              
                           
                        
                        
                           
                              (28)
                              
                                 
                                    
                                       V
                                    
                                    
                                       k
                                    
                                 
                                 ⩽
                                 
                                    
                                       Q
                                    
                                    
                                       dc
                                    
                                 
                                 -
                                 (
                                 
                                    
                                       Q
                                    
                                    
                                       dc
                                    
                                 
                                 -
                                 
                                    
                                       d
                                    
                                    
                                       k
                                    
                                 
                                 )
                                 
                                    
                                       y
                                    
                                    
                                       jkj
                                    
                                 
                                 
                                 ∀
                                 j
                                 ∈
                                 J
                                 ,
                                 
                                 ∀
                                 k
                                 ∈
                                 
                                    
                                       K
                                    
                                    
                                       j
                                    
                                 
                              
                           
                        
                        
                           
                              (29)
                              
                                 
                                    
                                       S
                                    
                                    
                                       k
                                    
                                 
                                 -
                                 
                                    
                                       S
                                    
                                    
                                       l
                                    
                                 
                                 +
                                 M
                                 
                                    
                                       1
                                    
                                    
                                       kl
                                    
                                 
                                 
                                    
                                       y
                                    
                                    
                                       jkl
                                    
                                 
                                 ⩽
                                 M
                                 
                                    
                                       1
                                    
                                    
                                       kl
                                    
                                 
                                 -
                                 
                                    
                                       t
                                    
                                    
                                       kl
                                    
                                 
                                 
                                 ∀
                                 j
                                 ∈
                                 J
                                 ,
                                 
                                 ∀
                                 k
                                 ,
                                 l
                                 ∈
                                 
                                    
                                       K
                                    
                                    
                                       j
                                    
                                 
                                 ;
                                 
                                 k
                                 
                                 ≠
                                 
                                 l
                              
                           
                        
                        
                           
                              (30)
                              
                                 
                                    
                                       S
                                    
                                    
                                       k
                                    
                                 
                                 ⩾
                                 
                                    
                                       S
                                    
                                    
                                       j
                                    
                                 
                                 +
                                 (
                                 
                                    
                                       a
                                    
                                    
                                       jk
                                    
                                 
                                 +
                                 
                                    
                                       t
                                    
                                    
                                       jk
                                    
                                 
                                 )
                                 
                                    
                                       y
                                    
                                    
                                       jjk
                                    
                                 
                                 
                                 ∀
                                 j
                                 ∈
                                 J
                                 ,
                                 
                                 ∀
                                 k
                                 ∈
                                 
                                    
                                       K
                                    
                                    
                                       j
                                    
                                 
                              
                           
                        
                        
                           
                              (31)
                              
                                 
                                    
                                       S
                                    
                                    
                                       k
                                    
                                 
                                 ⩾
                                 
                                    
                                       a
                                    
                                    
                                       kl
                                    
                                 
                                 
                                    
                                       y
                                    
                                    
                                       jkl
                                    
                                 
                                 
                                 ∀
                                 j
                                 ∈
                                 J
                                 ,
                                 
                                 ∀
                                 k
                                 ∈
                                 
                                    
                                       K
                                    
                                    
                                       j
                                    
                                 
                                 ;
                                 ∀
                                 l
                                 ∈
                                 (
                                 j
                                 ∪
                                 
                                    
                                       K
                                    
                                    
                                       j
                                    
                                 
                                 )
                                 ;
                                 
                                 k
                                 
                                 ≠
                                 
                                 l
                              
                           
                        
                        
                           
                              (32)
                              
                                 
                                    
                                       S
                                    
                                    
                                       k
                                    
                                 
                                 ⩽
                                 
                                    
                                       b
                                    
                                    
                                       kl
                                    
                                 
                                 +
                                 M
                                 
                                    
                                       2
                                    
                                    
                                       kl
                                    
                                 
                                 (
                                 1
                                 -
                                 
                                    
                                       y
                                    
                                    
                                       jkl
                                    
                                 
                                 )
                                 
                                 ∀
                                 j
                                 ∈
                                 J
                                 ,
                                 
                                 ∀
                                 k
                                 ∈
                                 
                                    
                                       K
                                    
                                    
                                       j
                                    
                                 
                                 ;
                                 ∀
                                 l
                                 ∈
                                 (
                                 j
                                 ∪
                                 
                                    
                                       K
                                    
                                    
                                       j
                                    
                                 
                                 )
                                 ;
                                 
                                 k
                                 
                                 ≠
                                 
                                 l
                              
                           
                        
                        
                           
                              (33)
                              
                                 
                                    
                                       x
                                    
                                    
                                       ij
                                    
                                 
                                 ∈
                                 {
                                 0
                                 ,
                                 1
                                 }
                                 
                                 ∀
                                 i
                                 ,
                                 j
                                 ∈
                                 (
                                 0
                                 ∪
                                 J
                                 )
                              
                           
                        
                        
                           
                              (34)
                              
                                 
                                    
                                       y
                                    
                                    
                                       jkl
                                    
                                 
                                 ∈
                                 {
                                 0
                                 ,
                                 1
                                 }
                                 
                                 ∀
                                 j
                                 ∈
                                 J
                                 ;
                                 
                                 ∀
                                 k
                                 ,
                                 l
                                 ∈
                                 (
                                 j
                                 ∪
                                 
                                    
                                       K
                                    
                                    
                                       j
                                    
                                 
                                 )
                              
                           
                        
                        
                           
                              (35)
                              
                                 
                                    
                                       U
                                    
                                    
                                       j
                                    
                                 
                                 ⩾
                                 0
                                 
                                 ∀
                                 j
                                 ∈
                                 J
                              
                           
                        
                        
                           
                              (36)
                              
                                 
                                    
                                       V
                                    
                                    
                                       k
                                    
                                 
                                 ⩾
                                 0
                                 
                                 ∀
                                 k
                                 ∈
                                 K
                              
                           
                        
                        
                           
                              (37)
                              
                                 
                                    
                                       S
                                    
                                    
                                       j
                                    
                                 
                                 ⩾
                                 0
                                 
                                 ∀
                                 j
                                 ∈
                                 (
                                 J
                                 ∪
                                 K
                                 )
                              
                           
                        where, M1
                           ij
                         and M2
                           ij
                         are defined as previously, and 
                           
                              
                                 
                                    D
                                 
                                 
                                    j
                                 
                              
                              =
                              
                                 
                                    ∑
                                 
                                 
                                    k
                                    ∈
                                    
                                       
                                          K
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              
                                 
                                    d
                                 
                                 
                                    j
                                 
                              
                              :
                              ∀
                              j
                              ∈
                              J
                           
                        . Moreover, we set x
                        
                           ij
                        
                        =0 whenever (D
                        
                           i
                        
                        +
                        D
                        
                           j
                        
                        >
                        Q
                        
                           fd
                        ) or (a
                        
                           ij
                        
                        +
                        t
                        
                           ij
                         
                        >max
                           k∈(0∪J)∣k≠i
                        (b
                        
                           jk
                        )), and y
                        
                           jkl
                        
                        =0 whenever (d
                        
                           k
                        
                        +
                        d
                        
                           l
                        
                        >
                        Q
                        
                           dc
                        ) or (a
                        
                           kl
                        
                        +
                        t
                        
                           kl
                        
                        >max
                           m∈(0∪J)∣m≠k
                         (b
                        
                           km
                        )).

It is easy to see that (F2) is an extended version of (F1). In (F2), objective function (14) minimizes the total transportation cost. The objective function includes two parts where the former related to the first stage and the latter related to the second stage transportation operations, respectively. Constraint sets (15) and (16) are known as degree constraints. Constraint sets (17)–(19) are MTZ capacity/subtour elimination constraints for the first stage. Constraint sets (20)–(23) define the time windows restrictions. While constraint set (20) determines the departure time of each depot depending on the previous node on a route, constraint sets (22) and (21) guarantee that the departure time of each node must be greater than the earliest available time of used arc. Similarly, constraint set (23) ensures that the departure time of each node must be smaller than the latest available time of used arc. Constraint sets (15)–(23) are used for modeling the routing operation in the first stage. Similarly, constraint set (24)–(32) are used for the second stage. And finally, constraint sets (33) and (34) are integrality constraints, and (35)–(37) are non-negativity constraints.

It is worthy to note that, in the absence of the time window restrictions, the second stage routes are not affected from the arrival time to the depot of the first stage routes (please see constraint set (30)). Under this assumption, the TS_VRP_ATW reduces to (J
                        +1) independent VRPs where the one is related to the routing operation between factory and depots (j
                        ∈
                        J), and the others are related to each depot (j
                        ∈
                        J) and corresponding customers (k
                        ∈
                        K
                        
                           j
                        ).

As explained in previous section, we utilize the following valid inequalities to strengthen the LP relaxation of model (F2).
                           
                              (38)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          j
                                          ∈
                                          J
                                       
                                    
                                 
                                 
                                    
                                       x
                                    
                                    
                                       0
                                       j
                                    
                                 
                                 ⩾
                                 
                                    
                                       r
                                    
                                    
                                       TS
                                       _
                                       VRP
                                       _
                                       ATW
                                    
                                 
                                 (
                                 J
                                 )
                              
                           
                        
                        
                           
                              (39)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          k
                                          ∈
                                          
                                             
                                                K
                                             
                                             
                                                j
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       y
                                    
                                    
                                       jjk
                                    
                                 
                                 ⩾
                                 
                                    
                                       r
                                    
                                    
                                       TS
                                       _
                                       VRP
                                       _
                                       ATW
                                    
                                 
                                 (
                                 
                                    
                                       K
                                    
                                    
                                       j
                                    
                                 
                                 )
                                 
                                 ∀
                                 j
                                 ∈
                                 J
                              
                           
                        where 
                           
                              
                                 
                                    r
                                 
                                 
                                    TS
                                    _
                                    VRP
                                    _
                                    ATW
                                 
                              
                              (
                              J
                              )
                              =
                              ⌈
                              
                                 
                                    ∑
                                 
                                 
                                    j
                                    ∈
                                    J
                                 
                              
                              
                                 
                                    D
                                 
                                 
                                    j
                                 
                              
                              /
                              
                                 
                                    Q
                                 
                                 
                                    fd
                                 
                              
                              ⌉
                           
                        , 
                           
                              
                                 
                                    r
                                 
                                 
                                    TS
                                    _
                                    VRP
                                    _
                                    ATW
                                 
                              
                              (
                              
                                 
                                    K
                                 
                                 
                                    j
                                 
                              
                              )
                              =
                              ⌈
                              
                                 
                                    ∑
                                 
                                 
                                    k
                                    ∈
                                    
                                       
                                          K
                                       
                                       
                                          j
                                       
                                    
                                 
                              
                              
                                 
                                    d
                                 
                                 
                                    k
                                 
                              
                              /
                              
                                 
                                    Q
                                 
                                 
                                    dc
                                 
                              
                              ⌉
                           
                         and ⌈•⌉ is the smallest integer bigger than •. While, constraint (38) bounds below the number of routes originating from the facility, constraint set (39) bounds below the number of routes originating from each depot, respectively.

As mentioned above, TS_VRP_ATW belongs to the class of NP-hard problems. Therefore, the proposed formulation is not directly applicable to find optimal solutions for the large-size problems. Hence, heuristic solution procedures are necessary to obtain good quality solutions quickly for these problems.

Motivated by the successful applications of Memetic Algorithms (MAs) in solving various vehicle routing problems (Boudia et al., 2007; Labadi et al., 2008; Liu and Jiang, 2012; Ngueveu et al., 2010; Prins, 2009), we propose a MA to solve realistic size of the TS_VRP_ATW.

MA is an evolutionary search procedure that use local search within a classical genetic algorithm framework. MA offer significant advantages over conventional methods by using simultaneously diversification (i.e. recombination) and intensification mechanisms (i.e. local search). This section presents the detailed description of components of the proposed MA for TS_VRP_ATW.

The performance of MA depends heavily on the chromosome structure that is used to represent solutions, and recombination operators that are used for this chromosome structure. Therefore, an appropriate chromosome structure should be developed for problem. When the related literature is examined, it is seen that good results were obtained by permutation encoding scheme originally proposed by Prins (2004) for the VRPs. For this reason, we developed an encoding scheme for our problem based on permutation encoding. In our structure, the length of the chromosome is equal to the sum of number of depots and customers (i.e., ∣J∣+∣K∣). Each gene gives information about the relative sequence of corresponding node with respect to other nodes. The decoding of a chromosome includes two main steps. Firstly, all nodes are grouped into their assigned depot. Please note that, for the first stage, the depots are considered as the customers of the facility. Then, the optimal routes for each group are obtained by using following splitting procedure which is modified version of route partitioning procedure proposed by Prins (2004) for the VRP. Let Ω
                        
                           k
                        
                        ={c
                        1,
                        c
                        2,…,
                        c
                        
                           s
                        } be a node set of corresponding group where s is the number of customers assigned to depot k, and G(N
                        
                           k
                        ,
                        A
                        
                           k
                        ) be a directed acyclic auxiliary graph where N
                        
                           k
                        
                        ={k
                        ∪
                        Ω
                        
                           k
                        } is the set of vertices and A
                        
                           k
                        
                        ={(c
                        
                           i
                        ,
                        c
                        
                           j
                        )∣c
                        
                           i
                        ,
                        c
                        
                           j
                        
                        ∈
                        N
                        
                           k
                         
                        and i
                        <
                        j} is the set of directed arcs. Each arc (c
                        
                           i
                        ,
                        c
                        
                           j
                        )∈
                        A
                        
                           k
                         represents a feasible route where the vehicle departs from depot (node k) and visits nodes c
                        
                           i+1, c
                        
                           i+2,…, c
                        
                           j−1 and c
                        
                           j
                        , consecutively, and turns back to the depot, such that load and time windows restrictions on any arc are satisfied. After the construction of auxiliary graph, a minimum cost-path on G from node k to last node (c
                        
                           s
                        ) defines the optimal partition of the sequence which leads to a feasible solution originating from depot k.

An illustrative example for a chromosome is given in Fig. 1
                        . In this example, TS_VRP_ATW consist of a facility (numbered as 0), 2 depots (numbered as 1 and 2) and 12 customers (numbered between 3 and 14). Customers with number between 3–7 and 8–14 are served from depot 1 and 2, respectively. Besides, the capacity of vehicle which is available between the facility and the depots is 200 units, and the one which is available between the depots and the customers is 40 units. Numbers in each gene determine the priorities of nodes relative to each other (Fig. 1a). Smaller numbers indicate that it will be routed earlier than the nodes having greater numbers. By considering relative priority values, initially the depots are assigned to the facility, and then, the customers to the depots (Fig. 1b). After this separation process, an auxiliary graph is constructed for each group (Fig. 1c). In this network, the first node is the facility/depot, from which the route will begin, and the others are the customers that will be routed. Each arc in the graph represents a possible route and the cost of each arc gives the total cost of corresponding route. For example, arc (5–3) represents the feasible route departed from depot 1 and serving only customer 3 (i.e. 1–3-1), and arc (3–4) represents the feasible route departed from depot 1 and serving customers 7 and 4 (i.e. 1–7-4–1). Similarly, for each possible route, these arcs are constructed. It is important to note that infeasible arcs should not be included to the graph, due to capacity or time window restrictions. For example, arc (8–10) which represents the route 2-14-9-10-2 is not included to the graph since the total demand of customer (70 units) is greater than the vehicle capacity (40 units). After construction of auxiliary graph, the shortest path from first node to last node is found and optimal solution of corresponding sequence is obtained by the routes that are represented by arcs used in that path (Fig. 1d).

The crossover operator is used to explore new solutions in the search space. In general, crossover operator is applied to obtain new solutions by exchanging some information between selected parents. Since our encoding scheme uses permutation encoding, several crossover operators (i.e. Partially Mapped Crossover (PMX), Order Crossover (OX), Cycle Crossover (CX)) can be used directly. After some preliminary experiments, we utilize PMX operator as illustrated in Fig. 2
                        . In this operator two cut points is selected randomly and the substring between these points is directly inherited from first parent (P1) to the same positions of the child. The substring is also used to determine the mapping relation. Then, each gene between cut points in the second parent (P2) are swapped using mapping relation, and copied to the empty positions of the child.

In this paper, for the purpose of improvement of newly produced individuals, local search algorithm is developed. In this algorithm, an individual that were obtained by crossover is converted to the real solution as explained in Section 5.1 and successive swap operations are applied to this solution. In swap operation, locations of two nodes which were randomly selected in the same route are exchanged. In each iteration of local search, the best solution is selected amongst ∣N∣ new neighbor obtained from current solution by swapping randomly selected nodes. If new solution is better than current solution, new solution is accepted as current solution. These steps are repeated until no improvement is obtained.

In our implementation, we use tournament selection mechanism. In this mechanism, two individual selected randomly from the population and the best individual is accepted as first parent (P1). The same steps are also used for the selection of second parent (P2). We implement steady-state replacement strategy in which only one new solution is obtained by PMX operator, improved by local search and inserted to the current population, and then the worst chromosome is removed from population. It should be noted that local search algorithm is also implemented to the initial population to improve the solution quality.

According to these definitions, the overall pseudo-code of MA for solving TS_VRP_ATW is outlined in Fig. 3
                        .

This section presents our computational results to investigate the performance of the proposed MIP formulation and MA. The state-of-the-art LP/MIP solver CPLEX (version 10.2) is used to solve the MIP formulation. We used the default CPLEX parameters to solve the formulation, and the total computation time for CPLEX has been limited to one hour (3600s). The proposed MA has been coded using C++ programming language. After preliminary experiments, population size is accepted as ∣N∣ and total number of generation as 50 ∗∣N∣. All experiments were performed on Intel Xeon 3.16GHz equipped (with 1GB RAM).

Since there are no benchmark instances in the literature for TS_VRP_ATW, we have derived our test problems considering the VRP_TW from test set generated by Solomon (1987). The detailed description of the test problems and the conversion steps are given in Appendix B.

In comparison, following performance measures are used: (i) Average solution time (CPU). (ii) Percentage Gap (Gap): calculated as 100∗[(UB
                     −
                     LB)/LB] where LB is the best lower bound provided by CPLEX (MIP bound) in one hour computation time and UB is the upper bound found by CPLEX (best integer feasible solution of MIP) or MA.


                     Tables 1–6
                     
                     
                     
                     
                     
                      present computational results for the proposed MIP formulation and MA on each TS_VRP_ATW test set, respectively. In these tables, while the first two columns represent the number of depots and customers, respectively, the third column gives the problem name. The names are indicated with “∗” for the test problem that optimal solution is found by CPLEX within one hour computation time. Next column shows the best lower bound (LB) provided by CPLEX. Finally, last two columns gives the percentage gap value (Gap) and computation time (CPU) of the proposed MIP formulation and MA, respectively. In these columns, better results are shown in bold.

As can be seen from Tables 1–3, optimal solutions are obtained by not only the proposed MIP model but also the proposed MA for all test problems with 25 and 50 nodes in a very short computing time.

For the test problems with 100 nodes, good quality solutions have been obtained by the proposed MIP formulation within one hour CPU time. The gap values are obtained as 8.16, 0.83 and 5.80, for C, R and RC-type of problems, respectively. According to results, it can be concluded that the test problems where the customers are clustered are more difficult to solve than other test problems. Meanwhile, good quality solutions are also obtained by the proposed MA. For C, R and RC-type of problems, 10.44, 4.57 and 10.74 gap values are obtained, respectively. Although better feasible solutions are obtained with the proposed MIP formulation, the solution times of the proposed MA are very short (23.14, 25.17 and 27.39s, respectively). It is well known that the solution time of any procedure should be as small as possible for the operational problems such as node routing problems. Therefore, the proposed MA is preferable to the proposed MIP formulation especially for the large-size problems.

Similar results are also obtained for the test problems with wide time windows. Tables 4–6 gives the computational results for C, R and RC-type of test problems with wide time windows, respectively. As can be seen from these tables, the best solutions are obtained by both solution methods for all test problems with 25 nodes in a very short computation time.

As for the test problems with 50 nodes, the best solutions are obtained by the proposed MIP formulation. Meanwhile, good quality solutions are also obtained by the proposed MA in a short computation time. Only 5 out of 27 test problems (namely R201-50, R202-50, R203-50, RC204-50 and RC208-50) cannot optimally be solved with the proposed MA. For C, R and RC-type of problems, 0.00, 0.40 and 0.68 gap values are obtained within 5.81, 6.03 and 6.30s, respectively.

With regard to the test problems with 100 nodes, while the optimal solutions are obtained for R-type test problems within 285.65s on average, no optimal solutions are obtained for C and RC-type test problems (the gap values are obtained as 2.31 and 3.46) within predetermined maximum solution time. Meantime, good solutions results are obtained with the proposed MA in a short computation times. For C, R and RC-type of problems, the gap values are obtained as 2.30, 0.16 and 3.41 within 23.52, 27.70 and 28.41s, respectively. Moreover, better results are obtained with the proposed MA for 4 of 8 in C-type and 3 of 8 in RC-type test problems, respectively.

In this study, a variant of the vehicle routing problem, called Two-Stage Vehicle Routing Problem with Arc Time Windows (TS_VRP_ATW) has been dealt with. We have proposed a Mixed Integer Programming (MIP) formulation and a Memetic Algorithm (MA) for the problem. The performance of the proposed solution methods have been investigated on a wide range of test problems derived from the literature. Experimental results indicate that the proposed MIP formulation gives the optimal solutions for small- and medium-size test problems, and some large-size test problems. Moreover, the proposed MA achieves good quality solutions for the test problems in a short computation time. According to these results, we conclude that the problem with up to 50 nodes should be solved using proposed MIP formulation. Otherwise, we recommend that it should be solved using proposed MA.

Further research can be performed on exact solution methods (i.e. Branch and Cut) for the large-size test problems to obtain optimal solutions in a reasonable computation time. Moreover, the proposed MIP formulation and MA can be adapted to different type of this problem such as VRP with multiple arc time windows, multi-period VRP_ATW, stochastic VRP_ATW, and VRP_ATW with heterogeneous vehicles. Complex distribution systems including arc time windows restrictions such as location routing problem with arc time windows, multistage VRP in which vehicles can be used in each stage, can also be investigated. Finally, the performance of the proposed MA can be increased by using new neighborhood mechanisms (i.e. insert and/or swap-range operators in addition to swap).

@&#ACKNOWLEDGEMENTS@&#

We thank to the Associate Editor and anonymous referees for their helpful comments and suggestions, which greatly contributed to the improvement of the paper.

Supplementary data associated with this article can be found, in the online version, at http://dx.doi.org/10.1016/j.ejor.2013.05.001.


                     
                        
                           Appendix
                           
                              Supplementary material contains Appendices A and B.
                           
                           
                        
                     
                  

@&#REFERENCES@&#

