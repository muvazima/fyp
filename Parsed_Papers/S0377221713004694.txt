@&#MAIN-TITLE@&#Finite and infinite-horizon single vehicle routing problems with a predefined customer sequence and pickup and delivery

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           We study a specific stochastic vehicle routing problem with deliveries and pickups.


                        
                        
                           
                           The customers are served according to a particular sequence.


                        
                        
                           
                           The decisions are made at the first visit to each customer.


                        
                        
                           
                           The optimal routing strategy can be found by a dynamic programming algorithm.


                        
                        
                           
                           The optimal strategy has a specific threshold structure when the time horizon is finite or infinite.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Logistics

Dynamic programming

Routing with pick up and delivery

@&#ABSTRACT@&#


               
               
                  We consider the problem of finding the optimal routing of a single vehicle that starts its route from a depot and picks up from and delivers K different products to N customers that are served according to a predefined customer sequence. The vehicle is allowed during its route to return to the depot to unload returned products and restock with new products. The items of all products are of the same size. For each customer the demands for the products that are delivered by the vehicle and the quantity of the products that is returned to the vehicle are discrete random variables with known joint distribution. Under a suitable cost structure, it is shown that the optimal policy that serves all customers has a specific threshold-type structure. We also study a corresponding infinite-time horizon problem in which the service of the customers is not completed when the last customer has been serviced but it continues indefinitely with the same customer order. For each customer, the joint distribution of the quantities that are delivered and the quantity that is picked up is the same at each cycle. The discounted-cost optimal policy and the average-cost optimal policy have the same structure as the optimal policy in the finite-horizon problem. Numerical results are given that illustrate the structural results.
               
            

@&#INTRODUCTION@&#

In the classical vehicle routing problem (VRP) the objective is to find the optimal routing of identical vehicles that start from a depot and deliver goods to a set of geographically dispersed customers. The capacitated vehicle routing problem (CVRP) is a VRP in which the capacity of the vehicles is finite. The quantity of the goods that each customer demands may be constant or a random variable. The CVPRs have drawn enormous interest from many researchers during the last 50years. It is a NP-hard problem and a great number of exact algorithms (e.g. branch-and-bound, branch-and-cut, branch-and-cut-and-price methods) and heuristics and metaheuristics (e.g. tabu search, simulated annealing, genetic algorithms, colony optimization) have been developed. The exact algorithms find the global minimum of the cost function, while the heuristics and metaheuristics produce good solutions but do not guarantee optimality. Metaheuristics usually give better solutions than heuristics, but require more computational time. Surveys of various relevant models and solutions can be found in Toth and Vigo (2002), Simchi-Levi et al. (2005), Liong et al. (2008). The capacitated vehicle routing problem with pickups and deliveries (CVRPPD) is an extension to the CVRP where the vehicles deliver goods to customers and pick some goods up at customer sites. In most articles dealing with the CVRPPD (see e.g. Toth and Vigo, 1997, 1999; Hernandez-Perez and Salazar-Gonzalez, 2004; Ropke and Pisinger, 2006) there is a distinction of the customers to delivery customers and pick-up customers. The delivery customers receive goods from the vehicles and the pick-up customers return goods to the vehicles. The goal is to find optimal routes for a fleet of vehicles to visit the pick-up and the drop-off locations. It can also be assumed (see e.g. Nagy and Salhi, 2005; Bianchessi and Righini, 2007; Gribkovskaia et al., 2007; Zachariadis et al., 2010) that all customers may simultaneously receive and give goods. For example, this situation arises when the vehicles deliver to stores a product (e.g. milk) that expires after a few days. In this case it is reasonable to assume that the vehicles simultaneously provide the customers with new (fresh) products and collect the old (expired) ones.

In the present paper we introduce a simple CVRPPD. In this problem it is assumed that a single vehicle starts its route from a depot and picks up from and delivers K different products to N customers according to a predefined customer sequence 1→2→⋯→
                     N. There is no distinction between delivery customers and pick-up customers since all customers may receive and may return products. The vehicle has a single compartment that may carry any quantity of product i
                     ∈{1,…,
                     K} provided that its total capacity is not exceeded. It is assumed that the items of different products are of the same size. For example, if K
                     =2 and the two products are wine and beer it is assumed that a bottle of wine has the same size as a bottle of beer. The total quantity of products that is collected by the vehicle from each customer and his demands for new products are discrete random variables with known joint probability distribution. The vehicle is allowed during its route to return to the depot to empty returned products and restock with new products. It seems reasonable that, when the vehicle returns to the depot for replenishment, it is not always preferable to load it to its full capacity, as there needs to be some space available in order to accommodate the returned products of the next customers. The total demand of each customer for all products is assumed to be less than or equal to the capacity of the vehicle. Furthermore, the total quantity of the items that each customer returns does not exceed the vehicle capacity. It is assumed that the travel costs among all points in the network (depot and customer sites) are known. The objective is to find the policy that minimizes the expected total cost for the service of all customers.


                     Minis and Tatarakis (2011) introduced the above problem with K
                     =1. They selected as decision epochs of the problem, the epochs at which the service of each customer has been completed and presented a dynamic programming formulation. They proved that, after the completion of the service of a customer, it is optimal for the vehicle to proceed to the next customer if its empty space exceeds a critical level that depends on the number of available items for delivery. This is a partial characterization of the optimal policy. Its proof is complicated and it seems impossible to be extended for K
                     >1. They also obtained numerical results and analyzed the performance of the algorithm. In the present paper we choose as decision epochs of the problem, the epochs at which the vehicle visits for the first time each customer and has satisfied as much of the customer’s demands for new products as possible and has picked up as much of the returned products as possible. Note that it is possible at these decision epochs to have demands for new products that have not been satisfied if the quantities carried by the vehicle are not sufficient. It is also possible at these decision epochs to have old products that have not been picked up by the vehicle due to the lack of space. However, this choice of decision epochs enables us, for any value of K
                     ⩾1, to present for all possible cases suitable dynamic programming equations that have elegant and usable forms. These equations permit us not only to find numerically the optimal policy but to prove that it has a threshold-type structure, that is intuitively reasonable. Specifically, the set of all possible states (i.e. remaining quantities of the products in the vehicle and empty space of the vehicle) after the first visit to each customer consists of four disjoint subsets. If the state belongs to the first subset then the optimal decision is to proceed to the next customer. If the state belongs to the second subset then the optimal decision is to go to the depot for loading and then go to the next customer. If it belongs to the third subset then the optimal decision is to go to the depot to unload any returned products, to restock the owed quantity of the products, to load additional items, to return to the customer to satisfy the owed demands and/or to pick up remaining old products and then proceed to the next customer. If it belongs to the fourth subset then the optimal decision is to make two trips to the depot before going to the next customer. This characterization of the optimal policy is complete and permits us to design a special-purpose efficient dynamic programming algorithm for its determination.

The problem that we described above can be considered as a generalization of the problem introduced by Yang et al. (2000) in which it is assumed that the vehicle delivers to the customers only one product, i.e. K
                     =1, and it does not pick up any old products. Yang et al. developed a dynamic programming approach and proved that for each customer j
                     ∈{1,…,
                     N
                     −1} there exists a critical number s
                     
                        j
                      such that the optimal decision, after servicing customer j, is to continue to customer j
                     +1 if the remaining quantity in the vehicle is greater than or equal to s
                     
                        j
                     , or to return to the depot for replenishment if it is less than s
                     
                        j
                     . Tsirimpas et al. (2008) studied the problem with pick-up and delivery with K
                     =1 when, for each customer, the quantity that is picked up and the demands for new products are not random variables but constant numbers. They also assumed that the vehicle visits each customer only once and they developed a suitable dynamic programming algorithm for the determination of the optimal policy. Note that Yang et al. (2000) and Tsirimpas et al. (2008) selected as decision epochs for the problems that they studied, the epochs at which the service of each customer has been completed. The problem of delivering K different products if the demands of the products are random variables was studied (i) by Tatarakis and Minis (2009) and Pandelis et al. (2012) when each product is stored in its dedicated compartment in the vehicle and (ii) by Tatarakis and Minis (2009) and Pandelis et al. (2013) when all products are stored together in the vehicle’s single compartment.

In the present paper, we also study the corresponding infinite time-horizon problem if the service of the customers does not stop when the last customer has given the returned items and has received the new products but it continues indefinitely with the same customer order. It is assumed that, when the vehicle completes a tour, the demands of each customer for new products and the quantity of returned products are renewed for the next tour and follow the same joint distribution. Using well-known results of Markov decision processes we prove that the discounted-cost optimal policy and the average-cost optimal policy have the same threshold-type structure as the optimal policy in the initial finite-horizon problem.

As mentioned by Minis and Tatarakis (2011), a practical application of the considered problem could be the so-called ex-van sales. In ex-van sales the driver of the vehicle acts as a salesman. He visits his customers (retail outlets, supermarkets, kiosks, stores, etc.) in an area typically according to a predefined sequence. The demands of each customer for new products (e.g. milk, bottles of beer or wine) and the quantity of returned products (e.g. expired milk, empty bottles of beer or wine) are not known in advance but they are revealed upon arrival at the customer’s site. If a customer’s demand for a new product exceeds the quantity that is loaded in the vehicle or if the quantity of returned products exceeds the empty space in the vehicle, the driver has to go to the depot to empty returned products and to restock with new ones. Another example could be the routing of a self propelled vehicle in a manufacturing shop that transfers discrete parts to workcenters in a predefined sequence (see Rembold et al., 1985). Note that in addition to the main pathway connecting the workcenters, there are spurs connecting each workcenter with the materials warehouse, allowing the return and the reloading of the vehicle. The required quantities for new discrete parts may be stochastic due to failures and they are revealed when the vehicle arrives at a workcenter. If the required quantities for new discrete parts exceed the quantities that are loaded in the vehicle or if the quantity of useless discrete parts exceeds the empty space in the vehicle, then the vehicle has to go to the materials warehouse to empty the useless discrete parts and to replenish with new ones.

The rest of the paper is organized as follows. In the next section we present the finite-horizon pick-up and delivery problem, we define the decision epochs and we present the dynamic programming equations for the determination of the optimal policy. It is proved that the optimal policy has a specific threshold-type structure. The infinite-horizon problem is presented and analyzed in Section 3. It is proved that the discounted-cost optimal policy and the average-cost optimal policy have the same structure as the finite-horizon optimal policy. Numerical results illustrate the theoretical results of Sections 2 and 3. The conclusions of the paper are given in the last section.

We consider a set of nodes V
                     ={0,1,…,
                     N} with node 0 denoting the depot and the nodes 1,…,
                     N corresponding to customers. The customers are serviced in the order 1,…,
                     N by a vehicle of capacity Q. The vehicle carries K different kinds of products to satisfy customers’ demands. The same vehicle is also used to store products that are returned by the customers. We assume that the items of all products are of the same size. The vehicle starts its route with a load of all products that is less than or equal to Q and after servicing all customers it returns to the depot. The demand of customer j, j
                     =1,2,…,
                     N, for product i, i
                     =1,2,…,
                     K, is a discrete random variable 
                        
                           
                              
                                 ξ
                              
                              
                                 i
                              
                              
                                 j
                              
                           
                        
                      and the total quantity of products returned by customer j is a discrete random variable ψ
                     
                        j
                     . The joint probability distribution of 
                        
                           
                              
                                 ξ
                              
                              
                                 i
                              
                              
                                 j
                              
                           
                           ,
                           i
                           =
                           1
                           ,
                           …
                           ,
                           K
                        
                      and ψ
                     
                        j
                      is assumed known. The actual demands for new products and the quantity of returned products of each customer become known upon the vehicle’s arrival at the customer’s site. We assume that the total demand for new products and the quantity of returned products of each customer cannot exceed the vehicle’s capacity, that is, 
                        
                           
                              
                                 max
                              
                              
                                 j
                                 =
                                 1
                                 ,
                                 2
                                 ,
                                 …
                                 ,
                                 N
                              
                           
                           
                              
                                 ∑
                              
                              
                                 i
                                 =
                                 1
                              
                              
                                 K
                              
                           
                           
                              
                                 ξ
                              
                              
                                 i
                              
                              
                                 j
                              
                           
                           ⩽
                           Q
                        
                      and max
                        j=1,2,…,N
                     
                     
                     ψ
                     
                        j
                     
                     ⩽
                     Q. When the vehicle visits customer j for the first time it satisfies as much demands as possible and picks up the largest possible quantity of returned products. If part of the demands is not satisfied and/or there is not enough space for all returned products, the vehicle goes to the depot, empties returned products, restocks, and returns to customer j. After satisfying the demand of the last customer and picking up all of his returned products, the vehicle returns to the depot. We denote by c
                     
                        j,j+1, j
                     =1,2,…,
                     N
                     −1, the travel cost between customers j and j
                     +1, and by c
                     
                        j0, j
                     =1,2,…,
                     N, the travel cost between customer j and the depot. These costs can be considered as the costs of the gasoline that the vehicle needs to cover the distances between customers or the distances between customers and the depot. We naturally assume that these distances satisfy the triangle inequality, i.e.
                        
                           
                              
                                 
                                    c
                                 
                                 
                                    j
                                    ,
                                    j
                                    +
                                    1
                                 
                              
                              ⩽
                              
                                 
                                    c
                                 
                                 
                                    j
                                    0
                                 
                              
                              +
                              
                                 
                                    c
                                 
                                 
                                    0
                                    ,
                                    j
                                    +
                                    1
                                 
                              
                              ,
                              
                              j
                              =
                              1
                              ,
                              …
                              ,
                              N
                              -
                              1
                              .
                           
                        
                     The road network is depicted in Fig. 1
                     .

Let z
                     
                        i
                     , i
                     =1,2,…,
                     K, be the load of product i carried by the vehicle after the first visit at a customer’s site, and r the empty space; negative values for z
                     
                        i
                      and r denote the unsatisfied demand for product i and lack of empty space for returned products. Let 
                        
                           z
                           =
                           
                              
                                 ∑
                              
                              
                                 i
                                 =
                                 1
                              
                              
                                 K
                              
                           
                           
                              
                                 z
                              
                              
                                 i
                              
                              
                                 -
                              
                           
                        
                     , with 
                        
                           
                              
                                 z
                              
                              
                                 i
                              
                              
                                 -
                              
                           
                           =
                           min
                           {
                           0
                           ,
                           
                              
                                 z
                              
                              
                                 i
                              
                           
                           }
                        
                     . When z
                     =0 and r
                     ⩾0 (demand for products and empty space fully satisfied), the vehicle either proceeds directly to the next customer or goes to the depot, empties any returned products, restocks with loads θ
                     
                        i
                     , i
                     =1,2,…,
                     K, of products 1,2,…,
                     K, where 
                        
                           
                              
                                 ∑
                              
                              
                                 i
                                 =
                                 1
                              
                              
                                 K
                              
                           
                           
                              
                                 θ
                              
                              
                                 i
                              
                           
                           ⩽
                           Q
                        
                     , and then visits the next customer. When z
                     <0 and/or r
                     <0, the vehicle goes to the depot, empties returned products, and restocks the owed quantity −z
                     −
                     =−min(0, z). Then it has the following choices: (i) it loads additional quantities θ
                     
                        i
                      of products 1,2,…,
                     K, so that at least −r
                     − empty space remains after delivering the owed quantity −z
                     −, that is, 
                        
                           
                              
                                 ∑
                              
                              
                                 i
                                 =
                                 1
                              
                              
                                 K
                              
                           
                           
                              
                                 θ
                              
                              
                                 i
                              
                           
                           ⩽
                           Q
                           +
                           min
                           (
                           
                              
                                 z
                              
                              
                                 -
                              
                           
                           ,
                           
                              
                                 r
                              
                              
                                 -
                              
                           
                           )
                        
                     , returns to the customer, satisfies demand and/or picks up remaining returned products, and then proceeds to the next customer and (ii) returns to the customer, satisfies demand and/or picks up remaining returned products, makes a second trip to the depot where it empties returned products, restocks with loads θ
                     
                        i
                      of products 1,2,…,
                     K, where 
                        
                           
                              
                                 ∑
                              
                              
                                 i
                                 =
                                 1
                              
                              
                                 K
                              
                           
                           
                              
                                 θ
                              
                              
                                 i
                              
                           
                           ⩽
                           Q
                        
                     , and proceeds to the next customer. Our objective is to determine a vehicle routing strategy that minimizes the expected total cost during a visit cycle.

We define vectors 
                           
                              
                                 
                                    z
                                 
                                 
                                    ¯
                                 
                              
                              =
                              [
                              
                                 
                                    z
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    z
                                 
                                 
                                    2
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    z
                                 
                                 
                                    K
                                 
                              
                              ]
                           
                        , 
                           
                              
                                 
                                    
                                       
                                          ξ
                                       
                                       
                                          ¯
                                       
                                    
                                 
                                 
                                    j
                                 
                              
                              =
                              
                                 
                                    
                                       
                                          
                                             ξ
                                          
                                          
                                             1
                                          
                                          
                                             j
                                          
                                       
                                       ,
                                       
                                          
                                             ξ
                                          
                                          
                                             2
                                          
                                          
                                             j
                                          
                                       
                                       ,
                                       …
                                       ,
                                       
                                          
                                             ξ
                                          
                                          
                                             K
                                          
                                          
                                             j
                                          
                                       
                                    
                                 
                              
                           
                        , 
                           
                              
                                 
                                    θ
                                 
                                 
                                    ¯
                                 
                              
                              =
                              [
                              
                                 
                                    θ
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    θ
                                 
                                 
                                    2
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    θ
                                 
                                 
                                    K
                                 
                              
                              ]
                           
                        , and denote by 
                           
                              
                                 
                                    f
                                 
                                 
                                    j
                                 
                              
                              (
                              
                                 
                                    z
                                 
                                 
                                    ¯
                                 
                              
                              ,
                              r
                              )
                           
                         the minimum expected cost when the load of product i carried by the vehicle after visiting customer j for the first time is equal to z
                        
                           i
                         and the empty space is equal to r. Then, an optimal routing strategy can be determined by the following dynamic programming equations (see e.g. Eq. (6.5) in Bather’s (2000) book). For j
                        =1,2,…,
                        N
                        −1 we have two cases.
                           
                              
                                 Case 1.
                              
                              If z
                                 1,
                                 z
                                 2,…,
                                 z
                                 
                                    K
                                 , r
                                 ⩾0, then
                                    
                                       (1)
                                       
                                          
                                             
                                                f
                                             
                                             
                                                j
                                             
                                          
                                          (
                                          
                                             
                                                z
                                             
                                             
                                                ¯
                                             
                                          
                                          ,
                                          r
                                          )
                                          =
                                          
                                             min
                                          
                                          {
                                          
                                             
                                                H
                                             
                                             
                                                j
                                             
                                          
                                          (
                                          
                                             
                                                z
                                             
                                             
                                                ¯
                                             
                                          
                                          ,
                                          r
                                          )
                                          ,
                                          
                                             
                                                A
                                             
                                             
                                                j
                                             
                                          
                                          }
                                          .
                                       
                                    
                                 
                              

If 
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                             =
                                             1
                                          
                                          
                                             K
                                          
                                       
                                       
                                          
                                             z
                                          
                                          
                                             i
                                          
                                          
                                             -
                                          
                                       
                                       +
                                       
                                          
                                             r
                                          
                                          
                                             -
                                          
                                       
                                       <
                                       0
                                    
                                 , then
                                    
                                       (2)
                                       
                                          
                                             
                                                f
                                             
                                             
                                                j
                                             
                                          
                                          (
                                          
                                             
                                                z
                                             
                                             
                                                ¯
                                             
                                          
                                          ,
                                          r
                                          )
                                          =
                                          2
                                          
                                             
                                                c
                                             
                                             
                                                j
                                                0
                                             
                                          
                                          +
                                          
                                             min
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               H
                                                            
                                                            
                                                               ∼
                                                            
                                                         
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     ∑
                                                                  
                                                                  
                                                                     i
                                                                     =
                                                                     1
                                                                  
                                                                  
                                                                     K
                                                                  
                                                               
                                                            
                                                            
                                                               
                                                                  z
                                                               
                                                               
                                                                  i
                                                               
                                                               
                                                                  -
                                                               
                                                            
                                                            ,
                                                            
                                                               
                                                                  r
                                                               
                                                               
                                                                  -
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         A
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                
                                             
                                          
                                          .
                                       
                                    
                                 
                              

For z
                        1,
                        z
                        2,…,
                        z
                        
                           K
                        , r
                        ⩾0 we have
                           
                              (3)
                              
                                 
                                    
                                       H
                                    
                                    
                                       j
                                    
                                 
                                 (
                                 
                                    
                                       z
                                    
                                    
                                       ¯
                                    
                                 
                                 ,
                                 r
                                 )
                                 =
                                 
                                    
                                       c
                                    
                                    
                                       j
                                       ,
                                       j
                                       +
                                       1
                                    
                                 
                                 +
                                 
                                    
                                       Ef
                                    
                                    
                                       j
                                       +
                                       1
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                z
                                             
                                             
                                                ¯
                                             
                                          
                                          -
                                          
                                             
                                                
                                                   
                                                      ξ
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                             
                                             
                                                j
                                                +
                                                1
                                             
                                          
                                          ,
                                          r
                                          +
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   i
                                                   =
                                                   1
                                                
                                                
                                                   K
                                                
                                             
                                          
                                          
                                             min
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         z
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         ξ
                                                      
                                                      
                                                         i
                                                      
                                                      
                                                         j
                                                         +
                                                         1
                                                      
                                                   
                                                
                                             
                                          
                                          -
                                          
                                             
                                                ψ
                                             
                                             
                                                j
                                                +
                                                1
                                             
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                        for z
                        −
                        +
                        r
                        −
                        <0 we have
                           
                              (4)
                              
                                 
                                    
                                       
                                          
                                             H
                                          
                                          
                                             ∼
                                          
                                       
                                    
                                    
                                       j
                                    
                                 
                                 (
                                 z
                                 ,
                                 r
                                 )
                                 =
                                 
                                    
                                       c
                                    
                                    
                                       j
                                       ,
                                       j
                                       +
                                       1
                                    
                                 
                                 +
                                 
                                    
                                       
                                          min
                                       
                                       
                                          
                                             
                                                θ
                                             
                                             
                                                ¯
                                             
                                          
                                          :
                                          
                                             
                                                ∑
                                             
                                             
                                                i
                                                =
                                                1
                                             
                                             
                                                K
                                             
                                          
                                          
                                             
                                                θ
                                             
                                             
                                                i
                                             
                                          
                                          ⩽
                                          Q
                                          +
                                          min
                                          (
                                          
                                             
                                                z
                                             
                                             
                                                -
                                             
                                          
                                          ,
                                          
                                             
                                                r
                                             
                                             
                                                -
                                             
                                          
                                          )
                                       
                                    
                                 
                                 
                                    
                                       Ef
                                    
                                    
                                       j
                                       +
                                       1
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                θ
                                             
                                             
                                                ¯
                                             
                                          
                                          -
                                          
                                             
                                                
                                                   
                                                      ξ
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                             
                                             
                                                j
                                                +
                                                1
                                             
                                          
                                          ,
                                          Q
                                          +
                                          
                                             
                                                r
                                             
                                             
                                                -
                                             
                                          
                                          -
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   i
                                                   =
                                                   1
                                                
                                                
                                                   K
                                                
                                             
                                          
                                          (
                                          
                                             
                                                θ
                                             
                                             
                                                i
                                             
                                          
                                          -
                                          
                                             min
                                          
                                          (
                                          
                                             
                                                θ
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          
                                             
                                                ξ
                                             
                                             
                                                i
                                             
                                             
                                                j
                                                +
                                                1
                                             
                                          
                                          )
                                          )
                                          -
                                          
                                             
                                                ψ
                                             
                                             
                                                j
                                                +
                                                1
                                             
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                        and
                           
                              (5)
                              
                                 
                                    
                                       A
                                    
                                    
                                       j
                                    
                                 
                                 =
                                 
                                    
                                       c
                                    
                                    
                                       j
                                       0
                                    
                                 
                                 +
                                 
                                    
                                       c
                                    
                                    
                                       j
                                       +
                                       1
                                       ,
                                       0
                                    
                                 
                                 +
                                 
                                    
                                       
                                          min
                                       
                                       
                                          
                                             
                                                θ
                                             
                                             
                                                ¯
                                             
                                          
                                          :
                                          
                                             
                                                ∑
                                             
                                             
                                                i
                                                =
                                                1
                                             
                                             
                                                K
                                             
                                          
                                          
                                             
                                                θ
                                             
                                             
                                                i
                                             
                                          
                                          ⩽
                                          Q
                                       
                                    
                                 
                                 
                                    
                                       Ef
                                    
                                    
                                       j
                                       +
                                       1
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                θ
                                             
                                             
                                                ¯
                                             
                                          
                                          -
                                          
                                             
                                                
                                                   
                                                      ξ
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                             
                                             
                                                j
                                                +
                                                1
                                             
                                          
                                          ,
                                          Q
                                          -
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   i
                                                   =
                                                   1
                                                
                                                
                                                   K
                                                
                                             
                                          
                                          (
                                          
                                             
                                                θ
                                             
                                             
                                                i
                                             
                                          
                                          -
                                          
                                             min
                                          
                                          (
                                          
                                             
                                                θ
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          
                                             
                                                ξ
                                             
                                             
                                                i
                                             
                                             
                                                j
                                                +
                                                1
                                             
                                          
                                          )
                                          )
                                          -
                                          
                                             
                                                ψ
                                             
                                             
                                                j
                                                +
                                                1
                                             
                                          
                                       
                                    
                                 
                                 .
                              
                           
                        In the boundary we have
                           
                              (6)
                              
                                 
                                    
                                       f
                                    
                                    
                                       N
                                    
                                 
                                 (
                                 
                                    
                                       z
                                    
                                    
                                       ¯
                                    
                                 
                                 ,
                                 r
                                 )
                                 =
                                 
                                    
                                       c
                                    
                                    
                                       N
                                       0
                                    
                                 
                                 +
                                 2
                                 
                                    
                                       c
                                    
                                    
                                       N
                                       0
                                    
                                 
                                 1
                                 
                                    
                                       
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   i
                                                   =
                                                   1
                                                
                                                
                                                   K
                                                
                                             
                                          
                                          
                                             
                                                z
                                             
                                             
                                                i
                                             
                                             
                                                -
                                             
                                          
                                          +
                                          
                                             
                                                r
                                             
                                             
                                                -
                                             
                                          
                                          <
                                          0
                                       
                                    
                                 
                                 .
                              
                           
                        Finally, the minimum total expected cost is
                           
                              (7)
                              
                                 
                                    
                                       f
                                    
                                    
                                       0
                                    
                                 
                                 =
                                 
                                    
                                       c
                                    
                                    
                                       10
                                    
                                 
                                 +
                                 
                                    
                                       
                                          min
                                       
                                       
                                          
                                             
                                                θ
                                             
                                             
                                                ¯
                                             
                                          
                                          :
                                          
                                             
                                                ∑
                                             
                                             
                                                i
                                                =
                                                1
                                             
                                             
                                                K
                                             
                                          
                                          
                                             
                                                θ
                                             
                                             
                                                i
                                             
                                          
                                          ⩽
                                          Q
                                       
                                    
                                 
                                 
                                    
                                       Ef
                                    
                                    
                                       1
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                θ
                                             
                                             
                                                ¯
                                             
                                          
                                          -
                                          
                                             
                                                
                                                   
                                                      ξ
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                             
                                             
                                                1
                                             
                                          
                                          ,
                                          Q
                                          -
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   i
                                                   =
                                                   1
                                                
                                                
                                                   K
                                                
                                             
                                          
                                          (
                                          
                                             
                                                θ
                                             
                                             
                                                i
                                             
                                          
                                          -
                                          
                                             min
                                          
                                          (
                                          
                                             
                                                θ
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          
                                             
                                                ξ
                                             
                                             
                                                i
                                             
                                             
                                                1
                                             
                                          
                                          )
                                          )
                                          -
                                          
                                             
                                                ψ
                                             
                                             
                                                1
                                             
                                          
                                       
                                    
                                 
                                 .
                              
                           
                        In (3), (4), (5), (7) the expected values are taken with respect to the random vectors 
                           
                              
                                 
                                    
                                       
                                          ξ
                                       
                                       
                                          ¯
                                       
                                    
                                 
                                 
                                    j
                                 
                              
                              ,
                              
                              j
                              =
                              1
                              ,
                              …
                              ,
                              N
                           
                        , and to the random variables ψ
                        
                           j
                        ,
                        j
                        =1,…,
                        N. The first term in the curly brackets in (1) corresponds to the action of proceeding to the next customer and the second term corresponds to the action of going to the depot for restocking before proceeding to the next customer. The first term in the curly brackets in (2) corresponds to the action of returning to the depot once for restocking before proceeding to the next customer and the second term corresponds to the action of returning to the depot twice for restocking before proceeding to the next customer.

In the following lemma we prove monotonicity properties needed for the characterization of the structure of the optimal routing strategy.
                           Lemma 1
                           
                              
                                 
                                    
                                       
                                          H
                                       
                                       
                                          j
                                       
                                    
                                    (
                                    
                                       
                                          z
                                       
                                       
                                          ¯
                                       
                                    
                                    ,
                                    r
                                    )
                                 
                               and 
                                 
                                    
                                       
                                          
                                             
                                                H
                                             
                                             
                                                ∼
                                             
                                          
                                       
                                       
                                          j
                                       
                                    
                                    (
                                    z
                                    ,
                                    r
                                    )
                                 
                               
                              are non-increasing in each of their arguments.
                           

To prove the lemma, we will need to show that 
                                 
                                    
                                       
                                          f
                                       
                                       
                                          j
                                       
                                    
                                    (
                                    
                                       
                                          z
                                       
                                       
                                          ¯
                                       
                                    
                                    ,
                                    r
                                    )
                                 
                               is also non-increasing in its arguments. The proof is by induction on j. First, the induction base is established by 
                                 
                                    
                                       
                                          f
                                       
                                       
                                          N
                                       
                                    
                                    (
                                    
                                       
                                          z
                                       
                                       
                                          ¯
                                       
                                    
                                    ,
                                    r
                                    )
                                 
                               being non-increasing (Eq. (6)). Then, assuming that 
                                 
                                    
                                       
                                          f
                                       
                                       
                                          j
                                          +
                                          1
                                       
                                    
                                    (
                                    
                                       
                                          z
                                       
                                       
                                          ¯
                                       
                                    
                                    ,
                                    r
                                    )
                                 
                               is non-increasing, we will show that 
                                 
                                    
                                       
                                          H
                                       
                                       
                                          j
                                       
                                    
                                    (
                                    
                                       
                                          z
                                       
                                       
                                          ¯
                                       
                                    
                                    ,
                                    r
                                    )
                                    ,
                                    
                                       
                                          
                                             
                                                H
                                             
                                             
                                                ∼
                                             
                                          
                                       
                                       
                                          j
                                       
                                    
                                    (
                                    z
                                    ,
                                    r
                                    )
                                 
                              , and 
                                 
                                    
                                       
                                          f
                                       
                                       
                                          j
                                       
                                    
                                    (
                                    
                                       
                                          z
                                       
                                       
                                          ¯
                                       
                                    
                                    ,
                                    r
                                    )
                                 
                               are non-increasing.

Function 
                                 
                                    
                                       
                                          H
                                       
                                       
                                          j
                                       
                                    
                                    (
                                    
                                       
                                          z
                                       
                                       
                                          ¯
                                       
                                    
                                    ,
                                    r
                                    )
                                 
                               is non-increasing by the induction hypothesis and Eq. (3). To show that function 
                                 
                                    
                                       
                                          
                                             
                                                H
                                             
                                             
                                                ∼
                                             
                                          
                                       
                                       
                                          j
                                       
                                    
                                    (
                                    z
                                    ,
                                    r
                                    )
                                 
                               is non-increasing, consider z′⩽
                              z and r′⩽
                              r. Then we get from Eq. (4)
                              
                                 
                                    (8)
                                    
                                       
                                          
                                             
                                                
                                                   H
                                                
                                                
                                                   ∼
                                                
                                             
                                          
                                          
                                             j
                                          
                                       
                                       (
                                       z
                                       ,
                                       r
                                       )
                                       -
                                       
                                          
                                             
                                                
                                                   H
                                                
                                                
                                                   ∼
                                                
                                             
                                          
                                          
                                             j
                                          
                                       
                                       (
                                       
                                          
                                             z
                                          
                                          
                                             ′
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             ′
                                          
                                       
                                       )
                                       =
                                       
                                          
                                             
                                                min
                                             
                                             
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                                :
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   
                                                      K
                                                   
                                                
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ⩽
                                                Q
                                                +
                                                min
                                                (
                                                
                                                   
                                                      z
                                                   
                                                   
                                                      -
                                                   
                                                
                                                ,
                                                
                                                   
                                                      r
                                                   
                                                   
                                                      -
                                                   
                                                
                                                )
                                             
                                          
                                       
                                       
                                          
                                             Ef
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                                -
                                                
                                                   
                                                      
                                                         
                                                            ξ
                                                         
                                                         
                                                            ¯
                                                         
                                                      
                                                   
                                                   
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                ,
                                                Q
                                                +
                                                
                                                   
                                                      r
                                                   
                                                   
                                                      -
                                                   
                                                
                                                -
                                                
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         i
                                                         =
                                                         1
                                                      
                                                      
                                                         K
                                                      
                                                   
                                                
                                                (
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      i
                                                   
                                                
                                                -
                                                
                                                   min
                                                
                                                (
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ,
                                                
                                                   
                                                      ξ
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                )
                                                )
                                                -
                                                
                                                   
                                                      ψ
                                                   
                                                   
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                             
                                          
                                       
                                       -
                                       
                                          
                                             
                                                min
                                             
                                             
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                                :
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   
                                                      K
                                                   
                                                
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ⩽
                                                Q
                                                +
                                                min
                                                (
                                                
                                                   
                                                      z
                                                   
                                                   
                                                      ′
                                                      -
                                                   
                                                
                                                ,
                                                
                                                   
                                                      r
                                                   
                                                   
                                                      ′
                                                      -
                                                   
                                                
                                                )
                                             
                                          
                                       
                                       
                                          
                                             Ef
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                                -
                                                
                                                   
                                                      
                                                         
                                                            ξ
                                                         
                                                         
                                                            ¯
                                                         
                                                      
                                                   
                                                   
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                ,
                                                Q
                                                +
                                                
                                                   
                                                      r
                                                   
                                                   
                                                      ′
                                                      -
                                                   
                                                
                                                -
                                                
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         i
                                                         =
                                                         1
                                                      
                                                      
                                                         K
                                                      
                                                   
                                                
                                                (
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      i
                                                   
                                                
                                                -
                                                
                                                   min
                                                
                                                (
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ,
                                                
                                                   
                                                      ξ
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                )
                                                )
                                                -
                                                
                                                   
                                                      ψ
                                                   
                                                   
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                             
                                          
                                       
                                       ⩽
                                       
                                          
                                             
                                                min
                                             
                                             
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                                :
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   
                                                      K
                                                   
                                                
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ⩽
                                                Q
                                                +
                                                min
                                                (
                                                
                                                   
                                                      z
                                                   
                                                   
                                                      ′
                                                      -
                                                   
                                                
                                                ,
                                                
                                                   
                                                      r
                                                   
                                                   
                                                      ′
                                                      -
                                                   
                                                
                                                )
                                             
                                          
                                       
                                       
                                          
                                             Ef
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                                -
                                                
                                                   
                                                      
                                                         
                                                            ξ
                                                         
                                                         
                                                            ¯
                                                         
                                                      
                                                   
                                                   
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                ,
                                                Q
                                                +
                                                
                                                   
                                                      r
                                                   
                                                   
                                                      -
                                                   
                                                
                                                -
                                                
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         i
                                                         =
                                                         1
                                                      
                                                      
                                                         K
                                                      
                                                   
                                                
                                                (
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      i
                                                   
                                                
                                                -
                                                
                                                   min
                                                
                                                (
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ,
                                                
                                                   
                                                      ξ
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                )
                                                )
                                                -
                                                
                                                   
                                                      ψ
                                                   
                                                   
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                             
                                          
                                       
                                       -
                                       
                                          
                                             
                                                min
                                             
                                             
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                                :
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   
                                                      K
                                                   
                                                
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ⩽
                                                Q
                                                +
                                                min
                                                (
                                                
                                                   
                                                      z
                                                   
                                                   
                                                      ′
                                                      -
                                                   
                                                
                                                ,
                                                
                                                   
                                                      r
                                                   
                                                   
                                                      ′
                                                      -
                                                   
                                                
                                                )
                                             
                                          
                                       
                                       
                                          
                                             Ef
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                                -
                                                
                                                   
                                                      
                                                         
                                                            ξ
                                                         
                                                         
                                                            ¯
                                                         
                                                      
                                                   
                                                   
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                ,
                                                Q
                                                +
                                                
                                                   
                                                      r
                                                   
                                                   
                                                      ′
                                                      -
                                                   
                                                
                                                -
                                                
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         i
                                                         =
                                                         1
                                                      
                                                      
                                                         K
                                                      
                                                   
                                                
                                                (
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      i
                                                   
                                                
                                                -
                                                
                                                   min
                                                
                                                (
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ,
                                                
                                                   
                                                      ξ
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                )
                                                )
                                                -
                                                
                                                   
                                                      ψ
                                                   
                                                   
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                             
                                          
                                       
                                       ⩽
                                       0
                                       ,
                                    
                                 
                              where the last inequality follows from the induction hypothesis.

It remains to show that 
                                 
                                    
                                       
                                          f
                                       
                                       
                                          j
                                       
                                    
                                    (
                                    
                                       
                                          z
                                       
                                       
                                          ¯
                                       
                                    
                                    ,
                                    r
                                    )
                                 
                               is non-increasing. First, we prove the monotonicity property with respect to z
                              
                                 i
                              , i
                              =1,2,…,
                              K. Because of symmetry it suffices to show the result with respect to one of the arguments, say z
                              
                                 K
                              . For 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          1
                                       
                                       
                                          K
                                          -
                                          1
                                       
                                    
                                    
                                       
                                          z
                                       
                                       
                                          i
                                       
                                       
                                          -
                                       
                                    
                                    +
                                    
                                       
                                          r
                                       
                                       
                                          -
                                       
                                    
                                    <
                                    0
                                 
                               the result follows directly from the monotonicity of 
                                 
                                    
                                       
                                          
                                             
                                                H
                                             
                                             
                                                ∼
                                             
                                          
                                       
                                       
                                          j
                                       
                                    
                                    (
                                    z
                                    )
                                 
                               and Eq. (2). Consider now z
                              1,
                              z
                              2,…,
                              z
                              
                                 K−1, r
                              ⩾0, and let 
                                 
                                    
                                       
                                          
                                             
                                                z
                                             
                                             
                                                ¯
                                             
                                          
                                       
                                       
                                          (
                                          K
                                          -
                                          1
                                          )
                                       
                                    
                                 
                               be the vector consisting of the first K
                              −1 elements of 
                                 
                                    
                                       
                                          z
                                       
                                       
                                          ¯
                                       
                                    
                                 
                              . For 
                                 
                                    0
                                    ⩽
                                    
                                       
                                          z
                                       
                                       
                                          K
                                       
                                       
                                          ′
                                       
                                    
                                    <
                                    
                                       
                                          z
                                       
                                       
                                          K
                                       
                                    
                                 
                               and 
                                 
                                    
                                       
                                          z
                                       
                                       
                                          K
                                       
                                       
                                          ′
                                       
                                    
                                    <
                                    
                                       
                                          z
                                       
                                       
                                          K
                                       
                                    
                                    <
                                    0
                                 
                               we get 
                                 
                                    
                                       
                                          f
                                       
                                       
                                          j
                                       
                                    
                                    (
                                    
                                       
                                          
                                             
                                                z
                                             
                                             
                                                ¯
                                             
                                          
                                       
                                       
                                          (
                                          K
                                          -
                                          1
                                          )
                                       
                                    
                                    ,
                                    
                                       
                                          z
                                       
                                       
                                          K
                                       
                                    
                                    ,
                                    r
                                    )
                                    ⩽
                                    
                                       
                                          f
                                       
                                       
                                          j
                                       
                                    
                                    (
                                    
                                       
                                          
                                             
                                                z
                                             
                                             
                                                ¯
                                             
                                          
                                       
                                       
                                          (
                                          K
                                          -
                                          1
                                          )
                                       
                                    
                                    ,
                                    
                                       
                                          z
                                       
                                       
                                          K
                                       
                                       
                                          ′
                                       
                                    
                                    ,
                                    r
                                    )
                                 
                               by the monotonicity of 
                                 
                                    
                                       
                                          H
                                       
                                       
                                          j
                                       
                                    
                                    (
                                    
                                       
                                          z
                                       
                                       
                                          ¯
                                       
                                    
                                    )
                                 
                               and 
                                 
                                    
                                       
                                          
                                             
                                                H
                                             
                                             
                                                ∼
                                             
                                          
                                       
                                       
                                          j
                                       
                                    
                                    (
                                    z
                                    )
                                 
                               respectively (Eqs (1) and (2)). To complete the proof we still need to show that 
                                 
                                    
                                       
                                          f
                                       
                                       
                                          j
                                       
                                    
                                    (
                                    
                                       
                                          
                                             
                                                z
                                             
                                             
                                                ¯
                                             
                                          
                                       
                                       
                                          (
                                          K
                                          -
                                          1
                                          )
                                       
                                    
                                    ,
                                    0
                                    ,
                                    r
                                    )
                                    ⩽
                                    
                                       
                                          f
                                       
                                       
                                          j
                                       
                                    
                                    (
                                    
                                       
                                          
                                             
                                                z
                                             
                                             
                                                ¯
                                             
                                          
                                       
                                       
                                          (
                                          K
                                          -
                                          1
                                          )
                                       
                                    
                                    ,
                                    -
                                    1
                                    ,
                                    r
                                    )
                                 
                              . From Eq. (1) and the triangle inequality we get
                                 
                                    (9)
                                    
                                       
                                          
                                             f
                                          
                                          
                                             j
                                          
                                       
                                       (
                                       
                                          
                                             
                                                
                                                   z
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                          
                                             (
                                             K
                                             -
                                             1
                                             )
                                          
                                       
                                       ,
                                       0
                                       ,
                                       r
                                       )
                                       ⩽
                                       
                                          
                                             A
                                          
                                          
                                             j
                                          
                                       
                                       =
                                       
                                          
                                             c
                                          
                                          
                                             j
                                             0
                                          
                                       
                                       +
                                       
                                          
                                             c
                                          
                                          
                                             j
                                             +
                                             1
                                             ,
                                             0
                                          
                                       
                                       +
                                       
                                          
                                             
                                                min
                                             
                                             
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                                :
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   
                                                      K
                                                   
                                                
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ⩽
                                                Q
                                             
                                          
                                       
                                       
                                          
                                             Ef
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                                -
                                                
                                                   
                                                      
                                                         
                                                            ξ
                                                         
                                                         
                                                            ¯
                                                         
                                                      
                                                   
                                                   
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                ,
                                                Q
                                                -
                                                
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         i
                                                         =
                                                         1
                                                      
                                                      
                                                         K
                                                      
                                                   
                                                
                                                (
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      i
                                                   
                                                
                                                -
                                                
                                                   min
                                                
                                                (
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ,
                                                
                                                   
                                                      ξ
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                )
                                                )
                                                -
                                                
                                                   
                                                      ψ
                                                   
                                                   
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                             
                                          
                                       
                                       ⩽
                                       2
                                       
                                          
                                             c
                                          
                                          
                                             j
                                             0
                                          
                                       
                                       +
                                       
                                          
                                             c
                                          
                                          
                                             j
                                             ,
                                             j
                                             +
                                             1
                                          
                                       
                                       +
                                       
                                          
                                             
                                                min
                                             
                                             
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                                :
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   
                                                      K
                                                   
                                                
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ⩽
                                                Q
                                             
                                          
                                       
                                       
                                          
                                             Ef
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                                -
                                                
                                                   
                                                      
                                                         
                                                            ξ
                                                         
                                                         
                                                            ¯
                                                         
                                                      
                                                   
                                                   
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                ,
                                                Q
                                                -
                                                
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         i
                                                         =
                                                         1
                                                      
                                                      
                                                         K
                                                      
                                                   
                                                
                                                (
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      i
                                                   
                                                
                                                -
                                                
                                                   min
                                                
                                                (
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ,
                                                
                                                   
                                                      ξ
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                )
                                                )
                                                -
                                                
                                                   
                                                      ψ
                                                   
                                                   
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                             
                                          
                                       
                                       =
                                       
                                          
                                             B
                                          
                                          
                                             j
                                          
                                       
                                       .
                                    
                                 
                              From Eqs. (4) and (9) we get
                                 
                                    (10)
                                    
                                       
                                          
                                             B
                                          
                                          
                                             j
                                          
                                       
                                       -
                                       2
                                       
                                          
                                             c
                                          
                                          
                                             j
                                             0
                                          
                                       
                                       -
                                       
                                          
                                             
                                                
                                                   H
                                                
                                                
                                                   ∼
                                                
                                             
                                          
                                          
                                             j
                                          
                                       
                                       (
                                       -
                                       1
                                       ,
                                       r
                                       )
                                       =
                                       
                                          
                                             
                                                min
                                             
                                             
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                                :
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   
                                                      K
                                                   
                                                
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ⩽
                                                Q
                                             
                                          
                                       
                                       
                                          
                                             Ef
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                                -
                                                
                                                   
                                                      
                                                         
                                                            ξ
                                                         
                                                         
                                                            ¯
                                                         
                                                      
                                                   
                                                   
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                ,
                                                Q
                                                -
                                                
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         i
                                                         =
                                                         1
                                                      
                                                      
                                                         K
                                                      
                                                   
                                                
                                                (
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      i
                                                   
                                                
                                                -
                                                
                                                   min
                                                
                                                (
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ,
                                                
                                                   
                                                      ξ
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                )
                                                )
                                                -
                                                
                                                   
                                                      ψ
                                                   
                                                   
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                             
                                          
                                       
                                       -
                                       
                                          
                                             
                                                min
                                             
                                             
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                                :
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   
                                                      K
                                                   
                                                
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ⩽
                                                Q
                                                -
                                                1
                                             
                                          
                                       
                                       
                                          
                                             Ef
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                                -
                                                
                                                   
                                                      
                                                         
                                                            ξ
                                                         
                                                         
                                                            ¯
                                                         
                                                      
                                                   
                                                   
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                ,
                                                Q
                                                -
                                                
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         i
                                                         =
                                                         1
                                                      
                                                      
                                                         K
                                                      
                                                   
                                                
                                                (
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      i
                                                   
                                                
                                                -
                                                
                                                   min
                                                
                                                (
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ,
                                                
                                                   
                                                      ξ
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                )
                                                )
                                                -
                                                
                                                   
                                                      ψ
                                                   
                                                   
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                             
                                          
                                       
                                       ⩽
                                       0
                                       .
                                    
                                 
                              From Eq. (2) we have
                                 
                                    
                                       
                                          
                                             f
                                          
                                          
                                             j
                                          
                                       
                                       (
                                       
                                          
                                             
                                                
                                                   z
                                                
                                                
                                                   ¯
                                                
                                             
                                          
                                          
                                             (
                                             K
                                             -
                                             1
                                             )
                                          
                                       
                                       ,
                                       -
                                       1
                                       ,
                                       r
                                       )
                                       =
                                       2
                                       
                                          
                                             c
                                          
                                          
                                             j
                                             0
                                          
                                       
                                       +
                                       
                                          min
                                       
                                       {
                                       
                                          
                                             
                                                
                                                   H
                                                
                                                
                                                   ∼
                                                
                                             
                                          
                                          
                                             j
                                          
                                       
                                       (
                                       -
                                       1
                                       ,
                                       r
                                       )
                                       ,
                                       
                                          
                                             A
                                          
                                          
                                             j
                                          
                                       
                                       }
                                       ,
                                    
                                 
                              which combined with Eqs. (9) and (10) yields 
                                 
                                    
                                       
                                          f
                                       
                                       
                                          j
                                       
                                    
                                    (
                                    
                                       
                                          
                                             
                                                z
                                             
                                             
                                                ¯
                                             
                                          
                                       
                                       
                                          (
                                          K
                                          -
                                          1
                                          )
                                       
                                    
                                    ,
                                    0
                                    ,
                                    r
                                    )
                                    ⩽
                                    
                                       
                                          f
                                       
                                       
                                          j
                                       
                                    
                                    (
                                    
                                       
                                          
                                             
                                                z
                                             
                                             
                                                ¯
                                             
                                          
                                       
                                       
                                          (
                                          K
                                          -
                                          1
                                          )
                                       
                                    
                                    ,
                                    -
                                    1
                                    ,
                                    r
                                    )
                                 
                              . The monotonicity property with respect to r is proved similarly. The induction hypothesis is used directly throughout the state space except in the proof of 
                                 
                                    
                                       
                                          f
                                       
                                       
                                          j
                                       
                                    
                                    (
                                    
                                       
                                          z
                                       
                                       
                                          ¯
                                       
                                    
                                    ,
                                    0
                                    )
                                    ⩽
                                    
                                       
                                          f
                                       
                                       
                                          j
                                       
                                    
                                    (
                                    
                                       
                                          z
                                       
                                       
                                          ¯
                                       
                                    
                                    ,
                                    -
                                    1
                                    )
                                 
                              , where 
                                 
                                    
                                       
                                          z
                                       
                                       
                                          ¯
                                       
                                    
                                 
                               is such that 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          1
                                       
                                       
                                          K
                                       
                                    
                                    
                                       
                                          z
                                       
                                       
                                          i
                                       
                                       
                                          -
                                       
                                    
                                    =
                                    0
                                 
                              . This proof is carried out by the use of equations analogous to (9) (with 
                                 
                                    
                                       
                                          f
                                       
                                       
                                          j
                                       
                                    
                                    (
                                    
                                       
                                          z
                                       
                                       
                                          ¯
                                       
                                    
                                    ,
                                    0
                                    )
                                 
                               instead of 
                                 
                                    
                                       
                                          f
                                       
                                       
                                          j
                                       
                                    
                                    (
                                    
                                       
                                          
                                             
                                                z
                                             
                                             
                                                ¯
                                             
                                          
                                       
                                       
                                          (
                                          K
                                          -
                                          1
                                          )
                                       
                                    
                                    ,
                                    0
                                    ,
                                    r
                                    )
                                    )
                                 
                               and (10), which takes the form
                                 
                                    
                                       
                                          
                                             B
                                          
                                          
                                             j
                                          
                                       
                                       -
                                       2
                                       
                                          
                                             c
                                          
                                          
                                             j
                                             0
                                          
                                       
                                       -
                                       
                                          
                                             
                                                
                                                   H
                                                
                                                
                                                   ∼
                                                
                                             
                                          
                                          
                                             j
                                          
                                       
                                       (
                                       0
                                       ,
                                       -
                                       1
                                       )
                                       =
                                       
                                          
                                             
                                                min
                                             
                                             
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                                :
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   
                                                      K
                                                   
                                                
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ⩽
                                                Q
                                             
                                          
                                       
                                       
                                          
                                             Ef
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                                -
                                                
                                                   
                                                      
                                                         
                                                            ξ
                                                         
                                                         
                                                            ¯
                                                         
                                                      
                                                   
                                                   
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                ,
                                                Q
                                                -
                                                
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         i
                                                         =
                                                         1
                                                      
                                                      
                                                         K
                                                      
                                                   
                                                
                                                (
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      i
                                                   
                                                
                                                -
                                                
                                                   min
                                                
                                                (
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ,
                                                
                                                   
                                                      ξ
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                )
                                                )
                                                -
                                                
                                                   
                                                      ψ
                                                   
                                                   
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                             
                                          
                                       
                                       -
                                       
                                          
                                             
                                                min
                                             
                                             
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                                :
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      i
                                                      =
                                                      1
                                                   
                                                   
                                                      K
                                                   
                                                
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ⩽
                                                Q
                                                -
                                                1
                                             
                                          
                                       
                                       
                                          
                                             Ef
                                          
                                          
                                             j
                                             +
                                             1
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                                -
                                                
                                                   
                                                      
                                                         
                                                            ξ
                                                         
                                                         
                                                            ¯
                                                         
                                                      
                                                   
                                                   
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                ,
                                                Q
                                                -
                                                1
                                                -
                                                
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         i
                                                         =
                                                         1
                                                      
                                                      
                                                         K
                                                      
                                                   
                                                
                                                (
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      i
                                                   
                                                
                                                -
                                                
                                                   min
                                                
                                                (
                                                
                                                   
                                                      θ
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ,
                                                
                                                   
                                                      ξ
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                                )
                                                )
                                                -
                                                
                                                   
                                                      ψ
                                                   
                                                   
                                                      j
                                                      +
                                                      1
                                                   
                                                
                                             
                                          
                                       
                                       ⩽
                                       0
                                       ,
                                    
                                 
                              and is proved similarly to Eq. (8).□

The following theorem characterizes the optimal vehicle routing strategy after it visits customer j
                        ∈{1,…,
                        N
                        −1} for the first time.
                           Theorem 1
                           
                              
                                 
                                    (i)
                                    
                                       For each z
                                       
                                          1
                                       
                                       ,
                                       
                                       z
                                       
                                          2
                                       
                                       ,
                                       …
                                       ,
                                       
                                       z
                                       
                                          K
                                       
                                       ⩾
                                       0 there exists integer s
                                       
                                          1j
                                       
                                       (z
                                       
                                          1
                                       
                                       ,
                                       
                                       z
                                       
                                          2
                                       
                                       ,
                                       …
                                       ,
                                       
                                       z
                                       
                                          K
                                       
                                       )
                                       ⩾
                                       0 such that it is optimal for the vehicle to proceed to customer j
                                       
                                       +
                                       
                                       1 if and only if r
                                       ⩾
                                       s
                                       
                                          1j
                                        
                                       (z
                                       
                                          1
                                       
                                       ,
                                       
                                       z
                                       
                                          2
                                       
                                       ,
                                       …
                                       ,
                                       
                                       z
                                       
                                          K
                                       
                                       ). Moreover, s
                                       
                                          1j
                                       
                                       (z
                                       
                                          1
                                       
                                       ,
                                       
                                       z
                                       
                                          2,
                                       
                                       …
                                       ,
                                       
                                       z
                                       
                                          K
                                       
                                       ) is non-increasing in each of its arguments.
                                    


                                       There exists r
                                       
                                          j
                                       
                                       ⩽
                                       0 such that it is optimal for the vehicle to make two trips to the depot when z
                                       
                                          1
                                       
                                       ,
                                       
                                       z
                                       
                                          2
                                       
                                       ,
                                       …
                                       ,
                                       
                                       z
                                       
                                          K
                                       
                                       ⩾
                                       0 and r
                                       <
                                       r
                                       
                                          j
                                       
                                       .
                                    


                                       There exists q
                                       
                                          j
                                       
                                       ⩽
                                       0 such that it is optimal for the vehicle to make two trips to the depot when r
                                       ⩾
                                       0 and 
                                       
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   i
                                                   =
                                                   1
                                                
                                                
                                                   K
                                                
                                             
                                             
                                                
                                                   z
                                                
                                                
                                                   i
                                                
                                                
                                                   -
                                                
                                             
                                             <
                                             
                                                
                                                   q
                                                
                                                
                                                   j
                                                
                                             
                                          
                                       
                                       .
                                    


                                       For each r
                                       <
                                       0 there exists integer s
                                       
                                          2j
                                       
                                       (r)
                                       <
                                       0 such that it is optimal for the vehicle to make two trips to the depot if and only if 
                                       
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   i
                                                   =
                                                   1
                                                
                                                
                                                   K
                                                
                                             
                                             
                                                
                                                   z
                                                
                                                
                                                   i
                                                
                                                
                                                   -
                                                
                                             
                                             ⩽
                                             
                                                
                                                   s
                                                
                                                
                                                   2
                                                   j
                                                
                                             
                                             (
                                             r
                                             )
                                          
                                       
                                       . Moreover, s
                                       
                                          2j
                                        
                                       (r) is non-increasing.
                                    

The existence of threshold s
                              1j
                              (z
                              1,
                              z
                              2,…,
                              z
                              
                                 K
                              ) is a consequence of 
                                 
                                    
                                       
                                          H
                                       
                                       
                                          j
                                       
                                    
                                    (
                                    
                                       
                                          z
                                       
                                       
                                          ¯
                                       
                                    
                                    ,
                                    r
                                    )
                                 
                               being non-increasing in its arguments. To see why this threshold function is non-increasing in its arguments, assume that 
                                 
                                    
                                       
                                          z
                                       
                                       
                                          K
                                       
                                       
                                          ′
                                       
                                    
                                    <
                                    
                                       
                                          z
                                       
                                       
                                          K
                                       
                                    
                                 
                               and 
                                 
                                    
                                       
                                          s
                                       
                                       
                                          1
                                          j
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   z
                                                
                                                
                                                   1
                                                
                                             
                                             ,
                                             
                                                
                                                   z
                                                
                                                
                                                   2
                                                
                                             
                                             ,
                                             …
                                             ,
                                             
                                                
                                                   z
                                                
                                                
                                                   K
                                                
                                                
                                                   ′
                                                
                                             
                                          
                                       
                                    
                                    <
                                    
                                       
                                          s
                                       
                                       
                                          1
                                          j
                                       
                                    
                                    (
                                    
                                       
                                          z
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    
                                       
                                          z
                                       
                                       
                                          2
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       
                                          z
                                       
                                       
                                          K
                                       
                                    
                                    )
                                 
                              . By the definition of the threshold function, for 
                                 
                                    
                                       
                                          z
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    
                                       
                                          z
                                       
                                       
                                          2
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       
                                          z
                                       
                                       
                                          K
                                       
                                       
                                          ′
                                       
                                    
                                 
                               and 
                                 
                                    r
                                    =
                                    
                                       
                                          s
                                       
                                       
                                          1
                                          j
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   z
                                                
                                                
                                                   1
                                                
                                             
                                             ,
                                             
                                                
                                                   z
                                                
                                                
                                                   2
                                                
                                             
                                             ,
                                             …
                                             ,
                                             
                                                
                                                   z
                                                
                                                
                                                   K
                                                
                                                
                                                   ′
                                                
                                             
                                          
                                       
                                    
                                 
                               it is optimal for the vehicle to proceed to the next customer. Because 
                                 
                                    
                                       
                                          H
                                       
                                       
                                          j
                                       
                                    
                                    (
                                    
                                       
                                          z
                                       
                                       
                                          ¯
                                       
                                    
                                    ,
                                    r
                                    )
                                 
                               is non-increasing, for z
                              1,
                              z
                              2,…,
                              z
                              
                                 K
                               and 
                                 
                                    r
                                    =
                                    
                                       
                                          s
                                       
                                       
                                          1
                                          j
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   z
                                                
                                                
                                                   1
                                                
                                             
                                             ,
                                             
                                                
                                                   z
                                                
                                                
                                                   2
                                                
                                             
                                             ,
                                             …
                                             ,
                                             
                                                
                                                   z
                                                
                                                
                                                   K
                                                
                                                
                                                   ′
                                                
                                             
                                          
                                       
                                    
                                 
                               it should still be optimal for the vehicle to proceed to the next customer. However, this is a contradiction because the specific value of r is below the threshold s
                              1j
                              (z
                              1,
                              z
                              2,…,
                              z
                              
                                 K
                              ).

Parts (ii)–(iv) follow from 
                                 
                                    
                                       
                                          
                                             
                                                H
                                             
                                             
                                                ∼
                                             
                                          
                                       
                                       
                                          j
                                       
                                    
                                    (
                                    z
                                    ,
                                    r
                                    )
                                 
                               being non-increasing in its arguments.□

In view of the above theorem, the optimal policy for K
                        =1, i.e. the critical numbers s
                        1j
                        (z
                        1)⩾0, 0⩽
                        z
                        1
                        ⩽
                        Q, s
                        2j
                        (r)⩽0, −1⩽
                        r
                        ⩽−Q, r
                        
                           j
                        
                        ⩽0 and q
                        
                           j
                        
                        ⩽0 for each customer j
                        ∈{1,…,
                        N
                        −1} can be found by the following special-purpose dynamic programming algorithm:


                        Algorithm for the determination of the critical numbers 
                        r
                        
                           j
                        , q
                        
                           j
                        , s
                        1j
                        (z
                        1), 0⩽
                        z
                        1
                        ⩽
                        Q 
                        and 
                        s
                        2j
                        (r), −1⩽
                        r
                        ⩽−
                        Q 
                        for customer 
                        j
                        =1,…,
                        N
                        −1
                           
                              
                                 Step 0.
                              Set 
                                    
                                       
                                          
                                             f
                                          
                                          
                                             N
                                          
                                       
                                       (
                                       
                                          
                                             z
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       r
                                       )
                                       =
                                       
                                          
                                             c
                                          
                                          
                                             N
                                             0
                                          
                                       
                                       +
                                       2
                                       
                                          
                                             c
                                          
                                          
                                             N
                                             0
                                          
                                       
                                       1
                                       
                                          
                                             
                                                
                                                   
                                                      z
                                                   
                                                   
                                                      1
                                                   
                                                   
                                                      -
                                                   
                                                
                                                +
                                                
                                                   
                                                      r
                                                   
                                                   
                                                      -
                                                   
                                                
                                                <
                                                0
                                             
                                          
                                       
                                       ,
                                       |
                                       
                                          
                                             z
                                          
                                          
                                             1
                                          
                                       
                                       |
                                       ⩽
                                       Q
                                    
                                 , ∣r∣⩽
                                 Q, z
                                 1
                                 +
                                 r
                                 ⩽
                                 Q, and j
                                 =
                                 N
                                 −1.

Set r
                                 =−1.

(Determination of critical number r
                                 
                                    j
                                 ) If 
                                    
                                       
                                          
                                             
                                                
                                                   H
                                                
                                                
                                                   ∼
                                                
                                             
                                          
                                          
                                             j
                                          
                                       
                                       (
                                       0
                                       ,
                                       r
                                       )
                                       >
                                       
                                          
                                             A
                                          
                                          
                                             j
                                          
                                       
                                    
                                 , do the following:
                                    
                                       1.
                                       Set r
                                          
                                             j
                                          
                                          =
                                          r
                                          +1.

For (z
                                          1, r) such that 0⩽
                                          z
                                          1
                                          ⩽
                                          Q, r
                                          
                                             j
                                          
                                          ⩽
                                          r
                                          <0 set 
                                             
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      j
                                                   
                                                
                                                (
                                                
                                                   
                                                      z
                                                   
                                                   
                                                      1
                                                   
                                                
                                                ,
                                                r
                                                )
                                                =
                                                2
                                                
                                                   
                                                      c
                                                   
                                                   
                                                      j
                                                      0
                                                   
                                                
                                                +
                                                
                                                   
                                                      
                                                         
                                                            H
                                                         
                                                         
                                                            ∼
                                                         
                                                      
                                                   
                                                   
                                                      j
                                                   
                                                
                                                (
                                                0
                                                ,
                                                r
                                                )
                                             
                                          .

For (z
                                          1, r) such that 0⩽
                                          z
                                          1
                                          ⩽
                                          Q, −Q
                                          ⩽
                                          r
                                          <
                                          r
                                          
                                             j
                                           set f
                                          
                                             j
                                          (z
                                          1, r)=2c
                                          
                                             j0
                                          +
                                          A
                                          
                                             j
                                          .

Go to Step 3.

Otherwise, set r
                                 =
                                 r
                                 −1.

If r
                                 =−Q
                                 −1, do the following:
                                    
                                       1.
                                       Set r
                                          
                                             j
                                          
                                          =−Q.

For (z
                                          1, r) such that 0⩽
                                          z
                                          1
                                          ⩽
                                          Q, −Q
                                          ⩽
                                          r
                                          <0 set 
                                             
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      j
                                                   
                                                
                                                (
                                                
                                                   
                                                      z
                                                   
                                                   
                                                      1
                                                   
                                                
                                                ,
                                                r
                                                )
                                                =
                                                2
                                                
                                                   
                                                      c
                                                   
                                                   
                                                      j
                                                      0
                                                   
                                                
                                                +
                                                
                                                   
                                                      
                                                         
                                                            H
                                                         
                                                         
                                                            ∼
                                                         
                                                      
                                                   
                                                   
                                                      j
                                                   
                                                
                                                (
                                                0
                                                ,
                                                r
                                                )
                                             
                                          .

Go to Step 3.

Otherwise, go to Step 2.

Set z
                                 1
                                 =−1.

(Determination of critical number q
                                 
                                    j
                                 ) If 
                                    
                                       
                                          
                                             
                                                
                                                   H
                                                
                                                
                                                   ∼
                                                
                                             
                                          
                                          
                                             j
                                          
                                       
                                       (
                                       
                                          
                                             z
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       0
                                       )
                                       >
                                       
                                          
                                             A
                                          
                                          
                                             j
                                          
                                       
                                    
                                 , do the following:
                                    
                                       1.
                                       Set q
                                          
                                             j
                                          
                                          =
                                          z
                                          1
                                          +1.

For (z
                                          1, r) such that q
                                          
                                             j
                                          
                                          ⩽
                                          z
                                          1
                                          <0, 0⩽
                                          r
                                          ⩽
                                          Q set 
                                             
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      j
                                                   
                                                
                                                (
                                                
                                                   
                                                      z
                                                   
                                                   
                                                      1
                                                   
                                                
                                                ,
                                                r
                                                )
                                                =
                                                2
                                                
                                                   
                                                      c
                                                   
                                                   
                                                      j
                                                      0
                                                   
                                                
                                                +
                                                
                                                   
                                                      
                                                         
                                                            H
                                                         
                                                         
                                                            ∼
                                                         
                                                      
                                                   
                                                   
                                                      j
                                                   
                                                
                                                (
                                                
                                                   
                                                      z
                                                   
                                                   
                                                      1
                                                   
                                                
                                                ,
                                                0
                                                )
                                             
                                          .

For (z
                                          1, r) such that −Q
                                          ⩽
                                          z
                                          1
                                          <
                                          q
                                          
                                             j
                                          , 0⩽
                                          r
                                          ⩽
                                          Q set f
                                          
                                             j
                                          (z
                                          1, r)=2c
                                          
                                             j0
                                          +
                                          A
                                          
                                             j
                                          .

Go to Step 5.

Otherwise, set z
                                 1
                                 =
                                 z
                                 1
                                 −1. If z
                                 1
                                 =−Q
                                 −1, do the following:
                                    
                                       1.
                                       Set q
                                          
                                             j
                                          
                                          =−Q.

For (z
                                          1, r) such that −Q
                                          ⩽
                                          z
                                          1
                                          <0, 0⩽
                                          r
                                          ⩽
                                          Q set 
                                             
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      j
                                                   
                                                
                                                (
                                                
                                                   
                                                      z
                                                   
                                                   
                                                      1
                                                   
                                                
                                                ,
                                                r
                                                )
                                                =
                                                2
                                                
                                                   
                                                      c
                                                   
                                                   
                                                      j
                                                      0
                                                   
                                                
                                                +
                                                
                                                   
                                                      
                                                         
                                                            H
                                                         
                                                         
                                                            ∼
                                                         
                                                      
                                                   
                                                   
                                                      j
                                                   
                                                
                                                (
                                                
                                                   
                                                      z
                                                   
                                                   
                                                      1
                                                   
                                                
                                                ,
                                                0
                                                )
                                             
                                          .

Go to Step 5.

Otherwise, go to Step 4.

Set z
                                 1
                                 =0.

Set r
                                 =
                                 Q
                                 −
                                 z
                                 1.

(Determination of critical number s
                                 1j
                                 (z
                                 1)) If H
                                 
                                    j
                                 (z
                                 1, r)>
                                 A
                                 
                                    j
                                 , do the following:
                                    
                                       1.
                                       Set s
                                          1j
                                          (z
                                          1)=
                                          r
                                          +1.

For 0⩽
                                          r
                                          ⩽
                                          s
                                          1j
                                          (z
                                          1)−1 set f
                                          
                                             j
                                          (z
                                          1, r)=
                                          A
                                          
                                             j
                                          .

For s
                                          1j
                                          (z
                                          1)⩽
                                          r
                                          ⩽
                                          Q
                                          −
                                          z
                                          1 set f
                                          
                                             j
                                          (z
                                          1, r)=
                                          H
                                          
                                             j
                                          (z
                                          1, r).

Set z
                                          1
                                          =
                                          z
                                          1
                                          +1. If z
                                          1
                                          ⩽
                                          Q, go to Step 6. Otherwise, go to Step 8.

Otherwise, set r
                                 =
                                 r
                                 −1. If r
                                 =−1, do the following:
                                    
                                       1.
                                       Set s
                                          1j
                                          (z
                                          1)=0.

For 0⩽
                                          r
                                          ⩽
                                          Q
                                          −
                                          z set f
                                          
                                             j
                                          (z
                                          1, r)=
                                          H
                                          
                                             j
                                          (z
                                          1, r).

Set z
                                          1
                                          =
                                          z
                                          1
                                          +1. If z
                                          1
                                          ⩽
                                          Q, go to Step 6. Otherwise, go to Step 8.

Otherwise, go to Step 7.

Set r
                                 =−1.

Set z
                                 1
                                 =−1.

(Determination of critical number s
                                 2j
                                 (r)) If 
                                    
                                       
                                          
                                             
                                                
                                                   H
                                                
                                                
                                                   ∼
                                                
                                             
                                          
                                          
                                             j
                                          
                                       
                                       (
                                       
                                          
                                             z
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       r
                                       )
                                       >
                                       
                                          
                                             A
                                          
                                          
                                             j
                                          
                                       
                                    
                                 , do the following:
                                    
                                       1.
                                       Set s
                                          2j
                                          (r)=
                                          z
                                          1.

For −Q
                                          ⩽
                                          z
                                          1
                                          ⩽
                                          s
                                          2j
                                          (r) set f
                                          
                                             j
                                          (z
                                          1, r)=2c
                                          
                                             j0
                                          +
                                          A
                                          
                                             j
                                          .

For s
                                          2j
                                          (r)+1⩽
                                          z
                                          1
                                          ⩽−1 set 
                                             
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      j
                                                   
                                                
                                                (
                                                
                                                   
                                                      z
                                                   
                                                   
                                                      1
                                                   
                                                
                                                ,
                                                r
                                                )
                                                =
                                                2
                                                
                                                   
                                                      c
                                                   
                                                   
                                                      j
                                                      0
                                                   
                                                
                                                +
                                                
                                                   
                                                      
                                                         
                                                            H
                                                         
                                                         
                                                            ∼
                                                         
                                                      
                                                   
                                                   
                                                      j
                                                   
                                                
                                                (
                                                
                                                   
                                                      z
                                                   
                                                   
                                                      1
                                                   
                                                
                                                ,
                                                r
                                                )
                                             
                                          .

Set r
                                          =
                                          r
                                          −1. If r
                                          ⩾−
                                          Q, go to Step 9. Otherwise, go to Step 11.

Otherwise, set z
                                 1
                                 =
                                 z
                                 1
                                 −1. If z
                                 1
                                 =−Q
                                 −1, do the following:
                                    
                                       1.
                                       Set s
                                          2j
                                          (r)=−Q
                                          −1.

For −Q
                                          ⩽
                                          z
                                          1
                                          ⩽−1 set 
                                             
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      j
                                                   
                                                
                                                (
                                                
                                                   
                                                      z
                                                   
                                                   
                                                      1
                                                   
                                                
                                                ,
                                                r
                                                )
                                                =
                                                2
                                                
                                                   
                                                      c
                                                   
                                                   
                                                      j
                                                      0
                                                   
                                                
                                                +
                                                
                                                   
                                                      
                                                         
                                                            H
                                                         
                                                         
                                                            ∼
                                                         
                                                      
                                                   
                                                   
                                                      j
                                                   
                                                
                                                (
                                                
                                                   
                                                      z
                                                   
                                                   
                                                      1
                                                   
                                                
                                                ,
                                                r
                                                )
                                             
                                          .

Set r
                                          =
                                          r
                                          −1. If r
                                          ⩾−
                                          Q, go to Step 9. Otherwise, go to Step 11.

Otherwise, go to Step 10.

Set j
                                 =
                                 j
                                 −1. If j
                                 ⩾1 go to Step 1. Otherwise, stop.

As illustration we present the following example.
                           Example 1
                           Suppose that N
                              =7, Q
                              =10, K
                              =1. We give below the symmetric matrix C
                              =(c
                              
                                 ij
                              ), 0⩽
                              i, j
                              ⩽7, whose non-zero elements are the travel costs c
                              
                                 j,j+1 between customer j
                              ∈{1,…,6} and customer j
                              +1 and the travel costs c
                              
                                 j0 between customer j
                              ∈{1,…,7} and the depot. We observe that these costs satisfy the triangle inequality.
                                 
                                    
                                       C
                                       =
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         0
                                                      
                                                      
                                                         7
                                                      
                                                      
                                                         6
                                                      
                                                      
                                                         5
                                                      
                                                      
                                                         4
                                                      
                                                      
                                                         3
                                                      
                                                      
                                                         7
                                                      
                                                      
                                                         6
                                                      
                                                   
                                                   
                                                      
                                                         7
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         5
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                   
                                                      
                                                         6
                                                      
                                                      
                                                         5
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         4
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                   
                                                      
                                                         5
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         4
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         3
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                   
                                                      
                                                         4
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         3
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         2
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                   
                                                      
                                                         3
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         2
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         5
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                   
                                                      
                                                         7
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         5
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   
                                                      
                                                         6
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         2
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       .
                                    
                                 
                              
                           

We assume that for each customer j
                        ∈{1,…,7} the demand 
                           
                              
                                 
                                    ξ
                                 
                                 
                                    1
                                 
                                 
                                    j
                                 
                              
                           
                         for new items of the product 1 and the quantity ψ
                        
                           j
                         of returned items are independent and follow the binomial distribution B(10, 0.4), i.e. 
                           
                              Pr
                              
                                 
                                    
                                       
                                          
                                             ξ
                                          
                                          
                                             1
                                          
                                          
                                             j
                                          
                                       
                                       =
                                       x
                                    
                                 
                              
                              =
                              Pr
                              (
                              
                                 
                                    ψ
                                 
                                 
                                    j
                                 
                              
                              =
                              x
                              )
                              =
                              
                                 
                                    
                                       
                                          
                                             
                                                10
                                             
                                          
                                          
                                             
                                                x
                                             
                                          
                                       
                                    
                                 
                              
                              
                                 
                                    0.4
                                 
                                 
                                    x
                                 
                              
                              
                                 
                                    0.6
                                 
                                 
                                    10
                                    -
                                    x
                                 
                              
                              ,
                              x
                              =
                              0
                              ,
                              …
                              ,
                              10
                           
                        . In Table 1
                         we present, for each customer j
                        =1,…,6, the critical numbers s
                        1j
                        (z
                        1), 0⩽
                        z
                        1
                        ⩽
                        Q, s
                        2j
                        (r), −Q
                        ⩽
                        r
                        ⩽−1, r
                        
                           j
                        , q
                        
                           j
                        .

Note that Parts (i) and (iv) of Theorem 1 are confirmed numerically since for j
                        ∈{1,…,6}, s
                        1j
                        (z
                        1), 0⩽
                        z
                        1
                        ⩽10, and s
                        2j
                        (r), −1⩽
                        r
                        ⩽−10, are non-increasing in z
                        1 and r, respectively. In Figs. 2 and 3
                        
                         below we present the optimal decision for each state (z
                        1, r), ∣z
                        1∣⩽10, ∣r∣⩽10, z
                        1
                        +
                        r
                        ⩽10, after the first visit to the first and to the third customer. Specifically, the action of proceeding to the next customer is denoted by a dark blue dot, the action of returning to the depot once is denoted by a red square and the action of making two trips to the depot is denoted by a light blue rhomb.

We implemented the algorithm by running the corresponding Matlab programs on a personal computer equipped with an Intel Core 2 Duo, 2.5GHz processor and 4GB of RAM. The computation time (38.81seconds) of the special purpose algorithm is considerably smaller than the computation time (58.39seconds) of the initial dynamic programming algorithm that is based on Eqs. (1)–(6). The minimum total expected cost 
                           
                              
                                 
                                    f
                                 
                                 
                                    0
                                 
                              
                              =
                              
                                 
                                    c
                                 
                                 
                                    10
                                 
                              
                              +
                              
                                 
                                    min
                                 
                                 
                                    0
                                    ⩽
                                    θ
                                    ⩽
                                    Q
                                 
                              
                              
                              
                                 
                                    Ef
                                 
                                 
                                    1
                                 
                              
                              
                                 
                                    
                                       θ
                                       -
                                       
                                          
                                             ξ
                                          
                                          
                                             1
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       Q
                                       -
                                       θ
                                       +
                                       min
                                       
                                          
                                             
                                                θ
                                                ,
                                                
                                                   
                                                      ξ
                                                   
                                                   
                                                      1
                                                   
                                                   
                                                      1
                                                   
                                                
                                             
                                          
                                       
                                       -
                                       
                                          
                                             ψ
                                          
                                          
                                             1
                                          
                                       
                                    
                                 
                              
                           
                         is found to be approximately equal to 65.29. Both algorithms enable us to determine the optimal quantity of product 1 that is loaded in the vehicle when it returns to the depot for replenishment. For example, if after the first visit of the vehicle to the customer 1 the state is (z
                        1, r)=(−5, 4), then the optimal decision is to return to the depot to empty the old items that it carries, load 5 items (owed quantity), return to customer 1 to deliver the owed quantity and then proceed to customer 2. If after the first visit to customer 1 the state is (z
                        1, r)=(−5, −7), the optimal decision is to return to the depot, empty returned products, load 5 items (owed quantity), return to customer 1 in order to deliver the owed quantity and pick up 7 items (remaining returned items), make a second trip to the depot, empty 7 returned items, load 3 new items of the product and go to customer 2.

We consider the problem that we studied in the previous section with the following modification: The service of the customers does not stop when the service of the last customer N has been completed but it continues indefinitely with the same customer order. This means that, after the service of customer N has been completed, the vehicle services again customer 1, customer 2, and so on. Let c
                     
                        N1 denote the travel cost from customer N to customer 1. The road network is depicted in Fig. 4
                     .

The demands of the customers for the products and the quantities of the returned products are renewed at successive tours of the vehicle. We assume that for each customer j
                     ∈{1,…,
                     N} the distribution of the random vector 
                        
                           (
                           
                              
                                 ξ
                              
                              
                                 1
                              
                              
                                 j
                              
                           
                           ,
                           …
                           ,
                           
                              
                                 ξ
                              
                              
                                 K
                              
                              
                                 j
                              
                           
                           ,
                           
                              
                                 ψ
                              
                              
                                 j
                              
                           
                           )
                        
                      that consists of the demands for products 1,…,
                     K and the quantity that is given to the vehicle remains the same at each cycle. We suppose that, at each cycle, the vehicle visits each customer, satisfies as much demands as possible and picks up the largest possible quantity of returned products, and chooses one decision among some possible decisions that coincide with the possible decisions in the finite-horizon problem. If the customer’s demands for all products are satisfied and the whole quantity of returned products is picked up by the vehicle, there are two possible decisions: (i) to proceed directly to the next customer and (ii) to go to the depot to empty returned items and restock with new products (not necessarily to the full capacity of the vehicle) and then go to the next customer. If part of the customer’s demands is not satisfied and/or there is not enough empty space in the vehicle to pick up the whole quantity of the returned products, the possible options are: (i) to go to the depot to empty returned items, restock the owed quantity and load additional items of all products (so that there is some remaining empty space for the remaining returned products), return to the customer, deliver the owed quantity and/or pick up the remaining returned products, and then proceed to the next customer and (ii) to go to the depot to empty returned items, restock the owed quantity, return to the customer, deliver the owed quantity and/or pick up the remaining returned products, make a second trip to the depot, empty returned items, restock with new products and proceed to the next customer.

It is assumed that the driver selects his decisions at equidistant time epochs τ
                     =0,1,… (e.g. every 12hours). This means that if, for example, the vehicle visits the third customer and the decision is selected at 8 am then the next decision is selected at 8pm after the visit at fourth customer’s site. It is also assumed that the time interval between two consecutive decision epochs is greater than the required time for two trips of the vehicle if it follows any of the above decisions. Although we impose these assumptions in order to apply well-known results from the theory of Markov decision processes, there are situations in which these assumptions may hold, as the practical applications that we mentioned in Section 1. Specifically, in the first application (ex-van sales) suppose that the supply of the customers with new products and the collection of expired products does not stop when the service of the last customer has been completed but it continues with the same customer order for a long time horizon. It can be assumed that the driver selects his decisions at equidistant time epochs (e.g. every 12hours). In the second application (self propelled vehicle in a manufacturing shop) it can be assumed that the supply of the workcenters with new discrete parts and the collection of useless discrete parts from the workcenters do not stop when the service of the last workcenter has been completed but they are continued indefinitely at equidistant time epochs with the same order.

The routing of the vehicle in the infinite-horizon setting is controlled by a policy π that is a rule for choosing decisions at time epochs τ
                     =0,1,… The decision that is chosen by a policy at a decision epoch may depend on the history of the process or may be randomized in the sense that it is chosen by specific probabilities. An appealing class of policies is the class of stationary policies. A stationary policy chooses at each decision epoch a decision that depends only on the current state of the system. The optimization criteria in the infinite-horizon problem are the minimization of the expected total discounted cost and the minimization of the expected long-run average cost per unit time. The expected total discounted cost of a policy π is defined as the expected total cost during an infinite-time horizon if the costs are discounted at a rate α
                     ∈(0,1) per unit time given that policy π is employed. The expected long-run average cost per unit time of a policy π is defined as the limit as n
                     →∞ of the expected cost incurred until the nth decision epoch divided by n, given that policy π is employed. Using well-known results of Markov decision processes (see Chapter 6 in Ross (1992)) we will see that, under any one of these criteria, the optimal policy is stationary and has the same structure as the optimal policy in the finite-horizon problem. The state space I of the system consists of all states 
                        
                           (
                           j
                           ,
                           
                              
                                 z
                              
                              
                                 ¯
                              
                           
                           ,
                           r
                           )
                        
                     , where j
                     =1,…,
                     N is the customer and 
                        
                           
                              
                                 z
                              
                              
                                 ¯
                              
                           
                           =
                           (
                           
                              
                                 z
                              
                              
                                 1
                              
                           
                           ,
                           …
                           ,
                           
                              
                                 z
                              
                              
                                 K
                              
                           
                           )
                        
                      and r are the possible loads of products 1,…,
                     K that remain in the vehicle and the empty space of the vehicle, respectively, after it has visited the jth customer and has satisfied as much demand as possible and picked up the largest possible quantity of returned products.

Let 
                           
                              
                                 
                                    V
                                 
                                 
                                    n
                                 
                                 
                                    α
                                 
                              
                              (
                              j
                              ,
                              
                                 
                                    z
                                 
                                 
                                    ¯
                                 
                              
                              ,
                              r
                              )
                              ,
                              (
                              j
                              ,
                              
                                 
                                    z
                                 
                                 
                                    ¯
                                 
                              
                              ,
                              r
                              )
                              ∈
                              I
                              ,
                              0
                              <
                              α
                              <
                              1
                           
                        , be the minimum n-step expected discounted cost if the initial state is 
                           
                              (
                              j
                              ,
                              
                                 
                                    z
                                 
                                 
                                    ¯
                                 
                              
                              ,
                              r
                              )
                              ∈
                              I
                           
                         and α is the discount factor. This quantity satisfies the following dynamic programming equations for n
                        =1,2,…

If z
                        1,…,
                        z
                        
                           K
                        , r
                        ⩾0, then
                           
                              
                                 
                                    
                                       V
                                    
                                    
                                       n
                                    
                                    
                                       α
                                    
                                 
                                 (
                                 j
                                 ,
                                 
                                    
                                       z
                                    
                                    
                                       ¯
                                    
                                 
                                 ,
                                 r
                                 )
                                 =
                                 
                                    min
                                 
                                 
                                    
                                       
                                          
                                             
                                                c
                                             
                                             
                                                j
                                                ,
                                                j
                                                +
                                                1
                                             
                                          
                                          +
                                          α
                                          
                                             
                                                EV
                                             
                                             
                                                n
                                                -
                                                1
                                             
                                             
                                                α
                                             
                                          
                                          
                                             
                                                
                                                   j
                                                   +
                                                   1
                                                   ,
                                                   
                                                      
                                                         z
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         
                                                            
                                                               ξ
                                                            
                                                            
                                                               ¯
                                                            
                                                         
                                                      
                                                      
                                                         j
                                                         +
                                                         1
                                                      
                                                   
                                                   ,
                                                   r
                                                   +
                                                   
                                                      
                                                         
                                                            ∑
                                                         
                                                         
                                                            i
                                                            =
                                                            1
                                                         
                                                         
                                                            K
                                                         
                                                      
                                                   
                                                   
                                                      min
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  z
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            ,
                                                            
                                                               
                                                                  ξ
                                                               
                                                               
                                                                  i
                                                               
                                                               
                                                                  j
                                                                  +
                                                                  1
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         ψ
                                                      
                                                      
                                                         j
                                                         +
                                                         1
                                                      
                                                   
                                                
                                             
                                          
                                          ,
                                          
                                             
                                                c
                                             
                                             
                                                j
                                                0
                                             
                                          
                                          +
                                          
                                             
                                                c
                                             
                                             
                                                j
                                                +
                                                1
                                                ,
                                                0
                                             
                                          
                                          +
                                          α
                                          
                                          
                                             
                                                
                                                   min
                                                
                                                
                                                   
                                                      
                                                         θ
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                   :
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         i
                                                         =
                                                         1
                                                      
                                                      
                                                         K
                                                      
                                                   
                                                   
                                                      
                                                         θ
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ⩽
                                                   Q
                                                
                                             
                                          
                                          
                                          
                                             
                                                EV
                                             
                                             
                                                n
                                                -
                                                1
                                             
                                             
                                                α
                                             
                                          
                                          (
                                          j
                                          +
                                          1
                                          ,
                                          
                                             
                                                θ
                                             
                                             
                                                ¯
                                             
                                          
                                          -
                                          
                                             
                                                
                                                   
                                                      ξ
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                             
                                             
                                                j
                                                +
                                                1
                                             
                                          
                                          ,
                                          Q
                                          -
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   i
                                                   =
                                                   1
                                                
                                                
                                                   K
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         θ
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   -
                                                   
                                                      min
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  θ
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            -
                                                            
                                                               min
                                                            
                                                            
                                                               
                                                                  
                                                                     
                                                                        
                                                                           θ
                                                                        
                                                                        
                                                                           i
                                                                        
                                                                     
                                                                     ,
                                                                     
                                                                        
                                                                           ξ
                                                                        
                                                                        
                                                                           i
                                                                        
                                                                        
                                                                           j
                                                                           +
                                                                           1
                                                                        
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         ψ
                                                      
                                                      
                                                         j
                                                         +
                                                         1
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                        and if z
                        −
                        +
                        r
                        −
                        <0, then
                           
                              
                                 
                                    
                                       V
                                    
                                    
                                       n
                                    
                                    
                                       α
                                    
                                 
                                 (
                                 j
                                 ,
                                 
                                    
                                       z
                                    
                                    
                                       ¯
                                    
                                 
                                 ,
                                 r
                                 )
                                 =
                                 2
                                 
                                    
                                       c
                                    
                                    
                                       j
                                       0
                                    
                                 
                                 +
                                 
                                    min
                                 
                                 
                                    
                                       
                                          
                                             
                                                c
                                             
                                             
                                                j
                                                ,
                                                j
                                                +
                                                1
                                             
                                          
                                          +
                                          α
                                          
                                          
                                             
                                                
                                                   min
                                                
                                                
                                                   
                                                      
                                                         θ
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                   :
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         i
                                                         =
                                                         1
                                                      
                                                      
                                                         K
                                                      
                                                   
                                                   
                                                      
                                                         θ
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ⩽
                                                   Q
                                                   +
                                                   min
                                                   (
                                                   
                                                      
                                                         z
                                                      
                                                      
                                                         -
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         -
                                                      
                                                   
                                                   )
                                                
                                             
                                          
                                          
                                          
                                             
                                                EV
                                             
                                             
                                                n
                                                -
                                                1
                                             
                                             
                                                α
                                             
                                          
                                          
                                             
                                                
                                                   j
                                                   +
                                                   1
                                                   ,
                                                   
                                                      
                                                         θ
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         
                                                            
                                                               ξ
                                                            
                                                            
                                                               ¯
                                                            
                                                         
                                                      
                                                      
                                                         j
                                                         +
                                                         1
                                                      
                                                   
                                                   ,
                                                   Q
                                                   +
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         -
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         
                                                            ∑
                                                         
                                                         
                                                            i
                                                            =
                                                            1
                                                         
                                                         
                                                            K
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  θ
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            -
                                                            
                                                               min
                                                            
                                                            
                                                               
                                                                  
                                                                     
                                                                        
                                                                           θ
                                                                        
                                                                        
                                                                           i
                                                                        
                                                                     
                                                                     ,
                                                                     
                                                                        
                                                                           ξ
                                                                        
                                                                        
                                                                           i
                                                                        
                                                                        
                                                                           j
                                                                           +
                                                                           1
                                                                        
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         ψ
                                                      
                                                      
                                                         j
                                                         +
                                                         1
                                                      
                                                   
                                                
                                             
                                          
                                          ,
                                          
                                             
                                                c
                                             
                                             
                                                j
                                                0
                                             
                                          
                                          +
                                          
                                             
                                                c
                                             
                                             
                                                0
                                                ,
                                                j
                                                +
                                                1
                                             
                                          
                                          +
                                          α
                                          
                                          
                                             
                                                
                                                   min
                                                
                                                
                                                   
                                                      
                                                         θ
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                   :
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         i
                                                         =
                                                         1
                                                      
                                                      
                                                         K
                                                      
                                                   
                                                   
                                                      
                                                         θ
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ⩽
                                                   Q
                                                
                                             
                                          
                                          
                                          
                                             
                                                EV
                                             
                                             
                                                n
                                                -
                                                1
                                             
                                             
                                                α
                                             
                                          
                                          
                                             
                                                
                                                   j
                                                   +
                                                   1
                                                   ,
                                                   
                                                      
                                                         θ
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         
                                                            
                                                               ξ
                                                            
                                                            
                                                               ¯
                                                            
                                                         
                                                      
                                                      
                                                         j
                                                         +
                                                         1
                                                      
                                                   
                                                   ,
                                                   Q
                                                   -
                                                   
                                                      
                                                         
                                                            ∑
                                                         
                                                         
                                                            i
                                                            =
                                                            1
                                                         
                                                         
                                                            K
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  θ
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            -
                                                            
                                                               min
                                                            
                                                            
                                                               
                                                                  
                                                                     
                                                                        
                                                                           θ
                                                                        
                                                                        
                                                                           i
                                                                        
                                                                     
                                                                     ,
                                                                     
                                                                        
                                                                           ξ
                                                                        
                                                                        
                                                                           i
                                                                        
                                                                        
                                                                           j
                                                                           +
                                                                           1
                                                                        
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         ψ
                                                      
                                                      
                                                         j
                                                         +
                                                         1
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 .
                              
                           
                        We also have that 
                           
                              
                                 
                                    V
                                 
                                 
                                    0
                                 
                                 
                                    α
                                 
                              
                              (
                              j
                              ,
                              
                                 
                                    z
                                 
                                 
                                    ¯
                                 
                              
                              ,
                              r
                              )
                              =
                              0
                              ,
                              (
                              j
                              ,
                              
                                 
                                    z
                                 
                                 
                                    ¯
                                 
                              
                              )
                              ∈
                              I
                           
                        . In the above equations we assume that N
                        +1 is equal to 1 since the next customer after customer N is the customer 1. It can be shown by induction on n that 
                           
                              
                                 
                                    V
                                 
                                 
                                    n
                                 
                                 
                                    α
                                 
                              
                              (
                              j
                              ,
                              
                                 
                                    z
                                 
                                 
                                    ¯
                                 
                              
                              ,
                              r
                              )
                           
                         is non-increasing in z
                        1,…,
                        z
                        
                           K
                        , r in the same way as we proved that 
                           
                              
                                 
                                    f
                                 
                                 
                                    j
                                 
                              
                              (
                              
                                 
                                    z
                                 
                                 
                                    ¯
                                 
                              
                              ,
                              r
                              )
                           
                         is non-increasing in its arguments in Lemma 1. Let 
                           
                              
                                 
                                    V
                                 
                                 
                                    α
                                 
                              
                              (
                              j
                              ,
                              
                                 
                                    z
                                 
                                 
                                    ¯
                                 
                              
                              ,
                              r
                              )
                              ,
                              (
                              j
                              ,
                              
                                 
                                    z
                                 
                                 
                                    ¯
                                 
                              
                              ,
                              r
                              )
                              ∈
                              I
                           
                        , denote the α-discounted total expected cost if the initial state is 
                           
                              (
                              j
                              ,
                              
                                 
                                    z
                                 
                                 
                                    ¯
                                 
                              
                              )
                              ∈
                              I
                           
                        . This quantity is finite since the state space I is finite. It satisfies the following optimality equations:

If z
                        1,…,
                        z
                        
                           K
                        , r
                        ⩾0, then
                           
                              
                                 
                                    
                                       V
                                    
                                    
                                       α
                                    
                                 
                                 (
                                 j
                                 ,
                                 
                                    
                                       z
                                    
                                    
                                       ¯
                                    
                                 
                                 ,
                                 r
                                 )
                                 =
                                 
                                    min
                                 
                                 
                                    
                                       
                                          
                                             
                                                c
                                             
                                             
                                                j
                                                ,
                                                j
                                                +
                                                1
                                             
                                          
                                          +
                                          α
                                          
                                             
                                                EV
                                             
                                             
                                                α
                                             
                                          
                                          
                                             
                                                
                                                   j
                                                   +
                                                   1
                                                   ,
                                                   
                                                      
                                                         z
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         
                                                            
                                                               ξ
                                                            
                                                            
                                                               ¯
                                                            
                                                         
                                                      
                                                      
                                                         j
                                                         +
                                                         1
                                                      
                                                   
                                                   ,
                                                   r
                                                   +
                                                   
                                                      
                                                         
                                                            ∑
                                                         
                                                         
                                                            i
                                                            =
                                                            1
                                                         
                                                         
                                                            K
                                                         
                                                      
                                                   
                                                   
                                                      min
                                                   
                                                   (
                                                   
                                                      
                                                         z
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         ξ
                                                      
                                                      
                                                         i
                                                      
                                                      
                                                         j
                                                         +
                                                         1
                                                      
                                                   
                                                   )
                                                   -
                                                   
                                                      
                                                         ψ
                                                      
                                                      
                                                         j
                                                         +
                                                         1
                                                      
                                                   
                                                
                                             
                                          
                                          ,
                                          
                                             
                                                c
                                             
                                             
                                                j
                                                0
                                             
                                          
                                          +
                                          
                                             
                                                c
                                             
                                             
                                                j
                                                +
                                                1
                                                ,
                                                0
                                             
                                          
                                          +
                                          α
                                          
                                          
                                             
                                                
                                                   min
                                                
                                                
                                                   
                                                      
                                                         θ
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                   :
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         i
                                                         =
                                                         1
                                                      
                                                      
                                                         K
                                                      
                                                   
                                                   
                                                      
                                                         θ
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ⩽
                                                   Q
                                                
                                             
                                          
                                          
                                          
                                             
                                                EV
                                             
                                             
                                                α
                                             
                                          
                                          (
                                          j
                                          +
                                          1
                                          ,
                                          
                                             
                                                θ
                                             
                                             
                                                ¯
                                             
                                          
                                          -
                                          
                                             
                                                
                                                   
                                                      ξ
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                             
                                             
                                                j
                                                +
                                                1
                                             
                                          
                                          ,
                                          Q
                                          -
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   i
                                                   =
                                                   1
                                                
                                                
                                                   K
                                                
                                             
                                          
                                          (
                                          
                                             
                                                θ
                                             
                                             
                                                i
                                             
                                          
                                          -
                                          
                                             min
                                          
                                          (
                                          
                                             
                                                θ
                                             
                                             
                                                i
                                             
                                          
                                          -
                                          
                                             min
                                          
                                          (
                                          
                                             
                                                θ
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          
                                             
                                                ξ
                                             
                                             
                                                i
                                             
                                             
                                                j
                                                +
                                                1
                                             
                                          
                                          )
                                          )
                                          -
                                          
                                             
                                                ψ
                                             
                                             
                                                j
                                                +
                                                1
                                             
                                          
                                          )
                                       
                                    
                                 
                                 ,
                              
                           
                        and if z
                        −
                        +
                        r
                        −
                        <0, then
                           
                              
                                 
                                    
                                       V
                                    
                                    
                                       α
                                    
                                 
                                 (
                                 j
                                 ,
                                 
                                    
                                       z
                                    
                                    
                                       ¯
                                    
                                 
                                 ,
                                 r
                                 )
                                 =
                                 2
                                 
                                    
                                       c
                                    
                                    
                                       j
                                       0
                                    
                                 
                                 +
                                 
                                    min
                                 
                                 
                                    
                                       
                                          
                                             
                                                c
                                             
                                             
                                                j
                                                ,
                                                j
                                                +
                                                1
                                             
                                          
                                          +
                                          α
                                          
                                          
                                             
                                                
                                                   min
                                                
                                                
                                                   
                                                      
                                                         θ
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                   :
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         i
                                                         =
                                                         1
                                                      
                                                      
                                                         K
                                                      
                                                   
                                                   
                                                      
                                                         θ
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ⩽
                                                   Q
                                                   +
                                                   min
                                                   (
                                                   
                                                      
                                                         z
                                                      
                                                      
                                                         -
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         -
                                                      
                                                   
                                                   )
                                                
                                             
                                          
                                          
                                          
                                             
                                                EV
                                             
                                             
                                                α
                                             
                                          
                                          
                                             
                                                
                                                   j
                                                   +
                                                   1
                                                   ,
                                                   
                                                      
                                                         θ
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         
                                                            
                                                               ξ
                                                            
                                                            
                                                               ¯
                                                            
                                                         
                                                      
                                                      
                                                         j
                                                         +
                                                         1
                                                      
                                                   
                                                   ,
                                                   Q
                                                   +
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         -
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         
                                                            ∑
                                                         
                                                         
                                                            i
                                                            =
                                                            1
                                                         
                                                         
                                                            K
                                                         
                                                      
                                                   
                                                   (
                                                   
                                                      
                                                         θ
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   -
                                                   
                                                      min
                                                   
                                                   (
                                                   
                                                      
                                                         θ
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         ξ
                                                      
                                                      
                                                         i
                                                      
                                                      
                                                         j
                                                         +
                                                         1
                                                      
                                                   
                                                   )
                                                   )
                                                   -
                                                   
                                                      
                                                         ψ
                                                      
                                                      
                                                         j
                                                         +
                                                         1
                                                      
                                                   
                                                
                                             
                                          
                                          ,
                                          
                                             
                                                c
                                             
                                             
                                                j
                                                0
                                             
                                          
                                          +
                                          
                                             
                                                c
                                             
                                             
                                                0
                                                ,
                                                j
                                                +
                                                1
                                             
                                          
                                          +
                                          α
                                          
                                          
                                             
                                                
                                                   min
                                                
                                                
                                                   
                                                      
                                                         θ
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                   :
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         i
                                                         =
                                                         1
                                                      
                                                      
                                                         K
                                                      
                                                   
                                                   
                                                      
                                                         θ
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ⩽
                                                   Q
                                                
                                             
                                          
                                          
                                          
                                             
                                                EV
                                             
                                             
                                                α
                                             
                                          
                                          (
                                          j
                                          +
                                          1
                                          ,
                                          
                                             
                                                θ
                                             
                                             
                                                ¯
                                             
                                          
                                          -
                                          
                                             
                                                
                                                   
                                                      ξ
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                             
                                             
                                                j
                                                +
                                                1
                                             
                                          
                                          ,
                                          Q
                                          -
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   i
                                                   =
                                                   1
                                                
                                                
                                                   K
                                                
                                             
                                          
                                          (
                                          
                                             
                                                θ
                                             
                                             
                                                i
                                             
                                          
                                          -
                                          
                                             min
                                          
                                          (
                                          
                                             
                                                θ
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          
                                             
                                                ξ
                                             
                                             
                                                i
                                             
                                             
                                                j
                                                +
                                                1
                                             
                                          
                                          )
                                          )
                                          -
                                          
                                             
                                                ψ
                                             
                                             
                                                j
                                                +
                                                1
                                             
                                          
                                          )
                                       
                                    
                                 
                                 .
                              
                           
                        It is well known (see Corollary 6.6 in Ross (1992)) that, as 
                           
                              n
                              →
                              ∞
                              ,
                              
                                 
                                    V
                                 
                                 
                                    n
                                 
                                 
                                    α
                                 
                              
                              (
                              j
                              ,
                              
                                 
                                    z
                                 
                                 
                                    ¯
                                 
                              
                              ,
                              r
                              )
                              →
                              
                                 
                                    V
                                 
                                 
                                    α
                                 
                              
                              (
                              j
                              ,
                              
                                 
                                    z
                                 
                                 
                                    ¯
                                 
                              
                              ,
                              r
                              )
                           
                        . Hence, the first terms in the curly brackets in the above optimality equations are non-increasing in z
                        1,…,
                        z
                        
                           K
                        , r and z, r, respectively. This implies that the α-discounted cost optimal policy has the threshold-type structure described in Theorem 1.

We focus now on the minimization of the expected average cost. First we note that the state 
                           
                              (
                              1
                              ,
                              
                                 
                                    0
                                 
                                 
                                    ¯
                                 
                              
                              ,
                              0
                              )
                              ∈
                              I
                           
                         is accessible from any other state under any stationary policy. From Corollary 6.20 in Ross (1992) it follows that there exist numbers g and 
                           
                              h
                              (
                              j
                              ,
                              
                                 
                                    z
                                 
                                 
                                    ¯
                                 
                              
                              ,
                              r
                              )
                              ,
                              (
                              j
                              ,
                              
                                 
                                    z
                                 
                                 
                                    ¯
                                 
                              
                              ,
                              r
                              )
                              ∈
                              I
                           
                        , such that

If z
                        1,…,
                        z
                        
                           K
                        , r
                        ⩾0, then
                           
                              
                                 h
                                 (
                                 j
                                 ,
                                 
                                    
                                       z
                                    
                                    
                                       ¯
                                    
                                 
                                 ,
                                 r
                                 )
                                 =
                                 
                                    min
                                 
                                 
                                    
                                       
                                          
                                             
                                                c
                                             
                                             
                                                j
                                                ,
                                                j
                                                +
                                                1
                                             
                                          
                                          -
                                          g
                                          +
                                          Eh
                                          (
                                          j
                                          +
                                          1
                                          ,
                                          
                                             
                                                z
                                             
                                             
                                                ¯
                                             
                                          
                                          -
                                          
                                             
                                                
                                                   
                                                      ξ
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                             
                                             
                                                j
                                                +
                                                1
                                             
                                          
                                          ,
                                          r
                                          +
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   i
                                                   =
                                                   1
                                                
                                                
                                                   K
                                                
                                             
                                          
                                          
                                             min
                                          
                                          (
                                          
                                             
                                                z
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          
                                             
                                                ξ
                                             
                                             
                                                i
                                             
                                             
                                                j
                                                +
                                                1
                                             
                                          
                                          )
                                          -
                                          
                                             
                                                ψ
                                             
                                             
                                                j
                                                +
                                                1
                                             
                                          
                                          )
                                          ,
                                          
                                             
                                                c
                                             
                                             
                                                j
                                                0
                                             
                                          
                                          +
                                          
                                             
                                                c
                                             
                                             
                                                j
                                                +
                                                1
                                                ,
                                                0
                                             
                                          
                                          -
                                          g
                                          +
                                          
                                             
                                                
                                                   min
                                                
                                                
                                                   
                                                      
                                                         θ
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                   :
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         i
                                                         =
                                                         1
                                                      
                                                      
                                                         K
                                                      
                                                   
                                                   
                                                      
                                                         θ
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ⩽
                                                   Q
                                                
                                             
                                          
                                          
                                          Eh
                                          (
                                          j
                                          +
                                          1
                                          ,
                                          
                                             
                                                θ
                                             
                                             
                                                ¯
                                             
                                          
                                          -
                                          
                                             
                                                
                                                   
                                                      ξ
                                                   
                                                   
                                                      ¯
                                                   
                                                
                                             
                                             
                                                j
                                                +
                                                1
                                             
                                          
                                          ,
                                          Q
                                          -
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   i
                                                   =
                                                   1
                                                
                                                
                                                   K
                                                
                                             
                                          
                                          (
                                          
                                             
                                                θ
                                             
                                             
                                                i
                                             
                                          
                                          -
                                          
                                             min
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         θ
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   -
                                                   
                                                      min
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  θ
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            ,
                                                            
                                                               
                                                                  ξ
                                                               
                                                               
                                                                  i
                                                               
                                                               
                                                                  j
                                                                  +
                                                                  1
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          -
                                          
                                             
                                                ψ
                                             
                                             
                                                j
                                                +
                                                1
                                             
                                          
                                          )
                                       
                                    
                                 
                                 ,
                              
                           
                        and if z
                        −
                        +
                        r
                        −
                        <0, then
                           
                              
                                 h
                                 (
                                 j
                                 ,
                                 
                                    
                                       z
                                    
                                    
                                       ¯
                                    
                                 
                                 ,
                                 r
                                 )
                                 =
                                 2
                                 
                                    
                                       c
                                    
                                    
                                       j
                                       0
                                    
                                 
                                 +
                                 
                                    min
                                 
                                 
                                    
                                       
                                          
                                             
                                                c
                                             
                                             
                                                j
                                                ,
                                                j
                                                +
                                                1
                                             
                                          
                                          -
                                          g
                                          +
                                          
                                             
                                                
                                                   min
                                                
                                                
                                                   
                                                      
                                                         θ
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                   :
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         i
                                                         =
                                                         1
                                                      
                                                      
                                                         K
                                                      
                                                   
                                                   
                                                      
                                                         θ
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ⩽
                                                   Q
                                                   +
                                                   min
                                                   (
                                                   
                                                      
                                                         z
                                                      
                                                      
                                                         -
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         -
                                                      
                                                   
                                                   )
                                                
                                             
                                          
                                          
                                          Eh
                                          
                                             
                                                
                                                   j
                                                   +
                                                   1
                                                   ,
                                                   
                                                      
                                                         θ
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         
                                                            
                                                               ξ
                                                            
                                                            
                                                               ¯
                                                            
                                                         
                                                      
                                                      
                                                         j
                                                         +
                                                         1
                                                      
                                                   
                                                   ,
                                                   Q
                                                   +
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         -
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         
                                                            ∑
                                                         
                                                         
                                                            i
                                                            =
                                                            1
                                                         
                                                         
                                                            K
                                                         
                                                      
                                                   
                                                   (
                                                   
                                                      
                                                         θ
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   -
                                                   
                                                      min
                                                   
                                                   (
                                                   
                                                      
                                                         θ
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         ξ
                                                      
                                                      
                                                         i
                                                      
                                                      
                                                         j
                                                         +
                                                         1
                                                      
                                                   
                                                   )
                                                   )
                                                   -
                                                   
                                                      
                                                         ψ
                                                      
                                                      
                                                         j
                                                         +
                                                         1
                                                      
                                                   
                                                
                                             
                                          
                                          ,
                                          
                                             
                                                c
                                             
                                             
                                                j
                                                0
                                             
                                          
                                          +
                                          
                                             
                                                c
                                             
                                             
                                                0
                                                ,
                                                j
                                                +
                                                1
                                             
                                          
                                          -
                                          g
                                          +
                                          
                                             
                                                
                                                   min
                                                
                                                
                                                   
                                                      
                                                         θ
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                   :
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         i
                                                         =
                                                         1
                                                      
                                                      
                                                         K
                                                      
                                                   
                                                   
                                                      
                                                         θ
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ⩽
                                                   Q
                                                
                                             
                                          
                                          Eh
                                          
                                             
                                                
                                                   j
                                                   +
                                                   1
                                                   ,
                                                   
                                                      
                                                         θ
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         
                                                            
                                                               ξ
                                                            
                                                            
                                                               ¯
                                                            
                                                         
                                                      
                                                      
                                                         j
                                                         +
                                                         1
                                                      
                                                   
                                                   ,
                                                   Q
                                                   -
                                                   
                                                      
                                                         
                                                            ∑
                                                         
                                                         
                                                            i
                                                            =
                                                            1
                                                         
                                                         
                                                            K
                                                         
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  θ
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            -
                                                            
                                                               min
                                                            
                                                            
                                                               
                                                                  
                                                                     
                                                                        
                                                                           θ
                                                                        
                                                                        
                                                                           i
                                                                        
                                                                     
                                                                     ,
                                                                     
                                                                        
                                                                           ξ
                                                                        
                                                                        
                                                                           i
                                                                        
                                                                        
                                                                           j
                                                                           +
                                                                           1
                                                                        
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         ψ
                                                      
                                                      
                                                         j
                                                         +
                                                         1
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 .
                              
                           
                        The above equations are known as the average-cost optimality equations. The number g is the minimum average cost. It does not depend on the initial state of the system. There also exists a sequence α
                        
                           n
                        
                        →1 (see Theorem 6.18 in Ross (1992)) such that
                           
                              
                                 h
                                 (
                                 j
                                 ,
                                 
                                    
                                       z
                                    
                                    
                                       ¯
                                    
                                 
                                 ,
                                 r
                                 )
                                 =
                                 
                                    
                                       
                                          lim
                                       
                                       
                                          n
                                          →
                                          ∞
                                       
                                    
                                 
                                 [
                                 
                                    
                                       V
                                    
                                    
                                       
                                          
                                             α
                                          
                                          
                                             n
                                          
                                       
                                    
                                 
                                 (
                                 j
                                 ,
                                 
                                    
                                       z
                                    
                                    
                                       ¯
                                    
                                 
                                 ,
                                 r
                                 )
                                 -
                                 
                                    
                                       V
                                    
                                    
                                       
                                          
                                             α
                                          
                                          
                                             n
                                          
                                       
                                    
                                 
                                 (
                                 1
                                 ,
                                 
                                    
                                       0
                                    
                                    
                                       ¯
                                    
                                 
                                 ,
                                 0
                                 )
                                 ]
                                 ,
                                 (
                                 j
                                 ,
                                 
                                    
                                       z
                                    
                                    
                                       ¯
                                    
                                 
                                 ,
                                 r
                                 )
                                 ∈
                                 I
                                 .
                              
                           
                        The monotonicity of 
                           
                              
                                 
                                    V
                                 
                                 
                                    
                                       
                                          α
                                       
                                       
                                          n
                                       
                                    
                                 
                              
                              (
                              j
                              ,
                              
                                 
                                    z
                                 
                                 
                                    ¯
                                 
                              
                              ,
                              r
                              )
                           
                         with respect to z
                        
                           i
                        , i
                        =1,…,
                        K, and r implies that 
                           
                              h
                              (
                              j
                              ,
                              
                                 
                                    z
                                 
                                 
                                    ¯
                                 
                              
                              ,
                              r
                              )
                           
                         is non-increasing with respect to z
                        
                           i
                        , i
                        =1,…,
                        K, and r. Therefore, the first terms in the curly brackets in the above average-cost optimality equations are non-increasing in z
                        1,…,
                        z
                        
                           K
                        , r and z, r, respectively. Hence the average cost optimal policy has the same threshold-type structure as the finite-horizon optimal policy and the discounted-cost optimal policy.

The average-cost optimal policy can be found numerically by the value-iteration algorithm, the policy-iteration algorithm and the linear programming formulation. We refer to Chapter 3 in Tijms (1994) for a detailed description of these algorithms. To implement these algorithms we must specify the one-step transition probabilities and the one-step expected costs. For simplicity we suppose that K
                        =1, i.e. there is only product 1. Let a
                        ∈{0,1
                           θ
                        }, 0⩽
                        θ
                        ⩽
                        Q, be the action that is selected when the system at a decision epoch is at state (j, z
                        1, r)∈
                        I with z
                        1, r
                        ⩾0. We assume that the action a
                        =0 means that the vehicle goes directly to the next customer while the action a
                        =1
                           θ
                         means that is goes to the depot, empties any returned products, restocks with θ items of product 1 and then visits customer j
                        +1. Let 
                           
                              a
                              ∈
                              
                                 
                                    
                                       
                                          
                                             2
                                          
                                          
                                             θ
                                          
                                       
                                       ,
                                       
                                          
                                             3
                                          
                                          
                                             
                                                
                                                   θ
                                                
                                                
                                                   ′
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              ,
                              0
                              ⩽
                              θ
                              ⩽
                              Q
                              +
                              min
                              
                                 
                                    
                                       
                                          
                                             z
                                          
                                          
                                             1
                                          
                                          
                                             -
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             -
                                          
                                       
                                    
                                 
                              
                              ,
                              0
                              ⩽
                              
                                 
                                    θ
                                 
                                 
                                    ′
                                 
                              
                              ⩽
                              Q
                           
                        , is the action that is selected when the process at a decision epoch is at state (j, z
                        1, r)∈
                        I with 
                           
                              
                                 
                                    z
                                 
                                 
                                    1
                                 
                                 
                                    -
                                 
                              
                              +
                              
                                 
                                    r
                                 
                                 
                                    -
                                 
                              
                              <
                              0
                           
                        . We assume that the action 2
                           θ
                         means that the vehicle goes to the depot, empties returned products, restocks the owed quantity 
                           
                              -
                              
                                 
                                    z
                                 
                                 
                                    1
                                 
                                 
                                    -
                                 
                              
                           
                        , loads additional product quantity 
                           
                              θ
                              ∈
                              
                                 
                                    
                                       0
                                       ,
                                       …
                                       ,
                                       Q
                                       +
                                       min
                                       
                                          
                                             
                                                
                                                   
                                                      z
                                                   
                                                   
                                                      1
                                                   
                                                   
                                                      -
                                                   
                                                
                                                ,
                                                
                                                   
                                                      r
                                                   
                                                   
                                                      -
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        , returns to customer j, satisfies demand and/or picks up remaining returned products, and proceeds to customer j
                        +1. The action 
                           
                              
                                 
                                    3
                                 
                                 
                                    
                                       
                                          θ
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                           
                         means that the vehicle goes to the depot, empties returned products, loads the owed product quantity 
                           
                              -
                              
                                 
                                    z
                                 
                                 
                                    1
                                 
                                 
                                    -
                                 
                              
                           
                        , returns to customer j, satisfies demand and/or picks up remaining returned products, makes a second trip to the depot where it empties returned products, and restocks with θ′∈{0,…,
                        Q} items of product 1 and then proceeds to customer j
                        +1. Let 
                           
                              
                                 
                                    p
                                 
                                 
                                    (
                                    j
                                    ,
                                    
                                       
                                          z
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    r
                                    )
                                    (
                                    j
                                    +
                                    1
                                    ,
                                    
                                       
                                          z
                                       
                                       
                                          1
                                       
                                       
                                          ′
                                       
                                    
                                    ,
                                    
                                       
                                          r
                                       
                                       
                                          ′
                                       
                                    
                                    )
                                 
                              
                              (
                              a
                              )
                           
                         be the probability that the state at the next decision epoch will be the state 
                           
                              
                                 
                                    
                                       j
                                       +
                                       1
                                       ,
                                       
                                          
                                             z
                                          
                                          
                                             1
                                          
                                          
                                             ′
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 
                              
                           
                         if the present state is (j, z
                        1, r) and the action a∈
                           
                              
                                 
                                    
                                       0
                                       ,
                                       
                                          
                                             1
                                          
                                          
                                             θ
                                          
                                       
                                       ,
                                       
                                          
                                             2
                                          
                                          
                                             θ
                                          
                                       
                                       ,
                                       
                                          
                                             3
                                          
                                          
                                             
                                                
                                                   θ
                                                
                                                
                                                   ′
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                         is selected, and let C((j, z
                        1, r), a) be the corresponding expected cost. We give these quantities below.

If z
                        1, r
                        ⩾0, ∣z
                        1∣⩽
                        Q, ∣r∣⩽Q, z1
                        +
                        r
                        ⩽
                        Q then
                           
                              
                                 
                                    
                                       p
                                    
                                    
                                       (
                                       j
                                       ,
                                       
                                          
                                             z
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       r
                                       )
                                       (
                                       j
                                       +
                                       1
                                       ,
                                       
                                          
                                             z
                                          
                                          
                                             1
                                          
                                          
                                             ′
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             ′
                                          
                                       
                                       )
                                    
                                 
                                 (
                                 0
                                 )
                                 =
                                 Pr
                                 
                                    
                                       
                                          
                                             
                                                ξ
                                             
                                             
                                                1
                                             
                                             
                                                j
                                                +
                                                1
                                             
                                          
                                          =
                                          
                                             
                                                z
                                             
                                             
                                                1
                                             
                                          
                                          -
                                          
                                             
                                                z
                                             
                                             
                                                1
                                             
                                             
                                                ′
                                             
                                          
                                          ,
                                          
                                             
                                                ψ
                                             
                                             
                                                j
                                                +
                                                1
                                             
                                          
                                          =
                                          r
                                          +
                                          
                                             min
                                          
                                          (
                                          
                                             
                                                z
                                             
                                             
                                                1
                                             
                                          
                                          ,
                                          
                                             
                                                z
                                             
                                             
                                                1
                                             
                                          
                                          -
                                          
                                             
                                                z
                                             
                                             
                                                1
                                             
                                             
                                                ′
                                             
                                          
                                          )
                                          -
                                          
                                             
                                                r
                                             
                                             
                                                ′
                                             
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                        where 
                           
                              
                                 
                                    z
                                 
                                 
                                    1
                                 
                                 
                                    ′
                                 
                              
                              =
                              
                                 
                                    z
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    z
                                 
                                 
                                    1
                                 
                              
                              -
                              1
                              ,
                              …
                              ,
                              
                                 
                                    z
                                 
                                 
                                    1
                                 
                              
                              -
                              Q
                              ,
                              
                                 
                                    r
                                 
                                 
                                    ′
                                 
                              
                              =
                              r
                              +
                              
                                 
                                    z
                                 
                                 
                                    1
                                 
                              
                              ,
                              …
                              ,
                              r
                              -
                              Q
                           
                        .

If z
                        1, r
                        ⩾0, ∣z
                        1∣⩽
                        Q, ∣r∣⩽Q,z1
                        +
                        r
                        ⩽
                        Q,0⩽
                        θ
                        ⩽
                        Q then
                           
                              
                                 
                                    
                                       p
                                    
                                    
                                       (
                                       j
                                       ,
                                       
                                          
                                             z
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       r
                                       )
                                       (
                                       j
                                       +
                                       1
                                       ,
                                       
                                          
                                             z
                                          
                                          
                                             1
                                          
                                          
                                             ′
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             ′
                                          
                                       
                                       )
                                    
                                 
                                 (
                                 
                                    
                                       1
                                    
                                    
                                       θ
                                    
                                 
                                 )
                                 =
                                 Pr
                                 
                                    
                                       
                                          
                                             
                                                ξ
                                             
                                             
                                                1
                                             
                                             
                                                j
                                                +
                                                1
                                             
                                          
                                          =
                                          θ
                                          -
                                          
                                             
                                                z
                                             
                                             
                                                1
                                             
                                             
                                                ′
                                             
                                          
                                          ,
                                          
                                             
                                                ψ
                                             
                                             
                                                j
                                                +
                                                1
                                             
                                          
                                          =
                                          Q
                                          -
                                          θ
                                          +
                                          
                                             min
                                          
                                          
                                             
                                                
                                                   θ
                                                   ,
                                                   θ
                                                   -
                                                   
                                                      
                                                         z
                                                      
                                                      
                                                         1
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                
                                             
                                          
                                          -
                                          
                                             
                                                r
                                             
                                             
                                                ′
                                             
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                        where 
                           
                              
                                 
                                    z
                                 
                                 
                                    1
                                 
                                 
                                    ′
                                 
                              
                              =
                              θ
                              ,
                              θ
                              -
                              1
                              ,
                              …
                              ,
                              θ
                              -
                              Q
                              ,
                              
                                 
                                    r
                                 
                                 
                                    ′
                                 
                              
                              =
                              Q
                              ,
                              …
                              ,
                              -
                              θ
                           
                        .

If 
                           
                              
                                 
                                    z
                                 
                                 
                                    1
                                 
                                 
                                    -
                                 
                              
                              +
                              
                                 
                                    r
                                 
                                 
                                    -
                                 
                              
                              <
                              0
                              ,
                              |
                              
                                 
                                    z
                                 
                                 
                                    1
                                 
                              
                              |
                              ⩽
                              Q
                              ,
                              |
                              r
                              |
                              ⩽
                              Q
                              ,
                              0
                              ⩽
                              θ
                              ⩽
                              Q
                              +
                              min
                              
                                 
                                    
                                       
                                          
                                             z
                                          
                                          
                                             1
                                          
                                          
                                             -
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             -
                                          
                                       
                                    
                                 
                              
                           
                         then
                           
                              
                                 
                                    
                                       p
                                    
                                    
                                       (
                                       j
                                       ,
                                       
                                          
                                             z
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       r
                                       )
                                       (
                                       j
                                       +
                                       1
                                       ,
                                       
                                          
                                             z
                                          
                                          
                                             1
                                          
                                          
                                             ′
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             ′
                                          
                                       
                                       )
                                    
                                 
                                 (
                                 
                                    
                                       2
                                    
                                    
                                       θ
                                    
                                 
                                 )
                                 =
                                 Pr
                                 
                                    
                                       
                                          
                                             
                                                ξ
                                             
                                             
                                                1
                                             
                                             
                                                j
                                                +
                                                1
                                             
                                          
                                          =
                                          θ
                                          -
                                          
                                             
                                                z
                                             
                                             
                                                1
                                             
                                             
                                                ′
                                             
                                          
                                          ,
                                          
                                             
                                                ψ
                                             
                                             
                                                j
                                                +
                                                1
                                             
                                          
                                          =
                                          Q
                                          -
                                          θ
                                          +
                                          
                                             
                                                r
                                             
                                             
                                                -
                                             
                                          
                                          +
                                          
                                             min
                                          
                                          
                                             
                                                
                                                   θ
                                                   ,
                                                   θ
                                                   -
                                                   
                                                      
                                                         z
                                                      
                                                      
                                                         1
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                
                                             
                                          
                                          -
                                          
                                             
                                                r
                                             
                                             
                                                ′
                                             
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                        where 
                           
                              
                                 
                                    z
                                 
                                 
                                    1
                                 
                                 
                                    ′
                                 
                              
                              =
                              θ
                              ,
                              θ
                              -
                              1
                              ,
                              …
                              ,
                              θ
                              -
                              Q
                              ,
                              
                                 
                                    r
                                 
                                 
                                    ′
                                 
                              
                              =
                              Q
                              +
                              
                                 
                                    r
                                 
                                 
                                    -
                                 
                              
                              ,
                              …
                              ,
                              -
                              θ
                              +
                              
                                 
                                    r
                                 
                                 
                                    -
                                 
                              
                           
                        .

If 
                           
                              
                                 
                                    z
                                 
                                 
                                    1
                                 
                                 
                                    -
                                 
                              
                              +
                              
                                 
                                    r
                                 
                                 
                                    -
                                 
                              
                              <
                              0
                              ,
                              |
                              
                                 
                                    z
                                 
                                 
                                    1
                                 
                              
                              |
                              ⩽
                              Q
                              ,
                              |
                              r
                              |
                              ⩽
                              Q
                              ,
                              0
                              ⩽
                              
                                 
                                    θ
                                 
                                 
                                    ′
                                 
                              
                              ⩽
                              Q
                           
                         then
                           
                              
                                 
                                    
                                       p
                                    
                                    
                                       (
                                       j
                                       ,
                                       
                                          
                                             z
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       r
                                       )
                                       (
                                       j
                                       +
                                       1
                                       ,
                                       
                                          
                                             z
                                          
                                          
                                             1
                                          
                                          
                                             ′
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             ′
                                          
                                       
                                       )
                                    
                                 
                                 (
                                 
                                    
                                       3
                                    
                                    
                                       
                                          
                                             θ
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 
                                 )
                                 =
                                 Pr
                                 
                                    
                                       
                                          
                                             
                                                ξ
                                             
                                             
                                                1
                                             
                                             
                                                j
                                                +
                                                1
                                             
                                          
                                          =
                                          
                                             
                                                θ
                                             
                                             
                                                ′
                                             
                                          
                                          -
                                          
                                             
                                                z
                                             
                                             
                                                1
                                             
                                             
                                                ′
                                             
                                          
                                          ,
                                          
                                             
                                                ψ
                                             
                                             
                                                j
                                                +
                                                1
                                             
                                          
                                          =
                                          Q
                                          -
                                          
                                             
                                                θ
                                             
                                             
                                                ′
                                             
                                          
                                          +
                                          
                                             min
                                          
                                          (
                                          
                                             
                                                θ
                                             
                                             
                                                ′
                                             
                                          
                                          ,
                                          
                                             
                                                θ
                                             
                                             
                                                ′
                                             
                                          
                                          -
                                          
                                             
                                                z
                                             
                                             
                                                1
                                             
                                             
                                                ′
                                             
                                          
                                          )
                                          -
                                          
                                             
                                                r
                                             
                                             
                                                ′
                                             
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                        where 
                           
                              
                                 
                                    z
                                 
                                 
                                    1
                                 
                                 
                                    ′
                                 
                              
                              =
                              
                                 
                                    θ
                                 
                                 
                                    ′
                                 
                              
                              ,
                              
                                 
                                    θ
                                 
                                 
                                    ′
                                 
                              
                              -
                              1
                              ,
                              …
                              ,
                              
                                 
                                    θ
                                 
                                 
                                    ′
                                 
                              
                              -
                              Q
                              ,
                              
                                 
                                    r
                                 
                                 
                                    ′
                                 
                              
                              =
                              Q
                              ,
                              …
                              ,
                              -
                              
                                 
                                    θ
                                 
                                 
                                    ′
                                 
                              
                           
                        .

If z
                        1, r
                        ⩾0, ∣z
                        1∣⩽
                        Q, ∣r∣⩽Q, z1
                        +
                        r
                        ⩽
                        Q then
                           
                              
                                 
                                    
                                       
                                       
                                          
                                             C
                                             (
                                             (
                                             j
                                             ,
                                             
                                                
                                                   z
                                                
                                                
                                                   1
                                                
                                             
                                             ,
                                             r
                                             )
                                             ,
                                             0
                                             )
                                             =
                                             
                                                
                                                   c
                                                
                                                
                                                   j
                                                   ,
                                                   j
                                                   +
                                                   1
                                                
                                             
                                             ,
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             C
                                             (
                                             (
                                             j
                                             ,
                                             
                                                
                                                   z
                                                
                                                
                                                   1
                                                
                                             
                                             ,
                                             r
                                             )
                                             ,
                                             
                                                
                                                   1
                                                
                                                
                                                   θ
                                                
                                             
                                             )
                                             =
                                             
                                                
                                                   c
                                                
                                                
                                                   j
                                                   0
                                                
                                             
                                             +
                                             
                                                
                                                   c
                                                
                                                
                                                   0
                                                   ,
                                                   j
                                                   +
                                                   1
                                                
                                             
                                             ,
                                             0
                                             ⩽
                                             θ
                                             ⩽
                                             Q
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        If 
                           
                              
                                 
                                    z
                                 
                                 
                                    1
                                 
                                 
                                    -
                                 
                              
                              +
                              
                                 
                                    r
                                 
                                 
                                    -
                                 
                              
                              <
                              0
                              ,
                              |
                              
                                 
                                    z
                                 
                                 
                                    1
                                 
                              
                              |
                              ⩽
                              Q
                              ,
                              |
                              r
                              |
                              ⩽
                              Q
                           
                        ,
                           
                              
                                 
                                    
                                       
                                       
                                          
                                             C
                                             (
                                             (
                                             j
                                             ,
                                             
                                                
                                                   z
                                                
                                                
                                                   1
                                                
                                             
                                             ,
                                             r
                                             )
                                             ,
                                             
                                                
                                                   2
                                                
                                                
                                                   θ
                                                
                                             
                                             )
                                             =
                                             2
                                             
                                                
                                                   c
                                                
                                                
                                                   j
                                                   0
                                                
                                             
                                             +
                                             
                                                
                                                   c
                                                
                                                
                                                   j
                                                   ,
                                                   j
                                                   +
                                                   1
                                                
                                             
                                             ,
                                             0
                                             ⩽
                                             θ
                                             ⩽
                                             Q
                                             +
                                             
                                                min
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            z
                                                         
                                                         
                                                            1
                                                         
                                                         
                                                            -
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            r
                                                         
                                                         
                                                            -
                                                         
                                                      
                                                   
                                                
                                             
                                             ,
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             C
                                             
                                                
                                                   
                                                      (
                                                      j
                                                      ,
                                                      
                                                         
                                                            z
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      ,
                                                      r
                                                      )
                                                      ,
                                                      
                                                         
                                                            3
                                                         
                                                         
                                                            
                                                               
                                                                  θ
                                                               
                                                               
                                                                  ′
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                             =
                                             3
                                             
                                                
                                                   c
                                                
                                                
                                                   j
                                                   0
                                                
                                             
                                             +
                                             
                                                
                                                   c
                                                
                                                
                                                   0
                                                   ,
                                                   j
                                                   +
                                                   1
                                                
                                             
                                             ,
                                             0
                                             ⩽
                                             
                                                
                                                   θ
                                                
                                                
                                                   ′
                                                
                                             
                                             ⩽
                                             Q
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        As illustration we present the following example.
                           Example 2
                           Suppose that N
                              =7, Q
                              =8, K
                              =1. We give below the symmetric matrix C
                              =(c
                              
                                 ij
                              ), 0⩽
                              i, j
                              ⩽7, whose non-zero elements are the travel costs c
                              
                                 j, j+1 between customer j
                              ∈{1,…,7} and customer j
                              +1 and the travel costs c
                              
                                 j0 between customer j
                              ∈{1,…,7} and the depot. We observe that these costs satisfy the triangle inequality.
                                 
                                    
                                       C
                                       =
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         0
                                                      
                                                      
                                                         20
                                                      
                                                      
                                                         15
                                                      
                                                      
                                                         21
                                                      
                                                      
                                                         15
                                                      
                                                      
                                                         20
                                                      
                                                      
                                                         19
                                                      
                                                      
                                                         20
                                                      
                                                   
                                                   
                                                      
                                                         20
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         15
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         31
                                                      
                                                   
                                                   
                                                      
                                                         15
                                                      
                                                      
                                                         15
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         17
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                   
                                                      
                                                         21
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         17
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         15
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                   
                                                      
                                                         15
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         15
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         18
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                   
                                                      
                                                         20
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         18
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         17
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                   
                                                      
                                                         19
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         17
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         21
                                                      
                                                   
                                                   
                                                      
                                                         20
                                                      
                                                      
                                                         31
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         0
                                                      
                                                      
                                                         21
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       .
                                    
                                 
                              
                           

We assume that for each customer j
                        ∈{1,…,7} the demand 
                           
                              
                                 
                                    ξ
                                 
                                 
                                    1
                                 
                                 
                                    j
                                 
                              
                           
                         for new items and the quantity ψ
                        
                           j
                         of returned items are independent and follow the uniform distribution in the set {0,1,…,8}, i.e. 
                           
                              Pr
                              
                                 
                                    
                                       
                                          
                                             ξ
                                          
                                          
                                             1
                                          
                                          
                                             j
                                          
                                       
                                       =
                                       x
                                    
                                 
                              
                              =
                              Pr
                              (
                              
                                 
                                    ψ
                                 
                                 
                                    j
                                 
                              
                              =
                              x
                              )
                              =
                              1
                              /
                              9
                              ,
                              x
                              =
                              0
                              ,
                              …
                              ,
                              8
                           
                        . The standard value-iteration algorithm does not converge in this example. This is due to the periodicity (with period N) of all states of the system under any stationary policy. This problem can be circumvented by a perturbation of the one-step transition probabilities so that a transition from a state to itself with non-zero probability is allowed. Specifically, we take the following new one-step probabilities
                           
                              
                                 
                                    
                                       
                                          
                                             p
                                          
                                          
                                             ̃
                                          
                                       
                                    
                                    
                                       (
                                       j
                                       ,
                                       
                                          
                                             z
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       r
                                       )
                                       (
                                       j
                                       +
                                       1
                                       ,
                                       
                                          
                                             z
                                          
                                          
                                             1
                                          
                                          
                                             ′
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             ′
                                          
                                       
                                       )
                                    
                                 
                                 (
                                 a
                                 )
                                 =
                                 τ
                                 
                                    
                                       p
                                    
                                    
                                       (
                                       j
                                       ,
                                       
                                          
                                             z
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       r
                                       )
                                       (
                                       j
                                       +
                                       1
                                       ,
                                       
                                          
                                             z
                                          
                                          
                                             1
                                          
                                          
                                             ′
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             ′
                                          
                                       
                                       )
                                    
                                 
                                 (
                                 a
                                 )
                                 ,
                                 
                                    
                                       
                                          
                                             p
                                          
                                          
                                             ̃
                                          
                                       
                                    
                                    
                                       (
                                       j
                                       ,
                                       
                                          
                                             z
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       r
                                       )
                                       (
                                       j
                                       ,
                                       
                                          
                                             z
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       r
                                       )
                                    
                                 
                                 (
                                 a
                                 )
                                 =
                                 1
                                 -
                                 τ
                                 ,
                              
                           
                        where τ is a constant such that 0<
                        τ
                        <1. A reasonable choice for the value of τ is 0.5. The perturbed model has the same average-cost optimal policy as the original model (see p. 209 in Tijms (1994)). We implemented the value iteration algorithm in the perturbed model and we chose ε
                        =10−3 as the tolerance number in the stopping criterion of the algorithm. The algorithm converged to the optimal policy after 56 iterations. The required computation time was 12.18seconds. The average cost of the optimal policy was found to be 44.67. In Table 2
                         we present, for each customer j
                        =1,…,7, the critical numbers s
                        1j
                        (z
                        1), 0⩽
                        z
                        1
                        ⩽8, s
                        2j
                        (r), −8⩽
                        r
                        ⩽−1, r
                        
                           j
                        , q
                        
                           j
                         that correspond to the average-cost optimal policy.

From Table 2 we observe that Parts (i) and (iv) of Theorem 1 are confirmed numerically since for j
                        ∈{1,…,7}, s
                        1j
                         (z
                        1), 0⩽
                        z
                        1
                        ⩽8, and s
                        2j
                         (r), −8⩽
                        r
                        ⩽−1, are non-increasing in z
                        1 and r, respectively. In Figs. 5 and 6
                        
                         we present the optimal decision for each state (z
                        1, r), ∣z
                        1∣⩽8, ∣r∣⩽8, z
                        1
                        +
                        r
                        ⩽8, after the first visit to customer 6 and customer 7, respectively.

The value iteration algorithm enables us to determine the optimal quantity of product 1 that is loaded in the vehicle when it returns to the depot. For example, at the state (j, z
                        1, r)=(6,3,−8) the optimal decision is to go to the depot to unload, return to customer 6 in order to pick up the remaining 8 old items, make a second trip to the depot, unload the old items, restock with 7 new items and go to customer 7. If the state is (j, z
                        1, r)=(7,−3,0), the optimal decision is to go to the depot, unload any returned items, restock with 5 new items, return to customer 7 to deliver the owed quantity (3 items) and proceed to customer 1.

@&#CONCLUSIONS@&#

In this paper we studied a simple capacitated vehicle routing problem with pick up and delivery. It was assumed that a single vehicle delivers to and collects K different products from N clients according to a particular order. There is no distinction between delivery and pick-up customers. Each customer demands a random quantity of new or fresh products and gives a random quantity of old or expired products. The actual values of these quantities are revealed only when the vehicle visits the client’s site. The items of all products are stored in the single compartment of the vehicle and are of the same size. For example, the vehicle delivers identical packages that contain new products and collect empty packages. Another example could be the supply of the stores of a particular area with many kinds of fresh milk according to a particular order. When the vehicle visits each store it pickups bottles with expired milk and delivers bottles with fresh milk. The vehicle may interrupt its route to return to the depot in order to empty the returned items, restock with new ones and then resume its route. The objective was to minimize the total expected cost for the service of all customers. We chose as decision epochs, the epochs at which the vehicle visits for the first time each client and has satisfied as much of his demands for new products as possible and has collected the largest possible quantity of the old products. This choice of the decision epochs together with the assumption that the customers are serviced according to a particular order enabled us for all possible states of the process to give suitable dynamic programming equations for the determination of the optimal policy. We showed that the optimal policy has a particular threshold-type structure. In view of this result, we developed a special-purpose dynamic programming algorithm that determines the optimal policy and is considerably faster than the initial dynamic programming algorithm.

We also considered a corresponding infinite-horizon problem in which the service of the customers is not completed as soon as the last customer has been serviced, but it continues periodically with the same service order. For each customer the demands for new products and the quantity that is collected are renewed in each cycle and follow the same joint distribution. The decision epochs are again the epochs at which the vehicle arrives at a customer’s site for the first time and has delivered as much new products as possible and has collected as much old products as possible. It was assumed that the times between decision epochs are equal. Using standard techniques from Markov decision processes it was proved that the discounted-cost optimal policy and the average-cost optimal policy have the same threshold-type structure as the finite-horizon optimal policy.

@&#ACKNOWLEDGMENTS@&#

We would like to thank Dimosthenis Drivaliaris, Ioannis Minis and Christos Tarantilis for useful discussions.

@&#REFERENCES@&#

