@&#MAIN-TITLE@&#A global energy optimization framework for 2.1D sketch extraction from monocular images

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           We model a layered image representation using a 2.1D sketch.


                        
                        
                           
                           A global energy framework is proposed to solve the conflict of local hints.


                        
                        
                           
                           A hybrid evolution algorithm is used to solve the global optimization problem.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

2.1D sketch

Global optimization

Local features

Hybrid differential evolution

@&#ABSTRACT@&#


               
               
                  The 2.1D sketch is a layered image representation, which assigns a partial depth ordering of over-segmented regions in a monocular image. This paper presents a global optimization framework for inferring the 2.1D sketch from a monocular image. Our method only uses over-segmented image regions (i.e., superpixels) as input, without any information of objects in the image, since (1) segmenting objects in images is a difficult problem on its own and (2) the objective of our proposed method is to be generic as an initial module useful for downstream high-level vision tasks. This paper formulates the inference of the 2.1D sketch using a global energy optimization framework. The proposed energy function consists of two components: (1) one is defined based on the local partial ordering relations (i.e., figure-ground) between two adjacent over-segmented regions, which captures the marginal information of the global partial depth ordering and (2) the other is defined based on the same depth layer relations among all the over-segmented regions, which groups regions of the same object to account for the over-segmentation issues. A hybrid evolution algorithm is utilized to minimize the global energy function efficiently. In experiments, we evaluated our method on a test data set containing 100 diverse real images from Berkeley segmentation data set (BSDS500) with the annotated ground truth. Experimental results show that our method can infer the 2.1D sketch with high accuracy.
               
            

@&#INTRODUCTION@&#

The 2.1D sketch is a decomposition of an image domain into overlapping regions ordered by occlusion. An illustrative example is shown in Fig. 1
                     , in which the 2.1D sketch of a domain D is a set of four overlapped regions 
                        
                           
                              
                                 R
                              
                              
                                 1
                              
                           
                           ,
                           
                              
                                 R
                              
                              
                                 2
                              
                           
                           ,
                           
                              
                                 R
                              
                              
                                 3
                              
                           
                           ,
                           
                              
                                 R
                              
                              
                                 4
                              
                           
                        
                     , satisfying 
                        
                           
                              
                                 R
                              
                              
                                 1
                              
                           
                           ∪
                           
                              
                                 R
                              
                              
                                 2
                              
                           
                           ∪
                           
                              
                                 R
                              
                              
                                 3
                              
                           
                           ∪
                           
                              
                                 R
                              
                              
                                 4
                              
                           
                           =
                           D
                        
                     , and there is a partial depth ordering 
                        
                           ≻
                        
                      on these regions, 
                        
                           
                              
                                 R
                              
                              
                                 1
                              
                           
                           ≻
                           
                              
                                 R
                              
                              
                                 2
                              
                           
                           ≻
                           
                              
                                 R
                              
                              
                                 3
                              
                           
                           ≻
                           
                              
                                 R
                              
                              
                                 4
                              
                           
                        
                     , where 
                        
                           
                              
                                 R
                              
                              
                                 i
                              
                           
                           ≻
                           
                              
                                 R
                              
                              
                                 j
                              
                           
                        
                      means 
                        
                           
                              
                                 R
                              
                              
                                 i
                              
                           
                        
                      is in front of 
                        
                           
                              
                                 R
                              
                              
                                 j
                              
                           
                        
                     . The 2.1D sketch was first proposed by Nitzberg et al. [1,2], and was also called layered image representation by Adelson [3–5] for image coding and motion analysis. The goal of the 2.1D sketch is, on one hand, to recover the partial layer ordering of regions in an input image, and on the other hand, to keep multiple reasonable and distinct solutions accounting for the intrinsic ambiguity caused by occlusion. Solving the 2.1D sketch is a critical step for scene understanding and other high-level vision tasks in both still image and video, such as foreground/background separation, depth estimation from a single image (also called 2.5D sketch), image and video coding, motion analysis, etc. It remains a very challenging problem in the vision literature.

This paper presents a global energy optimization method for inferring the 2.1D sketch from a monocular real image. Fig. 2
                      shows a real example. The 2D image regions in Fig. 2(b) are computed by some off-the-shelf multi-scale low-level segmentation algorithms (e.g., the Berkeley multi-scale segmentation algorithm, called gPb-owt-ucm in [6], is used in our experiments). The reason that we adopt the over-segmented 2D image regions as input is to recover the underlying latent objects in the 2.1D sketch. In this paper, we focus on inferring the partial depth ordering of objects (Figs. 2(c) and (d)) using the low-level segmented image regions as input (i.e., without resorting to the object information). We do not address the occluded contour completion problem. Meanwhile, we formulate the inference problem under an global energy optimization framework and therefore do not account for the multiple plausible solutions of the 2.1D sketch.

Inferring the partial depth ordering of a set of image regions belongs to the well-known tournament problem [7] which is known to be a NP-hard and APX-hard problem in general. In the tournament problem, the objective is to rank n elements (i.e., the image regions in this paper) using some transitive properties (i.e., the depth of image regions from the observer) and some successive pairwise comparisons (i.e., the marginal information of the globally consistent partial depth ordering). To address this issue, in this paper we propose a global energy optimization framework to model the 2.1D sketch, which leads to a nonlinear optimization in inference, and we utilize a hybrid evolution algorithm to solve it.

@&#RELATED WORK@&#

In the vision literature, generally speaking, the 2.1D sketch problem or layered representation has been discussed from a variety of perspectives, such as line drawing interpretations [9,10], depth segmentation [11,12], occlusion recovery [13,14], contour illusory and completion [15,16] and foreground/background separation [17,18].

Nitzberg and Mumford [2] formulated the 2.1D sketch problem as an energy minimization problem defined similarly to the Mumford–Shah energy function. Their algorithm proceeded in a three-step procedure: (1) finding edges and T-junctions, (2) hypothesizing continuations, and (3) minimizing the defined energy function combinatorially with the constraints related to the edges and continuations. Only the third step was implemented in [2]. For the second step, a set of continuous curves by smoothly connecting disjoint contour segments are required for contour integrals in the energy function. This corresponds to the occluded contour completion problem which is itself a difficult problem. So the method in [2] can only handle simple synthesized images. Adelson [3] proposed the concept of layered representation for image coding and motion analysis. Since then, there has been limited work on the 2.1D sketch problem with limited progress being achieved, especially on the problem of inferring a 2.1D sketch from real images. A quadratic objective function was designed in [19] to incorporate ordering hints from T-junctions and the discontinuities at image contours for 2.1D sketch extraction. However, it was still unclear how to incorporate other local features such as saliency, color and textures used in this paper. For a special type of image texture that is formed by spatial repetition of a large number of texels, an unsupervised extraction method for 2.1D textures was proposed in [20]. In [21] a set of local cues, including semantics, positions, compactness, shared boundaries and junctions, were used in an Adaboost prediction of corresponding occlusions. In this paper, we deal with 2.1D sketches extracted from more general natural images and propose a unified global framework to solve the potential confliction of local cues.

2.1D sketch can find a wide range of applications including figure/ground segregation, image segmentation, image editing and objects’ partial retrieval. By following the energy function for 2.1D sketch extraction defined in [2], Esedoglu and March [11] proposed to segment an image with depth but without detecting junctions, using a variational formulation technique. Ren et al. [17] presented a method for figure/ground assignment according to local image evidence learned in a Markov random field (MRF) model. Yu et al. [18] proposed a model for figure/ground segregation based on a hierarchical MRF, using clique potentials in the MRF to encode local logical decision rules and demonstrating a system that automatically integrates sparse local relative depth cues arising from T-junctions over long distances into a global ordering of relative depths. Wang et al. [16] used some shape priors (e.g., templates for objects) to do partitioning based on the Swendsen-Wang cuts algorithm for integration of region-based and curve-based segmentation. Recently Hoiem et al. [15] proposed a method for recovering occlusion boundaries by learning a conditional random field (CRF) model. Gao et al. [22] proposed a mixed random field formulation with a hierarchical graphical model for the 2.1D sketch. The graphical model [23] extracted from 2.1D sketches can also be used in a conceptual design process [24]. An image editing method was proposed in [25] by detecting and rearranging repeated scene elements, which utilized a partial depth ordering of overlapping repeated elements. By projecting a 3D object into a set of planes determined by optimal viewpoints [26], the 2.1D sketches can also be used for partial retrieval of both 2D shapes [27,28] and 3D objects [29].

In this paper we make the following contributions for inferring the 2.1D sketch from a monocular image:
                        
                           •
                           We present a generic energy function for modeling and computing the 2.1D sketch which can leverage different features (local and global) extracted from 2D image regions.

Our method can serve as a universal framework for computing the 2.1D sketch of both simple artificial images and complex natural images. As a comparison, previous work [22,2] can only handle simple or synthetic images.

Given an input image, we first compute the over-segmented 2D regions using the gPb-owt-ucm algorithm in [6], and extract the local features (Section 4) in these regions for inferring (1) the local figure-ground relations and (2) the same depth layer relations. For example, in Fig. 1(b), the over-segmented regions 2 and 3 are in the figure-ground relation and the over-segmented regions 1, 3 and 4 are in the same depth layer relation. We pose the inference problem under the energy optimization framework (Section 5). The energy function consists of two parts: (1) one is defined based on the local partial ordering relations (i.e., figure/ground) between two adjacent over-segmented regions, which capture the marginal information of the global partial depth ordering, and (2) the other is defined based on the same depth layer relations among all the over-segmented regions, which groups regions belonging to the same object to account for the over-segmentation issues. Once the energy function is minimized by an efficient hybrid evolution algorithm, the optimal 2.1D sketch is obtained.

Given an over-segmented image computed by the algorithm in [6], the local features introduced in this section only consider the local relations among over-segmented regions.

We use the following two local relations abbreviated as F–G and SL. The F–G (figure–ground) relation is referred to as that two adjacent over-segmented regions do not belong to the same layer in the 2.1D sketch, and thus we need to determine which is foreground and which is background. The SL (same layer) relation is referred to as that two over-segmented relations have the same depth, and thus they need to be combined into one layer. To compute the 2.1D sketch, we first need to combine over-segmented regions with SL relations, and then we need to compute the partial depth order of the remaining regions with F–G relations.

In this study we use three F–G relations, i.e., T-junction, boundary and saliency features.

T-junctions are significant local visual cues to analyze the depth relation between partially overlapped regions, which were used in [19,2] without implementation details. In this paper we use the following simple strategy. As illustrated in Fig. 3
                           , we extract all boundary segments of over-segmented regions and build a graph 
                              
                                 G
                                 =
                                 (
                                 V
                                 ,
                                 E
                                 )
                              
                           , where the node 
                              
                                 
                                    
                                       v
                                    
                                    
                                       r
                                    
                                 
                                 ∈
                                 V
                              
                            is the intersection point of three distinct boundary segments, i.e., 
                              
                                 
                                    
                                       v
                                    
                                    
                                       r
                                    
                                 
                                 =
                                 ∂
                                 
                                    
                                       S
                                    
                                    
                                       i
                                    
                                 
                                 ∩
                                 ∂
                                 
                                    
                                       S
                                    
                                    
                                       j
                                    
                                 
                                 ∩
                                 ∂
                                 
                                    
                                       S
                                    
                                    
                                       k
                                    
                                 
                                 ,
                                 i
                                 
                                 ≠
                                 
                                 j
                                 
                                 ≠
                                 
                                 k
                              
                           , and 
                              
                                 ∂
                                 
                                    
                                       S
                                    
                                    
                                       i
                                    
                                 
                              
                            is the boundary of segment 
                              
                                 
                                    
                                       S
                                    
                                    
                                       i
                                    
                                 
                              
                           . The edges 
                              
                                 
                                    
                                       e
                                    
                                    
                                       s
                                    
                                 
                                 ∈
                                 E
                              
                            are region boundaries separated by the nodes, i.e., 
                              
                                 
                                    
                                       ⋃
                                    
                                    
                                       
                                          
                                             e
                                          
                                          
                                             s
                                          
                                       
                                       ∈
                                       E
                                    
                                 
                                 
                                    
                                       e
                                    
                                    
                                       s
                                    
                                 
                                 =
                                 (
                                 
                                    
                                       ⋃
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       S
                                    
                                    
                                       i
                                    
                                 
                                 )
                                 ⧹
                                 (
                                 
                                    
                                       ⋃
                                    
                                    
                                       
                                          
                                             v
                                          
                                          
                                             r
                                          
                                       
                                       ∈
                                       V
                                    
                                 
                                 
                                    
                                       v
                                    
                                    
                                       r
                                    
                                 
                                 )
                              
                           . Each non-degenerate nodes in G corresponds to a T-junction feature. The depth relation locally around the T-junction is that, the cap of the T-junction is closer to the observer than the regions indicated by the stem of the T-junction.

We use a matrix T to represent all the T-junction features:
                              
                                 (1)
                                 
                                    
                                       
                                          T
                                       
                                       
                                          m
                                          ×
                                          tnum
                                       
                                    
                                    =
                                    [
                                    
                                       
                                          t
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       
                                          t
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       
                                          t
                                       
                                       
                                          tnum
                                       
                                    
                                    ]
                                 
                              
                           where m is the number of over-segmented regions, tnum is the total number of T-junctions and each 
                              
                                 
                                    
                                       t
                                    
                                    
                                       i
                                    
                                 
                              
                            is a 
                              
                                 m
                                 ×
                                 1
                              
                            vector which represents the information of ith T-junctions, i.e., the jth element in 
                              
                                 
                                    
                                       t
                                    
                                    
                                       i
                                    
                                 
                              
                            satisfies:
                              
                                 (2)
                                 
                                    
                                       
                                          t
                                       
                                       
                                          i
                                       
                                    
                                    (
                                    j
                                    )
                                    =
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      -
                                                      2
                                                   
                                                   
                                                      if
                                                      
                                                      j
                                                      =
                                                      cap
                                                      (
                                                      i
                                                      )
                                                   
                                                
                                                
                                                   
                                                      1
                                                   
                                                   
                                                      if
                                                      
                                                      j
                                                      =
                                                      stem
                                                      (
                                                      i
                                                      )
                                                   
                                                
                                                
                                                   
                                                      0
                                                   
                                                   
                                                      otherwise
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           where 
                              
                                 cap
                                 (
                                 i
                                 )
                              
                            returns the region ID of the cap of the ith T-junction and 
                              
                                 stem
                                 (
                                 i
                                 )
                              
                            returns the regions IDs (there are two regions belongs to the stem) of the stem of the ith T-junction.

For each edge 
                              
                                 
                                    
                                       e
                                    
                                    
                                       i
                                    
                                 
                                 ∈
                                 E
                              
                            in the graph G, we compute a boundary feature 
                              
                                 
                                    
                                       b
                                    
                                    
                                       i
                                    
                                 
                              
                            as proposed in [30]. We also use a matrix B to represent all the boundary features:
                              
                                 (3)
                                 
                                    
                                       
                                          B
                                       
                                       
                                          m
                                          ×
                                          bnum
                                       
                                    
                                    =
                                    [
                                    
                                       
                                          b
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       
                                          b
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       
                                          b
                                       
                                       
                                          bnum
                                       
                                    
                                    ]
                                 
                              
                           where m is the number of over-segmented regions, bnum is the total number of boundary edges in G and each 
                              
                                 
                                    
                                       b
                                    
                                    
                                       i
                                    
                                 
                              
                            is a 
                              
                                 m
                                 ×
                                 1
                              
                            vector whose jth element satisfies:
                              
                                 (4)
                                 
                                    
                                       
                                          b
                                       
                                       
                                          i
                                       
                                    
                                    (
                                    j
                                    )
                                    =
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      -
                                                      1
                                                   
                                                   
                                                      if
                                                      
                                                      j
                                                      =
                                                      bfigure
                                                      (
                                                      i
                                                      )
                                                   
                                                
                                                
                                                   
                                                      1
                                                   
                                                   
                                                      if
                                                      
                                                      j
                                                      =
                                                      bground
                                                      (
                                                      i
                                                      )
                                                   
                                                
                                                
                                                   
                                                      0
                                                   
                                                   
                                                      otherwise
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           where 
                              
                                 bfigure
                                 (
                                 i
                                 )
                              
                            and 
                              
                                 bground
                                 (
                                 i
                                 )
                              
                            returns respectively the region IDs of the figure (closer to observer) and ground (farther to observer) judged by the ith boundary feature using the method proposed in [30].

In most cases, salient regions have high possibility to be the figure regions, especially in the images where a single salient object exists. We compute the saliency for each over-segmented regions using the method proposed in [31] with an improvement of using soft image abstraction [32]. We use a matrix S to represent all the saliency features:
                              
                                 (5)
                                 
                                    
                                       
                                          S
                                       
                                       
                                          m
                                          ×
                                          snum
                                       
                                    
                                    =
                                    [
                                    
                                       
                                          s
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       
                                          s
                                       
                                       
                                          snum
                                       
                                    
                                    ]
                                 
                              
                           where m is the number of over-segmented regions, snum is the number of all F–G relations judged by saliency features and each 
                              
                                 
                                    
                                       s
                                    
                                    
                                       i
                                    
                                 
                              
                            is a 
                              
                                 m
                                 ×
                                 1
                              
                            vector whose jth element satisfies:
                              
                                 (6)
                                 
                                    
                                       
                                          s
                                       
                                       
                                          i
                                       
                                    
                                    (
                                    j
                                    )
                                    =
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      -
                                                      1
                                                   
                                                   
                                                      if
                                                      
                                                      j
                                                      =
                                                      sfigure
                                                      (
                                                      i
                                                      )
                                                   
                                                
                                                
                                                   
                                                      1
                                                   
                                                   
                                                      if
                                                      
                                                      j
                                                      =
                                                      sground
                                                      (
                                                      i
                                                      )
                                                   
                                                
                                                
                                                   
                                                      0
                                                   
                                                   
                                                      otherwise
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           where 
                              
                                 sfigure
                                 (
                                 i
                                 )
                              
                            and 
                              
                                 sground
                                 (
                                 i
                                 )
                              
                            returns respectively the region IDs of the figure and ground judged by the ith saliency feature.

We use the following three SL relations, i.e., color, texture and hierarchical features.

Since the image domain is over-segmented, if two adjacent regions have similar colors, we regard that they locally have a SL relation. We use the HSL color space; i.e., if the mean color vectors 
                              
                                 HSL
                                 (
                                 p
                                 )
                                 =
                                 (
                                 
                                    
                                       h
                                    
                                    
                                       p
                                    
                                 
                                 ,
                                 
                                    
                                       s
                                    
                                    
                                       p
                                    
                                 
                                 ,
                                 
                                    
                                       l
                                    
                                    
                                       p
                                    
                                 
                                 )
                              
                            and 
                              
                                 HSL
                                 (
                                 q
                                 )
                                 =
                                 (
                                 
                                    
                                       h
                                    
                                    
                                       q
                                    
                                 
                                 ,
                                 
                                    
                                       s
                                    
                                    
                                       q
                                    
                                 
                                 ,
                                 
                                    
                                       l
                                    
                                    
                                       q
                                    
                                 
                                 )
                              
                            of two adjacent regions p and q satisfy
                              
                                 (7)
                                 
                                    ‖
                                    HSL
                                    (
                                    p
                                    )
                                    -
                                    HSL
                                    (
                                    q
                                    )
                                    
                                       
                                          ‖
                                       
                                       
                                          2
                                       
                                    
                                    <
                                    disc
                                 
                              
                           where 
                              
                                 ‖
                                 ·
                                 ‖
                              
                            is Euclidean 2-norm and 
                              
                                 
                                    
                                       dis
                                    
                                    
                                       c
                                    
                                 
                              
                            is a small threshold, an SL relation is set to these two regions. We use a matrix C to represent all the color features:
                              
                                 (8)
                                 
                                    
                                       
                                          C
                                       
                                       
                                          m
                                          ×
                                          cnum
                                       
                                    
                                    =
                                    [
                                    
                                       
                                          c
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       
                                          c
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       
                                          c
                                       
                                       
                                          cnum
                                       
                                    
                                    ]
                                 
                              
                           where m is the number of over-segmented regions, cnum is the number of all the SL relations judged by color features and each 
                              
                                 
                                    
                                       c
                                    
                                    
                                       i
                                    
                                 
                              
                            is a 
                              
                                 m
                                 ×
                                 1
                              
                            vector whose jth element satisfies:
                              
                                 (9)
                                 
                                    
                                       
                                          c
                                       
                                       
                                          i
                                       
                                    
                                    (
                                    j
                                    )
                                    =
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      -
                                                      1
                                                   
                                                   
                                                      if
                                                      
                                                      j
                                                      =
                                                      
                                                         
                                                            CSL
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      (
                                                      i
                                                      )
                                                   
                                                
                                                
                                                   
                                                      1
                                                   
                                                   
                                                      if
                                                      
                                                      j
                                                      =
                                                      
                                                         
                                                            CSL
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      (
                                                      i
                                                      )
                                                   
                                                
                                                
                                                   
                                                      0
                                                   
                                                   
                                                      otherwise
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           where 
                              
                                 
                                    
                                       CSL
                                    
                                    
                                       1
                                    
                                 
                                 (
                                 i
                                 )
                              
                            and 
                              
                                 
                                    
                                       CSL
                                    
                                    
                                       2
                                    
                                 
                                 (
                                 i
                                 )
                              
                            return the IDs of two regions which are in a SL relation judged by the ith color feature. The order of 
                              
                                 
                                    
                                       CSL
                                    
                                    
                                       1
                                    
                                 
                                 (
                                 i
                                 )
                              
                            and 
                              
                                 
                                    
                                       CSL
                                    
                                    
                                       2
                                    
                                 
                                 (
                                 i
                                 )
                              
                            does not affect the result.

Since the color features have been considered in Eq. (18), we construct the texture features using the gray level of the image 
                              
                                 I
                                 (
                                 x
                                 ,
                                 y
                                 )
                              
                           . Let 
                              
                                 (
                                 x
                                 ,
                                 y
                                 )
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       i
                                    
                                 
                              
                            be all the pixels belonging to the region 
                              
                                 
                                    
                                       R
                                    
                                    
                                       i
                                    
                                 
                              
                           , and 
                              
                                 
                                    
                                       w
                                    
                                    
                                       i
                                    
                                 
                              
                            and 
                              
                                 
                                    
                                       h
                                    
                                    
                                       i
                                    
                                 
                              
                            be the width and height of 
                              
                                 
                                    
                                       R
                                    
                                    
                                       i
                                    
                                 
                              
                           . We use the following scale image features [33–35] for defining the texture feature of 
                              
                                 
                                    
                                       R
                                    
                                    
                                       i
                                    
                                 
                              
                           :
                              
                                 •
                                 Angular second-moment feature 
                                       
                                          
                                             
                                                a
                                             
                                             
                                                i
                                             
                                          
                                       
                                    :
                                       
                                          (10)
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   i
                                                
                                             
                                             =
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      (
                                                      x
                                                      ,
                                                      y
                                                      )
                                                      ∈
                                                      
                                                         
                                                            R
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   I
                                                
                                                
                                                   2
                                                
                                             
                                             (
                                             x
                                             ,
                                             
                                             y
                                             )
                                          
                                       
                                    
                                 

Contrast feature 
                                       
                                          
                                             
                                                c
                                             
                                             
                                                i
                                             
                                          
                                       
                                    :
                                       
                                          (11)
                                          
                                             
                                                
                                                   c
                                                
                                                
                                                   i
                                                
                                             
                                             =
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      k
                                                      =
                                                      1
                                                   
                                                   
                                                      max
                                                      {
                                                      
                                                         
                                                            w
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            h
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      }
                                                   
                                                
                                             
                                             
                                                
                                                   k
                                                
                                                
                                                   2
                                                
                                             
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      |
                                                      x
                                                      -
                                                      y
                                                      |
                                                      =
                                                      k
                                                      ,
                                                      (
                                                      x
                                                      ,
                                                      y
                                                      )
                                                      ∈
                                                      
                                                         
                                                            R
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                   
                                                
                                             
                                             I
                                             (
                                             x
                                             ,
                                             
                                             y
                                             )
                                          
                                       
                                    
                                 

Inverse different moment feature 
                                       
                                          
                                             
                                                i
                                             
                                             
                                                i
                                             
                                          
                                       
                                    :
                                       
                                          (12)
                                          
                                             
                                                
                                                   i
                                                
                                                
                                                   i
                                                
                                             
                                             =
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      (
                                                      x
                                                      ,
                                                      y
                                                      )
                                                      ∈
                                                      
                                                         
                                                            R
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   I
                                                   (
                                                   x
                                                   ,
                                                   y
                                                   )
                                                
                                                
                                                   1
                                                   +
                                                   
                                                      
                                                         (
                                                         x
                                                         -
                                                         y
                                                         )
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 

Entropy feature 
                                       
                                          
                                             
                                                e
                                             
                                             
                                                i
                                             
                                          
                                       
                                    :
                                       
                                          (13)
                                          
                                             
                                                
                                                   e
                                                
                                                
                                                   i
                                                
                                             
                                             =
                                             -
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      (
                                                      x
                                                      ,
                                                      y
                                                      )
                                                      ∈
                                                      
                                                         
                                                            R
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                   
                                                
                                             
                                             I
                                             (
                                             x
                                             ,
                                             y
                                             )
                                             log
                                             I
                                             (
                                             x
                                             ,
                                             y
                                             )
                                          
                                       
                                    
                                 

Correlation feature 
                                       
                                          
                                             
                                                cor
                                             
                                             
                                                i
                                             
                                          
                                       
                                    :
                                       
                                          (14)
                                          
                                             
                                                
                                                   cor
                                                
                                                
                                                   i
                                                
                                             
                                             =
                                             -
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      (
                                                      x
                                                      ,
                                                      y
                                                      )
                                                      ∈
                                                      
                                                         
                                                            R
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   xyI
                                                   (
                                                   x
                                                   ,
                                                   y
                                                   )
                                                   -
                                                   
                                                      
                                                         u
                                                      
                                                      
                                                         x
                                                      
                                                   
                                                   
                                                      
                                                         u
                                                      
                                                      
                                                         y
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         s
                                                      
                                                      
                                                         x
                                                      
                                                   
                                                   
                                                      
                                                         s
                                                      
                                                      
                                                         y
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    where
                                       
                                          (15)
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            u
                                                         
                                                         
                                                            x
                                                         
                                                      
                                                      =
                                                      
                                                         
                                                            
                                                               ∑
                                                            
                                                            
                                                               (
                                                               x
                                                               ,
                                                               y
                                                               )
                                                               ∈
                                                               
                                                                  
                                                                     R
                                                                  
                                                                  
                                                                     i
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                      xI
                                                      (
                                                      x
                                                      ,
                                                      y
                                                      )
                                                      ,
                                                      
                                                      
                                                      
                                                         
                                                            u
                                                         
                                                         
                                                            y
                                                         
                                                      
                                                      =
                                                      
                                                         
                                                            
                                                               ∑
                                                            
                                                            
                                                               (
                                                               x
                                                               ,
                                                               y
                                                               )
                                                               ∈
                                                               
                                                                  
                                                                     R
                                                                  
                                                                  
                                                                     i
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                      yI
                                                      (
                                                      x
                                                      ,
                                                      y
                                                      )
                                                      ,
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            s
                                                         
                                                         
                                                            x
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      =
                                                      
                                                         
                                                            
                                                               ∑
                                                            
                                                            
                                                               (
                                                               x
                                                               ,
                                                               y
                                                               )
                                                               ∈
                                                               
                                                                  
                                                                     R
                                                                  
                                                                  
                                                                     i
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                      I
                                                      (
                                                      x
                                                      ,
                                                      y
                                                      )
                                                      
                                                         
                                                            (
                                                            x
                                                            -
                                                            
                                                               
                                                                  u
                                                               
                                                               
                                                                  x
                                                               
                                                            
                                                            )
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      ,
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            s
                                                         
                                                         
                                                            y
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      =
                                                      
                                                         
                                                            
                                                               ∑
                                                            
                                                            
                                                               (
                                                               x
                                                               ,
                                                               y
                                                               )
                                                               ∈
                                                               
                                                                  
                                                                     R
                                                                  
                                                                  
                                                                     i
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                      I
                                                      (
                                                      x
                                                      ,
                                                      y
                                                      )
                                                      
                                                         
                                                            (
                                                            y
                                                            -
                                                            
                                                               
                                                                  u
                                                               
                                                               
                                                                  y
                                                               
                                                            
                                                            )
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 

We take four scanning directions (up–down, left–right and two diagonals) and assemble all the scale image features into a normalized texture vector:
                              
                                 (16)
                                 
                                    
                                       
                                          tv
                                       
                                       
                                          i
                                       
                                    
                                    =
                                    (
                                    
                                       
                                          a
                                       
                                       
                                          i
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    
                                       
                                          c
                                       
                                       
                                          i
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    
                                       
                                          i
                                       
                                       
                                          i
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    
                                       
                                          e
                                       
                                       
                                          i
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    
                                       
                                          cor
                                       
                                       
                                          i
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       
                                          a
                                       
                                       
                                          i
                                       
                                       
                                          4
                                       
                                    
                                    ,
                                    
                                       
                                          c
                                       
                                       
                                          i
                                       
                                       
                                          4
                                       
                                    
                                    ,
                                    
                                       
                                          i
                                       
                                       
                                          i
                                       
                                       
                                          4
                                       
                                    
                                    ,
                                    
                                       
                                          e
                                       
                                       
                                          i
                                       
                                       
                                          4
                                       
                                    
                                    ,
                                    
                                       
                                          cor
                                       
                                       
                                          i
                                       
                                       
                                          4
                                       
                                    
                                    )
                                 
                              
                           
                        

We infer locally that two regions p and q have the SL relations if they satisfy:
                              
                                 (17)
                                 
                                    ‖
                                    
                                       
                                          tv
                                       
                                       
                                          p
                                       
                                    
                                    -
                                    
                                       
                                          tv
                                       
                                       
                                          q
                                       
                                    
                                    
                                       
                                          ‖
                                       
                                       
                                          2
                                       
                                    
                                    <
                                    dist
                                 
                              
                           where 
                              
                                 ‖
                                 ·
                                 ‖
                              
                            is Euclidean 2-norm and dist is a small threshold. We use a matrix X to represent all the texture features:
                              
                                 (18)
                                 
                                    
                                       
                                          X
                                       
                                       
                                          m
                                          ×
                                          texnum
                                       
                                    
                                    =
                                    [
                                    
                                       
                                          x
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       
                                          x
                                       
                                       
                                          texnum
                                       
                                    
                                    ]
                                 
                              
                           where m is the number of over-segmented regions, texnum is the number of all SL relations judged by texture features and each 
                              
                                 
                                    
                                       x
                                    
                                    
                                       i
                                    
                                 
                              
                            is a 
                              
                                 m
                                 ×
                                 1
                              
                            vector whose jth element satisfies:
                              
                                 (19)
                                 
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    (
                                    j
                                    )
                                    =
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      -
                                                      1
                                                   
                                                   
                                                      if
                                                      
                                                      j
                                                      =
                                                      
                                                         
                                                            TSL
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                      (
                                                      i
                                                      )
                                                   
                                                
                                                
                                                   
                                                      1
                                                   
                                                   
                                                      if
                                                      
                                                      j
                                                      =
                                                      
                                                         
                                                            TSL
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                      (
                                                      i
                                                      )
                                                   
                                                
                                                
                                                   
                                                      0
                                                   
                                                   
                                                      otherwise
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           where 
                              
                                 
                                    
                                       TSL
                                    
                                    
                                       1
                                    
                                 
                                 (
                                 i
                                 )
                              
                            and 
                              
                                 
                                    
                                       TSL
                                    
                                    
                                       2
                                    
                                 
                                 (
                                 i
                                 )
                              
                            return the IDs of two regions which are in a SL relation judged by the ith texture feature. The order of 
                              
                                 
                                    
                                       TSL
                                    
                                    
                                       1
                                    
                                 
                                 (
                                 i
                                 )
                              
                            and 
                              
                                 
                                    
                                       TSL
                                    
                                    
                                       2
                                    
                                 
                                 (
                                 i
                                 )
                              
                            does not affect the result.

State-of-the-art segmentation algorithms such as the Berkeley multi-scale segmentation algorithm [6] can provide hierarchical segmentation information. A hierarchical segmentation example is shown in Fig. 4
                           . If such hierarchical information is available, our method can make use of it for helping judge the SL relation as follows.

Let p and q be two over-segmented regions in a hierarchical segmentation tree. We compute a segmentation distance 
                              
                                 
                                    
                                       dis
                                    
                                    
                                       seg
                                    
                                 
                              
                            between p and q as:
                              
                                 (20)
                                 
                                    
                                       
                                          dis
                                       
                                       
                                          seg
                                       
                                    
                                    (
                                    p
                                    ,
                                    q
                                    )
                                    =
                                    
                                       
                                          D
                                       
                                       
                                          leaf
                                       
                                    
                                    -
                                    
                                       
                                          D
                                       
                                       
                                          ancestor
                                       
                                    
                                    (
                                    p
                                    ,
                                    q
                                    )
                                 
                              
                           where 
                              
                                 
                                    
                                       D
                                    
                                    
                                       leaf
                                    
                                 
                              
                            is the depth of the leaf nodes representing the over-segmented regions and 
                              
                                 
                                    
                                       D
                                    
                                    
                                       ancestor
                                    
                                 
                                 (
                                 p
                                 ,
                                 q
                                 )
                              
                            is the depth of the most recent common ancestor nodes of leaf nodes p and q. Our inference is based on the heuristic that if the segmentation distance is small for p and q, the oriented watershed transform value of the boundary is also small and p and q are more likely to be SL relation.

To account for the hierarchical information, we modify the judgement formula of color features and texture features by:
                              
                                 (21)
                                 
                                    ‖
                                    HSL
                                    (
                                    p
                                    )
                                    -
                                    HSL
                                    (
                                    q
                                    )
                                    
                                       
                                          ‖
                                       
                                       
                                          2
                                       
                                    
                                    <
                                    disc
                                    -
                                    
                                       
                                          λ
                                       
                                       
                                          1
                                       
                                    
                                    ·
                                    
                                       
                                          dis
                                       
                                       
                                          seg
                                       
                                    
                                    (
                                    p
                                    ,
                                    q
                                    )
                                 
                              
                           
                           
                              
                                 (22)
                                 
                                    ‖
                                    
                                       
                                          tv
                                       
                                       
                                          p
                                       
                                    
                                    -
                                    
                                       
                                          tv
                                       
                                       
                                          q
                                       
                                    
                                    
                                       
                                          ‖
                                       
                                       
                                          2
                                       
                                    
                                    <
                                    dist
                                    -
                                    
                                       
                                          λ
                                       
                                       
                                          2
                                       
                                    
                                    ·
                                    
                                       
                                          dis
                                       
                                       
                                          seg
                                       
                                    
                                    (
                                    p
                                    ,
                                    q
                                    )
                                 
                              
                           where 
                              
                                 
                                    
                                       λ
                                    
                                    
                                       1
                                    
                                 
                              
                            and 
                              
                                 
                                    
                                       λ
                                    
                                    
                                       2
                                    
                                 
                              
                            are two weighting coefficients.

There are a few parameters 
                              
                                 disc
                                 ,
                                 dist
                                 ,
                                 
                                    
                                       λ
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       λ
                                    
                                    
                                       2
                                    
                                 
                              
                            in local feature definitions and we will specify them in Section 6.

Each of the local features introduced in Section 4 infers a partial depth ordering on some over-segmented regions locally. Only using local information cannot ensure a globally consistent partial depth order and there will be some misjudgement and conflicts among the partial depth orders inferred locally. We propose below a global energy optimization framework to obtain a globally consistent partial depth order. Note that our framework is general and any local features not defined in Section 4 can be naturally incorporated into this framework.

Let 
                           
                              S
                              =
                              {
                              1
                              ,
                              2
                              ,
                              …
                              ,
                              m
                              }
                           
                         be a finite index set, where m is the number of over-segmented regions. The solution to specify a 2.1D sketch is an index set 
                           
                              D
                              =
                              {
                              
                                 
                                    d
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    d
                                 
                                 
                                    2
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    d
                                 
                                 
                                    m
                                 
                              
                              }
                           
                        , where 
                           
                              1
                              ⩽
                              
                                 
                                    d
                                 
                                 
                                    i
                                 
                              
                              ⩽
                              m
                           
                        . If there are no SL relations in m regions, D is a permutation 
                           
                              π
                           
                         of the set S, where 
                           
                              π
                           
                         is a bijective map and 
                           
                              D
                              =
                              {
                              π
                              (
                              1
                              )
                              ,
                              π
                              (
                              2
                              )
                              ,
                              …
                              ,
                              π
                              (
                              m
                              )
                              }
                           
                        .

The global energy 
                           
                              
                                 
                                    E
                                 
                                 
                                    2.1
                                    d
                                 
                              
                           
                         we define below represents the conflicts of the partial depth order inferred locally. When the value of 
                           
                              
                                 
                                    E
                                 
                                 
                                    2.1
                                    d
                                 
                              
                           
                         is minimized, the global conflict is also minimized, which leads to an optimal solution of the 2.1D sketch.

The global energy 
                           
                              
                                 
                                    E
                                 
                                 
                                    2.1
                                    d
                                 
                              
                           
                         consists of two terms, representing the F–G and SL relations respectively:
                           
                              (23)
                              
                                 
                                    
                                       E
                                    
                                    
                                       2.1
                                       d
                                    
                                 
                                 =
                                 
                                    
                                       E
                                    
                                    
                                       FG
                                    
                                 
                                 +
                                 
                                    
                                       E
                                    
                                    
                                       SL
                                    
                                 
                              
                           
                        We denote a parameterized exponential function as:
                           
                              (24)
                              
                                 E
                                 (
                                 λ
                                 ,
                                 x
                                 )
                                 =
                                 
                                    
                                       e
                                    
                                    
                                       -
                                       λ
                                       x
                                    
                                 
                              
                           
                        Then 
                           
                              
                                 
                                    E
                                 
                                 
                                    FG
                                 
                              
                           
                         is defined as:
                           
                              (25)
                              
                                 
                                    
                                       E
                                    
                                    
                                       FG
                                    
                                 
                                 =
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          1
                                       
                                       
                                          tnum
                                       
                                    
                                 
                                 E
                                 (
                                 
                                    
                                       λ
                                    
                                    
                                       t
                                    
                                 
                                 ,
                                 
                                    
                                       α
                                    
                                    
                                       i
                                    
                                 
                                 )
                                 +
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          j
                                          =
                                          1
                                       
                                       
                                          bnum
                                       
                                    
                                 
                                 E
                                 (
                                 
                                    
                                       λ
                                    
                                    
                                       b
                                    
                                 
                                 ,
                                 
                                    
                                       β
                                    
                                    
                                       j
                                    
                                 
                                 )
                                 +
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          k
                                          =
                                          1
                                       
                                       
                                          snum
                                       
                                    
                                 
                                 E
                                 (
                                 
                                    
                                       λ
                                    
                                    
                                       s
                                    
                                 
                                 ,
                                 
                                    
                                       γ
                                    
                                    
                                       k
                                    
                                 
                                 )
                              
                           
                        where 
                           
                              
                                 
                                    λ
                                 
                                 
                                    t
                                 
                              
                              >
                              0
                              ,
                              
                                 
                                    λ
                                 
                                 
                                    b
                                 
                              
                              >
                              0
                              ,
                              
                                 
                                    λ
                                 
                                 
                                    s
                                 
                              
                              >
                              0
                           
                         are three weighting coefficients whose values are specified in the next section, 
                           
                              
                                 
                                    α
                                 
                                 
                                    i
                                 
                              
                           
                         is the ith element in the m-vector 
                           
                              α
                              =
                              
                                 
                                    T
                                 
                                 
                                    T
                                 
                              
                              D
                              ,
                              
                                 
                                    β
                                 
                                 
                                    j
                                 
                              
                           
                         is the jth element in the m-vector 
                           
                              β
                              =
                              
                                 
                                    B
                                 
                                 
                                    T
                                 
                              
                              D
                              ,
                              
                                 
                                    γ
                                 
                                 
                                    k
                                 
                              
                           
                         is the kth element in the m-vector 
                           
                              γ
                              =
                              
                                 
                                    S
                                 
                                 
                                    T
                                 
                              
                              D
                           
                         and 
                           
                              T
                              ,
                              B
                              ,
                              S
                           
                         are matrices defined in Eqs. (1), (3), (5) respectively.

We note that if all the local judgements for F–G relations are correct, the values 
                           
                              
                                 
                                    α
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                                 
                                    β
                                 
                                 
                                    j
                                 
                              
                           
                         and 
                           
                              
                                 
                                    γ
                                 
                                 
                                    k
                                 
                              
                              ,
                              1
                              ⩽
                              i
                              ⩽
                              tnum
                              ,
                              1
                              ⩽
                              j
                              ⩽
                              bnum
                              ,
                              1
                              ⩽
                              k
                              ⩽
                              snum
                           
                        , are all positive and 
                           
                              
                                 
                                    E
                                 
                                 
                                    FG
                                 
                              
                           
                         reaches its minimum. To see this property, we explain it using the T-junction features for an example and the other two local (boundary and saliency) features can be explained in the same way. Assume in an image there are three regions with the partial depth ordering 
                           
                              
                                 
                                    R
                                 
                                 
                                    1
                                 
                              
                              ≻
                              
                                 
                                    R
                                 
                                 
                                    2
                                 
                              
                              ≻
                              
                                 
                                    R
                                 
                                 
                                    3
                                 
                              
                           
                        , i.e., 
                           
                              D
                              =
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   1
                                                
                                                
                                                   2
                                                
                                                
                                                   3
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                    T
                                 
                              
                           
                        . If they are judged correctly by a T-junction feature 
                           
                              
                                 
                                    t
                                 
                                 
                                    1
                                 
                              
                              =
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   -
                                                   2
                                                
                                                
                                                   1
                                                
                                                
                                                   1
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                    T
                                 
                              
                           
                        , then 
                           
                              
                                 
                                    t
                                 
                                 
                                    1
                                 
                                 
                                    T
                                 
                              
                              ·
                              D
                              =
                              3
                           
                         achieves the maximum positive value. For any incorrect judgment, e.g., 
                           
                              
                                 
                                    t
                                 
                                 
                                    1
                                 
                                 
                                    ′
                                 
                              
                              =
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   1
                                                
                                                
                                                   -
                                                   2
                                                
                                                
                                                   1
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                    T
                                 
                              
                              ,
                              
                                 
                                    t
                                 
                                 
                                    1
                                 
                                 
                                    ′
                                    T
                                 
                              
                              ·
                              D
                              =
                              0
                              <
                              
                                 
                                    t
                                 
                                 
                                    1
                                 
                                 
                                    T
                                 
                              
                              ·
                              D
                           
                        . Given any 
                           
                              
                                 
                                    λ
                                 
                                 
                                    t
                                 
                              
                              >
                              0
                              ,
                              E
                              (
                              
                                 
                                    λ
                                 
                                 
                                    t
                                 
                              
                              ,
                              
                                 
                                    t
                                 
                                 
                                    1
                                 
                                 
                                    T
                                 
                              
                              ·
                              D
                              )
                           
                         achieves the minimum value.

Since local judgments by different local features may have conflicts, the function 
                           
                              E
                              (
                              λ
                              ,
                              x
                              )
                           
                         plays a role of penalties for the wrong judgment of F–G relations and the minimum value of 
                           
                              
                                 
                                    E
                                 
                                 
                                    FG
                                 
                              
                           
                         corresponds a global optimal solution to the F–G relations.

Denote an absolute version of a m-vector r by 
                           
                              |
                              r
                              |
                              =
                              (
                              |
                              
                                 
                                    r
                                 
                                 
                                    1
                                 
                              
                              |
                              
                              
                              |
                              
                                 
                                    r
                                 
                                 
                                    2
                                 
                              
                              |
                              
                              ⋯
                              
                              |
                              
                                 
                                    r
                                 
                                 
                                    m
                                 
                              
                              |
                              )
                           
                        . The 
                           
                              
                                 
                                    E
                                 
                                 
                                    SL
                                 
                              
                           
                         in Eq. (23) is defined as:
                           
                              (26)
                              
                                 
                                    
                                       E
                                    
                                    
                                       SL
                                    
                                 
                                 =
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          u
                                          =
                                          1
                                       
                                       
                                          cnum
                                       
                                    
                                 
                                 E
                                 (
                                 -
                                 
                                    
                                       λ
                                    
                                    
                                       c
                                    
                                 
                                 ,
                                 
                                    
                                       ζ
                                    
                                    
                                       u
                                    
                                 
                                 )
                                 +
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          v
                                          =
                                          1
                                       
                                       
                                          texnum
                                       
                                    
                                 
                                 E
                                 (
                                 -
                                 
                                    
                                       λ
                                    
                                    
                                       tex
                                    
                                 
                                 ,
                                 
                                    
                                       η
                                    
                                    
                                       v
                                    
                                 
                                 )
                              
                           
                        where 
                           
                              
                                 
                                    λ
                                 
                                 
                                    c
                                 
                              
                              >
                              0
                              ,
                              
                                 
                                    λ
                                 
                                 
                                    tex
                                 
                              
                              >
                              0
                           
                         are two weighting coefficients whose values are specified in the next section, 
                           
                              
                                 
                                    ζ
                                 
                                 
                                    u
                                 
                              
                           
                         is the uth element in the m-vector 
                           
                              ζ
                              =
                              |
                              
                                 
                                    C
                                 
                                 
                                    T
                                 
                              
                              D
                              |
                              ,
                              
                                 
                                    η
                                 
                                 
                                    v
                                 
                              
                           
                         is the vth element in the m-vector 
                           
                              η
                              =
                              |
                              
                                 
                                    X
                                 
                                 
                                    T
                                 
                              
                              D
                              |
                              ,
                              C
                           
                         and X are matrices defined in Eqs. (8), (18) respectively.

If all the local judgements for SL relations are correct, all the values 
                           
                              
                                 
                                    ζ
                                 
                                 
                                    u
                                 
                              
                           
                         and 
                           
                              
                                 
                                    η
                                 
                                 
                                    v
                                 
                              
                              ,
                              1
                              ⩽
                              u
                              ⩽
                              cnum
                              ,
                              1
                              ⩽
                              v
                              ⩽
                              texnum
                           
                        , are zero, which corresponds to a minimum value of 
                           
                              
                                 
                                    E
                                 
                                 
                                    SL
                                 
                              
                           
                        . If there are some wrong or conflict SL relations judged by local features, some pairs of two regions have different layer indices and thus some absolute values 
                           
                              
                                 
                                    ζ
                                 
                                 
                                    u
                                 
                              
                           
                         or 
                           
                              
                                 
                                    η
                                 
                                 
                                    v
                                 
                              
                           
                         are positive, leading to an increase of 
                           
                              
                                 
                                    E
                                 
                                 
                                    SL
                                 
                              
                           
                        .

The minimization of the global energy 
                           
                              
                                 
                                    E
                                 
                                 
                                    2.1
                                    d
                                 
                              
                           
                         corresponds to a global optimal solution 
                           
                              
                                 
                                    D
                                 
                                 
                                    opt
                                 
                              
                           
                         of the partial depth ordering. To solve the nonlinear optimization problem 
                           
                              arg
                              
                                 
                                    min
                                 
                                 
                                    D
                                 
                              
                              
                                 
                                    E
                                 
                                 
                                    2.1
                                    d
                                 
                              
                           
                        , we use a variant of hybrid differential evolution algorithm. Compared to classical multidimensional numerical solutions such as downhill simplex method or direction-set method which may be easily trapped into a local optimization, differential evolution [36] has been demonstrated to be a powerful tool for finding the global optimization. How to generate new solutions from existing one is important in differential evolution. Below we present a variant of hybrid differential evolution with simulated annealing, which is used to escape from possible local optimum attractions.

We represent the solution space for 2.1D sketch by a 
                           
                              m
                              ×
                              n
                           
                         matrix DS:
                           
                              (27)
                              
                                 DS
                                 =
                                 [
                                 
                                    
                                       D
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       D
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    
                                       D
                                    
                                    
                                       n
                                    
                                 
                                 ]
                              
                           
                        where 
                           
                              
                                 
                                    D
                                 
                                 
                                    i
                                 
                              
                              ,
                              0
                              <
                              i
                              ⩽
                              n
                           
                        , is a m-vector, m is the number of over-segmented regions and we use 
                           
                              n
                              =
                              100
                           
                         in our experiment. We use the following steps for solving the 2.1D sketch problem:
                           
                              1.
                              Initialization. We randomly generate n permutations of the index set 
                                    
                                       {
                                       1
                                       ,
                                       2
                                       ,
                                       …
                                       ,
                                       m
                                       }
                                    
                                  to initialize the matrix DS.

Hybrid mutation. Denote the iteration number by s, and let 
                                    
                                       
                                          
                                             u
                                          
                                          
                                             i
                                          
                                          
                                             s
                                             +
                                             1
                                          
                                       
                                    
                                  and 
                                    
                                       
                                          
                                             v
                                          
                                          
                                             i
                                          
                                          
                                             s
                                             +
                                             1
                                          
                                       
                                    
                                  be intermediate m-vectors used later for updating 
                                    
                                       
                                          
                                             D
                                          
                                          
                                             i
                                          
                                          
                                             s
                                          
                                       
                                    
                                  into 
                                    
                                       
                                          
                                             D
                                          
                                          
                                             i
                                          
                                          
                                             s
                                             +
                                             1
                                          
                                       
                                    
                                 . Set
                                    
                                       
                                          
                                             
                                                v
                                             
                                             
                                                i
                                             
                                             
                                                s
                                                +
                                                1
                                             
                                          
                                          =
                                          α
                                          
                                             
                                                D
                                             
                                             
                                                
                                                   
                                                      r
                                                   
                                                   
                                                      1
                                                   
                                                
                                             
                                             
                                                s
                                             
                                          
                                          +
                                          β
                                          
                                             
                                                D
                                             
                                             
                                                best
                                             
                                             
                                                s
                                             
                                          
                                          +
                                          
                                             
                                                ε
                                             
                                             
                                                1
                                             
                                          
                                          (
                                          
                                             
                                                D
                                             
                                             
                                                
                                                   
                                                      r
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                             
                                                s
                                             
                                          
                                          -
                                          
                                             
                                                D
                                             
                                             
                                                
                                                   
                                                      r
                                                   
                                                   
                                                      3
                                                   
                                                
                                             
                                             
                                                s
                                             
                                          
                                          )
                                          +
                                          
                                             
                                                ε
                                             
                                             
                                                2
                                             
                                          
                                          (
                                          
                                             
                                                D
                                             
                                             
                                                
                                                   
                                                      r
                                                   
                                                   
                                                      4
                                                   
                                                
                                             
                                             
                                                s
                                             
                                          
                                          -
                                          
                                             
                                                D
                                             
                                             
                                                
                                                   
                                                      r
                                                   
                                                   
                                                      5
                                                   
                                                
                                             
                                             
                                                s
                                             
                                          
                                          )
                                       
                                    
                                 where 
                                    
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                          
                                             t
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             2
                                          
                                          
                                             t
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             3
                                          
                                          
                                             t
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             4
                                          
                                          
                                             t
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             5
                                          
                                          
                                             t
                                          
                                       
                                       ∈
                                       [
                                       1
                                       ,
                                       n
                                       ]
                                    
                                  (
                                    
                                       n
                                       =
                                       100
                                    
                                  in our experiment) are random and mutually different integers, 
                                    
                                       
                                          
                                             x
                                          
                                          
                                             best
                                          
                                          
                                             s
                                          
                                       
                                    
                                  is the best solution in the sth iteration in DS, and we set the parameters 
                                    
                                       α
                                       =
                                       0.8
                                       ,
                                       β
                                       =
                                       0.2
                                       ,
                                       
                                          
                                             ε
                                          
                                          
                                             1
                                          
                                       
                                       =
                                       0.6
                                       ,
                                       
                                          
                                             ε
                                          
                                          
                                             2
                                          
                                       
                                       =
                                       0.06
                                    
                                 .

Crossover. Set
                                    
                                       
                                          
                                             
                                                u
                                             
                                             
                                                i
                                             
                                             
                                                s
                                                +
                                                1
                                             
                                          
                                          =
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  v
                                                               
                                                               
                                                                  i
                                                               
                                                               
                                                                  s
                                                                  +
                                                                  1
                                                               
                                                            
                                                         
                                                         
                                                            U
                                                            (
                                                            0
                                                            ,
                                                            1
                                                            )
                                                            ⩽
                                                            CR
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  D
                                                               
                                                               
                                                                  i
                                                               
                                                               
                                                                  s
                                                               
                                                            
                                                         
                                                         
                                                            otherwise
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 where 
                                    
                                       U
                                       (
                                       0
                                       ,
                                       1
                                       )
                                    
                                  is a uniform random number between 0 and 1, and we set the crossover rate 
                                    
                                       CR
                                       =
                                       0.9
                                    
                                 .

Selection. We compute an updating probability by
                                    
                                       
                                          p
                                          =
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            1
                                                            ,
                                                            
                                                            if
                                                            
                                                            
                                                               
                                                                  E
                                                               
                                                               
                                                                  2.1
                                                                  d
                                                               
                                                            
                                                            (
                                                            
                                                               
                                                                  u
                                                               
                                                               
                                                                  i
                                                               
                                                               
                                                                  s
                                                                  +
                                                                  1
                                                               
                                                            
                                                            )
                                                            ⩽
                                                            
                                                               
                                                                  E
                                                               
                                                               
                                                                  2.1
                                                                  d
                                                               
                                                            
                                                            (
                                                            
                                                               
                                                                  D
                                                               
                                                               
                                                                  i
                                                               
                                                               
                                                                  s
                                                               
                                                            
                                                            )
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  e
                                                               
                                                               
                                                                  -
                                                                  
                                                                     
                                                                        
                                                                           
                                                                              E
                                                                           
                                                                           
                                                                              2.1
                                                                              d
                                                                           
                                                                        
                                                                        (
                                                                        
                                                                           
                                                                              u
                                                                           
                                                                           
                                                                              i
                                                                           
                                                                           
                                                                              s
                                                                              +
                                                                              1
                                                                           
                                                                        
                                                                        )
                                                                        -
                                                                        
                                                                           
                                                                              E
                                                                           
                                                                           
                                                                              2.1
                                                                              d
                                                                           
                                                                        
                                                                        (
                                                                        
                                                                           
                                                                              D
                                                                           
                                                                           
                                                                              i
                                                                           
                                                                           
                                                                              s
                                                                           
                                                                        
                                                                        )
                                                                     
                                                                     
                                                                        
                                                                           
                                                                              Z
                                                                           
                                                                           
                                                                              s
                                                                           
                                                                        
                                                                     
                                                                  
                                                               
                                                            
                                                            ,
                                                            
                                                            otherwise
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 where 
                                    
                                       
                                          
                                             Z
                                          
                                          
                                             s
                                          
                                       
                                    
                                  is the temperature at iteration s that is decreased with the increasing generation:
                                    
                                       
                                          
                                             
                                                Z
                                             
                                             
                                                s
                                                +
                                                1
                                             
                                          
                                          =
                                          μ
                                          
                                             
                                                Z
                                             
                                             
                                                s
                                             
                                          
                                       
                                    
                                 
                              

We set the initial temperature 
                                    
                                       
                                          
                                             Z
                                          
                                          
                                             0
                                          
                                       
                                       =
                                       100
                                    
                                  and 
                                    
                                       μ
                                       =
                                       0.1
                                    
                                 . Given the probability p, we update the solution space in the next generation as:
                                    
                                       
                                          
                                             
                                                D
                                             
                                             
                                                i
                                             
                                             
                                                s
                                                +
                                                1
                                             
                                          
                                          =
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  u
                                                               
                                                               
                                                                  i
                                                               
                                                               
                                                                  s
                                                                  +
                                                                  1
                                                               
                                                            
                                                            ,
                                                         
                                                         
                                                            if
                                                            
                                                            U
                                                            (
                                                            0
                                                            ,
                                                            1
                                                            )
                                                            <
                                                            p
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  D
                                                               
                                                               
                                                                  i
                                                               
                                                               
                                                                  s
                                                               
                                                            
                                                            ,
                                                         
                                                         
                                                            otherwise
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              

Clone selection and Gaussian mutation. The best 10 candidate solutions in DS are selected for the cloning operation, in which Gaussian variations are added:
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         i
                                                      
                                                      
                                                         s
                                                         +
                                                         1
                                                      
                                                   
                                                   (
                                                   j
                                                   )
                                                   =
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         i
                                                      
                                                      
                                                         s
                                                         +
                                                         1
                                                      
                                                   
                                                   (
                                                   j
                                                   )
                                                   +
                                                   
                                                      
                                                         λ
                                                      
                                                      
                                                         s
                                                         +
                                                         1
                                                      
                                                   
                                                   ·
                                                   
                                                      
                                                         rand
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   (
                                                   G
                                                   (
                                                   0
                                                   ,
                                                   1
                                                   )
                                                   )
                                                
                                             
                                             
                                                
                                                   1
                                                   ⩽
                                                   i
                                                   ≤
                                                   20
                                                   ,
                                                   
                                                   1
                                                   ⩽
                                                   j
                                                   ⩽
                                                   m
                                                
                                             
                                          
                                       
                                    
                                 where 
                                    
                                       
                                          
                                             rand
                                          
                                          
                                             j
                                          
                                       
                                       (
                                       G
                                       (
                                       0
                                       ,
                                       1
                                       )
                                       )
                                    
                                  is a random number in 
                                    
                                       (
                                       -
                                       ∞
                                       ,
                                       ∞
                                       )
                                    
                                  generated by standard Gaussian distribution 
                                    
                                       G
                                       (
                                       0
                                       ,
                                       1
                                       )
                                    
                                  with mean 
                                    
                                       μ
                                       =
                                       0
                                    
                                  and standard deviation 
                                    
                                       σ
                                       =
                                       1
                                    
                                 , and 
                                    
                                       
                                          
                                             λ
                                          
                                          
                                             s
                                             +
                                             1
                                          
                                       
                                       =
                                       0.1
                                       ‖
                                       
                                          
                                             D
                                          
                                          
                                             best
                                          
                                          
                                             s
                                             +
                                             1
                                          
                                       
                                       
                                          
                                             ‖
                                          
                                          
                                             2
                                          
                                       
                                    
                                 .

Stopping criterion. The total number of iteration reaches a predefined threshold 
                                    
                                       
                                          
                                             n
                                          
                                          
                                             s
                                          
                                       
                                       =
                                       100
                                    
                                 .

An iteration process of the numerical solution working on the image (ID 253036) in Berkeley data set (BSDS500) [6] is illustrated in Fig. 5
                        . The MATLAB code is available to be downloaded at
                           1
                           
                              http://cg.cs.tsinghua.edu.cn/people/∼Yongjin/2.1D-source.zip.
                        
                        
                           1
                         and readers can repeat all experiments presented in this paper.

The detailed complexity analysis and the performance of above specified hybrid differential evolution with comparison with classical numerical methods are presented in Section 6.2.

One advantage of the hybrid differential evolution is that it allows continuous optimization, i.e., all the elements in 
                           
                              
                                 
                                    D
                                 
                                 
                                    best
                                 
                              
                           
                         are not limited to integers. Given the solution 
                           
                              
                                 
                                    D
                                 
                                 
                                    best
                                 
                              
                              =
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         d
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         d
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                                
                                                   ⋯
                                                
                                                
                                                   
                                                      
                                                         d
                                                      
                                                      
                                                         m
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                    T
                                 
                              
                           
                        , we obtain the partial depth ordering of m regions by the matrix R:
                           
                              (28)
                              
                                 
                                    
                                       R
                                    
                                    
                                       ij
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   0
                                                
                                                
                                                   |
                                                   
                                                      
                                                         d
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         d
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   |
                                                   ⩽
                                                   0.5
                                                
                                             
                                             
                                                
                                                   1
                                                
                                                
                                                   
                                                      
                                                         d
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         d
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   >
                                                   0.5
                                                
                                             
                                             
                                                
                                                   -
                                                   1
                                                
                                                
                                                   
                                                      
                                                         d
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   -
                                                   
                                                      
                                                         d
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   >
                                                   0.5
                                                
                                             
                                          
                                       
                                    
                                 
                                 ,
                                 
                                 1
                                 ⩽
                                 i
                                 <
                                 j
                                 ⩽
                                 m
                              
                           
                        If 
                           
                              
                                 
                                    R
                                 
                                 
                                    ij
                                 
                              
                              =
                              0
                           
                        , then regions i and j are in the same layer. If 
                           
                              
                                 
                                    R
                                 
                                 
                                    ij
                                 
                              
                              =
                              1
                           
                        , then region i is foreground and region j is background. If 
                           
                              
                                 
                                    R
                                 
                                 
                                    ij
                                 
                              
                              =
                              -
                              1
                           
                        , then region j is foreground and region i is background.

There are several public available data sets that we can use for testing our proposed global energy optimization framework, including Cornell Make3D data set [8], Berkeley 3-D object data set (B3DO) [37] and Berkeley data set (BSDS500) [6]. However, we found that the Make3D and B3DO data sets were not suitable for our application. We explain the reason with the following examples. For the image in the Make3D data set shown in Fig. 6
                      left, due to the limited laser scanning resolution in the large scale of outdoor scene, the buildings and the sky have the same depth ground truth as shown in Fig. 6 right. However, in our application, the buildings and sky have a clear occlusion relation and should be judged as the different layers. For the image in the B3DO data set shown in Fig. 7
                      left, due to the limited resolution of the Kinect hardware, the clothes, the quilt and the bed all have the same depth ground truth as shown in Fig. 7 right. However, in our application, the clothes, the quilt and the bed are clearly in different layers with different partial depth ordering.

To evaluate our proposed method, we select 100 images from the Berkeley data set (BSDS500) using the following principles: (1) The images are representative, including different scenarios and different target objects. (2) The images have good over-segmentation results. (3) The objects/regions in the images have clearly partial depth orders. The selected images with their IDs in BSDS500 are illustrated in Fig. 8
                     . All these 100 selected images are over-segmented using the Berkeley segmentation algorithm [6]. Human subjects were invited to add partial depth orders to these over-segmented regions manually and the results were recoded in the matrix 
                        
                           
                              
                                 T
                              
                              
                                 2.1
                                 d
                              
                           
                        
                      as the ground truth. For 
                        
                           1
                           ⩽
                           i
                           <
                           j
                           ⩽
                           m
                        
                     , (1) if 
                        
                           
                              
                                 T
                              
                              
                                 ij
                              
                              
                                 2.1
                                 d
                              
                           
                           =
                           0
                        
                     , then regions i and j are in the same layer; (2) if 
                        
                           
                              
                                 T
                              
                              
                                 ij
                              
                              
                                 2.1
                                 d
                              
                           
                           =
                           1
                        
                     , then region i is foreground and region j is background; (3) if 
                        
                           
                              
                                 T
                              
                              
                                 ij
                              
                              
                                 2.1
                                 d
                              
                           
                           =
                           -
                           1
                        
                     , then region j is foreground and region i is background. We use the ground truth 
                        
                           
                              
                                 T
                              
                              
                                 2.1
                                 d
                              
                           
                        
                      to measure the accuracy of different 2.1D sketch extraction methods.

For each test image, we define the accuracy 
                        
                           η
                        
                      of the 2.1D sketch using the result matrix R (defined in Eq. (28)) and the ground truth 
                        
                           
                              
                                 T
                              
                              
                                 2.1
                                 d
                              
                           
                        
                      as the follows:
                        
                           (29)
                           
                              η
                              =
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          1
                                       
                                       
                                          m
                                       
                                    
                                    
                                       
                                          ∑
                                       
                                       
                                          j
                                          =
                                          i
                                          +
                                          1
                                       
                                       
                                          m
                                       
                                    
                                    
                                       
                                          Flag
                                       
                                       
                                          ij
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      m
                                                   
                                                
                                                
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     where
                        
                           (30)
                           
                              
                                 
                                    Flag
                                 
                                 
                                    ij
                                 
                              
                              =
                              
                                 
                                    
                                       
                                          
                                             
                                                1
                                             
                                             
                                                
                                                   
                                                      R
                                                   
                                                   
                                                      ij
                                                   
                                                
                                                =
                                                
                                                   
                                                      T
                                                   
                                                   
                                                      ij
                                                   
                                                   
                                                      2.1
                                                      d
                                                   
                                                
                                             
                                          
                                          
                                             
                                                0
                                             
                                             
                                                
                                                   
                                                      R
                                                   
                                                   
                                                      ij
                                                   
                                                
                                                
                                                ≠
                                                
                                                
                                                   
                                                      T
                                                   
                                                   
                                                      ij
                                                   
                                                   
                                                      2.1
                                                      d
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     
                  

All the experimental results and comparisons summarized below used the ground truth 
                        
                           
                              
                                 T
                              
                              
                                 2.1
                                 d
                              
                           
                        
                      with the images selected from the public available Berkeley data set (BSDS500). Both image data and the MATLAB code are available and the readers can repeat the experimental results.

There are a few parameters in our method. One set of parameters are the thresholds disc and dist used in Eqs. (7) and (17) respectively, and their scale weights 
                           
                              
                                 
                                    λ
                                 
                                 
                                    1
                                 
                              
                           
                         and 
                           
                              
                                 
                                    λ
                                 
                                 
                                    2
                                 
                              
                           
                         relative to the segmentation distance defined in Eqs. (20)–(22). In all experiments, our method is not sensitive to these four parameters and we tune these parameters according to the following observations. In the HSL space, the range of each dimension is 
                           
                              H
                              ∈
                              [
                              0
                              ,
                              360
                              ]
                              ,
                              S
                              ∈
                              [
                              0
                              ,
                              100
                              ]
                           
                         and 
                           
                              L
                              ∈
                              [
                              0
                              ,
                              100
                              ]
                           
                        . So we choose the threshold disc to be about 4% of the diagonal length of the HSL range cube, i.e., 
                           
                              disc
                              =
                              15
                           
                        . The magnitude of the texture vector defined in Eq. (16) is normalized to be 1 and we choose the threshold dist to be 0.1. Our experiments show that in Eqs. (21) and (22), good results can be obtained if the relative scale between disc (or dist) and 
                           
                              
                                 
                                    dis
                                 
                                 
                                    seg
                                 
                              
                           
                         is chosen to be within 
                           
                              [
                              5
                              %
                              ,
                              10
                              %
                              ]
                           
                        . So we set 
                           
                              
                                 
                                    λ
                                 
                                 
                                    1
                                 
                              
                              =
                              1
                           
                         and 
                           
                              
                                 
                                    λ
                                 
                                 
                                    2
                                 
                              
                              =
                              0.01
                           
                        .

The other set of parameters are weights 
                           
                              
                                 
                                    λ
                                 
                                 
                                    t
                                 
                              
                              ,
                              
                                 
                                    λ
                                 
                                 
                                    b
                                 
                              
                              ,
                              
                                 
                                    λ
                                 
                                 
                                    s
                                 
                              
                              ,
                              
                                 
                                    λ
                                 
                                 
                                    c
                                 
                              
                           
                         and 
                           
                              
                                 
                                    λ
                                 
                                 
                                    tex
                                 
                              
                           
                         used in Eqs. (25) and (26), which provide different combinations of local features. For different image types, the significance of each local feature is varied and the optimal set of these weighting parameters should be determined by the given image database. We use the following optimization method to determine these parameters based on BSDS500 database.

We define a functional 
                           
                              Ξ
                           
                         in a five dimensional space 
                           
                              (
                              
                                 
                                    λ
                                 
                                 
                                    t
                                 
                              
                              ,
                              
                                 
                                    λ
                                 
                                 
                                    b
                                 
                              
                              ,
                              
                                 
                                    λ
                                 
                                 
                                    s
                                 
                              
                              ,
                              
                                 
                                    λ
                                 
                                 
                                    c
                                 
                              
                              ,
                              
                                 
                                    λ
                                 
                                 
                                    tex
                                 
                              
                              )
                           
                        . We choose the range of each dimension to be 
                           
                              [
                              0
                              ,
                              10
                              ]
                           
                        . Each point p in the hypercube 
                           
                              
                                 
                                    [
                                    0
                                    ,
                                    10
                                    ]
                                 
                                 
                                    5
                                 
                              
                           
                         determine a deterministic global energy function defined in Eq. (23) and we denote it by 
                           
                              
                                 
                                    E
                                 
                                 
                                    2.1
                                    d
                                 
                              
                              (
                              p
                              )
                           
                        . With 
                           
                              
                                 
                                    E
                                 
                                 
                                    2.1
                                    d
                                 
                              
                              (
                              p
                              )
                           
                        , we compute an accuracy 
                           
                              
                                 
                                    η
                                 
                                 
                                    i
                                 
                              
                              (
                              p
                              )
                           
                         for each image i in BSDS500. The functional 
                           
                              Ξ
                           
                         is defined as
                           
                              (31)
                              
                                 Ξ
                                 (
                                 p
                                 )
                                 =
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                       
                                    
                                 
                                 
                                    
                                       η
                                    
                                    
                                       i
                                    
                                 
                                 (
                                 p
                                 )
                              
                           
                        The optimal set of parameters is the point 
                           
                              
                                 
                                    p
                                 
                                 
                                    ′
                                 
                              
                           
                         that maximizes the functional value 
                           
                              Ξ
                           
                         in the hypercube 
                           
                              
                                 
                                    [
                                    0
                                    ,
                                    10
                                    ]
                                 
                                 
                                    5
                                 
                              
                           
                        . To find such an optimal 
                           
                              
                                 
                                    p
                                 
                                 
                                    ′
                                 
                              
                           
                        , we estimate the analytic form of 
                           
                              Ξ
                           
                         using RBF interpolant. We sample the hypercube 
                           
                              
                                 
                                    [
                                    0
                                    ,
                                    10
                                    ]
                                 
                                 
                                    5
                                 
                              
                           
                         using an interval 2 in each dimension. For each sample point 
                           
                              
                                 
                                    p
                                 
                                 
                                    i
                                 
                              
                           
                        , we compute the value 
                           
                              Ξ
                              (
                              
                                 
                                    p
                                 
                                 
                                    i
                                 
                              
                              )
                           
                        . The RBF interpolating function is then given by
                           
                              (32)
                              
                                 
                                    
                                       Ξ
                                    
                                    
                                       ∼
                                    
                                 
                                 (
                                 p
                                 )
                                 =
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                       
                                    
                                 
                                 
                                    
                                       w
                                    
                                    
                                       i
                                    
                                 
                                 Φ
                                 (
                                 p
                                 -
                                 
                                    
                                       p
                                    
                                    
                                       i
                                    
                                 
                                 )
                              
                           
                        where 
                           
                              Φ
                           
                         is the radial basis function and 
                           
                              
                                 
                                    w
                                 
                                 
                                    i
                                 
                              
                           
                         is a weight for each sample 
                           
                              
                                 
                                    p
                                 
                                 
                                    i
                                 
                              
                           
                        . We choose the Gaussian radial basis function 
                           
                              Φ
                              (
                              r
                              )
                              =
                              
                                 
                                    e
                                 
                                 
                                    -
                                    
                                       
                                          r
                                       
                                       
                                          2
                                       
                                    
                                 
                              
                           
                         due to its positive definite property. The weights 
                           
                              
                                 
                                    w
                                 
                                 
                                    i
                                 
                              
                           
                         in Eq. (32) are obtained by solving the linear system from the interpolating constraints:
                           
                              (33)
                              
                                 
                                    
                                       Ξ
                                    
                                    
                                       ∼
                                    
                                 
                                 (
                                 
                                    
                                       p
                                    
                                    
                                       j
                                    
                                 
                                 )
                                 =
                                 Ξ
                                 (
                                 
                                    
                                       p
                                    
                                    
                                       j
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                       
                                    
                                 
                                 
                                    
                                       w
                                    
                                    
                                       i
                                    
                                 
                                 Φ
                                 (
                                 
                                    
                                       p
                                    
                                    
                                       j
                                    
                                 
                                 -
                                 
                                    
                                       p
                                    
                                    
                                       i
                                    
                                 
                                 )
                              
                           
                        Given the analytic form of 
                           
                              
                                 
                                    Ξ
                                 
                                 
                                    ∼
                                 
                              
                           
                        , we find its maximum value in 
                           
                              
                                 
                                    [
                                    0
                                    ,
                                    10
                                    ]
                                 
                                 
                                    5
                                 
                              
                           
                         using the BFGS algorithm in multi-dimensions. The corresponding optimal parameters are 
                           
                              
                                 
                                    λ
                                 
                                 
                                    t
                                 
                              
                              =
                              0.2
                              ,
                              
                                 
                                    λ
                                 
                                 
                                    b
                                 
                              
                              =
                              0.2
                              ,
                              
                                 
                                    λ
                                 
                                 
                                    s
                                 
                              
                              =
                              0.2
                              ,
                              
                                 
                                    λ
                                 
                                 
                                    c
                                 
                              
                              =
                              4
                           
                         and 
                           
                              
                                 
                                    λ
                                 
                                 
                                    tex
                                 
                              
                              =
                              1
                           
                        .

Heuristic global optimization methods, including genetic algorithms (GAs), particle swarm optimization (PSO) algorithms, simulated annealing (SA) algorithms, differential evolution (DE) algorithms, utilize various stochastic search strategies to obtain the global optimums of nonlinear optimization problems. These optimization techniques do not use the derivatives of objective functions and are suitable for minimization of our objective function (23). The numerical scheme presented in Section 5.2 is an improvement based on a combination of SA and DE methods. We first briefly summarize the complexity of this numerical scheme and then compare it with a classic GA algorithm [38] and a PSO algorithm [39].

In our variant of hybrid differential evolution with simulated annealing, n is the population scale of solutions, m is the number of over-segmented regions and s is the maximum number of iterations. The complexities of the six steps in the numerical scheme are follows:
                           
                              1.
                              Initialization: 
                                    
                                       O
                                       (
                                       mn
                                       )
                                    
                                 .

Hybrid mutation: 
                                    
                                       O
                                       (
                                       mns
                                       )
                                    
                                 .

Crossover: 
                                    
                                       O
                                       (
                                       mns
                                       )
                                    
                                 .

Selection: 
                                    
                                       O
                                       (
                                       ns
                                       )
                                    
                                 .

Clone selection and Gaussian mutation: 
                                    
                                       O
                                       (
                                       mns
                                       )
                                    
                                 .

Stopping criterion: 
                                    
                                       O
                                       (
                                       s
                                       )
                                    
                                 .

Thus, the total complexity is 
                           
                              O
                              (
                              mns
                              )
                           
                        , which is the same as the GA algorithm [38] and the PSO algorithm [39]. The average accuracy and running time of our 2.1D sketch extraction method using these three numerical schemes over 100 images selected from BSDS500 are summarized in Table 1
                        , which show that the numerical scheme presented in Section 5.2 has the highest average accuracy at the cost of a slightly more running time.

In the global energy 
                           
                              
                                 
                                    E
                                 
                                 
                                    2.1
                                    d
                                 
                              
                           
                         defined in Eq. (23), there are two terms 
                           
                              
                                 
                                    E
                                 
                                 
                                    FG
                                 
                              
                           
                         and 
                           
                              
                                 
                                    E
                                 
                                 
                                    SL
                                 
                              
                           
                        , which characterize the 2.1D sketch representation from different perspectives. We first evaluate the performance of the combinations of these two terms. Fig. 10 summarizes the statistic data for comparison of the accuracy of extracted 2.1D sketches by minimizing the energies 
                           
                              
                                 
                                    E
                                 
                                 
                                    FG
                                 
                              
                           
                         (Eq. (25)), 
                           
                              
                                 
                                    E
                                 
                                 
                                    SL
                                 
                              
                           
                         (Eq. (26)) and 
                           
                              
                                 
                                    E
                                 
                                 
                                    2.1
                                    d
                                 
                              
                           
                         (Eq. (23)) on 100 test images shown in Fig. 8. The original full data is also presented in Table 4 in Appendix A. The average accuracy of different energies is also summarized in Table 2
                        . In all the 100 test images, there are 97 images for which 
                           
                              
                                 
                                    E
                                 
                                 
                                    2.1
                                    d
                                 
                              
                           
                         is better than or equally well to 
                           
                              
                                 
                                    E
                                 
                                 
                                    FG
                                 
                              
                           
                        ; there are 94 images for which 
                           
                              
                                 
                                    E
                                 
                                 
                                    2.1
                                    d
                                 
                              
                           
                         better than or equally well to 
                           
                              
                                 
                                    E
                                 
                                 
                                    SL
                                 
                              
                           
                        . The average accuracy of 
                           
                              
                                 
                                    E
                                 
                                 
                                    2.1
                                    d
                                 
                              
                           
                         is 83.4%, which is also the best when compared to the average accuracy of 
                           
                              
                                 
                                    E
                                 
                                 
                                    FG
                                 
                              
                           
                         (75.8%) and 
                           
                              
                                 
                                    E
                                 
                                 
                                    SL
                                 
                              
                           
                         (43.3%). These results show that the combinatorial form of 
                           
                              
                                 
                                    E
                                 
                                 
                                    2.1
                                    d
                                 
                              
                           
                         achieves the best performance of 2.1D sketch extraction.

Our proposed global energy optimization method offers a general framework that can naturally incorporate any local features. In the presented study, we use a special hierarchical information inherent in the Berkeley segmentation dataset, as characterized in Eqs. (21) and (22). It is interesting to explore whether this hierarchical information helps the 2.1D sketch extraction. Table 2 also summarizes the results for this comparison, which show that the energy function 
                           
                              
                                 
                                    E
                                 
                                 
                                    2.1
                                    d
                                 
                              
                           
                         incorporating hierarchical information in Eqs. (21) and (22) has the average accuracy (
                           
                              83.4
                              %
                           
                        ) better than the average accuracy (79.5%) using the energy function 
                           
                              
                                 
                                    E
                                 
                                 
                                    2.1
                                    d
                                 
                              
                           
                         without the hierarchical information.

Secondly we compare the proposed global energy optimization method with previous 2.1D sketch extraction methods. There are only a few 2.1D sketch extraction methods [19,22,2] in which due to the high computational complexity or some strong assumptions on the continuity of image contours, the methods [22,2] can only handle artificially synthesized simple images but cannot handle the real images as shown in Fig. 8. We thus compare our method with the method in [19]. The statistic data of comparison between our method (
                           
                              
                                 
                                    E
                                 
                                 
                                    2.1
                                    d
                                 
                              
                           
                        ) and the method in [19] is shown in Fig. 10. The full results using the method [19] are also summarized in Table 4, and its average accuracy is summarized in Table 2. The results show that in all the 100 test images, there are 79 images for which the 
                           
                              
                                 
                                    E
                                 
                                 
                                    2.1
                                    d
                                 
                              
                           
                         minimization method is better than the method [19] and there are 13 images for which the 
                           
                              
                                 
                                    E
                                 
                                 
                                    2.1
                                    d
                                 
                              
                           
                         minimization method works equally well to the method [19]. As presented in Table 2, the average accuracy of 
                           
                              
                                 
                                    E
                                 
                                 
                                    2.1
                                    d
                                 
                              
                           
                         minimization method is 
                           
                              83.4
                              %
                           
                        , which is much better than the method [19] with only 48.3% average accuracy.

The 2.1D sketches of 100 test images shown in Fig. 8, recognized by minimizing the global energy 
                           
                              
                                 
                                    E
                                 
                                 
                                    2.1
                                    d
                                 
                              
                           
                        , are shown with a color mapping in Fig. 9
                        .  The number of layers existed in 2.1D sketches extracted from the 100 test images is diverse from 2 to 6, and the statistic data of layer numbers is summarized in Table 3
                        .


                        Limitation of the presented method. Our method currently mainly use the low level image features to determine the partial depth ordering of regions in the image. Due to the lack of high-level semantic information, in some cases our method may separate the regions of the same object into layers with different depth orders. One example is shown in Fig. 11
                        , in which the over-segmented regions of the old man (Fig. 11(b)) were incorrectly judged as having different partial depth orders (Fig. 11(d)). Due to the lack of high-level semantic information, our method cannot merge them into a layer with SL relations, since these regions have significant difference in color and texture. To remedy this drawback, our method provides an optional interactive operation. The user can draw some strokes or pick some points (Fig. 11(c)) to indicate that the underlying regions should be merged in a same layer with SL relations. One example of correct 2.1D sketch extracted after the interactive operation is shown in Fig. 11(e).

@&#CONCLUSION@&#

The 2.1D sketch is a layered image representation with a partial depth ordering, which can provide a good starting point for the downstream high-level vision tasks such as depth estimation (2.5D sketch), motion analysis, and image and video coding. Most previous 2.1D sketch extraction methods only relied on one or several local features, and can only handle simple or synthesized images. In this paper, we propose a global energy optimization framework which can incorporate different local features into a global unified solution. Two relations (F–G and SL) are modeled and local features are unified into a global form with a parameterized exponential function type. The experimental results on 100 selected images from the Berkeley data set (BSDS500) show that our proposed global solution has a good accuracy of extracting 2.1D sketches from real images.

@&#ACKNOWLEDGMENTS@&#

The authors would like to thank the reviewers for their constructive comments that helped to improve this paper. This work was partially supported by the Natural Science Foundation of China (61322206, 61272228), the National Basic Research Program of China (2011CB302202) and National High-tech R&D Program of China (2012AA011801). The work of Y.J. Liu was supported in part by Tsinghua University Initiative Scientific Research Program (20131089252).

In this appendix, we present in Table 4
                      the full original data of the accuracy of extracted 2.1D sketches by minimizing the energies 
                        
                           
                              
                                 E
                              
                              
                                 FG
                              
                           
                        
                      (Eq. (25)), 
                        
                           
                              
                                 E
                              
                              
                                 SL
                              
                           
                        
                      (Eq. (26)) and 
                        
                           
                              
                                 E
                              
                              
                                 2.1
                                 d
                              
                           
                        
                      (Eq. (23)) on 100 test images shown in Fig. 8, which is used to generate the statistical data summarized in Fig. 10.

@&#REFERENCES@&#

