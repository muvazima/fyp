@&#MAIN-TITLE@&#Approximation algorithms for hard capacitated k-facility location problems

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           The first FPTAS for the single-sink capacitated k-facility location problem (CKFL).


                        
                        
                           
                           A polynomial time algorithm for the uniform CKFL with a fixed number of clients.


                        
                        
                           
                           Approximation algorithms for two variants of CKFL by utilizing the extreme solutions.


                        
                        
                           
                           An improved approximation algorithm for CFL with uniform opening costs.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Combinatorial optimization

Facility location

Approximation algorithms

@&#ABSTRACT@&#


               
               
                  We study the capacitated k-facility location problem, in which we are given a set of clients with demands, a set of facilities with capacities and a positive integer k. It costs fi
                      to open facility i, and cij
                      for facility i to serve one unit of demand from client j. The objective is to open at most k facilities serving all the demands and satisfying the capacity constraints while minimizing the sum of service and opening costs. In this paper, we give the first fully polynomial time approximation scheme (FPTAS) for the single-sink (single-client) capacitated k-facility location problem. Then, we show that the capacitated k-facility location problem with uniform capacities is solvable in polynomial time if the number of clients is fixed by reducing it to a collection of transportation problems. Third, we analyze the structure of extreme point solutions, and examine the efficiency of this structure in designing approximation algorithms for capacitated k-facility location problems. Finally, we extend our results to obtain an improved approximation algorithm for the capacitated facility location problem with uniform opening costs.
               
            

@&#INTRODUCTION@&#

In the capacitated k-facility location problem (CKFL), we are given a set D of clients and a set F of potential facilities (locations where we can potentially open a facility) in a metric space. Each facility i ∈ F has a capacity si
                     . Establishing facility i incurs an opening cost fi
                     . Each client j has a demand dj
                      that must be served. Shipping xij
                      units from facility i to client j incurs service costs cijxij
                     , where cij
                      is proportional to the distance between i and j. The goal is to serve all the clients by using at most k facilities and satisfying the capacity constraints such that the total cost is minimized. In this paper, we consider the hard capacities, that is, we allow at most one facility to be opened at any location. (Note that in the soft capacities case multiple facilities can be opened in a single location, see for instance Mahdian et al., 2003; Shmoys et al., 1997.)

CKFL can be formulated as the following mixed integer program (MIP), where variable xij
                      indicates the amount of the demand of client j that is served by facility i, and yi
                      indicates whether facility i is open.

                        
                           (1)
                           
                              
                                 
                                    
                                       
                                          min
                                          
                                       
                                    
                                    
                                    
                                       
                                          
                                             ∑
                                             
                                                i
                                                ∈
                                                F
                                             
                                          
                                          
                                             ∑
                                             
                                                j
                                                ∈
                                                D
                                             
                                          
                                          
                                             c
                                             
                                                i
                                                j
                                             
                                          
                                          
                                             x
                                             
                                                i
                                                j
                                             
                                          
                                          +
                                          
                                             ∑
                                             
                                                i
                                                ∈
                                                F
                                             
                                          
                                          
                                             f
                                             i
                                          
                                          
                                             y
                                             i
                                          
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (2)
                           
                              
                                 
                                    
                                       
                                          subject
                                          
                                          to:
                                          
                                       
                                    
                                    
                                    
                                       
                                          
                                             ∑
                                             
                                                i
                                                ∈
                                                F
                                             
                                          
                                          
                                             x
                                             
                                                i
                                                j
                                             
                                          
                                          =
                                          
                                             d
                                             j
                                          
                                          ,
                                          
                                          ∀
                                          j
                                          ∈
                                          D
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (3)
                           
                              
                                 
                                    
                                    
                                    
                                       
                                          
                                             ∑
                                             
                                                j
                                                ∈
                                                D
                                             
                                          
                                          
                                             x
                                             
                                                i
                                                j
                                             
                                          
                                          ≤
                                          
                                             s
                                             i
                                          
                                          
                                             y
                                             i
                                          
                                          ,
                                          
                                          ∀
                                          i
                                          ∈
                                          F
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (4)
                           
                              
                                 
                                    
                                    
                                    
                                       
                                          
                                             ∑
                                             
                                                i
                                                ∈
                                                F
                                             
                                          
                                          
                                             y
                                             i
                                          
                                          ≤
                                          k
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (5)
                           
                              
                                 
                                    
                                    
                                    
                                       
                                          
                                             x
                                             
                                                i
                                                j
                                             
                                          
                                          ≥
                                          0
                                          ,
                                          
                                          ∀
                                          i
                                          ∈
                                          F
                                          ,
                                          
                                          ∀
                                          j
                                          ∈
                                          D
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (6)
                           
                              
                                 
                                    
                                    
                                    
                                       
                                          
                                             y
                                             i
                                          
                                          ∈
                                          
                                             {
                                             0
                                             ,
                                             1
                                             }
                                          
                                          ,
                                          
                                          ∀
                                          i
                                          ∈
                                          F
                                          .
                                       
                                    
                                 
                              
                           
                        
                     If we replace constraints (6) by

                        
                           (7)
                           
                              
                                 0
                                 ≤
                                 
                                    y
                                    i
                                 
                                 ≤
                                 1
                                 ,
                                 ∀
                                 i
                                 ∈
                                 F
                                 ,
                              
                           
                        
                     we obtain the LP-relaxation of CKFL. Without loss of generality we assume that si, dj
                      are integral for all i ∈ F, j ∈ D.

CKFL is related to the capacitated k-median problem (CKM), which corresponds to the special case where fi
                      = 0, ∀i ∈ F. A constant factor approximation algorithm is still unknown for CKM, let alone CKFL. All the previous attempts with constant approximation ratios for these problems violate the capacity constraint, or cardinality constraint that at most k facilities are allowed to be used. We call these approximation algorithms pseudo-approximation algorithms when one of the constraints is violated up to a certain factor. Recently, Byrka et al. (2013) gave a constant factor approximation algorithm for CKM with uniform capacities while violating the capacities by a factor 2 + ε, where ε > 0 can be arbitrarily small. Although most researchers believe that relaxing the cardinality constraint makes the problem simpler than relaxing the capacity constraint with respect to designing pseudo-approximation algorithms, the best known violation ratio for the cardinality constraint is still 5 + ε (Korupolu et al., 2000) for CKM with uniform capacities. It seems that obtaining a better constant factor approximation algorithm by only violating the cardinality constraint has not received much attention yet.

In this paper, we give an improved pseudo-approximation algorithm for CKFL with uniform opening cost by using at most 2k facilities. To show the potential power of this algorithm, we improve the approximation ratio for the capacitated facility location problem with uniform opening costs (Levi et al., 2012), by combining this algorithm with a pseudo-approximation algorithm for the k-median problem derived from a bifactor approximation algorithm for the uncapacitated facility location problem (Charikar and Guha, 1999). That is, pseudo-approximation algorithms for capacitated k-facility location problems may be extended to get approximation algorithms for well-studied capacitated facility location problems. We believe that this technique has the potential to further improve approximation ratios for capacitated facility location problems.

In Section 2 we give the first fully polynomial time approximation scheme (FPTAS) for the single-sink capacitated k-facility location problem. In Section 3, we present a polynomial time algorithm for the uniform capacitated k-facility location problem with a fixed number of clients. In Section 4, we propose an improved pseudo-approximation algorithm for CKFL with uniform opening costs, and extend this algorithm to improve the approximation ratio for the capacitated facility location problem with uniform opening costs.

@&#RELATED WORK@&#

The k-facility location problem has already been studied since the early 1990s (Cornuéjols et al., 1990; Hsu et al., 1997). It is a common generalization of the k-median problem (in which at most k facilities are allowed to be opened, and there is no opening costs) and the uncapacitated facility location problem, which are classical problems in computer science and operations research and have a wide variety of applications in clustering, data mining, logistics (Bradley et al., 1999; Jain and Dubes, 1988; Kuehn and Hamburger, 1963). Even the single-sink (single client) case is interesting. For instance, the product distribution problem, in which a company needs to deliver a given number units of a product by trucks every day within a short time, e.g., early in the morning, which implies that each truck can be used only once everyday. Each truck is characterized by three parameters: the unit transportation cost, the expense per usage, and the capacity. The objective is to select a set of trucks to satisfy these deliveries with minimum cost. This problem can be modeled as the single-sink capacitated facility location problem. See Herer et al. (1996) for more applications of single-sink case, like the supplier selection problem. When (given) multiple products need to be delivered, the above problem can be modeled as the capacitated facility location problem with fixed m = |D|. If we have a further constraint on the number of trucks that can be used, then it is a capacitated k-facility location problem.

For the uncapacitated k-facility location problem (UKFL), which is a special case of CKFL with si
                         = +∞, ∀i ∈ F, Charikar et al. (1999) gave the first constant factor approximation algorithm with performance guarantee 9.8, by modifying their 
                           
                              6
                              
                                 
                                    2
                                    3
                                 
                              
                           
                        -approximation algorithm for the uncapacitated k-median problem. Later, the approximation ratio was improved by Jain and Vazirani (2001), who made use of a primal-dual scheme and Lagrangian relaxation techniques to obtain a 6-approximation algorithm. Jain et al. (2003) and Jain et al. (2002) further improved the ratio to 4 by using a greedy approach and the so-called Lagrangian Multiplier Preserving property of the algorithms. The best known approximation algorithm for this problem, due to Zhang (2007), achieves a factor of 
                           
                              2
                              +
                              
                                 3
                              
                              +
                              ϵ
                           
                         using a local search technique for any ε > 0. The k-median problem, as a special case of UKFL, was studied extensively (Archer et al., 2003; Arya et al., 2001; Byrka et al., 2014; Charikar and Guha, 1999; Charikar et al., 1999; Jain et al., 2002; Jain and Vazirani, 2001; Li and Svensson, 2013) and the best known approximation algorithm was recently given by Byrka et al. (2014) with approximation ratio 2.611 + ε by improving the algorithm of Li and Svensson (2013). In addition, Edwards (2001) gave a 7.814-approximation algorithm for the multi-level uncapacitated k-facility location problem by extending the 
                           
                              6
                              
                                 2
                                 3
                              
                           
                        -approximation algorithm by Charikar et al. (1999) for the uncapacitated k-median problem.

Unfortunately, the capacitated k-facility location problem is much less understood although the presence of capacity constraints is natural in practice. The difficulty of the problem lies in the fact that two kinds of hard constraints appear together: the cardinality constraint, and the capacity constraints. This seems to result in hardness of the methods such as LP-rounding, primal-dual method used to solve the k-median problem, and even local search algorithms used to solve the capacitated facility location problem and the k-median problem.

The capacitated k-facility location problem is related to the capacitated facility location problem (CFL), which corresponds to a special case of CKFL with k = n. Most known approximation algorithms for CFL (see Table 1
                        ) are based on local search technique since the natural linear programming relaxation has an unbounded integrality gap for the general case (Pál et al., 2001). For uniform capacities, Korupolu et al. (2000) gave the first constant factor approximation algorithm, with a factor of 8. Later, this factor was improved to 5.83 by Chudak and Williamson (2005). The currently best approximation algorithm due to Aggarwal et al. (2013) has performance guarantee of 3. For nonuniform capacities, Pál et al. (2001) proposed the first constant factor approximation algorithm with a factor of 8.53. Later, Mahdian and Pál (2003) improved this factor to 7.88. Zhang et al. (2005) reduced this factor to 
                           
                              (
                              3
                              +
                              2
                              
                                 2
                              
                              +
                              
                                 ɛ
                              
                              )
                           
                         by introducing a multi-exchange operation, where ɛ > 0. The currently best known approximation algorithm, due to Bansal et al. (2012), achieves the approximation ratio 5.

Additionally, Levi et al. (2012) showed that the linear programming relaxation has a bounded integrality gap for CFL with uniform opening costs, and gave a 5-approximation algorithm for this case by an LP-rounding technique.

The capacitated k-median problem (CKM), which is a special case of CKFL, is already difficult to handle. The natural linear programming relaxation has an unbounded integrality gap (see Remark 1). We have to blow up the capacity or increase the number of opened facilities by a factor of at least 2 if we use the optimal cost of the natural LP relaxation as a lower bound to obtain an integral solution (Charikar et al., 1999). (See Table 2
                        .)

For CKM with hard uniform capacities, Charikar et al. (1999) gave a constant factor approximation algorithm while violating the capacities within a constant factor 3 by LP-rounding. Recently, Byrka et al. (2013) improved this violation ratio to 2 + ε by designing a (32l
                        2 + 28l + 7)-approximation algorithm increasing the capacity by a factor of 
                           
                              2
                              +
                              
                                 3
                                 
                                    l
                                    −
                                    1
                                 
                              
                              ,
                           
                         
                        l ∈ {2, 3, 4, …}. Li (2014) improved the approximation ratio 32l
                        2 + 28l + 7 to 10α + 6 with violation ratio 
                           
                              2
                              +
                              
                                 2
                                 
                                    α
                                    −
                                    1
                                 
                              
                              ,
                              α
                              ≥
                              4
                           
                        . Moreover, based on a local search technique, Korupolu et al. (2000) proposed a (1 + 5/ε)-approximation algorithm by using at most (5 + ε)k facilities, and a (1 + ε)-approximation algorithm by using at most (5 + 5/ε)k facilities. For CKM with hard non-uniform capacities, Byrka et al. (2013) gave a (96 + 180/ε)-approximation algorithm while violating capacities by factor 3 + 3ε, ε > 0.

For CKM with soft capacities, based on primal-dual and Lagrangian relaxation methods, Chuzhoy and Rabani (2005) presented a 40-approximation algorithm by violating the capacities within a constant factor of 50. Bartal et al. (2001) proposed a 19.3(1 + ε)/ε2-approximation algorithm (ε > 0) by using at most (1 + ε)k facilities.

For CKFL with uniform hard capacities, the (32l
                        2 + 28l + 7)-approximation algorithm (Byrka et al., 2013) also works by increasing the capacity by a factor of 
                           
                              2
                              +
                              
                                 3
                                 
                                    l
                                    −
                                    1
                                 
                              
                              ,
                           
                         
                        l ∈ {2, 3, 4, …}.

Without violating any constraint, a constant factor approximation algorithm remains unknown even for the single-sink capacitated k-median problem in which |D| = 1, let alone the capacitated k-facility location problem.


                        
                           
                              (i)
                              We show that the single-sink hard capacitated k-facility location problem, in which D contains exactly one client, is NP-hard even when fi
                                  = 0, i ∈ F. We give the first FPTAS for SCKFL by extending the FPTAS for the knapsack problem. To the best of our knowledge, this is also the first FPTAS for the single-sink capacitated facility location problem, which answers a question by Görtz and Klose (2009).

For the hard capacitated k-facility location problem with uniform capacities, in which si
                                  = s, i ∈ F, we observe that for |D| = 1, it is easy to find an optimal solution. A natural question is whether we can extend this to the case m ≔ |D| > 1. For general m, the answer is negative since even a special case of this problem, named the hard capacitated facility location problem with uniform capacities, is NP-hard (Chudak and Williamson, 2005; Korupolu et al., 2000). However, for fixed m, the question is still open. We give a positive answer for this setting by proposing a polynomial time algorithm that runs in time O(nm
                                  · n
                                 3), where n = |F|. Using the structure of the graph consisting of the fractional valued edges in any extreme solution, the problem is reduced to a number of transportation problems. This should be considered as a theoretical result. It will be impractical even for moderately large m.

We observe that the number of fractionally open facilities can be bounded by analyzing the rank of the constraint matrix corresponding to the tight constraints at a fractional extreme point solution. Then, we give approximation algorithms for two variants of the hard capacitated k-facility location problem based on this upper bound. Another example to show the potential power of the structure of extreme point solutions is that we can improve the previous best approximation ratio 5 obtained by Levi et al. (2012), and Bansal et al. (2012) for the capacitated facility location problem with uniform opening costs, by combining our technique with a pseudo-approximation algorithm for the k-median problem.

In this section, we consider the single-sink capacitated k-facility location problem (SCKF). Since we only have one client with demand d, the formulation for the CKF is reduced to the following mixed integer program.

                        
                           (8)
                           
                              
                                 
                                    
                                       
                                          
                                             Z
                                             
                                                MIP
                                             
                                          
                                          =
                                          min
                                       
                                    
                                    
                                    
                                       
                                          
                                             ∑
                                             
                                                i
                                                ∈
                                                F
                                             
                                          
                                          
                                             (
                                             
                                                c
                                                i
                                             
                                             
                                                x
                                                i
                                             
                                             +
                                             
                                                f
                                                i
                                             
                                             
                                                y
                                                i
                                             
                                             )
                                          
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (9)
                           
                              
                                 
                                    
                                       
                                          subject
                                          
                                          to:
                                          
                                       
                                    
                                    
                                    
                                       
                                          
                                             ∑
                                             
                                                i
                                                ∈
                                                F
                                             
                                          
                                          
                                             x
                                             i
                                          
                                          =
                                          d
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (10)
                           
                              
                                 
                                    
                                    
                                    
                                       
                                          
                                             ∑
                                             
                                                i
                                                ∈
                                                F
                                             
                                          
                                          
                                             y
                                             i
                                          
                                          ≤
                                          k
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (11)
                           
                              
                                 
                                    
                                    
                                    
                                       
                                          0
                                          ≤
                                          
                                             x
                                             i
                                          
                                          ≤
                                          
                                             s
                                             i
                                          
                                          
                                             y
                                             i
                                          
                                          ,
                                          
                                          ∀
                                          i
                                          ∈
                                          F
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     
                     
                        
                           (12)
                           
                              
                                 
                                    
                                    
                                    
                                       
                                          
                                             y
                                             i
                                          
                                          ∈
                                          
                                             {
                                             0
                                             ,
                                             1
                                             }
                                          
                                          ,
                                          
                                          ∀
                                          i
                                          ∈
                                          F
                                          .
                                       
                                    
                                 
                              
                           
                        
                     
                  

Again, the natural LP relaxation of SCKFL can be obtained by replacing constraints (12) by 0 ≤ yi
                      ≤ 1, ∀i ∈ F. Let Z
                     LP denote the optimal cost of this LP relaxation.

                        Lemma 1
                        The single-sink capacitated k-facility location problem is NP-hard even when fi
                            = 0 for all i ∈ F.

Consider the case that si
                            > 1, 
                              
                                 
                                    c
                                    i
                                 
                                 :
                                 =
                                 1
                                 −
                                 
                                    1
                                    
                                       s
                                       i
                                    
                                 
                              
                            and fi
                            = 0 for all i ∈ F. We claim that

                              
                                 (13)
                                 
                                    
                                       
                                          Z
                                          
                                             MIP
                                          
                                       
                                       ≤
                                       d
                                       −
                                       k
                                       ⇔
                                       there
                                       
                                       exists
                                       
                                       
                                          I
                                          ⊆
                                          F
                                       
                                       
                                       with
                                       
                                       
                                          |
                                          I
                                          |
                                          =
                                          k
                                       
                                       
                                       and
                                       
                                       
                                          
                                             ∑
                                             
                                                i
                                                ∈
                                                I
                                             
                                          
                                          
                                             s
                                             i
                                          
                                          =
                                          d
                                       
                                       .
                                    
                                 
                              
                           Indeed, for the objective value we find

                              
                                 
                                    
                                       
                                          ∑
                                          
                                             i
                                             ∈
                                             F
                                          
                                       
                                       
                                          
                                             c
                                             i
                                          
                                          
                                             x
                                             i
                                          
                                       
                                       =
                                       d
                                       −
                                       
                                          ∑
                                          
                                             i
                                             ∈
                                             F
                                          
                                       
                                       
                                          
                                             x
                                             i
                                          
                                          
                                             s
                                             i
                                          
                                       
                                       =
                                       d
                                       −
                                       
                                          ∑
                                          
                                             i
                                             ∣
                                             
                                                y
                                                i
                                             
                                             =
                                             1
                                          
                                       
                                       
                                          
                                             x
                                             i
                                          
                                          
                                             s
                                             i
                                          
                                       
                                       ≥
                                       d
                                       −
                                       k
                                       ,
                                    
                                 
                              
                           where the last inequality holds because xi
                            ≤ si
                            and yi
                            = 1 for at most k values of i. Equality holds if and only if xi
                            = si
                            for all i ∈ F with yi
                            = 1 and |{i ∈ F∣yi
                            = 1}| = k. That is, if and only if ∑{si
                           ∣yi
                            = 1} = d and |{i ∈ F∣yi
                            = 1}| = k.

The claim above allows to reduce SUBSET-SUM, which is NP-hard (Garey and Johnson, 1979), to SCKFL as follows. Let positive integers s
                           1, …, sn
                            > 1 and d form an instance of SUBSET-SUM. Now there exists a subset I⊆{1, 2, …, n} such that ∑
                              i ∈ I
                           
                           si
                            = d if and only if the objective value of SCKFL is at most d − k for some k ∈ {1, …, n}.□

The integrality gap Z
                           MIP/Z
                           LP is unbounded. This implies that it is impossible to design a constant factor approximation algorithm for SCKFL based solely on this LP-relaxation.

Consider the instance shown in Fig. 1
                      with four facilities F = {1, 2, 3, 4}, f = {0, 0, 0, 0}, c = {0, 0, 100, 1}, {s
                     1, s
                     2, s
                     3, s
                     4} = {s, s, Ms, s + 1}, d = 2s + 1, k = 2 and M ≫ s ≫ 100.

For this instance, an optimal solution for the MIP is y
                     1 = y
                     4 = 1, x
                     1 = s, x
                     4 = s + 1 with the total cost s + 1. And an optimal solution for the LP-relaxation of this instance is 
                        
                           
                              y
                              1
                           
                           =
                           1
                           ,
                           
                              y
                              2
                           
                           =
                           
                              
                                 M
                                 s
                                 −
                                 s
                                 −
                                 1
                              
                              
                                 (
                                 M
                                 −
                                 1
                                 )
                                 s
                              
                           
                           ,
                           
                              y
                              3
                           
                           =
                           
                              1
                              
                                 (
                                 M
                                 −
                                 1
                                 )
                                 s
                              
                           
                           ,
                           
                              x
                              1
                           
                           =
                           s
                           ,
                           
                              x
                              2
                           
                           =
                           
                              
                                 M
                                 s
                                 −
                                 s
                                 −
                                 1
                              
                              
                                 M
                                 −
                                 1
                              
                           
                           ,
                           
                              x
                              3
                           
                           =
                           
                              M
                              
                                 M
                                 −
                                 1
                              
                           
                           ,
                        
                      with the total cost 
                        
                           
                              100
                              M
                           
                           
                              M
                              −
                              1
                           
                        
                     . So, we have Z
                     MIP = s + 1 and 
                        
                           
                              Z
                              
                                 LP
                              
                           
                           =
                           
                              
                                 100
                                 M
                              
                              
                                 M
                                 −
                                 1
                              
                           
                        
                     . Thus, 
                        
                           
                              Z
                              
                                 MIP
                              
                           
                           /
                           
                              Z
                              
                                 LP
                              
                           
                           =
                           
                              
                                 s
                                 +
                                 1
                              
                              
                                 
                                    100
                                    M
                                 
                                 
                                    M
                                    −
                                    1
                                 
                              
                           
                           >
                           
                              
                                 s
                                 +
                                 1
                              
                              200
                           
                           ,
                        
                      which can be arbitrarily large.

In addition, a simple LP-rounding technique does not work for SCKFL. For this instance, a natural idea is to round y
                     3 to be 1, y
                     2 to be 0. It is clear that the objective value of the solution obtained by this simple rounding is still really large.

We aim to design a fully polynomial time approximation scheme (FPTAS) for SCKFL. Before introducing our algorithm, we present a key observation (Pál, Tardos, and Wexler gave a similar observation in the proof of Lemma 3.3 in Pál et al., 2001).

                        Observation 1
                        For the single-sink capacitated k-facility location problem, there is an optimal solution (x*, y*) in which at most one open facility t
                           0 is not fully used, i.e., 
                              
                                 
                                    x
                                    i
                                    *
                                 
                                 ∈
                                 
                                    {
                                    0
                                    ,
                                    
                                       s
                                       i
                                    
                                    }
                                 
                              
                            for i ≠ t
                           0.

Without loss of generality we suppose that cij
                      and fi
                      are integral for all i ∈ F, j ∈ D. Given t
                     0, which is allowed not to be fully used in an optimal integral solution (x*, y*), in order to solve SCKFL it is sufficient to solve the following problem for a given integer p:

                        
                           (14)
                           
                              
                                 max
                                 
                                    {
                                    
                                       ∑
                                       
                                          i
                                          ∈
                                          
                                             F
                                             ′
                                          
                                       
                                    
                                    
                                       s
                                       i
                                    
                                    ∣
                                    
                                       F
                                       ′
                                    
                                    ⊆
                                    F
                                    ∖
                                    
                                       {
                                       
                                          t
                                          0
                                       
                                       }
                                    
                                    ,
                                    
                                       |
                                       
                                          F
                                          ′
                                       
                                       |
                                    
                                    ≤
                                    k
                                    −
                                    1
                                    ,
                                    
                                       ∑
                                       
                                          i
                                          ∈
                                          
                                             F
                                             ′
                                          
                                       
                                    
                                    
                                       (
                                       
                                          c
                                          i
                                       
                                       
                                          s
                                          i
                                       
                                       +
                                       
                                          f
                                          i
                                       
                                       )
                                    
                                    =
                                    p
                                    }
                                 
                                 .
                              
                           
                        
                     In words, we find for each total cost p a set of at most k − 1 facilities (not containing t
                     0) to open and use to full capacity, maximizing the total capacity. First, we will show that the above problem can be solved by dynamic programming, but may require exponential time in the size of the instance. Then, we use a rounding-and-scaling process to make sure that a feasible solution can be obtained (if it exists) in polynomial time while losing at most a factor of 1 + ε to the optimal cost.

We can recursively solve problem (14) by dynamic programming. Without loss of generality, suppose F = {1, 2, …, n}, where n = |F|. For nonnegative integers p, 0 ≤ g ≤ k − 1 and 1 ≤ b ≤ n define

                        
                           
                              
                                 
                                    
                                       
                                          
                                             S
                                             g
                                          
                                          
                                             (
                                             b
                                             ,
                                             p
                                             )
                                          
                                          :
                                          =
                                          max
                                       
                                    
                                    
                                       {
                                    
                                    
                                       
                                          
                                             ∑
                                             
                                                i
                                                ∈
                                                
                                                   F
                                                   ′
                                                
                                             
                                          
                                          
                                             s
                                             i
                                          
                                          ∣
                                          
                                             F
                                             ′
                                          
                                          ⊆
                                          
                                             {
                                             1
                                             ,
                                             …
                                             ,
                                             b
                                             }
                                          
                                          ∖
                                          
                                             {
                                             
                                                t
                                                0
                                             
                                             }
                                          
                                          ,
                                          
                                             |
                                             
                                                F
                                                ′
                                             
                                             |
                                          
                                          ≤
                                          g
                                          ,
                                       
                                    
                                 
                                 
                                    
                                    
                                    
                                       
                                          
                                             ∑
                                             
                                                i
                                                ∈
                                                
                                                   F
                                                   ′
                                                
                                             
                                          
                                          
                                             (
                                             
                                                c
                                                i
                                             
                                             
                                                s
                                                i
                                             
                                             +
                                             
                                                f
                                                i
                                             
                                             )
                                          
                                          =
                                          p
                                          }
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     and let Fg
                     (b, p) be a corresponding optimal solution F′. If 
                        
                           
                              ∑
                              
                                 i
                                 ∈
                                 
                                    F
                                    ′
                                 
                              
                           
                           
                              (
                              
                                 c
                                 i
                              
                              
                                 s
                                 i
                              
                              +
                              
                                 f
                                 i
                              
                              )
                           
                           =
                           p
                        
                      does not hold for any F′⊆{1, …, b}∖{t
                     0} with |F′| ≤ g, we set Sg
                     (b, p) ≔ −∞ and Fg
                     (b, p) ≔ ∅. Clearly, Sg
                     (0, 0) = 0 and Sg
                     (0, p) = −∞ for p > 0. The other values Sg
                     (b, p), and the corresponding optimum solutions Fg
                     (b, p), can be computed recursively since if t
                     0 = b + 1, then

                        
                           
                              
                                 
                                    S
                                    g
                                 
                                 
                                    (
                                    b
                                    +
                                    1
                                    ,
                                    p
                                    )
                                 
                                 =
                                 
                                    S
                                    g
                                 
                                 
                                    (
                                    b
                                    ,
                                    p
                                    )
                                 
                              
                           
                        
                     for 0 < g ≤ k − 1; if t
                     0 ≠ b + 1, then

                        
                           
                              
                                 
                                    S
                                    g
                                 
                                 
                                    (
                                    b
                                    +
                                    1
                                    ,
                                    p
                                    )
                                 
                                 =
                                 max
                                 
                                    (
                                    
                                       S
                                       g
                                    
                                    
                                       (
                                       b
                                       ,
                                       p
                                       )
                                    
                                    ,
                                    
                                    
                                       s
                                       
                                          b
                                          +
                                          1
                                       
                                    
                                    +
                                    
                                       S
                                       
                                          g
                                          −
                                          1
                                       
                                    
                                    
                                       (
                                       b
                                       ,
                                       p
                                       −
                                       
                                          (
                                          
                                             f
                                             
                                                b
                                                +
                                                1
                                             
                                          
                                          +
                                          
                                             c
                                             
                                                b
                                                +
                                                1
                                             
                                          
                                          
                                             s
                                             
                                                b
                                                +
                                                1
                                             
                                          
                                          )
                                       
                                       )
                                    
                                    )
                                 
                              
                           
                        
                     for 0 < g ≤ k − 1, where in the maximum the two values correspond to not opening and opening facility b + 1, respectively.

For computing the maximum in (14), it suffices to restrict to values 
                        
                           0
                           ≤
                           p
                           ≤
                           (
                           k
                           −
                           1
                           )
                           P
                           ≤
                           n
                           P
                           ,
                        
                      where 
                        
                           P
                           =
                           max
                           {
                           
                              c
                              i
                           
                           
                              s
                              i
                           
                           +
                           
                              f
                              i
                           
                           ∣
                           i
                           ∈
                           
                              {
                              1
                              ,
                              …
                              ,
                              n
                              }
                           
                           ∖
                           
                              {
                              
                                 t
                                 0
                              
                              }
                           
                           }
                        
                     . Hence we can solve (14) in time 
                        
                           O
                           (
                           
                              n
                              3
                           
                           P
                           )
                        
                      since g ≤ n, b ≤ n.

Since 
                        P
                      may be exponential in the size of the input of SCKFL, the computing time could be non-polynomial. We overcome this difficulty by a scaling-and-rounding technique while losing at most a factor of 1 + ε to the optimal cost. More precisely, we define 
                        
                           
                              C
                              b
                              0
                           
                           =
                           max
                           
                              {
                              
                                 c
                                 i
                              
                              
                                 s
                                 i
                              
                              +
                              
                                 f
                                 i
                              
                              ∣
                              i
                              ∈
                              
                                 {
                                 1
                                 ,
                                 …
                                 ,
                                 b
                                 }
                              
                              ∖
                              
                                 {
                                 
                                    t
                                    0
                                 
                                 }
                              
                              }
                           
                        
                      and 
                        
                           W
                           =
                           
                              
                                 ϵ
                                 
                                    C
                                    
                                       b
                                    
                                    0
                                 
                              
                              k
                           
                           ,
                        
                      where ε > 0. Then, for each i ∈ {1, …, b}∖{t
                     0}, we scale and round the cost cisi
                      + fi
                      to 
                        
                           ⌊
                           
                              
                                 
                                    c
                                    i
                                 
                                 
                                    s
                                    i
                                 
                                 +
                                 
                                    f
                                    i
                                 
                              
                              W
                           
                           ⌋
                        
                     . Since t
                     0 may not be fully used, we just scale its opening and service cost without rounding. In this way, we can make sure that 
                        P
                      is not exponential with respect to the scaled (and rounded) cost. Moreover, we need to try all the possibilities of t
                     0 since t
                     0 is not known in advance. (This is why we enumerate t from 1 to n in the Algorithm 1
                     .) The resulting Algorithm 1 may be seen as a generalization of the FPTAS for the knapsack problem (with cardinality constraints) (Caprara et al., 2000; Lawler, 1979). The total cost of the obtained solution is bounded by Theorem 1.

                        Assumption 1
                        For each i ∈ F, Ci
                            > 0, where Ci
                            ≔ cisi
                            + fi
                           . There are at least two open facilities in an optimal solution.

Note that if Ci
                      = 0 and si
                      < d we directly open i and serve demand si
                      of the single client by i without increasing any cost. If Ci
                      = 0 and si
                      ≥ d, the optimal total cost is 0. Moreover, if in an optimal solution only one facility is opened, we can easily obtain an optimal solution by opening a facility in {i ∈ F∣si
                      ≥ d} with min {Ci
                     ∣si
                      ≥ d, i ∈ F}. A precise description of the FPTAS is given in Algorithm 1.

                        Theorem 1
                        Let SOL be the cost of the solution returned by Algorithm 1. Then, SOL ≤ (1 + ε)Z
                           MIP. The running time of Algorithm 1 is 
                              
                                 O
                                 (
                                 
                                    
                                       n
                                       6
                                    
                                    ϵ
                                 
                                 )
                                 ,
                              
                            for any ε > 0.

Suppose that (x*, y*) is an optimal solution in which at most one open facility is not fully used. Let t
                           0 be the open facility in (x*, y*) that is not fully used if it exists. Otherwise, let t
                           0 be some open facility in (x*, y*). Then, we define 
                              
                                 
                                    F
                                    1
                                    *
                                 
                                 =
                                 
                                    {
                                    i
                                    ∈
                                    F
                                    ∣
                                    
                                       y
                                       i
                                       *
                                    
                                    =
                                    1
                                    }
                                 
                                 ∖
                                 
                                    {
                                    
                                       t
                                       0
                                    
                                    }
                                 
                              
                            as the set of opened facilities in (x*, y*) excluding t
                           0. By Assumption 1, we know 
                              
                                 
                                    F
                                    1
                                    *
                                 
                                 ≠
                                 ∅
                              
                           .

Let 
                              
                                 
                                    C
                                    
                                       i
                                    
                                    0
                                 
                                 =
                                 max
                                 
                                    {
                                    
                                       C
                                       i
                                    
                                    ∣
                                    i
                                    ∈
                                    
                                       F
                                       1
                                       *
                                    
                                    }
                                 
                              
                           . Note that 
                              
                                 
                                    C
                                    
                                       i
                                    
                                    0
                                 
                                 ≤
                                 
                                    Z
                                    
                                       MIP
                                    
                                 
                              
                           . Moreover, let 
                              
                                 
                                    i
                                    0
                                 
                                 =
                                 max
                                 
                                    {
                                    i
                                    ∈
                                    
                                       F
                                       1
                                       *
                                    
                                    ∣
                                    
                                       C
                                       i
                                    
                                    =
                                    
                                       C
                                       
                                          i
                                       
                                       0
                                    
                                    }
                                 
                              
                           . Thus, 
                              
                                 
                                    C
                                    
                                       i
                                       0
                                    
                                 
                                 =
                                 
                                    C
                                    
                                       i
                                    
                                    0
                                 
                              
                           .

Suppose that in iteration t = t
                           0, r = i
                           0 of Step 2 in Algorithm 1 we get a solution (x, y). Let F
                           1 = {i ∈ F∣yi
                            = 1}∖{t
                           0}. Let Cost(x, y) and 
                              
                                 
                                    Scaled
                                    _
                                    cost
                                 
                                 (
                                 x
                                 ,
                                 y
                                 )
                              
                            be the original and scaled total cost of solution (x, y) respectively. So, 
                              
                                 
                                    Cost
                                 
                                 
                                    (
                                    x
                                    ,
                                    y
                                    )
                                 
                                 =
                                 
                                    (
                                    
                                       ∑
                                       
                                          i
                                          ∈
                                          
                                             F
                                             1
                                          
                                       
                                    
                                    
                                       C
                                       i
                                    
                                    )
                                 
                                 +
                                 
                                    x
                                    
                                       t
                                       0
                                    
                                 
                                 
                                    c
                                    
                                       t
                                       0
                                    
                                 
                                 +
                                 
                                    f
                                    
                                       t
                                       0
                                    
                                 
                                 ,
                              
                            and 
                              
                                 
                                    Scaled
                                    _
                                    cost
                                 
                                 
                                    (
                                    x
                                    ,
                                    y
                                    )
                                 
                                 =
                                 
                                    (
                                    
                                       ∑
                                       
                                          i
                                          ∈
                                          
                                             F
                                             1
                                          
                                       
                                    
                                    
                                       
                                          C
                                          ¯
                                       
                                       i
                                    
                                    )
                                 
                                 +
                                 
                                    x
                                    
                                       t
                                       0
                                    
                                 
                                 
                                    
                                       c
                                       ¯
                                    
                                    
                                       t
                                       0
                                    
                                 
                                 +
                                 
                                    
                                       f
                                       ¯
                                    
                                    
                                       t
                                       0
                                    
                                 
                                 ,
                              
                            where the definition of 
                              
                                 
                                    C
                                    ¯
                                 
                                 i
                              
                            is given in Algorithm 1. We will show that Cost(x, y) ≤ (1 + ε)Z
                           MIP, which then implies SOL ≤ (1 + ε)Z
                           MIP.

Recall that 
                              
                                 W
                                 =
                                 
                                    
                                       ϵ
                                       
                                          C
                                          
                                             r
                                          
                                          0
                                       
                                    
                                    k
                                 
                              
                           . We have

                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   Cost
                                                
                                                (
                                                x
                                                ,
                                                y
                                                )
                                             
                                          
                                          
                                          
                                             
                                                =
                                                
                                                   (
                                                   
                                                      ∑
                                                      
                                                         i
                                                         ∈
                                                         
                                                            F
                                                            1
                                                         
                                                      
                                                   
                                                   
                                                      C
                                                      i
                                                   
                                                   )
                                                
                                                +
                                                
                                                   x
                                                   
                                                      t
                                                      0
                                                   
                                                
                                                
                                                   c
                                                   
                                                      t
                                                      0
                                                   
                                                
                                                +
                                                
                                                   f
                                                   
                                                      t
                                                      0
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                          
                                          
                                             
                                                ≤
                                                
                                                   (
                                                   
                                                      ∑
                                                      
                                                         i
                                                         ∈
                                                         
                                                            F
                                                            1
                                                         
                                                      
                                                   
                                                   
                                                      (
                                                      W
                                                      
                                                         
                                                            C
                                                            ¯
                                                         
                                                         i
                                                      
                                                      +
                                                      W
                                                      )
                                                   
                                                   )
                                                
                                                +
                                                W
                                                
                                                   x
                                                   
                                                      t
                                                      0
                                                   
                                                
                                                
                                                   
                                                      c
                                                      ¯
                                                   
                                                   
                                                      t
                                                      0
                                                   
                                                
                                                +
                                                W
                                                
                                                   
                                                      f
                                                      ¯
                                                   
                                                   
                                                      t
                                                      0
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                          
                                          
                                             
                                                ≤
                                                W
                                                
                                                   (
                                                   
                                                      (
                                                      
                                                         ∑
                                                         
                                                            i
                                                            ∈
                                                            
                                                               F
                                                               1
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            C
                                                            ¯
                                                         
                                                         i
                                                      
                                                      )
                                                   
                                                   +
                                                   
                                                      x
                                                      
                                                         t
                                                         0
                                                      
                                                   
                                                   
                                                      
                                                         c
                                                         ¯
                                                      
                                                      
                                                         t
                                                         0
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         f
                                                         ¯
                                                      
                                                      
                                                         t
                                                         0
                                                      
                                                   
                                                   )
                                                
                                                +
                                                k
                                                W
                                             
                                          
                                       
                                       
                                          
                                          
                                          
                                             
                                                ≤
                                                W
                                                ·
                                                
                                                   Scaled
                                                   _
                                                   cost
                                                
                                                (
                                                x
                                                ,
                                                y
                                                )
                                                +
                                                k
                                                W
                                                ,
                                             
                                          
                                       
                                    
                                 
                              
                           where the second inequality holds as |F
                           1| ≤ k − 1.

The scaled total cost of solution (x*, y*) in this iteration is 
                              
                                 
                                    (
                                    
                                       ∑
                                       
                                          i
                                          ∈
                                          
                                             F
                                             1
                                             *
                                          
                                       
                                    
                                    
                                       
                                          C
                                          ¯
                                       
                                       i
                                    
                                    )
                                 
                                 +
                                 
                                    x
                                    
                                       t
                                       0
                                    
                                    *
                                 
                                 
                                    
                                       c
                                       ¯
                                    
                                    
                                       t
                                       0
                                    
                                 
                                 +
                                 
                                    
                                       f
                                       ¯
                                    
                                    
                                       t
                                       0
                                    
                                 
                              
                           . Clearly,

                              
                                 
                                    
                                       
                                          Scaled
                                          _
                                          cost
                                       
                                       
                                          (
                                          x
                                          ,
                                          y
                                          )
                                       
                                       ≤
                                       
                                          (
                                          
                                             ∑
                                             
                                                i
                                                ∈
                                                
                                                   F
                                                   1
                                                   *
                                                
                                             
                                          
                                          
                                             
                                                C
                                                ¯
                                             
                                             i
                                          
                                          )
                                       
                                       +
                                       
                                          x
                                          
                                             t
                                             0
                                          
                                          *
                                       
                                       
                                          
                                             c
                                             ¯
                                          
                                          
                                             t
                                             0
                                          
                                       
                                       +
                                       
                                          
                                             f
                                             ¯
                                          
                                          
                                             t
                                             0
                                          
                                       
                                       ,
                                    
                                 
                              
                           since (x, y) is optimal in this iteration. That is,

                              
                                 
                                    
                                       
                                          Scaled
                                          _
                                          cost
                                       
                                       
                                          (
                                          x
                                          ,
                                          y
                                          )
                                       
                                       ≤
                                       
                                          (
                                          
                                             ∑
                                             
                                                i
                                                ∈
                                                
                                                   F
                                                   1
                                                   *
                                                
                                             
                                          
                                          
                                             ⌊
                                             
                                                
                                                   C
                                                   i
                                                
                                                W
                                             
                                             ⌋
                                          
                                          )
                                       
                                       +
                                       
                                          x
                                          
                                             t
                                             0
                                          
                                          *
                                       
                                       
                                          
                                             c
                                             
                                                t
                                                0
                                             
                                          
                                          W
                                       
                                       +
                                       
                                          
                                             f
                                             
                                                t
                                                0
                                             
                                          
                                          W
                                       
                                       .
                                    
                                 
                              
                           
                        

Then, we have

                              
                                 
                                    
                                       W
                                       ·
                                       
                                          Scaled
                                          _
                                          cost
                                       
                                       
                                          (
                                          x
                                          ,
                                          y
                                          )
                                       
                                       ≤
                                       W
                                       
                                          (
                                          
                                             ∑
                                             
                                                i
                                                ∈
                                                
                                                   F
                                                   1
                                                   *
                                                
                                             
                                          
                                          
                                             ⌊
                                             
                                                
                                                   C
                                                   i
                                                
                                                W
                                             
                                             ⌋
                                          
                                          )
                                       
                                       +
                                       W
                                       
                                          x
                                          
                                             t
                                             0
                                          
                                          *
                                       
                                       
                                          
                                             c
                                             
                                                t
                                                0
                                             
                                          
                                          W
                                       
                                       +
                                       W
                                       
                                          
                                             f
                                             
                                                t
                                                0
                                             
                                          
                                          W
                                       
                                    
                                 
                              
                           
                           
                              
                                 
                                    
                                       ⇒
                                       W
                                       ·
                                       
                                          Scaled
                                          _
                                          cost
                                       
                                       
                                          (
                                          x
                                          ,
                                          y
                                          )
                                       
                                       +
                                       k
                                       W
                                       ≤
                                       
                                          (
                                          
                                             ∑
                                             
                                                i
                                                ∈
                                                
                                                   F
                                                   1
                                                   *
                                                
                                             
                                          
                                          
                                             C
                                             i
                                          
                                          )
                                       
                                       +
                                       
                                          x
                                          
                                             t
                                             0
                                          
                                          *
                                       
                                       
                                          c
                                          
                                             t
                                             0
                                          
                                       
                                       +
                                       
                                          f
                                          
                                             t
                                             0
                                          
                                       
                                       +
                                       k
                                       W
                                       .
                                    
                                 
                              
                           
                        

Therefore, we get

                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   Cost
                                                
                                                (
                                                x
                                                ,
                                                y
                                                )
                                             
                                          
                                          
                                             ≤
                                          
                                          
                                             
                                                
                                                   (
                                                   
                                                      ∑
                                                      
                                                         i
                                                         ∈
                                                         
                                                            F
                                                            1
                                                            *
                                                         
                                                      
                                                   
                                                   
                                                      C
                                                      i
                                                   
                                                   )
                                                
                                                +
                                                
                                                   x
                                                   
                                                      t
                                                      0
                                                   
                                                   *
                                                
                                                
                                                   c
                                                   
                                                      t
                                                      0
                                                   
                                                
                                                +
                                                
                                                   f
                                                   
                                                      t
                                                      0
                                                   
                                                
                                                +
                                                k
                                                W
                                             
                                          
                                       
                                       
                                          
                                          
                                             =
                                          
                                          
                                             
                                                
                                                   Z
                                                   
                                                      MIP
                                                   
                                                
                                                +
                                                ϵ
                                                
                                                   C
                                                   
                                                      i
                                                   
                                                   0
                                                
                                                ≤
                                                
                                                   (
                                                   1
                                                   +
                                                   ϵ
                                                   )
                                                
                                                
                                                   Z
                                                   
                                                      MIP
                                                   
                                                
                                                ,
                                             
                                          
                                       
                                    
                                 
                              
                           where the equality holds by the definition of W and the last inequality holds as 
                              
                                 
                                    C
                                    
                                       i
                                    
                                    0
                                 
                                 ≤
                                 
                                    Z
                                    
                                       MIP
                                    
                                 
                              
                           .

For fixed t, the running time of the subproblem Prt, r = 1, …, n is 
                              
                                 O
                                 (
                                 
                                    n
                                    3
                                 
                                 
                                    ⌊
                                    
                                       
                                          C
                                          
                                             r
                                          
                                          0
                                       
                                       W
                                    
                                    ⌋
                                 
                                 )
                              
                           . That is, 
                              
                                 O
                                 (
                                 
                                    n
                                    3
                                 
                                 
                                    k
                                    ϵ
                                 
                                 )
                              
                           . Thus, the total running time of our algorithm is 
                              
                                 O
                                 (
                                 
                                    
                                       n
                                       6
                                    
                                    ϵ
                                 
                                 )
                              
                            as we have O(n
                           2) subproblems.□

In this section, we aim to show the following result for the capacitated k-facility location problem with uniform capacities (CKFLU). Let m = |D|, n = |F| and si
                      = s, i ∈ F.

                        Theorem 2
                        For fixed m, the capacitated k-facility location problem with uniform capacities can be solved in polynomial time O(nm
                            · n
                           3).

Note that if n ≤ m, then Theorem 2 holds since n is also fixed now. Thus, from now on we consider the case n > m.

We need new notation to describe our idea. We consider an optimal solution (x, y) for CKFLU as a weighted bipartite graph G = (V, E), where V = {i ∈ F∣yi
                      = 1}∪D and E = {{i, j}∣xij
                      > 0, i ∈ F, j ∈ D}. To be more precise, if xij
                      > 0, we add an edge {i, j} between facility i and client j with weight xij
                     . Moreover, let 
                        
                           
                              E
                              ¯
                           
                           =
                           
                              {
                              
                                 {
                                 i
                                 ,
                                 j
                                 }
                              
                              ∈
                              E
                              ∣
                              0
                              <
                              
                                 x
                                 
                                    i
                                    j
                                 
                              
                              <
                              s
                              }
                           
                        
                      be the set of edges in E with positive weight strictly less than s, and 
                        
                           
                              V
                              ¯
                           
                           =
                           
                              ⋃
                              
                                 e
                                 ∈
                                 
                                    E
                                    ¯
                                 
                              
                           
                           e
                           ∪
                           D
                        
                      be the set of nodes consisted of the clients and the nodes incident to an edge in 
                        
                           
                              E
                              ¯
                           
                           ,
                        
                      as shown in Fig. 2
                     . We call 
                        
                           (
                           
                              V
                              ¯
                           
                           ,
                           
                              E
                              ¯
                           
                           )
                        
                      the untight weighted subgraph of G.

Define rj
                      ≔ dj
                     /s for all j ∈ D. If all rj
                      are integral, we say that the CKFLU is divisible.

                        Lemma 2
                        The divisible capacitated k-facility location problem with uniform capacities can be solved in O(n
                           3) time.

We transform the divisible CKFLU to a balanced transportation problem, in which the total capacity is equal to total demand. Then, to get an integer solution to this transportation problem, we can consider this problem as a minimum weight perfect matching problem that can be solved in O(n
                           3) time (Gabow, 1976), by splitting the demands. Since the problem is infeasible if k < ∑
                              j ∈ D
                           
                           rj
                           , we only consider the case: |F| ≥ k ≥ ∑
                              j ∈ D
                           
                           rj
                           .

By dividing the capacity and demand constraints by s, we can get an equivalent formulation for the divisible CKFLU, in which the new capacity of each facility is 1 and the new demand of each client j is rj
                           .

First, we show that there exists an optimal integral solution for this equivalent formulation. We add a dummy client j′ to D with demand 
                              
                                 
                                    r
                                    
                                       j
                                       ′
                                    
                                 
                                 =
                                 n
                                 −
                                 
                                    ∑
                                    
                                       j
                                       ∈
                                       D
                                    
                                 
                                 
                                    r
                                    j
                                 
                              
                           . Take the cost of shipping one unit from i ∈ F to j ∈ D∖{j′} to be scij
                            + fi
                           , from i ∈ F to j′ to be 0. Now the divisible CKFLU can be considered as a balanced transportation problem with total demand n. Since rj, j ∈ D are integers, there is an integer optimal solution for this transportation problem (see for instance Hoffman and Kruskal, 1956, or Theorem 21.14 in Schrijver, 2003). Note that based on the optimal integer solution for this transportation problem, we can easily construct an optimal solution for our original problem.

Then, to get an optimal integer solution for the constructed transportation problem, we can split each j ∈ D to rj
                            copies each with demand 1. Now we can consider the balanced transportation problem as a minimum weight perfect matching problem that can be solved in O(n
                           3) time (Gabow, 1976).□

Note that if we know the exact structure of 
                        
                           (
                           
                              V
                              ¯
                           
                           ,
                           
                              E
                              ¯
                           
                           )
                           ,
                        
                      then according to the definition of G the remaining part 
                        
                           (
                           V
                           ,
                           E
                           ∖
                           
                              E
                              ¯
                           
                           )
                        
                      can be generated by an optimal integer solution to an instance of the divisible CKFLU problem. Thus, the high-level idea is that we reduce our original problem to a collection of divisible CKFLU problems by checking all the possible structures of 
                        
                           (
                           
                              V
                              ¯
                           
                           ,
                           
                              E
                              ¯
                           
                           )
                        
                     . To prove that we can examine all the structures in polynomial time, we show some useful properties of the untight weighted subgraph of G first.

                        Lemma 3
                        Let G = (V, E) be the graph corresponding to a vertex (x, y) of the convex hull of feasible solutions of the MIP to CKFLU, and 
                              
                                 H
                                 =
                                 (
                                 
                                    V
                                    ¯
                                 
                                 ,
                                 
                                    E
                                    ¯
                                 
                                 )
                              
                            be its corresponding untight subgraph. Then,

                              
                                 (a)
                                 
                                    G is acyclic;

in each connected component of H, there is at most one 
                                       
                                          i
                                          ∈
                                          F
                                          ∩
                                          
                                             V
                                             ¯
                                          
                                       
                                     with 0 < ∑
                                       j ∈ D
                                    
                                    xij
                                     < s;


                                    H contains at most m facilities and 2m − 1 edges.


                           
                              
                                 (a)
                                 Suppose that there is a cycle O = (e
                                    1, e
                                    2, …, e
                                    2p − 1, e
                                    2p
                                    ) in G. Note that O must have even number of edges as G is bipartite. Let 
                                       
                                          
                                             χ
                                             O
                                          
                                          ∈
                                          
                                             
                                                R
                                             
                                             E
                                          
                                       
                                     be the signed incidence vector of this path:

                                       
                                          
                                             
                                                
                                                   
                                                   
                                                   
                                                      
                                                         
                                                            χ
                                                            O
                                                         
                                                         
                                                            (
                                                            
                                                               e
                                                               i
                                                            
                                                            )
                                                         
                                                         =
                                                         
                                                            
                                                               (
                                                               −
                                                               1
                                                               )
                                                            
                                                            i
                                                         
                                                         
                                                         for
                                                         
                                                         
                                                            i
                                                            =
                                                            1
                                                            ,
                                                            2
                                                            ,
                                                            …
                                                            ,
                                                            2
                                                            p
                                                         
                                                         ;
                                                      
                                                   
                                                
                                                
                                                   
                                                   
                                                   
                                                      
                                                         
                                                            χ
                                                            O
                                                         
                                                         
                                                            (
                                                            e
                                                            )
                                                         
                                                         =
                                                         0
                                                         
                                                         for
                                                         
                                                         e
                                                         ∈
                                                         E
                                                         ∖
                                                         
                                                            {
                                                            
                                                               e
                                                               1
                                                            
                                                            ,
                                                            …
                                                            ,
                                                            
                                                               e
                                                               
                                                                  2
                                                                  p
                                                               
                                                            
                                                            }
                                                         
                                                         .
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 

For sufficiently small ε > 0 both (x + εχO, y) and (x − εχO, y) are feasible solutions, contradicting the fact that (x, y) is a vertex.

The idea is similar to (a). Consider any connected component B of H. Suppose for contradiction that we have two facilities i
                                    1, i
                                    2 in B with 
                                       
                                          0
                                          <
                                          
                                             ∑
                                             
                                                j
                                                ∈
                                                D
                                             
                                          
                                          
                                             x
                                             
                                                
                                                   i
                                                   1
                                                
                                                j
                                             
                                          
                                          <
                                          s
                                          ,
                                          0
                                          <
                                          
                                             ∑
                                             
                                                j
                                                ∈
                                                D
                                             
                                          
                                          
                                             x
                                             
                                                
                                                   i
                                                   2
                                                
                                                j
                                             
                                          
                                          <
                                          s
                                       
                                    . Since B is connected, there is a path P = (e
                                    1, e
                                    2, …, e
                                    2p − 1, e
                                    2p
                                    ) from i
                                    1 to i
                                    2. Again, we can construct two feasible solutions (x + εχP, y) and (x − εχP, y), contradicting the fact that (x, y) is a vertex.

Consider any connected component of H with at least one edge. Note that each component is a tree with 0 < xij
                                     < s for each edge {i, j}. If there is a facility i* in this component with 
                                       
                                          0
                                          <
                                          
                                             ∑
                                             
                                                j
                                                ∈
                                                D
                                             
                                          
                                          
                                             x
                                             
                                                
                                                   i
                                                   *
                                                
                                                j
                                             
                                          
                                          <
                                          s
                                          ,
                                       
                                     then take i* as the root. Otherwise, take an arbitrary facility as the root. Since 0 < xij
                                     < s for each edge {i, j} and ∑
                                       j ∈ D
                                    
                                    xij
                                     = s for each facility i ≠ i*, each facility except i* has at least two neighbors. Then, each facility in this connected component has at least one child (client) as each facility has at most one parent. Moreover, no two facilities have a common child (by the definition of a rooted tree). Therefore, the number of facilities in each connected component is at most the number of clients. Thus, we have at most m facilities in H as there are at most m clients. Clearly, the number of edges is at most 2m − 1 since H is a forest.


                           □

Let G = (V, E) be the graph corresponding to a vertex (x, y) of the convex hull of feasible solutions of the MIP to CKFLU, and 
                              
                                 H
                                 =
                                 (
                                 
                                    V
                                    ¯
                                 
                                 ,
                                 
                                    E
                                    ¯
                                 
                                 )
                              
                            be its corresponding untight subgraph. Given the set 
                              
                                 I
                                 =
                                 {
                                 i
                                 ∈
                                 F
                                 ∩
                                 
                                    V
                                    ¯
                                 
                                 ∣
                                 0
                                 <
                                 
                                    ∑
                                    
                                       j
                                       ∈
                                       D
                                    
                                 
                                 
                                    x
                                    
                                       i
                                       j
                                    
                                 
                                 <
                                 s
                                 }
                              
                            and 
                              
                                 
                                    E
                                    ¯
                                 
                                 ,
                              
                            we can get the unique weight xij
                            for each edge 
                              
                                 
                                    {
                                    i
                                    ,
                                    j
                                    }
                                 
                                 ∈
                                 
                                    E
                                    ¯
                                 
                              
                            in O(m) time.

Consider any connected component of H. Note that each connected component must be in the form of a tree. If there is a facility i* ∈ I in this component, then take i* as the root. Otherwise, take an arbitrary facility i* in this component as the root. Then, all leaves are clients since ∑
                              j ∈ D
                           
                           xij
                            = s for each facility i ≠ i* in the considered connected component (Lemma 3(b)) and 0 < xij
                            < s for each edge {i, j}.

We will show that in each connected component, if node (client) j is a leaf, we can obtain the exact value of xij
                           , where i is the father of j; and for each other node in this tree, we can compute the value of the edge between this node and its father based on the values of edges between this node and its children. Then, we can obtain the values of all edges in the tree by induction.

Consider a client j. Let f(j) be the father node (facility) of j in the tree and c(j) be the set of children (facilities) of j. If j is a leaf, that is c(j) = ∅, then we know |{i ∈ F∣0 < xij
                            < s}| = 1. Otherwise, j cannot be a leaf. Thus, we can get the exact value for 
                              
                                 
                                    x
                                    
                                       f
                                       (
                                       j
                                       )
                                       ,
                                       j
                                    
                                 
                                 =
                                 
                                    d
                                    j
                                 
                                 −
                                 
                                    ⌊
                                    
                                       
                                          d
                                          j
                                       
                                       s
                                    
                                    ⌋
                                 
                                 ·
                                 s
                              
                            since j has exactly one father. If j is not a leaf, the value 
                              
                                 
                                    x
                                    
                                       f
                                       (
                                       j
                                       )
                                       ,
                                       j
                                    
                                 
                                 =
                                 
                                    (
                                    
                                       d
                                       j
                                    
                                    −
                                    
                                       ∑
                                       
                                          i
                                          ∈
                                          c
                                          (
                                          j
                                          )
                                       
                                    
                                    
                                       x
                                       
                                          i
                                          j
                                       
                                    
                                    )
                                 
                                 −
                                 
                                    ⌊
                                    
                                       
                                          
                                             d
                                             j
                                          
                                          −
                                          
                                             ∑
                                             
                                                i
                                                ∈
                                                c
                                                (
                                                j
                                                )
                                             
                                          
                                          
                                             x
                                             
                                                i
                                                j
                                             
                                          
                                       
                                       s
                                    
                                    ⌋
                                 
                                 ·
                                 s
                              
                            as 
                              
                                 
                                    x
                                    
                                       t
                                       j
                                    
                                 
                                 ∈
                                 
                                    {
                                    0
                                    ,
                                    s
                                    }
                                 
                                 ,
                                 ∀
                                 t
                                 ∈
                                 V
                                 ∖
                                 
                                    V
                                    ¯
                                 
                              
                           .

Consider a facility i ≠ i*. Let f(i) be the father node (client) of i in the tree and c(i) be the set of children (clients) of i. We can obtain the value of x
                           
                              i, f(i) as long as all values of xij, j ∈ c(i) are known, since i must be fully used by Lemma 3. That is, x
                           
                              i, f(i) = s − ∑
                              j ∈ c(i)
                           xij
                           . Note that if i = i*, we can stop since f(i*) = ∅.

Moreover, the computing time is O(m) since each edge is examined at most twice.□

Consider an optimal vertex (x, y) of the convex hull of feasible solutions for CKFLU whose corresponding graph G = (V, E) is a forest. The graph 
                        
                           H
                           =
                           (
                           
                              V
                              ¯
                           
                           ,
                           
                              E
                              ¯
                           
                           )
                        
                      (the untight subgraph of G) can be viewed as a subgraph of some spanning tree of the complete bipartite graph 
                        
                           
                              K
                              
                                 
                                    F
                                    ¯
                                 
                                 ,
                                 D
                              
                           
                           ,
                        
                      where 
                        
                           
                              F
                              ¯
                           
                           =
                           F
                           ∩
                           
                              V
                              ¯
                           
                        
                     . Consequently, checking all the possible structures of H means checking all the subgraphs of these spanning trees. Note that H and 
                        
                           K
                           
                              
                                 F
                                 ¯
                              
                              ,
                              D
                           
                        
                      have the same vertices. Then, in order to prove Theorem 2, it now suffices to answer the following questions:

                        
                           1.
                           How many different choices do we have for 
                                 
                                    K
                                    
                                       
                                          F
                                          ¯
                                       
                                       ,
                                       D
                                    
                                 
                              ?

How to list all the spanning trees for a complete bipartite graph?

How many subgraphs, that have the same vertices as the considered spanning tree, does a spanning tree have?

For a fixed structure of H, how to compute the corresponding total cost?

If all the above questions can be solved in polynomial time, we can get all the possibilities of H in polynomial time. Consequently, Theorem 2 can be proved by Lemmas 2 and 4.

                        Lemma 5
                        
                           Kapoor and Ramesh, 1995
                        


                        For an undirected graph without weights G = (V, E), all spanning trees can be correctly generated in O(N + |V| + |E|) time, where N is the number of spanning trees.

The number of spanning trees of a complete bipartite graph is m
                           
                              n − 1
                           n
                           
                              m − 1, where m and n are respectively the cardinalities of two disjoint sets in this bipartite graph.

Since 
                                 
                                    H
                                    =
                                    (
                                    
                                       V
                                       ¯
                                    
                                    ,
                                    
                                       E
                                       ¯
                                    
                                    )
                                 
                               contains at most m facilities by Lemma 3, the number of all the possible cases for 
                                 
                                    K
                                    
                                       
                                          F
                                          ¯
                                       
                                       ,
                                       D
                                    
                                 
                               can be bounded by 
                                 
                                    
                                       ∑
                                       
                                          t
                                          =
                                          1
                                       
                                       m
                                    
                                    
                                       (
                                       
                                          n
                                          t
                                       
                                       )
                                    
                                    ≤
                                    m
                                    ·
                                    
                                       n
                                       m
                                    
                                 
                              . So, we can answer question 1.


                              Lemmas 5 and 6 answer question 2. The time to list all the spanning trees for the complete bipartite graph is O(m
                              2m − 2 + 2m + m
                              2) since we have at most m facilities and m clients in 
                                 
                                    K
                                    
                                       
                                          F
                                          ¯
                                       
                                       ,
                                       D
                                    
                                 
                               by Lemma 3. Note that at this stage, we do not need to consider the weight xij
                               of edge {i, j}.

By Lemma 3, we know that the number of edges is at most 2m − 1 in a spanning tree. Thus, each spanning tree has at most 22m − 1 subgraphs that have the same vertices as the spanning tree. This answers question 3.

Then, the total time to list all the possible untight subgraphs is O(m · nm
                               · (m
                              2m − 2 + 2m + m
                              2) · 22m − 1).

By Lemma 4, we can get the cost for any untight subgraph in polynomial time O(m) as long as 
                                 
                                    I
                                    =
                                    {
                                    i
                                    ∈
                                    F
                                    ∩
                                    
                                       V
                                       ¯
                                    
                                    ∣
                                    0
                                    <
                                    
                                       ∑
                                       
                                          j
                                          ∈
                                          D
                                       
                                    
                                    
                                       x
                                       
                                          i
                                          j
                                       
                                    
                                    <
                                    s
                                    }
                                 
                               is fixed. Note that the opening costs for facilities are easy to get if we know the structure of H. Indeed, it is 
                                 
                                    
                                       ∑
                                       
                                          i
                                          ∈
                                          F
                                          ∩
                                          
                                             V
                                             ¯
                                          
                                       
                                    
                                    
                                       f
                                       i
                                    
                                 
                              . The remaining part 
                                 
                                    (
                                    V
                                    ,
                                    E
                                    ∖
                                    
                                       E
                                       ¯
                                    
                                    )
                                 
                               can be considered as an optimal integer solution to a divisible CKFLU, which means we can get the total cost in polynomial time O(n
                              3) + O(m) by Lemma 2. This answers question 4. Moreover, the number of all the choices for I is bounded by 2
                                 m
                               since there are at most m facilities in each spanning tree by Lemma 3.

Combining all the pieces together, we can get all the possibilities of solutions in computing time O(m · nm
                               · (m
                              2m − 2 + 2m + m
                              2) · 22m − 1 · 2
                                 m
                               · (m + n
                              3)) = O(nm
                               · (m
                              2m − 1 + 2m
                              2 + m
                              3) · 23m − 1 · (m + n
                              3)), that is, O(nm
                               · n
                              3) since m is fixed. Finally, we output the solution with at most k open facilities and the smallest total cost.

In this section, we show how to bound the number of fractionally open facilities by a simple rank-counting argument on an extreme point solution. Then, together with an algorithm to group clients, we give a pseudo-approximation algorithm for the hard CKFL (with uniform opening costs) with approximation ratio 7 + ε by using at most 2k facilities. Finally, we extend this algorithm to improve the previous best approximation ratio for the capacitated facility location problem with uniform opening costs.

As a simple illustration of the techniques used, we first give a 2-approximation algorithm for the single-sink hard capacitated k-facility location problem (SCKFL). Note that this ratio is worse than that of the FPTAS in Section 2. Here we aim to show that this upper bound is helpful to design approximation algorithms. And the approach is totally different from the FPTAS.


                           
                              Definition 1
                              Let Ax ≤ a, Bx ≥ b, Cx = c be a system of linear (in)equalities. For a feasible solution z we define the rank at z of the system to be the (row)rank of 
                                    
                                       
                                          
                                             [
                                             
                                                
                                                   
                                                      
                                                         A
                                                         z
                                                         T
                                                      
                                                   
                                                   
                                                      
                                                         B
                                                         z
                                                         T
                                                      
                                                   
                                                   
                                                      
                                                         C
                                                         T
                                                      
                                                   
                                                
                                             
                                             ]
                                          
                                          T
                                       
                                       ,
                                    
                                  where Azx ≤ az, Bzx ≥ bz, Cx = c is the subsystem consisting of the (in)equalities that are satisfied with equality by z.

Note that for two subsystems, the sum of the ranks at z of those two subsystems is at least the rank at z of their union.

Let P be the set of feasible solutions to the system SCKFL-LP consisting of (7), (9), (11) and ∑
                              i ∈ F
                           
                           yi
                            = k (Note that in this section we consider constraint ∑
                              i ∈ F
                           
                           yi
                            = k instead of the corresponding inequality (10)). That is,

                              
                                 
                                    
                                       P
                                       :
                                       =
                                       {
                                       (
                                       x
                                       ,
                                       y
                                       )
                                       :
                                       SCKFL-LP
                                       }
                                       ,
                                    
                                 
                              
                           where SCKFL-LP is a system of constraints given below:

                              
                                 (15)
                                 
                                    
                                       
                                          
                                          
                                             
                                                
                                                   ∑
                                                   
                                                      i
                                                      ∈
                                                      F
                                                   
                                                
                                                
                                                   x
                                                   i
                                                
                                                =
                                                d
                                                ,
                                                
                                                
                                                   ∑
                                                   
                                                      i
                                                      ∈
                                                      F
                                                   
                                                
                                                
                                                   y
                                                   i
                                                
                                             
                                          
                                          
                                          
                                             
                                                =
                                                k
                                                ,
                                             
                                          
                                       
                                    
                                 
                              
                           
                           
                              
                                 
                                    
                                       
                                          
                                          
                                             
                                                0
                                                ≤
                                                
                                                   x
                                                   i
                                                
                                                ≤
                                                
                                                   s
                                                   i
                                                
                                                
                                                   y
                                                   i
                                                
                                                ,
                                             
                                          
                                          
                                          
                                             
                                                ∀
                                                i
                                                ∈
                                                F
                                                ,
                                             
                                          
                                       
                                       
                                          
                                          
                                             
                                                0
                                                ≤
                                                
                                                   y
                                                   i
                                                
                                                ≤
                                                1
                                                ,
                                             
                                          
                                          
                                          
                                             
                                                ∀
                                                i
                                                ∈
                                                F
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           
                           
                              Lemma 7
                              Let (x, y) be a vertex of P. Then either y is integer, or y has exactly two noninteger components and for every i ∈ F we have xi
                                  = 0 or xi
                                  = siyi
                                 .

Let F′ ≔ {i ∈ F∣0 < yi
                                  < 1}. If |F′| = 0 we are done. As |F′| = 1 is ruled out because the sum of the yi
                                  is 
                                    
                                       k
                                       ,
                                       k
                                       ∈
                                       Z
                                       ,
                                    
                                  we may assume that |F′| ≥ 2.

The rank of system SCKFL-LP at (x, y) is equal to 2n, n = |F| (Theorem 5.7 in Schrijver, 2003). We partition the (in)equalities in this system and bound the rank at (x, y) for each subsystem:

                                    
                                       •
                                       The rank at (x, y) of the subsystem ∑
                                             i ∈ F
                                          
                                          xi
                                           = d, ∑
                                             i ∈ F
                                          
                                          yi
                                           = k is at most 2.

For every i ∈ F′, the rank at (x, y) of the subsystem 0 ≤ xi, xi
                                           ≤ siyi
                                          , 0 ≤ yi, yi
                                           ≤ 1 is at most 1 and equality holds if and only if xi
                                           = 0 or xi
                                           = siyi
                                          .

For every i ∈ F∖F′, the rank at (x, y) of the subsystem 0 ≤ xi, xi
                                           ≤ siyi
                                          , 0 ≤ yi, yi
                                           ≤ 1 is at most 2 and equality holds if and only if xi
                                           = 0 or xi
                                           = siyi
                                          .

Since the rank is subadditive, we find that the rank at (x, y) of SCKFL-LP is at most

                                    
                                       
                                          
                                             
                                                2
                                                +
                                                |
                                             
                                             
                                                F
                                                ′
                                             
                                             
                                                |
                                                +
                                                2
                                                |
                                                F
                                                ∖
                                             
                                             
                                                F
                                                ′
                                             
                                             
                                                |
                                                =
                                                2
                                                n
                                                +
                                                2
                                                −
                                                |
                                             
                                             
                                                F
                                                ′
                                             
                                             
                                                |
                                                ≤
                                                2
                                                n
                                                ,
                                             
                                          
                                       
                                    
                                 where the inequality holds as |F′| ≥ 2, with equality only if |F′| = 2 and for each i we have xi
                                  = 0 or xi
                                  = siyi
                                 .□

We give a 2-approximation algorithms for SCKFL to show the potential power of this nice structure.

We give an alternative approach to get an approximate solution for SCKFL, compared to the FPTAS in Section 2. This approach can be viewed as incomplete implement of a branch and bound technique, branching on the 0-1 variables yi
                           . To obtain a 2-approximation algorithm that runs in polynomial time, we use two key ideas. First, by Lemma 7, we know that in any vertex of the feasible region of the LP-relaxation either 0 or 2 components of y are fractional. We exploit this to guide the branching. Secondly, we show that for a branch yi
                            = 1 either there is no 2-approximation solution, or we can find a 2-approximation solution in polynomial time by again exploiting the structure of the vertices of the feasible region to the LP-relaxation. A precise description of this algorithm is given in Algorithm 2
                           .

                              Theorem 3
                              For the single-sink hard capacitated k-facility location problem, Algorithm 2 finds a solution that is within a factor 2 of optimum, or it concludes correctly that there is no feasible solution. The running time is polynomially bounded in the number |F| of facilities.

Notice that an optimal vertex of the feasible region of the LP-relaxation can be found in polynomial time (see for instance Grötschel et al., 1988). Furthermore, since the number of recursive calls is no more than |F| − 1, the polynomial running time is evident. It now suffices to show that when the MIP: (8), (11), (12), and (15) is feasible, the solution given by Algorithm 2 is within a factor 2 of optimum.

Clearly, if y is integer in Step 1 of Algorithm 2, then the output (x, y) is an optimal feasible solution. Hence, by Lemma 7, we may assume that y has exactly two fractional components 
                                    
                                       y
                                       
                                          i
                                          1
                                       
                                    
                                  and 
                                    
                                       y
                                       
                                          i
                                          2
                                       
                                    
                                 . Then, we know 
                                    
                                       
                                          y
                                          
                                             i
                                             1
                                          
                                       
                                       +
                                       
                                          y
                                          
                                             i
                                             2
                                          
                                       
                                       =
                                       1
                                    
                                  since ∑
                                    i ∈ F
                                 
                                 yi
                                  = k, and all yi, i ∈ F are integer except 
                                    
                                       y
                                       
                                          i
                                          1
                                       
                                    
                                  and 
                                    
                                       y
                                       
                                          i
                                          2
                                       
                                    
                                 . Without loss of generality we can assume that 
                                    
                                       
                                          s
                                          
                                             i
                                             1
                                          
                                       
                                       ≥
                                       
                                          s
                                          
                                             i
                                             2
                                          
                                       
                                    
                                 .

To see that (x
                                 1, y
                                 1) defined in Step 3 of Algorithm 2 is indeed a feasible solution, it suffices to show that 
                                    
                                       
                                          x
                                          
                                             i
                                             1
                                          
                                          1
                                       
                                       ≤
                                       
                                          s
                                          
                                             i
                                             1
                                          
                                       
                                    
                                 . This follows directly from the fact that 
                                    
                                       
                                          s
                                          
                                             i
                                             1
                                          
                                       
                                       ≥
                                       
                                          s
                                          
                                             i
                                             2
                                          
                                       
                                       ,
                                    
                                  since

                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         x
                                                         
                                                            i
                                                            1
                                                         
                                                         1
                                                      
                                                      =
                                                      
                                                         x
                                                         
                                                            i
                                                            1
                                                         
                                                      
                                                      +
                                                      
                                                         x
                                                         
                                                            i
                                                            2
                                                         
                                                      
                                                      ≤
                                                      
                                                         y
                                                         
                                                            i
                                                            1
                                                         
                                                      
                                                      
                                                         s
                                                         
                                                            i
                                                            1
                                                         
                                                      
                                                      +
                                                      
                                                         y
                                                         
                                                            i
                                                            2
                                                         
                                                      
                                                      
                                                         s
                                                         
                                                            i
                                                            2
                                                         
                                                      
                                                      ≤
                                                      
                                                         y
                                                         
                                                            i
                                                            1
                                                         
                                                      
                                                      
                                                         s
                                                         
                                                            i
                                                            1
                                                         
                                                      
                                                      +
                                                      
                                                         y
                                                         
                                                            i
                                                            2
                                                         
                                                      
                                                      
                                                         s
                                                         
                                                            i
                                                            1
                                                         
                                                      
                                                      =
                                                      
                                                         s
                                                         
                                                            i
                                                            1
                                                         
                                                      
                                                      .
                                                   
                                                
                                             
                                          
                                       
                                    
                                 Further, we find an upper bound for the value of (x
                                 1, y
                                 1),

                                    
                                       (16)
                                       
                                          
                                             
                                                c
                                                T
                                             
                                             
                                                x
                                                1
                                             
                                             +
                                             
                                                f
                                                T
                                             
                                             
                                                y
                                                1
                                             
                                             ≤
                                             
                                                (
                                                
                                                   c
                                                   T
                                                
                                                x
                                                +
                                                
                                                   f
                                                   T
                                                
                                                y
                                                )
                                             
                                             +
                                             
                                                (
                                                
                                                   c
                                                   
                                                      i
                                                      1
                                                   
                                                
                                                
                                                   s
                                                   
                                                      i
                                                      1
                                                   
                                                
                                                +
                                                
                                                   f
                                                   
                                                      i
                                                      1
                                                   
                                                
                                                )
                                             
                                             ,
                                          
                                       
                                    
                                 which is at most the optimum plus 
                                    
                                       
                                          c
                                          
                                             i
                                             1
                                          
                                       
                                       
                                          s
                                          
                                             i
                                             1
                                          
                                       
                                       +
                                       
                                          f
                                          
                                             i
                                             1
                                          
                                       
                                    
                                 .

To conclude the proof, we analyze Step 5 of Algorithm 2. Observe that the initial solution (x
                                 0, y
                                 0) may be replaced, but only by a better solution. Also observe, that the solution that is returned is always at least as good as (x
                                 0, y
                                 0) and (x
                                 1, y
                                 1). Hence, we may assume that (x
                                 0, y
                                 0) (at the end of the algorithm) and (x
                                 1, y
                                 1) are not 2-approximations. Let (x*, y*) be an optimal solution. We have 
                                    
                                       
                                          y
                                          
                                             i
                                             1
                                          
                                          *
                                       
                                       =
                                       1
                                       ,
                                    
                                  since otherwise (x
                                 0, y
                                 0) would be a 2-approximation already at Step 4. It suffices to show that (x*, y*) remains feasible throughout the iterations of Step 5, until a solution of the same value is returned in Step 5b. For this, we observe that while (x*, y*) is feasible, the situation 
                                    
                                       
                                          x
                                          
                                             i
                                             1
                                          
                                          ′
                                       
                                       =
                                       
                                          s
                                          
                                             i
                                             1
                                          
                                       
                                    
                                  as in Step 5c cannot occur, because otherwise, by (16), we would have

                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         c
                                                         T
                                                      
                                                      
                                                         x
                                                         1
                                                      
                                                      +
                                                      
                                                         f
                                                         T
                                                      
                                                      
                                                         y
                                                         1
                                                      
                                                   
                                                
                                                
                                                   ≤
                                                
                                                
                                                   
                                                      
                                                         c
                                                         T
                                                      
                                                      x
                                                      +
                                                      
                                                         f
                                                         T
                                                      
                                                      y
                                                      +
                                                      
                                                         (
                                                         
                                                            c
                                                            
                                                               i
                                                               1
                                                            
                                                         
                                                         
                                                            s
                                                            
                                                               i
                                                               1
                                                            
                                                         
                                                         +
                                                         
                                                            f
                                                            
                                                               i
                                                               1
                                                            
                                                         
                                                         )
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                
                                                   ≤
                                                
                                                
                                                   
                                                      
                                                         c
                                                         T
                                                      
                                                      x
                                                      +
                                                      
                                                         f
                                                         T
                                                      
                                                      y
                                                      +
                                                      
                                                         c
                                                         T
                                                      
                                                      
                                                         x
                                                         ′
                                                      
                                                      +
                                                      
                                                         f
                                                         T
                                                      
                                                      
                                                         y
                                                         ′
                                                      
                                                      ≤
                                                      2
                                                      
                                                         (
                                                         
                                                            c
                                                            T
                                                         
                                                         
                                                            x
                                                            *
                                                         
                                                         +
                                                         
                                                            f
                                                            T
                                                         
                                                         
                                                            y
                                                            *
                                                         
                                                         )
                                                      
                                                      ,
                                                   
                                                
                                             
                                          
                                       
                                    
                                 contradicting the fact that (x
                                 1, y
                                 1) is not a 2-approximation.

In Step 5d, the fact that y′ has exactly two fractional components follows from Lemma 7 as y′ is a vertex of a face of the feasible region of SCKFL-LP, and hence of that region itself. Observe that this implies that 
                                    
                                       
                                          y
                                          
                                             i
                                             3
                                          
                                          ′
                                       
                                       +
                                       
                                          y
                                          
                                             i
                                             4
                                          
                                          ′
                                       
                                       =
                                       1
                                    
                                 . Moreover, 
                                    
                                       
                                          x
                                          
                                             i
                                             1
                                          
                                          ′
                                       
                                       =
                                       0
                                    
                                  again by Lemma 7 since 
                                    
                                       
                                          x
                                          
                                             i
                                             1
                                          
                                          ′
                                       
                                       ≠
                                       
                                          s
                                          
                                             i
                                             1
                                          
                                       
                                    
                                  in this step. Hence (x′, y′′) defined in Step 5e is a feasible solution.

In Step 5f, we have 
                                    
                                       
                                          y
                                          
                                             i
                                             4
                                          
                                          *
                                       
                                       =
                                       0
                                    
                                 . Indeed, for the cost of (x′, y′′) we find:

                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         c
                                                         T
                                                      
                                                      
                                                         x
                                                         ′
                                                      
                                                      +
                                                      
                                                         f
                                                         T
                                                      
                                                      
                                                         y
                                                         
                                                            ′
                                                            ′
                                                         
                                                      
                                                   
                                                
                                                
                                                   =
                                                
                                                
                                                   
                                                      
                                                         (
                                                         
                                                            c
                                                            T
                                                         
                                                         
                                                            x
                                                            ′
                                                         
                                                         +
                                                         
                                                            f
                                                            T
                                                         
                                                         
                                                            y
                                                            ′
                                                         
                                                         )
                                                      
                                                      −
                                                      
                                                         f
                                                         
                                                            i
                                                            1
                                                         
                                                      
                                                      +
                                                      
                                                         (
                                                         1
                                                         −
                                                         
                                                            y
                                                            
                                                               i
                                                               3
                                                            
                                                            ′
                                                         
                                                         )
                                                      
                                                      
                                                         f
                                                         
                                                            i
                                                            3
                                                         
                                                      
                                                      +
                                                      
                                                         (
                                                         1
                                                         −
                                                         
                                                            y
                                                            
                                                               i
                                                               4
                                                            
                                                            ′
                                                         
                                                         )
                                                      
                                                      
                                                         f
                                                         
                                                            i
                                                            4
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                
                                                   ≤
                                                
                                                
                                                   
                                                      
                                                         (
                                                         
                                                            c
                                                            T
                                                         
                                                         
                                                            x
                                                            ′
                                                         
                                                         +
                                                         
                                                            f
                                                            T
                                                         
                                                         
                                                            y
                                                            ′
                                                         
                                                         )
                                                      
                                                      −
                                                      
                                                         f
                                                         
                                                            i
                                                            1
                                                         
                                                      
                                                      +
                                                      
                                                         (
                                                         1
                                                         −
                                                         
                                                            y
                                                            
                                                               i
                                                               3
                                                            
                                                            ′
                                                         
                                                         +
                                                         1
                                                         −
                                                         
                                                            y
                                                            
                                                               i
                                                               4
                                                            
                                                            ′
                                                         
                                                         )
                                                      
                                                      
                                                         f
                                                         
                                                            i
                                                            4
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                
                                                   ≤
                                                
                                                
                                                   
                                                      
                                                         (
                                                         
                                                            c
                                                            T
                                                         
                                                         
                                                            x
                                                            ′
                                                         
                                                         +
                                                         
                                                            f
                                                            T
                                                         
                                                         
                                                            y
                                                            ′
                                                         
                                                         )
                                                      
                                                      +
                                                      
                                                         f
                                                         
                                                            i
                                                            4
                                                         
                                                      
                                                      ≤
                                                      
                                                         (
                                                         
                                                            c
                                                            T
                                                         
                                                         
                                                            x
                                                            *
                                                         
                                                         +
                                                         
                                                            f
                                                            T
                                                         
                                                         
                                                            y
                                                            *
                                                         
                                                         )
                                                      
                                                      +
                                                      
                                                         f
                                                         
                                                            i
                                                            4
                                                         
                                                      
                                                      .
                                                   
                                                
                                             
                                          
                                       
                                    
                                 Since (x
                                 0, y
                                 0) and hence (x′, y′′) is not a 2-approximation, we find that 
                                    
                                       
                                          f
                                          
                                             i
                                             4
                                          
                                       
                                       >
                                       
                                          c
                                          T
                                       
                                       
                                          x
                                          *
                                       
                                       +
                                       
                                          f
                                          T
                                       
                                       
                                          y
                                          *
                                       
                                    
                                  and hence 
                                    
                                       
                                          y
                                          
                                             i
                                             4
                                          
                                          *
                                       
                                       =
                                       0
                                    
                                 . This shows that (x*, y*) remains feasible after adding i
                                 4 to F
                                 0.□

In this section, we consider the capacitated k-facility location problem with uniform opening costs, i.e., fi
                         = f, i ∈ F. Since we have an upper bound on the number of fractionally open facilities based on Lemma 8 below, a natural idea is to design a constant factor approximation algorithm for CKFL by relaxing the cardinality constraint with a constant factor. We give a simple algorithmic framework that can extend any α-approximation algorithm for the (uncapacitated) k-median problem (UKM) to a (1 + 2α)-approximation algorithm for CKFL using at most 2k facilities (2k − 1 for uniform capacities).

The (uncapacitated) k-median problem (UKM) can be formulated as follows, where variable xij
                         indicates the fraction of the demand of client j that is served by facility i, and yi
                         indicates whether facility i is open.

                           
                              
                                 
                                    
                                       
                                          
                                             min
                                             
                                          
                                       
                                       
                                          
                                             
                                                ∑
                                                
                                                   i
                                                   ∈
                                                   F
                                                
                                             
                                             
                                                
                                                   ∑
                                                   
                                                      j
                                                      ∈
                                                      D
                                                   
                                                
                                                
                                                   
                                                      d
                                                      j
                                                   
                                                   
                                                      c
                                                      
                                                         i
                                                         j
                                                      
                                                   
                                                   
                                                      x
                                                      
                                                         i
                                                         j
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             subject
                                             
                                             to:
                                             
                                          
                                       
                                       
                                          
                                             
                                                ∑
                                                
                                                   i
                                                   ∈
                                                   F
                                                
                                             
                                             
                                                x
                                                
                                                   i
                                                   j
                                                
                                             
                                             =
                                             1
                                             ,
                                          
                                       
                                       
                                       
                                          
                                             ∀
                                             j
                                             ∈
                                             D
                                             ,
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                                x
                                                
                                                   i
                                                   j
                                                
                                             
                                             ≤
                                             
                                                y
                                                i
                                             
                                             ,
                                          
                                       
                                       
                                       
                                          
                                             ∀
                                             i
                                             ∈
                                             F
                                             ,
                                             ∀
                                             j
                                             ∈
                                             D
                                             ,
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                                ∑
                                                
                                                   i
                                                   ∈
                                                   F
                                                
                                             
                                             
                                                y
                                                i
                                             
                                             ≤
                                             k
                                             ,
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                                x
                                                
                                                   i
                                                   j
                                                
                                             
                                             ,
                                             
                                                y
                                                i
                                             
                                             ∈
                                             
                                                {
                                                0
                                                ,
                                                1
                                                }
                                             
                                             ,
                                          
                                       
                                       
                                       
                                          
                                             ∀
                                             i
                                             ∈
                                             F
                                             ,
                                             ∀
                                             j
                                             ∈
                                             D
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Let Q be the set of feasible solutions (x, y) to the system CKFL-LP consisting of (2), (3), (4), (5) and (7). That is,

                              
                                 
                                    
                                       Q
                                       :
                                       =
                                       {
                                       (
                                       x
                                       ,
                                       y
                                       )
                                       :
                                       CKFL-LP
                                       }
                                       ,
                                    
                                 
                              
                           where CKFL-LP is a system of constraints given below:

                              
                                 
                                    
                                       
                                          
                                          
                                             
                                                
                                                   ∑
                                                   
                                                      i
                                                      ∈
                                                      F
                                                   
                                                
                                                
                                                   x
                                                   
                                                      i
                                                      j
                                                   
                                                
                                                =
                                                
                                                   d
                                                   j
                                                
                                                ,
                                                
                                                ∀
                                                j
                                                ∈
                                                D
                                                ;
                                                
                                                
                                                   ∑
                                                   
                                                      i
                                                      ∈
                                                      F
                                                   
                                                
                                                
                                                   y
                                                   i
                                                
                                                ≤
                                                k
                                                ,
                                             
                                          
                                       
                                       
                                          
                                          
                                             
                                                
                                                   ∑
                                                   
                                                      j
                                                      ∈
                                                      D
                                                   
                                                
                                                
                                                   x
                                                   
                                                      i
                                                      j
                                                   
                                                
                                                ≤
                                                
                                                   s
                                                   i
                                                
                                                
                                                   y
                                                   i
                                                
                                                ,
                                                
                                                ∀
                                                i
                                                ∈
                                                F
                                                ,
                                             
                                          
                                       
                                       
                                          
                                          
                                             
                                                
                                                   x
                                                   
                                                      i
                                                      j
                                                   
                                                
                                                ≥
                                                0
                                                ,
                                                
                                                ∀
                                                i
                                                ∈
                                                F
                                                ,
                                                ∀
                                                j
                                                ∈
                                                D
                                                ,
                                             
                                          
                                       
                                       
                                          
                                          
                                             
                                                0
                                                ≤
                                                
                                                   y
                                                   i
                                                
                                                ≤
                                                1
                                                ,
                                                
                                                ∀
                                                i
                                                ∈
                                                F
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           
                           
                              Lemma 8
                              Let (x, y) be a vertex of Q. Then y has at most m + 1 noninteger components, where m = |D|. And if the number of noninteger components is exactly m + 1, then xij
                                  = 0 or xij
                                  = siyi
                                  for each xij
                                 .

The proof is similar to the proof of Lemma 7. Let F′ = {i ∈ F∣0 < yi
                                  < 1}. The rank of system CKFL-LP at (x, y) is equal to (m + 1)n, n = |F|, m = |D| (Theorem 5.7 in Schrijver, 2003). We partition the (in)equalities in this system and bound the rank at (x, y) for each subsystem:

                                    
                                       •
                                       The rank at (x, y) of the subsystem ∑
                                             i ∈ F
                                          
                                          xij
                                           = dj
                                          , ∀j ∈ D; ∑
                                             i ∈ F
                                          
                                          yi
                                           ≤ k is at most m + 1.

For every i ∈ F′, the rank at (x, y) of the subsystem ∑
                                             j ∈ D
                                          
                                          xij
                                           ≤ siyi
                                          ; 0 ≤ xij, j ∈ D; 0 ≤ yi
                                          ; yi
                                           ≤ 1 is at most m and equality holds if and only if xij
                                           = 0 or xij
                                           = siyi
                                           for each xij
                                          .

For every i ∈ F∖F′, the rank at (x, y) of the subsystem ∑
                                             j ∈ D
                                          
                                          xij
                                           ≤ siyi
                                          ; 0 ≤ xij, j ∈ D; 0 ≤ yi
                                          ; yi
                                           ≤ 1 is at most m + 1 and equality holds if and only if xij
                                           = 0 or xij
                                           = siyi
                                           for each xij
                                          .

Since the rank is subadditive, we find that the rank of CKFL-LP is at most

                                    
                                       
                                          
                                             
                                                m
                                                +
                                                1
                                                +
                                                m
                                                |
                                             
                                             
                                                F
                                                ′
                                             
                                             
                                                |
                                                +
                                                
                                                   (
                                                   m
                                                   +
                                                   1
                                                   )
                                                
                                                |
                                                F
                                                ∖
                                             
                                             
                                                F
                                                ′
                                             
                                             
                                                |
                                                =
                                                m
                                                +
                                                1
                                                +
                                                
                                                   (
                                                   m
                                                   +
                                                   1
                                                   )
                                                
                                                n
                                                −
                                                |
                                             
                                             
                                                F
                                                ′
                                             
                                             
                                                |
                                                .
                                             
                                          
                                       
                                    
                                 So, we have |F′| ≤ m + 1 as m + 1 + (m + 1)n − |F′| ≥ (m + 1)n.□

For the uniform capacities case (si
                            = s > 0, ∀i ∈ F), we will show a stronger property that there is an optimal solution (x, y) to the LP-relaxation with at most m noninteger components in y. Indeed, consider an optimal solution (x, y) with |{i∣0 < yi
                            < 1}| minimal. Suppose for contradiction that y has more than m fractional components. Then there exist a client j and two facilities i
                           1, i
                           2 such that 
                              
                                 y
                                 
                                    i
                                    1
                                 
                              
                            and 
                              
                                 y
                                 
                                    i
                                    2
                                 
                              
                            are fractional and 
                              
                                 
                                    x
                                    
                                       
                                          i
                                          1
                                       
                                       j
                                    
                                 
                                 ,
                                 
                                    x
                                    
                                       
                                          i
                                          2
                                       
                                       j
                                    
                                 
                                 >
                                 0
                                 ,
                              
                            and 
                              
                                 
                                    x
                                    
                                       
                                          i
                                          1
                                       
                                       j
                                    
                                 
                                 =
                                 s
                                 
                                    y
                                    
                                       i
                                       1
                                    
                                 
                                 ,
                                 
                                    x
                                    
                                       
                                          i
                                          2
                                       
                                       j
                                    
                                 
                                 =
                                 s
                                 
                                    y
                                    
                                       i
                                       2
                                    
                                 
                              
                            by Lemma 8. Without loss of generality, we assume that 
                              
                                 
                                    c
                                    
                                       
                                          i
                                          1
                                       
                                       j
                                    
                                 
                                 ≤
                                 
                                    c
                                    
                                       
                                          i
                                          2
                                       
                                       j
                                    
                                 
                              
                           . Let 
                              
                                 ϵ
                                 :
                                 =
                                 min
                                 {
                                 s
                                 
                                    y
                                    
                                       i
                                       2
                                    
                                 
                                 ,
                                 s
                                 
                                    (
                                    1
                                    −
                                    
                                       y
                                       
                                          i
                                          1
                                       
                                    
                                    )
                                 
                                 }
                              
                           . Now modify (x, y) by setting

                              
                                 
                                    
                                       
                                          
                                          
                                          
                                             
                                                
                                                   x
                                                   
                                                      
                                                         i
                                                         1
                                                      
                                                      j
                                                   
                                                
                                                :
                                                =
                                                
                                                   x
                                                   
                                                      
                                                         i
                                                         1
                                                      
                                                      j
                                                   
                                                
                                                +
                                                ϵ
                                                
                                                
                                                   y
                                                   
                                                      i
                                                      1
                                                   
                                                
                                                :
                                                =
                                                
                                                   y
                                                   
                                                      i
                                                      1
                                                   
                                                
                                                +
                                                ϵ
                                                /
                                                s
                                             
                                          
                                       
                                       
                                          
                                          
                                          
                                             
                                                
                                                   x
                                                   
                                                      
                                                         i
                                                         2
                                                      
                                                      j
                                                   
                                                
                                                :
                                                =
                                                
                                                   x
                                                   
                                                      
                                                         i
                                                         2
                                                      
                                                      j
                                                   
                                                
                                                −
                                                ϵ
                                                
                                                
                                                   y
                                                   
                                                      i
                                                      2
                                                   
                                                
                                                :
                                                =
                                                
                                                   y
                                                   
                                                      i
                                                      2
                                                   
                                                
                                                −
                                                ϵ
                                                /
                                                s
                                                ,
                                             
                                          
                                       
                                    
                                 
                              
                           to obtain a new optimal solution, while |{i∣0 < yi
                            < 1}| decreases, a contradiction. Thus, we can find an optimal solution (x, y) to the LP-relaxation for which y has at most m noninteger components.

The high level idea is as follows. We convert our original instance to a new instance with at most k clients while incurring some bounded extra costs. Then, at most 2k facilities are (fractionally or fully) opened for the new instance according to Lemma 8. Finally, we simply open all the fractionally and fully opened facilities to get an integral solution. A detailed description of this algorithm is given in Algorithm 3
                           .

                              Theorem 4
                              By Algorithm 3, each α-approximation algorithm for UKM can be extended to get a (1 + 2α)-approximation algorithm for CKFL with uniform opening costs using at most 2k facilities.

Without loss of generality, we suppose that exactly k facilities are opened in an optimal solution to our original problem (as we check all the cases in our algorithm).

Let OPT(*) denote the optimal cost of the instance *. Let COST( ·, ·) be the total cost of the solution ( ·, ·). We consider the following instances and solutions.


                                 
                                    
                                       
                                          
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         I
                                                         0
                                                      
                                                   
                                                
                                                The original instance.
                                             
                                             
                                                
                                                   
                                                      
                                                         (
                                                         
                                                            x
                                                            *
                                                         
                                                         ,
                                                         
                                                            y
                                                            *
                                                         
                                                         )
                                                      
                                                   
                                                
                                                The obtained solution of our algorithm for instance 
                                                      
                                                         I
                                                         0
                                                      
                                                    while using at most 
                                                      
                                                         2
                                                         k
                                                      
                                                    facilities.
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         I
                                                         1
                                                      
                                                   
                                                
                                                The constructed instance in Step 1, that is a (uncapacitated) 
                                                      k
                                                   -median problem.
                                             
                                             
                                                
                                                   
                                                      
                                                         (
                                                         
                                                            x
                                                            ′
                                                         
                                                         ,
                                                         
                                                            y
                                                            ′
                                                         
                                                         )
                                                      
                                                   
                                                
                                                The obtained integral solution by 
                                                      α
                                                   -approx. alg. for instance 
                                                      
                                                         I
                                                         1
                                                      
                                                   .
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         I
                                                         2
                                                      
                                                   
                                                
                                                The constructed instance in Step 2 in which we have at most 
                                                      k
                                                    clients.
                                             
                                             
                                                
                                                   
                                                      
                                                         (
                                                         x
                                                         ,
                                                         y
                                                         )
                                                      
                                                   
                                                
                                                An optimal fractional solution of instance 
                                                      
                                                         I
                                                         2
                                                      
                                                   .
                                             
                                          
                                       
                                    
                                 
                              

Clearly, we have COST(x, y) ≤ OPT(I
                                 2), and COST(x′, y′) ≤ αOPT(I
                                 1).

By construction of instance I
                                 2, we have OPT(I
                                 0) + COST(x′, y′) ≥ OPT(I
                                 2). To see this, we will show that we can construct a feasible solution for I
                                 2 with total cost at most OPT(I
                                 0) + COST(x′, y′).

Consider any client j ∈ D. Let 
                                    
                                       
                                          F
                                          j
                                       
                                       =
                                       
                                          {
                                          i
                                          ∈
                                          F
                                          ∣
                                          
                                             x
                                             
                                                i
                                                j
                                             
                                             0
                                          
                                          >
                                          0
                                          }
                                       
                                    
                                  be the set of facilities which serve some positive amount of demand of j in an optimal solution (x
                                 0, y
                                 0) of instance I
                                 0. Let t be the facility that serves j in solution (x′, y′) of I
                                 1. Note that 
                                    
                                       
                                          ∑
                                          
                                             i
                                             ∈
                                             
                                                F
                                                j
                                             
                                          
                                       
                                       
                                          x
                                          
                                             i
                                             j
                                          
                                          0
                                       
                                       =
                                       
                                          x
                                          
                                             t
                                             j
                                          
                                          ′
                                       
                                       =
                                       
                                          d
                                          j
                                       
                                    
                                 . So, we can serve dj
                                  units of demand of the new client t in instance I
                                 2 by facilities Fj
                                 . That is, we can construct a feasible solution for I
                                 2 from (x
                                 0, y
                                 0) and (x′, y′), since the above operation works for any client j ∈ D.

Further, it is easy to bound the total cost of this constructed solution for I
                                 2. By triangle inequalities, we know that cij
                                  + ctj
                                  ≥ cit
                                 , where i ∈ Fj
                                 , as shown in Fig. 3
                                 . Since we open exactly k facilities in both the constructed solution for I
                                 2 and the solution (x
                                 0, y
                                 0) for I
                                 0, we get that the total cost of this constructed solution for I
                                 2 is at most OPT(I
                                 0) + COST(x′, y′). Then, we obtain

                                    
                                       
                                          
                                             O
                                             P
                                             T
                                             
                                                (
                                                
                                                   I
                                                   0
                                                
                                                )
                                             
                                             +
                                             C
                                             O
                                             S
                                             T
                                             
                                                (
                                                
                                                   x
                                                   ′
                                                
                                                ,
                                                
                                                   y
                                                   ′
                                                
                                                )
                                             
                                             ≥
                                             O
                                             P
                                             T
                                             
                                                (
                                                
                                                   I
                                                   2
                                                
                                                )
                                             
                                          
                                       
                                    
                                 since this constructed solution is impossible better than the optimal solution.

Moreover, we know that OPT(I
                                 0) ≥ OPT(I
                                 1) + kf.

We will prove

                                    
                                       
                                          
                                             C
                                             O
                                             S
                                             T
                                             
                                                (
                                                
                                                   x
                                                   *
                                                
                                                ,
                                                
                                                   y
                                                   *
                                                
                                                )
                                             
                                             ≤
                                             C
                                             O
                                             S
                                             T
                                             
                                                (
                                                
                                                   x
                                                   ′
                                                
                                                ,
                                                
                                                   y
                                                   ′
                                                
                                                )
                                             
                                             +
                                             C
                                             O
                                             S
                                             T
                                             
                                                (
                                                x
                                                ,
                                                y
                                                )
                                             
                                             +
                                             k
                                             f
                                             .
                                          
                                       
                                    
                                 
                              

We first show that we can obtain an integer solution for I
                                 2 with the total cost at most COST(x, y) + kf in Step 4 of Algorithm 3. We have |{i∣0 < yi
                                  < 1}| ≤ k + 1, since Lemma 8 still holds when ∑
                                    i ∈ F
                                 
                                 yi
                                  = k. Moreover, if |{i∣0 < yi
                                  < 1}| > 0, then |{i∣yi
                                  = 1}| ≤ k − 1. So, we open at most 2k facilities. Thus, the total cost of the obtained solution for I
                                 2 is at most COST(x, y) + kf.

Then, based on the above solution for I
                                 2 we can construct an integer solution for I
                                 0 by moving the demand of tr
                                 , which is located at the same position with facility r, back to all clients in 
                                    
                                       
                                          T
                                          r
                                       
                                       =
                                       
                                          {
                                          j
                                          ∈
                                          
                                             D
                                             ′
                                          
                                          |
                                          
                                             x
                                             
                                                r
                                                j
                                             
                                             ′
                                          
                                          =
                                          1
                                          }
                                       
                                    
                                  with increasing at most COST(x′, y′) cost as 
                                    
                                       C
                                       O
                                       S
                                       T
                                       
                                          (
                                          
                                             x
                                             ′
                                          
                                          ,
                                          
                                             y
                                             ′
                                          
                                          )
                                       
                                       =
                                       
                                          ∑
                                          
                                             r
                                             =
                                             1
                                          
                                          k
                                       
                                       
                                          
                                             ∑
                                             
                                                j
                                                ∈
                                                
                                                   D
                                                   ′
                                                
                                             
                                          
                                          
                                             
                                                d
                                                j
                                             
                                             
                                                c
                                                
                                                   r
                                                   ,
                                                   j
                                                
                                             
                                             
                                                x
                                                
                                                   r
                                                   ,
                                                   j
                                                
                                                ′
                                             
                                          
                                       
                                    
                                 . Therefore, the solution obtained by Step 4 has COST(x*, y*) ≤ COST(x′, y′) + COST(x, y) + kf.

Then, we have

                                    
                                       
                                          
                                             
                                                
                                                   
                                                      C
                                                      O
                                                      S
                                                      T
                                                      (
                                                      
                                                         x
                                                         *
                                                      
                                                      ,
                                                      
                                                         y
                                                         *
                                                      
                                                      )
                                                   
                                                
                                                
                                                   ≤
                                                
                                                
                                                   
                                                      C
                                                      O
                                                      S
                                                      T
                                                      
                                                         (
                                                         
                                                            x
                                                            ′
                                                         
                                                         ,
                                                         
                                                            y
                                                            ′
                                                         
                                                         )
                                                      
                                                      +
                                                      O
                                                      P
                                                      T
                                                      
                                                         (
                                                         
                                                            I
                                                            2
                                                         
                                                         )
                                                      
                                                      +
                                                      k
                                                      f
                                                   
                                                
                                             
                                             
                                                
                                                
                                                   =
                                                
                                                
                                                   
                                                      
                                                         (
                                                         O
                                                         P
                                                         T
                                                         
                                                            (
                                                            
                                                               I
                                                               2
                                                            
                                                            )
                                                         
                                                         −
                                                         C
                                                         O
                                                         S
                                                         T
                                                         
                                                            (
                                                            
                                                               x
                                                               ′
                                                            
                                                            ,
                                                            
                                                               y
                                                               ′
                                                            
                                                            )
                                                         
                                                         )
                                                      
                                                      +
                                                      2
                                                      C
                                                      O
                                                      S
                                                      T
                                                      
                                                         (
                                                         
                                                            x
                                                            ′
                                                         
                                                         ,
                                                         
                                                            y
                                                            ′
                                                         
                                                         )
                                                      
                                                      +
                                                      k
                                                      f
                                                   
                                                
                                             
                                             
                                                
                                                
                                                   ≤
                                                
                                                
                                                   
                                                      O
                                                      P
                                                      T
                                                      
                                                         (
                                                         
                                                            I
                                                            0
                                                         
                                                         )
                                                      
                                                      +
                                                      2
                                                      C
                                                      O
                                                      S
                                                      T
                                                      
                                                         (
                                                         
                                                            x
                                                            ′
                                                         
                                                         ,
                                                         
                                                            y
                                                            ′
                                                         
                                                         )
                                                      
                                                      +
                                                      k
                                                      f
                                                   
                                                
                                             
                                             
                                                
                                                
                                                   ≤
                                                
                                                
                                                   
                                                      O
                                                      P
                                                      T
                                                      
                                                         (
                                                         
                                                            I
                                                            0
                                                         
                                                         )
                                                      
                                                      +
                                                      2
                                                      α
                                                      O
                                                      P
                                                      T
                                                      
                                                         (
                                                         
                                                            I
                                                            1
                                                         
                                                         )
                                                      
                                                      +
                                                      k
                                                      f
                                                   
                                                
                                             
                                             
                                                
                                                
                                                   ≤
                                                
                                                
                                                   
                                                      O
                                                      P
                                                      T
                                                      
                                                         (
                                                         
                                                            I
                                                            0
                                                         
                                                         )
                                                      
                                                      +
                                                      2
                                                      α
                                                      
                                                         (
                                                         O
                                                         P
                                                         T
                                                         
                                                            (
                                                            
                                                               I
                                                               1
                                                            
                                                            )
                                                         
                                                         +
                                                         k
                                                         f
                                                         )
                                                      
                                                      ≤
                                                      
                                                         (
                                                         1
                                                         +
                                                         2
                                                         α
                                                         )
                                                      
                                                      O
                                                      P
                                                      T
                                                      
                                                         (
                                                         
                                                            I
                                                            0
                                                         
                                                         )
                                                      
                                                      .
                                                   
                                                
                                             
                                          
                                       
                                    
                                 That is, the approximation ratio is 1 + 2α.□

We can obtain the following result as there is a (3 + ε)-approximation algorithm for the (uncapacitated) k-median problem in Arya et al. (2001), and we can make sure that at most 2k − 1 facilities are opened in Step 4 if all capacities are equal.

                              Corollary 1
                              
                                 Algorithm 3 can get an integer solution within 7 + ε times of the optimal cost by using at most 2k facilities (2k − 1 facilities) for the hard capacitated k-facility location problem with uniform opening costs (with uniform opening costs and uniform capacities).

We show how to combine Algorithm 3 with the algorithm of Charikar and Guha (1999) for the uncapacitated facility location problem (UFL) to improve the approximation ratio for the capacitated facility location problem (CFL) with uniform opening costs. Recall that the capacitated facility location problem is a special case of CKFL with k = n = |F|. The uncapacitated facility location problem is a special case of CFL with si
                         = +∞, ∀i ∈ F. In this section, we only consider uniform opening costs. To simplify the description, sometimes we omit “with uniform opening costs” when we refer to the problems.

A (β, δ)-approximation algorithm for the (uncapacitated) k-median problem (UKM) outputs an integer solution by using at most δk facilities, with service cost at most β times the optimal total cost.

                           Theorem 5
                           Each (β, δ)-approximation algorithm for the k-median problem gives rise to a max {2β + 1, δ + 1}-approximation algorithm for the CFL with uniform opening costs.

A crucial observation is that if exactly k facilities are opened in the optimal solution for an instance I of CFL, then this solution is also an optimal solution to the corresponding instance of CKFL, where the input is the same as that in I but with an extra constraint that at most k facilities can be opened. Thus, if for each k = 1, …, n, n = |F| we can obtain the optimal solution for CKFL, then the solution with smallest total cost is the optimal solution for CFL.

Our algorithm for CFL is as follows: Repeat the 4 steps in Algorithm 3 for l ≔ 1, …, n, n = |F|. In each iteration, we consider the constraint ∑
                                 i ∈ F
                              
                              yi
                               ≤ l. Then, output the solution with smallest total cost.

To get a better approximation ratio for CFL, we replace the α-approximation algorithm for the k-median problem in Step 1 of Algorithm 3 by a (β, δ)-approximation algorithm. Then, for each iteration l, we obtain an integer solution for the instance I
                              1 with at most δl open facilities. Thus, we have at most δl clients in instance I
                              2.

Again, without loss of generality, we suppose that exactly k facilities are opened in an optimal solution for the original instance I
                              0.

We maintain all the notations in the proof of Theorem 4. Notice that COST(x, y) ≤ OPT(I
                              2), OPT(I
                              0) + COST(x′, y′) ≥ OPT(I
                              2) and OPT(I
                              0) ≥ OPT(I
                              1) + kf still hold. Moreover, COST(x′, y′) ≤ βOPT(I
                              1),

We will prove

                                 
                                    
                                       
                                          C
                                          O
                                          S
                                          T
                                          
                                             (
                                             
                                                x
                                                *
                                             
                                             ,
                                             
                                                y
                                                *
                                             
                                             )
                                          
                                          ≤
                                          C
                                          O
                                          S
                                          T
                                          
                                             (
                                             
                                                x
                                                ′
                                             
                                             ,
                                             
                                                y
                                                ′
                                             
                                             )
                                          
                                          +
                                          C
                                          O
                                          S
                                          T
                                          
                                             (
                                             x
                                             ,
                                             y
                                             )
                                          
                                          +
                                          δ
                                          k
                                          f
                                          .
                                       
                                    
                                 
                              
                           

The proof is similar to that in proof of Theorem 4. We first show that we can obtain an integer solution for I
                              2 with the total cost at most COST(x, y) + δkf in Step 4. Note that |{i∣0 < yi
                               < 1}| ≤ δk + 1, since Lemma 8 still holds when ∑
                                 i ∈ F
                              
                              yi
                               = k. So, at most (δ + 1)k facilities are opened at the end, since if |{i∣0 < yi
                               < 1}| > 0, then |{i∣yi
                               = 1}| ≤ k − 1. Thus, the total cost of the obtained solution for I
                              2 is at most COST(x, y) + δkf.

Then, by moving the demand of tr
                               back to all clients in 
                                 
                                    
                                       T
                                       r
                                    
                                    =
                                    
                                       {
                                       j
                                       ∈
                                       
                                          D
                                          ′
                                       
                                       |
                                       
                                          x
                                          
                                             r
                                             j
                                          
                                          ′
                                       
                                       =
                                       1
                                       }
                                    
                                    ,
                                 
                               we can construct an integer solution for I
                              0. This operation increases at most COST(x′, y′) cost as 
                                 
                                    C
                                    O
                                    S
                                    T
                                    
                                       (
                                       
                                          x
                                          ′
                                       
                                       ,
                                       
                                          y
                                          ′
                                       
                                       )
                                    
                                    =
                                    
                                       ∑
                                       
                                          r
                                          =
                                          1
                                       
                                       
                                          δ
                                          k
                                       
                                    
                                    
                                       
                                          ∑
                                          
                                             j
                                             ∈
                                             
                                                D
                                                ′
                                             
                                          
                                       
                                       
                                          
                                             d
                                             j
                                          
                                          
                                             c
                                             
                                                r
                                                ,
                                                j
                                             
                                          
                                          
                                             x
                                             
                                                r
                                                ,
                                                j
                                             
                                             ′
                                          
                                       
                                    
                                 
                              . Therefore, the solution obtained by Step 4 has COST(x*, y*) ≤ COST(x′, y′) + COST(x, y) + δkf.

Then, we have

                                 
                                    
                                       
                                          
                                             
                                                
                                                   C
                                                   O
                                                   S
                                                   T
                                                   (
                                                   
                                                      x
                                                      *
                                                   
                                                   ,
                                                   
                                                      y
                                                      *
                                                   
                                                   )
                                                
                                             
                                             
                                                ≤
                                             
                                             
                                                
                                                   C
                                                   O
                                                   S
                                                   T
                                                   
                                                      (
                                                      
                                                         x
                                                         ′
                                                      
                                                      ,
                                                      
                                                         y
                                                         ′
                                                      
                                                      )
                                                   
                                                   +
                                                   O
                                                   P
                                                   T
                                                   
                                                      (
                                                      
                                                         I
                                                         2
                                                      
                                                      )
                                                   
                                                   +
                                                   δ
                                                   k
                                                   f
                                                
                                             
                                          
                                          
                                             
                                             
                                                ≤
                                             
                                             
                                                
                                                   C
                                                   O
                                                   S
                                                   T
                                                   
                                                      (
                                                      
                                                         x
                                                         ′
                                                      
                                                      ,
                                                      
                                                         y
                                                         ′
                                                      
                                                      )
                                                   
                                                   +
                                                   O
                                                   P
                                                   T
                                                   
                                                      (
                                                      
                                                         I
                                                         0
                                                      
                                                      )
                                                   
                                                   +
                                                   C
                                                   O
                                                   S
                                                   T
                                                   
                                                      (
                                                      
                                                         x
                                                         ′
                                                      
                                                      ,
                                                      
                                                         y
                                                         ′
                                                      
                                                      )
                                                   
                                                   +
                                                   δ
                                                   k
                                                   f
                                                
                                             
                                          
                                          
                                             
                                             
                                                =
                                             
                                             
                                                
                                                   O
                                                   P
                                                   T
                                                   
                                                      (
                                                      
                                                         I
                                                         0
                                                      
                                                      )
                                                   
                                                   +
                                                   2
                                                   C
                                                   O
                                                   S
                                                   T
                                                   
                                                      (
                                                      
                                                         x
                                                         ′
                                                      
                                                      ,
                                                      
                                                         y
                                                         ′
                                                      
                                                      )
                                                   
                                                   +
                                                   δ
                                                   k
                                                   f
                                                
                                             
                                          
                                          
                                             
                                             
                                                ≤
                                             
                                             
                                                
                                                   O
                                                   P
                                                   T
                                                   
                                                      (
                                                      
                                                         I
                                                         0
                                                      
                                                      )
                                                   
                                                   +
                                                   2
                                                   β
                                                   O
                                                   P
                                                   T
                                                   
                                                      (
                                                      
                                                         I
                                                         1
                                                      
                                                      )
                                                   
                                                   +
                                                   δ
                                                   k
                                                   f
                                                
                                             
                                          
                                          
                                             
                                             
                                                ≤
                                             
                                             
                                                
                                                   O
                                                   P
                                                   T
                                                   
                                                      (
                                                      
                                                         I
                                                         0
                                                      
                                                      )
                                                   
                                                   +
                                                   2
                                                   β
                                                   
                                                      (
                                                      O
                                                      P
                                                      T
                                                      
                                                         (
                                                         
                                                            I
                                                            0
                                                         
                                                         )
                                                      
                                                      −
                                                      k
                                                      f
                                                      )
                                                   
                                                   +
                                                   δ
                                                   k
                                                   f
                                                
                                             
                                          
                                          
                                             
                                             
                                                ≤
                                             
                                             
                                                
                                                   
                                                      (
                                                      1
                                                      +
                                                      2
                                                      β
                                                      )
                                                   
                                                   
                                                      (
                                                      O
                                                      P
                                                      T
                                                      
                                                         (
                                                         
                                                            I
                                                            0
                                                         
                                                         )
                                                      
                                                      −
                                                      k
                                                      f
                                                      )
                                                   
                                                   +
                                                   
                                                      (
                                                      δ
                                                      +
                                                      1
                                                      )
                                                   
                                                   k
                                                   f
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              Recall that we assume that exactly k facilities are opened in the optimal solution to I
                              0. So, the total service cost of the optimal solution to I
                              0 is OPT(I
                              0) − kf. Then, COST(x*, y*) ≤ max {2β + 1, δ + 1}OPT(I
                              0).□

Let SOL be any solution to the uncapacitated facility location problem (possibly fractional), with facility cost FSOL
                               and service cost CSOL
                              . For any γ > 0, the local search heuristic proposed (together with scaling) gives a solution with facility cost at most 
                                 
                                    
                                       (
                                       1
                                       +
                                       
                                          2
                                          γ
                                       
                                       )
                                    
                                    
                                       F
                                       
                                          S
                                          O
                                          L
                                       
                                    
                                 
                               and service cost at most (1 + γ)CSOL
                              . The approximation is up to multiplicative factors of (1 + ε) for arbitrarily small ε > 0.

Based on Theorem 6, we can obtain the following corollary.

                           Corollary 2
                           For any γ > 0, there exists a 
                                 
                                    (
                                    
                                       (
                                       1
                                       +
                                       ϵ
                                       )
                                    
                                    
                                       (
                                       1
                                       +
                                       γ
                                       )
                                    
                                    ,
                                    
                                       (
                                       1
                                       +
                                       ϵ
                                       )
                                    
                                    
                                       (
                                       1
                                       +
                                       
                                          2
                                          γ
                                       
                                       )
                                    
                                    )
                                 
                              -approximation algorithm for the k-median problem, where ε > 0 can be arbitrarily small.

Let (x′, y′) be an optimal solution with total cost T to the LP relaxation of UKM. A crucial observation is that (x′, y′) is also a feasible fractional solution to the corresponding UFL with uniform opening cost f > 0. Let SOL = (x′, y′) with total facility cost FSOL
                               and total service cost CSOL
                              . Note that CSOL
                               = T and FSOL
                               ≤ kf.

Now, it is easy to see that, based on the Charikar and Guha algorithm (Charikar and Guha, 1999), we could get an integer solution with at most (1 + γ)(1 + ε) times the optimal cost while using at most 
                                 
                                    
                                       (
                                       1
                                       +
                                       
                                          2
                                          γ
                                       
                                       )
                                    
                                    
                                       (
                                       1
                                       +
                                       ϵ
                                       )
                                    
                                    k
                                 
                               facilities for the k-median problem. That is, there exists a 
                                 
                                    (
                                    
                                       (
                                       1
                                       +
                                       ϵ
                                       )
                                    
                                    
                                       (
                                       1
                                       +
                                       γ
                                       )
                                    
                                    ,
                                    
                                       (
                                       1
                                       +
                                       ϵ
                                       )
                                    
                                    
                                       (
                                       1
                                       +
                                       
                                          2
                                          γ
                                       
                                       )
                                    
                                    )
                                 
                              -approximation algorithm for the k-median problem, where ε > 0 can be arbitrarily small.□

The following theorem can be obtained by combining Corollary 2 with Theorem 5 and setting γ = 0.78078.

                           Theorem 7
                           There is a (4.562 + ε)-approximation algorithm for the capacitated facility location problem with uniform opening costs, where ε > 0 can be arbitrarily small.

@&#ACKNOWLEDGMENT@&#

The authors thank the editor and two anonymous referees for many useful comments on a previous version of the paper.

@&#REFERENCES@&#

