@&#MAIN-TITLE@&#Fast estimation of posterior probabilities in change-point analysis through a constrained hidden Markov model

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           We describe a method to assess uncertainty in a set of prespecified change-points.


                        
                        
                           
                           It obtains exact estimates of posterior probability of locations without resampling.


                        
                        
                           
                           A constrained hidden Markov model estimates probabilities in linear time.


                        
                        
                           
                           Methods are implemented in the R package postCP, available on CRAN.


                        
                        
                           
                           Simulations showed comparable loss to Bayesian implementation in estimating means.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Change-point estimation

Segmentation

Posterior distribution of change-points

Constrained hidden Markov model

Forward–backward algorithm

Fast computation

@&#ABSTRACT@&#


               
               
                  The detection of change-points in heterogeneous sequences is a statistical challenge with applications across a wide variety of fields. In bioinformatics, a vast amount of methodology exists to identify an ideal set of change-points for detecting Copy Number Variation (CNV). While considerable efficient algorithms are currently available for finding the best segmentation of the data in CNV, relatively few approaches consider the important problem of assessing the uncertainty of the change-point location. Asymptotic and stochastic approaches exist but often require additional model assumptions to speed up the computations, while exact methods generally have quadratic complexity which may be intractable for large data sets of tens of thousands points or more. A hidden Markov model, with constraints specifically chosen to correspond to a segment-based change-point model, provides an exact method for obtaining the posterior distribution of change-points with linear complexity. The methods are implemented in the R package postCP, which uses the results of a given change-point detection algorithm to estimate the probability that each observation is a change-point. The results include an implementation of postCP on a publicly available CNV data set 
                        
                           (
                           n
                           =
                           120
                           )
                        
                     . Due to its frequentist framework, postCP obtains less conservative confidence intervals than previously published Bayesian methods, but with linear complexity instead of quadratic. Simulations showed that postCP provided comparable loss to a Bayesian MCMC method when estimating posterior means, specifically when assessing larger scale changes, while being more computationally efficient. On another high-resolution CNV data set 
                        
                           (
                           n
                           =
                           14
                           ,
                           241
                           )
                        
                     , the implementation processed information in less than one second on a mid-range laptop computer.
               
            

@&#INTRODUCTION@&#

The detection of change-points in heterogeneous sequences is a statistical challenge with many applications in fields such as finance, reliability, signal analysis, neurosciences and biology (Pinkel et al., 1998; Snijders et al., 2001). In bioinformatics in particular, a vast amount of methodology (Olshen et al., 2004; Fridlyand et al., 2004; Hupé et al., 2004) exists for identifying an ideal set of change-points in data from array Comparative Genomic Hybridization (aCGH) techniques, in order to identify Copy Number Variation (CNV).

A typical expression of the change-point problem is as follows, given data 
                        X
                        =
                        
                           (
                           
                              
                                 X
                              
                              
                                 1
                              
                           
                           ,
                           
                              
                                 X
                              
                              
                                 2
                              
                           
                           ,
                           …
                           ,
                           
                              
                                 X
                              
                              
                                 n
                              
                           
                           )
                        
                      of real-valued observations, 
                        
                           (
                           
                              
                                 S
                              
                              
                                 1
                              
                           
                           ,
                           …
                           ,
                           
                              
                                 S
                              
                              
                                 n
                              
                           
                           )
                        
                      corresponding segment indices of the observations, and 
                        
                           
                              ℳ
                           
                           
                              K
                           
                        
                      as the set of all possible combinations of 
                        S
                      for fixed 
                        K
                        ⩾
                        2
                      number of segments. The goal is to find the best partitioning 
                        S
                        ∈
                        
                           
                              ℳ
                           
                           
                              K
                           
                        
                      into 
                        K
                      non-overlapping intervals, assuming that the distribution is homogeneous within each of these intervals.

For 
                        K
                      segments of contiguous observations, the segment-based model expresses the distribution of 
                        X
                      given a segmentation 
                        S
                        ∈
                        
                           
                              ℳ
                           
                           
                              K
                           
                        
                      as 
                        
                           (1)
                           
                              P
                              
                                 (
                                 X
                                 |
                                 S
                                 ;
                                 θ
                                 )
                              
                              =
                              
                                 
                                    ∏
                                 
                                 
                                    i
                                    =
                                    1
                                 
                                 
                                    n
                                 
                              
                              
                                 
                                    g
                                 
                                 
                                    
                                       
                                          θ
                                       
                                       
                                          
                                             
                                                S
                                             
                                             
                                                i
                                             
                                          
                                       
                                    
                                 
                              
                              
                                 (
                                 
                                    
                                       X
                                    
                                    
                                       i
                                    
                                 
                                 )
                              
                              =
                              
                                 
                                    ∏
                                 
                                 
                                    k
                                    =
                                    1
                                 
                                 
                                    K
                                 
                              
                              
                                 
                                    ∏
                                 
                                 
                                    i
                                    ,
                                    
                                       
                                          S
                                       
                                       
                                          i
                                       
                                    
                                    =
                                    k
                                 
                              
                              
                                 
                                    g
                                 
                                 
                                    
                                       
                                          θ
                                       
                                       
                                          k
                                       
                                    
                                 
                              
                              
                                 (
                                 
                                    
                                       X
                                    
                                    
                                       i
                                    
                                 
                                 )
                              
                              ,
                           
                        
                      where 
                        
                           
                              g
                           
                           
                              
                                 
                                    θ
                                 
                                 
                                    k
                                 
                              
                           
                        
                        
                           (
                           ⋅
                           )
                        
                      is the parametric, or emission, distribution (e.g.: normal or Poisson) of the observed data with parameter 
                        
                           
                              θ
                           
                           
                              k
                           
                        
                        ,
                        θ
                        =
                        
                           (
                           
                              
                                 θ
                              
                              
                                 1
                              
                           
                           ,
                           …
                           ,
                           
                              
                                 θ
                              
                              
                                 K
                              
                           
                           )
                        
                      is the global parameter, and 
                        
                           
                              S
                           
                           
                              i
                           
                        
                      is the segment index at position 
                        i
                     . For example, if 
                        n
                        =
                        5
                        ,
                        K
                        =
                        2
                     , and the distribution changes from position 2 to 3, then 
                        S
                        =
                        
                           (
                           1
                           ,
                           1
                           ,
                           2
                           ,
                           2
                           ,
                           2
                           )
                        
                     .

This paper describes an exact method for obtaining the posterior distribution of the segmentation 
                        P
                        
                           (
                           S
                           |
                           X
                           ;
                           θ
                           )
                        
                      in linear time. Introducing a prior distribution 
                        P
                        
                           (
                           S
                           )
                        
                      on any 
                        S
                        ∈
                        
                           
                              ℳ
                           
                           
                              K
                           
                        
                      obtains the following expression for 
                        P
                        
                           (
                           S
                           |
                           X
                           ;
                           θ
                           )
                        
                     : 
                        
                           (2)
                           
                              P
                              
                                 (
                                 S
                                 |
                                 X
                                 ;
                                 θ
                                 )
                              
                              =
                              
                                 
                                    P
                                    
                                       (
                                       X
                                       |
                                       S
                                       ;
                                       θ
                                       )
                                    
                                    P
                                    
                                       (
                                       S
                                       )
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          R
                                       
                                    
                                    P
                                    
                                       (
                                       X
                                       |
                                       R
                                       ;
                                       θ
                                       )
                                    
                                    P
                                    
                                       (
                                       R
                                       )
                                    
                                 
                              
                              .
                           
                        
                     
                  

To simplify the above expression, a uniform prior sets 
                        
                           
                              1
                           
                           
                              P
                              
                                 (
                                 S
                                 )
                              
                           
                        
                        =
                        
                           
                              
                                 n
                                 −
                                 1
                              
                              
                                 K
                                 −
                                 1
                              
                           
                        
                        =
                        
                           |
                           
                              
                                 ℳ
                              
                              
                                 K
                              
                           
                           |
                        
                     .

A common alternative to the above segmentation procedure is to consider an unsupervised hidden Markov model (HMM). Assuming that 
                        S
                      is a Markov chain of hidden states, this approach (Rabiner, 1989) can be thought of as being level-based, where the parameter of the 
                        k
                     th segment takes its value in the set of 
                        L
                        ⩾
                        1
                      levels: 
                        
                           {
                           
                              
                                 θ
                              
                              
                                 1
                              
                           
                           ,
                           
                              
                                 θ
                              
                              
                                 2
                              
                           
                           ,
                           …
                           ,
                           
                              
                                 θ
                              
                              
                                 L
                              
                           
                           }
                        
                     . This simply is equivalent to the model defined by Eq. (1), with the noticeable difference that 
                        S
                        ∈
                        
                           
                              
                                 {
                                 1
                                 ,
                                 2
                                 ,
                                 …
                                 ,
                                 L
                                 }
                              
                           
                           
                              n
                           
                        
                     . With this level-based approach 
                        K
                        ⩾
                        L
                      in general, and the HMM is unconstrained in the sense that transitions are possible between any pair of states. Similar to the segment-based model, the choice of 
                        L
                      is critical and is usually addressed through penalized criteria. The conventional HMM is an appropriate model when the conditional distribution within a given segment of contiguous observations may be shared among other segments. While the unconstrained HMM is preferable in many practical situations, the segment-based model as described in this paper requires fewer assumptions and is thus a more general model.

A convenient feature of these HMM approaches is in computing efficiently the posterior distribution 
                        P
                        
                           (
                           S
                           |
                           X
                           ;
                           θ
                           )
                        
                      in 
                        O
                        
                           (
                           
                              
                                 L
                              
                              
                                 2
                              
                           
                           n
                           )
                        
                      using classical forward–backward recursions (Durbin et al., 1998), making them suitable for handling large data sets. This paper focuses on using a computationally efficient exact procedure to characterize the uncertainty 
                        P
                        
                           (
                           S
                           |
                           X
                           ;
                           θ
                           )
                        
                      of the estimated change-point locations using a hidden Markov model adapted to the conventional segmentation model as previously described. We exploit the effectiveness of the level-based HMM approach through a constrained HMM corresponding exactly to the above segment-based model, providing a fast algorithm for computing 
                        P
                        
                           (
                           S
                           |
                           X
                           ;
                           θ
                           )
                        
                     .

We develop this posterior distribution procedure as the uncertainty in change-point assessment in practical applications becomes more challenging from a computational point of view. For example, emerging high-throughput technologies are producing increasingly large amounts of data for CNV detection. For finding the exact posterior distribution of change-points 
                        P
                        
                           (
                           S
                           |
                           X
                           ;
                           θ
                           )
                        
                     , Guédon (2007) suggested an algorithm in 
                        O
                        
                           (
                           K
                           
                              
                                 n
                              
                              
                                 2
                              
                           
                           )
                        
                     , while Rigaill et al. (2011) considered the same quantity in a Bayesian framework with the same complexity. However, the complexity of these approaches provides for very slow processing for large data sets with sequences of tens of thousands or more and with ten or more change-points in the data.

Other estimates generally focus on asymptotic behavior whose conditions are delicate due to the discreteness of the problem (Bai and Perron, 2003; Muggeo, 2003), on bootstrap techniques (Hušková and Kirch, 2008), estimating waiting time distributions in HMMs (Aston et al., 2012) and on stochastic methods such as particle filtering (Fearnhead and Clifford, 2003), recursive sampling (Lai et al., 2008), and Markov chain Monte Carlo (Erdman and Emerson, 2008). Furthermore, many of the faster stochastic algorithms assume a normal error structure to speed up the estimation procedures and are thus more difficult to adapt to non-normal data (Lai et al., 2008; Erdman and Emerson, 2008).

This paper details our procedure to characterize the uncertainty of a pre-specified set of change-points by an exact method in linear time. As such, the procedure is intended to complement any segmentation obtained by existing detection methods, by estimating the posterior probability of the location of each change-point. It can also be used for further applications such as model selection. While the underlying model from our segmentation approach is different from that of a conventional HMM, we apply constraints specifically to enable the use of efficient HMM algorithms for estimating posterior probabilities of interest. Furthermore, our frequentist approach obtains these probabilities in linear time, without resampling.

Section  2 presents a summary of current change-point detection methods, the constrained HMM algorithm and a description of the accompanying R statistical package, Section  3 implements the methods on a published array CGH data set and compares with published results, Section  4 presents examples of simple simulated data sets with comparisons between methods, Section  5 shows an illustrative example of the methods on a larger scale SNP array data set, while Section  6 includes a discussion.

@&#METHODS@&#

A considerable amount of literature focuses on detecting the ideal number or set of change-point locations. For CNV detection, Fridlyand et al. (2004) developed a discrete HMM to map the number of states and the most likely state at each position. Observations where state transitions are most likely to occur indicate change-points. Various extensions to this HMM approach include various procedures such as merging change-points (Willenbrock and Fridlyand, 2005) and specifying prior transition matrices (Marioni et al., 2006) to improve the results, and simultaneous identification of CNV across multiple samples (Shah et al., 2009). HMM-based implementations for dealing with higher-resolution data for current array technologies include those from Colella et al. (2007) and Wang et al. (2007).

A wide number of segment-based approaches for identifying CNV in genomics data have also been explored. Olshen et al. (2004) introduced an extension of binary segmentation through a non-parametric approach, using permutation rather than parameter estimation to test for change-points. This algorithm requires data smoothing and pruning to improve computation time and change-point detection for very large sequences. To speed up this computationally-intensive process, Venkatraman and Olshen (2007) introduced adjusted 
                           p
                        -values and stopping rules for the permutations. Hupé et al. (2004) introduced a likelihood-based approach to estimate parameters in a normal Gaussian model after adaptive weights smoothing. Hsu et al. (2005) proposed a wavelet-based change-point detection procedure with data smoothing, while Eilers and De Menezes (2005) introduced a quantile approach to smoothing. Willenbrock and Fridlyand (2005) and Lai et al. (2005) summarized and compared the various segmentation approaches for aCGH data. Killick et al. (2012) described an efficient method to detect multiple change-points in linear time through optimal partitioning after pruning observations that cannot be change-points.

To estimate the number of segments, 
                           K
                        , Zhang and Siegmund (2007) extended an earlier method including a modified Bayes Information Criterion to adjust for the number of change-points using a recursive procedure. Comte and Rozenholc (2004) described a least-squares minimization procedure with a penalization criterion for the number of contrasts, while Picard et al. (2005) implemented an adaptive method for estimating the location and number of change-points, with penalization terms for likelihoods.

Let us assume that 
                           S
                         is a heterogeneous Markov chain over 
                           
                              {
                              1
                              ,
                              2
                              ,
                              …
                              ,
                              K
                              ,
                              K
                              +
                              1
                              }
                           
                         (where 
                           K
                           +
                           1
                         is a “junk” state only considered for consistency reasons) such as 
                           P
                           
                              (
                              
                                 
                                    S
                                 
                                 
                                    1
                                 
                              
                              =
                              1
                              )
                           
                           =
                           1
                         and with the following transitions: for all 
                           2
                           ⩽
                           i
                           ⩽
                           n
                         and 
                           1
                           ⩽
                           k
                           ⩽
                           K
                         we have 
                           P
                           
                              (
                              
                                 
                                    S
                                 
                                 
                                    i
                                 
                              
                              =
                              k
                              |
                              
                                 
                                    S
                                 
                                 
                                    i
                                    −
                                    1
                                 
                              
                              =
                              k
                              )
                           
                           =
                           1
                           −
                           
                              
                                 η
                              
                              
                                 k
                              
                           
                           
                              (
                              i
                              )
                           
                         and 
                           P
                           
                              (
                              
                                 
                                    S
                                 
                                 
                                    i
                                 
                              
                              =
                              k
                              +
                              1
                              |
                              
                                 
                                    S
                                 
                                 
                                    i
                                    −
                                    1
                                 
                              
                              =
                              k
                              )
                           
                           =
                           
                              
                                 η
                              
                              
                                 k
                              
                           
                           
                              (
                              i
                              )
                           
                        . For consistency, choose 
                           P
                           
                              (
                              
                                 
                                    S
                                 
                                 
                                    i
                                 
                              
                              =
                              K
                              +
                              1
                              |
                              
                                 
                                    S
                                 
                                 
                                    i
                                    −
                                    1
                                 
                              
                              =
                              K
                              +
                              1
                              )
                           
                           =
                           1
                        . For example, if 
                           n
                           =
                           5
                           ,
                           K
                           =
                           2
                        , and 
                           S
                           =
                           
                              (
                              1
                              ,
                              1
                              ,
                              2
                              ,
                              2
                              ,
                              2
                              )
                           
                         then 
                           P
                           
                              (
                              S
                              )
                           
                           =
                           
                              (
                              1
                              −
                              
                                 
                                    η
                                 
                                 
                                    1
                                 
                              
                              
                                 (
                                 2
                                 )
                              
                              )
                           
                           
                              
                                 η
                              
                              
                                 2
                              
                           
                           
                              (
                              3
                              )
                           
                           
                              (
                              1
                              −
                              
                                 
                                    η
                                 
                                 
                                    2
                                 
                              
                              
                                 (
                                 4
                                 )
                              
                              )
                           
                           
                              (
                              1
                              −
                              
                                 
                                    η
                                 
                                 
                                    2
                                 
                              
                              
                                 (
                                 5
                                 )
                              
                              )
                           
                        . With this Markov chain, it is clear that 
                           
                              {
                              S
                              ∈
                              
                                 
                                    ℳ
                                 
                                 
                                    K
                                 
                              
                              }
                           
                           =
                           
                              {
                              
                                 
                                    S
                                 
                                 
                                    n
                                 
                              
                              =
                              K
                              }
                           
                        .

In the particular case where the Markov chain is homogeneous with 
                           
                              
                                 η
                              
                              
                                 k
                              
                           
                           
                              (
                              i
                              )
                           
                           =
                           η
                           ∈
                           
                              ]
                              0
                              ,
                              1
                              [
                           
                         for all 
                           k
                         and 
                           i
                           ,
                           P
                           
                              (
                              S
                              )
                           
                           =
                           
                              
                                 
                                    (
                                    1
                                    −
                                    η
                                    )
                                 
                              
                              
                                 n
                                 −
                                 K
                              
                           
                           
                              
                                 η
                              
                              
                                 K
                                 −
                                 1
                              
                           
                         for all 
                           S
                           ∈
                           
                              
                                 ℳ
                              
                              
                                 K
                              
                           
                        . We can therefore safely make an arbitrary choice like 
                           η
                           =
                           0.5
                         for practical computations. In other words, only positive state jumps of +1 are possible. Therefore 
                           P
                           
                              (
                              S
                              |
                              S
                              ∈
                              
                                 
                                    ℳ
                                 
                                 
                                    K
                                 
                              
                              )
                           
                           =
                           1
                           /
                           
                              |
                              
                                 
                                    ℳ
                                 
                                 
                                    K
                                 
                              
                              |
                           
                        , which corresponds to the canonical choice of a uniform prior on 
                           
                              
                                 ℳ
                              
                              
                                 K
                              
                           
                        . A choice of different transition coefficients 
                           
                              
                                 η
                              
                              
                                 k
                              
                           
                           
                              (
                              i
                              )
                           
                         allows us to specify informative priors. Note that the particular value of 
                           η
                         does affect 
                           P
                           
                              (
                              S
                              )
                           
                         but has no effect whatsoever on 
                           P
                           
                              (
                              S
                              |
                              S
                              ∈
                              
                                 
                                    ℳ
                                 
                                 
                                    K
                                 
                              
                              )
                           
                         of the chosen segmentation 
                           S
                        .

The constrained HMM provides a framework for additional inference on the uncertainty in the estimated change-point model; in particular, after obtaining the segmentation from any previous procedure, we can obtain confidence intervals around each of the identified change-points. In terms of practical applications, this approach is helpful when dealing with situations where both very short and very long segments may be present, and the exact location of change-points may not be identifiable.

The forward–backward algorithm (Rabiner, 1989), also known as posterior encoding, is a recursive algorithm that can estimate the posterior probabilities of each observation 
                           i
                         being in a particular hidden state 
                           
                              
                                 S
                              
                              
                                 i
                              
                           
                        , and being a change-point such that 
                           
                              
                                 S
                              
                              
                                 i
                              
                           
                           ≠
                           
                              
                                 S
                              
                              
                                 i
                                 −
                                 1
                              
                           
                        . The algorithm is of complexity 
                           O
                           
                              (
                              K
                              n
                              )
                           
                         for 
                           K
                         segments and 
                           n
                         observations; the sparse transition matrix between states reduces the 
                           O
                           
                              (
                              
                                 
                                    K
                                 
                                 
                                    2
                                 
                              
                              n
                              )
                           
                         complexity of the classical forward–backward algorithm. A summary of this algorithm and other inferential procedures involved in HMM estimation is in Cappé et al. (2005).

We define the forward and backward quantities as follows, for observation 
                           i
                         and state 
                           k
                        .

For 
                           1
                           ⩽
                           i
                           ⩽
                           n
                           −
                           1
                        : 
                           
                              
                                 (3)
                                 
                                    
                                       
                                          F
                                       
                                       
                                          i
                                       
                                    
                                    
                                       (
                                       k
                                       )
                                    
                                    =
                                    P
                                    
                                       (
                                       
                                          
                                             X
                                          
                                          
                                             1
                                             :
                                             i
                                          
                                       
                                       =
                                       
                                          
                                             x
                                          
                                          
                                             1
                                             :
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             S
                                          
                                          
                                             i
                                          
                                       
                                       =
                                       k
                                       )
                                    
                                    ,
                                 
                              
                              
                                 (4)
                                 
                                    
                                       
                                          B
                                       
                                       
                                          i
                                       
                                    
                                    
                                       (
                                       k
                                       )
                                    
                                    =
                                    P
                                    
                                       (
                                       
                                          
                                             X
                                          
                                          
                                             i
                                             +
                                             1
                                             :
                                             n
                                          
                                       
                                       =
                                       
                                          
                                             x
                                          
                                          
                                             i
                                             +
                                             1
                                             :
                                             n
                                          
                                       
                                       ,
                                       
                                          
                                             S
                                          
                                          
                                             n
                                          
                                       
                                       =
                                       K
                                       |
                                       
                                          
                                             S
                                          
                                          
                                             i
                                          
                                       
                                       =
                                       k
                                       )
                                    
                                    .
                                 
                              
                           
                        
                     

We obtain the forward quantities by recursion through the following formulas.

Forward: 
                           
                              
                                 (5)
                                 
                                    
                                       
                                          F
                                       
                                       
                                          1
                                       
                                    
                                    
                                       (
                                       k
                                       )
                                    
                                    =
                                    
                                       {
                                       
                                          
                                             
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      
                                                         
                                                            θ
                                                         
                                                         
                                                            1
                                                         
                                                      
                                                   
                                                
                                                
                                                   (
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   )
                                                
                                                ,
                                             
                                             
                                                if  
                                                k
                                                =
                                                1
                                             
                                          
                                          
                                             
                                                0
                                                ,
                                             
                                             
                                                else
                                             
                                          
                                       
                                    
                                 
                              
                              
                                 (6)
                                 
                                    
                                       
                                          F
                                       
                                       
                                          i
                                       
                                    
                                    
                                       (
                                       k
                                       )
                                    
                                    =
                                    
                                       
                                          ∑
                                       
                                       
                                          ℓ
                                       
                                    
                                    
                                       
                                          F
                                       
                                       
                                          i
                                          −
                                          1
                                       
                                    
                                    
                                       (
                                       ℓ
                                       )
                                    
                                    P
                                    
                                       (
                                       
                                          
                                             S
                                          
                                          
                                             i
                                          
                                       
                                       =
                                       k
                                       |
                                       
                                          
                                             S
                                          
                                          
                                             i
                                             −
                                             1
                                          
                                       
                                       =
                                       ℓ
                                       ,
                                       S
                                       ∈
                                       
                                          
                                             ℳ
                                          
                                          
                                             K
                                          
                                       
                                       )
                                    
                                    
                                       
                                          g
                                       
                                       
                                          
                                             
                                                θ
                                             
                                             
                                                k
                                             
                                          
                                       
                                    
                                    
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             i
                                          
                                       
                                       )
                                    
                                    ,
                                    =
                                    
                                       [
                                       
                                          
                                             F
                                          
                                          
                                             i
                                             −
                                             1
                                          
                                       
                                       
                                          (
                                          k
                                          )
                                       
                                       
                                          (
                                          1
                                          −
                                          
                                             
                                                η
                                             
                                             
                                                k
                                             
                                          
                                          
                                             (
                                             i
                                             )
                                          
                                          )
                                       
                                       +
                                       
                                          
                                             
                                                1
                                             
                                          
                                          
                                             k
                                             >
                                             1
                                          
                                       
                                       
                                          
                                             F
                                          
                                          
                                             i
                                             −
                                             1
                                          
                                       
                                       
                                          (
                                          k
                                          −
                                          1
                                          )
                                       
                                       
                                          
                                             η
                                          
                                          
                                             k
                                          
                                       
                                       
                                          (
                                          i
                                          )
                                       
                                       ]
                                    
                                    
                                       
                                          g
                                       
                                       
                                          
                                             
                                                θ
                                             
                                             
                                                k
                                             
                                          
                                       
                                    
                                    
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             i
                                          
                                       
                                       )
                                    
                                    ,
                                 
                              
                           
                         where 
                           
                              
                                 g
                              
                              
                                 
                                    
                                       θ
                                    
                                    
                                       k
                                    
                                 
                              
                           
                           
                              (
                              
                                 
                                    x
                                 
                                 
                                    i
                                 
                              
                              )
                           
                         is the density function of the chosen emission distribution 
                           g
                         with parameter 
                           
                              
                                 θ
                              
                              
                                 k
                              
                           
                        , when 
                           k
                         is the underlying segment for observation 
                           i
                        .

We use a similar recursive procedure to obtain the backward quantities.

Backward: 
                           
                              
                                 (7)
                                 
                                    
                                       
                                          B
                                       
                                       
                                          n
                                          −
                                          1
                                       
                                    
                                    
                                       (
                                       k
                                       )
                                    
                                    =
                                    
                                       {
                                       
                                          
                                             
                                                
                                                   
                                                      η
                                                   
                                                   
                                                      K
                                                   
                                                
                                                
                                                   (
                                                   n
                                                   )
                                                
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      
                                                         
                                                            θ
                                                         
                                                         
                                                            k
                                                         
                                                      
                                                   
                                                
                                                
                                                   (
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         n
                                                      
                                                   
                                                   )
                                                
                                                ,
                                             
                                             
                                                if  
                                                k
                                                =
                                                K
                                                −
                                                1
                                             
                                          
                                          
                                             
                                                
                                                   (
                                                   1
                                                   −
                                                   
                                                      
                                                         η
                                                      
                                                      
                                                         K
                                                      
                                                   
                                                   
                                                      (
                                                      n
                                                      )
                                                   
                                                   )
                                                
                                                
                                                   
                                                      g
                                                   
                                                   
                                                      
                                                         
                                                            θ
                                                         
                                                         
                                                            k
                                                         
                                                      
                                                   
                                                
                                                
                                                   (
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         n
                                                      
                                                   
                                                   )
                                                
                                                ,
                                             
                                             
                                                if  
                                                k
                                                =
                                                K
                                             
                                          
                                          
                                             
                                                0
                                                ,
                                             
                                             
                                                else
                                             
                                          
                                       
                                    
                                 
                              
                              
                                 (8)
                                 
                                    
                                       
                                          B
                                       
                                       
                                          i
                                          −
                                          1
                                       
                                    
                                    
                                       (
                                       k
                                       )
                                    
                                    =
                                    
                                       
                                          ∑
                                       
                                       
                                          ℓ
                                       
                                    
                                    P
                                    
                                       (
                                       
                                          
                                             S
                                          
                                          
                                             i
                                          
                                       
                                       =
                                       ℓ
                                       |
                                       
                                          
                                             S
                                          
                                          
                                             i
                                             −
                                             1
                                          
                                       
                                       =
                                       k
                                       ,
                                       S
                                       ∈
                                       
                                          
                                             ℳ
                                          
                                          
                                             K
                                          
                                       
                                       )
                                    
                                    
                                       
                                          g
                                       
                                       
                                          
                                             
                                                θ
                                             
                                             
                                                ℓ
                                             
                                          
                                       
                                    
                                    
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             i
                                          
                                       
                                       )
                                    
                                    
                                       
                                          B
                                       
                                       
                                          i
                                       
                                    
                                    
                                       (
                                       ℓ
                                       )
                                    
                                    ,
                                    =
                                    
                                       (
                                       1
                                       −
                                       
                                          
                                             η
                                          
                                          
                                             k
                                          
                                       
                                       
                                          (
                                          i
                                          )
                                       
                                       )
                                    
                                    
                                       
                                          g
                                       
                                       
                                          
                                             
                                                θ
                                             
                                             
                                                k
                                             
                                          
                                       
                                    
                                    
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             i
                                          
                                       
                                       )
                                    
                                    
                                       
                                          B
                                       
                                       
                                          i
                                       
                                    
                                    
                                       (
                                       k
                                       )
                                    
                                    +
                                    
                                       
                                          
                                             1
                                          
                                       
                                       
                                          k
                                          <
                                          K
                                       
                                    
                                    
                                       
                                          η
                                       
                                       
                                          k
                                          +
                                          1
                                       
                                    
                                    
                                       (
                                       i
                                       )
                                    
                                    
                                       
                                          g
                                       
                                       
                                          
                                             
                                                θ
                                             
                                             
                                                k
                                                +
                                                1
                                             
                                          
                                       
                                    
                                    
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             i
                                          
                                       
                                       )
                                    
                                    
                                       
                                          B
                                       
                                       
                                          i
                                       
                                    
                                    
                                       (
                                       k
                                       +
                                       1
                                       )
                                    
                                    .
                                 
                              
                           
                        
                     

To obtain the posterior probabilities of the state 
                           
                              
                                 S
                              
                              
                                 i
                              
                           
                           =
                           k
                         at position 
                           i
                        , we note that 
                           
                              
                                 (9)
                                 
                                    P
                                    
                                       (
                                       
                                          
                                             X
                                          
                                          
                                             1
                                             :
                                             n
                                          
                                       
                                       =
                                       
                                          
                                             x
                                          
                                          
                                             1
                                             :
                                             n
                                          
                                       
                                       ,
                                       S
                                       ∈
                                       
                                          
                                             ℳ
                                          
                                          
                                             K
                                          
                                       
                                       )
                                    
                                    =
                                    
                                       
                                          F
                                       
                                       
                                          1
                                       
                                    
                                    
                                       (
                                       1
                                       )
                                    
                                    
                                       
                                          B
                                       
                                       
                                          1
                                       
                                    
                                    
                                       (
                                       1
                                       )
                                    
                                    ,
                                 
                              
                              
                                 (10)
                                 
                                    P
                                    
                                       (
                                       
                                          
                                             S
                                          
                                          
                                             i
                                          
                                       
                                       =
                                       k
                                       |
                                       
                                          
                                             X
                                          
                                          
                                             1
                                             :
                                             n
                                          
                                       
                                       =
                                       
                                          
                                             x
                                          
                                          
                                             1
                                             :
                                             n
                                          
                                       
                                       ,
                                       S
                                       ∈
                                       
                                          
                                             ℳ
                                          
                                          
                                             K
                                          
                                       
                                       )
                                    
                                    =
                                    
                                       
                                          
                                             
                                                F
                                             
                                             
                                                i
                                             
                                          
                                          
                                             (
                                             k
                                             )
                                          
                                          
                                             
                                                B
                                             
                                             
                                                i
                                             
                                          
                                          
                                             (
                                             k
                                             )
                                          
                                       
                                       
                                          
                                             
                                                F
                                             
                                             
                                                1
                                             
                                          
                                          
                                             (
                                             1
                                             )
                                          
                                          
                                             
                                                B
                                             
                                             
                                                1
                                             
                                          
                                          
                                             (
                                             1
                                             )
                                          
                                       
                                    
                                    .
                                 
                              
                           
                        
                     

The constrained HMM estimates the probability of changing state while being at state 
                           
                              
                                 S
                              
                              
                                 i
                              
                           
                           =
                           k
                         at observation 
                           i
                         as 
                           
                              (11)
                              
                                 P
                                 
                                    (
                                    
                                       
                                          S
                                       
                                       
                                          i
                                       
                                    
                                    =
                                    k
                                    |
                                    
                                       
                                          X
                                       
                                       
                                          1
                                          :
                                          n
                                       
                                    
                                    =
                                    
                                       
                                          x
                                       
                                       
                                          1
                                          :
                                          n
                                       
                                    
                                    ,
                                    
                                       
                                          S
                                       
                                       
                                          i
                                          −
                                          1
                                       
                                    
                                    =
                                    k
                                    −
                                    1
                                    ,
                                    S
                                    ∈
                                    
                                       
                                          ℳ
                                       
                                       
                                          K
                                       
                                    
                                    )
                                 
                                 =
                                 
                                    
                                       
                                          
                                             B
                                          
                                          
                                             i
                                          
                                       
                                       
                                          (
                                          k
                                          )
                                       
                                       
                                          
                                             η
                                          
                                          
                                             k
                                             −
                                             1
                                          
                                       
                                       
                                          (
                                          i
                                          )
                                       
                                       
                                          
                                             g
                                          
                                          
                                             
                                                
                                                   θ
                                                
                                                
                                                   k
                                                
                                             
                                          
                                       
                                       
                                          (
                                          
                                             
                                                x
                                             
                                             
                                                i
                                             
                                          
                                          )
                                       
                                    
                                    
                                       
                                          
                                             B
                                          
                                          
                                             i
                                             −
                                             1
                                          
                                       
                                       
                                          (
                                          k
                                          −
                                          1
                                          )
                                       
                                    
                                 
                                 .
                              
                           
                         We can sample a vector of length 
                           K
                           −
                           1
                         change-points from the original data set through these quantities, and afterwards generate a new vector of observed data through the chosen emission distributions. The posterior probability of the 
                           k
                        th change-point occurring after observation 
                           i
                        , or in other words 
                           i
                           +
                           1
                         being the first observation in the 
                           k
                           +
                           1
                        th segment, is 
                           
                              (12)
                              
                                 P
                                 
                                    (
                                    
                                       
                                          
                                             CP
                                          
                                       
                                       
                                          k
                                       
                                    
                                    =
                                    i
                                    |
                                    
                                       
                                          X
                                       
                                       
                                          1
                                          :
                                          n
                                       
                                    
                                    =
                                    
                                       
                                          x
                                       
                                       
                                          1
                                          :
                                          n
                                       
                                    
                                    ,
                                    S
                                    ∈
                                    
                                       
                                          ℳ
                                       
                                       
                                          K
                                       
                                    
                                    )
                                 
                                 =
                                 P
                                 
                                    (
                                    
                                       
                                          S
                                       
                                       
                                          i
                                       
                                    
                                    =
                                    k
                                    ,
                                    
                                       
                                          S
                                       
                                       
                                          i
                                          +
                                          1
                                       
                                    
                                    =
                                    k
                                    +
                                    1
                                    |
                                    
                                       
                                          X
                                       
                                       
                                          1
                                          :
                                          n
                                       
                                    
                                    =
                                    
                                       
                                          x
                                       
                                       
                                          1
                                          :
                                          n
                                       
                                    
                                    ,
                                    S
                                    ∈
                                    
                                       
                                          ℳ
                                       
                                       
                                          K
                                       
                                    
                                    )
                                 
                                 ,
                                 =
                                 
                                    
                                       
                                          
                                             F
                                          
                                          
                                             i
                                          
                                       
                                       
                                          (
                                          k
                                          )
                                       
                                       
                                          
                                             η
                                          
                                          
                                             k
                                          
                                       
                                       
                                          (
                                          i
                                          +
                                          1
                                          )
                                       
                                       
                                          
                                             g
                                          
                                          
                                             
                                                
                                                   θ
                                                
                                                
                                                   k
                                                   +
                                                   1
                                                
                                             
                                          
                                       
                                       
                                          (
                                          
                                             
                                                x
                                             
                                             
                                                k
                                                +
                                                1
                                             
                                          
                                          )
                                       
                                       
                                          
                                             B
                                          
                                          
                                             i
                                             +
                                             1
                                          
                                       
                                       
                                          (
                                          k
                                          +
                                          1
                                          )
                                       
                                    
                                    
                                       
                                          
                                             F
                                          
                                          
                                             1
                                          
                                       
                                       
                                          (
                                          1
                                          )
                                       
                                       
                                          
                                             B
                                          
                                          
                                             1
                                          
                                       
                                       
                                          (
                                          1
                                          )
                                       
                                    
                                 
                                 .
                              
                           
                        
                     

The accuracy of these posterior probabilities relies on the ability of the preceding change-point model to provide proper initial estimates of the number of and locations of the change-points, as they are crucial in selecting the 
                           
                              
                                 θ
                              
                              
                                 k
                              
                           
                         parameters used in the forward–backward procedures.

Maximum a posteriori estimation of the most probable set of change-points is also possible through the Viterbi algorithm (Viterbi, 1967) by modifying the forward quantities, with the Viterbi quantities chosen as 
                           
                              
                                 V
                              
                              
                                 i
                              
                           
                           
                              (
                              k
                              )
                           
                         for observation 
                           i
                         and state 
                           k
                        . 
                           
                              
                                 
                                    
                                       
                                          V
                                       
                                       
                                          1
                                       
                                    
                                    
                                       (
                                       1
                                       )
                                    
                                    =
                                    
                                       
                                          g
                                       
                                       
                                          
                                             
                                                θ
                                             
                                             
                                                1
                                             
                                          
                                       
                                    
                                    
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             1
                                          
                                       
                                       )
                                    
                                    ,
                                 
                              
                              
                                 
                                    
                                       
                                          V
                                       
                                       
                                          i
                                       
                                    
                                    
                                       (
                                       1
                                       )
                                    
                                    =
                                    
                                       
                                          V
                                       
                                       
                                          i
                                          −
                                          1
                                       
                                    
                                    
                                       (
                                       1
                                       )
                                    
                                    
                                       (
                                       1
                                       −
                                       
                                          
                                             η
                                          
                                          
                                             1
                                          
                                       
                                       
                                          (
                                          i
                                          )
                                       
                                       )
                                    
                                    
                                       
                                          g
                                       
                                       
                                          
                                             
                                                θ
                                             
                                             
                                                1
                                             
                                          
                                       
                                    
                                    
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             i
                                          
                                       
                                       )
                                    
                                    ,
                                    
                                    if  
                                    i
                                    ≥
                                    2
                                    ,
                                    k
                                    =
                                    1
                                 
                              
                              
                                 
                                    
                                       
                                          V
                                       
                                       
                                          i
                                       
                                    
                                    
                                       (
                                       k
                                       )
                                    
                                    =
                                    max
                                    
                                       {
                                       
                                          
                                             V
                                          
                                          
                                             i
                                             −
                                             1
                                          
                                       
                                       
                                          (
                                          k
                                          −
                                          1
                                          )
                                       
                                       
                                          
                                             η
                                          
                                          
                                             k
                                          
                                       
                                       
                                          (
                                          i
                                          )
                                       
                                       ,
                                       
                                          
                                             V
                                          
                                          
                                             i
                                             −
                                             1
                                          
                                       
                                       
                                          (
                                          k
                                          )
                                       
                                       
                                          (
                                          1
                                          −
                                          
                                             
                                                η
                                             
                                             
                                                k
                                             
                                          
                                          
                                             (
                                             i
                                             )
                                          
                                          )
                                       
                                       }
                                    
                                    
                                       
                                          g
                                       
                                       
                                          
                                             
                                                θ
                                             
                                             
                                                k
                                             
                                          
                                       
                                    
                                    
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             i
                                          
                                       
                                       )
                                    
                                    
                                    if  
                                    i
                                    ,
                                    k
                                    ≥
                                    2
                                    .
                                 
                              
                           
                        
                     

We trace the path of indices 
                           k
                         used to calculate 
                           
                              
                                 V
                              
                              
                                 i
                                 ,
                                 k
                              
                           
                         to get the set of change-points with highest posterior probability: 
                           
                              •
                              
                                 
                                    K
                                    −
                                    1
                                 th change-point 
                                    
                                       
                                          
                                             CP
                                          
                                       
                                       
                                          K
                                          −
                                          1
                                       
                                    
                                    :
                                    i
                                  of 
                                    
                                       
                                          V
                                       
                                       
                                          i
                                       
                                    
                                    
                                       (
                                       K
                                       −
                                       1
                                       )
                                    
                                  used to calculate 
                                    
                                       
                                          V
                                       
                                       
                                          i
                                          +
                                          1
                                       
                                    
                                    
                                       (
                                       K
                                       )
                                    
                                 ;


                                 
                                    k
                                 th change-point 
                                    
                                       
                                          
                                             CP
                                          
                                       
                                       
                                          k
                                       
                                    
                                    :
                                    i
                                  of 
                                    
                                       
                                          V
                                       
                                       
                                          i
                                       
                                    
                                    
                                       (
                                       k
                                       )
                                    
                                  used to calculate 
                                    
                                       
                                          V
                                       
                                       
                                          i
                                          +
                                          1
                                       
                                    
                                    
                                       (
                                       k
                                       +
                                       1
                                       )
                                    
                                  (where 
                                    
                                       
                                          
                                             CP
                                          
                                       
                                       
                                          k
                                       
                                    
                                    <
                                    
                                       
                                          
                                             CP
                                          
                                       
                                       
                                          k
                                          +
                                          1
                                       
                                    
                                 ).

We apply the preceding methods using the R open-source statistical software program (R Core Team, 2013) and the functions are implemented in the statistics package postCP, available on the CRAN website 
                           
                              
                                 
                                    http://cran.r-project.org/web/packages/postCP  .
                              
                           
                         The forward and backward recursive algorithms are programmed in C++ to optimize the speed of the computationally-intensive process.

The following is a typical 
                           R
                         command line for segmenting a sequence data=LRR, with a vector of length 
                           K
                           −
                           1
                         of pre-specified change-points (or the last index of the first 
                           K
                           −
                           1
                         segments) seg=init. The options specify the reporting of ci=0.9 for 90% confidence intervals, and viterbi=TRUE for the a posteriori most likely set of change-points through the Viterbi algorithm (Viterbi, 1967). It also generates nsamples=100 for 100 different vectors (each of length 
                           K
                           −
                           1
                        ) of change-point locations that can be used to generate data according to the change-point model.


                        
                           
                              
                           
                        
                     

The resulting output includes basic descriptive information about each segment, cp.est, the 90% confidence intervals for the change-point locations, and bestcp, the a posteriori most probable set of change-points. The output also includes matrices lforward and lbackward, the 
                           log
                         of the respective forward and backward matrices for future calculations, post.state, the posterior marginal probability of each observation belonging to the respective segment, and post.cp, the probability of each observation being a change-point. The following is an example of an abbreviated output for a segmentation containing 11 segments.


                        
                           
                              
                           
                        
                     

There are also graphical options for plotting the data, each observation’s corresponding posterior marginal and change-point probabilities, and the associated posterior means for each segment.

Other options include the specification of the emission distribution in the change-point model of normal, Poisson, or negative binomial; the package further allows for other distributions by specifying an 
                           n
                           ×
                           K
                         matrix lprob of log-densities 
                           
                              
                                 g
                              
                              
                                 
                                    
                                       
                                          
                                             θ
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                    
                                       k
                                    
                                 
                              
                           
                           
                              (
                              
                                 
                                    x
                                 
                                 
                                    i
                                 
                              
                              )
                           
                        , with rows corresponding to observations 
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                         and the columns to the MLE of the segment parameters 
                           
                              
                                 
                                    
                                       θ
                                    
                                    
                                       ˆ
                                    
                                 
                              
                              
                                 k
                              
                           
                        . A transition probability matrix prior, for both a homogeneous and a heterogeneous HMM can also be specified. Model selection may also be carried out using the Bayesian Information Criterion (BIC) (Schwarz, 1978; Picard et al., 2005) and the modified BIC (Zhang and Siegmund, 2007) for normal and Poisson distributed data.

We apply the methods to a widely referenced data set from cell line BT474 from a breast cancer tumor (Snijders et al., 2001). The data consist of log-reference ratios signifying the ratio of genomic copies of test samples compared to normal. The goal is to segment the data into segments with similar copy numbers, with change-points corresponding to copy number aberrations pointing to possible genes of interest (Pinkel et al., 1998). We compare the results of postCP to the Bayesian confidence intervals previously published on the same data by Rigaill et al. (2011), consisting of 120 observations from chromosome 10. The observations are sorted according to their relative position along chromosome 10.

We use a modification of the greedy least-squares 
                        K
                     -means algorithm (Hartigan and Wong, 1979) to obtain an initial segmentation for 3 and 4 segments (Table 1
                     ). The locations refer to the indices of the last observations of the first 
                        K
                        −
                        1
                      segments. Afterwards, we used postCP to obtain estimates of the forward and backward matrices in Section  2.3, and afterwards, estimates of the posterior probabilities of the change-points being at each observation. We assumed a homoscedastic normal model for the observations.


                     Fig. 1
                     (a) displays the estimated posterior change-point probabilities of the aCGH data for three segments and Fig. 1(b) for four segments. For both segmentations, the probability of the last change-point had a sharp peak close to 1.0. There is an additional change-point found at position 80 by the four segment model with a relatively high uncertainty. In both the 3- and 4-segment instances, the shapes of the change-point distributions are irregular due to the discreteness of the segmentation procedure.

At these predefined observations, the corresponding posterior change-point probabilities were higher than reported by Rigaill, and confidence intervals were slightly narrower. This is expected, as Rigaill’s method uses a Bayesian framework that accounts for the uncertainty in the parameter estimates. In particular, the rightmost change-point estimation with both 3 and 4 segments had posterior probabilities above 0.95, while the corresponding posterior probabilities from the Bayesian method were closer to 0.5.

We also can use postCP to obtain a joint sample of an entire set of change-points from the original data using the constrained HMM model. Using postCP, we sampled 10,000 data sets using (11). As seen in Fig. 2
                     
                     , the histogram of the generated locations for the first two change-points closely approximates the posterior change-point probabilities found by postCP. Although there is little overlap between the estimated confidence intervals for the first two change-points, there was still a small but non-zero empirical Pearson correlation 
                        
                           (
                           r
                           =
                           0.123
                           ,
                           p
                           <
                           0.001
                           )
                        
                      between the simultaneously generated first and second change-point locations. On the other hand, there was no association between the third generated change-point and the other two change-points, an expected result since their confidence intervals do not overlap.

In this section we consider different change-point situations to compare the ability of the methods in assessing uncertainty. In this section, we use a loss function to assess the ability of the change-point methods in estimating the posterior mean of each observation 
                        
                           (
                           i
                           =
                           1
                           ,
                           …
                           ,
                           n
                           )
                        
                     . For normally distributed data, we quantify loss through the mean square error (MSE). We define 
                        
                           MSE
                        
                        =
                        
                           
                              ∑
                           
                           
                              i
                           
                        
                        
                           
                              
                                 (
                                 
                                    
                                       θ
                                    
                                    
                                       ˆ
                                    
                                 
                                 
                                    (
                                    i
                                    )
                                 
                                 −
                                 
                                    
                                       θ
                                    
                                    
                                       
                                          
                                             S
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                                 )
                              
                           
                           
                              2
                           
                        
                     , where 
                        
                           
                              θ
                           
                           
                              
                                 
                                    S
                                 
                                 
                                    i
                                 
                              
                           
                        
                      are the true underlying means for each observation. For non-normal data, we use the median absolute error (MAE) where 
                        
                           MAE
                        
                        =
                        
                           
                              ∑
                           
                           
                              i
                              =
                              1
                           
                           
                              n
                           
                        
                        
                           |
                           
                              (
                              
                                 
                                    θ
                                 
                                 
                                    ˆ
                                 
                              
                              
                                 (
                                 i
                                 )
                              
                              −
                              
                                 
                                    θ
                                 
                                 
                                    
                                       
                                          S
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                              )
                           
                           |
                        
                     .

We obtain 4 different estimates for the posterior mean of each of the 
                        n
                      observations as follows. The first two posterior mean estimates are from the Bayesian MCMC method implemented in the bcp package (Erdman and Emerson, 2008) and the circular binary segmentation method from the DNAcopy package (Olshen et al., 2004; Venkatraman and Olshen, 2007) in R, both at the default parameters.

We also use postcp, with initial change-points from the estimated change-point set found by DNAcopy, to estimate posterior probabilities of being in state 
                        k
                      for each observation 
                        i
                        ,
                        P
                        
                           (
                           
                              
                                 S
                              
                              
                                 i
                              
                           
                           =
                           k
                           |
                           
                              
                                 X
                              
                              
                                 1
                                 :
                                 n
                              
                           
                           =
                           
                              
                                 x
                              
                              
                                 1
                                 :
                                 n
                              
                           
                           ,
                           S
                           ∈
                           
                              
                                 ℳ
                              
                              
                                 K
                              
                           
                           )
                        
                     , and segment means 
                        
                           
                              
                                 
                                    θ
                                 
                                 
                                    ˆ
                                 
                              
                           
                           
                              k
                           
                        
                        ;
                        k
                        =
                        1
                        ,
                        …
                        ,
                        
                           
                              K
                           
                           
                              ˆ
                           
                        
                     . The posterior mean of observation 
                        i
                      is 
                        
                           
                              
                                 
                                    θ
                                 
                                 
                                    ˆ
                                 
                              
                              
                                 (
                                 i
                                 )
                              
                              =
                              
                                 
                                    ∑
                                 
                                 
                                    k
                                    =
                                    1
                                 
                                 
                                    
                                       
                                          K
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                              
                              P
                              
                                 (
                                 
                                    
                                       S
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 k
                                 |
                                 
                                    
                                       X
                                    
                                    
                                       1
                                       :
                                       n
                                    
                                 
                                 =
                                 
                                    
                                       x
                                    
                                    
                                       1
                                       :
                                       n
                                    
                                 
                                 ,
                                 S
                                 ∈
                                 
                                    
                                       ℳ
                                    
                                    
                                       K
                                    
                                 
                                 ;
                                 
                                    
                                       
                                          
                                             θ
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                    
                                       k
                                    
                                 
                                 )
                              
                              
                                 
                                    
                                       
                                          θ
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    k
                                 
                              
                              .
                           
                        
                     
                  

To obtain another initial set of change-points, we use another greedy procedure for quick model selection in postCP as follows. First, we use the greedy least-squares minimizing algorithm for a fixed 
                        K
                      number of segments to obtain an initial set of change-points. We then use the Viterbi algorithm to get the most probable set of change-points based on this initial set, and obtain the corresponding maximum likelihood estimates (MLEs) for the model parameters. The estimated number of segments 
                        
                           
                              K
                           
                           
                              ˆ
                           
                        
                      is that which minimizes the Bayesian information criterion (BIC) (Schwarz, 1978; Picard et al., 2005), 
                        
                           
                              
                                 BIC
                              
                              
                                 (
                                 K
                                 )
                              
                              =
                              −
                              L
                              L
                              +
                              
                                 
                                    K
                                 
                                 
                                    ′
                                 
                              
                              log
                              
                                 (
                                 n
                                 )
                              
                              ,
                           
                        
                      with respect to the number of segments, where 
                        L
                        L
                      is the log-likelihood of the data, and 
                        
                           
                              K
                           
                           
                              ′
                           
                        
                      is the number of parameters in the model. Posterior quantities are as previously described.

We simulated a sequence of 
                        n
                        =
                        500
                      observations with 6 change-points after 
                        i
                        =
                        
                           (
                           22
                           ,
                           65
                           ,
                           108
                           ,
                           219
                           ,
                           252
                           ,
                           435
                           )
                        
                     . For normally distributed data, odd segments had mean 
                        
                           
                              θ
                           
                           
                              0
                           
                        
                        =
                        0.0
                      and even segments had various values of 
                        
                           
                              θ
                           
                           
                              1
                           
                        
                      with standard deviation 1.0. For Poisson data, odd segments had mean 
                        
                           
                              θ
                           
                           
                              0
                           
                        
                        =
                        1.0
                     . We implement these procedures on 1000 sets each of normal and Poisson distributed data for these 4 methods. Results in Table 2 report the MSE for normal data and MAE for Poisson data for different parameter values of 
                        
                           
                              θ
                           
                           
                              1
                           
                        
                     .

For normally distributed data and 
                        n
                        =
                        500
                     , bcp had lower MSE than the postcp estimates when the intersegmental differences, or differences between the even and odd segments, were less than 1.0 standard deviations. This may be due to the frequentist nature of postcp using point estimates of change-point location to calculate MLEs, which may not have been accurate at lower intersegmental differences. However, at larger intersegmental differences, the methods relying on postCP actually had lower MSE than bcp. In particular, for larger intersegmental differences, the Bayesian method at the default parameters of bcp was overly conservative.

For illustrative purposes, Fig. 3
                     (a) and (b) compare the true values of the underlying means to those found from greedy+postCP and from bcp in one specific set of generated data. For true intersegmental differences of 
                        Δ
                        =
                        
                           
                              θ
                           
                           
                              1
                           
                        
                        −
                        
                           
                              θ
                           
                           
                              0
                           
                        
                        =
                        1.0
                     , bcp had slightly lower MSE than postCP. Inaccurate locations from the greedy algorithm and BIC resulted in a greater amount of error from postCP compared to the relatively conservative posterior change-point probabilities from bcp. However, at 
                        Δ
                        =
                        2.0
                     , postCP performed slightly better than bcp, as the greedy algorithm and BIC provided the correct number of segments and accurate initial change-point estimates to postCP.

For Poisson distributed data, the postCP based methods had lower MAE than bcp, showing the flexibility of the postCP procedure which can adapt to non-normal data.


                     Fig. 4
                     (a) and (b) compare the true values of the underlying means for one set of Poisson data, for intersegmental differences of 2.0 and 4.0, respectively. It is evident that postCP provides more appropriate posterior mean estimates as bcp is not adapted for non-normally distributed data, with highly irregularly-shaped curves for the posterior means.

We also repeat the procedure on a larger sequence of 10,000 observations, with 39 change-points randomly selected from a uniform distribution within these observations, such that no segment is less than 25 observations long. While there is less deviation in the posterior means due to larger segment sizes, the problem of estimating the number and location of change-points is made more difficult. For normal data using postCP after initialization by DNAcopy showed similar patterns to those from 
                        n
                        =
                        500
                     , obtaining lower MSE than bcp other than for very small intersegmental differences. However, using postCP after the greedy algorithm and BIC did not fare as well. Due to the larger amount of change-points, a more effective change-point location estimator than greedy least squares is recommended in these situations.

The exact postCP algorithms also provided some computational advantages in terms of model selection over the Bayesian MCMC method bcp, which also has linear complexity. For 
                        n
                        =
                        500
                     , the entire model selection procedure averaged 0.07 s with the greedy+postcp model selection procedure, 0.09 s for cbs+postcp and 0.9 s for bcp. For 
                        n
                        =
                        10
                        ,
                        000
                     , the respective runtimes were 1.37 s for cbs+postcp together and 15.7 s for bcp.

To illustrate the efficiency of the constrained HMM model, we apply the methods to a copy number variation profile obtained through current SNP (single nucleotide polymorphism) microarray technology (Staaf et al., 2008). The data contain 261,563 SNPs across the genome obtained from an Affymetrix chip from a colorectal cancer tumor cell line (De Roock et al., 2010) with intensities providing information regarding mutations, specifically duplications and deletions. After normalization, the log of the intensities in the tumor sample were compared to normal values, obtained from a reference sample, to obtain the log-reference ratios (LRR) across each of 23 chromosomes.

We use the circular binary segmentation (CBS) procedure implemented in a widely used segmentation package, DNAcopy (Olshen et al., 2004; Venkatraman and Olshen, 2007) for the statistics software R. This package obtains an initial estimate of change-points in LRR, for each of the 23 chromosomes in tumor sample 103. We ran DNAcopy, after smoothing, at the default parameters of 
                        α
                        =
                        0.01
                     . Table 3
                      displays the best segmentation found within for 14,241 SNPs from chromosome 10. This chromosome was selected since both small (second) and large (tenth) segments were found, with adjacent segment differences ranging from 0.04 to 0.58 (Fig. 5
                     ).

We ran postCP using the set of change-points identified by DNAcopy as initial segmentation to obtain estimates of the posterior probabilities of the change-points being at these ten locations. We assumed a homoscedastic normal model for the observations. The forward–backward algorithm was practically instantaneous (less than 0.1 s) for this sequence of over 14,000 observations on a mid-range dual-core 2.5 GHz, 4 GB RAM laptop PC. Not surprisingly, the most narrow confidence intervals, and most precise change-point estimates, were found for larger differences (Table 4
                     ). Six of the ten estimated change-points separated pairs of segments whose means differed by more than one standard deviation; these points all were found to have posterior change-point probabilities greater than 0.5. Eight of the ten change-points from DNAcopy had the highest posterior change-point probabilities for their positions, with the exception of the fifth and tenth change-points whose probabilities were slightly lower than the respective maximum of their position.


                     Fig. 6
                     (a) displays the posterior change-point probabilities for the first five change-points. Given the much narrower segment lengths, and greater segment differences, the probabilities are much higher for the first four change-points than the fifth change-point, whose 90% confidence interval was greater than 60 SNPs wide. Fig. 6(b) displays the posterior change-point probabilities for the tenth change-point, whose 90% confidence interval was greater than 500 SNPs wide. Note that the shapes of the change-point distributions are also highly irregular.

@&#DISCUSSION@&#

A common point of interest in current genomics studies is to find genetic mutations pointing to phenotypes susceptible to diseases (Redon et al., 2006) such as cancers or Type II diabetes. The use of change-point analysis for detecting copy number variation (CNV) is a critical step in the characterization of DNA, including tumoral genes associated with cancer. A CNV may aid in locating a genetic mutation such as a duplication or deletion in a cancerous cell that is a target for treatment. However, due to the often large nature of genomics data sequences it is often difficult to reliably identify CNVs. The latest technologies for detecting CNV, such as single nucleotide polymorphism (SNP) arrays, are able to produce sequences of tens or hundreds of thousands of observations.

This paper describes a procedure that extracts further useful information from segmenting large sequences such as those found in CNV detection in SNP array data. The unsupervised HMM, which is a level-based approach used in many current implementations, includes forward–backward calculations in linear time. However they are less flexible than segment-based methods, in part because they assume a geometric prior on segment lengths when specifying prior transition probabilities between states, which may be inappropriate in some situations. On the other hand, most segment-based methods can allow for a wider variety of specified priors, but in many situations are unfeasible due to their quadratic complexity for large data sets such as those generated by SNP arrays.

The described constrained HMM model’s complexity of 
                        O
                        
                           (
                           K
                           n
                           )
                        
                      rather than 
                        O
                        
                           (
                           K
                           
                              
                                 n
                              
                              
                                 2
                              
                           
                           )
                        
                      enables it to handle very large data sets in reasonable time. The procedure allows for the estimation of the full joint distribution of change-points conditional to the observations, allowing for practical estimation of confidence intervals. In high-resolution data sets with change-points to be unlikely detected at the exact correct position, the confidence intervals may yield important information. In SNP array technology, the change-points need to be detected with high-precision and the differences between certain segments may not be very large. Additionally, overlapping confidence intervals across several different cell tumors or lines may identify associated copy number variations, and help in identifying similar disease phenotypes and treatments in patient subgroups.

The emission distribution 
                        
                           
                              g
                           
                           
                              θ
                           
                        
                        
                           (
                           x
                           )
                        
                      of the observed data can also be easily specified in this constrained HMM procedure, unlike other implementations specifically developed for normally distributed large-scale data. The ability of postCP to easily adapt to a wide variety of distributions through the specification of the emission distribution is especially important with next-generation sequencing platforms often producing data that closely follow the Poisson or Negative Binomial distributions (Shen et al., 2011).

The described methods are a useful tool in the segmentation of large-scale sequences such as those involving CNVs, specifically when combined with any current method for detecting an ideal set of change-points, such as those found in R implementations of CBS in the DNAcopy (Venkatraman and Olshen, 2007) package, penalized likelihoods in the cghseg (Picard et al., 2005) package and PELT (pruned linear exact time) in the changepoint (Killick et al., 2012) package. As such, a greedy procedure based on the 
                        K
                     -means algorithm (Hartigan and Wong, 1979) and a pruned dynamic programming algorithm (Rigaill, 2010; Cleynen et al., 2012) are bundled in the postCP package. Although this procedure relies on the results of other change-point detection algorithms, it can also be used for model selection problems by easing the calculation of model criteria. While the constrained HMM approach is sensitive to its starting point and tends to provide a local rather than global optimum if the initial starting points are misspecified, simulations in this paper showed that in practice, postCP provided estimates of posterior means that were comparable to, or sometimes better than, a currently implemented Bayesian MCMC method. This occurred in situations in which the Bayesian method was specifically designed, that is for assessing multiple change-points in normally distributed data.

A useful extension of our method is to combine the segment-based and level-based approaches by limiting possible values of segment parameters 
                        
                           (
                           
                              
                                 θ
                              
                              
                                 1
                              
                           
                           ,
                           …
                           ,
                           
                              
                                 θ
                              
                              
                                 K
                              
                           
                           )
                        
                      to 
                        L
                        ≤
                        K
                      different values. Further practical applications include more complex models to simultaneously model multiple data sets, or accounting for values from multiple patients and samples as random effects in a mixed model. Another practical extension is to handle multi-dimensional output, such as current technology for copy numbers (Staaf et al., 2008) that simultaneously includes LRR and baseline allelic frequency (BAF) data.

@&#ACKNOWLEDGMENTS@&#

We would like to thank Dr. Pierre Laurent-Puig of the INSERM S-775 biomedical laboratory of Paris Descartes for permitting us to use the colorectal cancer SNP array data used in our illustrative example on high-resolution data, and Mr. Mael Thépaut for providing the normalized data set. We would also like to thank Prof. Stéphane Robin and Dr. Guillem Rigaill for providing us with the breast cancer data from cell line BT474 they used in the previous publication.

@&#REFERENCES@&#

