@&#MAIN-TITLE@&#Tool-adaptive offset paths on triangular mesh workpiece surfaces

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           We present a method for automatic tool-adaptive path planning for freeform surfaces.


                        
                        
                           
                           The method is based on an implicit (level set) path representation.


                        
                        
                           
                           The method is worked out for freeform workpieces represented by triangular meshes.


                        
                        
                           
                           We demonstrate the usefulness of this approach for milling and spray coating.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Tool-adaptive path planning

Anisotropic distance functions

Milling

Spray coating

@&#ABSTRACT@&#


               
               
                  Path-oriented, computer-controlled manufacturing systems work by moving a tool along a path in order to affect a workpiece. A common approach to the construction of a surface-covering path is to take a finite family of offset curves of a given seed curve with increasing offsets. This results in a set of quasi-parallel curves. The offset is chosen so that a tool moving along the curves has the desired impact at every surface point. In cases where the region of influence of a tool is different across the surface, an offset value necessary in one region may lead to a curve offset lower than required in other regions. The paper presents a general method of offset curve construction with tool-adaptive offsets. The offset path is obtained as a family of iso-curves of an anisotropic distance function of a seed curve on the workpiece surface. Anisotropy is defined by a metric tensor field on the surface. An application-independent algorithmic framework of the method for workpiece surfaces represented by a triangular mesh is presented. Its usefulness is demonstrated on the problem of varying cusp heights for milling and for spray coating of surfaces with a spray gun moved by an industrial robot.
               
            

@&#INTRODUCTION@&#

Path-oriented, computer-controlled manufacturing systems work by moving a tool along a path in order to affect a workpiece in a desired way. Examples of production technologies where path-oriented systems are widely used include milling, grinding, roller burnishing  [1] and spraying. A central issue is to plan tool paths fulfilling the requirements. A tool path typically describes the motion of a tool by the motion of a frame with origin at a tool center point, e.g. called cutter location (CL) path for milling. During its motion the tool interacts with the surface. The sequence of locations of interaction may be described by an impact path. For example, the impact path of a ball-end cutter, often called cutter contact (CC) path, is induced by the contact points of the cutter with the desired surface (Fig. 1
                     (a)). For spray coating the curve induced by the intersection points of the centerline of the moving spray cone with the surface may be taken as the impact path (Fig. 1(b)). In fact, the interaction of the spray cone with the surface is not restricted to a curve, but an impact path defined as curve allows performing path planning on the desired surface, as does the impact path for milling.

Since the impact on the workpiece is the central issue, a natural approach to path planning is to start with designing an impact path. Then a tool path which has the desired effect on the workpiece is derived relative to the impact path. The impact path has to be chosen so that several constraints and objectives can be achieved. They concern kinematic properties of the tool path which should take into account constraints or objectives of the tool–surface interaction, like e.g. material removal or contact forces in the case of milling, or the material feed rate of a spray gun. Furthermore, dynamic properties of the manipulator might be considered.

In the following, planning of impact paths is addressed. The task of impact path planning is to calculate a covering path on the surface such that it can be used for tool and manipulator path planning. Impact path topologies often used in practice are contour-parallel and direction-parallel paths (Fig. 2
                     ), and zigzag and spiral paths which may be derived from them. Those approaches of taking as uniform as possible distances in-between neighboring curve segments of an impact path lead to reasonable paths for many applications.

However, better results may be gotten by additional degrees of freedom emerging from locally adapting the inter-path-distances depending on the particular application. For example, it is common for spray coating to adapt the distance and speed of the spraying tool along a given path in order to achieve the desired coating thickness, cf. e.g.  [2,3]. An alternative could be to fix either speed and distance, or both, but vary the density of the path to get the desired coating thickness. The advantage could be a more uniform distance and speed which may be favorable for the manipulator moving the spray gun.

Adaptation of the inter-path-distance may be achieved by anisotropic distance functions defined by appropriate metric tensor fields on workpiece surfaces. Kim  [4] describes such an approach for planning milling paths with respect to cusp height. The goal is to achieve a uniform height of the cusps on the processed surface, independent from the curvature of the surface (Fig. 1(a)). This paper will point out the general potential of the approach as a general method for other objectives and other production processes.

The first main contribution is an algorithmic framework of the general method on workpiece surfaces represented by triangular meshes  [5] (Fig. 3
                     ). The algorithmic framework can be implemented in a stable, reliable and efficient way at reasonable efforts and thus is well suited for practice. It uses an implicit path representation instead of a parametric representation as Kim does, and it takes into account several important achievements and results of mesh processing in recent years. Its basic idea is to define an anisotropic distance function on the mesh based on metric tensors assigned to its vertices. The metric tensors are defined specifically for the application process and they specify the necessary adaptation of the inter-path-distance. The impact paths are calculated as iso-distance curves of the anisotropic distance function by the marching triangle algorithm. If the resulting paths do not satisfy the requirements the metric tensors are adapted. This is iterated until the requirements are satisfied or no further improvement is achieved.

The application of the framework to the problem of uniform cusp height leads to an algorithmically different realization of the approach by Kim  [4], with the before-mentioned advantages. Fig. 8(a) visualizes the cusp heights for an isotropic distance-parallel topology, i.e. with constant distances, while Fig. 8(b) shows a related anisotropic solution of locally varying path density.

The second main contribution is application of the method to spray coating. Two novel approaches of model-based path construction from initial information are proposed, continuing related work by the authors  [3]. A model concerning the relation between velocity, path interval size, and spray time density, and a model concerning the relation between the path interval and the coating height are presented. As experimentally demonstrated, these heuristic models, although considerably simplifying, already lead to favorable metric tensors which may help to achieve a fast path calculation. Fig. 13(a) shows the errors of coating height for an isotropic direction-parallel path and Figs. 13(b) and 14 anisotropic improvements iteratively derived from it.

Section  2 gives a survey on related work. Section  3 presents the method. It is divided in subsections corresponding to the steps of the method. Sections  4 and 5 are devoted to the demonstration of the method for the path interval adaptation of impact paths of milling and of spray coating. Section  6 concludes the paper.

@&#RELATED WORK@&#

Parallel paths have found considerable interest in path-based production, in particular for technologies with tool contact like cutting  [6], but also for contact-free technologies like spray painting  [7] and spray coating  [2]. Other path types have been investigated, too, like space filling curves  [6] and trochoids  [8], but with less attention in research and application.

For the calculation of parallel curves, simple approximate methods, like e.g. parallel cutting planes, of low accuracy are in widespread use  [6]. True parallel paths can be determined by mainly two approaches: explicit and implicit offsetting. Among those, explicit offsetting is often used, but it has the drawback of possible occurring self-intersecting offset curves  [6]. Implicit techniques also exist for a long time. They have found increasing interest since the advent of the so-called level-set method  [9] and in interesting applications of distance functions in computer graphics which stimulated the search for efficient data structures and algorithms for this purpose  [10]. Among the applications is also path planning  [11–14], in particular for pocket machining. Implicit offset curves do not have self-intersections, but sharp bends, that also occur in explicit offsetting, have to be taken into account, which, if they cannot be avoided in an application, have to be remedied.

Like for CAD, parametric surface representations of CAD models based on continuous mathematics have been preferred in path planning  [6]. Recently the surface representation by meshes has gained increasing interest, with related intensive research  [5]. Accordingly, meshes also have been used in path planning methods, but the development is still behind smooth representations  [6].

Meshes are well suited for distance function representations and for its calculation. Mitchell et al.  [15] have presented an algorithm for calculation of distance functions on triangular mesh surfaces. This algorithm has later-on been improved in several ways  [16,17]. The method of the paper makes use of this algorithm and extends it to anisotropic distance functions.

Bounding the height of cusps is a classical objective of path planning for milling. Kim  [4] gives a survey on the development of solutions on free-form surfaces. He also indicates that an implicit approach might be possible as an alternative to his explicit construction of anisotropic geodesic parallels by adaptive metric tensors. This is performed in the first case study of this paper. Tchon et al.  [18] give a further example of a useful application of anisotropic metrics in the different field of volume mesh generation. This underlines the importance of investigating possible further employments of the concept, as it is done in this paper.

Path planning for spray coating has the main goal of reaching a desired coating thickness in spraying processes. The survey by Chen et al. [7] on spray painting and the work by Duncan et al.  [2] on thermal spray coating shows that parallel paths are also preferred in this application. However, alternative path patterns like the billiard paths by Jones et al.  [19] and the contour-to-contour paths by Hegels and Müller  [20] have been proposed for thermal spray coating where bounding the heat in the workpiece is an additional objective. In contrast to machining, considerably less systematic work has been performed for spraying. Kout and Müller  [3] have presented an approach of path-independent precalculation from which a path-dependent solution may be derived with less computational efforts than from scratch. However, the construction of paths from the solution has not been treated. This is done in the second case study of the paper.

The aim is to find a family of neighboring impact path segments which satisfies a given objective of the production process. The topology of the path segments can be direction-parallel or contour-parallel, but the distance between neighboring segments may vary.

The method proposed here for treating this problem is mesh-based implicit path adaptation by metric tensor fields (abbr. MTF method). It consists of the following steps: 
                        
                           1.
                           Represent the workpiece by a triangular mesh.

Define a seed set for the paths to be calculated.

Define an application-depending metric tensor field.

Calculate an anisotropic distance function induced by the metric tensor field.

Smooth the anisotropic distance functions (optional).

Extract the paths as iso-curves of the distance function.

If the result satisfies the requirements, or if the iteration did not achieve any further improvement, then stop. Otherwise adapt the metric tensor field and iterate with step 4.

For adaptation to a specific application problem, a definition of the metric tensor field in step 3 and its adaptation in step 7 based on a model of the production process, as well as possibility to check the quality of the result in step 7, have to be provided. The model needs not to be exact. However, the better the model the more reliable and faster the calculation is.

The method can be used in a virtual as well as in a real setting. In a virtual setting the quality of the result is checked by simulation of the process. In a real setting, the process is executed in reality. The advantage of the real experiments is that simulation errors are excluded. However, if many iterations are required, a pure real setting is usually not practical because of the time and costs required.

The following sections are devoted to the different steps of the MTF method.

Workpieces represented by meshes in step 1 can be obtained by conversion of other computer-based geometry representations, like e.g. NURBS, or from scan data  [6], but also by direct mesh-based design  [5]. The resolution of the mesh has to be chosen depending on the application or on algorithmic requirements. Methods exists for adaptive refinement and coarsening of given meshes  [5].

The seed set of step 2 is responsible for the basic shape of the desired parallel curves. Each of the parallel curves is defined by all surface points having the same given distance to the seed set. The seed set is usually chosen as a curve. For contour-parallel curves, using the contour as the seed curve is the natural choice, as done in Fig. 2(a). For the direction-parallel path topology the seed curve may be a curve which traverses the surface starting and ending at boundary points, like one of straight lines shown in Fig. 2(b).

Metric tensor fields allow for defining distance concepts on surfaces which are different from the usual Euclidean distance. If the metric tensor field is changed, the distances on the surface change as well, while the geometry of the surface remains untouched. For example, metric tensor fields may be used to emulate the metric distortion caused by surface warping on the original surface. A crucial observation is that parallel curves of distance 1 with respect to a distorting metric tensor field may have varying distance when considered with respect to the Euclidean surface metric. This way the tool adaptation of paths will be achieved by the method.

A metric tensor field is a function on a surface which assigns a metric tensor to every surface point  [21]. A metric tensor 
                        
                           
                              
                                 D
                              
                              
                                 
                                    p
                                 
                              
                           
                         is a positive definite, symmetric bilinear form in the space of all tangents at a surface point 
                           
                              p
                           
                        , i.e. the space of all spatial vectors orthogonal to the surface normal at 
                           
                              p
                           
                        . The metric tensor 
                           
                              
                                 D
                              
                              
                                 
                                    p
                                 
                              
                           
                         can be expressed as 
                           
                              (1)
                              
                                 
                                    
                                       D
                                    
                                    
                                       
                                          p
                                       
                                    
                                 
                                 ≔
                                 
                                    (
                                    
                                       
                                          
                                             
                                                
                                                   d
                                                
                                                
                                                   1
                                                
                                                
                                                   2
                                                
                                             
                                          
                                          
                                             0
                                          
                                       
                                       
                                          
                                             0
                                          
                                          
                                             
                                                
                                                   d
                                                
                                                
                                                   2
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                    
                                    )
                                 
                                 ,
                              
                           
                         where 
                           
                              
                                 d
                              
                              
                                 1
                              
                           
                         and 
                           
                              
                                 d
                              
                              
                                 2
                              
                           
                         are the metric distortion or scaling factors along the first and second principal metric direction. The principal metric directions are two orthogonal tangent directions in which the metric distortion is maximum and minimum, respectively. The formula holds if the principal metric directions are taken as the basis of the tangent vector space. The length of an arbitrary tangent vector 
                           
                              t
                           
                         of 
                           
                              p
                           
                         under the distorted metric differs from its Euclidean length by a distortion factor which is given in the relation 
                           
                              
                                 
                                    
                                       
                                          ‖
                                          
                                             t
                                          
                                          ‖
                                       
                                    
                                    
                                       
                                          
                                             D
                                          
                                          
                                             
                                                p
                                             
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                                 ≔
                                 
                                    
                                       
                                          t
                                       
                                    
                                    
                                       T
                                    
                                 
                                 
                                    
                                       D
                                    
                                    
                                       
                                          p
                                       
                                    
                                 
                                 
                                    t
                                 
                                 =
                                 
                                    
                                       
                                          ‖
                                          
                                             t
                                          
                                          ‖
                                       
                                    
                                    
                                       2
                                    
                                    
                                       2
                                    
                                 
                                 ⋅
                                 
                                    (
                                    
                                       
                                          d
                                       
                                       
                                          1
                                       
                                       
                                          2
                                       
                                    
                                    
                                       
                                          cos
                                       
                                       
                                          2
                                       
                                    
                                    θ
                                    +
                                    
                                       
                                          d
                                       
                                       
                                          2
                                       
                                       
                                          2
                                       
                                    
                                    
                                       
                                          sin
                                       
                                       
                                          2
                                       
                                    
                                    θ
                                    )
                                 
                                 ,
                              
                           
                         of the square lengths. 
                           θ
                         denotes the angle from 
                           
                              t
                           
                         to the metric’s first principal direction and 
                           
                              
                                 
                                    ‖
                                    .
                                    ‖
                                 
                              
                              
                                 2
                              
                           
                         is the Euclidean vector norm.

The classical theory just outlined does not apply immediately to triangular meshes because of missing sufficient differentiability. However, the transfer of concepts of differential geometry to triangular meshes has been a topic of intensive recent research  [22–24], and it is possible to define coherent concepts of metric tensor also on meshes.

The canonical metric on a triangular mesh is induced by the Euclidean metric in the triangles. For two points in one triangle, their distance is the Euclidean distance. For two points in different triangles, connecting polygonal chains on the surface are considered. A polygonal chain consists of interior vertices located on edges or vertices of the mesh which are connected by straight lines in triangles. The distance of the two points is the length of a shortest chain of this type.

One possibility of changing the canonical metric of a triangular mesh is by assigning a new distorting metric tensor every triangle which is used for every point of a triangle. Here, an alternative is pursued. It considers metric tensor fields on triangular meshes which are defined by assigning a metric tensor to every vertex. One reason is that from those vertex-related tensors compatible triangle tensors can be easily derived, as will be described in the following.

The definition of the metric vertex tensors uses a normal vector assigned to every mesh vertex. A simple possibility to get a vertex normal is a normalized, weighted sum of the normals of the incident triangles of the vertex. The plane perpendicular to the normal is considered as tangential plane, and the space of all vectors orthogonal to the normal define the tangential space. The metric tensor of a vertex is defined over its tangential space.

Given the vertex tensors, a piecewise-constant metric tensor field on the triangular mesh is obtained by edge scaling. For this purpose, the edges 
                           e
                         are orthogonally projected onto the tangent planes of its two vertices (Fig. 4
                        ). The lengths of the resulting line segments, considered as tangent vectors 
                           
                              
                                 
                                    e
                                 
                              
                              
                                 1
                              
                           
                         and 
                           
                              
                                 
                                    e
                                 
                              
                              
                                 2
                              
                           
                        , are calculated with respect to the metric tensors of the two vertices according to formula (1). The scaled length of 
                           e
                         is the mean value of the two results.

For reasonable defined vertex tensors, the scaled edges of a triangle induce a triangle, too. Then the original triangle is mapped one-to-one on the new triangle using barycentric coordinates. The resulting metric deformation can be described by a constant tensor on the original triangle. The tensors defined this way define the desired piecewise-constant tensor field.

The distance of two points according to the resulting tensor field is defined as follows. The new distance of two points in one triangle is the distance of their images in the deformed triangle. The new length of a polygonal chain is obtained as the length of its image on the deformed mesh. The distance between two points in different triangles is the minimum length of interconnecting polygonal chains of the images of the two points on the deformed mesh.

The time requirement of step 3 is depending on the complexity of providing the information for tensor calculation. The latter is application-specific. The number of tensors is equal to the number of mesh vertices.

Step 4 of the method concerns the calculation of an anisotropic distance function based on a given metric tensor field. Given a seed set 
                           S
                         on a metric surface, the distance function is a function on the surface which gives the distance of any surface point 
                           
                              p
                           
                         to 
                           S
                        . If 
                           
                              p
                           
                         is in 
                           S
                         then the distance is 0. Otherwise the distance of 
                           
                              p
                           
                         is the infimum of all distances of 
                           
                              p
                           
                         to any point of 
                           S
                        . If the metric is defined by a metric tensor field with tensors with different scaling factors, the distance function is called anisotropic. If all scaling factors of all tensors are identical, as is the case for the canonical metric, the distance function is isotropic.

On triangular meshes it is canonical to restrict the type of seeds to finite sets of seed points or polygonal chains. This way, the boundary contour of a surface can for example be taken as a seed set in order to achieve contour-parallel curves. Isotropic distance functions of this type of seed set can be efficiently evaluated at every surface point using an algorithm by Bommes and Kobbelt  [17]. They extend an algorithm by Mitchell et al.  [15], hereafter called MMP algorithm. The original MMP algorithm works on a finite set of mesh vertices as seeds.

The MMP algorithm and its extensions calculate a data structure which stores distance information on the edges of the mesh. Furthermore, it provides a procedure which efficiently calculates the distance of an arbitrary surface point. The procedure uses the information on the edges of the triangle containing the point, provided by the data structure. The data structure is constructed by processing the mesh triangles with increasing distance, starting with the ones incident to the seed set. During the traversal of the triangles, the data structure of the preceding step is updated. For details see  [15,17]. Surazhsky et al.  [16] describe a modification of the original MMP algorithm of improved efficiency. The algorithm by Bommes and Kobbelt  [17] works analogously by additionally considering line segments as seed items. The original MMP algorithm has a worst-case time complexity of 
                           O
                           
                              (
                              
                                 
                                    n
                                 
                                 
                                    2
                                 
                              
                              log
                              n
                              )
                           
                        , 
                           n
                         the number of vertices. However, Surazhsky et al.  [16] state that the average time requirement in practice is close to 
                           O
                           
                              (
                              
                                 
                                    n
                                 
                                 
                                    1.5
                                 
                              
                              )
                           
                        .

The algorithm can be easily extended to anisotropic distance functions by locally applying the edge scaling described in Section  3.3 during the execution of the algorithm with the usual piecewise-linear metric. This means that the algorithm remains basically unchanged, but is executed on the virtual mesh obtained by local deformation.

The quality of the resulting piecewise-linear distance function is sensitive to the mesh tessellation. In order to cope with this problem, the algorithm of Bommes and Kobbelt  [17] includes an adaptive refinement scheme based on mesh subdivision to increase the accuracy. For anisotropic distance functions the variance of the metric tensors has to be additionally taken into account. This is achieved in a preprocessing step by refining the mesh by adaptively subdividing edges by edge splits according to the same topological scheme. The metric tensor of a split point is interpolated from the metric tensor of the vertices of the split edge. A criterion for subdividing an edge is the size of the scaling factors resulting from the metric tensors at the two edge vertices. If the absolute difference exceeds a given threshold, then the edge is split in the middle and the criterion is evaluated on the new edges.


                        Tensor interpolation may be performed in a piecewise-linear manner by first rotating the tensors at the vertices into a common coordinate system, which could be e.g. formed by an edge as 
                           x
                        -axis and the face normal as 
                           z
                        -axis. Then the resulting tensors are interpolated by a linear component-wise interpolation. Further advanced tensor field interpolation methods like the eigenvector-based interpolation of Hotz et al.  [25] could also be used.

The examples presented in this paper are calculated with this extension of the algorithm of Bommes and Kobbelt  [17].

The purpose of distance function smoothing in step 5 is to remove sharp bends of the paths arising at singularities of the distance function (cf. Fig. 5
                        ). Singularities may occur at surface points for which the closest point in the seed set is not unique. At such points the distance function usually is just continuous but not differentiable. The smoothing step is optional since it is only required if sharp bends have to be removed.

A possibility of smoothing of a distance functions is by a smoothing filter. A classical smoothing approach is by convolution. From the calculus of differentiation and integration it is known that the convolution of two real functions is differentiable if one of them differentiable, even if the second one is not  [26]. By discretizing the convolution to real functions on triangular meshes (cf.  [5] for the Laplace-operator), the distance function can be smoothed by replacing the function value 
                           f
                           
                              (
                              
                                 v
                              
                              )
                           
                         of a vertex by a normalized weighted average 
                           
                              
                                 
                                    
                                       f
                                    
                                    ¯
                                 
                                 
                                    (
                                    
                                       v
                                    
                                    )
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             
                                                w
                                             
                                             ∈
                                             R
                                             
                                                (
                                                
                                                   v
                                                
                                                )
                                             
                                          
                                       
                                       g
                                       
                                          (
                                          
                                             ‖
                                             
                                                v
                                             
                                             −
                                             
                                                w
                                             
                                             ‖
                                          
                                          )
                                       
                                       ⋅
                                       
                                          |
                                          
                                             
                                                A
                                             
                                             
                                                
                                                   w
                                                
                                             
                                          
                                          |
                                       
                                    
                                 
                                 
                                    
                                       ∑
                                    
                                    
                                       
                                          w
                                       
                                       ∈
                                       R
                                       
                                          (
                                          
                                             v
                                          
                                          )
                                       
                                    
                                 
                                 f
                                 
                                    (
                                    
                                       w
                                    
                                    )
                                 
                                 ⋅
                                 g
                                 
                                    (
                                    
                                       ‖
                                       
                                          v
                                       
                                       −
                                       
                                          w
                                       
                                       ‖
                                    
                                    )
                                 
                                 ⋅
                                 
                                    |
                                    
                                       
                                          A
                                       
                                       
                                          
                                             w
                                          
                                       
                                    
                                    |
                                 
                                 ,
                              
                           
                         of the function values 
                           f
                           
                              (
                              
                                 w
                              
                              )
                           
                         in an environment 
                           R
                           
                              (
                              
                                 v
                              
                              )
                           
                        . 
                           
                              |
                              
                                 
                                    A
                                 
                                 
                                    
                                       w
                                    
                                 
                              
                              |
                           
                         is the area of the Voronoi region of a vertex 
                           
                              w
                           
                        . Weighting by the Voronoi area is caused by a discretization of the integral of convolution by using piecewise-constant functions in the Voronoi regions. The environment 
                           R
                           
                              (
                              
                                 v
                              
                              )
                           
                         includes all vertices of geodesic distance to 
                           
                              v
                           
                         less than a given radius 
                           r
                           >
                           0
                        . A canonical type of differentiable filter function is the Gaussian function 
                           g
                           
                              (
                              d
                              )
                           
                           =
                           1
                           /
                           
                              (
                              2
                              π
                              σ
                              )
                           
                           ⋅
                           exp
                           
                              (
                              −
                              
                                 
                                    d
                                 
                                 
                                    2
                                 
                              
                              /
                              
                                 (
                                 2
                                 
                                    
                                       σ
                                    
                                    
                                       2
                                    
                                 
                                 )
                              
                              )
                           
                         with 
                           σ
                           =
                           r
                           /
                           2
                        . The environment 
                           R
                           
                              (
                              
                                 v
                              
                              )
                           
                         includes all vertices of geodesic distance to 
                           
                              v
                           
                         less than a given radius 
                           r
                           >
                           0
                        .

The area of a Voronoi region for incident triangles with non-obtuse angles is 
                           
                              (2)
                              
                                 
                                    |
                                    
                                       
                                          A
                                       
                                       
                                          
                                             v
                                          
                                       
                                    
                                    |
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       8
                                    
                                 
                                 
                                    
                                       ∑
                                    
                                    
                                       
                                          w
                                       
                                       ∈
                                       
                                          
                                             N
                                          
                                          
                                             1
                                          
                                       
                                       
                                          (
                                          
                                             v
                                          
                                          )
                                       
                                    
                                 
                                 
                                    (
                                    cot
                                    
                                       
                                          α
                                       
                                       
                                          
                                             v
                                          
                                          
                                             w
                                          
                                       
                                    
                                    +
                                    cot
                                    
                                       
                                          β
                                       
                                       
                                          
                                             v
                                          
                                          
                                             w
                                          
                                       
                                    
                                    )
                                 
                                 
                                    
                                       
                                          ‖
                                          
                                             v
                                          
                                          −
                                          
                                             w
                                          
                                          ‖
                                       
                                    
                                    
                                       2
                                    
                                 
                                 ,
                              
                           
                         where 
                           
                              
                                 N
                              
                              
                                 1
                              
                           
                           
                              (
                              
                                 v
                              
                              )
                           
                         is the 1-ring neighborhood of vertex and 
                           
                              
                                 α
                              
                              
                                 
                                    v
                                 
                                 
                                    w
                                 
                              
                           
                         and 
                           
                              
                                 β
                              
                              
                                 
                                    v
                                 
                                 
                                    w
                                 
                              
                           
                         are the angles opposite to the edge between vertex 
                           
                              v
                           
                         and 
                           
                              w
                           
                         (cf. Fig. 6
                        ). Otherwise a special treatment is required  [27].

Curve construction of step 6 of the method is performed by iso-curve extraction from the anisotropic distance function. Given a continuous scalar function 
                           f
                         on a surface 
                           M
                         and a real number 
                           t
                        , the corresponding set of iso-curves is defined by the maximally connected sets of points 
                           
                              p
                           
                         in 
                           M
                         with scalar value 
                           f
                           
                              (
                              
                                 p
                              
                              )
                           
                           =
                           t
                        . For distance functions in particular, an iso-curve represents a connected set with a constant distance to the seed set.

Approximate iso-curves can be easily extracted from a distance function on a triangular surface mesh with the marching triangles algorithm, which is similar to the marching cubes algorithm  [28], just with triangles instead of cubes. Difficulties may arise at non-differentiable regions of a distance function where iso-curves have sharp bends. The problem can be reduced by locally subdividing the mesh as described at the end of the preceding section.

For applications in path-oriented manufacturing systems, the resulting set of iso-curves has to be transferred into a single path. This can be achieved by grouping the contours in maximum stacks of “concentric” contours. The contours in every stack are transferred into one spiral in the contour-parallel case, or in one zig-zag-line in the direction-parallel case. Then the resulting path segments are connected by non-impact tool paths in a minimizing way.

The worst-case time of iso-curve-calculation is in the order of the number of processed triangles.

The surface resulting from moving a milling tool along parallel path segments consists of parallel grooves separated by ridges (Fig. 1(a)). The aim of cusp height adaptation is to modify the path segments so that the cusps of the ridges do not exceed a given bound. This section employs the MTF method, without iteration. For this purpose, according to Section  3 a metric tensor field for step 3 of the method has to be designed so that the resulting iso-curves, taken as impact path (cutter contact path), fulfill the requirements.

The metric tensor field defined in the following takes into account the curvature of the workpiece surface and the radius of the tool ball. A quantitative characterization of the curvature at a point 
                           
                              p
                           
                         of a smooth surface is given by the curvature tensor 
                           
                              
                                 
                                    
                                       K
                                    
                                    
                                       
                                          p
                                       
                                    
                                 
                                 ≔
                                 
                                    (
                                    
                                       
                                          
                                             
                                                
                                                   κ
                                                
                                                
                                                   1
                                                
                                             
                                          
                                          
                                             0
                                          
                                       
                                       
                                          
                                             0
                                          
                                          
                                             
                                                
                                                   κ
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                    
                                    )
                                 
                                 ,
                              
                           
                         where 
                           
                              
                                 κ
                              
                              
                                 1
                              
                           
                         and 
                           
                              
                                 κ
                              
                              
                                 2
                              
                           
                         are the principal curvatures of the surface at 
                           
                              p
                           
                        . The formula holds if the corresponding principal directions, i.e. the directions of extreme curvature, are taken as basis of the tangent vector space. The surface curvature into any normalized tangent direction 
                           
                              t
                           
                         at 
                           
                              p
                           
                         can be calculated by 
                           
                              (3)
                              
                                 
                                    
                                       K
                                    
                                    
                                       
                                          p
                                       
                                    
                                 
                                 
                                    (
                                    
                                       t
                                    
                                    )
                                 
                                 =
                                 
                                    
                                       
                                          t
                                       
                                    
                                    
                                       T
                                    
                                 
                                 
                                    
                                       K
                                    
                                    
                                       
                                          p
                                       
                                    
                                 
                                 
                                    t
                                 
                                 =
                                 
                                    
                                       κ
                                    
                                    
                                       1
                                    
                                 
                                 
                                    
                                       cos
                                    
                                    
                                       2
                                    
                                 
                                 θ
                                 +
                                 
                                    
                                       κ
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       sin
                                    
                                    
                                       2
                                    
                                 
                                 θ
                                 ,
                              
                           
                         with 
                           θ
                         being the angle to the first principal curvature direction in the tangent plane.

The concept of curvature tensors may be transferred to triangular meshes by reduction to the continuous case by local surface fitting using e.g. moving least squares  [29]. A sophisticated method of direct calculation of a curvature tensor on triangular meshes has been presented by Alliez et al.  [30]. Like in the continuous case, the curvature tensor is described by two orthogonal directions of principal curvature in the tangent space, and two values of principal curvature for these directions. A curvature tensor field of a triangular mesh assigns a curvature tensor to every vertex over its tangential space.

The computing time of the curvature tensor of a vertex according to Alliez et al.  [30] is proportional to the number of vertices in its neighborhood involved in its computation. This number can be considered as constant in the number of mesh vertices.

The quality of approximation of the desired surface by a ball-end cutter is depending on the local curvature of the surface. Lin and Koren  [31] have proposed a path interval bound 
                           
                              (4)
                              
                                 
                                    
                                       ω
                                    
                                    
                                       0
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             8
                                             
                                                
                                                   h
                                                
                                                
                                                   0
                                                
                                             
                                          
                                          
                                             
                                                
                                                   κ
                                                
                                                
                                                   t
                                                
                                             
                                             −
                                             κ
                                          
                                       
                                    
                                 
                                 
                              
                           
                         which limits the cusp heights. 
                           
                              
                                 κ
                              
                              
                                 t
                              
                           
                         is the tool curvature, 
                           κ
                         the surface curvature orthogonal to the path, and 
                           
                              
                                 h
                              
                              
                                 0
                              
                           
                         the desired maximal cusp height of a tool path. This definition is based on an approximation of the tool and the surface orthogonal to the path by circles, making it easier to calculate the remaining material after machining.

Eq. (4) allows to construct a metric tensor which leads to parallel path segments fulfilling this property. The desired metric tensor is obtained by taking the normalized principal curvature directions as principal metric directions and using the scaling factors 
                           
                              (5)
                              
                                 
                                    
                                       d
                                    
                                    
                                       i
                                    
                                 
                                 ≔
                                 
                                    
                                       1
                                    
                                    
                                       
                                          
                                             ω
                                          
                                          
                                             0
                                             ,
                                             i
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   κ
                                                
                                                
                                                   t
                                                
                                             
                                             −
                                             
                                                
                                                   κ
                                                
                                                
                                                   i
                                                
                                             
                                          
                                          
                                             8
                                             
                                                
                                                   h
                                                
                                                
                                                   0
                                                
                                             
                                          
                                       
                                    
                                 
                                 ,
                                 
                                 i
                                 =
                                 1
                                 ,
                                 2
                                 .
                              
                           
                         This results in the metric tensor 
                           
                              (6)
                              
                                 
                                    
                                       D
                                    
                                    
                                       
                                          p
                                       
                                    
                                 
                                 =
                                 
                                    (
                                    
                                       
                                          
                                             
                                                
                                                   d
                                                
                                                
                                                   1
                                                
                                                
                                                   2
                                                
                                             
                                          
                                          
                                             0
                                          
                                       
                                       
                                          
                                             0
                                          
                                          
                                             
                                                
                                                   d
                                                
                                                
                                                   2
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                    
                                    )
                                 
                                 =
                                 
                                    (
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         κ
                                                      
                                                      
                                                         t
                                                      
                                                   
                                                   −
                                                   
                                                      
                                                         κ
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                
                                                
                                                   8
                                                   
                                                      
                                                         h
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             0
                                          
                                       
                                       
                                          
                                             0
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         κ
                                                      
                                                      
                                                         t
                                                      
                                                   
                                                   −
                                                   
                                                      
                                                         κ
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                                
                                                   8
                                                   
                                                      
                                                         h
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    )
                                 
                                 .
                              
                           
                         Applied to a surface tangent vector 
                           
                              t
                           
                         orthogonal to the path, and using formulas (1) and (3), this metric results in a scaling by 
                           1
                           /
                           
                              
                                 ω
                              
                              
                                 0
                              
                           
                        : 
                           
                              
                                 
                                    
                                       
                                          
                                             ‖
                                             
                                                t
                                             
                                             ‖
                                          
                                       
                                       
                                          
                                             
                                                D
                                             
                                             
                                                
                                                   p
                                                
                                             
                                          
                                       
                                       
                                          2
                                       
                                    
                                    =
                                    
                                       
                                          
                                             t
                                          
                                       
                                       
                                          T
                                       
                                    
                                    
                                       
                                          D
                                       
                                       
                                          
                                             p
                                          
                                       
                                    
                                    
                                       t
                                    
                                    =
                                    
                                       
                                          
                                             ‖
                                             
                                                t
                                             
                                             ‖
                                          
                                       
                                       
                                          2
                                       
                                       
                                          2
                                       
                                    
                                    ⋅
                                    
                                       (
                                       
                                          
                                             d
                                          
                                          
                                             1
                                          
                                          
                                             2
                                          
                                       
                                       
                                          
                                             cos
                                          
                                          
                                             2
                                          
                                       
                                       θ
                                       +
                                       
                                          
                                             d
                                          
                                          
                                             2
                                          
                                          
                                             2
                                          
                                       
                                       
                                          
                                             sin
                                          
                                          
                                             2
                                          
                                       
                                       θ
                                       )
                                    
                                    ,
                                 
                              
                              
                                 
                                    
                                       
                                          
                                             ‖
                                             
                                                t
                                             
                                             ‖
                                          
                                       
                                       
                                          2
                                       
                                       
                                          2
                                       
                                    
                                    =
                                    
                                       
                                          
                                             
                                                
                                                   ‖
                                                   
                                                      t
                                                   
                                                   ‖
                                                
                                             
                                             
                                                
                                                   
                                                      D
                                                   
                                                   
                                                      
                                                         p
                                                      
                                                   
                                                
                                             
                                             
                                                2
                                             
                                          
                                       
                                       
                                          
                                             
                                                d
                                             
                                             
                                                1
                                             
                                             
                                                2
                                             
                                          
                                          
                                             
                                                cos
                                             
                                             
                                                2
                                             
                                          
                                          θ
                                          +
                                          
                                             
                                                d
                                             
                                             
                                                2
                                             
                                             
                                                2
                                             
                                          
                                          
                                             
                                                sin
                                             
                                             
                                                2
                                             
                                          
                                          θ
                                       
                                    
                                    =
                                    
                                       
                                          
                                             ‖
                                             
                                                t
                                             
                                             ‖
                                          
                                       
                                       
                                          
                                             
                                                D
                                             
                                             
                                                
                                                   p
                                                
                                             
                                          
                                       
                                       
                                          2
                                       
                                    
                                    ⋅
                                    
                                       
                                          8
                                          
                                             
                                                h
                                             
                                             
                                                0
                                             
                                          
                                       
                                       
                                          
                                             
                                                κ
                                             
                                             
                                                t
                                             
                                          
                                          −
                                          
                                             (
                                             
                                                
                                                   κ
                                                
                                                
                                                   1
                                                
                                             
                                             
                                                
                                                   cos
                                                
                                                
                                                   2
                                                
                                             
                                             θ
                                             +
                                             
                                                
                                                   κ
                                                
                                                
                                                   2
                                                
                                             
                                             
                                                
                                                   sin
                                                
                                                
                                                   2
                                                
                                             
                                             θ
                                             )
                                          
                                       
                                    
                                    =
                                    
                                       
                                          
                                             ‖
                                             
                                                t
                                             
                                             ‖
                                          
                                       
                                       
                                          
                                             
                                                D
                                             
                                             
                                                
                                                   p
                                                
                                             
                                          
                                       
                                       
                                          2
                                       
                                    
                                    ⋅
                                    
                                       
                                          8
                                          
                                             
                                                h
                                             
                                             
                                                0
                                             
                                          
                                       
                                       
                                          
                                             
                                                κ
                                             
                                             
                                                t
                                             
                                          
                                          −
                                          κ
                                       
                                    
                                    =
                                    
                                       
                                          
                                             ‖
                                             
                                                t
                                             
                                             ‖
                                          
                                       
                                       
                                          
                                             
                                                D
                                             
                                             
                                                
                                                   p
                                                
                                             
                                          
                                       
                                       
                                          2
                                       
                                    
                                    ⋅
                                    
                                       
                                          ω
                                       
                                       
                                          0
                                       
                                       
                                          2
                                       
                                    
                                    .
                                 
                              
                           
                        
                     

Hence an iso-value increment of 1 for the generation of the iso-curves in step 6 of the method leads path intervals between neighboring curve segments satisfying Eq. (4). This way a cusp height of at most 
                           
                              
                                 h
                              
                              
                                 0
                              
                           
                         is reached.

This way an implicit version of the parametric approach by Kim  [4] is achieved. In contrast to the approach by Kim  [4], the metric tensor (6) is immediately specified in the tangent space of the surface, not in parameter space. However, it is compatible with the metric tensor 
                           
                              H
                           
                         derived by Kim. This can be concluded by considering local quadratic approximations of the workpiece surface, corresponding to the tangent space tensor. These approximations have the type of the example of Section 6.1 of Kim’s work. The tensor 
                           
                              H
                           
                         of this example coincides with the metric tensor (6), if the different iso-value increment value of 
                           2
                           
                              
                                 
                                    
                                       h
                                    
                                    
                                       0
                                    
                                 
                              
                           
                         in Section 4.1 of Kim’s work is taken into account.

The concept of metric tensors by Kim includes arbitrary cutter shapes as long as the surface of the rotating cutter is sufficiently differentiable. In that case, the approach of local quadratic approximation also allows the transfer of the related metric tensors to the MTF method of this paper. For 3-axis machining the path adaptation is immediately possible. Kim  [4] mentions that the tensor concept can also be extended to 5-axis machining using other types of smooth tools if tool orientations are pre-assigned over a part surface. However, for non-smooth tools, or tool orientations depending on the path direction, further research is required. An approach to derive appropriate tensors could be to consider the silhouette of the rotating tool in its pre-assigned orientation, in view direction tangential to the path. For example, the bottom of the silhouette of an inclined cylindrical, flat-bottom end-mill has a smooth elliptic shape. The silhouette shape is depending on the orientation of the tool. The idea is now to use the silhouette shapes in all tangential directions at a surface point in order to derive relations to the desired maximal cusp height like the one of Eq. (4) for the circular silhouette shape of a ball-end cutter. Those relations could again be employed to create a metric tensor.

@&#EVALUATION@&#

The cusp-height adaptation has been evaluated on a saddle surface and on a mechanical engineering part, cf. Figs. 3, 7 and 8
                        
                        . The milling is simulated by point-sampling the path and calculating the ray–sphere intersection for each mesh vertex along its normal with the ball-end tool placed at every sampling points. The resulting heights, linearly interpolated over the mesh, are visualized by color. The width of the surfaces is 200 mm and 350 mm, respectively. The tool radius is 25 mm for the saddle surface and 12 mm for the mechanical engineering part.

The saddle surface offers different types of curvature and thus shows a region-dependent cusp height for constant path intervals, cf. Fig. 7(a). The distance function seed is in the center of the saddle surface. The resulting tool path follows the blue curve, where the cusp height is zero. The maxima of the cusps in-between are colored in red. After the cusp-height adaptation the cusp-height is distributed uniformly over the surface, as can be noticed from the uniform, thin red regions in Fig. 7(b). The mechanical engineering part contains a region with a high curvature, where the cusps for constant path intervals are much higher than on the rest of the surface, cf. Fig. 8(a). The distance function seed is at the lower boundary curve of the mechanical engineering part. The adapted path lowers the cusp height in that region while leaving it unchanged in the more planar regions of the surface, cf. Fig. 8(b).

The runtime of the distance function calculation is slightly more than 3 s for the saddle surface mesh with 359040 triangles, and slightly less than 3 s for the mesh of the mechanical engineering part with 272736 triangles, on an Intel Core i7-2600 processor at 3.4 GHz.

The spray coating process considered in the following can be outlined as follows  [2]. A spray gun is moved along a path over the workpiece surface (Fig. 1(b)). The path is parametrized over an impact path on the workpiece surface. At every point 
                        
                           p
                        
                      of the impact path the spatial location of the spray gun with tool center point 
                        
                           q
                        
                      is described by the vector 
                        
                           r
                        
                      from 
                        
                           p
                        
                      to 
                        
                           q
                        
                     . The deposit of material on the surface depends on the speed and several intrinsic parameters of the gun which control the spray cone. In this paper the material deposit model of Duncan et al.  [2] is employed. The intrinsic parameters of the gun are fixed over time. Wiederkehr et al.  [32] present an approach to the simulation of spray coating processes of this sort on workpiece surfaces represented by triangular meshes. It delivers the coating thickness generated at every vertex of the coated surface.

In the following, two approaches to construction of paths for reaching a desired coating thickness are presented. The first one takes up a pathless optimization approach presented by Kout and Müller  [3] and describes two possibilities to transfer its result to paths. The second one starts with any spray path and iteratively improves it by adapting the path intervals. Both approaches use the MTF method.

Kout and Müller  [3] describe methods to determine values of the gun pose parameters to get a desired coating thickness of a surface. One method is to distribute a finite set of spray gun poses over the surface, without any specific path, and determine the distance and spray time of the poses by solving an optimization problem. An issue not treated in Kout and Müller  [3] is to transfer the path-independent solution to a spray gun path. In the following, two approaches to a solution of this problem are presented, velocity adaptation and path interval adaptation. Path interval adaptation uses the MTF method and provides a suitable metric tensor field for this problem.

The input of both approaches is a set of guns, one at every vertex of the given surface mesh. The location of the gun at vertex 
                           
                              v
                           
                         is described by a vector 
                           
                              
                                 
                                    r
                                 
                              
                              
                                 
                                    v
                                 
                              
                           
                         from vertex 
                           
                              v
                           
                         to the gun center point 
                           
                              
                                 
                                    g
                                 
                              
                              
                                 
                                    v
                                 
                              
                           
                        . Further, a spray time 
                           
                              
                                 t
                              
                              
                                 
                                    v
                                 
                              
                           
                         is given for every gun.

For the transfer of spray time to the spray path the spatial density of the set of guns has to be taken into account. For this purpose a spray gun density 
                        
                           
                              
                                 ρ
                              
                              
                                 
                                    v
                                 
                              
                           
                         is defined at every mesh vertex 
                           
                              v
                           
                        . 
                           
                              
                                 ρ
                              
                              
                                 
                                    v
                                 
                              
                           
                         is reciprocal to the area of influence of vertex 
                           
                              v
                           
                         which increases with the distance of neighboring vertices. For its area of influence the Voronoi area 
                           
                              |
                              
                                 
                                    A
                                 
                                 
                                    
                                       v
                                    
                                 
                              
                              |
                           
                         of 
                           
                              v
                           
                         is taken  [27], cf. Eq. (2), 
                           
                              (7)
                              
                                 
                                    
                                       ρ
                                    
                                    
                                       
                                          v
                                       
                                    
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       
                                          |
                                          
                                             
                                                A
                                             
                                             
                                                
                                                   v
                                                
                                             
                                          
                                          |
                                       
                                    
                                 
                                 .
                              
                           
                        
                     

With the spray gun density 
                           
                              
                                 ρ
                              
                              
                                 
                                    v
                                 
                              
                           
                        , a spray time density 
                        
                           
                              
                                 j
                              
                              
                                 
                                    v
                                 
                              
                           
                         is defined at vertex 
                           
                              v
                           
                         which is essentially the spray time 
                           
                              
                                 t
                              
                              
                                 
                                    v
                                 
                              
                           
                         multiplied by the spray gun density 
                           
                              
                                 ρ
                              
                              
                                 
                                    v
                                 
                              
                           
                         on the surface, i.e.  
                           
                              (8)
                              
                                 
                                    
                                       j
                                    
                                    
                                       
                                          v
                                       
                                    
                                 
                                 =
                                 
                                    
                                       t
                                    
                                    
                                       
                                          v
                                       
                                    
                                 
                                 ⋅
                                 
                                    
                                       ρ
                                    
                                    
                                       
                                          v
                                       
                                    
                                 
                                 .
                              
                           
                        
                     

A spray gun path is represented over a polygonal impact path on the mesh surface. The basic concept of the following is to calculate the gun poses of a spray path at a path vertex 
                           
                              p
                           
                         by interpolation of the gun poses of the three vertices of the triangle in which 
                           
                              p
                           
                         lies. Accordingly, the gun location vector 
                           
                              
                                 
                                    
                                       
                                          r
                                       
                                    
                                    
                                       ˆ
                                    
                                 
                              
                              
                                 
                                    p
                                 
                              
                           
                         at 
                           
                              p
                           
                         is obtained by barycentric interpolation from the location vectors at the mesh vertices. Further, a spray gun density 
                           
                              
                                 
                                    
                                       ρ
                                    
                                    
                                       ˆ
                                    
                                 
                              
                              
                                 
                                    p
                                 
                              
                           
                         is defined analogously to the one for mesh vertices, i.e.  
                           
                              
                                 
                                    
                                       
                                          
                                             ρ
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                    
                                       
                                          p
                                       
                                    
                                 
                                 ≔
                                 
                                    
                                       1
                                    
                                    
                                       
                                          
                                             l
                                          
                                          
                                             
                                                p
                                             
                                          
                                       
                                       ⋅
                                       
                                          
                                             ω
                                          
                                          
                                             
                                                p
                                             
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       2
                                    
                                    
                                       
                                          (
                                          
                                             ‖
                                             
                                                
                                                   
                                                      p
                                                   
                                                
                                                
                                                   +
                                                
                                             
                                             −
                                             
                                                p
                                             
                                             ‖
                                          
                                          +
                                          
                                             ‖
                                             
                                                p
                                             
                                             −
                                             
                                                
                                                   
                                                      p
                                                   
                                                
                                                
                                                   −
                                                
                                             
                                             ‖
                                          
                                          )
                                       
                                       ⋅
                                       
                                          
                                             ω
                                          
                                          
                                             
                                                p
                                             
                                          
                                       
                                    
                                 
                                 .
                              
                           
                         In this case, a Voronoi area is approximately calculated by the product of the path interval 
                           
                              
                                 ω
                              
                              
                                 
                                    p
                                 
                              
                           
                         and the average length 
                           
                              
                                 l
                              
                              
                                 
                                    p
                                 
                              
                           
                         to the neighboring vertices 
                           
                              
                                 
                                    p
                                 
                              
                              
                                 −
                              
                           
                         and 
                           
                              
                                 
                                    p
                                 
                              
                              
                                 +
                              
                           
                         along the path (cf. Fig. 9
                        ).

Furthermore a spray time density 
                           
                              (9)
                              
                                 
                                    
                                       
                                          
                                             j
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                    
                                       
                                          p
                                       
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             t
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                    
                                       
                                          p
                                       
                                    
                                 
                                 ⋅
                                 
                                    
                                       
                                          
                                             ρ
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                    
                                       
                                          p
                                       
                                    
                                 
                              
                           
                         for paths is defined, where 
                           
                              
                                 
                                    
                                       t
                                    
                                    
                                       ˆ
                                    
                                 
                              
                              
                                 
                                    p
                                 
                              
                           
                         denotes the spray time at path vertex 
                           
                              p
                           
                        . Based on these definitions, the spray time density 
                           
                              
                                 
                                    
                                       j
                                    
                                    
                                       ˆ
                                    
                                 
                              
                              
                                 
                                    p
                                 
                              
                           
                         at 
                           
                              p
                           
                         is obtained by barycentric interpolation from the vertices of the triangle in which 
                           
                              p
                           
                         lies.

The spray time density 
                           
                              
                                 
                                    
                                       j
                                    
                                    
                                       ˆ
                                    
                                 
                              
                              
                                 
                                    p
                                 
                              
                           
                         is converted into the velocity 
                           
                              
                                 v
                              
                              
                                 
                                    p
                                 
                              
                           
                         on a path at 
                           
                              p
                           
                         by using Eq. (9) and taking the density 
                           
                              
                                 
                                    
                                       ρ
                                    
                                    
                                       ˆ
                                    
                                 
                              
                              
                                 
                                    p
                                 
                              
                           
                         along the path: 
                           
                              (10)
                              
                                 
                                    
                                       v
                                    
                                    
                                       
                                          p
                                       
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             l
                                          
                                          
                                             
                                                p
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   t
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                          
                                             
                                                p
                                             
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             l
                                          
                                          
                                             
                                                p
                                             
                                          
                                       
                                       ⋅
                                       
                                          
                                             
                                                
                                                   ρ
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                          
                                             
                                                p
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   j
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                          
                                             
                                                p
                                             
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       
                                          
                                             ω
                                          
                                          
                                             
                                                p
                                             
                                          
                                       
                                       ⋅
                                       
                                          
                                             
                                                
                                                   j
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                          
                                             
                                                p
                                             
                                          
                                       
                                    
                                 
                                 .
                              
                           
                         This equation can be rewritten to 
                           
                              (11)
                              
                                 
                                    
                                       v
                                    
                                    
                                       
                                          p
                                       
                                    
                                 
                                 ⋅
                                 
                                    
                                       ω
                                    
                                    
                                       
                                          p
                                       
                                    
                                 
                                 ⋅
                                 
                                    
                                       
                                          
                                             j
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                    
                                       
                                          p
                                       
                                    
                                 
                                 =
                                 1
                                 .
                              
                           
                         An analogous relation is also valid at the mesh vertices, where the equation is 
                           
                              (12)
                              
                                 
                                    
                                       v
                                    
                                    
                                       
                                          v
                                       
                                    
                                 
                                 ⋅
                                 
                                    
                                       ω
                                    
                                    
                                       
                                          v
                                       
                                    
                                 
                                 ⋅
                                 
                                    
                                       
                                          
                                             j
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                    
                                       
                                          v
                                       
                                    
                                 
                                 =
                                 1
                                 ,
                              
                           
                         with 
                           
                              
                                 v
                              
                              
                                 
                                    v
                                 
                              
                           
                        , 
                           
                              
                                 ω
                              
                              
                                 
                                    v
                                 
                              
                           
                         and 
                           
                              
                                 
                                    
                                       j
                                    
                                    
                                       ˆ
                                    
                                 
                              
                              
                                 
                                    v
                                 
                              
                           
                         are the velocity, the path interval width and the spray time density of any spray path through mesh vertex 
                           
                              v
                           
                        .

Based on this, the approach of spray path calculation by velocity adaptation works as follows. It starts by choosing a polygonal path on the mesh surface as a family of approximate iso-curves defined by a seed set and a monotonous sequence of iso-values of equal increments. Then the tool location and the spray time density are transferred to its vertices as just described. Finally the gun speed at every vertex is calculated from Eq. (11) as 
                           
                              
                                 
                                    
                                       v
                                    
                                    
                                       
                                          p
                                       
                                    
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       
                                          
                                             ω
                                          
                                          
                                             
                                                p
                                             
                                          
                                       
                                       ⋅
                                       
                                          
                                             
                                                
                                                   j
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                          
                                             
                                                p
                                             
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                         where 
                           
                              
                                 ω
                              
                              
                                 
                                    p
                                 
                              
                           
                         is the path interval of the given path at vertex 
                           
                              p
                           
                        , i.e. the distance of the iso-curves in the special case. All this requires constant computing time per path vertex, so that the overall asymptotic calculation time is proportional to the number of path vertices.

The approach of spray path calculation by path interval adaptation adjusts the interval between neighboring path segments to desired spray gun velocities along the path, by employing the MTF method, without iteration (Section  3). This needs the specification of an appropriate tensor for step 3. For its definition, a scalar gun velocity field on the surface mesh has to be provided by assigning a velocity 
                           
                              
                                 v
                              
                              
                                 
                                    v
                                 
                              
                           
                         to every mesh vertex 
                           
                              v
                           
                        . Using 
                           
                              
                                 
                                    
                                       j
                                    
                                    
                                       ˆ
                                    
                                 
                              
                              
                                 
                                    v
                                 
                              
                           
                           =
                           
                              
                                 j
                              
                              
                                 
                                    v
                                 
                              
                           
                        , which holds by definition, and resolving Eq. (12) for 
                           
                              
                                 ω
                              
                              
                                 
                                    v
                                 
                              
                           
                         gives 
                           
                              
                                 
                                    
                                       ω
                                    
                                    
                                       
                                          v
                                       
                                    
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       
                                          
                                             v
                                          
                                          
                                             
                                                v
                                             
                                          
                                       
                                       ⋅
                                       
                                          
                                             j
                                          
                                          
                                             
                                                v
                                             
                                          
                                       
                                    
                                 
                                 .
                              
                           
                        
                        
                           
                              
                                 ω
                              
                              
                                 
                                    v
                                 
                              
                           
                         is used to define the required metric tensor at vertex 
                           
                              v
                           
                        : 
                           
                              (13)
                              
                                 
                                    
                                       D
                                    
                                    
                                       
                                          v
                                       
                                    
                                 
                                 =
                                 
                                    (
                                    
                                       
                                          
                                             
                                                
                                                   1
                                                
                                                
                                                   
                                                      
                                                         ω
                                                      
                                                      
                                                         
                                                            v
                                                         
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             0
                                          
                                       
                                       
                                          
                                             0
                                          
                                          
                                             
                                                
                                                   1
                                                
                                                
                                                   
                                                      
                                                         ω
                                                      
                                                      
                                                         
                                                            v
                                                         
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    )
                                 
                                 .
                              
                           
                         The calculation of the tensor of a vertex is possible in constant time.

The necessary field of gun velocities can be defined heuristically. For example it can be chosen according to possible constraints of the gun-moving manipulator, as follows. An iso-curve path represented by a polygonal chain is calculated for the given seed set and iso-value increment 1 for an isotropic metric tensor field with some scaling factor 
                           d
                        . A scalar velocity value 
                           
                              
                                 v
                              
                              
                                 
                                    p
                                 
                              
                           
                         is assigned to every path vertex 
                           
                              p
                           
                         within the range feasible for the gun manipulator. The velocity values are transferred to the mesh vertices by interpolating the velocity value 
                           
                              
                                 v
                              
                              
                                 
                                    v
                                 
                              
                           
                         of a mesh vertex 
                           
                              v
                           
                         from the velocities at the path vertices close to 
                           
                              v
                           
                        . The possibility of taking manipulator constraints into account in this way is a particular advantage of path calculation by path interval adaptation over the first approach.

An iteration is not intended. However, if the result should not be satisfactory, an iteration according to the approach of the next section may be employed.

An alternative approach to adapting the interval between neighboring path segments based on the precalculated spray time density from the pathless optimization is to directly use the coating error of a given spray path. The advantage of coating-error-controlled path interval adaptation is that just the coating thickness for a given path has to be compared to the desired coating thickness; no optimization problem has to be solved in advance. The coating thickness can be determined by a deposition simulation based on a deposition model. Although an initial spray path is required, in contrast to just an impact path on the surface mesh, a reasonable initialization of a spray path can be expected in many cases to be less computationally expensive than a complete initial pathless optimization.

The approach is also implemented by the MTF method. According to Section  3 this requires the definition of a tensor field (step 3), a possibility of quality checking (step 7), and an updating mechanism for the metric tensor field (step 7).

For the specification of the metric tensor field of step 3, certain path-independent parameter values have to be provided at the mesh vertices 
                           
                              v
                           
                        . The parameters are a gun position vector 
                           
                              
                                 
                                    r
                                 
                              
                              
                                 
                                    v
                                 
                              
                           
                        , a scalar velocity value 
                           
                              
                                 v
                              
                              
                                 
                                    v
                                 
                              
                           
                        , and a path interval size 
                           
                              
                                 ω
                              
                              
                                 
                                    v
                                 
                              
                           
                        . The values may be chosen heuristically, again possibly along desired constraints or objectives. From these parameter values, the metric tensor field is calculated according to formula (13).

For the quality check of step 7 of the method a spray gun path related to the resulting impact path is derived by displacing the impact path with the gun position vectors interpolated to the path vertices. Then the coating thickness 
                           
                              
                                 h
                              
                              
                                 
                                    v
                                 
                              
                           
                         at every mesh vertex 
                           
                              v
                           
                         caused by an execution of the initial spray path is determined by a simulation, cf. e.g.  [32]. The resulting coating thickness is checked for deviation from the desired coating thickness. If it is satisfactory the algorithm stops.

Updating of metric tensor (13) in step 7 is done by changing the path interval size at the mesh vertices to 
                           
                              (14)
                              
                                 
                                    
                                       ω
                                    
                                    
                                       
                                          v
                                       
                                    
                                    
                                       s
                                    
                                 
                                 =
                                 
                                    
                                       ω
                                    
                                    
                                       
                                          v
                                       
                                    
                                 
                                 ⋅
                                 
                                    
                                       
                                          (
                                          
                                             
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      
                                                         v
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      h
                                                   
                                                   
                                                      
                                                         v
                                                      
                                                   
                                                   
                                                      s
                                                   
                                                
                                             
                                          
                                          )
                                       
                                    
                                    ¯
                                 
                                 ,
                              
                           
                         where 
                           
                              
                                 h
                              
                              
                                 
                                    v
                                 
                              
                              
                                 s
                              
                           
                         is the desired coating thickness at mesh vertex 
                           
                              v
                           
                        , and the overbar denotes a smoothing operator according to Section  3.5.

The asymptotic calculation time requirement of one iteration, apart from the simulation time, is the same as for spray gun calculation by path interval adaptation of the preceding section.

Obviously, the path interval width in formula (14), without smoothing, remains unchanged if the desired coating thickness has already been achieved, and it increases or decreases if the coating thickness caused by the initial path is higher or lower, respectively, than the desired thickness. The smoothing operator is not mandatory, but it may be used to control the smoothness of the resulting path by increasing the coherence of the path interval width.

A more quantitative heuristic motivation of formula (14) is as follows. An infinite number of parallel path segments 
                           i
                           =
                           −
                           ∞
                           ,
                           …
                           ,
                           −
                           1
                           ,
                           0
                           ,
                           1
                           ,
                           …
                           ,
                           ∞
                         on a workpiece plane is considered, separated by a path interval 
                           ω
                        , and a point 
                           
                              p
                           
                         on the workpiece plane in the region of these path segments (cf. Fig. 10
                        ).

When moving a spray gun along the middle one (
                           i
                           =
                           0
                        ) of those segments, a deposit is generated. Slicing the deposit with a plane perpendicular to the segment through 
                           
                              p
                           
                         delivers a profile curve which is represented by a height function 
                           f
                         over the line of intersection between the plane with the workpiece plane.

When moving the spray gun along one of the neighboring segments in the same way, the resulting profile function is the same, up to a translation by 
                           ω
                        . The deposit 
                           
                              
                                 h
                              
                              
                                 
                                    p
                                 
                              
                           
                         generated at 
                           
                              p
                           
                         by moving the gun along all given path segments is the sum of the values of all profiles at 
                           
                              p
                           
                        . The values are of the form 
                           f
                           
                              (
                              
                                 
                                    x
                                 
                                 
                                    
                                       p
                                    
                                 
                              
                              −
                              i
                              ⋅
                              ω
                              )
                           
                        , 
                           i
                           =
                           −
                           ∞
                           ,
                           …
                           ,
                           ∞
                        , where 
                           
                              
                                 x
                              
                              
                                 
                                    p
                                 
                              
                           
                         is the horizontal coordinate of 
                           
                              p
                           
                         in a common frame of the profile functions. Thus, 
                           
                              
                                 
                                    
                                       h
                                    
                                    
                                       
                                          p
                                       
                                    
                                 
                                 =
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       =
                                       −
                                       ∞
                                    
                                    
                                       ∞
                                    
                                 
                                 f
                                 
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          
                                             p
                                          
                                       
                                    
                                    −
                                    i
                                    ⋅
                                    ω
                                    )
                                 
                                 .
                              
                           
                         Let 
                           F
                         be the integral of the profile function 
                           f
                         over the interval 
                           
                              [
                              −
                              ∞
                              ,
                              ∞
                              ]
                           
                        . Then 
                           
                              
                                 
                                    
                                       h
                                    
                                    
                                       
                                          p
                                       
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                             =
                                             −
                                             ∞
                                          
                                          
                                             ∞
                                          
                                       
                                       f
                                       
                                          (
                                          
                                             
                                                x
                                             
                                             
                                                
                                                   p
                                                
                                             
                                          
                                          −
                                          i
                                          ⋅
                                          ω
                                          )
                                       
                                       ⋅
                                       ω
                                    
                                    
                                       ω
                                    
                                 
                                 ≈
                                 
                                    
                                       F
                                    
                                    
                                       ω
                                    
                                 
                                 .
                              
                           
                         This results from considering the sum in the numerator of the second term as a Riemannian approximation of the integral. A rearrangement yields 
                           
                              
                                 
                                    
                                       h
                                    
                                    
                                       
                                          p
                                       
                                    
                                 
                                 ⋅
                                 ω
                                 ≈
                                 F
                                 .
                              
                           
                         Let 
                           
                              
                                 h
                              
                              
                                 
                                    p
                                 
                              
                              
                                 s
                              
                           
                         be a desired coating thickness. Then the required path interval satisfies 
                           
                              
                                 
                                    
                                       h
                                    
                                    
                                       
                                          p
                                       
                                    
                                    
                                       s
                                    
                                 
                                 ⋅
                                 
                                    
                                       ω
                                    
                                    
                                       s
                                    
                                 
                                 ≈
                                 F
                                 .
                              
                           
                         Both equations together lead to 
                           
                              
                                 
                                    
                                       h
                                    
                                    
                                       
                                          p
                                       
                                    
                                 
                                 ⋅
                                 ω
                                 ≈
                                 
                                    
                                       h
                                    
                                    
                                       
                                          p
                                       
                                    
                                    
                                       s
                                    
                                 
                                 ⋅
                                 
                                    
                                       ω
                                    
                                    
                                       s
                                    
                                 
                                 ,
                              
                           
                         or 
                           
                              
                                 
                                    
                                       ω
                                    
                                    
                                       s
                                    
                                 
                                 ≈
                                 ω
                                 
                                    
                                       
                                          
                                             h
                                          
                                          
                                             
                                                p
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             h
                                          
                                          
                                             
                                                p
                                             
                                          
                                          
                                             s
                                          
                                       
                                    
                                 
                                 .
                              
                           
                         This coincides with Eq. (14) up to the smoothing operator.

This consideration shows that it can be likely that the new path is already a good solution, at least if the paths are not considerably curved. Otherwise, the method can be iterated until a satisfying solution is achieved (step 7). In every iteration, formula (14) is applied to the result of the preceding step.

The parameters of the initial path may be defined as follows. For the velocity 
                           
                              
                                 v
                              
                              
                                 
                                    v
                                 
                              
                           
                         the approach outlined in the last paragraph of Section  5.1 may be employed. The iso-curve increments at the vertices may all get the same value. The value may be related to the spray gun distance from the surface and the opening angle of its spray cone. The configuration should be so that the spray cone covers several neighboring path segments. The direction of the spray cone may be chosen along the surface normal, or as close to it as possible if collisions prevent this direction.

@&#EVALUATION@&#

The evaluation first has been performed on the saddle surface. The desired coating thickness has the shape of a Gaussian distribution. In the first experiment a non-optimized spray path is used. The seed set of the distance function used for the impact path is the lower boundary of the mesh. The spray gun is moved perpendicularly along this path with constant distance and speed. The spray process is executed with a simulator  [32] employing the deposit mode by Duncan et al.  [2]. The opening angle of the spray cone is 18.33°. This corresponds to a footprint radius on the surface of 33 mm at a gun distance of 100 mm which is the distance used in the simulation. The resulting coating error is visualized in Fig. 11
                        . Caused by the non-uniform desired coating thickness and the uniform spray path the error is considerable.

The gray boundary region, which has approximately the width of the radius of the spray cone on the surface, has been excluded from the calculations and the evaluations. The reason is the method of parametrization of the spray gun path over an impact path which does not allow the gun to move beyond the surface boundary in the required way. This, however, is necessary to achieve a reasonable result close to the boundary. For the application to a given workpiece surface this can be taken into account by extending the surface by a sufficiently wide boundary region. Data required in the boundary region are extrapolated from the relevant region.

The results of the first two iterations of path interval adaptation based on the coating error (Section  5.2) with a uniform spray path as initialization are shown in Fig. 12
                        
                        
                        (a) and (b). For comparison the result of the approach of path construction from the result of pathless tool pose optimization by path interval adaptation (Section  5.1) is shown in Fig. 12(c). Both methods produce good results. The coating-error-based optimization after two iterations is even better than the pathless parameter optimization. Although one iteration is worse than the pathless optimization, it is still acceptable.

The runtime is dominated by the runtime of the distance function calculation, which is 220 ms on an Intel Core i7-2600 processor at 3.4 GHz for the saddle surface mesh made of 22440 triangles. The runtime of the pathless optimization, which is not required for coating-error-controlled path interval adaptation, is 8 min.

Furthermore, the evaluation has been performed the same way on the mechanical engineering part. The seed curve of the distance function is again at the lower boundary of the mesh. The coating error for the initial spray path is visualized in Fig. 13(a).

The results of the path interval adaptation based on the coating error for the first, third and fifth iteration are depicted in Figs. 13(b) and 14.

The results of the coating-error-controlled path interval adaptation with smoothing is shown in Fig. 15
                        . They are somewhat worse than without smoothing, but the generated paths are slightly smoother.

The results based on pathless parameter optimization are shown in Fig. 16
                        .

The runtime for the distance function calculation on the mesh with 6170 triangles is 60 ms, while the pathless optimization of the spray time density took 2 min.

The methods of this section do not make explicit use of the shape of the spray cone. Simulations with different shapes including also asymmetric ones, conducted for coating-error-controlled path interval adaptation, have shown the same behavior. This indicates a robustness of the method which might make it useful in a real setting in which the simulation in step 7 of the MTF method is replaced with the physical process (Section  3). In this case the shape of the spray cone is not known as well.

The flexibility of the approach of impact path representation by iso-curves of an appropriate distance function, implemented on workpieces represented by appropriate triangular meshes, has been demonstrated. One central task of the method is the choice of the metric tensor field. In the case studies from milling and spraying presented in this paper the metric tensor fields have been chosen using models of the processes: the Lin–Koren bound for milling leading to Eq. (5), the relation between velocity, path interval size, and spray time density in Eq. (12), and the relation between the path interval and coating thickness used in Eq. (14). Future work may extend this to further applications.

One example is taking into account contact forces occurring for machining processes. Most path planning algorithms for machining did neglect dynamic aspects of the machining system  [6]. If high, cutting forces may cause tool deflections which e.g. influence the quality of the result. One possibility to cope with this problem is to avoid it by keeping the cutting forces in a feasible range and to avoid considerable variation along the path. An idea which might achieve this goal is to determine the absolute cutting forces along a given distance-function-based impact path by simulation  [33]. If the resulting forces exceed a given upper bound, the distance between neighboring path segments has to be increased, and if they fall below a lower bound, the distance may be decreased. The distance adaptation can be achieved by adaptation of the metric tensors. A possibility to determine the amount of adaptation may be an iterative search loop based on this observation, by alternating adaptation and simulation-based evaluation. A function quantitatively relating the cutting force and path interval size would be helpful in order to keep the number of iterations of this straightforward approach low. The development of such a function is an issue of future research for which existing models of cutting force behavior  [34] may serve as a starting point. The aim should be to define the function for arbitrary path directions at a surface point. In contrast to the simulation-based approach such a function could lead to a path-independent tensor field like the one for cusp-height adaptation. Another approach to tackle the tool deflection problem is compensation. Compensation may also be achieved by deforming a given path  [35]. However, an immediate application of the MTF method seems not to be possible in this case. Possibly an incremental version by successive path-segment-wise adaptation of the distance function might lead to a solution, but this requires considerable further research.

As an alternative to the model-based approach, appropriate tensors might also be found by formulating and solving global optimization problems, like e.g. minimization of the cusp height for milling and minimizing of the coating error for spray coating, over the space of metric parameters. However, solving such optimization problems can be expected to be computational expensive. As the iteration of Eq. (14) for the case study of spray coating has shown, optimization may also be necessary if a model is employed, and thus is included by step 7 of the MTF method. However, by a model, optimization may be accelerated, as demonstrated by the low number of iterations sufficient to achieve a reasonable solution.

Another issue of future research is the choice of the seed set in step 2 of the MTF method. Properties of a favorable seed set might also be specified as an optimization problem. Alternatively, process models can be used as well, for instance the approaches to defining process-optimized path directions for cusps by Chiou and Lee  [36] and for cutting forces by López de Lacalle et al.  [37].

@&#ACKNOWLEDGMENTS@&#

Part of the work on this paper has been supported by Deutsche Forschungsgemeinschaft (DFG) within the Collaborative Research Center SFB 708 “3D-Surface Engineering of Tools for Sheet Metal Forming—Manufacturing, Modeling, Machining”, project B4.

@&#REFERENCES@&#

