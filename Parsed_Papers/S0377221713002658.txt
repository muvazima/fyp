@&#MAIN-TITLE@&#Dynamic asset allocation for varied financial markets under regime switching framework

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           We applied the hidden Markov model for stock, bond, and commodity markets.


                        
                        
                           
                           HMM identified two extreme regimes and two transition regimes.


                        
                        
                           
                           We employed the stochastic programming under regime switching framework.


                        
                        
                           
                           Optimized portfolio performed well in crash periods by reducing the risky assets.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Investment analysis

Regime identification

Hidden Markov model

Stochastic programming

Portfolio optimization

@&#ABSTRACT@&#


               
               
                  Asset allocation among diverse financial markets is essential for investors especially under situations such as the financial crisis of 2008. Portfolio optimization is the most developed method to examine the optimal decision for asset allocation. We employ the hidden Markov model to identify regimes in varied financial markets; a regime switching model gives multiple distributions and this information can convert the static mean–variance model into an optimization problem under uncertainty, which is the case for unobservable market regimes. We construct a stochastic program to optimize portfolios under the regime switching framework and use scenario generation to mathematically formulate the optimization problem. In addition, we build a simple example for a pension fund and examine the behavior of the optimal solution over time by using a rolling-horizon simulation. We conclude that the regime information helps portfolios avoid risk during left-tail events.
               
            

@&#INTRODUCTION@&#

Portfolio optimization is the most researched and practiced method to examine the optimal decision for asset allocation. The mean–variance model introduced by Markowitz (1952) is the basis for portfolio selection, which finds the optimal portfolio by computing the risk-return tradeoff using the estimated mean vector and the covariance matrix of asset returns. One of the advantages of the Markowitz model is that there are no restrictions on the type of assets that can be included in the model. For example, commodity futures, which has become drastically popular among investors as a major asset class, like stocks and bonds can be easily included in the model to solve the portfolio selection problem. However, the Markowitz model is a single-period model without stochastic characteristics and also assumes that the multi-dimensional return series of assets have constant mean vector and covariance matrix.

In this paper, we extend the traditional Markowitz portfolio model to address the changing nature of the covariance matrix under differing market conditions. Certainly, one of the severe issues arising during 2008 crash was the increase in correlation (contagion) that occurred and the ensuing lack of diversification by many investors (even those applying Markowitz models). The regime detection methodology provides an intuitive and practical way to anticipate changing correlation conditions. As such, the research is on the pathway of the original Markowitz tradition. There have been many studies indicating the existence of multiple regimes in financial markets especially the stock market. The hidden Markov model (HMM) is a popular method for regime identification, which has been widely used in engineering and science. Hamilton (1989) uses HMM to predict business cycles of the US economy by analyzing the US Gross National Product (GNP). Further discussions on HMM in finance can be found in Turner et al. (1989), Hansen (1992), Hamilton and Susmel (1994), and Garcia (1998). These researches commonly describe that the high (low) return regime of the equity market shows low (high) volatility. In addition, Guidolin and Timmermann (2007, 2008) identify four regimes in the joint return series of the stock market and the bond market by using HMM.

In our study, we construct a regime switching model that includes the commodity market index as well as the stock and bond indices by applying HMM. The main reason for including the commodity market as an additional asset class is because commodities are popular among practitioners for diversifying their portfolios. In addition, there are a number of academic studies that treat commodities as a financial asset class. For instance, Gorton et al. (2007) argue the commodity futures prices are proxies of commodity spot prices. In addition, Gorton and Rouwenhorst (2006) assert that the return of the commodity futures market is negatively correlated with the return of the equity market while positively correlated with inflation. This model allows us to estimate the mean vector and the covariance matrix of the joint return series described above for each regime. In other words, the returns of the three indices are stochastically emitted from one of many possible distributions.

Incorporating a regime switching model relaxes the assumption of a single distribution of the Markowitz model. Instead of a fixed value for the expected return and variance, a set of probabilities representing the likelihood in each state is available. This probabilistic information converts the static mean–variance model into an optimization problem under uncertainty, which is the case for a market with unobservable multiple regimes. We take the stochastic programming approach to formulate this optimization problem. A reasonable extension of the mean–variance model is the n-period stochastic programs because they are theoretically equivalent to static problems (Ziemba, 2009). Birge and Louveaux (1997) and Ruszczyński and Shapiro (2003) provide a comprehensive introduction to stochastic programming. We examine the effect of asset allocation under a regime switching environment through a simple example for a pension fund with a goal of achieving a certain level of financial wealth within a limited time span.

The organization of the paper is as follows. Section 2 introduces HMM for analyzing market regimes, and the empirical results along with the interpretation of the identified regimes are documented in Section 3. Section 4 includes a simple example of stochastic optimization under the regime switching framework. Then, we conduct rolling-horizon simulations to construct stochastically optimized active portfolios and compare their performance with several benchmarks in Sections 5, and 6 concludes.

While many studies on financial regime identification using HMM focus heavily on the stock market, there is, to the best of our knowledge, no empirical research specifically on the regimes of the bond market. We suspect that a main reason is because there are only a few recognizable crises in the bond market prior to the European debt crisis of 2011. For the commodity market, Cheung and Miu (2010) study the diversification benefit of commodities by using Gorton’s equal-weighted portfolio (Gorton and Rouwenhorst, 2006). They investigate commodity futures and find evidence that the diversification benefits are robust over time and across regimes. Moreover, they conclude that the high (low) return environment for commodity futures is also associated with low (high) volatility. However, their work incorporates neither the correlation between the stock and bond markets nor the relationship between the stock and commodity futures markets. Prajogo (2011) applies HMM to the two-dimensional return series composed of the S&P500 and the agricultural sector in the US stock market. Although she does not use the information of correlation between the two return series, the model provides the estimated covariance matrix for each regime and therefore allows the investors to identify the characteristics of correlation in each regime.

The choice of representative indices is based on important characteristics of each market. For example, in the equities market, the S&P500 index is widely used in academic research and investment planning as a proxy for the market portfolio described in the capital asset pricing model (CAPM) of Sharpe (1964) and Lintner (1965). As for the bond market, since one of the major characteristics of bonds as a financial instrument is its stability, we gather the yield-to-maturity on 10-year benchmark US government bonds. Furthermore, we utilize the Goldman-Sachs Commodity Index for the commodity market because of its dominant popularity in the financial industry.
                           2
                           The data for all three markets are retrieved from Datastream where the identifiers are TOTMKUS (RI), BMUS10Y (RI) and GSCIEXR, respectively.
                        
                        
                           2
                         The time span of data is from January 2, 1980 to June 11, 2012, which covers over 30years of trading history including the recent financial crisis.

The construction of HMM requires decisions on two characteristics of the model. The first one is the probability density function of the observations. In this paper, we assume that the three return series that each represents the stock, bond, and commodity markets, respectively, follow a multivariate normal distribution and this allows us to easily include correlations among financial markets in our model. Student’s t distribution is known to be more robust to outliers for pattern recognition in gesture or speech using HMM (Chatzis et al., 2009). The reason for using the normal distribution instead of the Student’s t distribution in our study, however, is because extreme tail events in financial markets cannot simply be modeled as noise or errors; these extreme events are essential for identifying market status such as the bubble period in the early 2000s or the market crash in 2008. In fact, it is known that the hidden Markov model with the normal distribution can address relatively fat tailed distributions properly. See Mulvey and Zhao (2010, Working Paper) for further discussion. The second property is the structure of the underlying hidden states that emit observable price series. We cannot directly observe market states and only the index information for each market is available. In our study, we assume that the number of hidden states is discrete and finite.


                        Fraser (2008) documents the basic framework of HMM. For ease of understanding, we follow his notations and derivations on HMM,
                           
                              –
                              
                                 S(t): A random variable of (unobservable) state at time t
                              


                                 Y(t): A random variable of observation (in this case, three-dimensional daily return series of stock, bond, and commodity markets) at time t
                              


                                 
                                    
                                       
                                          
                                             S
                                          
                                          
                                             
                                                
                                                   t
                                                
                                                
                                                   1
                                                   ,
                                                
                                             
                                             
                                                
                                                   t
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                    
                                 : A sequence of random variables of states from time t
                                 1 to t
                                 2
                              


                                 
                                    
                                       
                                          
                                             Y
                                          
                                          
                                             
                                                
                                                   t
                                                
                                                
                                                   1
                                                   ,
                                                
                                             
                                             
                                                
                                                   t
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                    
                                 : A sequence of random variables of observations from time t
                                 1 to t
                                 2
                              


                                 s(t): A realized (unobservable) state at time t
                              


                                 y(t): A realized observation at time t
                              


                                 
                                    
                                       
                                          
                                             s
                                          
                                          
                                             
                                                
                                                   t
                                                
                                                
                                                   1
                                                
                                             
                                             ,
                                             
                                                
                                                   t
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                    
                                 : A sequence of realized states from time t
                                 1 to t
                                 2
                              


                                 
                                    
                                       
                                          
                                             y
                                          
                                          
                                             
                                                
                                                   t
                                                
                                                
                                                   1
                                                   ,
                                                
                                             
                                             
                                                
                                                   t
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                    
                                 : A sequence of realized observations from time t
                                 1 to t
                                 2
                              


                                 Θ: A set of variables of HMM parameters to be estimated


                                 θ: A set of estimated HMM parameters


                                 N: The dimension of observations (in this case, N
                                 =3)


                                 t
                                 ∈{1,…,
                                 T}, ∀s(t)∈
                                 S
                                 ={1,…,
                                 K}

We assume that the daily return series of the representative indices for the three markets are the observations of the model and the returns at time t depend on the regime at that time. We can write our model by using Fraser’s notation as,
                           
                              
                                 Y
                                 (
                                 t
                                 )
                                 |
                                 S
                                 (
                                 t
                                 )
                                 =
                                 y
                                 (
                                 t
                                 )
                                 |
                                 s
                                 (
                                 t
                                 )
                                 ∼
                                 N
                                 (
                                 
                                    
                                       μ
                                    
                                    
                                       s
                                       (
                                       t
                                       )
                                    
                                 
                                 ,
                                 
                                    
                                       Σ
                                    
                                    
                                       s
                                       (
                                       t
                                       )
                                    
                                 
                                 )
                                 ,
                              
                           
                        where μ
                        
                           s(t) denotes the mean of the daily return series, Σ
                        
                           s(t) is the covariance matrix under state s(t). The assumption of normality of returns and finite number of states allow the Baum–Welch algorithm to estimate model parameters. The Baum–Welch algorithm is an expectation–maximization (EM) algorithm for applications of HMM.
                           3
                           Please see Fraser (2008) for a detailed mathematical derivation on the algorithm.
                        
                        
                           3
                         Given the initial set of parameters θ and the realized series of observations y
                        1,T
                        , the solution of this algorithm always converges to a local maximum of the likelihood function P
                        
                           θ
                        (y
                        1,T
                        ). We use randomly selected initial parameters and repeat the parameter estimation for each seed. We generate initial parameters with the following steps. First, calculate mean μ
                        
                           i
                         and volatility σ
                        
                           i
                         for index i. Next, we generate random numbers for state s from the interval [μ
                        
                           i
                        
                        −
                        σ
                        
                           i
                        ,
                        μ
                        
                           i
                        
                        +
                        σ
                        
                           i
                        ]. Lastly, we repeat the previous two steps for each index and state. This makes estimated parameters more robust.

Determining the proper number of states is also a critical part of the empirical research; higher number of states gives better fitness of model but severe computational burden because of exponentially increasing number of parameters that need to be estimated. Moreover, it is difficult to interpret the meaning of estimated parameters for each state under a complex structure of underlying regimes when the existence of many states is assumed. Prajogo (2011) suggests two criteria for determining the appropriate number of states. The first criterion is the Bayesian information criterion (BIC), which is introduced by Schwarz (1978).
                           4
                           There is another criterion to measure the goodness of model, which is Akaike’s information criterion (Akaike, 1974), but AIC only uses the number of parameters to penalize the fitness of models. We inspect AIC for several numbers of states and find the order of AIC to be the same as BIC.
                        
                        
                           4
                         BIC gives the adjusted value of likelihood by penalizing the number of parameters and observations, and is expressed as,
                           
                              
                                 
                                    
                                       
                                          BIC
                                          =
                                          -
                                          2
                                          ·
                                          ln
                                          Q
                                          +
                                          k
                                          ·
                                          ln
                                          T
                                          ,
                                       
                                    
                                    
                                       
                                          Q
                                          :
                                          likelihood
                                          
                                          calculated
                                          
                                          from
                                          
                                          Baum
                                          –
                                          Welch
                                          
                                          algorithm
                                       
                                    
                                    
                                       
                                          k
                                          :
                                          the
                                          
                                          number
                                          
                                          of
                                          
                                          parameters
                                          ,
                                       
                                    
                                    
                                       
                                          T
                                          :
                                          the
                                          
                                          number
                                          
                                          of
                                          
                                          observations
                                          .
                                       
                                    
                                 
                              
                           
                        In this case, the number of parameters k
                        =
                        K
                        ·
                        N
                        +
                        K
                        ·
                        N
                        2
                        +
                        K
                        2, where K is the number of states and N is the dimension of observations. The first term in the equation for k is from the mean vectors, second term is from the covariance matrices, and the last term is from the transition probability matrix. Given any two estimated models, the model with the lower value of BIC is the one to be preferred. We investigate the values of BIC for various numbers of states in our model. Table 1
                         shows that more number of states gives better BIC, in other words, improved fitness.

Unfortunately, BIC does not give valuable information on the structure of the hidden regimes. However, Prajogo (2011) suggests another method based on the finding that the transition probability from regime 1 to regime 3 is almost zero. Since this zero transition probability clearly suggests that the switch from regime 1 to regime 3 happens only by going through regime 2, the transition probability matrix can be used to determine the property of the regime switching behavior. Therefore, we investigate the transition probability matrix for different numbers of states.

Results for the two-state and three-state models are presented in Table 2
                        a and b, respectively. Table 2a shows relatively large probabilities for switching states, from state 1 to 2 and 2 to 1. In addition, the three-state model in Table 2b also has high probabilities for all transitions among states. However, as shown in Table 2c, the transition probability matrix of a four-state model shows that the transition from state 1 to state 4 is only possible by going through the state 2. Furthermore, each of states 3 and 4 has non-zero probabilities only for going to states 1 and 2, respectively. Based on these observations, we can conclude that states 2 and 3 are transition states in our case. Therefore, we decide on a four-state model because of the interpretable transition probability matrix and a relatively acceptable BIC value.

After learning the model, we find several characteristics of the regimes for each asset class. We investigate the key parameters of HMM such as the mean vector and covariance matrix for each state and also the transition probability matrix in various time periods. All time spans for the experiment have the same start date (January 2, 1980) but the end dates are varied from the last business day of 1995 to 2011. As shown in Fig. 1
                        , the transition probability matrices for all tested time spans show strong consistency, especially the parts with zero transition probabilities.

We extend our approach to mean vectors and covariance matrices. Covariance matrices include information of the volatility for each asset and the correlation between any two assets. The mean returns under four regimes for each index are shown in Fig. 2
                        a–c. Clearly, Fig. 2a shows that the mean return of state 4 of the equity index is the lowest. It also demonstrates that the mean return of state 2, as the transition state between states 1 and 4, is lower than the return of state 3, which has non-zero transition probability only to state 1.

According to the above findings, states 1 and 3 are ideal for investing in the equity index because there is virtually no probability of going into the worst state and both states also have positive mean returns. On the other hand, this simple strategy cannot be applied to the Goldman Sachs Commodity Index, as demonstrated in Fig. 2b, because the most attractive mean return is in state 2 in this case.

On the contrary to the equity market, states 1 and 3 have near-zero returns for the commodity market. This makes sense because the commodity price is determined by the supply and demand of the market. The lack of supply brings a rise in commodity price and an effort is made to increase the supply. However, there could be extra supply even after all demand is fulfilled because of the time lag in transporting the goods and this will trigger a sudden collapse in price. The period of supply shortage can be viewed as state 2 and the plunge of price might occur in state 4. This will also affect the equity index since an increase in price of raw materials will have a negative effect on business. On the other hand, the bond index shows that state 4 has the best return in most periods but its advantage as the stable asset is drastically decreased.


                        Fig. 2d–f shows results for volatilities and correlations. Especially, in Fig. 2d and e, state 4 shows large volatilities for the equity index and the commodity index. The bond return in state 4 is relatively high in the early periods but drastically decreases year by year as presented in Fig. 2f. However, Fig. 2h shows that the correlation between the equity and bond indices in states 2 and 4 have been decreasing more and more over time clearly showing that the diversification benefit of bonds in the unstable stock market periods is still effective.

The last noticeable finding is described in Fig. 2g, which analyzes the correlation between the equity index and the commodity index. Even though Gorton and Rouwenhorst (2006) claim that the overall correlation between two indices should be negative, the correlation between states 2 and 4 especially appears to be sharply increasing since the financial crisis in 2008, which provides evidence that the diversification effect of commodities is weakening in the unstable periods.

In reality, only information observed in the past is available for decision making. For example, if an investor, who can only observe daily closing prices of assets, makes an allocation decision today before the market closes, the investor has to make the decision based on the closing price series up to yesterday. Therefore, in the framework of HMM, we need to calculate P(s(t)∣y
                        1,t
                        ,θ),for ∀s
                        ∈
                        S, S
                        ={1,…,
                        K}, which is called the filtered probability. If we assume that P(s(yesterday)∣y
                        1,yesterday
                        ,
                        θ) is attainable up to today’s closing time, this additional data that is unobservable in reality can be used for portfolio optimization. This assumption is reasonable since the transition probability indicates that the market regime being stationary during a one-day period is noticeably higher than the probability of the current regime switching to another regime overnight.

Filtered probabilities are actually a by-product of the Baum–Welch algorithm, mainly from the expectation step. The first part of the Baum–Welch algorithm is known as the forward algorithm and the objective is to calculate the filtered probabilities. We follow the notation and derivation of Fraser (2008).

We can begin the forward algorithm by assigning
                           
                              
                                 α
                                 (
                                 s
                                 ,
                                 1
                                 )
                                 =
                                 
                                    
                                       P
                                    
                                    
                                       S
                                       (
                                       1
                                       )
                                       |
                                       Y
                                       (
                                       1
                                       )
                                    
                                 
                                 (
                                 s
                                 |
                                 y
                                 (
                                 1
                                 )
                                 )
                                 =
                                 
                                    
                                       
                                          
                                             P
                                          
                                          
                                             S
                                             (
                                             1
                                             )
                                          
                                       
                                       (
                                       s
                                       )
                                       
                                          
                                             P
                                          
                                          
                                             Y
                                             (
                                             t
                                             )
                                             |
                                             S
                                             (
                                             t
                                             )
                                          
                                       
                                       (
                                       y
                                       (
                                       1
                                       )
                                       |
                                       s
                                       )
                                    
                                    
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                
                                                   
                                                      s
                                                   
                                                   
                                                      ̃
                                                   
                                                
                                                ∈
                                                S
                                             
                                          
                                       
                                       
                                          
                                             P
                                          
                                          
                                             S
                                             (
                                             1
                                             )
                                          
                                       
                                       (
                                       
                                          
                                             s
                                          
                                          
                                             ̃
                                          
                                       
                                       )
                                       
                                          
                                             P
                                          
                                          
                                             Y
                                             (
                                             t
                                             )
                                             |
                                             S
                                             (
                                             t
                                             )
                                          
                                       
                                       (
                                       y
                                       (
                                       1
                                       )
                                       |
                                       
                                          
                                             s
                                          
                                          
                                             ̃
                                          
                                       
                                       )
                                    
                                 
                                 ,
                                 
                                 ∀
                                 s
                                 ∈
                                 S
                                 ,
                              
                           
                        where S is the set of all states and α(s,1) is the filtered probability at time t
                        =1. Then, we can forecast the distribution of states by computing
                           
                              
                                 
                                    
                                       P
                                    
                                    
                                       S
                                       (
                                       t
                                       )
                                       |
                                       
                                          
                                             Y
                                          
                                          
                                             1
                                             ,
                                             t
                                             -
                                             1
                                          
                                       
                                    
                                 
                                 (
                                 s
                                 |
                                 
                                    
                                       y
                                    
                                    
                                       1
                                       ,
                                       t
                                       -
                                       1
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          
                                             
                                                s
                                             
                                             
                                                ̃
                                             
                                          
                                          ∈
                                          S
                                       
                                    
                                 
                                 
                                    
                                       P
                                    
                                    
                                       S
                                       (
                                       t
                                       )
                                       |
                                       S
                                       (
                                       t
                                       -
                                       1
                                       )
                                    
                                 
                                 (
                                 s
                                 |
                                 
                                    
                                       s
                                    
                                    
                                       ̃
                                    
                                 
                                 )
                                 ·
                                 α
                                 (
                                 
                                    
                                       s
                                    
                                    
                                       ̃
                                    
                                 
                                 ,
                                 t
                                 -
                                 1
                                 )
                                 .
                              
                           
                        Once we have the forecasting distributions above, we can compute the joint probability of the state and current observation
                           
                              
                                 
                                    
                                       P
                                    
                                    
                                       S
                                       (
                                       t
                                       )
                                       ,
                                       Y
                                       (
                                       t
                                       )
                                       |
                                       
                                          
                                             Y
                                          
                                          
                                             1
                                             ,
                                             t
                                             -
                                             1
                                          
                                       
                                    
                                 
                                 (
                                 s
                                 ,
                                 y
                                 (
                                 t
                                 )
                                 |
                                 
                                    
                                       y
                                    
                                    
                                       1
                                       ,
                                       t
                                       -
                                       1
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       P
                                    
                                    
                                       Y
                                       (
                                       t
                                       )
                                       |
                                       S
                                       (
                                       t
                                       )
                                    
                                 
                                 (
                                 y
                                 (
                                 t
                                 )
                                 |
                                 s
                                 )
                                 ·
                                 
                                    
                                       P
                                    
                                    
                                       S
                                       (
                                       t
                                       )
                                       |
                                       
                                          
                                             Y
                                          
                                          
                                             1
                                             ,
                                             t
                                             -
                                             1
                                          
                                       
                                    
                                 
                                 (
                                 s
                                 |
                                 
                                    
                                       y
                                    
                                    
                                       1
                                       ,
                                       t
                                       -
                                       1
                                    
                                 
                                 )
                                 .
                              
                           
                        Next, we compute
                           
                              
                                 γ
                                 (
                                 t
                                 )
                                 =
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          s
                                          ∈
                                          S
                                       
                                    
                                 
                                 
                                    
                                       P
                                    
                                    
                                       S
                                       (
                                       t
                                       )
                                       ,
                                       Y
                                       (
                                       t
                                       )
                                       |
                                       
                                          
                                             Y
                                          
                                          
                                             1
                                             ,
                                             t
                                             -
                                             1
                                          
                                       
                                    
                                 
                                 (
                                 s
                                 ,
                                 y
                                 (
                                 t
                                 )
                                 |
                                 
                                    
                                       y
                                    
                                    
                                       1
                                       ,
                                       t
                                       -
                                       1
                                    
                                 
                                 )
                              
                           
                        and, finally, we can update the distribution of states
                           
                              
                                 α
                                 (
                                 s
                                 ,
                                 t
                                 )
                                 =
                                 
                                    
                                       P
                                    
                                    
                                       S
                                       (
                                       t
                                       )
                                       |
                                       
                                          
                                             Y
                                          
                                          
                                             1
                                             ,
                                             t
                                          
                                       
                                    
                                 
                                 (
                                 s
                                 |
                                 
                                    
                                       y
                                    
                                    
                                       1
                                       ,
                                       t
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       
                                          
                                             P
                                          
                                          
                                             S
                                             (
                                             t
                                             )
                                             ,
                                             Y
                                             (
                                             t
                                             )
                                             |
                                             
                                                
                                                   Y
                                                
                                                
                                                   1
                                                   ,
                                                   t
                                                   -
                                                   1
                                                
                                             
                                          
                                       
                                       (
                                       s
                                       ,
                                       y
                                       (
                                       t
                                       )
                                       |
                                       
                                          
                                             y
                                          
                                          
                                             1
                                             ,
                                             t
                                             -
                                             1
                                          
                                       
                                       )
                                    
                                    
                                       γ
                                       (
                                       t
                                       )
                                    
                                 
                                 .
                              
                           
                        The filtered probability α(s,
                        t) represents the probability of currently being in the market state s with given realized observation y
                        1,t
                        . Therefore, if our HMM is well trained, the filtered probability for state 4 should be high in the crash periods (1998, 2003, 2008, and 2010). The parameter set θ is optimized every year. For example, the parameter set θ with the filtered probabilities from January 1996 to December 1996 is computed using data from January 1980 to December 1995.

The filtered probabilities show good fitness especially in the crash periods. Fig. 3
                         demonstrates the negative correlation between the equity index and the bond index in state 4. On the other hand, the equity index and the commodity index show a similar behavior especially after the financial crisis in 2008. In addition, Fig. 3 shows the relationship between wealth paths and filtered probabilities. This figure gave us one clue of the possibility that the regime information can improve the decision making for the asset allocation. The filtered probabilities of state 4 (darkest gray) drastically increase in crises such as the subprime mortgage crisis of 2008 and Eurozone crisis of 2010 and 2011.

Harry Markowitz understood the importance of extending his approach in future research. For example, in his book (Markowitz, 1959), he suggests that employing a von Neumann utility function should be considered in the future (below). The listed criteria are amply satisfied at present.
                           
                              “When efficient set analyses become familiar, when the use of computing machines to help select portfolios is more commonplace, when investment managers are ready to consider additional sophistications, this is the time to apply directly the single time period utility analysis to the selection of actual portfolios.”
                           
                        
                     

Stochastic programming gives us the chance to construct the utility function which is a representation of the investor’s willingness to bear risk including probabilistic information. Stochastic programming models are applied to financial planning problems under various settings (Mulvey and Vladimirou, 1992; Ziemba and Mulvey, 1998; Ziemba, 2009). In this chapter, we construct a simple example of financial planning for a pension fund based on Birge and Louveaux (1997). Suppose there is a hedge fund manager who wants to construct a portfolio composed of three indices representing the US equity market, US government bond market, and US commodity market. In addition, the manager sets the target of this portfolio, with initial wealth $b, as reaching excess wealth of $G after D days. The uncertainty of this model is the daily return of each index. We assume that the three-dimensional return series of the portfolio is generated from the multivariate normal distribution for one of the possible regimes. Moreover, we can compute the conditional probability of being in each regime given all observations up to the close of the previous day. We use these probabilities to generate scenarios for each time step.

In this example, we follow the utility function introduced by Birge and Louveaux (1997). They develop a simple method for generating scenarios that converts the randomness of a model to a fixed set of possible cases. We suppose that exceeding $G after D days is equivalent to a g% utility increase in excess wealth and a 1% decrease in shortage. This utility function is concave and piecewise linear. The daily growth for each index at time t, the major source of randomness, is denoted as ξ(i,
                        t,
                        ω), where i is the index number and ω is the random element. Since the decisions are related to ξ, the allocated wealth for index i at time t, x(i,
                        t,
                        ω), is the decision variable for ξ(i,
                        t,
                        ω).

To map the random elements to a set of numbers, we construct a scenario tree as shown in Fig. 4
                        . Random elements ω can be represented with a finite number of branches and each path of the tree becomes a single possible scenario b
                        
                           t
                         at time t during the D-day period, where b
                        
                           t
                        
                        ∈{0,1,…,
                        M} and t
                        ∈{0,1,…,
                        D}. Thus, we can replace all the random variables to ξ(i,
                        t,[b
                        1,
                        b
                        2,…,
                        b
                        
                           D
                        ]) and x(i,
                        t,[b
                        1,
                        b
                        2,…,
                        b
                        
                           D
                        ]), which allows us to compare the surplus and shortage with $G for each node so we also define the surplus variable y(b
                        1,
                        b
                        2,…,
                        b
                        
                           D
                        ) and the shortage variable w(b
                        1,
                        b
                        2,…,
                        b
                        
                           D
                        ).

We now add regime information to this example by using filtered probabilities to generate the estimated return series in the next time period. The following five steps are performed for scenario generation.
                           
                              1.
                              Decide the number of children for the current node of the scenario tree.

Denote B(b,
                                 t)=[b
                                 1,…,
                                 b
                                 
                                    t
                                 
                                 =
                                 b,…,
                                 b
                                 
                                    D
                                 ] where b
                                 
                                    t
                                 
                                 ∈{0,1,…,
                                 M} for ∀t
                                 ∈{0,1,…,
                                 D} and b
                                 
                                    t+1 to b
                                 
                                    D
                                 
                                 =0 (zero represents values “not realized”).

For each filtered probability Pr(s,
                                 t,
                                 B(b,
                                 t)), where s
                                 ∈ {1,…,
                                 K}, assign b′th child node if 
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                             =
                                             0
                                          
                                          
                                             s
                                             -
                                             1
                                          
                                       
                                       Pr
                                       (
                                       i
                                       ,
                                       t
                                       ,
                                       B
                                       (
                                       b
                                       ,
                                       t
                                       )
                                       )
                                       <
                                       (
                                       
                                          
                                             b
                                          
                                          
                                             t
                                             +
                                             1
                                          
                                       
                                       =
                                       
                                          
                                             b
                                          
                                          
                                             ′
                                          
                                       
                                       )
                                       ⩽
                                       M
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                             =
                                             0
                                          
                                          
                                             s
                                          
                                       
                                       Pr
                                       (
                                       i
                                       ,
                                       t
                                       ,
                                       B
                                       (
                                       b
                                       ,
                                       t
                                       )
                                       )
                                    
                                 . Then, B(b′,
                                 t
                                 +1)=[b
                                 1,…,
                                 b
                                 
                                    t
                                 
                                 =
                                 b,
                                 b
                                 
                                    t+1
                                 =
                                 b′,…,
                                 b
                                 
                                    D
                                 ] and b
                                 
                                    t+2 to b
                                 
                                    D
                                 
                                 =0.

For each child node, if state s is assigned in the target child node, apply the mean vector μ
                                 
                                    s
                                  and covariance matrix Σ
                                 
                                    s
                                  from the estimated parameter set θ of HMM.

Generate the sample return r(s,
                                 B(b′,
                                 t
                                 +1))∼ MVN(μ
                                 
                                    s
                                 ,Σ
                                 
                                    s
                                 ).
                                    
                                       
                                          ξ
                                          (
                                          i
                                          ,
                                          t
                                          +
                                          1
                                          ,
                                          B
                                          (
                                          
                                             
                                                b
                                             
                                             
                                                ′
                                             
                                          
                                          ,
                                          t
                                          +
                                          1
                                          )
                                          )
                                          =
                                          1
                                          +
                                          r
                                          (
                                          i
                                          ,
                                          s
                                          ,
                                          B
                                          (
                                          
                                             
                                                b
                                             
                                             
                                                ′
                                             
                                          
                                          ,
                                          t
                                          +
                                          1
                                          )
                                          )
                                          ,
                                       
                                    
                                 
                                 
                                    
                                       
                                          i
                                          ∈
                                          {
                                          equity
                                          
                                          index
                                          ,
                                          
                                          bond
                                          
                                          index
                                          ,
                                          
                                          commodity
                                          
                                          index
                                          }
                                          .
                                       
                                    
                                 
                              

Calculate the filtered probability Pr(s′, t+1,
                                 B(b′,
                                 t
                                 +1)) where s′∈{1,…
                                 K} for each child node B(b′,
                                 t
                                 +1) where b′∈{1,…,
                                 M} by using the forward algorithm given r(s,
                                 B(b′,
                                 t
                                 +1)) and θ.

Repeat steps 1–4 for each child node, and then update t to t
                                 +1.

Repeat until t
                                 =
                                 D.

The optimization problem is formulated as below.
                           
                              Objective function:
                                    
                                       
                                          Maximize
                                          
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   =
                                                   1
                                                
                                                
                                                   M
                                                
                                             
                                          
                                          …
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         D
                                                      
                                                   
                                                   =
                                                   1
                                                
                                                
                                                   M
                                                
                                             
                                          
                                          
                                             
                                                1
                                             
                                             
                                                
                                                   
                                                      M
                                                   
                                                   
                                                      D
                                                   
                                                
                                             
                                          
                                          (
                                          g
                                          ·
                                          y
                                          (
                                          
                                             
                                                b
                                             
                                             
                                                1
                                             
                                          
                                          ,
                                          
                                             
                                                b
                                             
                                             
                                                2
                                             
                                          
                                          ,
                                          …
                                          ,
                                          
                                             
                                                b
                                             
                                             
                                                D
                                             
                                          
                                          )
                                          -
                                          l
                                          ·
                                          w
                                          (
                                          
                                             
                                                b
                                             
                                             
                                                1
                                             
                                          
                                          ,
                                          
                                             
                                                b
                                             
                                             
                                                2
                                             
                                          
                                          ,
                                          …
                                          ,
                                          
                                             
                                                b
                                             
                                             
                                                D
                                             
                                          
                                          )
                                          )
                                       
                                    
                                 
                              

Initial wealth balance constraint:
                                    
                                       
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   i
                                                
                                             
                                          
                                          x
                                          (
                                          i
                                          ,
                                          0
                                          ,
                                          [
                                          0
                                          ,
                                          0
                                          ,
                                          …
                                          ,
                                          0
                                          ]
                                          )
                                          =
                                          W
                                       
                                    
                                 
                              

Constraints for each period t
                                 =1…
                                 D:
                                    
                                       
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   i
                                                
                                             
                                          
                                          -
                                          ξ
                                          (
                                          i
                                          ,
                                          t
                                          ,
                                          [
                                          
                                             
                                                b
                                             
                                             
                                                1
                                             
                                          
                                          ,
                                          …
                                          ,
                                          
                                             
                                                b
                                             
                                             
                                                t
                                             
                                          
                                          ,
                                          0
                                          ,
                                          …
                                          ,
                                          0
                                          ]
                                          )
                                          x
                                          (
                                          i
                                          ,
                                          t
                                          -
                                          1
                                          ,
                                          [
                                          
                                             
                                                b
                                             
                                             
                                                1
                                             
                                          
                                          ,
                                          …
                                          ,
                                          
                                             
                                                b
                                             
                                             
                                                t
                                                -
                                                1
                                             
                                          
                                          ,
                                          0
                                          ,
                                          …
                                          ,
                                          0
                                          ]
                                          )
                                          +
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   i
                                                
                                             
                                          
                                          x
                                          (
                                          i
                                          ,
                                          t
                                          ,
                                          [
                                          
                                             
                                                b
                                             
                                             
                                                1
                                             
                                          
                                          ,
                                          …
                                          ,
                                          
                                             
                                                b
                                             
                                             
                                                t
                                             
                                          
                                          ,
                                          0
                                          ,
                                          …
                                          ,
                                          0
                                          ]
                                          )
                                          =
                                          0
                                          ,
                                          
                                          for
                                          
                                          t
                                          =
                                          1
                                          …
                                          D
                                          -
                                          1
                                       
                                    
                                 
                              

Final goal constraint:
                                    
                                       
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   i
                                                
                                             
                                          
                                          -
                                          ξ
                                          (
                                          i
                                          ,
                                          D
                                          ,
                                          [
                                          
                                             
                                                b
                                             
                                             
                                                1
                                             
                                          
                                          ,
                                          …
                                          ,
                                          
                                             
                                                b
                                             
                                             
                                                D
                                             
                                          
                                          ]
                                          )
                                          x
                                          (
                                          i
                                          ,
                                          D
                                          -
                                          1
                                          ,
                                          [
                                          
                                             
                                                b
                                             
                                             
                                                1
                                             
                                          
                                          ,
                                          …
                                          ,
                                          
                                             
                                                b
                                             
                                             
                                                D
                                                -
                                                1
                                             
                                          
                                          ,
                                          0
                                          ]
                                          )
                                          -
                                          y
                                          (
                                          
                                             
                                                b
                                             
                                             
                                                1
                                             
                                          
                                          ,
                                          
                                             
                                                b
                                             
                                             
                                                2
                                             
                                          
                                          ,
                                          …
                                          ,
                                          
                                             
                                                b
                                             
                                             
                                                D
                                             
                                          
                                          )
                                          +
                                          w
                                          (
                                          
                                             
                                                b
                                             
                                             
                                                1
                                             
                                          
                                          ,
                                          
                                             
                                                b
                                             
                                             
                                                2
                                             
                                          
                                          ,
                                          …
                                          ,
                                          
                                             
                                                b
                                             
                                             
                                                D
                                             
                                          
                                          )
                                          =
                                          G
                                       
                                    
                                 For all decision variables x, y, and w that satisfy the non-negativity constraint.

In order to empirically test the stochastic programming method under the regime framework, we perform rolling-horizon simulations. Golub et al. (1995), Fleten et al. (2002), and Kouwenberg (2001) apply this method to measure the performance of their financial models with several benchmarks. We begin our analysis by generating enough scenario trees for a specified time t given the filtered probability of the previous time period (in this case, the previous day). Since the return vector of indices is randomly generated under the given regime, we solve all generated scenario trees and compute the average of the initial wealth distribution. This gives us the optimal decision at time t. Once the return series during time t is realized, we then calculate the filtered probabilities and repeat the previous steps to find the optimal decision for the next period, t
                     +1. We compare this dynamically optimized portfolio with the individual indices along with daily rebalanced equal-weighted and fixed-mix portfolios of indices. To generate scenario trees, we use the same setting as in the example mentioned above. The initial wealth $b is set to 1 and the goal of $G after 3days is 1.005. The reward ratio of excess g is 1 and loss ratio of shortage l is 4. We generate eight nodes for each branch. The portfolios and benchmarks are compared and the most recognized performance measures are presented in Table 3
                     .

The risk-adjusted performance measures such as the Sharpe ratio, return over maximum drawdown, and Ulcer performance index (UPI) show that the dynamically optimized portfolio is overall relatively better than other benchmarks. Moreover, we can observe the behavior of our dynamic portfolio through the allocation in each index among the portfolio constituents, also referred to as the sub-strategies. Table 3b shows that the dynamic portfolio assigns its wealth to the equity and commodity indices rather than the bond index during the Dot-Com bubble period. Meanwhile, the portfolio invests heavily in the bond index during the financial crisis of 2008 as presented in Table 3d. These observations provide evidence that the stochastic programming approach under the regime framework improves portfolio optimization. We can directly see the behavior of the portfolio by plotting the filtered probabilities and the change in portfolio weights as shown in Fig. 5
                     .

From these experiments, we can observe several properties of our dynamic portfolio where one noteworthy finding is that the portfolio mainly invests in the stable asset, the bond index. In addition, the weights of the risky assets, the equity index and the commodity index, decrease during crash periods. Fig. 6
                      shows the growth for each index and portfolio more graphically and also shows support for the improved performance and stability of our portfolio.

@&#CONCLUSION@&#

In this paper, we identify regimes for the stock, bond, and commodity markets and apply this information to a portfolio optimization problem to overcome the limitations of the Markowitz model. We construct a four-state HMM with three-dimensional input data and train the model with yearly increments using historical market returns. The parameters of this model reasonably represent the financial market; the states are clearly separated and each state has its own distinct property. For example, states 1 and 3 show extremely positive market conditions of the equity market and state 4 represents market crashes. On the other hand, state 2 has characteristics of a transition period between states 1 and 4. The commodity market index is little different. The commodity index shows radical growth in state 2 instead of states 1 and 3. However, the state 4 shows similar characteristics of mean return and volatility to the equity index and this explains the equity and commodity markets were plunged together.

This complex information of multiple markets in each regime can be applied to a stochastic program for portfolio optimization. Identified regimes give multiple distributions for assets so the assumption of a single static return distribution of the mean–variance model is relaxed. We build an example of managing a pension fund by using a piecewise linear utility function to utilize the rolling-horizon simulation. Overall, this portfolio outperforms other benchmarks but does especially outstanding during crash periods. We can conclude that the regime information helps portfolios avoid risk during left-tail events.

@&#ACKNOWLEDGEMENTS@&#

This research was supported by Basic Science Research Program through the National Research Foundation of Korea (NRF) funded by the Ministry of Education, Science and Technology (Grant Number: NRF-2012R1A1A1011157).

@&#REFERENCES@&#

