@&#MAIN-TITLE@&#Adaptability checking in complex systems

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           Hierarchical model for multi-level adaptive systems.


                        
                        
                           
                           Relational characterisation of strong and weak adaptability.


                        
                        
                           
                           Adaptability checking is reduced to a CTL model checking problem.


                        
                        
                           
                           Application to the case study of ATVs motion control.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Adaptive systems

State machine

Adaptability relations

Adaptability checking

S[B] model

@&#ABSTRACT@&#


               
               
                  A hierarchical approach for modelling the adaptability features of complex systems is introduced. It is based on a structural level S, describing the adaptation dynamics of the system, and a behavioural level B accounting for the description of the admissible dynamics of the system. Moreover, a unified system, called 
                        S
                        [
                        B
                        ]
                     , is defined by coupling S and B. The adaptation semantics is such that the S level imposes structural constraints on the B level, which has to adapt whenever it no longer can satisfy them. In this context, we introduce weak and strong adaptability, i.e. the ability of a system to adapt for some evolution paths or for all possible evolutions, respectively. We provide a relational characterisation for these two notions and we show that adaptability checking, i.e. deciding if a system is weakly or strongly adaptable, can be reduced to a CTL model checking problem. We apply the model and the theoretical results to the case study of a motion controller of autonomous transport vehicles.
               
            

@&#INTRODUCTION@&#

Self-adaptive systems are particular systems able to modify their own behaviour according to their current configuration and the perception of the environment in which they operate. They develop new strategies in order to fulfil an objective, properly respond to changes of the environmental conditions or, more generally, maintain desired conditions.

From a broad viewpoint, self-adaptiveness is an intrinsic property of complex natural systems. Self-adaptation is a process driving both the evolution and the development of living organisms that adapt their features and change their phenotype in order to survive to the current habitat, to achieve higher levels of fitness and to appropriately react to external stimuli.

Nowadays, software systems are increasingly resembling complex systems; this motivates the development of methods for enabling software self-adaptiveness. Similarly to natural systems, “Self-adaptive software evaluates its own behaviour and changes behaviour when the evaluation indicates that it is not accomplishing what the software is intended to do, or when better functionality or performance is possible” 
                     [35]. Self-adaptive software finds application in fields like autonomic computing, service-oriented architectures, pervasive service ecosystems, mobile networks, multi-agent systems, and ultra-large-scale software systems [25], characterised by distributed, autonomous, interacting, heterogeneous, conflicting and evolvable sub-systems.

In this work, we develop a formal hierarchical model for self-adaptive systems, where two fundamental levels are defined: the behavioural level B, which describes the admissible dynamics of the system; and the structural level S, accounting for the invariant features of the system that regulate the behaviour of the system. More precisely, both levels are modelled as state machines, but each state of the S level is associated with a set of constraints, i.e. logical formulas over observable variables of the B level.

An S state in the structural level represents a relatively persistent situation, a steady region for the B level, identified by the set of B states satisfying the constraints. Therefore S is a higher order structure whose states can be interpreted as sets of B states, and whose transitions can be viewed as mappings among sets of B states. The coupled model will be referred to as 
                        S
                        [
                        B
                        ]
                     , in order to highlight the two basic levels that compose the system.

The 
                        S
                        [
                        B
                        ]
                      model is broadly inspired by a previous work of some of the authors, a spatial bio-inspired process algebra called Shape Calculus 
                     [3,4], where processes are characterised by a reactive behaviour B and by a shape S that imposes a set of geometrical constraints on their interactions and occupancy in the three-dimensional Euclidean space. Here, instead, the computational approach is shifted in a more general context, where S and B are coupled by a hierarchical relation defined on the structural constraints of the S level and the state space of the B level.

The adaptation semantics can be briefly described as follows. Consider an 
                        S
                        [
                        B
                        ]
                      system, let q be the current state of B and assume that it satisfies the constraints of the current S state. The adaptation is triggered whenever q cannot evolve because there is no next B state that satisfies the current S constraints. During adaptation, the 
                        S
                        [
                        B
                        ]
                      system attempts to evolve towards a new B state that satisfies a new S state, chosen among the successors of the current one. In this phase B is no more constrained by S. Adaptation terminates successfully when B ends up in a state that fulfils the new global situation represented by one of the admissible S states.

A first general introduction of the 
                        S
                        [
                        B
                        ]
                      model was given in [38] and [39] by the authors. In this work, we provide several novelties and improvements, most of them devoted to the adaptability checking problem, i.e. the automatic checking of the adaptation capabilities of a given 
                        S
                        [
                        B
                        ]
                      system. In particular, we define the notion of weak adaptability, possessed by an 
                        S
                        [
                        B
                        ]
                      system that is able to adapt along some of all its possible evolution paths. Strong adaptability requires that the 
                        S
                        [
                        B
                        ]
                      system is able to adapt along all its possible evolution paths. We formulate the notions of weak and strong adaptability as relations between the states of B and S and also in logical form, as Computation Tree Logic (CTL) formulas over the given semantics of an 
                        S
                        [
                        B
                        ]
                      system. Then, we formally prove the equivalence between the relational and the logical formulation of strong and weak adaptability (Theorems 1 and 2), showing that the adaptability checking problem can be reduced to a classical model checking problem. We also discuss the computational complexity of our approach. The effectiveness of the 
                        S
                        [
                        B
                        ]
                      approach for self-adaptive systems is demonstrated using a case study in the context of adaptive software systems, a model for a motion controller of autonomous transport vehicles in a smart airport. The same case study is used for exemplifying the notions of weak and strong adaptability and the adaptability checking problem.

The paper is organised as follows. Section 2 introduces the formalism and the syntax of the 
                        S
                        [
                        B
                        ]
                      model. Section 3 illustrates the application of the model to the example of adaptive motion controller. In Section 4 we give the operational semantics of an 
                        S
                        [
                        B
                        ]
                      system by means of a flattened transition system. In Section 5 we formalise the relations of weak and strong adaptation, which we equivalently characterise as CTL formulas in Section 6. Related works including adaptation features of 
                        S
                        [
                        B
                        ]
                     , and conclusions are given in Section 7. Finally, proofs are presented in Appendix A.

In the 
                        S
                        [
                        B
                        ]
                      approach, a model encapsulates both the behavioural (B) and the structural (S) level of an adaptive system. The behavioural level is classically described as a finite state machine of the form 
                        B
                        =
                        
                           
                              (
                              Q
                              ,
                              
                                 
                                    q
                                 
                                 
                                    0
                                 
                              
                              ,
                              →
                           
                           
                              B
                           
                        
                        )
                      where Q is a set of B states, 
                        
                           
                              q
                           
                           
                              0
                           
                        
                      initial B state and 
                        
                           
                              →
                           
                           
                              B
                           
                        
                      transition relation. The structural level is modelled as a finite state machine 
                        S
                        =
                        
                           
                              (
                              R
                              ,
                              
                                 
                                    r
                                 
                                 
                                    0
                                 
                              
                              ,
                              O
                              ,
                              →
                           
                           
                              S
                           
                        
                        ,
                        L
                        )
                      where R is a set of S states, 
                        
                           
                              r
                           
                           
                              0
                           
                        
                      is the initial S state, 
                        O
                      is an observation function, 
                        
                           
                              →
                           
                           
                              S
                           
                        
                      is a transition relation and L is a state labelling function. The function L labels each S state with a formula representing a set of constraints over an observation of the B states. Therefore an S state r can be directly mapped to the set of B states satisfying 
                        L
                        (
                        r
                        )
                     . Through this mapping, S can be viewed as a second-order structure 
                        S
                        =
                        
                           
                              (
                              R
                              ⊆
                              
                                 
                                    2
                                 
                                 
                                    Q
                                 
                              
                              ,
                              
                                 
                                    r
                                 
                                 
                                    0
                                 
                              
                              ,
                              O
                              ,
                              →
                           
                           
                              S
                           
                        
                        ⊆
                        R
                        ×
                        R
                        )
                      where each S state r is identified with its corresponding set of B states. An 
                        S
                        [
                        B
                        ]
                      system is the result of coupling the two levels S and B through the observation function 
                        O
                      and an evaluation function 
                        [
                        [
                        ⋅
                        ]
                        ]
                     , that maps each S state to the set of B states meeting the constraints.

The 
                        S
                        [
                        B
                        ]
                      adaptation is achieved by switching from an S state to another S state where a different set of constraints holds. During adaptation the B machine is no more regulated by the structural level, except for an adaptation invariant, called adaptation invariant, that must be fulfilled by the system while adapting. The system adapts by following any trajectory that is present at the B level that does not violate the invariant condition, which can be used as a safety condition if some activities of the B level must be avoided during adaptation.

In order to realise our notion of 
                        S
                        [
                        B
                        ]
                      adaptiveness, there must be some information flowing both from B to S and vice versa. In particular, the information from B to S is modelled here as a set of variables 
                        A
                        =
                        {
                        
                           
                              a
                           
                           
                              1
                           
                        
                        ,
                        …
                        ,
                        
                           
                              a
                           
                           
                              n
                           
                        
                        }
                      called observables of the S on the B level. The values of these variables must always be derivable from the information contained in the B states. This makes our approach black-box-oriented, that is to say, S has not the full knowledge of B, but only some derived information.

In control-theoretic terms, as illustrated in Fig. 1
                     , the adaptation model of an 
                        S
                        [
                        B
                        ]
                      system can be viewed as a closed-loop system where B is the plant and S is the controller. Let q and r be the current states of B and S. B outputs the vector
                        1
                     
                     
                        1
                        With abuse of notation, we allow the Post operator to return an indexed vector of states instead of a set.
                      
                     
                        B
                        =
                        
                           Post
                        
                        (
                        q
                        )
                      of the states reachable from q with a single transition, i.e. an element 
                        
                           
                              q
                           
                           
                              i
                           
                        
                      of B is such that 
                        q
                        
                           
                              →
                           
                           
                              B
                           
                        
                        
                           
                              q
                           
                           
                              i
                           
                        
                      and each state is unique: 
                        
                           
                              ⋀
                           
                           
                              i
                              ≠
                              j
                           
                        
                        
                           
                              q
                           
                           
                              i
                           
                        
                        ≠
                        
                           
                              q
                           
                           
                              j
                           
                        
                     . Since S can only observe some features of B states, the observer 
                        O
                      will provide S with a vector of observations made over the values of the variables characterising each state in B: 
                        o
                        =
                        
                           
                              ∏
                           
                           
                              i
                           
                        
                        O
                        (
                        
                           
                              q
                           
                           
                              i
                           
                        
                        )
                     .


                     S will check the observables provided by o with respect to its current state r. If its constraints are satisfied, S will remain in the same state and 
                        S
                        [
                        B
                        ]
                      will proceed in steady mode. Otherwise, S will perform a transition to a new r state forcing the 
                        S
                        [
                        B
                        ]
                      system to enter an adaptation mode. Here we assume that the updated r is computed with a function Check that takes the current S state and observations. The feedback loop closes with the selection of the eligible next states B outputted to B, i.e. those states that satisfy the current constraints of r or those that satisfy the current adaptation invariant. The set B is obtained by applying the evaluation function 
                        [
                        [
                        ⋅
                        ]
                        ]
                      to either the constraints of r or the invariant. In the adaptation mode the output is calculated using the whole B machine without constraints except the adaptation invariant, to make B free to explore the state space. In turn, B updates its current state q by selecting one of the eligible states provided in B. The concepts of observation function 
                        O
                      and evaluation function 
                        [
                        [
                        ⋅
                        ]
                        ]
                      are formalised in Definition 1 and Definition 2.

The constraints characterising the states of an S level are expressed using formulas of a many-sorted first order logic. More precisely, the definition of an S level includes the definition of a many-sorted signature Σ containing some function symbols, some predicate symbols and some sorts 
                           
                              
                                 D
                              
                              
                                 1
                              
                           
                           ,
                           …
                           ,
                           
                              
                                 D
                              
                              
                                 k
                              
                           
                        . Σ-terms and Σ-formulas are constructed in the standard way [24]. In addition, a particular set of sorted variables, which we call observables, must be fixed. Such a set is of the form 
                           A
                           =
                           {
                           
                              
                                 a
                              
                              
                                 1
                              
                           
                           :
                           
                              
                                 D
                              
                              
                                 
                                    
                                       j
                                    
                                    
                                       1
                                    
                                 
                              
                           
                           ,
                           …
                           ,
                           
                              
                                 a
                              
                              
                                 n
                              
                           
                           :
                           
                              
                                 D
                              
                              
                                 
                                    
                                       j
                                    
                                    
                                       n
                                    
                                 
                              
                           
                           }
                        , where 
                           
                              
                                 j
                              
                              
                                 i
                              
                           
                           ∈
                           {
                           1
                           ,
                           …
                           ,
                           k
                           }
                         for all 
                           i
                           =
                           1
                           ,
                           …
                           ,
                           n
                        . Then, constraints can be expressed as Σ-formulas ψ such that the variables that occur free in ψ, denoted by 
                           
                              free
                           
                           (
                           ψ
                           )
                        , are a (possibly empty) subset of A. This set will be denoted by 
                           Ψ
                           (
                           Σ
                           ,
                           A
                           )
                           =
                           {
                           ψ
                           |
                           ψ
                            is a 
                           Σ
                           -formula
                           ∧
                           
                              free
                           
                           (
                           ψ
                           )
                           ⊆
                           A
                           }
                        .

We also impose that a particular structure M is fixed for the evaluation of Σ-formulas. M consists of k non-empty domains 
                           M
                           (
                           
                              
                                 D
                              
                              
                                 1
                              
                           
                           )
                           ,
                           …
                           ,
                           M
                           (
                           
                              
                                 D
                              
                              
                                 k
                              
                           
                           )
                        , as carrier sets for sorts, together with interpretations for all function and predicate symbols of Σ. To obtain the full semantic evaluation of formulas in 
                           Ψ
                           (
                           Σ
                           ,
                           A
                           )
                         we will take the values for the free variables in A from an observation function.


                        
                           Definition 1
                           Observation function


                           Let 
                                 Q
                               be the universe set of all states of machines possibly representing B levels. Let Σ be a many-sorted signature, let 
                                 A
                                 =
                                 {
                                 
                                    
                                       a
                                    
                                    
                                       1
                                    
                                 
                                 :
                                 
                                    
                                       D
                                    
                                    
                                       
                                          
                                             j
                                          
                                          
                                             1
                                          
                                       
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    
                                       a
                                    
                                    
                                       n
                                    
                                 
                                 :
                                 
                                    
                                       D
                                    
                                    
                                       
                                          
                                             j
                                          
                                          
                                             n
                                          
                                       
                                    
                                 
                                 }
                               be a set of observables and let M be a structure for the evaluation of Σ-formulas. An observation function 
                              
                                 
                                    
                                       O
                                    
                                    
                                       M
                                    
                                    
                                       Σ
                                       ,
                                       A
                                    
                                 
                               on Σ, A and M is a partial function
                                 
                                    
                                       
                                          
                                             O
                                          
                                          
                                             M
                                          
                                          
                                             Σ
                                             ,
                                             A
                                          
                                       
                                       :
                                       Q
                                       ↪
                                       (
                                       A
                                       →
                                       D
                                       )
                                    
                                 
                               where (i) 
                                 D
                                 =
                                 
                                    
                                       ⋃
                                    
                                    
                                       i
                                       =
                                       1
                                    
                                    
                                       n
                                    
                                 
                                 M
                                 (
                                 
                                    
                                       D
                                    
                                    
                                       
                                          
                                             j
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                                 )
                               and (ii) for any state 
                                 q
                                 ∈
                                 Q
                              , if 
                                 
                                    
                                       O
                                    
                                    
                                       M
                                    
                                    
                                       Σ
                                       ,
                                       A
                                    
                                 
                                 (
                                 q
                                 )
                                 ≠
                                 ⊥
                               then 
                                 
                                    
                                       O
                                    
                                    
                                       M
                                    
                                    
                                       Σ
                                       ,
                                       A
                                    
                                 
                                 (
                                 q
                                 )
                                 (
                                 
                                    
                                       a
                                    
                                    
                                       i
                                    
                                 
                                 :
                                 
                                    
                                       D
                                    
                                    
                                       
                                          
                                             j
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                                 )
                                 ∈
                                 M
                                 (
                                 
                                    
                                       D
                                    
                                    
                                       
                                          
                                             j
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                                 )
                              , for all 
                                 i
                                 =
                                 1
                                 ,
                                 …
                                 ,
                                 n
                              . For a lighter notation, we will use 
                                 O
                               instead of 
                                 
                                    
                                       O
                                    
                                    
                                       M
                                    
                                    
                                       Σ
                                       ,
                                       A
                                    
                                 
                               when 
                                 Σ
                                 ,
                                 A
                               and M are clear from the context.

Note that the use of the universe of states as domain makes the definition of the observation function independent from a particular state machine representing a behavioural level B. Note also that we do not require the observation function to be injective. This means that some different states can give the same values to the observables. In this case, the difference among the states is not visible to S through the observation, but it is internal to B.

To complete the machinery for checking whether a set of constraints is satisfied or not, we define the satisfaction relation in the natural way.


                        
                           Definition 2
                           Satisfaction relation


                           Let 
                                 
                                    
                                       O
                                    
                                    
                                       M
                                    
                                    
                                       Σ
                                       ,
                                       A
                                    
                                 
                               be an observation function. A state 
                                 q
                                 ∈
                                 Q
                               
                              satisfies a formula 
                                 ψ
                                 ∈
                                 Ψ
                                 (
                                 Σ
                                 ,
                                 A
                                 )
                              , written 
                                 q
                                 ⊨
                                 ψ
                              , iff 
                                 
                                    
                                       O
                                    
                                    
                                       M
                                    
                                    
                                       Σ
                                       ,
                                       A
                                    
                                 
                                 (
                                 q
                                 )
                                 ≠
                                 ⊥
                               and ψ is true, according to the standard semantics of many-sorted first order logic, with respect to the structure M and by substituting in ψ every occurrence of the free sorted variable 
                                 
                                    
                                       a
                                    
                                    
                                       i
                                    
                                 
                                 :
                                 
                                    
                                       D
                                    
                                    
                                       
                                          
                                             j
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                               with 
                                 
                                    
                                       O
                                    
                                    
                                       M
                                    
                                    
                                       Σ
                                       ,
                                       A
                                    
                                 
                                 (
                                 q
                                 )
                                 (
                                 
                                    
                                       a
                                    
                                    
                                       i
                                    
                                 
                                 :
                                 
                                    
                                       D
                                    
                                    
                                       
                                          
                                             j
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                                 )
                              .

We also define an evaluation function 
                                 [
                                 [
                                 ⋅
                                 ]
                                 ]
                                 :
                                 Ψ
                                 (
                                 Σ
                                 ,
                                 A
                                 )
                                 →
                                 
                                    
                                       2
                                    
                                    
                                       Q
                                    
                                 
                               mapping a formula 
                                 ψ
                                 ∈
                                 Ψ
                                 (
                                 Σ
                                 ,
                                 A
                                 )
                               to the set of states 
                                 [
                                 [
                                 ψ
                                 ]
                                 ]
                                 =
                                 {
                                 q
                                 ∈
                                 Q
                                 |
                                 q
                                 ⊨
                                 ψ
                                 }
                              , i.e. those satisfying ψ.

A set of constraints is formally expressed by a formula 
                           ψ
                           ∈
                           Ψ
                           (
                           Σ
                           ,
                           A
                           )
                         that is the conjunction of all the formulas representing each constraint in the set. The set of constraints is satisfied if and only if the corresponding formula is true in the fixed structure M and observation 
                           
                              
                                 O
                              
                              
                                 M
                              
                              
                                 Σ
                                 ,
                                 A
                              
                           
                        . 
                           Example 1
                           Let us consider a set of observables and associated sorts:
                                 
                                    
                                       A
                                       =
                                       {
                                       
                                          velocity
                                       
                                       :
                                       R
                                       ,
                                       
                                       
                                          congestion
                                       
                                       :
                                       B
                                       }
                                    
                                 
                               Consider also a signature 
                                 Σ
                                 =
                                 {
                                 R
                                 ,
                                 B
                                 ,
                                 =
                                 =
                                 ,
                                 >
                                 ,
                                 <
                                 ,
                                 0
                                 ,
                                 5
                                 }
                               where 
                                 R
                               and 
                                 B
                               are the sorts indicating the domains of real numbers and boolean, respectively; == is the equality predicate interpreted as the identity relation in each domain; > and < are the usual greater-than and less-than predicates over 
                                 R
                              ; and the constants 0 and 5 are the real numbers 0 and 5. A possible formula ψ in the language 
                                 Ψ
                                 (
                                 Σ
                                 ,
                                 A
                                 )
                               is
                                 
                                    
                                       
                                          congestion
                                       
                                       ⟹
                                       
                                          velocity
                                       
                                       <
                                       5
                                       
                                       ∧
                                       
                                       ¬
                                       
                                          congestion
                                       
                                       ⟹
                                       
                                          velocity
                                       
                                       >
                                       0
                                    
                                 
                               whose satisfaction depends on the particular values of the variables, which will be different in different states.

In the context of Autonomous Transport Vehicles (see Section 3), this formula can be thought to represent a set of two constraints, one imposing that “in case of congestion, the velocity of the vehicle must be lower than 5” and the other that “in normal traffic conditions, the velocity must be greater than 0”.

Let us now formally define the behavioural level B and the structural level S separately. Afterwards, the 
                           S
                           [
                           B
                           ]
                         model is defined as the combination of the two.


                        
                           Definition 3
                           Behavioural level


                           The behavioural level of a system is a tuple 
                                 B
                                 =
                                 
                                    
                                       (
                                       Q
                                       ,
                                       
                                          
                                             q
                                          
                                          
                                             0
                                          
                                       
                                       ,
                                       →
                                    
                                    
                                       B
                                    
                                 
                                 )
                              , where
                                 
                                    •
                                    
                                       
                                          Q
                                          ⊆
                                          Q
                                        is a finite set of states and 
                                          
                                             
                                                q
                                             
                                             
                                                0
                                             
                                          
                                          ∈
                                          Q
                                        is the initial state; and


                                       
                                          
                                             
                                                →
                                             
                                             
                                                B
                                             
                                          
                                          ⊆
                                          Q
                                          ×
                                          Q
                                        is the transition relation.


                        
                           Definition 4
                           Structural level


                           The structural level of a system is a tuple 
                                 S
                                 =
                                 
                                    
                                       (
                                       R
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             0
                                          
                                       
                                       ,
                                       
                                          
                                             O
                                          
                                          
                                             M
                                          
                                          
                                             Σ
                                             ,
                                             A
                                          
                                       
                                       ,
                                       →
                                    
                                    
                                       S
                                    
                                 
                                 ,
                                 L
                                 )
                              , where
                                 
                                    •
                                    
                                       R is a finite set of states and 
                                          
                                             
                                                r
                                             
                                             
                                                0
                                             
                                          
                                          ∈
                                          R
                                        is the initial state;


                                       
                                          
                                             
                                                O
                                             
                                             
                                                M
                                             
                                             
                                                Σ
                                                ,
                                                A
                                             
                                          
                                        is an observation function on a signature Σ, a set of observables A and a structure M;


                                       
                                          
                                             
                                                →
                                             
                                             
                                                S
                                             
                                          
                                          ⊆
                                          R
                                          ×
                                          Ψ
                                          (
                                          Σ
                                          ,
                                          A
                                          )
                                          ×
                                          R
                                        is a finite transition relation, labelled with a formula called invariant; and


                                       
                                          L
                                          :
                                          R
                                          →
                                          Ψ
                                          (
                                          Σ
                                          ,
                                          A
                                          )
                                        is a function labelling each state with a formula representing a set of constraints.

Let us now give an intuition of the adaptation semantics. Let the current S state be 
                           
                              
                                 r
                              
                              
                                 i
                              
                           
                         and suppose 
                           
                              
                                 r
                              
                              
                                 i
                              
                           
                           
                              
                                 
                                    →
                                    ψ
                                 
                              
                              
                                 S
                              
                           
                           
                              
                                 r
                              
                              
                                 j
                              
                           
                         for some 
                           
                              
                                 r
                              
                              
                                 j
                              
                           
                        . Assume that the behaviour is in a steady state (i.e. not adapting) 
                           
                              
                                 q
                              
                              
                                 i
                              
                           
                         and therefore 
                           
                              
                                 q
                              
                              
                                 i
                              
                           
                           ⊨
                           L
                           (
                           
                              
                                 r
                              
                              
                                 i
                              
                           
                           )
                        . If the B state can move, but all B transitions 
                           
                              
                                 q
                              
                              
                                 i
                              
                           
                           
                              
                                 →
                              
                              
                                 B
                              
                           
                           
                              
                                 q
                              
                              
                                 j
                              
                           
                         are such that 
                           
                              
                                 q
                              
                              
                                 j
                              
                           
                           ⊭
                           L
                           (
                           
                              
                                 r
                              
                              
                                 i
                              
                           
                           )
                        , then the system can start adapting to the target S state 
                           
                              
                                 r
                              
                              
                                 j
                              
                           
                        . In this phase, the B level is no more constrained, but during adaptation the invariant ψ must be met. Adaptation ends when the behaviour reaches a state 
                           
                              
                                 q
                              
                              
                                 k
                              
                           
                         such that 
                           
                              
                                 q
                              
                              
                                 k
                              
                           
                           ⊨
                           L
                           (
                           
                              
                                 r
                              
                              
                                 j
                              
                           
                           )
                        .

We want to remark that the model supports the non-deterministic choice between adaptations, i.e. the system can adapt to every target state 
                           
                              
                                 r
                              
                              
                                 j
                              
                           
                         reachable with a transition 
                           
                              
                                 r
                              
                              
                                 i
                              
                           
                           
                              
                                 
                                    →
                                    ψ
                                 
                              
                              
                                 S
                              
                           
                           
                              
                                 r
                              
                              
                                 j
                              
                           
                         from the current 
                           
                              
                                 r
                              
                              
                                 i
                              
                           
                         state. The non-determinism can be both external—that is different target states can be reached by satisfying different invariants—and internal—that is different target states can be reached satisfying the same invariant condition.


                        
                           Definition 5
                           
                              
                                 S
                                 [
                                 B
                                 ]
                               system


                           An 
                                 S
                                 [
                                 B
                                 ]
                               
                              system is the combination of a behavioural level 
                                 B
                                 =
                                 
                                    
                                       (
                                       Q
                                       ,
                                       
                                          
                                             q
                                          
                                          
                                             0
                                          
                                       
                                       ,
                                       →
                                    
                                    
                                       B
                                    
                                 
                                 )
                               and a structural level 
                                 S
                                 =
                                 
                                    
                                       (
                                       R
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             0
                                          
                                       
                                       ,
                                       
                                          
                                             O
                                          
                                          
                                             M
                                          
                                          
                                             Σ
                                             ,
                                             A
                                          
                                       
                                       ,
                                       →
                                    
                                    
                                       S
                                    
                                 
                                 ,
                                 L
                                 )
                               such that for all 
                                 q
                                 ∈
                                 Q
                              , 
                                 
                                    
                                       O
                                    
                                    
                                       M
                                    
                                    
                                       Σ
                                       ,
                                       A
                                    
                                 
                                 (
                                 q
                                 )
                                 ≠
                                 ⊥
                              . Moreover, in any 
                                 S
                                 [
                                 B
                                 ]
                               system the initial B state must satisfy the constraints of the initial S state, i.e. 
                                 
                                    
                                       q
                                    
                                    
                                       0
                                    
                                 
                                 ⊨
                                 L
                                 (
                                 
                                    
                                       r
                                    
                                    
                                       0
                                    
                                 
                                 )
                              .

In this section, we illustrate the features of our approach by means of an example adapted from [29]: a model of a motion controller of Autonomous Transport Vehicles (ATVs) in a smart airport.

ATVs are responsible for the transport of passengers between stopovers like passenger entrances, check-in desks, departure gates, and plane parking positions. In the airport there are two types of roads that the ATVs can use: main roads and secondary roads, the latter ones used during traffic peaks. ATVs can travel at different speed in any road, preferably not at the maximum speed on secondary roads, as they are narrower than the main ones. For simplicity, we model only the subcomponent of ATVs that controls the vehicle speed and the switching between main and secondary roads. The 
                        S
                        [
                        B
                        ]
                      approach will be used to specify and implement the adaptation features of this controller in case of traffic congestion or blockages.

The behavioural level describes all the capabilities of the ATV controller, i.e. all the actions that the system is able to do in an unconstrained scenario. We suppose that each ATV controller has the possibility to perceive the current situation of traffic congestion or blockage by using a sensor or by communicating with a global monitoring systems of the airport. The ATV controller may, based on this perception, decide which action to execute.

The usual way of abstractly specifying a behaviour of this kind is a two-phase cycle: in the first phase there is the perception of the global environment, only relatively to the current congestion situation; in the second phase, a local action can be executed, corresponding to change either the vehicle velocity or the road to drive.

To formalise the behavioural level B we consider the following set of observable variables and associated sorts:
                           
                              •
                              
                                 
                                    r
                                    :
                                    {
                                    M
                                     (main)
                                    ,
                                    S
                                     (secondary)
                                    }
                                 , the current road;


                                 
                                    v
                                    :
                                    {
                                    0
                                     (slow)
                                    ,
                                    1
                                     (medium)
                                    ,
                                    2
                                     (high)
                                    }
                                 , the current velocity of the vehicle;


                                 
                                    c
                                    :
                                    {
                                    
                                       true
                                    
                                     (congestion)
                                    ,
                                    
                                       false
                                    
                                     (no congestion)
                                    }
                                 , a boolean variable indicating the current knowledge of the ATV controller about the traffic congestion;


                                 
                                    p
                                    :
                                    {
                                    
                                       true
                                    
                                     (perception)
                                    ,
                                    
                                       false
                                    
                                     (no perception)
                                    }
                                 , a boolean variable indicating whether or not the ATV controller is currently perceiving the congestion situation, i.e. it is in the first phase of its cycle; and


                                 
                                    a
                                    :
                                    {
                                    
                                       true
                                    
                                     (action)
                                    ,
                                    
                                       false
                                    
                                     (no action)
                                    }
                                 , a boolean variable indicating whether or not the ATV controller is currently executing an action, i.e. it is in the second phase of its cycle.


                        Fig. 2
                         contains a schema representing the portion of the state machine, corresponding to the B level, starting from a generic state 
                           (
                           r
                           ,
                           v
                           ,
                           c
                           ,
                           0
                           ,
                           0
                           )
                        , i.e. a state in which the controller is at the beginning of one iteration of its cycle. The two outgoing transitions non-deterministically model the perception of the same congestion situation known at the last perception (state 
                           (
                           r
                           ,
                           v
                           ,
                           c
                           ,
                           1
                           ,
                           0
                           )
                        ) or of the new (negated) situation (state
                           (
                           r
                           ,
                           v
                           ,
                           ¬
                           c
                           ,
                           1
                           ,
                           0
                           )
                        ). In any case, the system proceeds to the action phase (states 
                           (
                           r
                           ,
                           v
                           ,
                           c
                           ,
                           0
                           ,
                           1
                           )
                         or 
                           (
                           r
                           ,
                           v
                           ,
                           ¬
                           c
                           ,
                           0
                           ,
                           1
                           )
                        ) where it can decide to change road or to change velocity ending up in an updated state, ready to start another perception–action iteration.

The structural level can be used to give an abstract, constraint-based, specification of the possible ways (the various states in S) in which the system can function together with the admissible adaptations among them (the transitions in S). In this case study we show how to implement, as an 
                           S
                           [
                           B
                           ]
                         system, a policy of the smart airport that requires the adaptation of the behaviours of the vehicles during their functioning. We assume that some of the ATVs in the airport are equipped with adaptability capabilities in order to implement, as an example, the following policy: “whenever there is congestion, the adaptive ATV will have to switch as soon as possible to a secondary road and to limit the velocity to the maximum value 1; on the contrary, whenever there is not congestion, the adaptive ATV will have to use a main road at any velocity”.

This policy clearly identifies two modes of operations of the adaptive ATVs, which are activated by different environmental conditions:
                           
                              •
                              a normal mode of operation, occurring when there is no traffic congestion and such that the main road is driven (
                                    r
                                    =
                                    =
                                    M
                                 ); and

a fallback mode, occurring when congestion occurs; in this case the ATV has to be in the secondary road (
                                    r
                                    =
                                    =
                                    S
                                 ) and it cannot drive at the maximum velocity (v is either 0 or 1).

The invariant conditions on the transitions between 
                           
                              
                                 r
                              
                              
                                 0
                              
                           
                         and 
                           
                              
                                 r
                              
                              
                                 1
                              
                           
                         are needed to avoid the perception of a value of c different from that of the mode to which the system is adapting to. For instance, when adapting from 
                           
                              
                                 r
                              
                              
                                 0
                              
                           
                         to 
                           
                              
                                 r
                              
                              
                                 1
                              
                           
                         the target steady state is one in which there is congestion. During the adaptation we need to ensure that, whenever there is perception, only the value c can be perceived, ruling out the other possibility (due to non-determinism) of perceiving ¬c. This is expressed by the invariant 
                           (
                           p
                           ∧
                           c
                           )
                           ∨
                           ¬
                           p
                         that, in fact, corresponds to forcing the 
                           S
                           [
                           B
                           ]
                         system to ignore possible changes in the environment during adaptation. Without these invariants (see Fig. 3(b)), the system could fall in a livelock during the adaptation phase, as it is shown in Section 5.1.


                        Fig. 4
                         shows the full B level where the blue box encloses the states satisfying the constraints of 
                           
                              
                                 r
                              
                              
                                 0
                              
                           
                        , and the red box those satisfying the constraints of 
                           
                              
                                 r
                              
                              
                                 1
                              
                           
                        .

We give the operational semantics of an 
                        S
                        [
                        B
                        ]
                      system as a transition system resulting from the flattening of the behavioural and the structural levels. We obtain a Labelled Transition System (LTS) over states of the form 
                        (
                        q
                        ,
                        r
                        ,
                        ρ
                        )
                     , where:
                        
                           •
                           
                              
                                 q
                                 ∈
                                 Q
                               and 
                                 r
                                 ∈
                                 R
                               are the active B state and S state, respectively; and


                              ρ keeps the target S state that must be reached during adaptation and the invariant that must be fulfilled during this phase. Therefore ρ is either empty (no adaptation is occurring), or a singleton 
                                 {
                                 (
                                 ψ
                                 ,
                                 
                                    
                                       r
                                    
                                    
                                       ′
                                    
                                 
                                 )
                                 }
                              , with 
                                 ψ
                                 ∈
                                 Ψ
                                 (
                                 Σ
                                 ,
                                 A
                                 )
                               a formula and 
                                 
                                    
                                       r
                                    
                                    
                                       ′
                                    
                                 
                                 ∈
                                 R
                               an S state.

Consider an 
                              S
                              [
                              B
                              ]
                            system. The corresponding flat 
                              S
                              [
                              B
                              ]
                            system is the LTS 
                              F
                              (
                              S
                              [
                              B
                              ]
                              )
                              =
                              (
                              F
                              ,
                              
                                 
                                    f
                                 
                                 
                                    0
                                 
                              
                              ,
                              
                                 →
                                 r
                              
                              ∪
                              
                                 →
                                 
                                    r
                                    ,
                                    ψ
                                    ,
                                    
                                       
                                          r
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                              )
                            where
                              
                                 •
                                 
                                    
                                       F
                                       =
                                       Q
                                       ×
                                       R
                                       ×
                                       (
                                       {
                                       (
                                       ψ
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             ′
                                          
                                       
                                       )
                                       |
                                       ∃
                                       r
                                       ∈
                                       R
                                       .
                                       
                                       r
                                       
                                          
                                             
                                                →
                                                ψ
                                             
                                          
                                          
                                             S
                                          
                                       
                                       
                                          
                                             r
                                          
                                          
                                             ′
                                          
                                       
                                       }
                                       ∪
                                       {
                                       ∅
                                       }
                                       )
                                     is the set of states;


                                    
                                       
                                          
                                             f
                                          
                                          
                                             0
                                          
                                       
                                       =
                                       (
                                       
                                          
                                             q
                                          
                                          
                                             0
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             0
                                          
                                       
                                       ,
                                       ∅
                                       )
                                     is the initial state;


                                    
                                       
                                          →
                                          r
                                       
                                       ⊆
                                       F
                                       ×
                                       F
                                    , with 
                                       r
                                       ∈
                                       R
                                    , is a family of transition relations between non-adapting states, i.e., both satisfying 
                                       L
                                       (
                                       r
                                       )
                                    ;


                                    
                                       
                                          →
                                          
                                             r
                                             ,
                                             ψ
                                             ,
                                             
                                                
                                                   r
                                                
                                                
                                                   ′
                                                
                                             
                                          
                                       
                                       ⊆
                                       F
                                       ×
                                       F
                                    , with 
                                       r
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             ′
                                          
                                       
                                       ∈
                                       R
                                     and 
                                       ψ
                                       ∈
                                       Ψ
                                       (
                                       Σ
                                       ,
                                       A
                                       )
                                    , is a family of transition relations between adapting states, where the adaptation is determined by the S transition 
                                       r
                                       
                                          
                                             
                                                →
                                                ψ
                                             
                                          
                                          
                                             S
                                          
                                       
                                       
                                          
                                             r
                                          
                                          
                                             ′
                                          
                                       
                                    ; and

the pairs in 
                                       
                                          →
                                          r
                                       
                                     and in 
                                       
                                          →
                                          
                                             r
                                             ,
                                             ψ
                                             ,
                                             
                                                
                                                   r
                                                
                                                
                                                   ′
                                                
                                             
                                          
                                       
                                     are all and only those derivable using the rules in Table 1
                                    .

Let us discuss the rules listed in Table 1 characterising the flattened transitional semantics:
                        
                           •
                           Rule Steady describes the steady (i.e. non-adapting) behaviour of the system. If the system is not adapting and a B state q can perform a transition to a 
                                 
                                    
                                       q
                                    
                                    
                                       ′
                                    
                                 
                               that satisfies the current constraints 
                                 L
                                 (
                                 r
                                 )
                              , then the flat system can perform a non-adapting transition 
                                 
                                    →
                                    r
                                 
                               of the form 
                                 (
                                 q
                                 ,
                                 r
                                 ,
                                 ∅
                                 )
                                 
                                    →
                                    r
                                 
                                 (
                                 
                                    
                                       q
                                    
                                    
                                       ′
                                    
                                 
                                 ,
                                 r
                                 ,
                                 ∅
                                 )
                              .

Rule AdaptStart regulates the starting of an adaptation phase.

Adaptation occurs when all of the next B states do not satisfy the current S state constraints—i.e. 
                                 ∀
                                 
                                    
                                       q
                                    
                                    
                                       ″
                                    
                                 
                                 .
                                 
                                    
                                       (
                                       q
                                       →
                                    
                                    
                                       B
                                    
                                 
                                 
                                    
                                       q
                                    
                                    
                                       ″
                                    
                                 
                                 ⟹
                                 
                                    
                                       q
                                    
                                    
                                       ″
                                    
                                 
                                 ⊭
                                 L
                                 (
                                 r
                                 )
                                 )
                              —and the B machine is not itself deadlocked (
                                 q
                                 
                                    
                                       →
                                    
                                    
                                       B
                                    
                                 
                                 
                                    
                                       q
                                    
                                    
                                       ′
                                    
                                 
                              ). In this case, for each S transition 
                                 r
                                 
                                    
                                       
                                          →
                                          ψ
                                       
                                    
                                    
                                       S
                                    
                                 
                                 
                                    
                                       r
                                    
                                    
                                       ′
                                    
                                 
                               an adaptation towards the target state 
                                 
                                    
                                       r
                                    
                                    
                                       ′
                                    
                                 
                              , under the invariant ψ, can start. The flat system performs an adapting transition 
                                 
                                    →
                                    
                                       r
                                       ,
                                       ψ
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 
                               of the form 
                                 (
                                 q
                                 ,
                                 r
                                 ,
                                 ∅
                                 )
                                 
                                    →
                                    
                                       r
                                       ,
                                       ψ
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 
                                 (
                                 
                                    
                                       q
                                    
                                    
                                       ′
                                    
                                 
                                 ,
                                 r
                                 ,
                                 {
                                 (
                                 ψ
                                 ,
                                 
                                    
                                       r
                                    
                                    
                                       ′
                                    
                                 
                                 )
                                 }
                                 )
                              .

Rule Adapt can be used only during an adaptation phase. It handles the case in which, after the current transition, the system keeps adapting because a steady configuration cannot be reached (
                                 ∀
                                 
                                    
                                       q
                                    
                                    
                                       ″
                                    
                                 
                                 .
                                 
                                    
                                       (
                                       q
                                       →
                                    
                                    
                                       B
                                    
                                 
                                 
                                    
                                       q
                                    
                                    
                                       ″
                                    
                                 
                                 ⟹
                                 
                                    
                                       q
                                    
                                    
                                       ″
                                    
                                 
                                 ⊭
                                 L
                                 (
                                 
                                    
                                       r
                                    
                                    
                                       ′
                                    
                                 
                                 )
                                 )
                              ). In this situation, since the system still must adapt (
                                 q
                                 ⊭
                                 L
                                 (
                                 
                                    
                                       r
                                    
                                    
                                       ′
                                    
                                 
                                 )
                              ), if the B machine is not deadlocked and the invariant can still be satisfied (
                                 q
                                 
                                    
                                       →
                                    
                                    
                                       B
                                    
                                 
                                 
                                    
                                       q
                                    
                                    
                                       ′
                                    
                                 
                               and 
                                 
                                    
                                       q
                                    
                                    
                                       ′
                                    
                                 
                                 ⊨
                                 ψ
                              ), the rule allows a transition of the form 
                                 (
                                 q
                                 ,
                                 r
                                 ,
                                 {
                                 (
                                 ψ
                                 ,
                                 
                                    
                                       r
                                    
                                    
                                       ′
                                    
                                 
                                 )
                                 }
                                 )
                                 
                                    →
                                    
                                       r
                                       ,
                                       ψ
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 
                                 (
                                 
                                    
                                       q
                                    
                                    
                                       ′
                                    
                                 
                                 ,
                                 r
                                 ,
                                 {
                                 (
                                 ψ
                                 ,
                                 
                                    
                                       r
                                    
                                    
                                       ′
                                    
                                 
                                 )
                                 }
                                 )
                              . Note that during adaptation the behaviour is not regulated by the S states constraints. Note also that the semantics does not assure that a state where the target S state constraints hold is eventually reached. Two different formulations of such adaptability requirements are given in Section 5.

Also rule AdaptEnd can only be applied during an adaptation phase and it handles the case in which, after the current transition, the adaptation must end because a steady configuration has been reached (
                                 
                                    
                                       q
                                    
                                    
                                       ′
                                    
                                 
                                 ⊨
                                 L
                                 (
                                 
                                    
                                       r
                                    
                                    
                                       ′
                                    
                                 
                                 )
                              ). It allows a transition 
                                 
                                    →
                                    
                                       r
                                       ,
                                       ψ
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 
                               from an adapting state 
                                 (
                                 q
                                 ,
                                 r
                                 ,
                                 {
                                 (
                                 ψ
                                 ,
                                 
                                    
                                       r
                                    
                                    
                                       ′
                                    
                                 
                                 )
                                 }
                                 )
                               to the steady (non-adapting) state 
                                 (
                                 
                                    
                                       q
                                    
                                    
                                       ′
                                    
                                 
                                 ,
                                 
                                    
                                       r
                                    
                                    
                                       ′
                                    
                                 
                                 ,
                                 ∅
                                 )
                              .

Rule AdaptStartEnd handles the special case in which an adaptation phase must start from a steady situation—
                                 ∀
                                 
                                    
                                       q
                                    
                                    
                                       ″
                                    
                                 
                                 .
                                 
                                    
                                       (
                                       q
                                       →
                                    
                                    
                                       B
                                    
                                 
                                 
                                    
                                       q
                                    
                                    
                                       ″
                                    
                                 
                                 ⟹
                                 
                                    
                                       q
                                    
                                    
                                       ″
                                    
                                 
                                 ⊭
                                 L
                                 (
                                 r
                                 )
                              —but then, after just one move of the B level, another steady region of the S level is reached (
                                 
                                    
                                       q
                                    
                                    
                                       ′
                                    
                                 
                                 ⊨
                                 L
                                 (
                                 
                                    
                                       r
                                    
                                    
                                       ′
                                    
                                 
                                 )
                              ). In this case the invariant ψ associated to the S transition is ignored and the system goes directly into another steady state. Note that this rule is alternative to the rule AdaptStart in which the initial situation is the same, but the steady region is not reached after one B transition. The flat system performs an adapting transition 
                                 
                                    →
                                    
                                       r
                                       ,
                                       ψ
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 
                               of the form 
                                 (
                                 q
                                 ,
                                 r
                                 ,
                                 ∅
                                 )
                                 
                                    →
                                    
                                       r
                                       ,
                                       ψ
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 
                                 (
                                 
                                    
                                       q
                                    
                                    
                                       ′
                                    
                                 
                                 ,
                                 r
                                 
                                    
                                       ,
                                    
                                    
                                       ′
                                    
                                 
                                 ∅
                                 )
                              .

Therefore, a successful adaptation occurs when rules AdaptEnd or AdaptStartEnd can be applied, i.e. when a transition from an adapting to a steady state is fired.

Let us now state some properties of the given flat semantics. In the following, given any transition relation → and any state s, by s→ and by s↛ we mean, as usual, that there exists a state 
                        
                           
                              s
                           
                           
                              ′
                           
                        
                      such that 
                        s
                        →
                        
                           
                              s
                           
                           
                              ′
                           
                        
                      and that there exists no state 
                        
                           
                              s
                           
                           
                              ′
                           
                        
                      such that 
                        s
                        →
                        
                           
                              s
                           
                           
                              ′
                           
                        
                     , respectively. Moreover, by 
                        
                           
                              →
                           
                           
                              +
                           
                        
                      we indicate a finite, non-empty, sequence of → steps; more formally, there exists 
                        n
                        ∈
                        N
                        ,
                        n
                        >
                        0
                      such that 
                        s
                        =
                        
                           
                              s
                           
                           
                              0
                           
                        
                        →
                        
                           
                              s
                           
                           
                              1
                           
                        
                        →
                        ⋯
                        
                           
                              s
                           
                           
                              n
                              −
                              1
                           
                        
                        →
                        
                           
                              s
                           
                           
                              n
                           
                        
                     . Finally, by 
                        
                           
                              →
                           
                           
                              k
                           
                        
                     , 
                        k
                        ≥
                        0
                     , we indicate k consecutive steps of the relation →: 
                        s
                        =
                        
                           
                              s
                           
                           
                              0
                           
                        
                        →
                        
                           
                              s
                           
                           
                              1
                           
                        
                        →
                        ⋯
                        
                           
                              s
                           
                           
                              k
                              −
                              1
                           
                        
                        →
                        
                           
                              s
                           
                           
                              k
                           
                        
                     . If 
                        k
                        =
                        0
                     , then 
                        s
                        
                           
                              →
                           
                           
                              0
                           
                        
                        
                           
                              s
                           
                           
                              ′
                           
                        
                      is equivalent to say that there is the empty sequence of steps s, and thus 
                        
                           
                              s
                           
                           
                              ′
                           
                        
                        =
                        s
                     . This is always possible, even if the relation → is not reflexive.


                     
                        Proposition 1
                        Properties of flat semantics


                        
                           Let 
                           
                              F
                              (
                              S
                              [
                              B
                              ]
                              )
                              =
                              (
                              F
                              ,
                              
                                 
                                    f
                                 
                                 
                                    0
                                 
                              
                              ,
                              
                                 →
                                 r
                              
                              ∪
                              
                                 →
                                 
                                    r
                                    ,
                                    ψ
                                    ,
                                    
                                       
                                          r
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                              )
                            
                           be a flat 
                           
                              S
                              [
                              B
                              ]
                            
                           system. All the following statements hold:
                           
                              
                                 (i)
                                 
                                    If a steady transition can be performed, then adaptation cannot start: 
                                          
                                       
                                    
                                 


                                    If adaptation can start, then no steady transition is possible: 
                                          
                                       
                                    
                                 


                                    During adaptation no steady transition is possible: 
                                          
                                       
                                    
                                 


                                    The non-adapting and the adapting transition relations are disjoint: 
                                    
                                       ∀
                                       r
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             ′
                                          
                                       
                                       ∈
                                       R
                                       ,
                                       ∀
                                       ψ
                                       ∈
                                       Ψ
                                       (
                                       Σ
                                       ,
                                       A
                                       )
                                       .
                                       
                                       
                                          →
                                          r
                                       
                                       ∩
                                       
                                          →
                                          
                                             r
                                             ,
                                             ψ
                                             ,
                                             
                                                
                                                   r
                                                
                                                
                                                   ′
                                                
                                             
                                          
                                       
                                       =
                                       ∅
                                    
                                 


                                    In case of a successful adaptation, the adaptation phase ends as soon as possible, i.e. as soon as the target steady state can be reached with a single transition.
                                 


                                    Given any 
                                    
                                       q
                                       ∈
                                       Q
                                     
                                    and 
                                    
                                       r
                                       ∈
                                       R
                                    
                                    , then every infinite path π in 
                                    
                                       F
                                       (
                                       S
                                       [
                                       B
                                       ]
                                       )
                                     
                                    starting in a state 
                                    
                                       (
                                       q
                                       ,
                                       r
                                       ,
                                       ∅
                                       )
                                     
                                    such that 
                                    
                                       q
                                       ⊨
                                       L
                                       (
                                       r
                                       )
                                     
                                    is of one of the following kinds: 
                                    
                                       
                                          (1)
                                       
                                       
                                          
                                             adaptation always succeeds; the path alternates between steady transitions and adaptation paths:
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               π
                                                               =
                                                               (
                                                               q
                                                               =
                                                               
                                                                  
                                                                     q
                                                                  
                                                                  
                                                                     0
                                                                  
                                                               
                                                               ,
                                                               r
                                                               =
                                                               
                                                                  
                                                                     r
                                                                  
                                                                  
                                                                     0
                                                                  
                                                               
                                                               ,
                                                               ∅
                                                               )
                                                               
                                                                  
                                                                     (
                                                                     
                                                                        →
                                                                        
                                                                           
                                                                              r
                                                                           
                                                                           
                                                                              0
                                                                           
                                                                        
                                                                     
                                                                     )
                                                                  
                                                                  
                                                                     
                                                                        
                                                                           m
                                                                        
                                                                        
                                                                           0
                                                                        
                                                                     
                                                                  
                                                               
                                                               
                                                                  
                                                                     (
                                                                     
                                                                        →
                                                                        
                                                                           
                                                                              
                                                                                 r
                                                                              
                                                                              
                                                                                 0
                                                                              
                                                                           
                                                                           ,
                                                                           
                                                                              
                                                                                 ψ
                                                                              
                                                                              
                                                                                 0
                                                                              
                                                                           
                                                                           ,
                                                                           
                                                                              
                                                                                 r
                                                                              
                                                                              
                                                                                 1
                                                                              
                                                                           
                                                                        
                                                                     
                                                                     )
                                                                  
                                                                  
                                                                     
                                                                        
                                                                           n
                                                                        
                                                                        
                                                                           0
                                                                        
                                                                     
                                                                  
                                                               
                                                               ⋯
                                                            
                                                         
                                                         
                                                            
                                                               ⋯
                                                               (
                                                               
                                                                  
                                                                     q
                                                                  
                                                                  
                                                                     i
                                                                  
                                                               
                                                               ,
                                                               
                                                                  
                                                                     r
                                                                  
                                                                  
                                                                     i
                                                                  
                                                               
                                                               ,
                                                               ∅
                                                               )
                                                               
                                                                  
                                                                     (
                                                                     
                                                                        →
                                                                        
                                                                           
                                                                              r
                                                                           
                                                                           
                                                                              i
                                                                           
                                                                        
                                                                     
                                                                     )
                                                                  
                                                                  
                                                                     
                                                                        
                                                                           m
                                                                        
                                                                        
                                                                           i
                                                                        
                                                                     
                                                                  
                                                               
                                                               
                                                                  
                                                                     (
                                                                     
                                                                        →
                                                                        
                                                                           
                                                                              
                                                                                 r
                                                                              
                                                                              
                                                                                 i
                                                                              
                                                                           
                                                                           ,
                                                                           
                                                                              
                                                                                 ψ
                                                                              
                                                                              
                                                                                 i
                                                                              
                                                                           
                                                                           ,
                                                                           
                                                                              
                                                                                 r
                                                                              
                                                                              
                                                                                 i
                                                                                 +
                                                                                 1
                                                                              
                                                                           
                                                                        
                                                                     
                                                                     )
                                                                  
                                                                  
                                                                     
                                                                        
                                                                           n
                                                                        
                                                                        
                                                                           i
                                                                        
                                                                     
                                                                  
                                                               
                                                               (
                                                               
                                                                  
                                                                     q
                                                                  
                                                                  
                                                                     i
                                                                     +
                                                                     1
                                                                  
                                                               
                                                               ,
                                                               
                                                                  
                                                                     r
                                                                  
                                                                  
                                                                     i
                                                                     +
                                                                     1
                                                                  
                                                               
                                                               ,
                                                               ∅
                                                               )
                                                               ⋯
                                                            
                                                         
                                                      
                                                   
                                                
                                              
                                             such that for each 
                                             
                                                i
                                                ≥
                                                0
                                             
                                             , either 
                                             
                                                
                                                   
                                                      m
                                                   
                                                   
                                                      i
                                                   
                                                
                                                =
                                                1
                                                ∧
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      i
                                                   
                                                
                                                =
                                                0
                                              
                                             (steady transition) or 
                                             
                                                
                                                   
                                                      m
                                                   
                                                   
                                                      i
                                                   
                                                
                                                =
                                                0
                                                ∧
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      i
                                                   
                                                
                                                >
                                                0
                                              
                                             (adaptation path);
                                          


                                             adaptation lasts forever; the path has a prefix in which steady transitions and adaptation paths alternate, but then one adaptation path never stops:
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               π
                                                               =
                                                               (
                                                               q
                                                               =
                                                               
                                                                  
                                                                     q
                                                                  
                                                                  
                                                                     0
                                                                  
                                                               
                                                               ,
                                                               r
                                                               =
                                                               
                                                                  
                                                                     r
                                                                  
                                                                  
                                                                     0
                                                                  
                                                               
                                                               ,
                                                               ∅
                                                               )
                                                               
                                                                  
                                                                     (
                                                                     
                                                                        →
                                                                        
                                                                           
                                                                              r
                                                                           
                                                                           
                                                                              0
                                                                           
                                                                        
                                                                     
                                                                     )
                                                                  
                                                                  
                                                                     
                                                                        
                                                                           m
                                                                        
                                                                        
                                                                           0
                                                                        
                                                                     
                                                                  
                                                               
                                                               
                                                                  
                                                                     (
                                                                     
                                                                        →
                                                                        
                                                                           
                                                                              
                                                                                 r
                                                                              
                                                                              
                                                                                 0
                                                                              
                                                                           
                                                                           ,
                                                                           
                                                                              
                                                                                 ψ
                                                                              
                                                                              
                                                                                 0
                                                                              
                                                                           
                                                                           ,
                                                                           
                                                                              
                                                                                 r
                                                                              
                                                                              
                                                                                 1
                                                                              
                                                                           
                                                                        
                                                                     
                                                                     )
                                                                  
                                                                  
                                                                     
                                                                        
                                                                           n
                                                                        
                                                                        
                                                                           0
                                                                        
                                                                     
                                                                  
                                                               
                                                               ⋯
                                                            
                                                         
                                                         
                                                            
                                                               ⋯
                                                               (
                                                               
                                                                  
                                                                     q
                                                                  
                                                                  
                                                                     i
                                                                  
                                                               
                                                               ,
                                                               
                                                                  
                                                                     r
                                                                  
                                                                  
                                                                     i
                                                                  
                                                               
                                                               ,
                                                               ∅
                                                               )
                                                               
                                                                  
                                                                     (
                                                                     
                                                                        →
                                                                        
                                                                           
                                                                              r
                                                                           
                                                                           
                                                                              i
                                                                           
                                                                        
                                                                     
                                                                     )
                                                                  
                                                                  
                                                                     
                                                                        
                                                                           m
                                                                        
                                                                        
                                                                           i
                                                                        
                                                                     
                                                                  
                                                               
                                                               
                                                                  
                                                                     (
                                                                     
                                                                        →
                                                                        
                                                                           
                                                                              
                                                                                 r
                                                                              
                                                                              
                                                                                 i
                                                                              
                                                                           
                                                                           ,
                                                                           
                                                                              
                                                                                 ψ
                                                                              
                                                                              
                                                                                 i
                                                                              
                                                                           
                                                                           ,
                                                                           
                                                                              
                                                                                 r
                                                                              
                                                                              
                                                                                 i
                                                                                 +
                                                                                 1
                                                                              
                                                                           
                                                                        
                                                                     
                                                                     )
                                                                  
                                                                  
                                                                     
                                                                        
                                                                           n
                                                                        
                                                                        
                                                                           i
                                                                        
                                                                     
                                                                  
                                                               
                                                               (
                                                               
                                                                  
                                                                     q
                                                                  
                                                                  
                                                                     i
                                                                     +
                                                                     1
                                                                  
                                                               
                                                               ,
                                                               
                                                                  
                                                                     r
                                                                  
                                                                  
                                                                     i
                                                                     +
                                                                     1
                                                                  
                                                               
                                                               ,
                                                               ∅
                                                               )
                                                               ⋯
                                                            
                                                         
                                                         
                                                            
                                                               ⋯
                                                               (
                                                               
                                                                  
                                                                     q
                                                                  
                                                                  
                                                                     k
                                                                  
                                                               
                                                               ,
                                                               
                                                                  
                                                                     r
                                                                  
                                                                  
                                                                     k
                                                                  
                                                               
                                                               ,
                                                               ∅
                                                               )
                                                               
                                                                  →
                                                                  
                                                                     
                                                                        
                                                                           r
                                                                        
                                                                        
                                                                           k
                                                                        
                                                                     
                                                                     ,
                                                                     
                                                                        
                                                                           ψ
                                                                        
                                                                        
                                                                           k
                                                                        
                                                                     
                                                                     ,
                                                                     
                                                                        
                                                                           r
                                                                        
                                                                        
                                                                           k
                                                                           +
                                                                           1
                                                                        
                                                                     
                                                                  
                                                               
                                                               (
                                                               
                                                                  
                                                                     q
                                                                  
                                                                  
                                                                     k
                                                                     +
                                                                     1
                                                                  
                                                               
                                                               ,
                                                               
                                                                  
                                                                     r
                                                                  
                                                                  
                                                                     k
                                                                  
                                                               
                                                               ,
                                                               {
                                                               
                                                                  
                                                                     ψ
                                                                  
                                                                  
                                                                     k
                                                                  
                                                               
                                                               ,
                                                               
                                                                  
                                                                     r
                                                                  
                                                                  
                                                                     k
                                                                     +
                                                                     1
                                                                  
                                                               
                                                               }
                                                               )
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  ⋯
                                                                  (
                                                                  
                                                                     
                                                                        q
                                                                     
                                                                     
                                                                        k
                                                                     
                                                                  
                                                                  ,
                                                                  
                                                                     
                                                                        r
                                                                     
                                                                     
                                                                        k
                                                                     
                                                                  
                                                                  ,
                                                                  ∅
                                                                  )
                                                               
                                                               
                                                                  →
                                                                  
                                                                     
                                                                        
                                                                           r
                                                                        
                                                                        
                                                                           k
                                                                        
                                                                     
                                                                     ,
                                                                     
                                                                        
                                                                           ψ
                                                                        
                                                                        
                                                                           k
                                                                        
                                                                     
                                                                     ,
                                                                     
                                                                        
                                                                           r
                                                                        
                                                                        
                                                                           k
                                                                           +
                                                                           1
                                                                        
                                                                     
                                                                  
                                                               
                                                               (
                                                               
                                                                  
                                                                     q
                                                                  
                                                                  
                                                                     k
                                                                     +
                                                                     2
                                                                  
                                                               
                                                               ,
                                                               
                                                                  
                                                                     r
                                                                  
                                                                  
                                                                     k
                                                                  
                                                               
                                                               ,
                                                               {
                                                               
                                                                  
                                                                     ψ
                                                                  
                                                                  
                                                                     k
                                                                  
                                                               
                                                               ,
                                                               
                                                                  
                                                                     r
                                                                  
                                                                  
                                                                     k
                                                                     +
                                                                     1
                                                                  
                                                               
                                                               }
                                                               )
                                                            
                                                         
                                                         
                                                            
                                                               
                                                                  ⋯
                                                                  (
                                                                  
                                                                     
                                                                        q
                                                                     
                                                                     
                                                                        k
                                                                     
                                                                  
                                                                  ,
                                                                  
                                                                     
                                                                        r
                                                                     
                                                                     
                                                                        k
                                                                     
                                                                  
                                                                  ,
                                                                  ∅
                                                                  )
                                                               
                                                               
                                                                  →
                                                                  
                                                                     
                                                                        
                                                                           r
                                                                        
                                                                        
                                                                           k
                                                                        
                                                                     
                                                                     ,
                                                                     
                                                                        
                                                                           ψ
                                                                        
                                                                        
                                                                           k
                                                                        
                                                                     
                                                                     ,
                                                                     
                                                                        
                                                                           r
                                                                        
                                                                        
                                                                           k
                                                                           +
                                                                           1
                                                                        
                                                                     
                                                                  
                                                               
                                                               ⋯
                                                            
                                                         
                                                      
                                                   
                                                
                                              
                                             where 
                                             
                                                k
                                                ≥
                                                0
                                              
                                             and for each i, 
                                             
                                                0
                                                ≤
                                                i
                                                <
                                                k
                                             
                                             , either 
                                             
                                                
                                                   
                                                      m
                                                   
                                                   
                                                      i
                                                   
                                                
                                                =
                                                1
                                                ∧
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      i
                                                   
                                                
                                                =
                                                0
                                              
                                             or 
                                             
                                                
                                                   
                                                      m
                                                   
                                                   
                                                      i
                                                   
                                                
                                                =
                                                0
                                                ∧
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      i
                                                   
                                                
                                                >
                                                0
                                             
                                             .
                                          


                                    Let 
                                    
                                       π
                                       ∈
                                       F
                                       (
                                       S
                                       [
                                       B
                                       ]
                                       )
                                     
                                    be an infinite path starting in a state 
                                    
                                       (
                                       q
                                       ,
                                       r
                                       ,
                                       ∅
                                       )
                                     
                                    such that 
                                    
                                       q
                                       ⊨
                                       L
                                       (
                                       r
                                       )
                                    
                                    . Then, in every position i of the path such that 
                                    
                                       π
                                       [
                                       i
                                       ]
                                       =
                                       (
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       ∅
                                       )
                                    
                                    , it holds 
                                    
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                       
                                       ⊨
                                       L
                                       (
                                       
                                          
                                             r
                                          
                                          
                                             i
                                          
                                       
                                       )
                                    
                                    .
                                 

See Appendix A.1  □

In an 
                           S
                           [
                           B
                           ]
                         system, deadlocks cannot be compatible with adaptability. Indeed, we see adaptability as the property for which a system continuously operates under stable, allowed modes (steady states), by possibly performing adaptation paths across modes.

In the flat semantics deadlocks occurring at adapting states, e.g. when the adaptation invariant cannot be met, are clearly conflicting with the concept of adaptability. Instead, deadlocks at steady states are more subtle to interpret, since they may occur under two different conditions:
                           
                              •
                              from the current state, any transition lead to a state violating the current constraints, and, at the same time, adaptation cannot start because none of the next B states meet any of the adaptation invariants and any of the target constraints. In other words, the flat semantics terminates even if the B level can proceed. Evidently, this violates adaptability.

the B level cannot progress at all. We consider this situation as a bad deadlock state in the behavioural model. Conversely, every B state indicating a good termination should have the chance to progress and therefore must be modelled, as usual in this case, with an idling self-loop.

We capture the requirement for which the flat 
                           S
                           [
                           B
                           ]
                         must not terminate through the 
                           
                              Progress
                           
                           (
                           q
                           ,
                           r
                           )
                         predicate:
                           
                              
                                 
                                    Progress
                                 
                                 (
                                 q
                                 ,
                                 r
                                 )
                                 ⇔
                                 (
                                 q
                                 ,
                                 r
                                 ,
                                 ∅
                                 )
                                 
                                    →
                                    r
                                 
                                 
                                 ∨
                                 
                                 (
                                 q
                                 ,
                                 r
                                 ,
                                 ∅
                                 )
                                 
                                    →
                                    
                                       r
                                       ,
                                       ψ
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 
                              
                           
                        
                     

The flat semantics of the two systems 
                           
                              
                                 S
                              
                              
                                 0
                              
                           
                           [
                           B
                           ]
                         and 
                           
                              
                                 S
                              
                              
                                 1
                              
                           
                           [
                           B
                           ]
                         implementing the ATV motion controller case study are depicted in Figs. 5 and 6
                        
                        , respectively.

Notably, the same behavioural level B possesses different adaptation capabilities depending on the structure S that is considered. Indeed, in 
                           F
                           (
                           
                              
                                 S
                              
                              
                                 0
                              
                           
                           [
                           B
                           ]
                           )
                         every adaptation path leads to a target S state. On the other hand, in 
                           F
                           (
                           
                              
                                 S
                              
                              
                                 1
                              
                           
                           [
                           B
                           ]
                           )
                         always there exists an adaptation path leading to a target stable region, but it may contain cycles of adapting states, thus leading to possibly infinite adaptation paths.

In other words, the behavioural level B is able to successfully adapt under the structural level 
                           
                              
                                 S
                              
                              
                                 0
                              
                           
                        , for all possible adaptation paths. Recalling the definitions introduced in Section 1, 
                           
                              
                                 S
                              
                              
                                 0
                              
                           
                           [
                           B
                           ]
                         is strongly adaptable. Conversely, B is able to successfully adapt under 
                           
                              
                                 S
                              
                              
                                 1
                              
                           
                         only for some adaptation paths, i.e. the finite ones. Therefore, 
                           
                              
                                 S
                              
                              
                                 1
                              
                           
                           [
                           B
                           ]
                         is weakly adaptable. These two different kinds of adaptability are formalised in Section 5.

The transitional semantics introduced in Section 4 does not guarantee that an adaptation phase can always start or that, once started, it always ends up in a state satisfying the constraints of the target S state. In this section we want to give some formal tools to analyse a given system w.r.t. these kind of properties. As a first step, we characterise two adaptability notions by means of two relations over the set of B states and the set of S states, namely a weak adaptation relation 
                     
                        
                           
                              R
                           
                           
                              w
                           
                        
                      and a strong adaptation relation 
                     
                        
                           
                              R
                           
                           
                              s
                           
                        
                     . Then, we characterise the same adaptability notions logically and we prove that they can be model checked by using proper formulae of a temporal logic.

Informally, a state q of B is weakly adaptable to a state r of S if it satisfies the constraints imposed by r and some of its successors are either weakly adaptable to the same r or there is an adaptation phase of the flat system that, from q, reaches a state 
                        
                           
                              q
                           
                           
                              ′
                           
                        
                      that is weakly adaptable to another S state 
                        
                           
                              r
                           
                           
                              ′
                           
                        
                     . In other words, we require that states satisfying 
                        L
                        (
                        r
                        )
                      are in relation with r and that from “border” states, that is to say those that can start an adaptation phase for leaving r, there is always at least one way to safely reach another steady situation in another S state 
                        
                           
                              r
                           
                           
                              ′
                           
                        
                     . As explained in Section 4.1, the Progress predicate is used to rule out steady configurations in a state of bad termination. We formally define this relation using a co-inductive style as it is usually done, for instance, for bisimulation relations.


                     
                        Definition 7
                        Weak adaptation


                        Given an 
                              S
                              [
                              B
                              ]
                            system, a binary relation 
                              R
                              ⊆
                              Q
                              ×
                              R
                            is a weak adaptation if and only if whenever 
                              q
                              
                              R
                              
                              r
                            we have:
                              
                                 (i)
                                 
                                    
                                       q
                                       ⊨
                                       L
                                       (
                                       r
                                       )
                                     and 
                                       
                                          Progress
                                       
                                       (
                                       q
                                       ,
                                       r
                                       )
                                    , and
                                 

if 
                                       (
                                       q
                                       ,
                                       r
                                       ,
                                       ∅
                                       )
                                       
                                          →
                                          r
                                       
                                     then there exists 
                                       
                                          
                                             q
                                          
                                          
                                             ′
                                          
                                       
                                       ∈
                                       Q
                                     such that 
                                       (
                                       q
                                       ,
                                       r
                                       ,
                                       ∅
                                       )
                                       
                                          →
                                          r
                                       
                                       (
                                       
                                          
                                             q
                                          
                                          
                                             ′
                                          
                                       
                                       ,
                                       r
                                       ,
                                       ∅
                                       )
                                     and 
                                       
                                          
                                             q
                                          
                                          
                                             ′
                                          
                                       
                                       
                                       R
                                       
                                       r
                                    , and
                                 

if 
                                       (
                                       q
                                       ,
                                       r
                                       ,
                                       ∅
                                       )
                                       
                                          →
                                          
                                             r
                                             ,
                                             
                                                
                                                   ψ
                                                
                                                
                                                   ′
                                                
                                             
                                             ,
                                             
                                                
                                                   r
                                                
                                                
                                                   ″
                                                
                                             
                                          
                                       
                                     for some 
                                       
                                          
                                             ψ
                                          
                                          
                                             ′
                                          
                                       
                                       ∈
                                       Ψ
                                       (
                                       Σ
                                       ,
                                       A
                                       )
                                     and 
                                       
                                          
                                             r
                                          
                                          
                                             ″
                                          
                                       
                                       ∈
                                       R
                                     then there exist 
                                       
                                          
                                             q
                                          
                                          
                                             ′
                                          
                                       
                                       ∈
                                       Q
                                       ,
                                       
                                       ψ
                                       ∈
                                       Ψ
                                       (
                                       Σ
                                       ,
                                       A
                                       )
                                     and 
                                       
                                          
                                             r
                                          
                                          
                                             ′
                                          
                                       
                                       ∈
                                       R
                                     such that 
                                       (
                                       q
                                       ,
                                       r
                                       ,
                                       ∅
                                       )
                                       
                                          
                                             
                                                →
                                                
                                                   r
                                                   ,
                                                   ψ
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             +
                                          
                                       
                                       (
                                       
                                          
                                             q
                                          
                                          
                                             ′
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             ′
                                          
                                       
                                       ,
                                       ∅
                                       )
                                     and 
                                       
                                          
                                             q
                                          
                                          
                                             ′
                                          
                                       
                                       
                                       R
                                       
                                       
                                          
                                             r
                                          
                                          
                                             ′
                                          
                                       
                                    .

At the level of the whole system, we say that 
                              S
                              [
                              B
                              ]
                            is weakly adaptable if the initial B state 
                              
                                 
                                    q
                                 
                                 
                                    0
                                 
                              
                            is weakly adaptable to the initial S state 
                              
                                 
                                    r
                                 
                                 
                                    0
                                 
                              
                           .


                     
                        Proposition 2
                        Union of weak adaptation relations


                        
                           Given an 
                           
                              S
                              [
                              B
                              ]
                            
                           system, if 
                           
                              
                                 
                                    R
                                 
                                 
                                    1
                                 
                              
                            
                           and 
                           
                              
                                 
                                    R
                                 
                                 
                                    2
                                 
                              
                            
                           are weak adaptation relations, then 
                           
                              
                                 
                                    R
                                 
                                 
                                    1
                                 
                              
                              ∪
                              
                                 
                                    R
                                 
                                 
                                    2
                                 
                              
                            
                           is a weak adaptation relation.
                        

See Appendix A.2  □


                     
                        Definition 8
                        Weak adaptability


                        Given an 
                              S
                              [
                              B
                              ]
                            system, the union of all weak adaptation relations among the states Q and R of 
                              S
                              [
                              B
                              ]
                            is denoted by 
                              
                                 
                                    R
                                 
                                 
                                    w
                                 
                              
                            and is the weak adaptability relation of 
                              S
                              [
                              B
                              ]
                           .


                     
                        Lemma 1
                        Propagation of weak adaptation relation


                        
                           Consider an 
                           
                              S
                              [
                              B
                              ]
                            
                           system and let q and r be such that 
                           
                              q
                              
                                 
                                    |
                                 
                                 
                                    w
                                 
                              
                              r
                           
                           . Then there exists in 
                           
                              F
                              (
                              S
                              [
                              B
                              ]
                              )
                            
                           an infinite path
                           
                              
                                 
                                    
                                       
                                          
                                             π
                                             =
                                             (
                                             q
                                             =
                                             
                                                
                                                   q
                                                
                                                
                                                   0
                                                
                                             
                                             ,
                                             r
                                             =
                                             
                                                
                                                   r
                                                
                                                
                                                   0
                                                
                                             
                                             ,
                                             ∅
                                             )
                                             
                                                
                                                   (
                                                   
                                                      →
                                                      
                                                         
                                                            r
                                                         
                                                         
                                                            0
                                                         
                                                      
                                                   
                                                   )
                                                
                                                
                                                   
                                                      
                                                         m
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   (
                                                   
                                                      →
                                                      
                                                         
                                                            
                                                               r
                                                            
                                                            
                                                               0
                                                            
                                                         
                                                         ,
                                                         
                                                            
                                                               ψ
                                                            
                                                            
                                                               0
                                                            
                                                         
                                                         ,
                                                         
                                                            
                                                               r
                                                            
                                                            
                                                               1
                                                            
                                                         
                                                      
                                                   
                                                   )
                                                
                                                
                                                   
                                                      
                                                         n
                                                      
                                                      
                                                         0
                                                      
                                                   
                                                
                                             
                                             ⋯
                                          
                                       
                                       
                                          
                                             ⋯
                                             (
                                             
                                                
                                                   q
                                                
                                                
                                                   i
                                                
                                             
                                             ,
                                             
                                                
                                                   r
                                                
                                                
                                                   i
                                                
                                             
                                             ,
                                             ∅
                                             )
                                             
                                                
                                                   (
                                                   
                                                      →
                                                      
                                                         
                                                            r
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                   
                                                   )
                                                
                                                
                                                   
                                                      
                                                         m
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   (
                                                   
                                                      →
                                                      
                                                         
                                                            
                                                               r
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                         ,
                                                         
                                                            
                                                               ψ
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                         ,
                                                         
                                                            
                                                               r
                                                            
                                                            
                                                               i
                                                               +
                                                               1
                                                            
                                                         
                                                      
                                                   
                                                   )
                                                
                                                
                                                   
                                                      
                                                         n
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                
                                             
                                             (
                                             
                                                
                                                   q
                                                
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                             ,
                                             
                                                
                                                   r
                                                
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                             ,
                                             ∅
                                             )
                                             ⋯
                                          
                                       
                                    
                                 
                              
                            
                           such that 
                           
                              ∀
                              i
                              ≥
                              0
                              
                              .
                              
                              
                                 
                                    q
                                 
                                 
                                    i
                                 
                              
                              
                                 
                                    |
                                 
                                 
                                    w
                                 
                              
                              
                                 
                                    r
                                 
                                 
                                    i
                                 
                              
                              ∧
                              (
                              (
                              
                                 
                                    m
                                 
                                 
                                    i
                                 
                              
                              =
                              1
                              ∧
                              
                                 
                                    n
                                 
                                 
                                    i
                                 
                              
                              =
                              0
                              )
                              ∨
                              (
                              
                                 
                                    m
                                 
                                 
                                    i
                                 
                              
                              =
                              0
                              ∧
                              
                                 
                                    n
                                 
                                 
                                    i
                                 
                              
                              >
                              0
                              )
                              )
                           
                           .
                        

See Appendix A.3  □

Weak adaptability guarantees that there is always at least one way for a certain state of an 
                        S
                        [
                        B
                        ]
                      system to adapt, that is to say to continue to evolve in a consistent way w.r.t. the structural constraints of the S level. A stronger property that could be useful to know about the adaptability of a system is what we call strong adaptability. A B state q is strongly adaptable to an S state r if it satisfies the constraints imposed by r and all its successors 
                        
                           
                              q
                           
                           
                              ′
                           
                        
                      are either strongly adaptable to the same r or they are always the starting point of a successful adaptation phase towards states 
                        
                           
                              q
                           
                           
                              ″
                           
                        
                      that are strongly adaptable to other S states. Again, bad deadlocks are excluded from the relations. This time we require that all the “border” states are safe doors to other steady situations, whatever path is taken from them.


                     
                        Definition 9
                        Strong adaptation


                        Given an 
                              S
                              [
                              B
                              ]
                            system, a binary relation 
                              R
                              ⊆
                              Q
                              ×
                              R
                            is a strong adaptation if and only if whenever 
                              q
                              
                              R
                              
                              r
                            we have:
                              
                                 (i)
                                 
                                    
                                       q
                                       ⊨
                                       L
                                       (
                                       r
                                       )
                                     and 
                                       
                                          Progress
                                       
                                       (
                                       q
                                       ,
                                       r
                                       )
                                    , and
                                 

for all 
                                       
                                          
                                             q
                                          
                                          
                                             ′
                                          
                                       
                                       ∈
                                       Q
                                    , if 
                                       (
                                       q
                                       ,
                                       r
                                       ,
                                       ∅
                                       )
                                       
                                          →
                                          r
                                       
                                       (
                                       
                                          
                                             q
                                          
                                          
                                             ′
                                          
                                       
                                       ,
                                       r
                                       ,
                                       ∅
                                       )
                                     then 
                                       
                                          
                                             q
                                          
                                          
                                             ′
                                          
                                       
                                       
                                       R
                                       
                                       r
                                    , and
                                 

all adaptation paths starting from 
                                       (
                                       q
                                       ,
                                       r
                                       ,
                                       ∅
                                       )
                                     are finite and end up in a state 
                                       (
                                       
                                          
                                             q
                                          
                                          
                                             ′
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             ′
                                          
                                       
                                       ,
                                       ∅
                                       )
                                     such that 
                                       
                                          
                                             q
                                          
                                          
                                             ′
                                          
                                       
                                       
                                       R
                                       
                                       
                                          
                                             r
                                          
                                          
                                             ′
                                          
                                       
                                    .

At the level of the whole system, we say that B is strongly adaptable to S if the initial B state 
                              
                                 
                                    q
                                 
                                 
                                    0
                                 
                              
                            is strongly adaptable to the initial S state 
                              
                                 
                                    r
                                 
                                 
                                    0
                                 
                              
                           .


                     
                        Proposition 3
                        Union of strong adaptation relations


                        
                           Given an 
                           
                              S
                              [
                              B
                              ]
                            
                           system, if 
                           
                              
                                 
                                    R
                                 
                                 
                                    1
                                 
                              
                            
                           and 
                           
                              
                                 
                                    R
                                 
                                 
                                    2
                                 
                              
                            
                           are strong adaptation relations, then 
                           
                              
                                 
                                    R
                                 
                                 
                                    1
                                 
                              
                              ∪
                              
                                 
                                    R
                                 
                                 
                                    2
                                 
                              
                            
                           is a strong adaptation relation.
                        

As in the case of weak adaptation relations.  □


                     
                        Definition 10
                        Strong adaptability


                        Given an 
                              S
                              [
                              B
                              ]
                            system, the union of all strong adaptation relations among the states Q and R of 
                              S
                              [
                              B
                              ]
                            is denoted by 
                              
                                 
                                    R
                                 
                                 
                                    s
                                 
                              
                            and is the strong adaptability relation of 
                              S
                              [
                              B
                              ]
                           .

In the remainder of the paper we will alternatively say that an 
                        S
                        [
                        B
                        ]
                      system is weakly (strongly) adaptable, in the sense that B is weakly (strongly) adaptable to S. It is straightforward to see that strong adaptability implies weak adaptability, since the strong version of the relation requires that every adaptation path reaches a target S state, while the weak version just requires that at least one adaptation path reaches a target S state.


                     
                        Proposition 4
                        Strong adaptation implies weak adaptation


                        
                           Consider an 
                           
                              S
                              [
                              B
                              ]
                            
                           system and let q and r be such that 
                           
                              q
                              
                                 
                                    |
                                 
                                 
                                    s
                                 
                              
                              r
                           
                           . Then, it holds 
                           
                              q
                              
                                 
                                    |
                                 
                                 
                                    w
                                 
                              
                              r
                           
                           .
                        

See Appendix A.4  □

Given the flat semantics 
                        F
                        (
                        S
                        [
                        B
                        ]
                        )
                        =
                        (
                        F
                        ,
                        
                           
                              f
                           
                           
                              0
                           
                        
                        ,
                        
                           →
                           r
                        
                        ∪
                        
                           →
                           
                              r
                              ,
                              ψ
                              ,
                              
                                 
                                    r
                                 
                                 
                                    ′
                                 
                              
                           
                        
                        )
                      of an 
                        S
                        [
                        B
                        ]
                      system, we will denote, in the following, the set of reachable states from a certain state 
                        f
                        ∈
                        F
                      as the reflexive and transitive closure 
                        
                           
                              Post
                           
                           
                              ⁎
                           
                        
                        (
                        f
                        )
                      of the operator 
                        
                           Post
                        
                        (
                        s
                        )
                        =
                        {
                        
                           
                              s
                           
                           
                              ′
                           
                        
                        ∈
                        F
                        
                        |
                        
                        (
                        s
                        ,
                        
                           
                              s
                           
                           
                              ′
                           
                        
                        )
                        ∈
                        
                        
                           →
                           r
                        
                        ∪
                        
                           →
                           
                              r
                              ,
                              ψ
                              ,
                              
                                 
                                    r
                                 
                                 
                                    ′
                                 
                              
                           
                        
                        }
                     .


                     
                        Lemma 2
                        Propagation of strong adaptation relation


                        
                           Consider an 
                           
                              S
                              [
                              B
                              ]
                            
                           system and let q and r be such that 
                           
                              q
                              
                                 
                                    |
                                 
                                 
                                    s
                                 
                              
                              r
                           
                           . Then, every state 
                           
                              (
                              
                                 
                                    q
                                 
                                 
                                    ′
                                 
                              
                              ,
                              
                                 
                                    r
                                 
                                 
                                    ′
                                 
                              
                              ,
                              ∅
                              )
                              ∈
                              
                                 
                                    Post
                                 
                                 
                                    ⁎
                                 
                              
                              (
                              (
                              q
                              ,
                              r
                              ,
                              ∅
                              )
                              )
                            
                           is such that 
                           
                              
                                 
                                    q
                                 
                                 
                                    ′
                                 
                              
                              
                                 
                                    |
                                 
                                 
                                    s
                                 
                              
                              
                                 
                                    r
                                 
                                 
                                    ′
                                 
                              
                           
                           .
                        

See Appendix A.5  □

The following proposition gives a precise candidate relation for checking if a system is strongly adaptable: such a candidate is determined by the steady states of the flat semantics that are reachable from the initial state.


                     
                        Proposition 5
                        Construction of strong adaptation relation


                        
                           Given an 
                           
                              S
                              [
                              B
                              ]
                            
                           system, let 
                           
                              F
                              (
                              S
                              [
                              B
                              ]
                              )
                              =
                              (
                              F
                              ,
                              
                                 
                                    f
                                 
                                 
                                    0
                                 
                              
                              ,
                              
                                 →
                                 r
                              
                              ∪
                              
                                 →
                                 
                                    r
                                    ,
                                    ψ
                                    ,
                                    
                                       
                                          r
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                              )
                            
                           be its flat semantics. Then 
                           
                              S
                              [
                              B
                              ]
                            
                           is strongly adaptable if and only if 
                           
                              R
                              =
                              {
                              (
                              q
                              ,
                              r
                              )
                              ∈
                              Q
                              ×
                              R
                              |
                              (
                              q
                              ,
                              r
                              ,
                              ∅
                              )
                              ∈
                              
                                 
                                    Post
                                 
                                 
                                    ⁎
                                 
                              
                              (
                              
                                 
                                    f
                                 
                                 
                                    0
                                 
                              
                              )
                              }
                            
                           is a strong adaptation relation.
                        

See Appendix A.6  □

In the following we will show that in the ATV motion controller case study 
                           
                              
                                 S
                              
                              
                                 0
                              
                           
                           [
                           B
                           ]
                         is strongly adaptable (and thus also weakly adaptable) and 
                           
                              
                                 S
                              
                              
                                 1
                              
                           
                           [
                           B
                           ]
                         is weakly adaptable, but not strongly adaptable.

In order to verify that 
                           
                              
                                 S
                              
                              
                                 0
                              
                           
                           [
                           B
                           ]
                         is strongly adaptable, we need to prove that 
                           
                              
                                 q
                              
                              
                                 0
                              
                           
                           
                              
                                 |
                              
                              
                                 s
                              
                           
                           
                              
                                 r
                              
                              
                                 0
                              
                           
                        , by finding a strong adaptation relation 
                           R
                         s.t. 
                           (
                           
                              
                                 q
                              
                              
                                 0
                              
                           
                           ,
                           
                              
                                 r
                              
                              
                                 0
                              
                           
                           )
                           ∈
                           R
                        . Note that in 
                           F
                           (
                           
                              
                                 S
                              
                              
                                 0
                              
                           
                           [
                           B
                           ]
                           )
                        , every state is reachable from the initial state 
                           (
                           0
                           ,
                           
                              
                                 r
                              
                              
                                 0
                              
                           
                           ,
                           ∅
                           )
                        . Therefore by Proposition 5, we consider the relation 
                           R
                           =
                           {
                           (
                           q
                           ,
                           r
                           )
                           
                           |
                           
                           q
                           ∈
                           Q
                           ,
                           r
                           ∈
                           R
                           ,
                           (
                           q
                           ,
                           r
                           ,
                           ∅
                           )
                           ∈
                           F
                           }
                        , where F is the set of flat states of 
                           F
                           (
                           
                              
                                 S
                              
                              
                                 0
                              
                           
                           [
                           B
                           ]
                           )
                        . It is easy to verify that 
                           ∀
                           (
                           q
                           ,
                           r
                           )
                           ∈
                           R
                           .
                           
                           q
                           ⊨
                           L
                           (
                           r
                           )
                        ; and that 
                           
                              Progress
                           
                           (
                           q
                           ,
                           r
                           )
                         holds for any of such states, because there are no deadlock states in the flat semantics. Therefore condition (i) of the definition of strong adaptation is always true and has not to be further checked. Clearly, 
                           (
                           
                              
                                 q
                              
                              
                                 0
                              
                           
                           ,
                           
                              
                                 r
                              
                              
                                 0
                              
                           
                           )
                           ∈
                           R
                        . Finally, it can be shown that requirements (ii) and (iii) of Definition 9 hold for each element of 
                           R
                        .

We show the proof for 
                           (
                           (
                           M
                           ,
                           0
                           ,
                           0
                           ,
                           0
                           ,
                           0
                           )
                           ,
                           
                              
                                 r
                              
                              
                                 0
                              
                           
                           )
                         and 
                           (
                           (
                           M
                           ,
                           0
                           ,
                           1
                           ,
                           1
                           ,
                           0
                           )
                           ,
                           
                              
                                 r
                              
                              
                                 0
                              
                           
                           )
                        . The other pairs can be proved analogously.
                           
                              •
                              
                                 
                                    (
                                    (
                                    M
                                    ,
                                    0
                                    ,
                                    0
                                    ,
                                    0
                                    ,
                                    0
                                    )
                                    ,
                                    
                                       
                                          r
                                       
                                       
                                          0
                                       
                                    
                                    )
                                 
                                 
                                    
                                       (ii)
                                       
                                          
                                             (
                                             (
                                             M
                                             ,
                                             0
                                             ,
                                             0
                                             ,
                                             0
                                             ,
                                             0
                                             )
                                             ,
                                             
                                                
                                                   r
                                                
                                                
                                                   0
                                                
                                             
                                             ,
                                             ∅
                                             )
                                             
                                                →
                                                
                                                   
                                                      r
                                                   
                                                   
                                                      0
                                                   
                                                
                                             
                                             (
                                             (
                                             M
                                             ,
                                             0
                                             ,
                                             0
                                             ,
                                             1
                                             ,
                                             0
                                             )
                                             ,
                                             
                                                
                                                   r
                                                
                                                
                                                   0
                                                
                                             
                                             ,
                                             ∅
                                             )
                                           and 
                                             (
                                             (
                                             M
                                             ,
                                             0
                                             ,
                                             0
                                             ,
                                             1
                                             ,
                                             0
                                             )
                                             ,
                                             
                                                
                                                   r
                                                
                                                
                                                   0
                                                
                                             
                                             )
                                             ∈
                                             R
                                          ;


                                          
                                             (
                                             (
                                             M
                                             ,
                                             0
                                             ,
                                             0
                                             ,
                                             0
                                             ,
                                             0
                                             )
                                             ,
                                             
                                                
                                                   r
                                                
                                                
                                                   0
                                                
                                             
                                             ,
                                             ∅
                                             )
                                             
                                                →
                                                
                                                   
                                                      r
                                                   
                                                   
                                                      0
                                                   
                                                
                                             
                                             (
                                             (
                                             M
                                             ,
                                             0
                                             ,
                                             1
                                             ,
                                             1
                                             ,
                                             0
                                             )
                                             ,
                                             
                                                
                                                   r
                                                
                                                
                                                   0
                                                
                                             
                                             ,
                                             ∅
                                             )
                                           and 
                                             (
                                             (
                                             M
                                             ,
                                             0
                                             ,
                                             1
                                             ,
                                             1
                                             ,
                                             0
                                             )
                                             ,
                                             
                                                
                                                   r
                                                
                                                
                                                   0
                                                
                                             
                                             )
                                             ∈
                                             R
                                          
                                       


                                          
                                             
                                          
                                       


                                 
                                    (
                                    (
                                    M
                                    ,
                                    0
                                    ,
                                    1
                                    ,
                                    1
                                    ,
                                    0
                                    )
                                    ,
                                    
                                       
                                          r
                                       
                                       
                                          0
                                       
                                    
                                    )
                                 
                                 
                                    
                                       (ii)
                                       
                                          
                                             
                                          
                                       

there is only one adaptation path from 
                                             (
                                             (
                                             M
                                             ,
                                             0
                                             ,
                                             1
                                             ,
                                             1
                                             ,
                                             0
                                             )
                                             ,
                                             
                                                
                                                   r
                                                
                                                
                                                   0
                                                
                                             
                                             ,
                                             ∅
                                             )
                                           leading to the flat state 
                                             (
                                             (
                                             S
                                             ,
                                             0
                                             ,
                                             1
                                             ,
                                             0
                                             ,
                                             0
                                             )
                                             ,
                                             
                                                
                                                   r
                                                
                                                
                                                   1
                                                
                                             
                                             ,
                                             ∅
                                             )
                                           (through the B state 
                                             (
                                             M
                                             ,
                                             0
                                             ,
                                             1
                                             ,
                                             0
                                             ,
                                             1
                                             )
                                          ), and 
                                             (
                                             (
                                             S
                                             ,
                                             0
                                             ,
                                             1
                                             ,
                                             0
                                             ,
                                             0
                                             )
                                             ,
                                             
                                                
                                                   r
                                                
                                                
                                                   1
                                                
                                             
                                             )
                                             ∈
                                             R
                                          .

On the other hand, we demonstrate that 
                           
                              
                                 S
                              
                              
                                 1
                              
                           
                           [
                           B
                           ]
                         is weakly adaptable by finding a weak adaptation relation 
                           R
                         s.t. 
                           (
                           
                              
                                 q
                              
                              
                                 0
                              
                           
                           ,
                           
                              
                                 r
                              
                              
                                 0
                              
                           
                           )
                           ∈
                           R
                        . We take as 
                           R
                         the following relation:
                           
                              
                                 {
                                 (
                                 (
                                 M
                                 ,
                                 0
                                 ,
                                 0
                                 ,
                                 0
                                 ,
                                 0
                                 )
                                 ,
                                 
                                    
                                       r
                                    
                                    
                                       0
                                    
                                 
                                 )
                                 ,
                                 (
                                 (
                                 S
                                 ,
                                 0
                                 ,
                                 1
                                 ,
                                 0
                                 ,
                                 0
                                 )
                                 ,
                                 
                                    
                                       r
                                    
                                    
                                       1
                                    
                                 
                                 )
                                 ,
                                 (
                                 (
                                 M
                                 ,
                                 0
                                 ,
                                 1
                                 ,
                                 1
                                 ,
                                 0
                                 )
                                 ,
                                 
                                    
                                       r
                                    
                                    
                                       0
                                    
                                 
                                 )
                                 ,
                                 (
                                 (
                                 S
                                 ,
                                 0
                                 ,
                                 0
                                 ,
                                 1
                                 ,
                                 0
                                 )
                                 ,
                                 
                                    
                                       r
                                    
                                    
                                       1
                                    
                                 
                                 )
                                 }
                              
                           
                         Similarly to 
                           
                              
                                 S
                              
                              
                                 0
                              
                           
                           [
                           B
                           ]
                        , 
                           (
                           
                              
                                 q
                              
                              
                                 0
                              
                           
                           ,
                           
                              
                                 r
                              
                              
                                 0
                              
                           
                           )
                           ∈
                           R
                         and for all 
                           (
                           q
                           ,
                           r
                           )
                           ∈
                           R
                        , 
                           
                           q
                           ⊨
                           L
                           (
                           r
                           )
                         and 
                           
                              Progress
                           
                           (
                           q
                           ,
                           r
                           )
                         both holds. Thus, we need to check requirements (ii) and (iii) of Definition 7 to prove that 
                           R
                         is a weak adaptation relation.

We observe that pairs 
                           (
                           (
                           M
                           ,
                           0
                           ,
                           0
                           ,
                           0
                           ,
                           0
                           )
                           ,
                           
                              
                                 r
                              
                              
                                 0
                              
                           
                           )
                         and 
                           (
                           (
                           S
                           ,
                           0
                           ,
                           1
                           ,
                           0
                           ,
                           0
                           )
                           ,
                           
                              
                                 r
                              
                              
                                 1
                              
                           
                           )
                         meet requirements (ii) and (iii), the latter being trivially verified since they do not admit adaptation transitions. Pairs 
                           (
                           (
                           M
                           ,
                           0
                           ,
                           1
                           ,
                           1
                           ,
                           0
                           )
                           ,
                           
                              
                                 r
                              
                              
                                 0
                              
                           
                           )
                         and 
                           (
                           (
                           S
                           ,
                           0
                           ,
                           0
                           ,
                           1
                           ,
                           0
                           )
                           ,
                           
                              
                                 r
                              
                              
                                 1
                              
                           
                           )
                         also comply with the weak adaptation definition, since they can both reach, in a finite number of adaptation steps, flat states that map to elements in 
                           R
                        , i.e. 
                           (
                           (
                           S
                           ,
                           0
                           ,
                           1
                           ,
                           0
                           ,
                           0
                           )
                           ,
                           
                              
                                 r
                              
                              
                                 1
                              
                           
                           )
                         and 
                           (
                           (
                           M
                           ,
                           0
                           ,
                           0
                           ,
                           0
                           ,
                           0
                           )
                           ,
                           
                              
                                 r
                              
                              
                                 0
                              
                           
                           )
                        , respectively.

However, note that 
                           (
                           (
                           S
                           ,
                           0
                           ,
                           1
                           ,
                           0
                           ,
                           0
                           )
                           ,
                           
                              
                                 r
                              
                              
                                 1
                              
                           
                           )
                         cannot be in any strong adaptation relation because, by the propagation property, 
                           (
                           (
                           M
                           ,
                           2
                           ,
                           1
                           ,
                           1
                           ,
                           0
                           )
                           ,
                           
                              
                                 r
                              
                              
                                 0
                              
                           
                           )
                         would be in the relation and there are infinite adaptation paths starting from its corresponding flat state (see Fig. 6 and its caption). We conclude that 
                           R
                         is a weak and not strong adaptation relation.

In this section we formulate the adaptability properties introduced in Section 5 in terms of formulae of a temporal logic that can be model checked [2,17].

To this purpose we briefly recall the well-known Computation Tree Logic (CTL) 
                     [14,15], a branching-time logic whose semantics is defined in terms of paths along a Kripke structure [33]. Given a set AP of atomic propositions, a Kripke structure is a tuple 
                        
                           
                              (
                              T
                              ,
                              
                                 
                                    t
                                 
                                 
                                    0
                                 
                              
                              ,
                              →
                           
                           
                              k
                           
                        
                        ,
                        I
                        )
                      where T is a finite set of states, 
                        
                           
                              t
                           
                           
                              0
                           
                        
                      is the initial state, 
                        
                           
                              →
                           
                           
                              κ
                           
                        
                        ⊆
                        T
                        ×
                        T
                      is a left-total transition relation and 
                        I
                        :
                        T
                        →
                        
                           
                              2
                           
                           
                              AP
                           
                        
                      maps each state to the set of atomic propositions that are true in that state. Given a state 
                        t
                        ∈
                        T
                     , a path π starting from t has the form 
                        π
                        :
                        t
                        =
                        
                           
                              t
                           
                           
                              0
                           
                        
                        
                           
                              →
                           
                           
                              κ
                           
                        
                        
                           
                              t
                           
                           
                              1
                           
                        
                        
                           
                              →
                           
                           
                              κ
                           
                        
                        
                           
                              t
                           
                           
                              2
                           
                        
                        
                           
                              →
                           
                           
                              κ
                           
                        
                        ⋯
                     , where for all 
                        i
                        =
                        1
                        ,
                        2
                        ,
                        …
                        ,
                        (
                        
                           
                              t
                           
                           
                              i
                              −
                              1
                           
                        
                        ,
                        
                           
                              t
                           
                           
                              i
                           
                        
                        )
                        ∈
                        
                           
                              →
                           
                           
                              κ
                           
                        
                     . Given a path π and an index 
                        i
                        >
                        0
                     , by 
                        π
                        [
                        i
                        ]
                      we denote the i-th state along the path π. The set of all paths starting from t is denoted by 
                        
                           Paths
                        
                        (
                        t
                        )
                     . Note that, since the transition relation is required to be left-total, all runs are infinite. To model a deadlocked or terminated state in a Kripke structure the modeller must put a self-cycle on that state.

The set of well-formed CTL formulae are given by the following grammar:
                        
                           
                              ϕ
                              :
                              :
                              =
                              
                                 true
                              
                              
                              |
                              
                              p
                              
                              |
                              
                              ¬
                              ϕ
                              
                              |
                              
                              ϕ
                              ∧
                              ϕ
                              
                              |
                              
                              
                                 AX
                              
                              ϕ
                              
                              |
                              
                              
                                 EX
                              
                              ϕ
                              
                              |
                              
                              A
                              [
                              ϕ
                              U
                              ϕ
                              ]
                              
                              |
                              
                              E
                              [
                              ϕ
                              U
                              ϕ
                              ]
                           
                        
                      where 
                        p
                        ∈
                        
                           AP
                        
                      is an atomic proposition, logical operators are minimal (
                        ¬
                        ,
                        ∧
                     ) in order to generate all the usual ones, and temporal operators (X next, U until) quantify along paths and must be preceded by the universal path quantifier A or by the existential path quantifier E.

Given a state t of the underlying Kripke structure, the satisfaction of a CTL formula ϕ in t, written 
                        t
                        
                           
                              ⊨
                           
                           
                              CTL
                           
                        
                        ϕ
                     , is defined inductively as follows.
                        
                           
                              
                                 
                                    
                                       t
                                       
                                          
                                             ⊨
                                          
                                          
                                             CTL
                                          
                                       
                                       
                                          true
                                       
                                    
                                    
                                        
                                    
                                    
                                       for all 
                                       t
                                    
                                 
                                 
                                    
                                       t
                                       
                                          
                                             ⊨
                                          
                                          
                                             CTL
                                          
                                       
                                       p
                                    
                                    
                                        iff 
                                    
                                    
                                       p
                                       ∈
                                       I
                                       (
                                       t
                                       )
                                    
                                 
                                 
                                    
                                       t
                                       
                                          
                                             ⊨
                                          
                                          
                                             CTL
                                          
                                       
                                       ¬
                                       ϕ
                                    
                                    
                                        iff 
                                    
                                    
                                       t
                                       
                                          
                                             ⊭
                                          
                                          
                                             CTL
                                          
                                       
                                       ϕ
                                    
                                 
                                 
                                    
                                       t
                                       
                                          
                                             ⊨
                                          
                                          
                                             CTL
                                          
                                       
                                       
                                          
                                             ϕ
                                          
                                          
                                             1
                                          
                                       
                                       ∧
                                       
                                          
                                             ϕ
                                          
                                          
                                             2
                                          
                                       
                                    
                                    
                                        iff 
                                    
                                    
                                       t
                                       
                                          
                                             ⊨
                                          
                                          
                                             CTL
                                          
                                       
                                       
                                          
                                             ϕ
                                          
                                          
                                             1
                                          
                                       
                                        and 
                                       t
                                       
                                          
                                             ⊨
                                          
                                          
                                             CTL
                                          
                                       
                                       
                                          
                                             ϕ
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 
                                    
                                       t
                                       
                                          
                                             ⊨
                                          
                                          
                                             CTL
                                          
                                       
                                       
                                          AX
                                       
                                       ϕ
                                    
                                    
                                        iff 
                                    
                                    
                                       ∀
                                       π
                                       ∈
                                       
                                          Paths
                                       
                                       (
                                       t
                                       )
                                       .
                                       π
                                       [
                                       1
                                       ]
                                       
                                          
                                             ⊨
                                          
                                          
                                             CTL
                                          
                                       
                                       ϕ
                                    
                                 
                                 
                                    
                                       t
                                       
                                          
                                             ⊨
                                          
                                          
                                             CTL
                                          
                                       
                                       
                                          EX
                                       
                                       ϕ
                                    
                                    
                                        iff 
                                    
                                    
                                       ∃
                                       π
                                       ∈
                                       
                                          Paths
                                       
                                       (
                                       t
                                       )
                                       :
                                       π
                                       [
                                       1
                                       ]
                                       
                                          
                                             ⊨
                                          
                                          
                                             CTL
                                          
                                       
                                       ϕ
                                    
                                 
                                 
                                    
                                       t
                                       
                                          
                                             ⊨
                                          
                                          
                                             CTL
                                          
                                       
                                       A
                                       [
                                       
                                          
                                             ϕ
                                          
                                          
                                             1
                                          
                                       
                                       U
                                       
                                          
                                             ϕ
                                          
                                          
                                             2
                                          
                                       
                                       ]
                                    
                                    
                                        iff 
                                    
                                    
                                       ∀
                                       π
                                       ∈
                                       
                                          Paths
                                       
                                       (
                                       t
                                       )
                                       .
                                       ∃
                                       j
                                       ≥
                                       0
                                       :
                                       (
                                       π
                                       [
                                       j
                                       ]
                                       
                                          
                                             ⊨
                                          
                                          
                                             CTL
                                          
                                       
                                       
                                          
                                             ϕ
                                          
                                          
                                             2
                                          
                                       
                                        and 
                                       ∀
                                       0
                                       ≤
                                       i
                                       <
                                       j
                                       .
                                       π
                                       [
                                       i
                                       ]
                                       
                                          
                                             ⊨
                                          
                                          
                                             CTL
                                          
                                       
                                       
                                          
                                             ϕ
                                          
                                          
                                             1
                                          
                                       
                                       )
                                    
                                 
                                 
                                    
                                       t
                                       
                                          
                                             ⊨
                                          
                                          
                                             CTL
                                          
                                       
                                       E
                                       [
                                       
                                          
                                             ϕ
                                          
                                          
                                             1
                                          
                                       
                                       U
                                       
                                          
                                             ϕ
                                          
                                          
                                             2
                                          
                                       
                                       ]
                                    
                                    
                                        iff 
                                    
                                    
                                       ∃
                                       π
                                       ∈
                                       
                                          Paths
                                       
                                       (
                                       t
                                       )
                                       :
                                       ∃
                                       j
                                       ≥
                                       0
                                       :
                                       (
                                       π
                                       [
                                       j
                                       ]
                                       
                                          
                                             ⊨
                                          
                                          
                                             CTL
                                          
                                       
                                       
                                          
                                             ϕ
                                          
                                          
                                             2
                                          
                                       
                                        and 
                                       ∀
                                       0
                                       ≤
                                       i
                                       <
                                       j
                                       .
                                       π
                                       [
                                       i
                                       ]
                                       
                                          
                                             ⊨
                                          
                                          
                                             CTL
                                          
                                       
                                       
                                          
                                             ϕ
                                          
                                          
                                             1
                                          
                                       
                                       )
                                    
                                 
                              
                           
                        
                      Other useful temporal operators like EF
                     ϕ (ϕ holds potentially), AF
                     ϕ (ϕ is inevitable), EG
                     ϕ (potentially always ϕ) and AG
                     ϕ (invariantly ϕ), are derived, as usual, as follows: 
                        
                           EF
                        
                        ϕ
                        ≡
                        E
                        [
                        
                           true
                        
                        U
                        ϕ
                        ]
                     , 
                        
                           AF
                        
                        ϕ
                        ≡
                        A
                        [
                        
                           true
                        
                        U
                        ϕ
                        ]
                     , 
                        
                           EG
                        
                        ϕ
                        ≡
                        ¬
                        
                           AF
                        
                        ¬
                        ϕ
                      and 
                        
                           AG
                        
                        ϕ
                        ≡
                        ¬
                        
                           EF
                        
                        ¬
                        ϕ
                     .

In the following we provide a Kripke structure derived from the flat semantics 
                        F
                        (
                        S
                        [
                        B
                        ]
                        )
                      and two CTL formulae characterising weak and strong adaptability.


                     
                        Definition 11
                        Associated Kripke structure


                        Consider an 
                              S
                              [
                              B
                              ]
                            system and its associated flat semantics 
                              F
                              (
                              S
                              [
                              B
                              ]
                              )
                              =
                              (
                              F
                              ,
                              
                                 
                                    f
                                 
                                 
                                    0
                                 
                              
                              ,
                              
                                 →
                                 r
                              
                              ∪
                              
                                 →
                                 
                                    r
                                    ,
                                    ψ
                                    ,
                                    
                                       
                                          r
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                              )
                           . Its associated Kripke structure is defined as 
                              K
                              (
                              S
                              [
                              B
                              ]
                              )
                              =
                              
                                 
                                    (
                                    T
                                    ,
                                    
                                       
                                          t
                                       
                                       
                                          0
                                       
                                    
                                    ,
                                    →
                                 
                                 
                                    k
                                 
                              
                              ,
                              I
                              )
                            where 
                              T
                              =
                              F
                           , 
                              
                                 
                                    t
                                 
                                 
                                    0
                                 
                              
                              =
                              
                                 
                                    f
                                 
                                 
                                    0
                                 
                              
                           , 
                              
                           , I is defined w.r.t. the set 
                              
                                 AP
                              
                              =
                              {
                              
                                 adapting
                              
                              ,
                              
                                 steady
                              
                              ,
                              
                                 progress
                              
                              }
                            of atomic propositions as follows. For all 
                              t
                              ∈
                              T
                           :
                              
                                 (i)
                                 
                                    
                                       
                                          adapting
                                       
                                       ∈
                                       I
                                       (
                                       t
                                       )
                                       ⇔
                                       t
                                       =
                                       (
                                       q
                                       ,
                                       r
                                       ,
                                       ρ
                                       )
                                       ∧
                                       t
                                       
                                          →
                                          
                                             r
                                             ,
                                             ψ
                                             ,
                                             
                                                
                                                   r
                                                
                                                
                                                   ′
                                                
                                             
                                          
                                       
                                    
                                 


                                    
                                       
                                          steady
                                       
                                       ∈
                                       I
                                       (
                                       t
                                       )
                                       ⇔
                                       t
                                       =
                                       (
                                       q
                                       ,
                                       r
                                       ,
                                       ∅
                                       )
                                       ∧
                                       (
                                       t
                                       
                                          →
                                          r
                                       
                                       ∨
                                       
                                       t
                                       
                                          →
                                          
                                             r
                                             ,
                                             ψ
                                             ,
                                             
                                                
                                                   r
                                                
                                                
                                                   ′
                                                
                                             
                                          
                                       
                                       )
                                    
                                 


                                    
                                       
                                          progress
                                       
                                       ∈
                                       I
                                       (
                                       t
                                       )
                                       ⇔
                                       t
                                       
                                          →
                                          r
                                       
                                       ∨
                                       
                                       t
                                       
                                          →
                                          
                                             r
                                             ,
                                             ψ
                                             ,
                                             
                                                
                                                   r
                                                
                                                
                                                   ′
                                                
                                             
                                          
                                       
                                    
                                 

Note that the only structural difference between 
                        F
                        (
                        S
                        [
                        B
                        ]
                        )
                      and 
                        K
                        (
                        S
                        [
                        B
                        ]
                        )
                      are the self-loop transitions in 
                        
                           
                              →
                           
                           
                              self
                           
                        
                      added in 
                        K
                        (
                        S
                        [
                        B
                        ]
                        )
                     . These are needed because the transition relation of the Kripke structure must be left-total, but indeed they allow us to keep the information that the states t such that 
                        t
                        
                           
                              →
                           
                           
                              self
                           
                        
                        t
                      where originally deadlocked in 
                        F
                        (
                        S
                        [
                        B
                        ]
                        )
                      (see discussion in Section 4.1). Then, the atomic proposition progress, by its definition (identical to the one given for 
                        
                           Progress
                        
                        (
                        q
                        ,
                        r
                        )
                      at the end of Section 4.1), is not true in all and only those states of 
                        K
                        (
                        S
                        [
                        B
                        ]
                        )
                      that were originally deadlocked or bad terminated in 
                        F
                        (
                        S
                        [
                        B
                        ]
                        )
                     . Moreover, we remark that in some states both adapting and steady propositions may hold at the same time. These are the already mentioned “border” states, i.e. those that are still in a steady situation, but will start adapting in the next transition. From these, the next state may be steady again (immediate adaptation) or only adapting (adaptation in more than one step).

The formulae that we will check on 
                        K
                        (
                        S
                        [
                        B
                        ]
                        )
                      are the following:
                        
                           •
                           
                              Weak adaptation: there is a path in which the progress condition continuously holds and, as soon as adaptation starts, there exists at least one path for which the system eventually ends the adaptation phase leading to a steady state.
                                 
                                    (6.1)
                                    
                                       
                                          EG
                                       
                                       (
                                       (
                                       
                                          adapting
                                       
                                       ⟹
                                       
                                          EF
                                       
                                       
                                       
                                          steady
                                       
                                       )
                                       
                                       ∧
                                       
                                       
                                          progress
                                       
                                       )
                                    
                                 
                              
                           


                              Strong adaptation: for all paths, the progress condition always holds and whenever the system is in an adapting state, from there all paths eventually ends the adaptation phase leading to a steady state.
                                 
                                    (6.2)
                                    
                                       
                                          AG
                                       
                                       (
                                       (
                                       
                                          adapting
                                       
                                       ⟹
                                       
                                          AF
                                       
                                       
                                       
                                          steady
                                       
                                       )
                                       
                                       ∧
                                       
                                       
                                          progress
                                       
                                       )
                                    
                                 
                              
                           

We remark that the same formulae could be expressed in the Action-based Computation Tree Logic (ACTL) [21] without the need of defining the atomic propositions. However, we decided to use CTL because we recognise that it is one of the mostly known and used temporal logic for model checking.

Moreover, the expressive power given by CTL is adequate for the adaptability checking we introduced, in the sense that the same properties could not be expressed in the other mostly used logic, Linear Temporal Logic (LTL) [40]. In particular, the weak adaptability property requires the existential path quantification (EG, EF), which cannot be expressed in LTL, to render the invariability of the possibility of adaptation along one certain computation. Differently, the strong adaptability property could also be formulated in LTL as 
                        □
                        (
                        (
                        
                           adapting
                        
                        ⇒
                        ◇
                        
                           steady
                        
                        )
                        ∧
                        
                           progress
                        
                        )
                     .


                     
                        Theorem 1
                        Weak adaptability checking


                        
                           Consider an 
                           
                              S
                              [
                              B
                              ]
                            
                           system. Given a B state q and an S state r such that 
                           
                              q
                              ⊨
                              L
                              (
                              r
                              )
                           
                           , then q is weakly adaptable to r if and only if the weak adaptation CTL formula (Eq. 
                           
                              (6.1)
                           
                           ) is true in 
                           
                              K
                              (
                              S
                              [
                              B
                              ]
                              )
                            
                           at state 
                           
                              (
                              q
                              ,
                              r
                              ,
                              ∅
                              )
                           
                           . Formally, given a state 
                           
                              q
                              ∈
                              [
                              [
                              L
                              (
                              r
                              )
                              ]
                              ]
                           
                           
                              
                                 
                                    q
                                    
                                    
                                       
                                          |
                                       
                                       
                                          w
                                       
                                    
                                    
                                    r
                                    ⇔
                                    (
                                    q
                                    ,
                                    r
                                    ,
                                    ∅
                                    )
                                    
                                       
                                          ⊨
                                       
                                       
                                          CTL
                                       
                                    
                                    
                                       EG
                                    
                                    (
                                    (
                                    
                                       adapting
                                    
                                    ⟹
                                    
                                       EF
                                    
                                    
                                    
                                       steady
                                    
                                    )
                                    
                                    ∧
                                    
                                    
                                       progress
                                    
                                    )
                                 
                              
                           
                        

See Appendix A.7  □


                     
                        Corollary 1
                        
                           Consider an 
                           
                              S
                              [
                              B
                              ]
                            
                           system. Then, 
                           
                              S
                              [
                              B
                              ]
                            
                           is weakly adaptable if and only if
                           
                              
                                 
                                    
                                       
                                          t
                                       
                                       
                                          0
                                       
                                    
                                    
                                       
                                          ⊨
                                       
                                       
                                          CTL
                                       
                                    
                                    
                                       EG
                                    
                                    (
                                    (
                                    
                                       adapting
                                    
                                    ⟹
                                    
                                       EF
                                    
                                    
                                    
                                       steady
                                    
                                    )
                                    
                                    ∧
                                    
                                    
                                       progress
                                    
                                    )
                                 
                              
                            
                           where 
                           
                              
                                 
                                    t
                                 
                                 
                                    0
                                 
                              
                            
                           is the initial state of 
                           
                              K
                              (
                              S
                              [
                              B
                              ]
                              )
                           
                           .
                        

The thesis follows easily from Definition 7 and from Theorem 1.  □


                     
                        Theorem 2
                        Strong adaptability checking


                        
                           Consider an 
                           
                              S
                              [
                              B
                              ]
                            
                           system. Given a B state q and an S state r such that 
                           
                              q
                              ⊨
                              L
                              (
                              r
                              )
                           
                           , then q is strongly adaptable to r if and only if the strong adaptation CTL formula (Eq. 
                           
                              (6.2)
                           
                           ) is true in 
                           
                              K
                              (
                              S
                              [
                              B
                              ]
                              )
                            
                           at state 
                           
                              (
                              q
                              ,
                              r
                              ,
                              ∅
                              )
                           
                           . Formally, given a state 
                           
                              q
                              ∈
                              [
                              [
                              L
                              (
                              r
                              )
                              ]
                              ]
                           
                           
                              
                                 
                                    q
                                    
                                    
                                       
                                          |
                                       
                                       
                                          w
                                       
                                    
                                    
                                    r
                                    ⇔
                                    (
                                    q
                                    ,
                                    r
                                    ,
                                    ∅
                                    )
                                    
                                       
                                          ⊨
                                       
                                       
                                          CTL
                                       
                                    
                                    
                                       AG
                                    
                                    (
                                    (
                                    
                                       adapting
                                    
                                    ⟹
                                    
                                       AF
                                    
                                    
                                    
                                       steady
                                    
                                    )
                                    
                                    ∧
                                    
                                    
                                       progress
                                    
                                    )
                                 
                              
                           
                        

See Appendix A.8  □


                     
                        Corollary 2
                        
                           Consider an 
                           
                              S
                              [
                              B
                              ]
                            
                           system. Then, 
                           
                              S
                              [
                              B
                              ]
                            
                           is strongly adaptable if and only if
                           
                              
                                 
                                    
                                       
                                          t
                                       
                                       
                                          0
                                       
                                    
                                    
                                       
                                          ⊨
                                       
                                       
                                          CTL
                                       
                                    
                                    
                                       AG
                                    
                                    (
                                    (
                                    
                                       adapting
                                    
                                    ⟹
                                    
                                       AF
                                    
                                    
                                    
                                       steady
                                    
                                    )
                                    
                                    ∧
                                    
                                    
                                       progress
                                    
                                    )
                                 
                              
                            
                           where 
                           
                              
                                 
                                    t
                                 
                                 
                                    0
                                 
                              
                            
                           is the initial state of 
                           
                              K
                              (
                              S
                              [
                              B
                              ]
                              )
                           
                           .
                        

As in the weak case, the thesis follows easily from Definition 9 and from Theorem 2.  □

Note that since we assume that the behavioural and the structural state machines are finite state, then the CTL adaptability properties can be model checked. This means that the defined notions of weak and strong adaptability are decidable and that the problem of adaptability checking can be reduced to a classical CTL model checking problem.

CTL model checking has been widely investigated in the literature and relies on efficient tools like NuSMV [13]. The time computational complexity of the model checking problem for CTL is 
                           O
                           (
                           (
                           n
                           +
                           m
                           )
                           ⋅
                           |
                           ψ
                           |
                           )
                        , where n is the number of states in the Kripke structure, m is the number of transitions and 
                           |
                           ψ
                           |
                         is the length of the formula, i.e. the number of operators in its parse tree.

The well-known problem in this area is the so-called state explosion problem, that is to say the high number of states (and thus transitions) that comes out from even relatively short descriptions of systems composed of concurrent interactive components. It is not in the scope of this work to discuss and refer the high research efforts that are currently going on in this area. A good starting point can be found in [2]. We will just give a brief estimation of the dimension of the state space given a certain 
                           S
                           [
                           B
                           ]
                         system, which is the dominant complexity factor, considering that our formulae for the adaptability checking have constant length 4. The computational complexity of adaptability checking is therefore 
                           O
                           (
                           n
                           +
                           m
                           )
                        .

Note that in our context the usual sources of state explosion (components, concurrency) are “hidden” inside the behavioural level B. This is because we want to work on the very basic model of computation of finite state machines and maintain a black-box view of the behavioural level from the structural level point of view. Thus, we take as the dominant dimension of the problem the “already exploded” number of states of the behavioural level. Then, we estimate what the definition of an 
                           S
                           [
                           B
                           ]
                         model adds up to this explosion.

Recall that the Kripke structure to model check is 
                           K
                           (
                           S
                           [
                           B
                           ]
                           )
                        , derived from the flat semantics 
                           F
                           (
                           S
                           [
                           B
                           ]
                           )
                        . Depending on the dimension of S, the flat semantics could possibly lead to a transition system larger than the state space of the behavioural model B since the states are formally tuples in 
                           Q
                           ×
                           R
                           ×
                           (
                           {
                           (
                           ψ
                           ,
                           
                              
                                 r
                              
                              
                                 ′
                              
                           
                           )
                           |
                           ∃
                           r
                           ∈
                           R
                           .
                           
                           r
                           
                              
                                 
                                    →
                                    ψ
                                 
                              
                              
                                 S
                              
                           
                           
                              
                                 r
                              
                              
                                 ′
                              
                           
                           }
                           ∪
                           {
                           ∅
                           }
                           )
                        . The dimension n of the state space is 
                           O
                           (
                           |
                           Q
                           |
                           ⋅
                           
                              
                                 2
                              
                              
                                 |
                                 Q
                                 |
                              
                           
                           ⋅
                           
                              
                                 2
                              
                              
                                 |
                                 Q
                                 |
                              
                           
                           )
                        , where 
                           |
                           ⋅
                           |
                         is set cardinality, based only on the number of states in the behavioural level and due to the higher order nature of S. However, considering the intended role of the structural level S, the number of S states is never exponential. This is because the different S states represent different modes of operations and, thus, usually stand for disjoint sets of B states. For this reason, a more realistic estimation of the state space dimension n should be expressed w.r.t. both B and S dimensions, yielding a number that is 
                           O
                           (
                           |
                           Q
                           |
                           ⋅
                           |
                           R
                           |
                           ⋅
                           
                              
                                 |
                                 →
                              
                              
                                 S
                              
                           
                           |
                           )
                        .

@&#DISCUSSION AND CONCLUSION@&#

In this work we presented a formal hierarchical model for self-adaptive systems, consisting of a behavioural level and a structural level. The B level is a state machine describing the behaviour of the system and the S level is a second-order state machine accounting for the constraints which the system has to comply with. S states identify stable regions that the B level may reach by performing adaptation paths.

The adaptation semantics of the system is given by a flattened transition system that implements the following adaptation model: adaptation starts whenever the current B state does not meet the constraints specified by the current S state. Then, adaptation towards a target S state 
                        
                           
                              r
                           
                           
                              ′
                           
                        
                      ends successfully when the system ends up in a different B state 
                        
                           
                              q
                           
                           
                              ′
                           
                        
                      such that 
                        
                           
                              q
                           
                           
                              ′
                           
                        
                      satisfies the constraints in 
                        
                           
                              r
                           
                           
                              ′
                           
                        
                     .

We tackled the adaptability checking problem by firstly characterising two degrees of adaptability: weak adaptability, for verifying if the system is able to adapt successfully for some adaptation paths; and strong adaptability, for verifying if the system is able to adapt successfully for all possible adaptation paths. Then, we defined weak and strong adaptation as relations over the set of B states and the set of S states, so that adaptability is verified when an appropriate adaptation relation can be built. We also provided a logical formulation of weak and strong adaptability, in terms of CTL formulae. Finally, by proving that the logical characterisation is formally equivalent to the relational one, we demonstrated that the adaptability checking problem can be reduced to a classical model checking problem. We derived the computational complexity of the problem and showed that the state space dimension is polynomial in the dimension of the original 
                        S
                        [
                        B
                        ]
                      system.

The approach has been elucidated through an example of self-adaptive software systems, that is the motion controller of an autonomous transport vehicle. We considered two structural levels with different adaptation invariants, 
                        
                           
                              S
                           
                           
                              0
                           
                        
                      and 
                        
                           
                              S
                           
                           
                              1
                           
                        
                     . Keeping the behavioural model B fixed, we derived the flat semantics of 
                        
                           
                              S
                           
                           
                              0
                           
                        
                        [
                        B
                        ]
                      and 
                        
                           
                              S
                           
                           
                              1
                           
                        
                        [
                        B
                        ]
                      and we compared their adaptation capabilities, showing that the former is strongly adaptable, while the latter is only weakly adaptable.

We report that this work gives a formal computational characterisation of self-adaptive systems, and a novel and well-grounded formulation of the concept of adaptability. We elaborate effective formal methods to investigate and solve the problem of adaptability checking. Provided that 
                        S
                        [
                        B
                        ]
                      systems are based on a general and essential model of computation (state machines), our results are general too and can be easily applied to richer and more expressive models.

Although we have investigated the relationships between two fundamental levels, it is possible to show how our model can easily scale-up to an arbitrary number of levels, arising from the composition of multiple 
                           S
                           [
                           B
                           ]
                         systems. We give an intuition of how a higher order 
                           S
                           [
                           B
                           ]
                         can be defined. In these settings, a first-order 
                           S
                           [
                           B
                           ]
                         system is a “classical” system, as defined in Section 2. For 
                           n
                           >
                           1
                        , an nth-order 
                           S
                           [
                           B
                           ]
                         system is an 
                           S
                           [
                           B
                           ]
                         system 
                           
                              
                                 S
                              
                              
                                 n
                              
                           
                           [
                           
                              
                                 B
                              
                              
                                 n
                              
                           
                           ]
                        , where 
                           
                              
                                 S
                              
                              
                                 n
                              
                           
                           =
                           
                              
                                 (
                                 
                                    
                                       R
                                    
                                    
                                       n
                                    
                                 
                                 ,
                                 
                                    
                                       r
                                    
                                    
                                       0
                                    
                                    
                                       n
                                    
                                 
                                 ,
                                 
                                    
                                       A
                                    
                                    
                                       n
                                    
                                 
                                 ,
                                 
                                    
                                       O
                                    
                                    
                                       n
                                    
                                 
                                 ,
                                 →
                              
                              
                                 S
                              
                              
                                 n
                              
                           
                           ,
                           
                              
                                 L
                              
                              
                                 n
                              
                           
                           )
                         is the structural level; and 
                           
                              
                                 B
                              
                              
                                 n
                              
                           
                           =
                           
                              
                                 ‖
                              
                              
                                 i
                                 ∈
                                 I
                              
                           
                           
                           F
                           (
                           
                              
                                 S
                              
                              
                                 n
                                 −
                                 1
                              
                           
                           
                              
                                 [
                                 
                                    
                                       B
                                    
                                    
                                       n
                                       −
                                       1
                                    
                                 
                                 ]
                              
                              
                                 i
                              
                           
                           )
                         is the behavioural level resulting from the application of a parallel composition operation ‘‖’ to the flattened semantics of a family of 
                           n
                           −
                           1
                           
                              th
                           
                        -order 
                           S
                           [
                           B
                           ]
                         systems, indexed by 
                           i
                           ∈
                           I
                        .

Further, due to the separation between the S and the B levels, modular techniques for adaptability checking could be exploited in our model. Let 
                           
                              
                                 S
                              
                              
                                 1
                              
                           
                           =
                           
                              
                                 (
                                 
                                    
                                       R
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       r
                                    
                                    
                                       
                                          
                                             1
                                          
                                          
                                             0
                                          
                                       
                                    
                                 
                                 ,
                                 
                                    
                                       A
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       O
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 →
                              
                              
                                 
                                    
                                       S
                                    
                                    
                                       1
                                    
                                 
                              
                           
                           ,
                           
                              
                                 L
                              
                              
                                 1
                              
                           
                           )
                         and 
                           
                              
                                 S
                              
                              
                                 2
                              
                           
                           =
                           
                              
                                 (
                                 
                                    
                                       R
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 
                                    
                                       r
                                    
                                    
                                       
                                          
                                             2
                                          
                                          
                                             0
                                          
                                       
                                    
                                 
                                 ,
                                 
                                    
                                       A
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 
                                    
                                       O
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 →
                              
                              
                                 
                                    
                                       S
                                    
                                    
                                       2
                                    
                                 
                              
                           
                           ,
                           
                              
                                 L
                              
                              
                                 2
                              
                           
                           )
                         be two S levels. For instance, we would be interested in showing if the adaptation capabilities of 
                           
                              
                                 S
                              
                              
                                 2
                              
                           
                         are preserved by 
                           
                              
                                 S
                              
                              
                                 1
                              
                           
                        , in the case that 
                           
                              
                                 S
                              
                              
                                 1
                              
                           
                         refines 
                           
                              
                                 S
                              
                              
                                 2
                              
                           
                        , or 
                           
                              
                                 S
                              
                              
                                 1
                              
                           
                           ⪯
                           
                              
                                 S
                              
                              
                                 2
                              
                           
                        . To our purposes we may assume that 
                           
                              
                                 S
                              
                              
                                 1
                              
                           
                           ⪯
                           
                              
                                 S
                              
                              
                                 2
                              
                           
                         iff a suitable simulation relation 
                           R
                           ∈
                           
                              
                                 R
                              
                              
                                 1
                              
                           
                           ×
                           
                              
                                 R
                              
                              
                                 2
                              
                           
                         exists.

The following result would come quite straightforwardly: if 
                           
                              
                                 S
                              
                              
                                 1
                              
                           
                           ⪯
                           
                              
                                 S
                              
                              
                                 2
                              
                           
                        , it can be shown that for every B level, if 
                           
                              
                                 S
                              
                              
                                 2
                              
                           
                           [
                           B
                           ]
                         is strongly adaptable, then 
                           
                              
                                 S
                              
                              
                                 1
                              
                           
                           [
                           B
                           ]
                         is strongly adaptable too, i.e. that refinements at the S level would preserve strong adaptability. On the other hand, refinements do not necessarily preserve weak adaptability when 
                           
                              
                                 S
                              
                              
                                 2
                              
                           
                           [
                           B
                           ]
                         is weakly adaptable but not strongly adaptable. Instead, we cannot make any assumption on the adaptability of 
                           
                              
                                 S
                              
                              
                                 2
                              
                           
                         based just on the adaptability of its refinement 
                           
                              
                                 S
                              
                              
                                 1
                              
                           
                        .

Modular adaptability could be investigated also in the opposite case, i.e. making the S level vary and considering two behavioural levels 
                           
                              
                                 B
                              
                              
                                 1
                              
                           
                         and 
                           
                              
                                 B
                              
                              
                                 2
                              
                           
                         such that 
                           
                              
                                 B
                              
                              
                                 1
                              
                           
                           ⪯
                           
                              
                                 B
                              
                              
                                 2
                              
                           
                        . Intuitively, it can be demonstrated that in this case abstractions at the B level preserve weak adaptation, or alternatively that if 
                           S
                           [
                           
                              
                                 B
                              
                              
                                 1
                              
                           
                           ]
                         is weakly adaptable, then 
                           S
                           [
                           
                              
                                 B
                              
                              
                                 2
                              
                           
                           ]
                         is weakly adaptable too for each structural level S.

We leave the two topics briefly introduced above as future work, where also other features of the 
                           S
                           [
                           B
                           ]
                         model can be developed.

@&#RELATED WORK@&#

Let us now characterise our approach according to the “taxonomy of self-adaptation”, a quite general software-oriented classification proposed by Salehie and Tahvildari [43]. Specifically, the features of the taxonomy considered here are adaptation type, or how adaptation is realised; temporal issues, related to when the system needs to change and to be monitored to achieve adaptation; and interaction aspects.


                        Interaction. In the 
                           S
                           [
                           B
                           ]
                         model communication and interactions of the adaptive system with other systems are not explicitly taken into account. This is because we focus on studying the adaptation capabilities of a fundamental model of computation, to which more powerful and expressive models can typically be reduced. Indeed, we always consider the behavioural level B as the transitional semantics of a system constructed from several interacting components.


                        Temporal characteristics. Recalling the introductory description of the adaptation semantics, adaptation starts as late as possible, only when no other evolution is possible that fulfils the current constraints; and adaptation ends as soon as possible, i.e. as soon as a target state can be reached. This implies that 
                           S
                           [
                           B
                           ]
                         systems support a basic type of proactive (i.e. anticipatory) adaptation, which ensures that the system reaches a state where structural constraints or adaptation invariants are not met if and only if no other evolution is possible.

The choice to exclude adaptations starting from states that can progress normally, i.e. without violating the constraints, is motivated by the same definition of adaptation: a mutation in an individual that leads to a higher level of fitness. Indeed, as stated in [6], an adaptive system “…seeks to configure its structure with the overall aim of adaptation to the environment trying to optimise its function (i.e., to maximise its fit) to meet its reason of existence”. Our model provides just a qualitative characterisation of the fitness of a B state 
                           
                              
                                 q
                              
                              
                                 ¯
                              
                           
                         in a S state 
                           
                              
                                 r
                              
                              
                                 ¯
                              
                           
                        , given by the satisfaction value (true or false) of the constraints. Therefore, no adaptations can start from the state 
                           
                              
                                 q
                              
                              
                                 ¯
                              
                           
                         if it can satisfy the constraints in 
                           
                              
                                 r
                              
                              
                                 ¯
                              
                           
                         during its evolution, since this configuration corresponds to the highest possible fitness, and any adaptation would produce equal (in case of successful adaptation) or lower (unsuccessful adaptation) fitness values. Nevertheless according to this semantics, the system cannot prevent an unsuccessful adaptation to occur by starting adaptation earlier, i.e. at a state admitting successors that are in the current steady region.


                        Adaptation type. This feature concerns aspects related to the implementation of adaptation mechanisms. According to the taxonomy above, our approach falls into the definitions of model-based adaptation, i.e. based on a model of the system and of the environment; and of close adaptation, in the sense that the system has only a fixed number of adaptive actions, due to the fact that we focus on models with finite and fixed state space. On the contrary, open-adaptive systems support the runtime addition of adaptation actions. Salehie and Tahvildari also distinguish between external and internal adaptation. 
                           S
                           [
                           B
                           ]
                         systems belong to the former type, where the adaptation logic (S level) and the application logic (B level) are separated. In internal adaptation, conversely, adaptation mechanisms are mixed at the application level.

Taking a broader view that generalises from software systems, Sagasti [42] distinguishes between two different adaptive behaviours: the system adapts by modifying itself (Darwinian adaptation); or it adapts by modifying its environment (Singerian adaptation). In this work, we clearly focus on the former type of adaptation. Following this line, the adaptation type of 
                           S
                           [
                           B
                           ]
                         systems can be further classified as a top-down and behavioural adaptation. Top-down, because the S level imposes high-level functions (e.g. constraints, rules and policies) on the lower B level, which adapts itself whenever it cannot fulfil the current constraints. Bottom-up adaptation represents the opposite direction, occurring for instance when new higher-level patterns emerge from the lower level. On the other hand, behavioural adaptation is related to functional changes, like changing the program code or following different trajectories in the state space. In literature, it is generally opposed to structural adaptation, which is related to architectural reconfiguration, e.g. addition, migration and removal of components. Note that structural and behavioural adaptation must not be confused with the structural and the behavioural level of an 
                           S
                           [
                           B
                           ]
                         system.


                        Behavioural adaptation. Zhang et al. give a general state-based model of self-adaptive programs, where the adaptation process is seen as a transition between different non-adaptive regions in the state space of the program [46]. In order to verify the correctness of adaptation they define a logic called A-LTL (an adapt-operator extension to LTL) and model-checking algorithms [47] for verifying adaptation requirements. Similarly, in 
                           S
                           [
                           B
                           ]
                         systems adaptation can be seen as a transition in the S level between two steady regions (the S states), which corresponds to performing a path at the B level. However, in our model the steady-state regions are represented in a more declarative way using constraints associated to the states of the S level. Adaptation of the B level is not necessarily instantaneous and during this phase the system is left unconstrained but an invariant condition that is required to be met during adaptation. Differently to [46], the invariants are specific for every adaptation transition making this process controllable in a finer way.

PobSAM [30,31] is another formal model for self-adaptive systems, where actors expressed in Rebeca are governed by managers that enforce dynamic policies (described in an algebraic language) according to which actors adapt their behaviour. Different adaptation modes allow to handle events occurring during adaptation and ensuring that managers switch to a new configuration only once the system reaches a safe state. Similarly to our structural and behavioural levels, the structure of a PobSAM model is built on multiple levels: the level of managed actors, the levels of autonomous managers and a view level, which acts as a sort of observation function over the state variables of the actors. Further, a recently published extension of PobSAM called HPobSAM [29], enables the hierarchical refinement of managed components. On the other hand, 
                           S
                           [
                           B
                           ]
                         systems are based on the general formalism of state machines and enjoy the property that higher levels lead to higher-order structures: indeed, the S level can be interpreted as a second-order B level, since an S state identifies a set of stable B states and firing an S transition means performing an adaptation path, i.e. a sequence of B transitions.

In the position paper by Bruni et al. [10], adaptation is defined as the run-time modification of the control data of a system and this approach is instantiated into a formal model based on labelled transition systems. They consider a system S that is embedded in some environment 
                           E
                         and that has to fulfil a goal ψ. When the environment and the goal are fixed, the system S is such that:
                           
                              
                                 E
                                 [
                                 S
                                 ]
                                 ⊨
                                 ψ
                                 ,
                              
                           
                         where 
                           E
                           [
                           S
                           ]
                         can be alternatively expressed as the parallel composition 
                           E
                           ‖
                           S
                        . However, S may operate under run-time modifications in the environment and goal. Thus, when the environment 
                           E
                         changes into 
                           
                              
                                 E
                              
                              
                                 ′
                              
                           
                         and the goal ψ into 
                           
                              
                                 ψ
                              
                              
                                 ′
                              
                           
                        , S adapts itself into 
                           
                              
                                 S
                              
                              
                                 ′
                              
                           
                         such that:
                           
                              
                                 
                                    
                                       E
                                    
                                    
                                       ′
                                    
                                 
                                 [
                                 
                                    
                                       S
                                    
                                    
                                       ′
                                    
                                 
                                 ]
                                 ⊨
                                 
                                    
                                       ψ
                                    
                                    
                                       ′
                                    
                                 
                                 .
                              
                           
                         As shown in [22], the problem of finding such an 
                           
                              
                                 S
                              
                              
                                 ′
                              
                           
                         can be formulated as an LTS control problem. Similarly, in our context we can see an 
                           S
                           [
                           B
                           ]
                         system as a behavioural model B embedded in a structure S. Let 
                           
                              
                                 
                                    
                                       r
                                    
                                    
                                       ¯
                                    
                                 
                              
                              
                                 S
                              
                           
                           [
                           
                              
                                 
                                    
                                       q
                                    
                                    
                                       ¯
                                    
                                 
                              
                              
                                 B
                              
                           
                           ]
                         denote the current state of the 
                           S
                           [
                           B
                           ]
                         system. Then,
                           
                              
                                 〈
                                 S
                                 [
                                 B
                                 ]
                                 ,
                                 
                                    
                                       
                                          
                                             r
                                          
                                          
                                             ¯
                                          
                                       
                                    
                                    
                                       S
                                    
                                 
                                 [
                                 
                                    
                                       
                                          
                                             q
                                          
                                          
                                             ¯
                                          
                                       
                                    
                                    
                                       B
                                    
                                 
                                 ]
                                 〉
                                 ⊨
                                 
                                    
                                       ψ
                                    
                                    
                                       S
                                       [
                                       B
                                       ]
                                    
                                 
                                 ,
                              
                           
                         where 
                           
                              
                                 ψ
                              
                              
                                 S
                                 [
                                 B
                                 ]
                              
                           
                           ≡
                           
                              
                                 
                                    
                                       q
                                    
                                    
                                       ¯
                                    
                                 
                              
                              
                                 B
                              
                           
                           ∈
                           L
                           (
                           
                              
                                 
                                    
                                       r
                                    
                                    
                                       ¯
                                    
                                 
                              
                              
                                 S
                              
                           
                           )
                        , i.e. the current B state must meet the constraints imposed by the current S state. Therefore, the structural level S not only acts as the operating environment for B, but also encodes the goal ψ, which requires that B has to move within the stable region identified by the constraints in the current S state. We can imagine that whenever ψ is no longer satisfied, adaptation produces a system 
                           
                              
                                 S
                              
                              
                                 ′
                              
                           
                           [
                           
                              
                                 B
                              
                              
                                 ′
                              
                           
                           ]
                         from the current system 
                           S
                           [
                           B
                           ]
                        , in a way that
                           
                              
                                 〈
                                 
                                    
                                       S
                                    
                                    
                                       ′
                                    
                                 
                                 [
                                 
                                    
                                       B
                                    
                                    
                                       ′
                                    
                                 
                                 ]
                                 ,
                                 
                                    
                                       
                                          
                                             r
                                          
                                          
                                             ¯
                                          
                                       
                                    
                                    
                                       
                                          
                                             S
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 
                                 [
                                 
                                    
                                       
                                          
                                             q
                                          
                                          
                                             ¯
                                          
                                       
                                    
                                    
                                       
                                          
                                             B
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 
                                 ]
                                 〉
                                 ⊨
                                 
                                    
                                       ψ
                                    
                                    
                                       
                                          
                                             S
                                          
                                          
                                             ′
                                          
                                       
                                       [
                                       
                                          
                                             B
                                          
                                          
                                             ′
                                          
                                       
                                       ]
                                    
                                 
                                 .
                              
                           
                         In our settings, the control data component is not explicitly implemented and there are no transitions that can be directly controlled, but due to the top-down adaptation semantics, the S level provides some kind of control mechanism on B. Indeed, during the steady phase, S forbids any transition to a B state that violates the current constraints if there is at least one transition to a state satisfying them. Instead, when adaptation starts, we can think that S outputs to B a list of target S states, so directing the evolution of B towards a set of possible goals and excluding those transitions that lead to states violating the adaptation invariant.

The adaptation as control data modification view of [10] is implemented also in the formalism of Adaptable Interface Automata (aias) [9], which extends Interface Automata [20] with state-labelling atomic propositions, a subset of which—the control propositions—models the control data. Adaptation occurs in correspondence of transitions that change the control propositions, and actions labelling such transitions are called control actions. Similarly to our 
                           S
                           [
                           B
                           ]
                         systems, an adaptation phase is thus a sequence of adaptation transitions. Let 
                           
                              
                                 A
                              
                              
                                 C
                              
                           
                           ,
                           
                              
                                 A
                              
                              
                                 I
                              
                           
                           ,
                           
                              
                                 A
                              
                              
                                 O
                              
                           
                         denote the set of control actions and the sets of input and output actions of the underlying interface automaton, respectively. On top of these actions, the authors provides different characterisations of an aia 
                        P: P is adaptable when 
                           
                              
                                 A
                              
                              
                                 C
                              
                           
                           ≠
                           ∅
                        ; P is controllable when 
                           
                              
                                 A
                              
                              
                                 C
                              
                           
                           ∩
                           
                              
                                 A
                              
                              
                                 I
                              
                           
                           ≠
                           ∅
                        ; and P is self-adaptive when 
                           
                              
                                 A
                              
                              
                                 C
                              
                           
                           ∩
                           
                              
                                 A
                              
                              
                                 O
                              
                           
                           ≠
                           ∅
                        . Given an aia 
                        P, adaptability properties are defined as those that are satisfied by P, but are not satisfied if control actions are removed, i.e. by the aia 
                        
                           
                              
                                 P
                              
                              
                                 |
                                 A
                                 ∖
                                 
                                    
                                       A
                                    
                                    
                                       C
                                    
                                 
                              
                           
                        . In addition, the authors show how our notions of weak and strong adaptability can be encoded in their framework.

Theorem-proving techniques have also been used for assessing the correctness of adaptation: in [34] a proof lattice called transitional invariant lattice is built to verify that an adaptive program satisfies global invariants before and after adaptation. In particular it is proved that if it is possible to build that lattice, then adaptation is correct. Instead, in our model the notion of correctness of adaptation is formalised by means of the weak and strong adaptability relations, that can be alternatively expressed as CTL formulae, thus reducing the problem of adaptability checking to a classical model checking problem.

Furthermore, in [45], the authors define a spatial and chemical-inspired tuple-space model in the context of distributed pervasive services. They show that equipping the classical tuple-space model with reaction and diffusion rules makes possible to support features like adaptivity and competition among services, by implementing Lotka–Volterra-like rules. Similarly, 
                           S
                           [
                           B
                           ]
                         systems are inspired by complex natural systems, where the dichotomy between the behavioural level and the structural level may represent for instance the genotype and the phenotype level of an organism, respectively; or, by using the metaphor of multiscale systems, the B level can be used to model the system at the micro-scale (e.g. cellular scale), while the S level would represent the emergent macro-scale features (e.g. the tissue). However, our model is not quantitative and is not based on a coordination model, but on a simple and general model of computation (state machines). Moreover, adaptation is not the result of nature-inspired rules, but is rigorously defined from the B and the S level by operational semantics rules.


                        Structural adaptation. Our model currently supports only behavioural adaptation, but several approaches have been recently defined also in the context of structural adaptation, most of them relying on dynamic software architectures. In [7], several formal techniques for specifying self-managing architectures, i.e. able to support autonomous run-time architectural changes, are surveyed and compared.

An important line of research focuses on the application of graph-based methods, initiated by Le Métayer's work [36] where architectural styles are captured by graph grammars and graph rewriting rules are used to enable architectural reconfiguration. Other relevant literature in this field includes the Architectural Design Rewriting (ADR) framework [11], in which an architectural style is described as an algebra over typed graphs (i.e. the architectures), whose operators correspond to term-rewriting rules. ADR supports the well-formed compositions of architectures, the hierarchical specification of styles, style checking and style-preserving reconfiguration. A method for selecting which rules to apply for maintaining a particular architectural style against unexpected run-time reconfigurations is proposed in [41], where the authors extend ADR rules with pre- and post-conditions, representing invariants to be met by an architecture before and after the application of a rule. Tool support is discussed in [8], where the authors provide an in-depth comparison between the implementations of typed graph grammars in Alloy [27] and of ADR in Maude [18].

Moreover, in [5], an approach for verifying safety properties in structurally adapting multi-agent systems is presented. By modelling a system as a graph and its evolution by graph transformation rules, safety properties are verified by means of structural invariants, i.e. a set of forbidden graph patterns.


                        Hierarchical and multi-level methods. Besides 
                           S
                           [
                           B
                           ]
                         systems, multi-level approaches have been extensively used for the modelling of self-adaptive software systems. For instance, in [19] Corradini et al. identify and formally relate three different levels: the requirement level, dealing with high-level properties and goals; the architectural level, focusing on the component structure and interactions between components; and the functional level, accounting for the behaviour of a single component.

Furthermore, Kramer and Magee [32] define a three-level architecture for self-managed systems consisting of a component control level that implements the functional behaviour of the system by means of interconnected components; a change management level responsible for changing the lower component architecture according to the current status and objectives; and a goal management level that modifies the lower change management plans according to high-level goals.

Hierarchical finite state machines, in particular Statecharts [26] have also been employed to describe the multiple architectural levels in self-adaptive software systems (see e.g. [28,44]).

Relevant applications of multi-level approaches include the work by Zhao et al. [48], where the authors present a two-level model for self-adaptive systems consisting of a functional behavioural level—accounting for the application logic and modelled as state machines—and an adaptation level, accounting for the adaptation logic and represented with a mode automaton [37]. In this case, each mode in the adaptation level is associated with different functional state machines and adaptation is seen as a change of mode. Adaptation properties are described and checked by means of a mode-based extension of LTL called mLTL.

Another accepted fact is that higher levels in complex adaptive systems lead to higher-order structures. Here the higher S level is described by means of a second order state machine (i.e. a state machine over the power set of the B states). Similar notions have been formalised by Baas [1] with the hyperstructures framework for multi-level and higher-order dynamical systems; and by Ehresmann and Vanbremeersch with their memory evolutive systems 
                        [23], a model for hierarchical autonomous systems based on category theory.

There are several other works worth mentioning, but here we do not aim at presenting an exhaustive state-of-the-art in this widening research field. We address the interested reader to the surveys [12,43] for a general introduction to the essential aspects and challenges in the modelling of self-adaptive software systems.

@&#ACKNOWLEDGEMENTS@&#

The authors want to thank the anonymous reviewers for their valuable suggestions and prof. Mario Rasetti for the continuous inspiration and the useful discussions about the topics of this work and its general context. This work was supported by the project “TOPDRIM: Topology Driven Methods for Complex Systems” funded by the European Commission (EU-FP7 ICT FET Proactive—Grant Agreement N. 318121).


                        
                           Proof
                           
                              
                                 
                                    
                                       (i + ii)
                                    
                                    Both the couples of rules Steady + AdaptStart and Steady + AdaptStartEnd ensure that there cannot exist a non-adapting state with both an outgoing non-adapting transition 
                                          
                                             →
                                             r
                                          
                                        and an outgoing adapting transition 
                                          
                                             →
                                             
                                                r
                                                ,
                                                ψ
                                                ,
                                                
                                                   
                                                      r
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                       . Indeed, the premises of the two rules, in both cases, are mutually exclusive by the fact that 
                                          
                                             
                                                (
                                                q
                                                →
                                             
                                             
                                                B
                                             
                                          
                                          
                                             
                                                q
                                             
                                             
                                                ′
                                             
                                          
                                          ∧
                                          
                                             
                                                q
                                             
                                             
                                                ′
                                             
                                          
                                          ⊨
                                          L
                                          (
                                          r
                                          )
                                          )
                                        is the negation of 
                                          ∀
                                          
                                             
                                                q
                                             
                                             
                                                ″
                                             
                                          
                                          .
                                          
                                             
                                                (
                                                q
                                                →
                                             
                                             
                                                B
                                             
                                          
                                          
                                             
                                                q
                                             
                                             
                                                ″
                                             
                                          
                                          ⟹
                                          
                                             
                                                q
                                             
                                             
                                                ″
                                             
                                          
                                          ⊭
                                          L
                                          (
                                          r
                                          )
                                          )
                                       .

Rules Adapt and AdaptEnd are the only ones producing an outgoing transition from an adapting state and none of them produces an r-labelled transition.


                                       
                                          (
                                          i
                                          )
                                          ∧
                                          (
                                          
                                             ii
                                          
                                          )
                                          ∧
                                          (
                                          
                                             iii
                                          
                                          )
                                          ⟹
                                          (
                                          
                                             iv
                                          
                                          )
                                       .

Rule Adapt ensures that an adaptation transition is taken only if there are no other transitions that directly lead to the target S state. Indeed Adapt and AdaptEnd are mutually exclusive, thus avoiding adaptation steps to be taken when adaptation can end. This also holds for the successful adaptation paths (of length 1) obtained with the rule AdaptStartEnd, whose premises are not compatible with those of rule Adapt.

Let π be a generic infinite path of 
                                          F
                                          (
                                          S
                                          [
                                          B
                                          ]
                                          )
                                        starting at a state 
                                          (
                                          q
                                          ,
                                          r
                                          ,
                                          ∅
                                          )
                                       . Let 
                                          i
                                          ≥
                                          0
                                        be a generic position in π, denoted 
                                          π
                                          [
                                          i
                                          ]
                                       , such that 
                                          π
                                          [
                                          i
                                          ]
                                          =
                                          (
                                          
                                             
                                                q
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          
                                             
                                                r
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          ∅
                                          )
                                       . Then, by properties (i)–(iv), there are only the following cases:
                                          
                                             1.
                                             
                                                
                                                   
                                                , i.e. the path stops at position 
                                                   π
                                                   [
                                                   i
                                                   ]
                                                   =
                                                   (
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ,
                                                   ∅
                                                   )
                                                ; this contradicts the fact that π is infinite, thus this case never occurs along π;


                                                
                                                   (
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ,
                                                   ∅
                                                   )
                                                   
                                                      →
                                                      
                                                         
                                                            r
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                   
                                                   (
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         i
                                                         +
                                                         1
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         i
                                                         +
                                                         1
                                                      
                                                   
                                                   ,
                                                   ∅
                                                   )
                                                ; rule Steady was applied in the derivation of π;


                                                
                                                   (
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ,
                                                   ∅
                                                   )
                                                   
                                                      →
                                                      
                                                         
                                                            
                                                               r
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                         ,
                                                         ψ
                                                         ,
                                                         
                                                            
                                                               r
                                                            
                                                            
                                                               ′
                                                            
                                                         
                                                      
                                                   
                                                   (
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         i
                                                         +
                                                         1
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         i
                                                         +
                                                         1
                                                      
                                                   
                                                   ,
                                                   ∅
                                                   )
                                                ; rule AdaptStartEnd was applied in the derivation of π;


                                                
                                                   (
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ,
                                                   ∅
                                                   )
                                                   
                                                      →
                                                      
                                                         
                                                            
                                                               r
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                         ,
                                                         
                                                            
                                                               ψ
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                         ,
                                                         
                                                            
                                                               r
                                                            
                                                            
                                                               i
                                                               +
                                                               1
                                                            
                                                         
                                                      
                                                   
                                                   (
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         i
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ,
                                                   {
                                                   (
                                                   
                                                      
                                                         ψ
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         i
                                                         +
                                                         1
                                                      
                                                   
                                                   )
                                                   }
                                                   )
                                                ; rule AdaptStart was applied in the derivation of π; at this point only the two mutually exclusive rules Adapt and AdaptEnd could be applied in the subsequent derivation of π, yielding only two possible sub-cases:
                                                   
                                                      (a)
                                                      the derivation of π continues by zero or more applications of rule Adapt followed by one application of rule AdaptEnd, i.e. 
                                                            (
                                                            
                                                               
                                                                  q
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            ,
                                                            
                                                               
                                                                  r
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            ,
                                                            ∅
                                                            )
                                                            
                                                               
                                                                  (
                                                                  
                                                                     →
                                                                     
                                                                        
                                                                           
                                                                              r
                                                                           
                                                                           
                                                                              i
                                                                           
                                                                        
                                                                        ,
                                                                        
                                                                           
                                                                              ψ
                                                                           
                                                                           
                                                                              i
                                                                           
                                                                        
                                                                        ,
                                                                        
                                                                           
                                                                              r
                                                                           
                                                                           
                                                                              i
                                                                              +
                                                                              1
                                                                           
                                                                        
                                                                     
                                                                  
                                                                  )
                                                               
                                                               
                                                                  
                                                                     
                                                                        n
                                                                     
                                                                     
                                                                        i
                                                                     
                                                                  
                                                               
                                                            
                                                            (
                                                            
                                                               
                                                                  q
                                                               
                                                               
                                                                  i
                                                                  +
                                                                  1
                                                               
                                                            
                                                            ,
                                                            
                                                               
                                                                  r
                                                               
                                                               
                                                                  i
                                                                  +
                                                                  1
                                                               
                                                            
                                                            ,
                                                            ∅
                                                            )
                                                          for some 
                                                            
                                                               
                                                                  n
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            >
                                                            0
                                                         ;

the derivation of π continues with infinite applications of rule Adapt, i.e.
                                                            
                                                               
                                                                  
                                                                     
                                                                        
                                                                           (
                                                                           
                                                                              
                                                                                 q
                                                                              
                                                                              
                                                                                 i
                                                                              
                                                                           
                                                                           ,
                                                                           
                                                                              
                                                                                 r
                                                                              
                                                                              
                                                                                 i
                                                                              
                                                                           
                                                                           ,
                                                                           ∅
                                                                           )
                                                                           
                                                                              →
                                                                              
                                                                                 
                                                                                    
                                                                                       r
                                                                                    
                                                                                    
                                                                                       i
                                                                                    
                                                                                 
                                                                                 ,
                                                                                 
                                                                                    
                                                                                       ψ
                                                                                    
                                                                                    
                                                                                       i
                                                                                    
                                                                                 
                                                                                 ,
                                                                                 
                                                                                    
                                                                                       r
                                                                                    
                                                                                    
                                                                                       i
                                                                                       +
                                                                                       1
                                                                                    
                                                                                 
                                                                              
                                                                           
                                                                           (
                                                                           
                                                                              
                                                                                 q
                                                                              
                                                                              
                                                                                 i
                                                                              
                                                                              
                                                                                 ′
                                                                              
                                                                           
                                                                           ,
                                                                           
                                                                              
                                                                                 r
                                                                              
                                                                              
                                                                                 i
                                                                              
                                                                           
                                                                           ,
                                                                           {
                                                                           
                                                                              
                                                                                 ψ
                                                                              
                                                                              
                                                                                 i
                                                                              
                                                                           
                                                                           ,
                                                                           
                                                                              
                                                                                 r
                                                                              
                                                                              
                                                                                 i
                                                                                 +
                                                                                 1
                                                                              
                                                                           
                                                                           }
                                                                           )
                                                                        
                                                                     
                                                                     
                                                                        
                                                                           
                                                                              (
                                                                              
                                                                                 
                                                                                    q
                                                                                 
                                                                                 
                                                                                    i
                                                                                 
                                                                              
                                                                              ,
                                                                              
                                                                                 
                                                                                    r
                                                                                 
                                                                                 
                                                                                    i
                                                                                 
                                                                              
                                                                              ,
                                                                              ∅
                                                                              )
                                                                           
                                                                           
                                                                              →
                                                                              
                                                                                 
                                                                                    
                                                                                       r
                                                                                    
                                                                                    
                                                                                       i
                                                                                    
                                                                                 
                                                                                 ,
                                                                                 
                                                                                    
                                                                                       ψ
                                                                                    
                                                                                    
                                                                                       i
                                                                                    
                                                                                 
                                                                                 ,
                                                                                 
                                                                                    
                                                                                       r
                                                                                    
                                                                                    
                                                                                       i
                                                                                       +
                                                                                       1
                                                                                    
                                                                                 
                                                                              
                                                                           
                                                                           (
                                                                           
                                                                              
                                                                                 q
                                                                              
                                                                              
                                                                                 i
                                                                              
                                                                              
                                                                                 ″
                                                                              
                                                                           
                                                                           ,
                                                                           
                                                                              
                                                                                 r
                                                                              
                                                                              
                                                                                 i
                                                                              
                                                                           
                                                                           ,
                                                                           {
                                                                           
                                                                              
                                                                                 ψ
                                                                              
                                                                              
                                                                                 i
                                                                              
                                                                           
                                                                           ,
                                                                           
                                                                              
                                                                                 r
                                                                              
                                                                              
                                                                                 i
                                                                                 +
                                                                                 1
                                                                              
                                                                           
                                                                           }
                                                                           )
                                                                        
                                                                     
                                                                     
                                                                        
                                                                           
                                                                              (
                                                                              
                                                                                 
                                                                                    q
                                                                                 
                                                                                 
                                                                                    i
                                                                                 
                                                                              
                                                                              ,
                                                                              
                                                                                 
                                                                                    r
                                                                                 
                                                                                 
                                                                                    i
                                                                                 
                                                                              
                                                                              ,
                                                                              ∅
                                                                              )
                                                                           
                                                                           
                                                                              →
                                                                              
                                                                                 
                                                                                    
                                                                                       r
                                                                                    
                                                                                    
                                                                                       i
                                                                                    
                                                                                 
                                                                                 ,
                                                                                 
                                                                                    
                                                                                       ψ
                                                                                    
                                                                                    
                                                                                       i
                                                                                    
                                                                                 
                                                                                 ,
                                                                                 
                                                                                    
                                                                                       r
                                                                                    
                                                                                    
                                                                                       i
                                                                                       +
                                                                                       1
                                                                                    
                                                                                 
                                                                              
                                                                           
                                                                           ⋯
                                                                        
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                      

By property (vi) it follows that the positions i in which 
                                          π
                                          [
                                          i
                                          ]
                                          =
                                          (
                                          
                                             
                                                q
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          
                                             
                                                r
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          ∅
                                          )
                                        are those and only those in which the 
                                          S
                                          [
                                          B
                                          ]
                                        system is in a steady state, i.e. it is either the first state 
                                          
                                             
                                                f
                                             
                                             
                                                0
                                             
                                          
                                        in which by definition it holds 
                                          
                                             
                                                q
                                             
                                             
                                                0
                                             
                                          
                                          ⊨
                                          L
                                          (
                                          
                                             
                                                r
                                             
                                             
                                                0
                                             
                                          
                                          )
                                       , or it has been reached by using Rules Steady, AdaptEnd or StartAdaptEnd, which all explicitly check that 
                                          
                                             
                                                q
                                             
                                             
                                                i
                                             
                                          
                                          ⊨
                                          L
                                          (
                                          
                                             
                                                r
                                             
                                             
                                                i
                                             
                                          
                                          )
                                       .


                        
                           Proof
                           If 
                                 (
                                 q
                                 ,
                                 r
                                 )
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       1
                                    
                                 
                                 ∪
                                 
                                    
                                       R
                                    
                                    
                                       2
                                    
                                 
                               then 
                                 (
                                 q
                                 ,
                                 r
                                 )
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       1
                                    
                                 
                               or 
                                 (
                                 q
                                 ,
                                 r
                                 )
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       2
                                    
                                 
                              . Then it is possible to trivially verify all the conditions on 
                                 (
                                 q
                                 ,
                                 r
                                 )
                               of Definition 7 using the same proofs already available for 
                                 
                                    
                                       R
                                    
                                    
                                       1
                                    
                                 
                               and 
                                 
                                    
                                       R
                                    
                                    
                                       2
                                    
                                 
                              , respectively, by substituting, in these proofs, 
                                 
                                    
                                       R
                                    
                                    
                                       1
                                    
                                 
                               and 
                                 
                                    
                                       R
                                    
                                    
                                       2
                                    
                                 
                               with 
                                 
                                    
                                       R
                                    
                                    
                                       1
                                    
                                 
                                 ∪
                                 
                                    
                                       R
                                    
                                    
                                       2
                                    
                                 
                              .  □


                        
                           Proof
                           If the path exists then, by property (vi) of Proposition 1, its form is of kind (1) or of kind (2). We show the existence of a path of kind (1), which equals to the one of the thesis. Moreover, we have to show that the weak adaptability propagates along the path, i.e. 
                                 ∀
                                 i
                                 ≥
                                 0
                                 
                                 .
                                 
                                 
                                    
                                       q
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       |
                                    
                                    
                                       w
                                    
                                 
                                 
                                    
                                       r
                                    
                                    
                                       i
                                    
                                 
                              . We use induction to construct the infinite path of the right kind and to show the propagation. When 
                                 i
                                 =
                                 0
                              , from 
                                 (
                                 
                                    
                                       q
                                    
                                    
                                       0
                                    
                                 
                                 =
                                 q
                                 ,
                                 
                                    
                                       r
                                    
                                    
                                       0
                                    
                                 
                                 =
                                 r
                                 ,
                                 ∅
                                 )
                               we take the empty path and, by hypothesis, 
                                 
                                    
                                       q
                                    
                                    
                                       0
                                    
                                 
                                 =
                                 q
                                 
                                    
                                       |
                                    
                                    
                                       w
                                    
                                 
                                 
                                    
                                       r
                                    
                                    
                                       0
                                    
                                 
                                 =
                                 r
                              . Moreover, the condition 
                                 
                                    Progress
                                 
                                 (
                                 
                                    
                                       q
                                    
                                    
                                       0
                                    
                                 
                                 ,
                                 
                                    
                                       r
                                    
                                    
                                       0
                                    
                                 
                                 )
                               guarantees that the path can continue. At the generic step 
                                 i
                                 >
                                 0
                               suppose by induction that 
                                 
                                    
                                       q
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       |
                                    
                                    
                                       w
                                    
                                 
                                 
                                    
                                       r
                                    
                                    
                                       i
                                    
                                 
                              . Thus, there exists a weak adaptation relation 
                                 
                                    
                                       R
                                    
                                    
                                       i
                                    
                                 
                               containing 
                                 (
                                 
                                    
                                       q
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       r
                                    
                                    
                                       i
                                    
                                 
                                 )
                              . In addition, the condition 
                                 
                                    Progress
                                 
                                 (
                                 
                                    
                                       q
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       r
                                    
                                    
                                       i
                                    
                                 
                                 )
                               guarantees that the path can continue. This implies the existence of transition(s) 
                                 (
                                 
                                    
                                       q
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       r
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 ∅
                                 )
                                 
                                    
                                       (
                                       
                                          →
                                          
                                             
                                                r
                                             
                                             
                                                i
                                             
                                          
                                       
                                       )
                                    
                                    
                                       
                                          
                                             m
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                                 
                                    
                                       (
                                       
                                          →
                                          
                                             
                                                
                                                   r
                                                
                                                
                                                   i
                                                
                                             
                                             ,
                                             
                                                
                                                   ψ
                                                
                                                
                                                   i
                                                
                                             
                                             ,
                                             
                                                
                                                   r
                                                
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                          
                                       
                                       )
                                    
                                    
                                       
                                          
                                             n
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                                 (
                                 
                                    
                                       q
                                    
                                    
                                       i
                                       +
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       r
                                    
                                    
                                       i
                                       +
                                       1
                                    
                                 
                                 ,
                                 ∅
                                 )
                              . There are two cases:
                                 
                                    •
                                    
                                       
                                          
                                             
                                                m
                                             
                                             
                                                i
                                             
                                          
                                          =
                                          1
                                       . Thus 
                                          (
                                          
                                             
                                                q
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          
                                             
                                                r
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          ∅
                                          )
                                          
                                             →
                                             
                                                
                                                   r
                                                
                                                
                                                   i
                                                
                                             
                                          
                                          (
                                          
                                             
                                                q
                                             
                                             
                                                ′
                                             
                                          
                                          ,
                                          
                                             
                                                r
                                             
                                             
                                                i
                                                +
                                                1
                                             
                                          
                                          =
                                          
                                             
                                                r
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          ∅
                                          )
                                        for some 
                                          
                                             
                                                q
                                             
                                             
                                                ′
                                             
                                          
                                          ∈
                                          B
                                       . According to Definition 7 there is at least one B state 
                                          
                                             
                                                q
                                             
                                             
                                                i
                                                +
                                                1
                                             
                                          
                                        such that 
                                          
                                             
                                                R
                                             
                                             
                                                i
                                             
                                          
                                        contains 
                                          (
                                          
                                             
                                                q
                                             
                                             
                                                i
                                                +
                                                1
                                             
                                          
                                          ,
                                          
                                             
                                                r
                                             
                                             
                                                i
                                                +
                                                1
                                             
                                          
                                          =
                                          
                                             
                                                r
                                             
                                             
                                                i
                                             
                                          
                                          )
                                       . Thus we can choose the transition with target 
                                          (
                                          
                                             
                                                q
                                             
                                             
                                                ′
                                             
                                          
                                          =
                                          
                                             
                                                q
                                             
                                             
                                                i
                                                +
                                                1
                                             
                                          
                                          ,
                                          
                                             
                                                r
                                             
                                             
                                                i
                                                +
                                                1
                                             
                                          
                                          =
                                          
                                             
                                                r
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          ∅
                                          )
                                        and have 
                                          
                                             
                                                q
                                             
                                             
                                                i
                                                +
                                                1
                                             
                                          
                                          
                                             
                                                |
                                             
                                             
                                                w
                                             
                                          
                                          
                                             
                                                r
                                             
                                             
                                                i
                                                +
                                                1
                                             
                                          
                                       .


                                       
                                          
                                             
                                                m
                                             
                                             
                                                i
                                             
                                          
                                          =
                                          0
                                       . Thus 
                                          (
                                          
                                             
                                                q
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          
                                             
                                                r
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          ∅
                                          )
                                          
                                             →
                                             
                                                
                                                   
                                                      r
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ,
                                                
                                                   
                                                      ψ
                                                   
                                                   
                                                      i
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                ,
                                                
                                                   
                                                      r
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                        for some 
                                          
                                             
                                                ψ
                                             
                                             
                                                i
                                             
                                             
                                                ′
                                             
                                          
                                        and 
                                          
                                             
                                                r
                                             
                                             
                                                i
                                                +
                                                1
                                             
                                             
                                                ′
                                             
                                          
                                       . This is a transition leaving from a state 
                                          
                                             
                                                q
                                             
                                             
                                                i
                                             
                                          
                                        that is weak adaptive to 
                                          
                                             
                                                r
                                             
                                             
                                                i
                                             
                                          
                                       . Thus, by the definition of weak adaptation, there exists a state 
                                          (
                                          
                                             
                                                q
                                             
                                             
                                                i
                                                +
                                                1
                                             
                                          
                                          ,
                                          
                                             
                                                r
                                             
                                             
                                                i
                                                +
                                                1
                                             
                                          
                                          ,
                                          ∅
                                          )
                                        such that 
                                          (
                                          
                                             
                                                q
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          
                                             
                                                r
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          ∅
                                          )
                                          
                                             
                                                (
                                                
                                                   →
                                                   
                                                      
                                                         
                                                            r
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            ψ
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      ,
                                                      
                                                         
                                                            r
                                                         
                                                         
                                                            i
                                                            +
                                                            1
                                                         
                                                      
                                                   
                                                
                                                )
                                             
                                             
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      i
                                                   
                                                
                                             
                                          
                                          (
                                          
                                             
                                                q
                                             
                                             
                                                i
                                                +
                                                1
                                             
                                          
                                          ,
                                          
                                             
                                                r
                                             
                                             
                                                i
                                                +
                                                1
                                             
                                          
                                          ,
                                          ∅
                                          )
                                        for some 
                                          
                                             
                                                n
                                             
                                             
                                                i
                                             
                                          
                                          >
                                          0
                                        and 
                                          (
                                          
                                             
                                                q
                                             
                                             
                                                i
                                                +
                                                1
                                             
                                          
                                          ,
                                          
                                             
                                                r
                                             
                                             
                                                i
                                                +
                                                1
                                             
                                          
                                          )
                                          ∈
                                          
                                             
                                                R
                                             
                                             
                                                i
                                             
                                          
                                       , i.e., 
                                          
                                             
                                                q
                                             
                                             
                                                i
                                                +
                                                1
                                             
                                          
                                          
                                             
                                                |
                                             
                                             
                                                w
                                             
                                          
                                          
                                             
                                                r
                                             
                                             
                                                i
                                                +
                                                1
                                             
                                          
                                       . Note that condition (iii) of Definition 7 excludes the possibility that the adaptation path continues forever, which would yield an infinite path of kind (2).


                        
                           Proof
                           Since 
                                 q
                                 
                                    
                                       |
                                    
                                    
                                       s
                                    
                                 
                                 r
                               then there exists a strong adaptation relation 
                                 R
                               such that 
                                 (
                                 q
                                 ,
                                 r
                                 )
                                 ∈
                                 R
                              . We construct a weak adaptation relation 
                                 
                                    
                                       R
                                    
                                    
                                       ′
                                    
                                 
                               containing 
                                 (
                                 q
                                 ,
                                 r
                                 )
                              , hence 
                                 q
                                 
                                    
                                       |
                                    
                                    
                                       w
                                    
                                 
                                 r
                              . At the beginning we put 
                                 (
                                 q
                                 ,
                                 r
                                 )
                               in 
                                 
                                    
                                       R
                                    
                                    
                                       ′
                                    
                                 
                              , then for some transition 
                                 (
                                 q
                                 ,
                                 r
                                 ,
                                 ∅
                                 )
                                 
                                    →
                                    r
                                 
                                 (
                                 
                                    
                                       q
                                    
                                    
                                       ′
                                    
                                 
                                 ,
                                 r
                                 ,
                                 ∅
                                 )
                               we add 
                                 (
                                 q
                                 ,
                                 
                                    
                                       r
                                    
                                    
                                       ′
                                    
                                 
                                 )
                              , which belongs to 
                                 R
                              , also to 
                                 
                                    
                                       R
                                    
                                    
                                       ′
                                    
                                 
                              . If no 
                                 
                                    →
                                    r
                                 
                               transitions are possible then, if 
                                 (
                                 q
                                 ,
                                 r
                                 ,
                                 ∅
                                 )
                                 
                                    →
                                    
                                       r
                                       ,
                                       ψ
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 
                              , since q is strongly adaptable to r, we select one of the surely existing successor states 
                                 (
                                 
                                    
                                       q
                                    
                                    
                                       ′
                                    
                                 
                                 ,
                                 
                                    
                                       r
                                    
                                    
                                       ′
                                    
                                 
                                 ,
                                 ∅
                                 )
                               such that 
                                 (
                                 
                                    
                                       q
                                    
                                    
                                       ′
                                    
                                 
                                 ,
                                 
                                    
                                       r
                                    
                                    
                                       ′
                                    
                                 
                                 )
                                 ∈
                                 R
                               and we add 
                                 (
                                 
                                    
                                       q
                                    
                                    
                                       ′
                                    
                                 
                                 ,
                                 
                                    
                                       r
                                    
                                    
                                       ′
                                    
                                 
                                 )
                               to 
                                 
                                    
                                       R
                                    
                                    
                                       ′
                                    
                                 
                              . Then, we iterate this process for each new pair added in 
                                 
                                    
                                       R
                                    
                                    
                                       ′
                                    
                                 
                              . The process will terminate since the states are finite and the resulting 
                                 
                                    
                                       R
                                    
                                    
                                       ′
                                    
                                 
                               will be, by construction, a weak adaptation relation.  □


                        
                           Proof
                           We construct inductively all possible finite paths from 
                                 (
                                 q
                                 ,
                                 r
                                 ,
                                 ∅
                                 )
                               to any 
                                 (
                                 
                                    
                                       q
                                    
                                    
                                       ′
                                    
                                 
                                 ,
                                 
                                    
                                       r
                                    
                                    
                                       ′
                                    
                                 
                                 ,
                                 ∅
                                 )
                                 ∈
                                 
                                    
                                       Post
                                    
                                    
                                       ⁎
                                    
                                 
                                 (
                                 (
                                 q
                                 ,
                                 r
                                 ,
                                 ∅
                                 )
                                 )
                               showing that they are of the form:
                                 
                                    
                                       
                                          
                                             
                                                π
                                                =
                                                (
                                                q
                                                =
                                                
                                                   
                                                      q
                                                   
                                                   
                                                      0
                                                   
                                                
                                                ,
                                                r
                                                =
                                                
                                                   
                                                      r
                                                   
                                                   
                                                      0
                                                   
                                                
                                                ,
                                                ∅
                                                )
                                                
                                                   
                                                      (
                                                      
                                                         →
                                                         
                                                            
                                                               r
                                                            
                                                            
                                                               0
                                                            
                                                         
                                                      
                                                      )
                                                   
                                                   
                                                      
                                                         
                                                            m
                                                         
                                                         
                                                            0
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      (
                                                      
                                                         →
                                                         
                                                            
                                                               
                                                                  r
                                                               
                                                               
                                                                  0
                                                               
                                                            
                                                            ,
                                                            
                                                               
                                                                  ψ
                                                               
                                                               
                                                                  0
                                                               
                                                            
                                                            ,
                                                            
                                                               
                                                                  r
                                                               
                                                               
                                                                  1
                                                               
                                                            
                                                         
                                                      
                                                      )
                                                   
                                                   
                                                      
                                                         
                                                            n
                                                         
                                                         
                                                            0
                                                         
                                                      
                                                   
                                                
                                                ⋯
                                             
                                          
                                          
                                             
                                                ⋯
                                                (
                                                
                                                   
                                                      q
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ,
                                                
                                                   
                                                      r
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ,
                                                ∅
                                                )
                                                
                                                   
                                                      (
                                                      
                                                         →
                                                         
                                                            
                                                               r
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                      
                                                      )
                                                   
                                                   
                                                      
                                                         
                                                            m
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      (
                                                      
                                                         →
                                                         
                                                            
                                                               
                                                                  r
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            ,
                                                            
                                                               
                                                                  ψ
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            ,
                                                            
                                                               
                                                                  r
                                                               
                                                               
                                                                  i
                                                                  +
                                                                  1
                                                               
                                                            
                                                         
                                                      
                                                      )
                                                   
                                                   
                                                      
                                                         
                                                            n
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                   
                                                
                                                (
                                                
                                                   
                                                      q
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                ,
                                                
                                                   
                                                      r
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                ,
                                                ∅
                                                )
                                                ⋯
                                             
                                          
                                          
                                             
                                                ⋯
                                                (
                                                
                                                   
                                                      q
                                                   
                                                   
                                                      k
                                                   
                                                
                                                =
                                                
                                                   
                                                      q
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                ,
                                                
                                                   
                                                      r
                                                   
                                                   
                                                      k
                                                   
                                                
                                                =
                                                
                                                   
                                                      r
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                ,
                                                ∅
                                                )
                                             
                                          
                                       
                                    
                                 
                               where 
                                 k
                                 ≥
                                 0
                               and for each i, 
                                 0
                                 ≤
                                 i
                                 <
                                 k
                              , either 
                                 
                                    
                                       m
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 1
                                 ∧
                                 
                                    
                                       n
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 0
                               or 
                                 
                                    
                                       m
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 0
                                 ∧
                                 
                                    
                                       n
                                    
                                    
                                       i
                                    
                                 
                                 >
                                 0
                              . By the same induction we also prove that for all 
                                 i
                                 ≤
                                 k
                              , 
                                 
                                    
                                       q
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       |
                                    
                                    
                                       s
                                    
                                 
                                 
                                    
                                       r
                                    
                                    
                                       i
                                    
                                 
                              . If 
                                 k
                                 =
                                 0
                              , then 
                                 
                                    
                                       q
                                    
                                    
                                       0
                                    
                                 
                                 =
                                 q
                               and 
                                 
                                    
                                       r
                                    
                                    
                                       0
                                    
                                 
                                 =
                                 r
                              , thus the thesis is trivially true. When 
                                 k
                                 >
                                 0
                               we assume by induction that we constructed, starting from 
                                 (
                                 q
                                 ,
                                 r
                                 ,
                                 ∅
                                 )
                              , all the possible finite paths, which are all of the form:
                                 
                                    
                                       
                                          
                                             
                                                π
                                                =
                                                (
                                                q
                                                =
                                                
                                                   
                                                      q
                                                   
                                                   
                                                      0
                                                   
                                                
                                                ,
                                                r
                                                =
                                                
                                                   
                                                      r
                                                   
                                                   
                                                      0
                                                   
                                                
                                                ,
                                                ∅
                                                )
                                                
                                                   
                                                      (
                                                      
                                                         →
                                                         
                                                            
                                                               r
                                                            
                                                            
                                                               0
                                                            
                                                         
                                                      
                                                      )
                                                   
                                                   
                                                      
                                                         
                                                            m
                                                         
                                                         
                                                            0
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      (
                                                      
                                                         →
                                                         
                                                            
                                                               
                                                                  r
                                                               
                                                               
                                                                  0
                                                               
                                                            
                                                            ,
                                                            
                                                               
                                                                  ψ
                                                               
                                                               
                                                                  0
                                                               
                                                            
                                                            ,
                                                            
                                                               
                                                                  r
                                                               
                                                               
                                                                  1
                                                               
                                                            
                                                         
                                                      
                                                      )
                                                   
                                                   
                                                      
                                                         
                                                            n
                                                         
                                                         
                                                            0
                                                         
                                                      
                                                   
                                                
                                                ⋯
                                             
                                          
                                          
                                             
                                                ⋯
                                                (
                                                
                                                   
                                                      q
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ,
                                                
                                                   
                                                      r
                                                   
                                                   
                                                      i
                                                   
                                                
                                                ,
                                                ∅
                                                )
                                                
                                                   
                                                      (
                                                      
                                                         →
                                                         
                                                            
                                                               r
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                      
                                                      )
                                                   
                                                   
                                                      
                                                         
                                                            m
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      (
                                                      
                                                         →
                                                         
                                                            
                                                               
                                                                  r
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            ,
                                                            
                                                               
                                                                  ψ
                                                               
                                                               
                                                                  i
                                                               
                                                            
                                                            ,
                                                            
                                                               
                                                                  r
                                                               
                                                               
                                                                  i
                                                                  +
                                                                  1
                                                               
                                                            
                                                         
                                                      
                                                      )
                                                   
                                                   
                                                      
                                                         
                                                            n
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                   
                                                
                                                (
                                                
                                                   
                                                      q
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                ,
                                                
                                                   
                                                      r
                                                   
                                                   
                                                      i
                                                      +
                                                      1
                                                   
                                                
                                                ,
                                                ∅
                                                )
                                                ⋯
                                             
                                          
                                          
                                             
                                                ⋯
                                                (
                                                
                                                   
                                                      q
                                                   
                                                   
                                                      k
                                                      −
                                                      1
                                                   
                                                
                                                ,
                                                
                                                   
                                                      r
                                                   
                                                   
                                                      k
                                                      −
                                                      1
                                                   
                                                
                                                ,
                                                ∅
                                                )
                                             
                                          
                                       
                                    
                                 
                               where for each i, 
                                 0
                                 ≤
                                 i
                                 <
                                 k
                              , either 
                                 
                                    
                                       m
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 1
                                 ∧
                                 
                                    
                                       n
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 0
                               or 
                                 
                                    
                                       m
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 0
                                 ∧
                                 
                                    
                                       n
                                    
                                    
                                       i
                                    
                                 
                                 >
                                 0
                              . Moreover we assume by induction that 
                                 
                                    
                                       q
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       |
                                    
                                    
                                       s
                                    
                                 
                                 
                                    
                                       r
                                    
                                    
                                       i
                                    
                                 
                               for all 
                                 i
                                 ≤
                                 k
                                 −
                                 1
                              . Since 
                                 
                                    
                                       q
                                    
                                    
                                       k
                                       −
                                       1
                                    
                                 
                                 
                                    
                                       |
                                    
                                    
                                       s
                                    
                                 
                                 
                                    
                                       r
                                    
                                    
                                       k
                                       −
                                       1
                                    
                                 
                              , by condition (i) of Definition 9, 
                                 
                                    Progress
                                 
                                 (
                                 
                                    
                                       q
                                    
                                    
                                       k
                                       −
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       r
                                    
                                    
                                       k
                                       −
                                       1
                                    
                                 
                                 )
                               holds. This implies that the paths of the form above cannot stop here. To continue the path from 
                                 (
                                 
                                    
                                       q
                                    
                                    
                                       k
                                       −
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       r
                                    
                                    
                                       k
                                       −
                                       1
                                    
                                 
                                 ,
                                 ∅
                                 )
                               there are only the following possibilities:
                                 
                                    1.
                                    
                                       
                                          (
                                          
                                             
                                                q
                                             
                                             
                                                k
                                                −
                                                1
                                             
                                          
                                          ,
                                          
                                             
                                                r
                                             
                                             
                                                k
                                                −
                                                1
                                             
                                          
                                          ,
                                          ∅
                                          )
                                          
                                             →
                                             
                                                
                                                   r
                                                
                                                
                                                   k
                                                   −
                                                   1
                                                
                                             
                                          
                                          (
                                          
                                             
                                                q
                                             
                                             
                                                k
                                             
                                          
                                          ,
                                          
                                             
                                                r
                                             
                                             
                                                k
                                             
                                          
                                          ,
                                          ∅
                                          )
                                       ; rule Steady can be applied, then 
                                          
                                             
                                                m
                                             
                                             
                                                k
                                                −
                                                1
                                             
                                          
                                          =
                                          1
                                        and 
                                          
                                             
                                                n
                                             
                                             
                                                k
                                                −
                                                1
                                             
                                          
                                          =
                                          0
                                       ; to prove that 
                                          
                                             
                                                q
                                             
                                             
                                                k
                                             
                                          
                                          
                                             
                                                |
                                             
                                             
                                                s
                                             
                                          
                                          
                                             
                                                r
                                             
                                             
                                                k
                                             
                                          
                                        it is sufficient to take the same relation 
                                          R
                                        that exists from the fact that 
                                          
                                             
                                                q
                                             
                                             
                                                k
                                                −
                                                1
                                             
                                          
                                          
                                             
                                                |
                                             
                                             
                                                s
                                             
                                          
                                          
                                             
                                                r
                                             
                                             
                                                k
                                                −
                                                1
                                             
                                          
                                        because condition (ii) of Definition 9 implies that 
                                          
                                             
                                                q
                                             
                                             
                                                k
                                             
                                          
                                          
                                          R
                                          
                                          
                                             
                                                r
                                             
                                             
                                                k
                                             
                                          
                                       ;


                                       
                                          (
                                          
                                             
                                                q
                                             
                                             
                                                k
                                                −
                                                1
                                             
                                          
                                          ,
                                          
                                             
                                                r
                                             
                                             
                                                k
                                                −
                                                1
                                             
                                          
                                          ,
                                          ∅
                                          )
                                          
                                             →
                                             
                                                
                                                   
                                                      r
                                                   
                                                   
                                                      k
                                                      −
                                                      1
                                                   
                                                
                                                ,
                                                ψ
                                                ,
                                                
                                                   
                                                      r
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                          (
                                          
                                             
                                                q
                                             
                                             
                                                k
                                             
                                          
                                          ,
                                          
                                             
                                                r
                                             
                                             
                                                k
                                             
                                          
                                          ,
                                          ∅
                                          )
                                       ; rule AdaptStartEnd can be applied, then 
                                          
                                             
                                                m
                                             
                                             
                                                k
                                                −
                                                1
                                             
                                          
                                          =
                                          0
                                        and 
                                          
                                             
                                                n
                                             
                                             
                                                k
                                                −
                                                1
                                             
                                          
                                          =
                                          1
                                       ; also in this case, to prove that 
                                          
                                             
                                                q
                                             
                                             
                                                k
                                             
                                          
                                          
                                             
                                                |
                                             
                                             
                                                s
                                             
                                          
                                          
                                             
                                                r
                                             
                                             
                                                k
                                             
                                          
                                        it is sufficient to take the same relation 
                                          R
                                        that exists from the fact that 
                                          
                                             
                                                q
                                             
                                             
                                                k
                                                −
                                                1
                                             
                                          
                                          
                                             
                                                |
                                             
                                             
                                                s
                                             
                                          
                                          
                                             
                                                r
                                             
                                             
                                                k
                                                −
                                                1
                                             
                                          
                                        because condition (iii) of Definition 9 implies that 
                                          
                                             
                                                q
                                             
                                             
                                                k
                                             
                                          
                                          
                                          R
                                          
                                          
                                             
                                                r
                                             
                                             
                                                k
                                             
                                          
                                       ;


                                       
                                          (
                                          
                                             
                                                q
                                             
                                             
                                                k
                                                −
                                                1
                                             
                                          
                                          ,
                                          
                                             
                                                r
                                             
                                             
                                                k
                                                −
                                                1
                                             
                                          
                                          ,
                                          ∅
                                          )
                                          
                                             →
                                             
                                                
                                                   
                                                      r
                                                   
                                                   
                                                      k
                                                      −
                                                      1
                                                   
                                                
                                                ,
                                                
                                                   
                                                      ψ
                                                   
                                                   
                                                      k
                                                      −
                                                      1
                                                   
                                                
                                                ,
                                                
                                                   
                                                      r
                                                   
                                                   
                                                      k
                                                   
                                                
                                             
                                          
                                          (
                                          
                                             
                                                q
                                             
                                             
                                                k
                                                −
                                                1
                                             
                                             
                                                ′
                                             
                                          
                                          ,
                                          
                                             
                                                r
                                             
                                             
                                                k
                                                −
                                                1
                                             
                                          
                                          ,
                                          {
                                          (
                                          
                                             
                                                ψ
                                             
                                             
                                                k
                                                −
                                                1
                                             
                                          
                                          ,
                                          
                                             
                                                r
                                             
                                             
                                                k
                                             
                                          
                                          )
                                          }
                                          )
                                       ; rule AdaptStart can be applied; at this point only the two mutually exclusive rules Adapt and AdaptEnd can be applied in the subsequent derivation of the path, yielding only two possible sub-cases:
                                          
                                             (a)
                                             the derivation continues by zero or more applications of rule Adapt followed by one application of rule AdaptEnd, i.e. 
                                                   (
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         k
                                                         −
                                                         1
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         k
                                                         −
                                                         1
                                                      
                                                   
                                                   ,
                                                   ∅
                                                   )
                                                   
                                                      
                                                         (
                                                         
                                                            →
                                                            
                                                               
                                                                  
                                                                     r
                                                                  
                                                                  
                                                                     k
                                                                     −
                                                                     1
                                                                  
                                                               
                                                               ,
                                                               
                                                                  
                                                                     ψ
                                                                  
                                                                  
                                                                     k
                                                                     −
                                                                     1
                                                                  
                                                               
                                                               ,
                                                               
                                                                  
                                                                     r
                                                                  
                                                                  
                                                                     k
                                                                  
                                                               
                                                            
                                                         
                                                         )
                                                      
                                                      
                                                         
                                                            
                                                               n
                                                            
                                                            
                                                               k
                                                               −
                                                               1
                                                            
                                                         
                                                      
                                                   
                                                   (
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         k
                                                      
                                                   
                                                   ,
                                                   ∅
                                                   )
                                                 for some 
                                                   
                                                      
                                                         n
                                                      
                                                      
                                                         k
                                                         −
                                                         1
                                                      
                                                   
                                                   >
                                                   0
                                                ;

the derivation continues with infinite applications of rule Adapt, i.e.
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  (
                                                                  
                                                                     
                                                                        q
                                                                     
                                                                     
                                                                        k
                                                                        −
                                                                        1
                                                                     
                                                                  
                                                                  ,
                                                                  
                                                                     
                                                                        r
                                                                     
                                                                     
                                                                        k
                                                                        −
                                                                        1
                                                                     
                                                                  
                                                                  ,
                                                                  ∅
                                                                  )
                                                                  
                                                                     →
                                                                     
                                                                        
                                                                           
                                                                              r
                                                                           
                                                                           
                                                                              k
                                                                              −
                                                                              1
                                                                           
                                                                        
                                                                        ,
                                                                        
                                                                           
                                                                              ψ
                                                                           
                                                                           
                                                                              k
                                                                              −
                                                                              1
                                                                           
                                                                        
                                                                        ,
                                                                        
                                                                           
                                                                              r
                                                                           
                                                                           
                                                                              k
                                                                           
                                                                        
                                                                     
                                                                  
                                                                  (
                                                                  
                                                                     
                                                                        q
                                                                     
                                                                     
                                                                        k
                                                                        −
                                                                        1
                                                                     
                                                                     
                                                                        ′
                                                                     
                                                                  
                                                                  ,
                                                                  
                                                                     
                                                                        r
                                                                     
                                                                     
                                                                        k
                                                                        −
                                                                        1
                                                                     
                                                                  
                                                                  ,
                                                                  {
                                                                  
                                                                     
                                                                        ψ
                                                                     
                                                                     
                                                                        k
                                                                        −
                                                                        1
                                                                     
                                                                  
                                                                  ,
                                                                  
                                                                     
                                                                        r
                                                                     
                                                                     
                                                                        k
                                                                     
                                                                  
                                                                  }
                                                                  )
                                                               
                                                            
                                                            
                                                               
                                                                  
                                                                     (
                                                                     
                                                                        
                                                                           q
                                                                        
                                                                        
                                                                           k
                                                                           −
                                                                           1
                                                                        
                                                                     
                                                                     ,
                                                                     
                                                                        
                                                                           r
                                                                        
                                                                        
                                                                           k
                                                                           −
                                                                           1
                                                                        
                                                                     
                                                                     ,
                                                                     ∅
                                                                     )
                                                                  
                                                                  
                                                                     →
                                                                     
                                                                        
                                                                           
                                                                              r
                                                                           
                                                                           
                                                                              k
                                                                              −
                                                                              1
                                                                           
                                                                        
                                                                        ,
                                                                        
                                                                           
                                                                              ψ
                                                                           
                                                                           
                                                                              k
                                                                              −
                                                                              1
                                                                           
                                                                        
                                                                        ,
                                                                        
                                                                           
                                                                              r
                                                                           
                                                                           
                                                                              k
                                                                           
                                                                        
                                                                     
                                                                  
                                                                  (
                                                                  
                                                                     
                                                                        q
                                                                     
                                                                     
                                                                        k
                                                                        −
                                                                        1
                                                                     
                                                                     
                                                                        ″
                                                                     
                                                                  
                                                                  ,
                                                                  
                                                                     
                                                                        r
                                                                     
                                                                     
                                                                        k
                                                                        −
                                                                        1
                                                                     
                                                                  
                                                                  ,
                                                                  {
                                                                  
                                                                     
                                                                        ψ
                                                                     
                                                                     
                                                                        k
                                                                        −
                                                                        1
                                                                     
                                                                  
                                                                  ,
                                                                  
                                                                     
                                                                        r
                                                                     
                                                                     
                                                                        k
                                                                     
                                                                  
                                                                  }
                                                                  )
                                                               
                                                            
                                                            
                                                               
                                                                  
                                                                     (
                                                                     
                                                                        
                                                                           q
                                                                        
                                                                        
                                                                           k
                                                                           −
                                                                           1
                                                                        
                                                                     
                                                                     ,
                                                                     
                                                                        
                                                                           r
                                                                        
                                                                        
                                                                           k
                                                                           −
                                                                           1
                                                                        
                                                                     
                                                                     ,
                                                                     ∅
                                                                     )
                                                                  
                                                                  
                                                                     →
                                                                     
                                                                        
                                                                           
                                                                              r
                                                                           
                                                                           
                                                                              k
                                                                              −
                                                                              1
                                                                           
                                                                        
                                                                        ,
                                                                        
                                                                           
                                                                              ψ
                                                                           
                                                                           
                                                                              k
                                                                              −
                                                                              1
                                                                           
                                                                        
                                                                        ,
                                                                        
                                                                           
                                                                              r
                                                                           
                                                                           
                                                                              k
                                                                           
                                                                        
                                                                     
                                                                  
                                                                  ⋯
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                             


                        
                           Proof
                           If 
                                 S
                                 [
                                 B
                                 ]
                               is strongly adaptable then 
                                 
                                    
                                       f
                                    
                                    
                                       0
                                    
                                 
                                 =
                                 (
                                 
                                    
                                       q
                                    
                                    
                                       0
                                    
                                 
                                 ,
                                 
                                    
                                       r
                                    
                                    
                                       0
                                    
                                 
                                 ,
                                 ∅
                                 )
                               and 
                                 
                                    
                                       q
                                    
                                    
                                       0
                                    
                                 
                                 
                                    
                                       |
                                    
                                    
                                       s
                                    
                                 
                                 
                                    
                                       r
                                    
                                    
                                       0
                                    
                                 
                              . By applying the propagation lemma of strong adaptation (Lemma 2), we get that all states 
                                 (
                                 q
                                 ,
                                 r
                                 ,
                                 ∅
                                 )
                                 ∈
                                 
                                    
                                       Post
                                    
                                    
                                       ⁎
                                    
                                 
                                 (
                                 
                                    
                                       f
                                    
                                    
                                       0
                                    
                                 
                                 )
                               are such that 
                                 q
                                 
                                    
                                       |
                                    
                                    
                                       s
                                    
                                 
                                 r
                              . Thus, we can use 
                                 
                                    
                                       R
                                    
                                    
                                       q
                                       ,
                                       r
                                    
                                 
                               to denote the strong adaptation relation, containing 
                                 (
                                 q
                                 ,
                                 r
                                 )
                              , that exists for each 
                                 (
                                 q
                                 ,
                                 r
                                 ,
                                 ∅
                                 )
                                 ∈
                                 
                                    
                                       Post
                                    
                                    
                                       ⁎
                                    
                                 
                                 (
                                 
                                    
                                       f
                                    
                                    
                                       0
                                    
                                 
                                 )
                              . Moreover, we naturally deduce that, for each such pair, 
                                 q
                                 ⊨
                                 L
                                 (
                                 r
                                 )
                              . Thus, if we take 
                                 
                                    
                                       R
                                    
                                    
                                       ˆ
                                    
                                 
                                 =
                                 
                                    
                                       ⋃
                                    
                                    
                                       (
                                       q
                                       ,
                                       r
                                       ,
                                       ∅
                                       )
                                       ∈
                                       
                                          
                                             Post
                                          
                                          
                                             ⁎
                                          
                                       
                                       (
                                       
                                          
                                             f
                                          
                                          
                                             0
                                          
                                       
                                       )
                                    
                                 
                                 
                                    
                                       R
                                    
                                    
                                       q
                                       ,
                                       r
                                    
                                 
                               we have, by definition of 
                                 
                                    
                                       R
                                    
                                    
                                       ˆ
                                    
                                 
                               and of 
                                 R
                              , 
                                 R
                                 ⊆
                                 
                                    
                                       R
                                    
                                    
                                       ˆ
                                    
                                 
                              . But 
                                 R
                               contains, by its definition, each possible pair 
                                 (
                                 q
                                 ,
                                 r
                                 )
                               such that 
                                 (
                                 q
                                 ,
                                 r
                                 ,
                                 ∅
                                 )
                               is reachable from 
                                 
                                    
                                       f
                                    
                                    
                                       0
                                    
                                 
                               and by the rule Steady of the operational semantics, 
                                 q
                                 ⊨
                                 L
                                 (
                                 r
                                 )
                              . Thus, it must also hold 
                                 
                                    
                                       R
                                    
                                    
                                       ˆ
                                    
                                 
                                 ⊆
                                 R
                              . Hence, 
                                 R
                                 =
                                 
                                    
                                       R
                                    
                                    
                                       ˆ
                                    
                                 
                              . By Proposition 3, 
                                 
                                    
                                       R
                                    
                                    
                                       ˆ
                                    
                                 
                                 =
                                 R
                               is a strong adaptation relation.

For the converse, trivially, if 
                                 R
                                 =
                                 {
                                 (
                                 q
                                 ,
                                 r
                                 )
                                 ∈
                                 Q
                                 ×
                                 R
                                 |
                                 (
                                 q
                                 ,
                                 r
                                 ,
                                 ∅
                                 )
                                 ∈
                                 
                                    
                                       Post
                                    
                                    
                                       ⁎
                                    
                                 
                                 (
                                 
                                    
                                       f
                                    
                                    
                                       0
                                    
                                 
                                 )
                                 }
                               is a strong adaptation relation then 
                                 S
                                 [
                                 B
                                 ]
                               is strongly adaptable, because, by definition, 
                                 (
                                 
                                    
                                       q
                                    
                                    
                                       0
                                    
                                 
                                 ,
                                 
                                    
                                       r
                                    
                                    
                                       0
                                    
                                 
                                 )
                                 ∈
                                 R
                              .  □


                        
                           Proof
                           
                              
                                 (
                                 ⇒
                                 )
                               Having 
                                 q
                                 
                                 
                                    
                                       |
                                    
                                    
                                       w
                                    
                                 
                                 
                                 r
                              , by the propagation of weak adaptation (Lemma 1) we can construct an infinite path π in 
                                 F
                                 (
                                 S
                                 [
                                 B
                                 ]
                                 )
                              , and thus in 
                                 K
                                 (
                                 S
                                 [
                                 B
                                 ]
                                 )
                              , starting from 
                                 (
                                 q
                                 ,
                                 r
                                 ,
                                 ∅
                                 )
                              , which has the form specified in the lemma and such that 
                                 
                                    
                                       q
                                    
                                    
                                       i
                                    
                                 
                                 
                                 
                                    
                                       |
                                    
                                    
                                       w
                                    
                                 
                                 
                                 
                                    
                                       r
                                    
                                    
                                       i
                                    
                                 
                               for all i. Such a path can be used to show that the given CTL formula is true. Since 
                                 
                                    
                                       q
                                    
                                    
                                       i
                                    
                                 
                                 
                                 
                                    
                                       |
                                    
                                    
                                       w
                                    
                                 
                                 
                                 
                                    
                                       r
                                    
                                    
                                       i
                                    
                                 
                              , along π the progress proposition is true in all states. Moreover, whenever 
                                 
                                    
                                       m
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 0
                               and 
                                 
                                    
                                       n
                                    
                                    
                                       i
                                    
                                 
                                 >
                                 0
                               in 
                                 (
                                 
                                    
                                       q
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       r
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 ∅
                                 )
                                 
                                    
                                       (
                                       
                                          →
                                          
                                             
                                                r
                                             
                                             
                                                i
                                             
                                          
                                       
                                       )
                                    
                                    
                                       
                                          
                                             m
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                                 
                                    
                                       (
                                       
                                          →
                                          
                                             
                                                
                                                   r
                                                
                                                
                                                   i
                                                
                                             
                                             ,
                                             
                                                
                                                   ψ
                                                
                                                
                                                   i
                                                
                                             
                                             ,
                                             
                                                
                                                   r
                                                
                                                
                                                   i
                                                   +
                                                   1
                                                
                                             
                                          
                                       
                                       )
                                    
                                    
                                       
                                          
                                             n
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                                 (
                                 
                                    
                                       q
                                    
                                    
                                       i
                                       +
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       r
                                    
                                    
                                       i
                                       +
                                       1
                                    
                                 
                                 ,
                                 ∅
                                 )
                              , the proposition adapting is true in state 
                                 (
                                 
                                    
                                       q
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       r
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 ∅
                                 )
                              . In this case we reach, by following the path, the state 
                                 (
                                 
                                    
                                       q
                                    
                                    
                                       i
                                       +
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       r
                                    
                                    
                                       i
                                       +
                                       1
                                    
                                 
                                 ,
                                 ∅
                                 )
                               in which, since progress is true, then also steady is true. Note that adapting is true also in all the intermediate states between 
                                 (
                                 
                                    
                                       q
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       r
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 ∅
                                 )
                               and 
                                 (
                                 
                                    
                                       q
                                    
                                    
                                       i
                                       +
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       r
                                    
                                    
                                       i
                                       +
                                       1
                                    
                                 
                                 ,
                                 ∅
                                 )
                              . Following the same path, from all these states the same target state 
                                 (
                                 
                                    
                                       q
                                    
                                    
                                       i
                                       +
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       r
                                    
                                    
                                       i
                                       +
                                       1
                                    
                                 
                                 ,
                                 ∅
                                 )
                              , in which steady is true, is reached. The cases in which 
                                 
                                    
                                       m
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 1
                               and 
                                 
                                    
                                       n
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 0
                               correspond to states in which adapting is false (by definition of adapting and by property (i) of Proposition 1), thus in this case the implication 
                                 (
                                 
                                    adapting
                                 
                                 ⟹
                                 
                                    EF
                                 
                                 
                                 
                                    steady
                                 
                                 )
                               is vacuously true.


                              
                                 (
                                 ⇐
                                 )
                               If the formula is true at state 
                                 (
                                 q
                                 ,
                                 r
                                 ,
                                 ∅
                                 )
                              , by definition of the semantics of CTL we have that there exists an infinite path π in 
                                 K
                                 (
                                 S
                                 [
                                 B
                                 ]
                                 )
                               in which every state satisfies progress and the sub-formula 
                                 (
                                 
                                    adapting
                                 
                                 ⟹
                                 
                                    EF
                                 
                                 
                                 
                                    steady
                                 
                                 )
                              . Such a path is a witness of the truth of the formula and can be calculated by a model checker usually in the form of a prefix followed by a cycle in which some reasonable
                                 2
                              
                              
                                 2
                                 In our case a fairness condition that should be required for the weak adaptability checking can be expressed as follows: “if a state satisfying steady can be eventually reached infinitely many times, then it is eventually reached infinitely many times”.
                               fairness constraints hold.
                                 3
                              
                              
                                 3
                                 For a detailed discussion on the fairness constraints in CTL and on the generation of witnesses we refer to [2,16].
                               To show that 
                                 q
                                 
                                 
                                    
                                       |
                                    
                                    
                                       w
                                    
                                 
                                 
                                 r
                               we use such a path π to generate a weak adaptation relation 
                                 
                                    
                                       R
                                    
                                    
                                       π
                                    
                                 
                               as follows:
                                 
                                    
                                       
                                          
                                             R
                                          
                                          
                                             π
                                          
                                       
                                       =
                                       {
                                       (
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             i
                                          
                                       
                                       )
                                       |
                                       ∃
                                       i
                                       ≥
                                       0
                                       :
                                       π
                                       [
                                       i
                                       ]
                                       =
                                       (
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       ∅
                                       )
                                       }
                                    
                                 
                               First, we note that 
                                 (
                                 q
                                 =
                                 
                                    
                                       q
                                    
                                    
                                       0
                                    
                                 
                                 ,
                                 r
                                 =
                                 
                                    
                                       r
                                    
                                    
                                       0
                                    
                                 
                                 )
                               is in 
                                 
                                    
                                       R
                                    
                                    
                                       π
                                    
                                 
                               because 
                                 π
                                 [
                                 0
                                 ]
                                 =
                                 (
                                 q
                                 =
                                 
                                    
                                       q
                                    
                                    
                                       0
                                    
                                 
                                 ,
                                 r
                                 =
                                 
                                    
                                       r
                                    
                                    
                                       0
                                    
                                 
                                 ,
                                 ∅
                                 )
                              . Then, we conclude the proof by showing, in the following, that 
                                 
                                    
                                       R
                                    
                                    
                                       π
                                    
                                 
                               is indeed a weak adaptation relation. Let 
                                 i
                                 ≥
                                 0
                               and let 
                                 π
                                 [
                                 i
                                 ]
                                 =
                                 (
                                 
                                    
                                       q
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       r
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 ∅
                                 )
                              . We check that for the generic pair 
                                 (
                                 
                                    
                                       q
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 
                                    
                                       r
                                    
                                    
                                       i
                                    
                                 
                                 )
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       π
                                    
                                 
                               all the conditions of the weak adaptability definition (Definition 7) hold:
                                 
                                    (i)
                                    
                                       
                                          
                                             
                                                q
                                             
                                             
                                                i
                                             
                                          
                                          ⊨
                                          L
                                          (
                                          
                                             
                                                r
                                             
                                             
                                                i
                                             
                                          
                                          )
                                        holds by property (vii) of Proposition 1; 
                                          
                                             Progress
                                          
                                          (
                                          
                                             
                                                q
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          
                                             
                                                r
                                             
                                             
                                                i
                                             
                                          
                                          )
                                        also holds because 
                                          π
                                          [
                                          i
                                          ]
                                          =
                                          (
                                          
                                             
                                                q
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          
                                             
                                                r
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          ∅
                                          )
                                        is a state along an infinite path, thus it does not stop;

if in 
                                          π
                                          [
                                          i
                                          ]
                                        we have that 
                                          (
                                          
                                             
                                                q
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          
                                             
                                                r
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          ∅
                                          )
                                          
                                             →
                                             r
                                          
                                        then we can take the transition 
                                          (
                                          
                                             
                                                q
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          
                                             
                                                r
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          ∅
                                          )
                                          
                                             →
                                             r
                                          
                                          (
                                          
                                             
                                                q
                                             
                                             
                                                i
                                                +
                                                1
                                             
                                          
                                          ,
                                          
                                             
                                                r
                                             
                                             
                                                i
                                                +
                                                1
                                             
                                          
                                          ,
                                          ∅
                                          )
                                        of π and then 
                                          (
                                          
                                             
                                                q
                                             
                                             
                                                i
                                                +
                                                1
                                             
                                          
                                          ,
                                          
                                             
                                                r
                                             
                                             
                                                i
                                                +
                                                1
                                             
                                          
                                          )
                                          ∈
                                          
                                             
                                                R
                                             
                                             
                                                π
                                             
                                          
                                       ;

if in 
                                          π
                                          [
                                          i
                                          ]
                                        the 
                                          (
                                          
                                             
                                                q
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          
                                             
                                                r
                                             
                                             
                                                i
                                             
                                          
                                          ,
                                          ∅
                                          )
                                          
                                             →
                                             
                                                r
                                                ,
                                                ψ
                                                ,
                                                
                                                   
                                                      r
                                                   
                                                   
                                                      ′
                                                   
                                                
                                             
                                          
                                        for some ψ and 
                                          
                                             
                                                r
                                             
                                             
                                                ′
                                             
                                          
                                       , then 
                                          π
                                          [
                                          i
                                          ]
                                          
                                             
                                                ⊨
                                             
                                             
                                                CTL
                                             
                                          
                                          
                                             adapting
                                          
                                        and 
                                          π
                                          [
                                          i
                                          ]
                                          
                                             
                                                ⊨
                                             
                                             
                                                CTL
                                             
                                          
                                          
                                             steady
                                          
                                       . Thus, the sub-formula 
                                          (
                                          
                                             adapting
                                          
                                          ⟹
                                          
                                             EF
                                          
                                        
                                       steady) is immediately true in 
                                          π
                                          [
                                          i
                                          ]
                                       . However, we know that π continues and by property (v) of Proposition 1 we know that the semantics imposes that π adapts as soon as possible. Thus, there are two further sub-cases:
                                          
                                             –
                                             the adaptation is immediate: 
                                                   (
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ,
                                                   ∅
                                                   )
                                                   
                                                      →
                                                      
                                                         r
                                                         ,
                                                         ψ
                                                         ,
                                                         
                                                            
                                                               r
                                                            
                                                            
                                                               ′
                                                            
                                                         
                                                      
                                                   
                                                   (
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         i
                                                         +
                                                         1
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   =
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         i
                                                         +
                                                         1
                                                      
                                                   
                                                   ,
                                                   ∅
                                                   )
                                                 and thus 
                                                   (
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         i
                                                         +
                                                         1
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         i
                                                         +
                                                         1
                                                      
                                                   
                                                   )
                                                   ∈
                                                   
                                                      
                                                         R
                                                      
                                                      
                                                         π
                                                      
                                                   
                                                ;

the adaptation cannot be immediate, thus in π we have 
                                                   (
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ,
                                                   ∅
                                                   )
                                                   
                                                      →
                                                      
                                                         r
                                                         ,
                                                         ψ
                                                         ,
                                                         
                                                            
                                                               r
                                                            
                                                            
                                                               ′
                                                            
                                                         
                                                      
                                                   
                                                   (
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ,
                                                   {
                                                   (
                                                   ψ
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   )
                                                   }
                                                   )
                                                 for some 
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   ∈
                                                   Q
                                                   ,
                                                   
                                                   ψ
                                                   ∈
                                                   Ψ
                                                   (
                                                   Σ
                                                   ,
                                                   A
                                                   )
                                                 and 
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   ∈
                                                   R
                                                . Again by the progress of π and by the definition of 
                                                   K
                                                   (
                                                   S
                                                   [
                                                   B
                                                   ]
                                                   )
                                                , it holds that 
                                                   (
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ,
                                                   {
                                                   (
                                                   ψ
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   )
                                                   }
                                                   )
                                                   
                                                      
                                                         ⊨
                                                      
                                                      
                                                         CTL
                                                      
                                                   
                                                   
                                                      adapting
                                                   
                                                 and that 
                                                   (
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ,
                                                   {
                                                   (
                                                   ψ
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   )
                                                   }
                                                   )
                                                   
                                                      
                                                         ⊭
                                                      
                                                      
                                                         CTL
                                                      
                                                   
                                                   
                                                      steady
                                                   
                                                . Now, the sub-formula 
                                                   (
                                                   
                                                      adapting
                                                   
                                                   ⟹
                                                   
                                                      EF
                                                   
                                                   
                                                   
                                                      steady
                                                   
                                                   )
                                                 is not immediately true and, by hypothesis, it holds in 
                                                   (
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ,
                                                   {
                                                   (
                                                   ψ
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   )
                                                   }
                                                   )
                                                . Thus, there exists in 
                                                   K
                                                   (
                                                   S
                                                   [
                                                   B
                                                   ]
                                                   )
                                                 a path starting from 
                                                   (
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ,
                                                   {
                                                   (
                                                   ψ
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   )
                                                   }
                                                   )
                                                 and leading in j steps, 
                                                   j
                                                   >
                                                   0
                                                , to a state in which steady holds, that is of the form 
                                                   (
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         ″
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   ,
                                                   ∅
                                                   )
                                                . Among possibly others, the continuation of π until the next state of the form 
                                                   (
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         ″
                                                      
                                                   
                                                   =
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         i
                                                         +
                                                         1
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                   =
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         i
                                                         +
                                                         1
                                                      
                                                   
                                                   ,
                                                   ∅
                                                   )
                                                 is a finite path satisfying this condition. Indeed, if it were not, then π would either stop or infinitely continue along states that satisfy adapting but not steady. This contradicts the fact that π is a witness (under reasonable fairness conditions) of the truth of the original CTL formula. Thus, we have that 
                                                   (
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   ,
                                                   ∅
                                                   )
                                                   
                                                      
                                                         (
                                                         
                                                            →
                                                            
                                                               
                                                                  
                                                                     r
                                                                  
                                                                  
                                                                     i
                                                                  
                                                               
                                                               ,
                                                               
                                                                  
                                                                     ψ
                                                                  
                                                                  
                                                                     i
                                                                  
                                                               
                                                               ,
                                                               
                                                                  
                                                                     r
                                                                  
                                                                  
                                                                     i
                                                                     +
                                                                     1
                                                                  
                                                               
                                                            
                                                         
                                                         )
                                                      
                                                      
                                                         j
                                                         +
                                                         1
                                                      
                                                   
                                                   (
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         i
                                                         +
                                                         1
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         i
                                                         +
                                                         1
                                                      
                                                   
                                                   ,
                                                   ∅
                                                   )
                                                 (where 
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         i
                                                         +
                                                         1
                                                      
                                                   
                                                   =
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         ′
                                                      
                                                   
                                                 and 
                                                   
                                                      
                                                         ψ
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   =
                                                   ψ
                                                ) and 
                                                   (
                                                   
                                                      
                                                         q
                                                      
                                                      
                                                         i
                                                         +
                                                         1
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         i
                                                         +
                                                         1
                                                      
                                                   
                                                   )
                                                   ∈
                                                   
                                                      
                                                         R
                                                      
                                                      
                                                         π
                                                      
                                                   
                                                .


                        
                           Proof
                           
                              
                                 (
                                 ⇒
                                 )
                               Having 
                                 q
                                 
                                 
                                    
                                       |
                                    
                                    
                                       s
                                    
                                 
                                 
                                 r
                               we consider all paths π in 
                                 K
                                 (
                                 S
                                 [
                                 B
                                 ]
                                 )
                               starting from 
                                 (
                                 q
                                 ,
                                 r
                                 ,
                                 ∅
                                 )
                              , which have the form and the properties stated in the proof of Lemma 2. All such paths can be used to show that the given CTL formula is true by using the same argument used in the proof part 
                                 (
                                 ⇒
                                 )
                               of Theorem 1, by turning the initial existential quantification into a universal one.


                              
                                 (
                                 ⇐
                                 )
                               Also in this case the proof is similar to the proof part 
                                 (
                                 ⇐
                                 )
                               of Theorem 1. However, the reasoning should be repeated not considering the witness of the truth of the formula, but a generic path π starting from 
                                 (
                                 q
                                 ,
                                 r
                                 ,
                                 ∅
                                 )
                              . Moreover, the strong adaptation relation 
                                 R
                               must be defined generalising on all paths:
                                 
                                    
                                       R
                                       =
                                       {
                                       (
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             i
                                          
                                       
                                       )
                                       |
                                       ∃
                                       π
                                       ∈
                                       
                                          Paths
                                       
                                       (
                                       (
                                       q
                                       ,
                                       r
                                       ,
                                       ∅
                                       )
                                       )
                                       :
                                       ∃
                                       i
                                       ≥
                                       0
                                       :
                                       π
                                       [
                                       i
                                       ]
                                       =
                                       (
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             i
                                          
                                       
                                       ,
                                       ∅
                                       )
                                       }
                                    
                                 
                               Then, the checking of the conditions of the strong adaptability definition (Definition 9) on every pair of 
                                 R
                               requires similar arguments to the proof of Theorem 1.  □

@&#REFERENCES@&#

