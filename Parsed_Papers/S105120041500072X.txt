@&#MAIN-TITLE@&#A robust baseline elimination method based on community information

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           Excellent community provides threshold, global and local slope information.


                        
                        
                           
                           Global and local slope information further confirm peak distribution information.


                        
                        
                           
                           An adaptive iteratively reweighted genetic programming model the baseline.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Baseline correction

Genetic programming

Robust estimation

Community information

@&#ABSTRACT@&#


               
               
                  Baseline correction is an important pre-processing technique used to separate true spectra from interference effects or remove baseline effects. In this paper, an adaptive iteratively reweighted genetic programming based on excellent community information (GPEXI) is proposed to model baselines from spectra. Excellent community information which is abstracted from the present excellent community includes an automatic common threshold, normal global and local slope information. Significant peaks can be firstly detected by an automatic common threshold. Then based on the characteristic that a baseline varies slowly with respect to wavelength, normal global and local slope information are used to further confirm whether a point is in peak regions. Moreover the slope information is also used to determine the range of baseline curve fluctuation in peak regions. The proposed algorithm is more robust for different kinds of baselines and its curvature and slope can be automatically adjusted without prior knowledge. Experimental results in both simulated data and real data demonstrate the effectiveness of the algorithm.
               
            

@&#INTRODUCTION@&#

Fourier transform infrared spectroscopy can be a valuable tool for measuring many chemical and physical properties of materials. However, it is a severe problem that spectra generally consist of peaks and noise superimposed on a baseline. Usually these baselines can be either flat, linear, curved or a combination of all three. Compared with peaks, their main character is that they vary much more slowly than the peaks do. The worst is that baselines vary greatly from spectrum to spectrum, even in similar samples. Thus, it is hard to eliminate them and this situation hampers the interpretation of spectra, which makes the removal of baseline drift necessary.

Baseline elimination for spectral data has been studied intensively and several methods have already been presented. These methods can be divided into two categories: manual and automatic techniques. In the manual method [1], the baseline is constructed by using linear, polynomial, or spline functions fitted on the no signal (baseline) points selected by users. If the points are correctly selected, the construction would produce satisfactory results. Obviously, this technique is subjective, time-consuming, and poorly reproducible [2].

In contrast, automatic baseline correction is called for and more widely employed. Among these methods, the wavelet transform has become a useful tool in background removal [3,4]. However, inappropriate wavelet and resolution level selection are detrimental to baseline estimation. Fourier transform method which can generate the frequency components from the original spectrum is used to make a discrimination among baseline (low frequency), signal (mid frequency), and noise (high frequency) components. Then these frequency components can be filtered by a band-pass or high-pass filter to eliminate unwanted spectral components. But the filter parameters are difficult to set for separating the baseline from the signal effectively [5]. In general, these approaches are based on a hypothesis that the background can be well separated (in the transformed domain) from the real signal. The derivative method [6] uses first derivatives or second derivatives to remove constant off-sets or linear baselines from the spectra. But the threshold, which determines how many peaks are selected from the smoothed differentiated spectrum, is difficult to set.

Recently, baseline correction algorithms with asymmetric least squares smoothing are proposed [7–10]. The Whittaker smoother described by Eilers is used and only two parameters related to the rigid of the fitted curve and the noise level need to be tuned. But how to set the parameters is not always an easy task.

An iterative method based on polynomial curve fitting for automated estimation of baseline is proposed [11–16]. These algorithms generate automatic threshold to distinguish the baseline from peaks by a fitted curve. Linear programming is used for baseline correction [17], the polynomial order is selected based on a criterion instead of the user's experience, but the criterion can be used only when these baseline correction processes with different polynomial orders have been completed and only be used in comparing results of these processes. These methods offer a promising approach to removing baseline effects in a simple, straightforward fashion. However, their performance depends on the two parameters predefined by the users. The parameters include the polynomial order and the threshold which is related to the noise level and other characters about the spectrum. Therefore, the accuracy of the estimation still depends on the user's prior knowledge.

If there is some slope or curvature information about the baseline, the parameter which is related to the rigid of the fitted curve and the threshold would be easier to set and these baseline correcting methods should have more chances to present satisfied results.

Usually there isn't any information about baseline before a baseline correction process, but more and more knowledge about the baseline can be obtained with the deepening of the process. In this paper, this knowledge is used in the adaptive iterative baseline correction process to help automatically define the rigid of the fitted curve. Reweighted genetic programming based on excellent community information (GPEXI) is proposed to recognize and model baseline automatically. Here excellent community information includes common automatic threshold, global slope, local slope, and curvature information which are obtained from these present common baseline areas determined by excellent community selected from the current population of GP. The proposed method uses an automatic threshold defined by excellent community information instead of one curve to discriminate baseline areas and peaks. The order of polynomial is automatically determined during the learning process without prior knowledge of spectra. By this way, an iteratively procedure is executed to gradually approximate a complex baseline.

In Section 2, some useful and important preliminary ideas are discussed. The proposed reweighted genetic programming based on excellent community information (GPEXI) are given in Section 3. These methods about how to extract excellent community information from each generation and how to use this information are also given in this section. Section 4 presents some simulated data which are used to illustrate the performances of the proposed method. The effectiveness of the method is also demonstrated through applications on experimental spectra. Finally, some conclusions are given in Section 5.

Assume that the I-point spectrum is 
                           {
                           (
                           
                              
                                 x
                              
                              
                                 1
                              
                           
                           ,
                           y
                           (
                           
                              
                                 x
                              
                              
                                 1
                              
                           
                           )
                           )
                           ,
                           ⋯
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           ,
                           y
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                           )
                           ,
                           ⋯
                           ,
                           (
                           
                              
                                 x
                              
                              
                                 I
                              
                           
                           ,
                           y
                           (
                           
                              
                                 x
                              
                              
                                 I
                              
                           
                           )
                           )
                           }
                        . It can be modeled as 
                           y
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                           =
                           b
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                           +
                           e
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                        , 
                           1
                           ≤
                           i
                           ≤
                           I
                         where: 
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                         is a wavelength value. 
                           y
                           =
                           (
                           y
                           (
                           
                              
                                 x
                              
                              
                                 1
                              
                           
                           )
                           ,
                           y
                           (
                           
                              
                                 x
                              
                              
                                 2
                              
                           
                           )
                           ,
                           ⋯
                           ,
                           y
                           (
                           
                              
                                 x
                              
                              
                                 I
                              
                           
                           )
                           )
                         is a I point positive peak spectrum. 
                           b
                           =
                           (
                           b
                           (
                           
                              
                                 x
                              
                              
                                 1
                              
                           
                           )
                           ,
                           b
                           (
                           
                              
                                 x
                              
                              
                                 2
                              
                           
                           )
                           ,
                           ⋯
                           ,
                           b
                           (
                           
                              
                                 x
                              
                              
                                 I
                              
                           
                           )
                           )
                         denotes the baseline itself. 
                           e
                           =
                           (
                           e
                           (
                           
                              
                                 x
                              
                              
                                 1
                              
                           
                           )
                           ,
                           e
                           (
                           
                              
                                 x
                              
                              
                                 2
                              
                           
                           )
                           ,
                           ⋯
                           ,
                           e
                           (
                           
                              
                                 x
                              
                              
                                 I
                              
                           
                           )
                           )
                         denotes the residual, peaks, and physical noise. The baseline can be modeled as
                           
                              (1)
                              
                                 b
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       i
                                    
                                 
                                 )
                                 =
                                 f
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 a
                                 )
                                 .
                              
                           
                         Here, 
                           f
                           (
                           ⋅
                           )
                         and a are functions and parameters. Baseline should have the following properties: 1) being smooth, but 2) also being faithful to y 
                        [18].

In these methods, a baseline b can be modeled as a p order polynomial function. It can be written as 
                           
                              
                                 b
                              
                              
                                 ′
                              
                           
                           =
                           X
                           a
                        . Here,
                           
                              
                                 X
                                 =
                                 
                                    (
                                    
                                       
                                          
                                             
                                                
                                                   x
                                                
                                                
                                                   1
                                                
                                                
                                                   0
                                                
                                             
                                          
                                          
                                             
                                                
                                                   x
                                                
                                                
                                                   1
                                                
                                                
                                                   1
                                                
                                             
                                          
                                          
                                             ⋯
                                          
                                          
                                             
                                                
                                                   x
                                                
                                                
                                                   1
                                                
                                                
                                                   p
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   x
                                                
                                                
                                                   2
                                                
                                                
                                                   0
                                                
                                             
                                          
                                          
                                             
                                                
                                                   x
                                                
                                                
                                                   2
                                                
                                                
                                                   1
                                                
                                             
                                          
                                          
                                             ⋯
                                          
                                          
                                             
                                                
                                                   x
                                                
                                                
                                                   2
                                                
                                                
                                                   p
                                                
                                             
                                          
                                       
                                       
                                          
                                             ⋮
                                          
                                          
                                             ⋮
                                          
                                          
                                          
                                             ⋮
                                          
                                       
                                       
                                          
                                             
                                                
                                                   x
                                                
                                                
                                                   I
                                                
                                                
                                                   0
                                                
                                             
                                          
                                          
                                             
                                                
                                                   x
                                                
                                                
                                                   I
                                                
                                                
                                                   1
                                                
                                             
                                          
                                          
                                             ⋯
                                          
                                          
                                             
                                                
                                                   x
                                                
                                                
                                                   I
                                                
                                                
                                                   p
                                                
                                             
                                          
                                       
                                    
                                    )
                                 
                                 ,
                                 
                                 a
                                 =
                                 
                                    (
                                    
                                       
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   0
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   1
                                                
                                             
                                          
                                       
                                       
                                          
                                             ⋮
                                          
                                       
                                       
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   p
                                                
                                             
                                          
                                       
                                    
                                    )
                                 
                              
                           
                         is the polynomial coefficients. Try to minimize the criterion 
                           J
                           (
                           a
                           )
                        , then find the coefficients a of the polynomial curve.
                           
                              (2)
                              
                                 J
                                 (
                                 a
                                 )
                                 =
                                 
                                    ∑
                                    
                                       i
                                       =
                                       1
                                    
                                    I
                                 
                                 φ
                                 
                                    (
                                    y
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    −
                                    
                                       
                                          X
                                       
                                       
                                          i
                                       
                                    
                                    a
                                    )
                                 
                              
                           
                         
                        
                           
                              
                                 X
                              
                              
                                 i
                              
                           
                         represents the ith row of X. The cost function φ has a critical influence on the criterion. The two following cost functions are used and a is estimated by an iterative technique [12,19].

Asymmetric Huber function
                           
                              (3)
                              
                                 φ
                                 
                                    (
                                    y
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    −
                                    
                                       
                                          X
                                       
                                       
                                          i
                                       
                                    
                                    a
                                    )
                                 
                                 =
                                 
                                    {
                                    
                                       
                                          
                                             
                                                
                                                   (
                                                   y
                                                   (
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   )
                                                   −
                                                   
                                                      
                                                         X
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   a
                                                   )
                                                
                                                
                                                   2
                                                
                                             
                                          
                                          
                                             if
                                             
                                             y
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                             −
                                             
                                                
                                                   X
                                                
                                                
                                                   i
                                                
                                             
                                             a
                                             <
                                             Δ
                                          
                                       
                                       
                                          
                                             2
                                             Δ
                                             (
                                             y
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                             −
                                             
                                                
                                                   X
                                                
                                                
                                                   i
                                                
                                             
                                             a
                                             )
                                             −
                                             
                                                
                                                   Δ
                                                
                                                
                                                   2
                                                
                                             
                                          
                                          
                                             otherwise
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Asymmetric truncated quadratic
                           
                              (4)
                              
                                 φ
                                 
                                    (
                                    y
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    −
                                    
                                       
                                          X
                                       
                                       
                                          i
                                       
                                    
                                    a
                                    )
                                 
                                 =
                                 
                                    {
                                    
                                       
                                          
                                             
                                                
                                                   (
                                                   y
                                                   (
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   )
                                                   −
                                                   
                                                      
                                                         X
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   a
                                                   )
                                                
                                                
                                                   2
                                                
                                             
                                          
                                          
                                             if
                                             
                                             y
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                             −
                                             
                                                
                                                   X
                                                
                                                
                                                   i
                                                
                                             
                                             a
                                             <
                                             Δ
                                          
                                       
                                       
                                          
                                             
                                                
                                                   Δ
                                                
                                                
                                                   2
                                                
                                             
                                          
                                          
                                             otherwise
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Other polynomial curve fitting algorithm [11,13–16] use an iterative algorithm to estimate the baseline on a spectrum in which peaks are eliminated. The signal areas (peaks) are redefined at each iteration by a estimated baseline. Each point is set equal to the estimated baseline if the corresponding spectrum intensity is higher than the estimated baseline, otherwise it is set equal to the spectrum [14]. This method is equivalent to minimize an asymmetrical truncated quadratic when 
                           Δ
                           =
                           0
                        .

The threshold Δ and the order of a polynomial function provide a threshold to discriminate baseline areas from signal areas. The two parameters need to be predefined by a user.

GP was proposed by J.R. Koza in 1990's. It starts with an initial population created randomly and produces offspring by performing genetic operators in the current population. The iterative process continues until the stopping criterion is satisfied after several generations [20]. Then the best individual is gotten. GP has been widely used in many fields [21,22]. The steps of GP is:
                           
                              (1)
                              A random population of size N is created. Each individual is represented as a tree structure. The individuals in the initial population are generated by recursively generating a rooted point-labeled tree.

Calculate the fitness of each individual in the current population.

Use the selection, recombination, and mutation operators on the current population and generate a offspring population.

Back to step 2 until the final conditions are satisfied. The best individual ever encountered during the run is the solution to the problem.

Here, genetic programming provides multiple estimated baseline curves with different smoothness and recognizes baseline areas by community information which is abstracted from all these estimated curves. The characteristic of GP, which is a population based optimization technique, is used to improve the accuracy of the baseline region recognition. Then GP models the baseline without pre-specifying the structure of it.

Considering that a baseline generally varies much slower than a signal, so slope and curvature information can be used to distinguish signal free regions (baseline area) from signal areas (peaks). With the help of this information, reweighted genetic programming based on excellent community information (GPEXI) is proposed to eliminate baselines in spectra.

First several best fitted curves (individuals in the current population) are used to identify peak regions from baseline regions. Because several fitted curves are used, the results should be more credible than those results obtained by only one fitted curve. Then, in order to avoid mistaking baseline regions as peaks, slope and curvature information are used to retest whether regions belong to peaks or baseline regions.

As mentioned before, the baseline shows very broad spectral features and its derivative changes very slowly too. In the proposed method, derivative information of spectra is used to identify whether a point belongs to peaks, but noise degrades effectiveness of the method. So noise removal is needed. A Savitzky–Gloay filter [23,24] is used as a generalized moving average filter and is denoted as 
                           
                              
                                 y
                              
                              
                                 ¯
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                           =
                           smoothing
                           (
                           y
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                           ,
                           
                              
                                 N
                              
                              
                                 1
                              
                           
                           )
                        , 
                           
                              
                                 N
                              
                              
                                 1
                              
                           
                         is the number of neighboring data points on the either side of 
                           y
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                        . 
                           
                              
                                 y
                              
                              
                                 ¯
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                         is only used to get slope (derivative) information in baseline regions, so the parameter 
                           
                              
                                 N
                              
                              
                                 1
                              
                           
                         is robust which can be demonstrated in subsequent experiments.

In order to utilize the characteristic information of the baseline to prevent erroneous identification of baseline areas and peak areas, excellent community and community information are combined with GP. The characteristic information includes global slope information, local slope information, and the curvature information of a baseline. Generally, this information is produced based on baseline areas of a spectrum. But unfortunately no information about baseline can be used before a correction processes generally. With the deepening of the correction process, more information can be obtained. The proposed method try to use and update these information during all the process based on current excellent community. Thus they are called community information.

Excellent community consists of the several optimal individuals selected from the current population and is updated during all the evolutionary process. Here an individual represents an estimated fitted curve. Excellent community is defined as: Sort all individuals in the current population in an increasing order based on their fitness. The first 20% in the queue are chosen to make up the excellent community.

Community information is automatically abstracted based on the common information provided by the present excellent community. This information includes common automatic threshold, global slope, local slope and curvature information which are abstract from common preliminary baseline areas. These information will be used to further confirm whether the preliminary results derived from common automatic threshold are true or false.

Each individual curve generates an automatic threshold to discriminate peaks from baseline regions. A region is identified as a peak region by an individual if the original spectra have a value higher than the corresponding value in the individual fitted curve. Preliminary baseline and peak information is derived from common automatic threshold which are abstracted from the present excellent community.
                           
                              (1)
                              Suppose, the current generation is Gen. 
                                    
                                       
                                          P
                                       
                                       
                                          
                                             Gen
                                          
                                          −
                                          1
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    )
                                  contains the peak distribution information obtained from the last generation.
                                    
                                       (5)
                                       
                                          
                                             
                                                P
                                             
                                             
                                                
                                                   Gen
                                                
                                                −
                                                1
                                             
                                          
                                          (
                                          
                                             
                                                x
                                             
                                             
                                                i
                                             
                                          
                                          )
                                          =
                                          
                                             {
                                             
                                                
                                                   
                                                      0
                                                   
                                                   
                                                      if
                                                      
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      ∈
                                                      baseline regions
                                                   
                                                
                                                
                                                   
                                                      1
                                                   
                                                   
                                                      if
                                                      
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      ∈
                                                      peak regions
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              


                                 
                                    
                                       
                                          p
                                       
                                       
                                          j
                                       
                                    
                                  
                                 
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    )
                                  is the peak distribution identified by an individual 
                                    
                                       
                                          
                                             
                                                b
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          j
                                       
                                    
                                  (
                                    1
                                    ≤
                                    j
                                    ≤
                                    J
                                 ) in the excellent community.
                                    
                                       
                                          
                                             
                                                p
                                             
                                             
                                                j
                                             
                                          
                                          (
                                          
                                             
                                                x
                                             
                                             
                                                i
                                             
                                          
                                          )
                                          =
                                          
                                             {
                                             
                                                
                                                   
                                                      0
                                                   
                                                   
                                                      if
                                                      
                                                      y
                                                      (
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      )
                                                      −
                                                      
                                                         
                                                            
                                                               
                                                                  b
                                                               
                                                               
                                                                  ˆ
                                                               
                                                            
                                                         
                                                         
                                                            j
                                                         
                                                      
                                                      (
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      )
                                                      ≤
                                                      0
                                                   
                                                
                                                
                                                   
                                                      1
                                                   
                                                   
                                                      if
                                                      
                                                      y
                                                      (
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      )
                                                      −
                                                      
                                                         
                                                            
                                                               
                                                                  b
                                                               
                                                               
                                                                  ˆ
                                                               
                                                            
                                                         
                                                         
                                                            j
                                                         
                                                      
                                                      (
                                                      
                                                         
                                                            x
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                      )
                                                      >
                                                      0
                                                   
                                                
                                             
                                          
                                          .
                                          
                                          If
                                          
                                          
                                             
                                                p
                                             
                                             
                                                j
                                             
                                          
                                          (
                                          
                                             
                                                x
                                             
                                             
                                                i
                                             
                                          
                                          )
                                          =
                                          1
                                          ,
                                       
                                    
                                  a wavelength value 
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                  is identified to be belonging to a peak area by 
                                    
                                       
                                          
                                             
                                                b
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          j
                                       
                                    
                                 .

A wavelength point 
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                  is initially identified as belonging to peaks if 
                                    
                                       
                                          P
                                       
                                       
                                          1
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    =
                                    1
                                 . 
                                    
                                       
                                          P
                                       
                                       
                                          1
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    =
                                    
                                       
                                          P
                                       
                                       
                                          
                                             Gen
                                          
                                          −
                                          1
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    ∨
                                    (
                                    
                                       
                                          p
                                       
                                       
                                          1
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    ∧
                                    
                                       
                                          p
                                       
                                       
                                          2
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    ∧
                                    ⋯
                                    ∧
                                    
                                       
                                          p
                                       
                                       
                                          J
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    )
                                  contains the preliminary peak distribution information obtained from the current excellent community and the last generation. Here ∧ is an and operator, ∨ is a or operator.

In order to avoid spikes in the baseline areas (single or few points belonging to peaks) [9] which are caused by noise usually, 
                                    
                                       
                                          P
                                       
                                       
                                          1
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    )
                                  is modified by this way: 
                                    
                                       
                                          P
                                       
                                       
                                          1
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    =
                                    1
                                  requires not only that the point 
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                  satisfies 
                                    
                                       
                                          P
                                       
                                       
                                          1
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    =
                                    1
                                  but also that two of its neighbors do.


                        Fig. 1
                         shows the current preliminary peak distribution information. The area about 440 is initially identified as a peak area based 
                           
                              
                                 P
                              
                              
                                 
                                    Gen
                                 
                                 −
                                 1
                              
                           
                         although this area is a baseline area based the information from the current excellent community.

Because the effects of peak areas will be rarely considered in the subsequent baseline correction process, the determination of peak areas requires more attention. Global slope, local slope and curvature information will be used to further determine whether a point is really in a peak region.

Global slope information should be obtained from the whole baseline of a spectrum. Slopes of a baseline in peak regions can be represented by the slopes of their neighboring baseline areas, because baselines vary much slower than peaks do and these peak areas can't provide any effective baseline information generally.
                           
                              (6)
                              
                                 d
                                 b
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       i
                                    
                                 
                                 )
                                 =
                                 
                                    {
                                    
                                       
                                          
                                             d
                                             
                                                
                                                   y
                                                
                                                
                                                   ¯
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                          
                                          
                                             if
                                             
                                             
                                                
                                                   P
                                                
                                                
                                                   1
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                             =
                                             0
                                          
                                       
                                       
                                          
                                             d
                                             
                                                Line
                                             
                                             (
                                             
                                                
                                                   Peak
                                                
                                                
                                                   m
                                                
                                             
                                             )
                                          
                                          
                                             if
                                             
                                             
                                                
                                                   P
                                                
                                                
                                                   1
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                             =
                                             1
                                             
                                             and
                                             
                                             
                                                kstest
                                             
                                             2
                                             =
                                             0
                                          
                                       
                                       
                                          
                                             d
                                             (
                                             
                                                
                                                   B
                                                
                                                
                                                   m
                                                
                                             
                                             )
                                          
                                          
                                             if
                                             
                                             
                                                
                                                   P
                                                
                                                
                                                   1
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                             =
                                             1
                                             
                                             and
                                             
                                          
                                       
                                       
                                          
                                          
                                             L
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             ,
                                             
                                                
                                                   B
                                                
                                                
                                                   m
                                                
                                             
                                             )
                                             ≤
                                             0.5
                                             (
                                             L
                                             (
                                             
                                                
                                                   B
                                                
                                                
                                                   m
                                                
                                             
                                             )
                                             +
                                             L
                                             (
                                             
                                                
                                                   B
                                                
                                                
                                                   m
                                                   +
                                                   1
                                                
                                             
                                             )
                                             )
                                          
                                       
                                       
                                          
                                             d
                                             (
                                             
                                                
                                                   B
                                                
                                                
                                                   m
                                                   +
                                                   1
                                                
                                             
                                             )
                                          
                                          
                                             if
                                             
                                             
                                                
                                                   P
                                                
                                                
                                                   1
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                             =
                                             1
                                             
                                             and
                                             
                                          
                                       
                                       
                                          
                                          
                                             L
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             ,
                                             
                                                
                                                   B
                                                
                                                
                                                   m
                                                   +
                                                   1
                                                
                                             
                                             )
                                             <
                                             0.5
                                             (
                                             L
                                             (
                                             
                                                
                                                   B
                                                
                                                
                                                   m
                                                
                                             
                                             )
                                             +
                                             L
                                             (
                                             
                                                
                                                   B
                                                
                                                
                                                   m
                                                   +
                                                   1
                                                
                                             
                                             )
                                             )
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Here, 
                           d
                           b
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                         is the slope of a estimated baseline at 
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                        . 
                           d
                           
                              
                                 y
                              
                              
                                 ¯
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                           =
                           
                              
                                 y
                              
                              
                                 ¯
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                                 +
                                 1
                              
                           
                           )
                           −
                           
                              
                                 y
                              
                              
                                 ¯
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                        . 
                           
                              
                                 Peak
                              
                              
                                 m
                              
                           
                         is a continuous peak area which locates between its neighbor baseline areas 
                           
                              
                                 B
                              
                              
                                 m
                              
                           
                         and 
                           
                              
                                 B
                              
                              
                                 m
                                 +
                                 1
                              
                           
                        . 
                           
                              kstest
                           
                           2
                           =
                           0
                         means that these absolute derivatives of the spectrum in 
                           
                              
                                 Peak
                              
                              
                                 m
                              
                           
                         and these absolute derivatives in 
                           
                              
                                 B
                              
                              
                                 m
                              
                           
                         and 
                           
                              
                                 B
                              
                              
                                 m
                                 +
                                 1
                              
                           
                         are drawn from the same underlying data based on Kolmogorov–Smirnov (K–S) test with the significance level 5%. If they are drawn from the same underlying data, 
                           
                              
                                 Peak
                              
                              
                                 m
                              
                           
                         may be a broad peak and too much parts of it are mistaken as some parts of 
                           
                              
                                 B
                              
                              
                                 m
                              
                           
                         and 
                           
                              
                                 B
                              
                              
                                 m
                                 +
                                 1
                              
                           
                        . So slope information obtained from 
                           
                              
                                 B
                              
                              
                                 m
                              
                           
                         and 
                           
                              
                                 B
                              
                              
                                 m
                                 +
                                 1
                              
                           
                         contains wrong information from 
                           
                              
                                 Peak
                              
                              
                                 m
                              
                           
                         and use this slope information to represent the slopes in 
                           
                              
                                 Peak
                              
                              
                                 m
                              
                           
                         is improper. 
                           
                              Line
                           
                           (
                           
                              
                                 Peak
                              
                              
                                 m
                              
                           
                           )
                         is the slope of the straight line which connects both sides of 
                           
                              
                                 Peak
                              
                              
                                 m
                              
                           
                        . 
                           L
                           (
                           
                              
                                 B
                              
                              
                                 m
                              
                           
                           )
                         and 
                           L
                           (
                           
                              
                                 B
                              
                              
                                 m
                                 +
                                 1
                              
                           
                           )
                         represent the number of points in 
                           
                              
                                 B
                              
                              
                                 m
                              
                           
                         and 
                           
                              
                                 B
                              
                              
                                 m
                                 +
                                 1
                              
                           
                         respectively. 
                           L
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 B
                              
                              
                                 m
                              
                           
                           )
                         and 
                           L
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           ,
                           
                              
                                 B
                              
                              
                                 m
                                 +
                                 1
                              
                           
                           )
                         are distances from 
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                         to 
                           
                              
                                 B
                              
                              
                                 m
                              
                           
                         and 
                           
                              
                                 B
                              
                              
                                 m
                                 +
                                 1
                              
                           
                         respectively. 
                           d
                           (
                           
                              
                                 B
                              
                              
                                 m
                              
                           
                           )
                         is a value generated from a normal distribution with mean 
                           m
                           (
                           
                              
                                 B
                              
                              
                                 m
                              
                           
                           )
                         and standard deviation 
                           σ
                           (
                           
                              
                                 B
                              
                              
                                 m
                              
                           
                           )
                        . 
                           m
                           (
                           
                              
                                 B
                              
                              
                                 m
                              
                           
                           )
                         and 
                           σ
                           (
                           
                              
                                 B
                              
                              
                                 m
                              
                           
                           )
                         are mean and standard deviation of slops in 
                           
                              
                                 B
                              
                              
                                 m
                              
                           
                        . 
                           d
                           (
                           
                              
                                 B
                              
                              
                                 m
                                 +
                                 1
                              
                           
                           )
                         are generated by the same way used in 
                           d
                           (
                           
                              
                                 B
                              
                              
                                 m
                              
                           
                           )
                        , but 
                           
                              
                                 B
                              
                              
                                 m
                                 +
                                 1
                              
                           
                         is used instead of 
                           
                              
                                 B
                              
                              
                                 m
                              
                           
                        .

In order to avoid the influence of spikes, the neighbor baseline areas 
                           
                              
                                 B
                              
                              
                                 m
                              
                           
                         and 
                           
                              
                                 B
                              
                              
                                 m
                                 +
                                 1
                              
                           
                         on both sides of 
                           
                              
                                 Peak
                              
                              
                                 m
                              
                           
                         are defined as: if a wavelength point 
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                         belongs to 
                           
                              
                                 B
                              
                              
                                 m
                              
                           
                        , 
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                         must satisfy that 
                           min
                           ⁡
                           (
                           
                              
                                 x
                              
                              
                                 
                                    
                                       Peak
                                    
                                    
                                       m
                                    
                                 
                                 ,
                                 
                                    left
                                 
                              
                           
                           −
                           L
                           (
                           
                              
                                 Peak
                              
                              
                                 m
                              
                           
                           )
                           ,
                           
                              
                                 x
                              
                              
                                 
                                    
                                       Peak
                                    
                                    
                                       m
                                    
                                 
                                 ,
                                 
                                    left
                                 
                              
                           
                           −
                           
                              
                                 L
                              
                              
                                 b
                                 l
                              
                           
                           )
                           ≤
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           ≤
                           
                              
                                 x
                              
                              
                                 
                                    
                                       Peak
                                    
                                    
                                       m
                                    
                                 
                                 ,
                                 
                                    left
                                 
                              
                           
                           −
                           1
                         and 
                           
                              
                                 P
                              
                              
                                 1
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                           =
                           0
                        , 
                           
                              
                                 x
                              
                              
                                 
                                    
                                       Peak
                                    
                                    
                                       m
                                    
                                 
                                 ,
                                 
                                    left
                                 
                              
                           
                         is the left most position of 
                           
                              
                                 Peak
                              
                              
                                 m
                              
                           
                        . 
                           
                              
                                 L
                              
                              
                                 b
                                 l
                              
                           
                         is the length of a continuous baseline area which is adjacent to the left side of the peak. 
                           
                              
                                 B
                              
                              
                                 m
                                 +
                                 1
                              
                           
                         is defined by the way used in defining 
                           
                              
                                 B
                              
                              
                                 m
                              
                           
                        , but the right most position of the peak and a continuous baseline area located at the right side are used instead of 
                           
                              
                                 x
                              
                              
                                 
                                    
                                       Peak
                                    
                                    
                                       m
                                    
                                 
                                 ,
                                 
                                    left
                                 
                              
                           
                         and 
                           
                              
                                 L
                              
                              
                                 b
                                 l
                              
                           
                        .

With the deepening of the correction process, the area of a peak becoming clearer and some peaks become very broad, the information from these peak regions can't be ignored. At this condition, slopes of baseline in peak regions are represented by the slope of a straight line which connects both sides of the peak and the value of 
                           d
                           b
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                         in these peak regions should be modified. A peak is considered to be very broad if the length of a peak is larger than the sum of number of points in its neighbor baseline areas. Here, the peak and its neighbor baseline areas are defined by the way used in defining 
                           
                              
                                 Peak
                              
                              
                                 m
                              
                           
                           ,
                           
                              
                                 B
                              
                              
                                 m
                              
                           
                         and 
                           
                              
                                 B
                              
                              
                                 m
                                 +
                                 1
                              
                           
                        , but 
                           
                              
                                 P
                              
                              
                                 
                                    Gen
                                 
                                 −
                                 1
                              
                           
                         is used here instead of 
                           
                              
                                 P
                              
                              
                                 1
                              
                           
                        .

By this way, the estimated baseline slope information 
                           d
                           b
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                         on the whole spectrum can be obtained. If 
                           d
                           b
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                           >
                           m
                           +
                           2
                           σ
                         or 
                           d
                           b
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                           <
                           m
                           −
                           2
                           σ
                        , the slope at 
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                         is abnormal and its influence will be eliminated in calculating m and σ. m and σ are mean and standard deviation of slope of all remaining points respectively. Then the process continues until slopes at all remaining wavelength values are in the normal range 
                           [
                           m
                           −
                           2
                           σ
                           ,
                           m
                           +
                           2
                           σ
                           ]
                        . The normal global slope range is larger than 
                           
                              
                                 S
                              
                              
                                 
                                    global
                                 
                              
                              
                                 Low
                              
                           
                           =
                           m
                           −
                           2
                           σ
                         and lower than 
                           
                              
                                 S
                              
                              
                                 
                                    global
                                 
                              
                              
                                 High
                              
                           
                           =
                           m
                           +
                           2
                           σ
                        . Because 
                           
                              
                                 S
                              
                              
                                 
                                    global
                                 
                              
                              
                                 High
                              
                           
                         and 
                           
                              
                                 S
                              
                              
                                 
                                    global
                                 
                              
                              
                                 Low
                              
                           
                         are obtained based on the information of the whole spectrum, so they are called global slope information.

To further identify whether a point 
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                         is in a peak range, a straight line (
                           
                              
                                 L
                              
                              
                                 m
                                 ,
                                 
                                    global
                                 
                              
                              
                                 High
                              
                           
                        ) is drawn from the nearest point in the most likely baseline part of the left neighbor baseline region 
                           
                              
                                 B
                              
                              
                                 m
                              
                           
                         with slope 
                           
                              
                                 S
                              
                              
                                 
                                    global
                                 
                              
                              
                                 High
                              
                           
                        . Also, a straight line (
                           
                              
                                 L
                              
                              
                                 m
                                 +
                                 1
                                 ,
                                 
                                    global
                                 
                              
                              
                                 Low
                              
                           
                        ) is drawn from the other neighbor region 
                           
                              
                                 B
                              
                              
                                 m
                                 +
                                 1
                              
                           
                         with slope 
                           
                              
                                 S
                              
                              
                                 
                                    global
                                 
                              
                              
                                 Low
                              
                           
                        . The nearest points in region 
                           
                              
                                 B
                              
                              
                                 m
                              
                           
                         and 
                           
                              
                                 B
                              
                              
                                 m
                                 +
                                 1
                              
                           
                         are decided by the normal global and local slope information. Then whether 
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                         belongs to baselines or peaks is decided by:
                           
                              (7)
                              
                                 
                                    {
                                    
                                       
                                          
                                             
                                                
                                                   P
                                                
                                                
                                                   2
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                             =
                                             1
                                          
                                          
                                             if
                                             
                                             y
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                             >
                                             min
                                             ⁡
                                             (
                                             
                                                
                                                   L
                                                
                                                
                                                   m
                                                   ,
                                                   
                                                      global
                                                   
                                                
                                                
                                                   High
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                             ,
                                             
                                                
                                                   L
                                                
                                                
                                                   m
                                                   +
                                                   1
                                                   ,
                                                   
                                                      global
                                                   
                                                
                                                
                                                   Low
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                             )
                                          
                                       
                                       
                                          
                                             
                                                
                                                   P
                                                
                                                
                                                   2
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                             =
                                             0
                                          
                                          
                                             otherwise
                                          
                                       
                                    
                                 
                              
                           
                         where, 
                           
                              
                                 L
                              
                              
                                 m
                                 ,
                                 
                                    global
                                 
                              
                              
                                 High
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                         and 
                           
                              
                                 L
                              
                              
                                 m
                                 +
                                 1
                                 ,
                                 
                                    globa
                                 
                                 l
                              
                              
                                 Low
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                         are the corresponding value of 
                           
                              
                                 L
                              
                              
                                 m
                                 ,
                                 
                                    global
                                 
                              
                              
                                 High
                              
                           
                         and 
                           
                              
                                 L
                              
                              
                                 m
                                 +
                                 1
                                 ,
                                 
                                    global
                                 
                              
                              
                                 Low
                              
                           
                         at 
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                         respectively. 
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                         is identified again as belonging to a peak region if 
                           
                              
                                 P
                              
                              
                                 2
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                           =
                           1
                        . 
                           y
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                           >
                           
                              
                                 L
                              
                              
                                 m
                                 ,
                                 
                                    global
                                 
                              
                              
                                 High
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                         means that slopes at some wavelength points in any curve which connects 
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                         and the baseline region 
                           
                              
                                 B
                              
                              
                                 m
                              
                           
                         exceeds the normal range 
                           
                              
                                 S
                              
                              
                                 
                                    global
                                 
                              
                              
                                 High
                              
                           
                        , so 
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                         is re-identified in a peak by global slope normal range. Fig. 2
                         shows the peak distribution (
                           
                              
                                 P
                              
                              
                                 2
                              
                           
                        ) obtained by using global slope information.


                        
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                         is in 
                           
                              
                                 Peak
                              
                              
                                 m
                              
                           
                         that is initially identified by 
                           
                              
                                 P
                              
                              
                                 1
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                           =
                           1
                         but not further confirms by global information because 
                           
                              
                                 P
                              
                              
                                 2
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                           =
                           0
                        . In this section, local slope information will be used to identify whether it is in a peak range further.

The normal local slope range of 
                           
                              
                                 B
                              
                              
                                 m
                              
                           
                         is calculated by the same method used in calculating the normal global slope and is larger than 
                           
                              
                                 S
                              
                              
                                 m
                                 ,
                                 
                                    local
                                 
                              
                              
                                 Low
                              
                           
                           =
                           m
                           −
                           2
                           σ
                         and lower than 
                           
                              
                                 S
                              
                              
                                 m
                                 ,
                                 
                                    local
                                 
                              
                              
                                 High
                              
                           
                           =
                           m
                           +
                           2
                           σ
                        . m is the mean and σ is the standard deviation of slopes at all remaining wavelength points in 
                           
                              
                                 B
                              
                              
                                 m
                              
                           
                        . Because 
                           
                              
                                 S
                              
                              
                                 m
                                 ,
                                 
                                    local
                                 
                              
                              
                                 High
                              
                           
                         and 
                           
                              
                                 S
                              
                              
                                 m
                                 ,
                                 
                                    local
                                 
                              
                              
                                 Low
                              
                           
                         are obtained based on only one preliminary identified baseline band 
                           
                              
                                 B
                              
                              
                                 m
                              
                           
                         on a spectrum, so they are called local slope information. 
                           
                              
                                 S
                              
                              
                                 m
                                 +
                                 1
                                 ,
                                 
                                    local
                                 
                              
                              
                                 High
                              
                           
                         and 
                           
                              
                                 S
                              
                              
                                 m
                                 +
                                 1
                                 ,
                                 
                                    local
                                 
                              
                              
                                 Low
                              
                           
                         are the normal local slope range of 
                           
                              
                                 B
                              
                              
                                 m
                                 +
                                 1
                              
                           
                        .

The effective scopes of local slope information are their neighboring regions and how to decide the exact scope is difficult. So 
                           [
                           
                              
                                 C
                              
                              
                                 low
                              
                           
                           ,
                           
                              
                                 C
                              
                              
                                 high
                              
                           
                           ]
                         the normal ranges of 
                           
                              
                                 d
                              
                              
                                 2
                              
                           
                           b
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                         which represents the slope change rate at 
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                         are used to decide the change rate of 
                           
                              
                                 S
                              
                              
                                 m
                                 ,
                                 
                                    local
                                 
                              
                              
                                 High
                              
                           
                         and 
                           
                              
                                 S
                              
                              
                                 m
                                 ,
                                 
                                    local
                                 
                              
                              
                                 Low
                              
                           
                         when a point is outside the region 
                           
                              
                                 B
                              
                              
                                 m
                              
                           
                        . 
                           [
                           
                              
                                 C
                              
                              
                                 low
                              
                           
                           ,
                           
                              
                                 C
                              
                              
                                 high
                              
                           
                           ]
                         are obtained from initially identified baseline areas with the same method used in determining the normal local and global slope range. Here a Savitzky–Gloay filter is used to suppress the fast varying components of the slope 
                           d
                           b
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                         which are usually caused by remaining noise and then 
                           d
                           
                              
                                 b
                              
                              
                                 ¯
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                         is got. 
                           d
                           
                              
                                 b
                              
                              
                                 ¯
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                           =
                           smoothing
                           (
                           d
                           b
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                           ,
                           
                              
                                 N
                              
                              
                                 2
                              
                           
                           )
                        , 
                           
                              
                                 d
                              
                              
                                 2
                              
                           
                           b
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                           =
                           d
                           
                              
                                 b
                              
                              
                                 ¯
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                                 +
                                 1
                              
                           
                           )
                           −
                           d
                           
                              
                                 b
                              
                              
                                 ¯
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                        , 
                           
                              
                                 N
                              
                              
                                 2
                              
                           
                         is the number of neighboring data points on the either side of 
                           d
                           b
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                        .

Whether 
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                         belongs to a baseline or peak area is redefined by 
                           
                              
                                 P
                              
                              
                                 3
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                        . 
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                         is identified again as belonging to a peak region if 
                           
                              
                                 P
                              
                              
                                 3
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                           =
                           1
                        .
                           
                              (8)
                              
                                 
                                    
                                       {
                                       
                                          
                                             
                                                
                                                   
                                                      P
                                                   
                                                   
                                                      3
                                                   
                                                
                                                (
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      i
                                                   
                                                
                                                )
                                                =
                                                1
                                             
                                             
                                                if
                                                
                                                y
                                                (
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      i
                                                   
                                                
                                                )
                                                >
                                                min
                                                ⁡
                                                (
                                                
                                                   
                                                      curve
                                                   
                                                   
                                                      
                                                         
                                                            B
                                                         
                                                         
                                                            m
                                                         
                                                      
                                                   
                                                
                                                (
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      i
                                                   
                                                
                                                )
                                                ,
                                                
                                                   
                                                      curve
                                                   
                                                   
                                                      
                                                         
                                                            B
                                                         
                                                         
                                                            m
                                                            +
                                                            1
                                                         
                                                      
                                                   
                                                
                                                (
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      i
                                                   
                                                
                                                )
                                                )
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      P
                                                   
                                                   
                                                      3
                                                   
                                                
                                                (
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      i
                                                   
                                                
                                                )
                                                =
                                                0
                                             
                                             
                                                otherwise
                                             
                                          
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          s
                                       
                                       
                                          
                                             
                                                B
                                             
                                             
                                                m
                                             
                                          
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    =
                                    
                                       
                                          S
                                       
                                       
                                          m
                                          ,
                                          
                                             local
                                          
                                       
                                       
                                          High
                                       
                                    
                                    +
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    −
                                    
                                       
                                          x
                                       
                                       
                                          
                                             
                                                B
                                             
                                             
                                                m
                                             
                                          
                                       
                                    
                                    )
                                    
                                       
                                          C
                                       
                                       
                                          High
                                       
                                    
                                    ,
                                 
                              
                              
                                 
                                    
                                       
                                          curve
                                       
                                       
                                          
                                             
                                                B
                                             
                                             
                                                m
                                             
                                          
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    =
                                    y
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          
                                             
                                                B
                                             
                                             
                                                m
                                             
                                          
                                       
                                    
                                    )
                                    +
                                    
                                       ∑
                                       
                                          t
                                          =
                                          
                                             
                                                x
                                             
                                             
                                                
                                                   
                                                      B
                                                   
                                                   
                                                      m
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                x
                                             
                                             
                                                i
                                             
                                          
                                          −
                                          1
                                       
                                    
                                    
                                       
                                          s
                                       
                                       
                                          
                                             
                                                B
                                             
                                             
                                                m
                                             
                                          
                                       
                                    
                                    (
                                    t
                                    )
                                    .
                                 
                              
                              
                                 
                                    
                                       
                                          s
                                       
                                       
                                          
                                             
                                                B
                                             
                                             
                                                m
                                                +
                                                1
                                             
                                          
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    =
                                    
                                       
                                          S
                                       
                                       
                                          m
                                          +
                                          1
                                          ,
                                          
                                             local
                                          
                                       
                                       
                                          Low
                                       
                                    
                                    −
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          
                                             
                                                B
                                             
                                             
                                                m
                                                +
                                                1
                                             
                                          
                                       
                                    
                                    −
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    
                                       
                                          C
                                       
                                       
                                          Low
                                       
                                    
                                    ,
                                 
                              
                              
                                 
                                    
                                       
                                          curve
                                       
                                       
                                          
                                             
                                                B
                                             
                                             
                                                m
                                                +
                                                1
                                             
                                          
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    =
                                    y
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          
                                             
                                                B
                                             
                                             
                                                m
                                                +
                                                1
                                             
                                          
                                       
                                    
                                    )
                                    −
                                    
                                       ∑
                                       
                                          t
                                          =
                                          
                                             
                                                x
                                             
                                             
                                                i
                                             
                                          
                                          +
                                          1
                                       
                                       
                                          
                                             x
                                          
                                          
                                             
                                                
                                                   B
                                                
                                                
                                                   m
                                                   +
                                                   1
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          s
                                       
                                       
                                          
                                             
                                                B
                                             
                                             
                                                m
                                                +
                                                1
                                             
                                          
                                       
                                    
                                    (
                                    t
                                    )
                                    .
                                 
                              
                           
                         
                        
                           (
                           
                              
                                 x
                              
                              
                                 
                                    
                                       B
                                    
                                    
                                       m
                                    
                                 
                              
                           
                           ,
                           y
                           (
                           
                              
                                 x
                              
                              
                                 
                                    
                                       B
                                    
                                    
                                       m
                                    
                                 
                              
                           
                           )
                           )
                         and 
                           (
                           
                              
                                 x
                              
                              
                                 
                                    
                                       B
                                    
                                    
                                       m
                                       +
                                       1
                                    
                                 
                              
                           
                           ,
                           y
                           (
                           
                              
                                 x
                              
                              
                                 
                                    
                                       B
                                    
                                    
                                       m
                                       +
                                       1
                                    
                                 
                              
                           
                           )
                           )
                         are nearest points of the most likely baseline part in 
                           
                              
                                 B
                              
                              
                                 m
                              
                           
                         and 
                           
                              
                                 B
                              
                              
                                 m
                                 +
                                 1
                              
                           
                        . 
                           
                              
                                 s
                              
                              
                                 
                                    
                                       B
                                    
                                    
                                       m
                                    
                                 
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                         and 
                           
                              
                                 s
                              
                              
                                 
                                    
                                       B
                                    
                                    
                                       m
                                       +
                                       1
                                    
                                 
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                         are slopes of 
                           
                              
                                 curve
                              
                              
                                 
                                    
                                       B
                                    
                                    
                                       m
                                    
                                 
                              
                           
                         and 
                           
                              
                                 curve
                              
                              
                                 
                                    
                                       B
                                    
                                    
                                       m
                                       +
                                       1
                                    
                                 
                              
                           
                         at 
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                        . 
                           
                              
                                 C
                              
                              
                                 High
                              
                           
                         and 
                           
                              
                                 C
                              
                              
                                 Low
                              
                           
                         are the upper and lower boundary of 
                           
                              
                                 d
                              
                              
                                 2
                              
                           
                           b
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                        .

Because the bounds of the normal range of 
                           
                              
                                 d
                              
                              
                                 2
                              
                           
                           b
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                         and the normal local slope range are used, 
                           
                              
                                 curve
                              
                              
                                 
                                    
                                       B
                                    
                                    
                                       m
                                    
                                 
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                         and 
                           
                              
                                 curve
                              
                              
                                 
                                    
                                       B
                                    
                                    
                                       m
                                       +
                                       1
                                    
                                 
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                         give the upper bound of the possible baseline. Some points with a higher value than 
                           min
                           ⁡
                           (
                           
                              
                                 curve
                              
                              
                                 
                                    
                                       B
                                    
                                    
                                       m
                                    
                                 
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                           ,
                           
                              
                                 curve
                              
                              
                                 
                                    
                                       B
                                    
                                    
                                       m
                                       +
                                       1
                                    
                                 
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                           )
                         may also belong to baseline areas, so 
                           
                              
                                 P
                              
                              
                                 3
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                         is a strict definition of the peak distribution. Fig. 3
                         shows the peak distribution (
                           
                              
                                 P
                              
                              
                                 3
                              
                           
                        ) obtained by strict boundary definition.

Looser bounds of the possible baseline are also obtained based on a hypothesis that the effective domains of local information include their adjacent continuous peak range.

A straight line (
                           
                              
                                 L
                              
                              
                                 m
                                 ,
                                 
                                    local
                                 
                              
                              
                                 High
                              
                           
                        ) is drawn from the nearest point of the most likely baseline part in 
                           
                              
                                 B
                              
                              
                                 m
                              
                           
                         with slope 
                           
                              
                                 S
                              
                              
                                 m
                                 ,
                                 
                                    local
                                 
                              
                              
                                 High
                              
                           
                        . Also, A straight line (
                           
                              
                                 L
                              
                              
                                 m
                                 +
                                 1
                                 ,
                                 
                                    local
                                 
                              
                              
                                 Low
                              
                           
                        ) is drawn from the other neighbor region 
                           
                              
                                 B
                              
                              
                                 m
                                 +
                                 1
                              
                           
                         with slope 
                           
                              
                                 S
                              
                              
                                 m
                                 +
                                 1
                                 ,
                                 
                                    local
                                 
                              
                              
                                 Low
                              
                           
                        . Then the looser definition of the possible peak distribution 
                           
                              
                                 P
                              
                              
                                 4
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                         are obtained:
                           
                              (9)
                              
                                 
                                    {
                                    
                                       
                                          
                                             
                                                
                                                   P
                                                
                                                
                                                   4
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                             =
                                             1
                                          
                                          
                                             if
                                             
                                             y
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                             >
                                             min
                                             ⁡
                                             (
                                             
                                                
                                                   L
                                                
                                                
                                                   m
                                                   ,
                                                   
                                                      local
                                                   
                                                
                                                
                                                   High
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                             ,
                                             
                                                
                                                   L
                                                
                                                
                                                   m
                                                   +
                                                   1
                                                   ,
                                                   
                                                      local
                                                   
                                                
                                                
                                                   Low
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                             )
                                          
                                       
                                       
                                          
                                          
                                             and
                                             
                                             
                                             
                                                err
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                             >
                                             
                                                mean
                                             
                                             (
                                             
                                                err
                                             
                                             )
                                          
                                       
                                       
                                          
                                             
                                                
                                                   P
                                                
                                                
                                                   4
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                             =
                                             
                                                
                                                   P
                                                
                                                
                                                   3
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                          
                                          
                                             otherwise
                                             
                                          
                                       
                                    
                                 
                              
                           
                         
                        
                           
                              err
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                           =
                           y
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                           −
                           
                              Line
                           
                           (
                           
                              
                                 Peak
                              
                              
                                 m
                              
                           
                           )
                        . 
                           
                              mean
                           
                           (
                           
                              err
                           
                           )
                         is the mean value of 
                           
                              err
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                        . 
                           
                              Line
                           
                           (
                           
                              
                                 Peak
                              
                              
                                 m
                              
                           
                           )
                         is a straight line which connects both sides of 
                           
                              
                                 Peak
                              
                              
                                 m
                              
                           
                        . 
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                         is identified belonging to a peak region based on the looser definition 
                           
                              
                                 P
                              
                              
                                 4
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                           =
                           1
                        . Fig. 4
                         shows the looser peak distribution (
                           
                              
                                 P
                              
                              
                                 4
                              
                           
                        ). Looser boundary 
                           min
                           ⁡
                           (
                           
                              
                                 L
                              
                              
                                 m
                                 ,
                                 
                                    local
                                 
                              
                              
                                 High
                              
                           
                           ,
                           
                              
                                 L
                              
                              
                                 m
                                 +
                                 1
                                 ,
                                 
                                    local
                                 
                              
                              
                                 Low
                              
                           
                           )
                         is lower than corresponding values on strict boundary 
                           min
                           ⁡
                           (
                           
                              
                                 curve
                              
                              
                                 
                                    
                                       B
                                    
                                    
                                       m
                                    
                                 
                              
                           
                           ,
                           
                              
                                 curve
                              
                              
                                 
                                    
                                       B
                                    
                                    
                                       m
                                       +
                                       1
                                    
                                 
                              
                           
                           )
                        .

If the result of 
                           
                              
                                 P
                              
                              
                                 1
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                         is wrong and 
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                         is in a baseline area, there must be a curve which connects 
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           ,
                           y
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                           )
                         and all points in neighbor baseline area and the slope at each point on the curve should be in the normal global slope range. Looser and strict boundaries also should be defined based on real baseline areas.

However, there must be some peaks which are mistaken as baseline areas because 
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                         is defined in baseline areas only needs the recognition of one individual curve. So only the most likely baseline parts in a neighbor baseline region will be considered.

Region 
                           
                              
                                 B
                              
                              
                                 m
                              
                           
                         is on the left of 
                           
                              
                                 Peak
                              
                              
                                 m
                              
                           
                         and 
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           ∈
                           
                              
                                 Peak
                              
                              
                                 m
                              
                           
                        . In the region 
                           
                              
                                 B
                              
                              
                                 m
                              
                           
                        , the most likely baseline parts locate at 
                           
                              
                                 x
                              
                              
                                 m
                                 ,
                                 
                                    low
                                 
                              
                           
                         and its neighborhood. 
                           y
                           (
                           
                              
                                 x
                              
                              
                                 m
                                 ,
                                 
                                    low
                                 
                              
                           
                           )
                         is the lowest value at all wavelength points in the region 
                           
                              
                                 B
                              
                              
                                 m
                              
                           
                           =
                           {
                           
                              
                                 x
                              
                              
                                 m
                                 ,
                                 1
                              
                           
                           ,
                           
                              
                                 x
                              
                              
                                 m
                                 ,
                                 2
                              
                           
                           ,
                           ⋯
                           ,
                           
                              
                                 x
                              
                              
                                 m
                                 ,
                                 
                                    low
                                 
                              
                           
                           ,
                           ⋯
                           ,
                           
                              
                                 x
                              
                              
                                 m
                                 ,
                                 l
                              
                           
                           ,
                           ⋯
                           ,
                           
                              
                                 x
                              
                              
                                 m
                                 ,
                                 L
                              
                           
                           }
                        . The neighborhood is decided by normal global and local information:
                           
                              (1)
                              Make straight lines from 
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          m
                                          ,
                                          
                                             low
                                          
                                       
                                    
                                    ,
                                    y
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          m
                                          ,
                                          
                                             low
                                          
                                       
                                    
                                    )
                                    )
                                  to every point on the right side of it in the region 
                                    
                                       
                                          B
                                       
                                       
                                          m
                                       
                                    
                                  respectively, because 
                                    
                                       
                                          Peak
                                       
                                       
                                          m
                                       
                                    
                                  is on the right side of 
                                    
                                       
                                          B
                                       
                                       
                                          m
                                       
                                    
                                 .

Calculate slopes of these straight lines and get 
                                    
                                       
                                          S
                                       
                                       
                                          
                                             low
                                          
                                          ,
                                          
                                             low
                                          
                                          +
                                          1
                                       
                                    
                                    ,
                                    
                                       
                                          S
                                       
                                       
                                          
                                             low
                                          
                                          ,
                                          
                                             low
                                          
                                          +
                                          2
                                       
                                    
                                    ,
                                    ⋯
                                    ,
                                    
                                       
                                          S
                                       
                                       
                                          
                                             low
                                          
                                          ,
                                          l
                                       
                                    
                                    ,
                                    ⋯
                                    
                                       
                                          S
                                       
                                       
                                          
                                             low
                                          
                                          ,
                                          L
                                       
                                    
                                 . Here, 
                                    
                                       
                                          S
                                       
                                       
                                          
                                             low
                                          
                                          ,
                                          l
                                       
                                    
                                  is the slope of the straight line which connects 
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          m
                                          ,
                                          
                                             low
                                          
                                       
                                    
                                    ,
                                    y
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          m
                                          ,
                                          
                                             low
                                          
                                       
                                    
                                    )
                                    )
                                  and 
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          m
                                          ,
                                          l
                                       
                                    
                                    ,
                                    y
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          m
                                          ,
                                          l
                                       
                                    
                                    )
                                    )
                                 . 
                                    
                                       
                                          x
                                       
                                       
                                          m
                                          ,
                                          l
                                       
                                    
                                  is in 
                                    
                                       
                                          B
                                       
                                       
                                          m
                                       
                                    
                                  and on the right side of 
                                    
                                       
                                          x
                                       
                                       
                                          m
                                          ,
                                          
                                             low
                                          
                                       
                                    
                                 .


                                 
                                    
                                       
                                          x
                                       
                                       
                                          m
                                          ,
                                          k
                                       
                                    
                                  is the nearest wavelength value in the most likely baseline part of 
                                    
                                       
                                          B
                                       
                                       
                                          m
                                       
                                    
                                  to 
                                    
                                       
                                          Peak
                                       
                                       
                                          m
                                       
                                    
                                 , if 
                                    
                                       
                                          S
                                       
                                       
                                          
                                             low
                                          
                                          ,
                                          k
                                       
                                    
                                    ≤
                                    min
                                    ⁡
                                    (
                                    
                                       
                                          S
                                       
                                       
                                          
                                             global
                                          
                                       
                                       
                                          High
                                       
                                    
                                    ,
                                    
                                       
                                          S
                                       
                                       
                                          m
                                          ,
                                          
                                             local
                                          
                                       
                                       
                                          High
                                       
                                    
                                    )
                                 , 
                                    
                                       
                                          S
                                       
                                       
                                          
                                             low
                                          
                                          ,
                                          l
                                       
                                    
                                    >
                                    min
                                    ⁡
                                    (
                                    
                                       
                                          S
                                       
                                       
                                          
                                             global
                                          
                                       
                                       
                                          High
                                       
                                    
                                    ,
                                    
                                       
                                          S
                                       
                                       
                                          m
                                          ,
                                          
                                             local
                                          
                                       
                                       
                                          High
                                       
                                    
                                    )
                                    ,
                                    l
                                    ∈
                                    [
                                    k
                                    +
                                    1
                                    ,
                                    L
                                    ]
                                  and 
                                    d
                                    
                                       
                                          y
                                       
                                       
                                          ¯
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          m
                                          ,
                                          k
                                       
                                    
                                    )
                                    ≤
                                    min
                                    ⁡
                                    (
                                    
                                       
                                          S
                                       
                                       
                                          
                                             global
                                          
                                       
                                       
                                          High
                                       
                                    
                                    ,
                                    
                                       
                                          S
                                       
                                       
                                          m
                                          ,
                                          
                                             local
                                          
                                       
                                       
                                          High
                                       
                                    
                                    )
                                  at 
                                    
                                       
                                          x
                                       
                                       
                                          m
                                          ,
                                          k
                                       
                                    
                                 .

The nearest wavelength value of the most likely baseline part in 
                           
                              
                                 B
                              
                              
                                 m
                                 +
                                 1
                              
                           
                         is also decided by the above method. It is needed to replace every point on the right side of 
                           (
                           
                              
                                 x
                              
                              
                                 m
                                 ,
                                 
                                    low
                                 
                              
                           
                           ,
                           y
                           (
                           
                              
                                 x
                              
                              
                                 m
                                 ,
                                 
                                    low
                                 
                              
                           
                           )
                           )
                         with every point on the left side of 
                           (
                           
                              
                                 x
                              
                              
                                 m
                                 +
                                 1
                                 ,
                                 
                                    low
                                 
                              
                           
                           ,
                           y
                           (
                           
                              
                                 x
                              
                              
                                 m
                                 +
                                 1
                                 ,
                                 
                                    low
                                 
                              
                           
                           )
                           )
                         in 
                           
                              
                                 B
                              
                              
                                 m
                                 +
                                 1
                              
                           
                         and using 
                           
                              
                                 S
                              
                              
                                 
                                    global
                                 
                              
                              
                                 Low
                              
                           
                         and 
                           
                              
                                 S
                              
                              
                                 m
                                 +
                                 1
                                 ,
                                 
                                    local
                                 
                              
                              
                                 Low
                              
                           
                        .

Peak regions which are identified by preliminary information 
                           
                              
                                 P
                              
                              
                                 1
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                         are verified again by global slope information 
                           
                              
                                 P
                              
                              
                                 2
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                         or local slope information 
                           
                              
                                 P
                              
                              
                                 3
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                        . Then the peak region is decided by a strict definition:
                           
                              (10)
                              
                                 
                                    {
                                    
                                       
                                          
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             ∈
                                             baseline regions
                                          
                                          
                                             if
                                             
                                             
                                                
                                                   P
                                                
                                                
                                                   Gen
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                             =
                                             0
                                          
                                       
                                       
                                          
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             ∈
                                             peak regions
                                          
                                          
                                             else if
                                             
                                             
                                                
                                                   P
                                                
                                                
                                                   Gen
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                             =
                                             1
                                          
                                       
                                    
                                 
                              
                           
                         where 
                           
                              
                                 P
                              
                              
                                 Gen
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                           =
                           
                              
                                 P
                              
                              
                                 
                                    Gen
                                 
                                 −
                                 1
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                           ∨
                           (
                           
                              
                                 P
                              
                              
                                 1
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                           ∧
                           (
                           
                              
                                 P
                              
                              
                                 2
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                           ∨
                           
                              
                                 P
                              
                              
                                 3
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                           )
                           )
                        . Then modified 
                           
                              
                                 P
                              
                              
                                 Gen
                              
                           
                         by this way: 
                           
                              
                                 P
                              
                              
                                 Gen
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                           =
                           1
                         requires not only that the point 
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                         satisfies 
                           
                              
                                 P
                              
                              
                                 Gen
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                           =
                           1
                         but also that two of its neighbors do.

The peak region is decided by a loose definition:
                           
                              (11)
                              
                                 
                                    {
                                    
                                       
                                          
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             ∈
                                             baseline regions
                                          
                                          
                                             if
                                             
                                             
                                                
                                                   P
                                                
                                                
                                                   Gen
                                                
                                                
                                                   ′
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                             =
                                             0
                                          
                                       
                                       
                                          
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             ∈
                                             peak regions
                                          
                                          
                                             else if
                                             
                                             
                                                
                                                   P
                                                
                                                
                                                   Gen
                                                
                                                
                                                   ′
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                             =
                                             1
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                         where 
                           
                              
                                 P
                              
                              
                                 Gen
                              
                              
                                 ′
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                           =
                           
                              
                                 P
                              
                              
                                 
                                    Gen
                                 
                                 −
                                 1
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                           ∨
                           (
                           
                              
                                 P
                              
                              
                                 1
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                           ∧
                           (
                           
                              
                                 P
                              
                              
                                 2
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                           ∨
                           
                              
                                 P
                              
                              
                                 4
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                           )
                           )
                        . Modified 
                           
                              
                                 P
                              
                              
                                 Gen
                              
                              
                                 ′
                              
                           
                         by the same method as used in 
                           
                              
                                 P
                              
                              
                                 Gen
                              
                           
                        .

After peak detection, the data in peak regions should be replaced with some interpolated values which are the estimates of baseline. Slope information is used to get interpolated values in peak regions.

Supposing a peak region defined by 
                           
                              
                                 P
                              
                              
                                 Gen
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                         locates between baseline wavelength values 
                           
                              
                                 x
                              
                              
                                 b
                              
                           
                         and 
                           
                              
                                 x
                              
                              
                                 e
                              
                           
                         which locate in 
                           
                              
                                 B
                              
                              
                                 m
                              
                           
                         and 
                           
                              
                                 B
                              
                              
                                 m
                                 +
                                 1
                              
                           
                        . Slopes of the interpolated curve at 
                           
                              
                                 x
                              
                              
                                 b
                              
                           
                         and 
                           
                              
                                 x
                              
                              
                                 e
                              
                           
                         are 
                           d
                           c
                           (
                           
                              
                                 x
                              
                              
                                 b
                              
                           
                           )
                           =
                           min
                           ⁡
                           (
                           d
                           
                              
                                 y
                              
                              
                                 ¯
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 b
                              
                           
                           )
                           ,
                           
                              
                                 S
                              
                              
                                 m
                                 ,
                                 
                                    local
                                 
                              
                              
                                 High
                              
                           
                           )
                         and 
                           d
                           c
                           (
                           
                              
                                 x
                              
                              
                                 e
                              
                           
                           )
                           =
                           max
                           ⁡
                           (
                           d
                           
                              
                                 y
                              
                              
                                 ¯
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 e
                              
                           
                           )
                           ,
                           
                              
                                 S
                              
                              
                                 m
                                 +
                                 1
                                 ,
                                 
                                    local
                                 
                              
                              
                                 Low
                              
                           
                           )
                        . On the curve, there must be a point where the slope is the slope (
                           
                              
                                 d
                              
                              
                                 line
                              
                           
                        ) of the straight line (
                           
                              
                                 line
                              
                              
                                 
                                    
                                       x
                                    
                                    
                                       b
                                    
                                 
                                 ,
                                 
                                    
                                       x
                                    
                                    
                                       e
                                    
                                 
                              
                           
                        ) which connects 
                           (
                           
                              
                                 x
                              
                              
                                 b
                              
                           
                           ,
                           y
                           (
                           
                              
                                 x
                              
                              
                                 b
                              
                           
                           )
                           )
                         and 
                           (
                           
                              
                                 x
                              
                              
                                 e
                              
                           
                           ,
                           y
                           (
                           
                              
                                 x
                              
                              
                                 e
                              
                           
                           )
                           )
                        . Then the slope (
                           d
                           c
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                        ) of the interpolated curve uniformly changes from 
                           d
                           c
                           (
                           
                              
                                 x
                              
                              
                                 b
                              
                           
                           )
                         to 
                           
                              
                                 d
                              
                              
                                 line
                              
                           
                         and then to 
                           d
                           c
                           (
                           
                              
                                 x
                              
                              
                                 e
                              
                           
                           )
                        . By this way, the slope (
                           d
                           c
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                        ) in the interpolated curve in a peak are gotten. Interpolated values are obtained by integrating the estimated slopes. However direct integration of 
                           d
                           c
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                         makes some mismatched values since the 
                           d
                           c
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                         is only an estimate of slope information, especially on boundaries of a peak. So linear interpolation also used.
                           
                              (12)
                              
                                 s
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       i
                                    
                                 
                                 )
                                 =
                                 d
                                 c
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       i
                                    
                                 
                                 )
                                 −
                                 
                                    mean
                                 
                                 
                                    (
                                    d
                                    c
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    )
                                 
                              
                           
                        
                        
                           
                              (13)
                              
                                 
                                    
                                       y
                                    
                                    
                                       ′
                                    
                                 
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       i
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       line
                                    
                                    
                                       
                                          
                                             x
                                          
                                          
                                             b
                                          
                                       
                                       ,
                                       
                                          
                                             x
                                          
                                          
                                             e
                                          
                                       
                                    
                                 
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       i
                                    
                                 
                                 )
                                 +
                                 
                                    ∑
                                    
                                       t
                                       =
                                       
                                          
                                             x
                                          
                                          
                                             b
                                          
                                       
                                    
                                    
                                       
                                          
                                             x
                                          
                                          
                                             i
                                          
                                       
                                       −
                                       1
                                    
                                 
                                 s
                                 (
                                 t
                                 )
                              
                           
                        
                     

After interpolation, the spectrum is modified as
                           
                              (14)
                              
                                 
                                    
                                       y
                                    
                                    
                                       ′
                                    
                                 
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       i
                                    
                                 
                                 )
                                 =
                                 
                                    {
                                    
                                       
                                          
                                             
                                                
                                                   y
                                                
                                                
                                                   ′
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                          
                                          
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             ∈
                                             peak regions
                                          
                                       
                                       
                                          
                                             y
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                          
                                          
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             ∈
                                             baseline regions
                                          
                                       
                                    
                                 
                              
                           
                         and the result of interpolation is presented in Fig. 5
                        .

The structure of an estimated baseline model is constructed by GP. After that, the weighted least square method is applied to estimate unknown parameters. The structure of an estimated baseline model can be expressed as:
                           
                              (15)
                              
                                 
                                    
                                       b
                                    
                                    
                                       ˆ
                                    
                                 
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       i
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       c
                                    
                                    
                                       1
                                    
                                 
                                 
                                    
                                       f
                                    
                                    
                                       1
                                    
                                 
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       i
                                    
                                 
                                 )
                                 +
                                 
                                    
                                       c
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       f
                                    
                                    
                                       2
                                    
                                 
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       i
                                    
                                 
                                 )
                                 +
                                 ⋯
                                 +
                                 
                                    
                                       c
                                    
                                    
                                       k
                                    
                                 
                                 
                                    
                                       f
                                    
                                    
                                       k
                                    
                                 
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       i
                                    
                                 
                                 )
                              
                           
                        
                     

Here 
                           
                              
                                 b
                              
                              
                                 ˆ
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                         is an estimated baseline value at 
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                        . The structure of 
                           
                              
                                 f
                              
                              
                                 k
                              
                           
                         and the number of k are defined by genetic programming automatically. Minimize Q and find C.
                           
                              (16)
                              
                                 
                                    min
                                 
                                 :
                                 
                                 Q
                                 =
                                 
                                    ∑
                                    
                                       i
                                       =
                                       1
                                    
                                    I
                                 
                                 
                                    
                                       β
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       (
                                       
                                          
                                             y
                                          
                                          
                                             ′
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             i
                                          
                                       
                                       )
                                       −
                                       
                                          
                                             b
                                          
                                          
                                             ˆ
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             i
                                          
                                       
                                       )
                                       )
                                    
                                    
                                       2
                                    
                                 
                                 .
                              
                           
                        
                     

Suppose there are M continuous peak areas (
                           
                              
                                 Peak
                              
                              
                                 m
                              
                           
                        , 
                           1
                           ≤
                           m
                           ≤
                           M
                        ) identified by 
                           
                              
                                 P
                              
                              
                                 Gen
                              
                           
                        . 
                           
                              
                                 x
                              
                              
                                 R
                                 ,
                                 
                                    
                                       Peak
                                    
                                    
                                       m
                                    
                                 
                              
                           
                         and 
                           
                              
                                 x
                              
                              
                                 L
                                 ,
                                 
                                    
                                       Peak
                                    
                                    
                                       m
                                    
                                 
                              
                           
                         are baseline wavelength values on both sides of 
                           
                              
                                 Peak
                              
                              
                                 m
                              
                           
                         based on 
                           
                              
                                 P
                              
                              
                                 Gen
                              
                           
                        . Then 
                           
                              
                                 β
                              
                              
                                 i
                              
                           
                         is defined as:
                           
                              
                                 
                                    
                                       β
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 
                                    {
                                    
                                       
                                          
                                             1
                                          
                                          
                                             if
                                             
                                             
                                                
                                                   P
                                                
                                                
                                                   Gen
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                             =
                                             0
                                             
                                             and
                                             
                                             
                                                
                                                   P
                                                
                                                
                                                   Gen
                                                
                                                
                                                   ′
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                             =
                                             0
                                          
                                       
                                       
                                          
                                             0.1
                                             
                                                
                                                   L
                                                   (
                                                   
                                                      
                                                         peak
                                                      
                                                      
                                                         m
                                                      
                                                   
                                                   )
                                                
                                                
                                                   L
                                                   (
                                                   
                                                      spectrum
                                                   
                                                   )
                                                
                                             
                                          
                                          
                                             if
                                             
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             ∈
                                             
                                                
                                                   Peak
                                                
                                                
                                                   m
                                                
                                             
                                             
                                             and
                                             
                                             
                                                
                                                   P
                                                
                                                
                                                   Gen
                                                
                                                
                                                   ′
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   R
                                                   ,
                                                   
                                                      
                                                         Peak
                                                      
                                                      
                                                         m
                                                      
                                                   
                                                
                                             
                                             )
                                             =
                                             0
                                          
                                       
                                       
                                          
                                          
                                             and
                                             
                                             
                                                
                                                   P
                                                
                                                
                                                   Gen
                                                
                                                
                                                   ′
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   L
                                                   ,
                                                   
                                                      
                                                         Peak
                                                      
                                                      
                                                         m
                                                      
                                                   
                                                
                                             
                                             )
                                             =
                                             0
                                          
                                       
                                       
                                          
                                             0
                                          
                                          
                                             if
                                             
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             ∈
                                             
                                                
                                                   Peak
                                                
                                                
                                                   m
                                                
                                             
                                             
                                             and
                                             
                                             (
                                             
                                                
                                                   P
                                                
                                                
                                                   Gen
                                                
                                                
                                                   ′
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   R
                                                   ,
                                                   
                                                      
                                                         Peak
                                                      
                                                      
                                                         m
                                                      
                                                   
                                                
                                             
                                             )
                                             =
                                             1
                                             
                                             or
                                          
                                       
                                       
                                          
                                          
                                             
                                                
                                                   P
                                                
                                                
                                                   Gen
                                                
                                                
                                                   ′
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   L
                                                   ,
                                                   
                                                      
                                                         Peak
                                                      
                                                      
                                                         m
                                                      
                                                   
                                                
                                             
                                             )
                                             =
                                             1
                                             )
                                          
                                       
                                    
                                 
                              
                           
                         
                        
                           L
                           (
                           
                              
                                 peak
                              
                              
                                 m
                              
                           
                           )
                         is the number of points in the peak, and 
                           L
                           (
                           
                              spectrum
                           
                           )
                         is the number of all points on the spectrum.

The minimization of Q leads to the following system of equations:
                           
                              (17)
                              
                                 
                                    
                                       
                                          d
                                          Q
                                       
                                       
                                          d
                                          C
                                       
                                    
                                    =
                                    0
                                    ⇒
                                    C
                                    =
                                    
                                       
                                          (
                                          
                                             
                                                F
                                             
                                             
                                                T
                                             
                                          
                                          β
                                          F
                                          )
                                       
                                       
                                          −
                                          1
                                       
                                    
                                    
                                       
                                          F
                                       
                                       
                                          T
                                       
                                    
                                    β
                                    Y
                                 
                              
                              
                                 
                                    C
                                    =
                                    
                                       [
                                       
                                          
                                             
                                                
                                                   
                                                      c
                                                   
                                                   
                                                      1
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      c
                                                   
                                                   
                                                      2
                                                   
                                                
                                             
                                          
                                          
                                             
                                                ⋮
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      c
                                                   
                                                   
                                                      K
                                                   
                                                
                                             
                                          
                                       
                                       ]
                                    
                                    ,
                                    
                                    F
                                    =
                                    
                                       [
                                       
                                          
                                             
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      1
                                                   
                                                
                                                (
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      1
                                                   
                                                
                                                )
                                             
                                             
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      2
                                                   
                                                
                                                (
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      1
                                                   
                                                
                                                )
                                             
                                             
                                                ⋯
                                             
                                             
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      k
                                                   
                                                
                                                (
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      1
                                                   
                                                
                                                )
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      1
                                                   
                                                
                                                (
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      2
                                                   
                                                
                                                )
                                             
                                             
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      2
                                                   
                                                
                                                (
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      2
                                                   
                                                
                                                )
                                             
                                             
                                                ⋯
                                             
                                             
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      k
                                                   
                                                
                                                (
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      2
                                                   
                                                
                                                )
                                             
                                          
                                          
                                             
                                                ⋯
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      1
                                                   
                                                
                                                (
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      I
                                                   
                                                
                                                )
                                             
                                             
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      2
                                                   
                                                
                                                (
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      I
                                                   
                                                
                                                )
                                             
                                             
                                                ⋯
                                             
                                             
                                                
                                                   
                                                      f
                                                   
                                                   
                                                      k
                                                   
                                                
                                                (
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      I
                                                   
                                                
                                                )
                                             
                                          
                                       
                                       ]
                                    
                                    ,
                                 
                              
                              
                                 
                                    β
                                    =
                                    
                                       diag
                                    
                                    (
                                    
                                       
                                          β
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    
                                       
                                          β
                                       
                                       
                                          2
                                       
                                    
                                    ,
                                    ⋯
                                    ,
                                    
                                       
                                          β
                                       
                                       
                                          I
                                       
                                    
                                    )
                                    ,
                                    
                                    Y
                                    =
                                    
                                       [
                                       
                                          
                                             
                                                y
                                                (
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      1
                                                   
                                                
                                                )
                                             
                                          
                                          
                                             
                                                y
                                                (
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      2
                                                   
                                                
                                                )
                                             
                                          
                                          
                                             
                                                ⋮
                                             
                                          
                                          
                                             
                                                y
                                                (
                                                
                                                   
                                                      x
                                                   
                                                   
                                                      I
                                                   
                                                
                                                )
                                             
                                          
                                       
                                       ]
                                    
                                    .
                                 
                              
                           
                        
                     

The fitness function provides criterion for each estimated baseline and offers guidance on searching direction. Whether an individual is better or worse is judged by it. So the fitness function has a crucial influence on a GP's performance. Generally, the fitness is designed as:
                           
                              (18)
                              
                                 
                                    min
                                 
                                 :
                                 
                                 
                                    Fit
                                 
                                 =
                                 
                                    ∑
                                    
                                       i
                                       =
                                       1
                                    
                                    I
                                 
                                 
                                    
                                       (
                                       e
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             i
                                          
                                       
                                       )
                                       )
                                    
                                    
                                       2
                                    
                                 
                              
                           
                         where, 
                           e
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                           =
                           
                              
                                 b
                              
                              
                                 ˆ
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                           −
                           y
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                        , 
                           i
                           =
                           1
                           ⋯
                           I
                         is number of points. 
                           
                              
                                 b
                              
                              
                                 ˆ
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                         is the value of the estimated baseline curve at 
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                        . This kind of fitness function is very sensitive to peaks, so it is not suitable for baseline correction.

Generally peak areas provide little useful information for baseline modeling, so in these regions, their effect should be reduced, smoothness is more important than the fitting error. But in baseline regions, the fitting error needs more attention.

Therefore the fitness function of an estimated baseline consists of the following parts:
                           
                              (19)
                              
                                 
                                    Fit
                                 
                                 (
                                 
                                    
                                       
                                          
                                             b
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                    
                                       j
                                    
                                 
                                 )
                                 =
                                 
                                    ∑
                                    
                                       i
                                       =
                                       1
                                    
                                    I
                                 
                                 
                                    
                                       β
                                    
                                    
                                       i
                                    
                                    
                                       ′
                                    
                                 
                                 
                                    
                                       (
                                       
                                          
                                             y
                                          
                                          
                                             ′
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             i
                                          
                                       
                                       )
                                       −
                                       
                                          
                                             
                                                
                                                   b
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                          
                                             j
                                          
                                       
                                       (
                                       
                                          
                                             x
                                          
                                          
                                             i
                                          
                                       
                                       )
                                       )
                                    
                                    
                                       2
                                    
                                 
                                 +
                                 
                                    ∑
                                    
                                       i
                                       =
                                       1
                                    
                                    I
                                 
                                 F
                                 
                                    (
                                    
                                       
                                          
                                             
                                                b
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          j
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    )
                                 
                              
                           
                         Here,
                           
                              
                                 
                                    
                                       β
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 
                                    {
                                    
                                       
                                          
                                             1
                                          
                                          
                                             if
                                             
                                             
                                                
                                                   P
                                                
                                                
                                                   Gen
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                             =
                                             0
                                             
                                             and
                                             
                                             
                                                
                                                   P
                                                
                                                
                                                   Gen
                                                
                                                
                                                   ′
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                             =
                                             0
                                          
                                       
                                       
                                          
                                             0.5
                                          
                                          
                                             if
                                             
                                             
                                                
                                                   P
                                                
                                                
                                                   Gen
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                             =
                                             0
                                             
                                             and
                                             
                                             
                                                
                                                   P
                                                
                                                
                                                   Gen
                                                
                                                
                                                   ′
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                             =
                                             1
                                          
                                       
                                       
                                          
                                             0.1
                                             
                                                
                                                   L
                                                   (
                                                   
                                                      
                                                         peak
                                                      
                                                      
                                                         m
                                                      
                                                   
                                                   )
                                                
                                                
                                                   L
                                                   (
                                                   
                                                      spectrum
                                                   
                                                   )
                                                
                                             
                                          
                                          
                                             if
                                             
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             ∈
                                             
                                                
                                                   Peak
                                                
                                                
                                                   m
                                                
                                             
                                             
                                             and
                                             
                                             
                                                
                                                   P
                                                
                                                
                                                   Gen
                                                
                                                
                                                   ′
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   R
                                                   ,
                                                   
                                                      
                                                         Peak
                                                      
                                                      
                                                         m
                                                      
                                                   
                                                
                                             
                                             )
                                             =
                                             0
                                          
                                       
                                       
                                          
                                          
                                             and
                                             
                                             
                                                
                                                   P
                                                
                                                
                                                   Gen
                                                
                                                
                                                   ′
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   L
                                                   ,
                                                   
                                                      
                                                         Peak
                                                      
                                                      
                                                         m
                                                      
                                                   
                                                
                                             
                                             )
                                             =
                                             0
                                          
                                       
                                       
                                          
                                             0
                                          
                                          
                                             if
                                             
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             ∈
                                             
                                                
                                                   Peak
                                                
                                                
                                                   m
                                                
                                             
                                             
                                             and
                                             
                                             (
                                             
                                                
                                                   P
                                                
                                                
                                                   Gen
                                                
                                                
                                                   ′
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   R
                                                   ,
                                                   
                                                      
                                                         Peak
                                                      
                                                      
                                                         m
                                                      
                                                   
                                                
                                             
                                             )
                                             =
                                             1
                                          
                                       
                                       
                                          
                                          
                                             or
                                             
                                             
                                                
                                                   P
                                                
                                                
                                                   Gen
                                                
                                                
                                                   ′
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   L
                                                   ,
                                                   
                                                      
                                                         Peak
                                                      
                                                      
                                                         m
                                                      
                                                   
                                                
                                             
                                             )
                                             =
                                             1
                                             )
                                          
                                       
                                    
                                 
                              
                           
                         ∑F is a penalty term based on how much the value of 
                           
                              
                                 
                                    
                                       b
                                    
                                    
                                       ˆ
                                    
                                 
                              
                              
                                 j
                              
                           
                         exceeds the possible upper boundary of baseline scope in peak areas and how much the value of 
                           
                              
                                 
                                    
                                       b
                                    
                                    
                                       ˆ
                                    
                                 
                              
                              
                                 j
                              
                           
                         is larger than the corresponding value on the spectrum in baseline areas. In a peak area, there is only little information for baseline estimation. But with global slope information, local slope information, and the normal slope change rate, the possible upper boundary of baseline scope in peak regions can be roughly estimated.
                           
                              (20)
                              
                                 F
                                 
                                    (
                                    
                                       
                                          
                                             
                                                b
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          j
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    )
                                 
                                 =
                                 
                                    {
                                    
                                       
                                          
                                             
                                                
                                                   (
                                                   
                                                      
                                                         
                                                            
                                                               b
                                                            
                                                            
                                                               ˆ
                                                            
                                                         
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   (
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   )
                                                   −
                                                   
                                                      Upper
                                                   
                                                   (
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   )
                                                   )
                                                
                                                
                                                   2
                                                
                                             
                                          
                                          
                                             if
                                             
                                             
                                                
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         ˆ
                                                      
                                                   
                                                
                                                
                                                   j
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                             >
                                             
                                                Upper
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                          
                                       
                                       
                                          
                                          
                                             and
                                             
                                             
                                                
                                                   P
                                                
                                                
                                                   Gen
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                             =
                                             1
                                          
                                       
                                       
                                          
                                             
                                                
                                                   (
                                                   
                                                      
                                                         
                                                            
                                                               b
                                                            
                                                            
                                                               ˆ
                                                            
                                                         
                                                      
                                                      
                                                         j
                                                      
                                                   
                                                   (
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   )
                                                   −
                                                   y
                                                   (
                                                   
                                                      
                                                         x
                                                      
                                                      
                                                         i
                                                      
                                                   
                                                   )
                                                   )
                                                
                                                
                                                   2
                                                
                                             
                                          
                                          
                                             if
                                             
                                             
                                                
                                                   
                                                      
                                                         b
                                                      
                                                      
                                                         ˆ
                                                      
                                                   
                                                
                                                
                                                   j
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                             >
                                             y
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                             +
                                             Δ
                                          
                                       
                                       
                                          
                                          
                                             and
                                             
                                             
                                                
                                                   P
                                                
                                                
                                                   Gen
                                                
                                             
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             )
                                             =
                                             0
                                          
                                       
                                    
                                 
                              
                           
                         Here, Δ is standard deviation of 
                           
                              
                                 
                                    
                                       b
                                    
                                    
                                       ˆ
                                    
                                 
                              
                              
                                 j
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                           −
                           y
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                         on baseline areas defined by 
                           
                              
                                 P
                              
                              
                                 Gen
                              
                           
                        . 
                           
                              Upper
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                         is the upper bound of possible baseline curve fluctuation at peaks.
                           
                              (21)
                              
                                 
                                    Upper
                                 
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       i
                                    
                                 
                                 )
                                 =
                                 min
                                 ⁡
                                 
                                    (
                                    
                                       
                                          L
                                       
                                       
                                          m
                                          ,
                                          
                                             global
                                          
                                       
                                       
                                          High
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    ,
                                    
                                       
                                          L
                                       
                                       
                                          m
                                          +
                                          1
                                          ,
                                          
                                             global
                                          
                                       
                                       
                                          Low
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    ,
                                    
                                       
                                          curve
                                       
                                       
                                          
                                             
                                                B
                                             
                                             
                                                m
                                             
                                          
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    ,
                                    
                                       
                                          curve
                                       
                                       
                                          
                                             
                                                B
                                             
                                             
                                                m
                                                +
                                                1
                                             
                                          
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    ,
                                    y
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    )
                                 
                              
                           
                        
                     


                        
                           
                              (1)
                              A random population of size N is created. Each individual is an estimate of baseline for the spectrum.

Estimate parameters and calculate the fitness value.

Get excellent community, obtain information 
                                    
                                       
                                          P
                                       
                                       
                                          1
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    )
                                 .

Reconfirm these peak regions with global slope information and obtain 
                                    
                                       
                                          P
                                       
                                       
                                          2
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    )
                                 .

Reconfirm these peak regions with local slope information, obtain 
                                    
                                       
                                          P
                                       
                                       
                                          3
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    )
                                  and 
                                    
                                       
                                          P
                                       
                                       
                                          4
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    )
                                 .

Obtain the present strict identified peak regions with 
                                    
                                       
                                          P
                                       
                                       
                                          Gen
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    )
                                  and loose peak definition 
                                    
                                       
                                          P
                                       
                                       
                                          Gen
                                       
                                       
                                          ′
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    )
                                 . 
                                    
                                       
                                          P
                                       
                                       
                                          
                                             Gen
                                          
                                          −
                                          1
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    =
                                    
                                       
                                          P
                                       
                                       
                                          Gen
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    )
                                 .

Use the selection, recombination, and mutation operator to generate a child population.

Back to step 2 until the final conditions are satisfied. Here final condition is considered to be reached when there are no new peak points founded and the fitness of the best individual doesn't improve for several consecutive generations.

Remove the estimated baseline 
                                    
                                       
                                          b
                                       
                                       
                                          ˆ
                                       
                                    
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    )
                                  from 
                                    y
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    )
                                 .

@&#EXPERIMENTAL RESULTS@&#

Three simulated spectral datasets and experimental spectra are used to validate the performance of the proposed method.

The simulated data imitate real spectral datasets that contain varying baseline, peaks, and random noise. Broad Gaussian peaks and linear lines are treated as baselines. Narrow Gaussian peaks are treated as peak signals. Spectra with a curved baseline, a double curved baseline and a sloping baseline are used to test the effectiveness of our proposed algorithm. The simulated peaks are three narrow Gaussian peaks, i.e:
                           
                              (22)
                              
                                 s
                                 (
                                 
                                    
                                       x
                                    
                                    
                                       i
                                    
                                 
                                 )
                                 =
                                 10
                                 exp
                                 ⁡
                                 
                                    (
                                    −
                                    
                                       
                                          
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             −
                                             100
                                             )
                                          
                                          
                                             2
                                          
                                       
                                       
                                          2
                                          ×
                                          
                                             
                                                5
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                    )
                                 
                                 +
                                 10
                                 exp
                                 ⁡
                                 
                                    (
                                    −
                                    
                                       
                                          
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             −
                                             200
                                             )
                                          
                                          
                                             2
                                          
                                       
                                       
                                          2
                                          ×
                                          
                                             
                                                20
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                    )
                                 
                                 +
                                 20
                                 exp
                                 ⁡
                                 
                                    (
                                    −
                                    
                                       
                                          
                                             (
                                             
                                                
                                                   x
                                                
                                                
                                                   i
                                                
                                             
                                             −
                                             400
                                             )
                                          
                                          
                                             2
                                          
                                       
                                       
                                          2
                                          ×
                                          
                                             
                                                20
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                    )
                                 
                                 .
                              
                           
                        
                     

Curved baseline is 
                           
                              
                                 b
                              
                              
                                 1
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                           =
                           100
                           exp
                           ⁡
                           (
                           −
                           
                              
                                 
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    −
                                    400
                                    )
                                 
                                 
                                    2
                                 
                              
                              
                                 2
                                 ×
                                 
                                    
                                       200
                                    
                                    
                                       2
                                    
                                 
                              
                           
                           )
                        , the sloping baseline is represented as 
                           
                              
                                 b
                              
                              
                                 2
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                           =
                           0.3
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                        , and the doubly curved baseline is represented as 
                           
                              
                                 b
                              
                              
                                 3
                              
                           
                           (
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           )
                           =
                           10
                           exp
                           ⁡
                           (
                           −
                           
                              
                                 
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    −
                                    450
                                    )
                                 
                                 
                                    2
                                 
                              
                              
                                 (
                                 200
                                 ×
                                 150
                                 )
                              
                           
                           )
                           +
                           10
                           exp
                           ⁡
                           (
                           −
                           
                              
                                 
                                    (
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    −
                                    20
                                    )
                                 
                                 
                                    2
                                 
                              
                              
                                 (
                                 200
                                 ×
                                 150
                                 )
                              
                           
                           )
                        . 
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           =
                           1
                           ,
                           2
                           ,
                           …
                           ,
                           500
                        . Noise is generated using random numbers between −1 and 1.


                        Fig. 6
                         shows performances with different initial situations for a sloping baseline. The values of the spectrum around the points 0, 300, and 480 are higher than the corresponding values of the initial estimated baseline 1. The values of the spectrum in the regions around the point 500 are higher than the corresponding values of the initial estimated baseline 2 and 3. But these regions belong to baseline regions in fact. No baseline areas are mistaken as peaks by the initial estimated baseline 4. Fig. 6 shows that Although our method starts with different fitted curves but all estimated baselines are satisfied in the end of the 4 correction processes.

In Figs. 7 and 8
                        
                        , the performance with different initial situations is shown on simulated spectra with a curve baseline or a double curve baseline. Although some different regions are falsely identified by the initial fitted curves, but all results are satisfied. the proposed GPEXI shows its effectiveness for different conditions.

The performances of the proposed GPEXI in the three kinds of baseline demonstrate its effectiveness. Although the proposed GPEXI starts with improper fitted curves, but with the help of the community information, all processes end with good results.

The results of other polynomial curve fitting methods are influenced by the polynomial orders and the threshold which can be chosen according to the noise level and the ratio between the points belonging to the baseline and those belonging to the peaks. Generally optimal values of the two parameters exist but it is difficult to define without priori knowledge of spectra. For some kinds of baseline, slight deviation from the optimum value may cause worse results.


                        Fig. 9
                         shows the results of polynomial curve fitting method with an asymmetrical cost function [12] on a simulated spectrum with a double curve baseline. Estimated baseline 1, 2, 3 and 4 are obtained when using 4, 5, 6, 7 polynomial order and their respective corresponding optimal thresholds 0.34, 0.30, 0.084, 0.029. The results are best when using 6 order and 4 order polynomial curve and the results are not guaranteed when using other orders. No-signal areas around 0 and 500 are mistaken as peaks by estimated baseline 1, areas around 500 are also mistaken as peaks by estimated baseline 3, and artificial peaks appear there. These errors around 500 become more severe when estimated baseline 2 is used. When estimated baseline 4 is used, some errors occur in the vicinity of 100 where some no-signal areas near the narrow peak are mistaken as peak areas. There are also some errors around 0 and 500 when using estimated baseline 4. The results grow worse when using other polynomial order. Different thresholds also influence the results, the results are less optimal when using improper thresholds.

Another polynomial curve fitting method with an asymmetrical truncated cost function [12] is also used on this simulated spectrum. The performance of this method is similar to the method with an asymmetrical cost function. Moreover, its performance is more sensitive to the value of thresholds. Other curve fitting methods [11,13,16] have almost the same performances.

From these tests, we can see the proposed baseline correction method is a robust and good choice, especially when there is no information about the spectra and smoothness of their baselines.

Dataset 1 is a FTIR spectrum of the Chinese liquor Guotai sample. The IR spectra in the region 
                           4000
                           –
                           650
                           
                           
                              
                                 cm
                              
                              
                                 −
                                 1
                              
                           
                         have been recorded with a Perkin-Elmer Spectrum GXFTIR spectrometer, equipped with the Universal ATR Sampling Accessory (ZnSecell). The spectral resolution is set at 
                           4
                           
                           
                              
                                 cm
                              
                              
                                 −
                                 1
                              
                           
                        . Dataset 2 is a NIR spectra of corn measured on spectrometers mp5. The spectrum is collected in 2 nm intervals within the spectral range 1100–2498 nm. The data set is available via Internet http://www.eigenvector.com/data/index.htm.

The performance of the proposed baseline correction algorithm on two real spectra is shown in Figs. 10 and 11
                        
                        . The values of the initial fitted curve 1 around 4000, the values of the initial fitted curve 2 around 3900 and 2500, the values fitted curve 3 around 1800, and the values of fitted curve 4 around 3900 and 2200 are lower than the corresponding values of the spectrum. These four correction processes of the proposed GPEXI start with different fitted curves but all processes end with almost same good results. We can see almost the same performance in Fig. 11. From the result in experimental data, the same conclusion as in the simulated data can be gotten. Without any information of the smoothness of a baseline in a spectrum and without predefining the smoothness of an estimated fitted curve, the proposed GPEXI can get a satisfied result in the end although it starts with improper fitted curves.

The performances of polynomial curve fitting method with an asymmetrical truncated cost function on FTIR spectrum of the Chinese liquor Guotai sample are shown in Figs. 12 and 13
                        
                        .

In Fig. 12, polynomial 3-order is selected because its performance is much better than the other polynomial orders. Estimated baseline 1, 2, 3 and 4 are obtained when using 3 polynomial order with respective thresholds 0.1, 0.05, 0.02, 0.01. Some values of estimated baseline 1 and 2 around 1900, 1100, and 900 are higher than their corresponding value of the spectrum. Compared with estimated baseline 1 and 2, estimated baseline 3 is better because fewer points have a bigger value on it than on the spectrum around areas 1900, 1100, and 900. The results mistake some peak areas as baseline areas when the thresholds become larger. But if the threshold becomes smaller, the performance changes greatly which can be shown by estimated baseline 4 when the threshold is 0.01. So the value of the threshold is closely related to the result, and it is not always easy to set.

In Fig. 13, the influences of different polynomial order with corresponding optimal thresholds are tested. Estimated baseline 1, 2, 3 and 4 are obtained when using 2, 3, 4 and 5 polynomial order with respective thresholds 0.03, 0.02, 0.03, 0.05. Some values of estimated baseline 2 and 3 around 1900, 1100 are higher than their corresponding value of the spectrum. Regions around 2700 and 1800 are identified as peaks by estimated baseline 1, but these regions 2700 are identified as no signal areas by estimated baseline 2, 3, and 4. Some areas around 4000 are identified as significant peaks when using 5-order. When selecting other polynomial orders, the performances change significantly and the results are not guaranteed.

Other polynomial curve fitting methods [11,13,16] generally have the same problem as polynomial curve fitting method with an asymmetrical truncated cost function and an asymmetrical cost function.

In the proposed method the parameter 
                           
                              
                                 N
                              
                              
                                 1
                              
                           
                         and 
                           
                              
                                 N
                              
                              
                                 2
                              
                           
                         in noise remove are robust for the results. These tests list above have different noise level, different kinds of baseline, and different ratio between the points belonging to peaks and all points on the spectrum, but the same values of 
                           
                              
                                 N
                              
                              
                                 1
                              
                           
                         and 
                           
                              
                                 N
                              
                              
                                 2
                              
                           
                         are used and all processes end with satisfied results. The processes with he value of 
                           
                              
                                 N
                              
                              
                                 1
                              
                           
                         from 30 to 60 and the value of 
                           
                              
                                 N
                              
                              
                                 2
                              
                           
                         from 30 to 60 can get good results. Furthermore, with spikes removing, the parameter which is related to the noise level needn't to be considered in our proposed method.

@&#CONCLUSION@&#

The interpretation of spectroscopic data is largely hampered by the baseline or trend problem. Many proposed automatic curve fitting methods need to predefine the curve order and thresholds. But how to set these parameters is based on the user's experience. Generally the performance of these automatic correction algorithms needs to be tested more times and then the final result is chosen from these tests based on the user's experience.

In this paper, a novel spectra baseline correction algorithm based on community information is presented. By exploiting the common characteristic of excellent community, peaks are distinguished from baseline areas. By relying on the excellent community, the global, local slope information is used to further identify the location of peaks. In addition, a weighted least squares algorithm is proposed to estimate the parameters of the fitting curve, which can help the algorithm to distinguish the different influence of the peak and the baseline region on the learning process.

The proposed method doesn't require prior knowledge about the sample composition and selection of suitable baseline correction points. Experimental results on experimental spectra and synthetic spectra show that the proposed method could handle various kinds of baseline completely automatically.

@&#ACKNOWLEDGEMENTS@&#

This work is supported by National Natural Science Foundation of China (No. 51177002, 61032007), Doctoral Fund of Ministry of Education of China (No. 20113401120007), and Anhui Provincial Natural Science Project (KJ2012A012).

@&#REFERENCES@&#

