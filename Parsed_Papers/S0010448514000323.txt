@&#MAIN-TITLE@&#A multipoint method for 5-axis machining of triangulated surface models

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           We give a method for positioning a radiused end milled cutter on an STL surface.


                        
                        
                           
                           Tool is positioned to have two points of contact.


                        
                        
                           
                           We give simulation and machining results.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

CNC machining

5-axis machining

Multipoint machining

STL

@&#ABSTRACT@&#


               
               
                  In this paper, we present a multipoint machining method for the 5-axis machining of triangulated surfaces with radiused end mills. The main idea is to drop the tool onto the surface to find an initial point of contact, and then rotate the tool while maintaining tangency with this initial point of contact until a second point of contact is found. The proposed procedure ensures a gouge-free position with two points of contact, allowing for a larger side step than a single point of contact method. This proof of concept paper presents the mathematical equations that must be solved to position the tool with two points of contacts on an STL surface. The paper further verifies the concept with simulations and presents experimental results to confirm the simulations.
               
            

@&#INTRODUCTION@&#

The Stereo Lithography (STL) format describes engineering parts as a set of triangles and includes the vertices and normal of the facets. Industry users like this format because it simplifies data transfer, input into analysis algorithms, creation of 3D printed models, algorithms such as tool path planning and positioning and provides desired accuracy in parts made using triangulated models  [1–9]. Most Computer-Aided Design (CAD) packages can output part design in the STL format. Furthermore, most Computer Aided Machining (CAM) packages can accept the STL format as input for tool path planning  [1–9].

The process of machining a triangulated model within a CAM package consists of selecting a tool; identifying a tool path footprint; and determining the tool position and orientation.

The three types of tools commonly used in industry are ball-nosed end mill; flat end mill and radius end mill. A ball-nosed end mill has a simple geometry that lends itself to easy calculation of tool positioning. Ball-nosed end mills are commonly used for machining dies, molds and precision parts with curved surfaces. The drawback in using ball-nose end mills is that the cutting properties at the bottom of the tool are poor  [1,5]. Flat end mills have good cutting properties along the entire edge; however, tool path planning presents a challenge especially at the apex of a curved section of the part and in positioning of the tool for 5-axis machining of curved surfaces  [2,4–8]. Radius end mills are a generalization of both ball-nose and flat end mills. Although positioning the radius end mill for 5-axis machining is a challenging task, it provides a smooth surface finish much like a ball-nose end mill and has excellent cutting capability along its entire cutting edge  [1,3,9–15].

A radiused end mill can be represented as a torus, the rotation of a circle of radius 
                        
                           
                              R
                           
                           
                              i
                           
                        
                      around a circle of radius 
                        
                           
                              R
                           
                           
                              O
                           
                        
                     . Fig. 1
                      shows a cross-section of a radius end mill. For our purposes, we are only interested in the cutting edges of the circle (shown by the dark arcs on the circles in Fig. 1(b)) and we will also think of the tool as having a flat bottom (shown by the dark, straight line across the bottom). Note if 
                        
                           
                              R
                           
                           
                              i
                           
                        
                        =
                        0
                      then the radius end mill models a flat end mill, whereas if 
                        
                           
                              R
                           
                           
                              O
                           
                        
                        =
                        0
                      it models a ball-nose end mill. In this paper, we propose a method for determination of exact positioning of a radiused end milled tool on the curved surface represented in the STL format for 5-axis machining applications.

For identifying a tool path footprint in a region, typically a polyhedron to be machined is identified by the user. This region is projected onto a plane perpendicular to the tool axis (typically the 
                        z
                     -axis). A pattern that describes the motion of the tool is developed within this plane. The pattern takes into account the surface finish required. Typical footprints are the zigzag pattern or the contour pattern. The focus of our work is tool positioning and so for simplicity we used the zigzag pattern within a rectangular region. The zigzag footprint is specified by two parameters, namely the feed forward step, and the side step as shown in Fig. 2
                     .
                  

Once the footprint of the tool is defined it is discretized into small steps and at each point a gouge-free tool position is generated. The tool path comprises of the tool moving between consecutive tool positions along the tool path footprint. This method will also be used in our work.

In this paper, a 5-axis method of positioning a radius end mill tangential to two points on a triangulated surface is presented. As a proof of concept, we generate tool paths for two different type of convex and concave STL surfaces that have been successfully machined on a DMU-80P 5-axis machine. The idea of our method is at each tool position, drop a radiused end mill tool onto the surface to find one point of contact 
                        P
                      as shown in Fig. 4
                     (a). The tool and the STL surface will touch tangentially at this point of contact (although “tangentially” is a somewhat loose term if the point of contact is on an edge or vertex of the STL surface). The point of contact will lie on a pseudo-insert of the tool, a circular cross-section of the torus shown in Fig. 4(b). We then rotate the tool around the vector through the center of this pseudo-insert and perpendicular to this pseudo-insert. This rotation will maintain the tangency between the tool and the STL surface at 
                        P
                     . We rotate the tool until we find a second point of contact 
                        S
                     , which will also be tangent to the STL surface. The result is a tool position that does not gouge the surface and is in contact with the STL surface at two points. The advantage of such a multipoint of contact tool positioning method is that it allows us to have a larger side step.

@&#LITERATURE REVIEW@&#

3-axis tool positioning methods for triangulated surfaces have been extensively explored in the literature  [1–3]. The methods typically comprise of varying ways of dropping a tool along a selected tool axis direction until tool touches the part. The tool center at this point of contact becomes part of the tool path  [1–3].

5-axis methods have also been used to machine parametric curved surfaces. By rotating the tool, researchers try to orient the tool so that more of the cutting surface is closer to the design surface. For example, the Principle Axis Method (PAM) of Rao et al.  [10] determines the principle curvatures of the parametric surface at the point where the tool has to be positioned and uses the minimum curvature and its direction to tilt the tool and bring it into close proximity of the design surface. Gouge detection is done as a secondary step. With Multipoint Methods (MPM), the gouge checking is integrated with the positioning and inclination process [12,13]. In this method the tool is positioned at a point on a smooth, parametric surface and is inclined along the feed direction until it touches a second point on the parametric surface. The determination of the second point of contact presents computational challenges that have been addressed in the literature. The key advantage of these multipoint methods is that the 5-axis tool paths result in a wide strip that is within the specified machining tolerance and consequently the number of passes required to machine the entire surface is reduced significantly. For some surfaces the machining time can be reduced by as much as 80% in comparison to 3-axis methods  [13]. However, these methods are aimed at machining smooth surfaces and are inappropriate for machining triangulated surfaces.

The rolling ball method (RBM) presented by Gray et al.  [9] is an extension of the MPM to triangulated surfaces. In this method a sphere approximates the local surface and the tool is positioned within it. The method has difficulty crossing sharp edges and single vertices in STL surfaces. In a further improved version of the rolling ball method for 5-axis tool positioning, Gray et al.  [15] developed another method called the arc-intersect method (AIM). The RBM generates conservative tilt angles to ensure gouge-free tool positions, whereas AIM directly positions the tool to contact the surface. Like RBM, the AIM is also an area-based method that generates gouge-free tool positions without the use of iterative gouge-check and correction algorithms. However, AIM is not a true multipoint method. While it positions the tool to have one point of contact, it then approximates the toroidal tool with a sphere and finds a second point of contact with this sphere, rather than the tool.

5-axis machining of curved surfaces approximated as a triangulated model has been also been attempted. Although it is known that the radiused end mill has superior machining characteristics than ball-nose and flat end mills for sculptured surface machining, no significant attempts have been made to solve the issues related to tool positioning for STL surface machining with radiused end mill as reported by Lasemi et al.  [2]. Xu et al.  [4] presented a method for machining triangulated surfaces with flat end-mills, in which the tool is positioned at a cutter contact point and is tilted in a plane defined by the feed direction and surface normal. However, the method is limited to flat end mills.

Lauwers et al.  [5] presented a method for determining cutter tilt angle based on curvature matching. The cutter inclination is calculated and tool gouging correction is done by a combination of tilt angle adjustments and tool retractions. Jun et al.  [6] presented a method for optimization and smoothing of tool orientation for 5-axis machining. The tool orientations are selected so as to smooth the tool motion by searching the closest alternative tool orientation in C-space.

It is evident from the published literature  [2,4–9] that attempts that have been made for 5-axis tool positioning of radiused end mills on compound surfaces represented as triangulated models are either limited to flat end mills or require the approximation of the triangulated surface or of the tool. Thus there is a need for a direct method for determining a gouge-free tool position for a generalized radius end milling cutter on a part defined using a triangulated model.

Our method starts with a zigzag tool path with the radiused end mill tool positioned well above the STL surface. At each tool position, we drop the tool onto the STL surface to find a first point of contact. Having found an initial point of contact, in a second step, we rotate the tool around this point on the STL surface until we find a second point of contact between the tool and the STL surface. Fig. 3 gives a pseudo-code for this process, which is described further in the next few paragraphs.

Finding the first point of contact 
                        P
                      of Fig. 4(a) involves finding a point of tangency between the dropped tool and each STL triangle. For each STL triangle 
                        △
                        
                           
                              P
                           
                           
                              1
                           
                        
                        
                           
                              P
                           
                           
                              2
                           
                        
                        
                           
                              P
                           
                           
                              3
                           
                        
                     , we first check if the tool is tangent to the interior of 
                        △
                        
                           
                              P
                           
                           
                              1
                           
                        
                        
                           
                              P
                           
                           
                              2
                           
                        
                        
                           
                              P
                           
                           
                              3
                           
                        
                     ; if not, we then check if the tool is tangent to any of the edges or vertices of 
                        △
                        
                           
                              P
                           
                           
                              1
                           
                        
                        
                           
                              P
                           
                           
                              2
                           
                        
                        
                           
                              P
                           
                           
                              3
                           
                        
                     , and choose the highest point of tangency among them.

At this tool location, the STL surface is tangent to the tool surface. The point of contact on the tool’s cutting edge is on a circle on the tool. This circle, called a pseudo-insert, is shown in Fig. 4.

If the tool is tilted about an axis passing through the center of the pseudo-insert and perpendicular to the plane of the pseudo-insert, 
                        
                           
                              
                                 
                                    u
                                 
                                 
                                    ˆ
                                 
                              
                           
                           
                              1
                           
                        
                     , the contact point on the STL part surface will remain unchanged whereas the contact point on the pseudo-insert will move along its arc. The tool remains tangential to the surface. We exploit this idea and tilt tool about the pseudo-insert axis 
                        
                           
                              
                                 
                                    u
                                 
                                 
                                    ˆ
                                 
                              
                           
                           
                              1
                           
                        
                      until it touches a second point 
                        S
                      on the triangulated model.

The process to find the second point of contact is the same as that for finding the first point of contact (Fig. 3). The difference between finding the first and second points of contact is the step where the point of contact between the tool and a triangle is computed. To find the first point of contact, we drop the tool onto the triangle when finding the point of contact. Having found a first point of contact with the STL file, we process the STL file a second time, and rather than drop the tool, we rotate the tool around the pseudo-insert at the first point of contact to find the second point of contact. Mathematical details for these calculations are found in Sections  4 and 5.

A few remarks are in order. 
                        
                           •
                           Our tool position is gouge-free for the following reasons: 
                                 
                                    –
                                    When we drop the tool, we find the highest point of contact between the tool and the triangle set thereby ensuring that the unrotated tool does not gouge the triangle set.

When we rotate the tool around a pseudo-insert, we ensure that there is no gouging at the first point of contact.

When we rotate the tool, we find the smallest angle of rotation that yields a second point of contact between the tool and the triangle set thereby ensuring that the rotated tool does not gouge the triangle set.

When dropping the tool, since we are searching for the highest point of contact, if the dropped tool is tangent to the interior of 
                                 △
                                 
                                    
                                       P
                                    
                                    
                                       1
                                    
                                 
                                 
                                    
                                       P
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       P
                                    
                                    
                                       3
                                    
                                 
                               at a height 
                                 h
                              , then it will not be tangent to an edge or vertex of 
                                 △
                                 
                                    
                                       P
                                    
                                    
                                       1
                                    
                                 
                                 
                                    
                                       P
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       P
                                    
                                    
                                       3
                                    
                                 
                               at point higher than 
                                 h
                               and thus the next in line 6 of the pseudo-code in Fig. 3. A similar statement is true about the rotated tool.

If the tool is tangent to an edge at a height 
                                 h
                              , it is still possible for the tool to be tangent to a vertex at a point higher than 
                                 h
                              , so if the tool is not tangent to the interior of 
                                 △
                                 
                                    
                                       P
                                    
                                    
                                       1
                                    
                                 
                                 
                                    
                                       P
                                    
                                    
                                       2
                                    
                                 
                                 
                                    
                                       P
                                    
                                    
                                       3
                                    
                                 
                               then we must check all its edges and all its vertices for the highest contact point. A similar statement is true about the rotated tool.

When dropping the tool and computing the point of contact, we also compute the corresponding pseudo-insert, which is used in the second phase of the process when we rotate the tool.

In a couple of cases (see Section  4), we will only find one point of contact (i.e., in these cases, we do not rotate the tool and will skip line 2a of the pseudo-code).

To handle triangle sets of the size found in industry, bucketing and other techniques will be required to make our algorithm efficient enough for practical uses.

In this section the mathematical formulation used for determining the first point of contact is presented. This first stage uses the method of Patel et al.  [3] to identify the position of the pseudo-insert at first point of contact.

Let 
                        h
                      be the distance of the tool center 
                        
                           
                              T
                           
                           
                              c
                           
                        
                      from the selected point 
                        T
                      on the tool path footprint along the tool axis 
                        
                           
                              
                                 
                                    t
                                 
                                 
                                    ˆ
                                 
                              
                           
                           
                              l
                           
                        
                     . As the tool descends its point of contact with each facet of the model is determined and the highest point of contact gives the location and orientation of the pseudo-insert as described above.

Note that potentially we may find points of contact between the STL triangle and the tool that are either on the top or inside of the torus representing the tool. We discard such cases and only consider tangency on the part of the tool of interest (Fig. 1(b)).

We want to determine the location of the center of the tool 
                           
                              
                                 T
                              
                              
                                 c
                              
                           
                         as it touches 
                           △
                           
                              
                                 P
                              
                              
                                 1
                              
                           
                           
                              
                                 P
                              
                              
                                 2
                              
                           
                           
                              
                                 P
                              
                              
                                 3
                              
                           
                         during its descent along the axis 
                           
                              
                                 
                                    
                                       t
                                    
                                    
                                       ˆ
                                    
                                 
                              
                              
                                 l
                              
                           
                         (Fig. 5
                        ). When the tool is tangent to 
                           △
                           
                              
                                 P
                              
                              
                                 1
                              
                           
                           
                              
                                 P
                              
                              
                                 2
                              
                           
                           
                              
                                 P
                              
                              
                                 3
                              
                           
                         at 
                           
                              
                                 T
                              
                              
                                 c
                              
                           
                         we derive the following two equations for 
                           
                              
                                 T
                              
                              
                                 c
                              
                           
                        , one based on the tool dropping a distance 
                           h
                         to the point of contact (where 
                           h
                         is yet to be determined), and the other based on the tangent triangle: 
                           
                              
                                 (1)
                                 
                                    
                                       
                                          T
                                       
                                       
                                          c
                                       
                                    
                                    =
                                    T
                                    +
                                    h
                                    
                                       
                                          
                                             
                                                t
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              
                                 (2)
                                 
                                    
                                       
                                          T
                                       
                                       
                                          c
                                       
                                    
                                    =
                                    P
                                    +
                                    
                                       
                                          R
                                       
                                       
                                          i
                                       
                                    
                                    
                                       
                                          n
                                       
                                       
                                          ˆ
                                       
                                    
                                    +
                                    
                                       
                                          R
                                       
                                       
                                          O
                                       
                                    
                                    
                                       
                                          
                                             
                                                n
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          p
                                       
                                    
                                    ,
                                 
                              
                           
                         where 
                           
                              
                                 n
                              
                              
                                 ˆ
                              
                           
                         is the surface normal for 
                           △
                           
                              
                                 P
                              
                              
                                 1
                              
                           
                           
                              
                                 P
                              
                              
                                 2
                              
                           
                           
                              
                                 P
                              
                              
                                 3
                              
                           
                        
                        
                           
                              
                                 
                                    
                                       n
                                    
                                    
                                       ˆ
                                    
                                 
                                 =
                                 
                                    (
                                    
                                       
                                          P
                                       
                                       
                                          2
                                       
                                    
                                    −
                                    
                                       
                                          P
                                       
                                       
                                          1
                                       
                                    
                                    )
                                 
                                 ×
                                 
                                    (
                                    
                                       
                                          P
                                       
                                       
                                          3
                                       
                                    
                                    −
                                    
                                       
                                          P
                                       
                                       
                                          1
                                       
                                    
                                    )
                                 
                                 /
                                 
                                    |
                                    
                                       (
                                       
                                          
                                             P
                                          
                                          
                                             2
                                          
                                       
                                       −
                                       
                                          
                                             P
                                          
                                          
                                             1
                                          
                                       
                                       )
                                    
                                    ×
                                    
                                       (
                                       
                                          
                                             P
                                          
                                          
                                             3
                                          
                                       
                                       −
                                       
                                          
                                             P
                                          
                                          
                                             1
                                          
                                       
                                       )
                                    
                                    |
                                 
                                 ,
                              
                           
                        
                        
                           P
                         is a point on the plane of 
                           △
                           
                              
                                 P
                              
                              
                                 1
                              
                           
                           
                              
                                 P
                              
                              
                                 2
                              
                           
                           
                              
                                 P
                              
                              
                                 3
                              
                           
                         that can be parameterized as 
                           
                              
                                 P
                                 =
                                 
                                    
                                       P
                                    
                                    
                                       1
                                    
                                 
                                 +
                                 s
                                 
                                    (
                                    
                                       
                                          P
                                       
                                       
                                          2
                                       
                                    
                                    −
                                    
                                       
                                          P
                                       
                                       
                                          1
                                       
                                    
                                    )
                                 
                                 +
                                 t
                                 
                                    (
                                    
                                       
                                          P
                                       
                                       
                                          3
                                       
                                    
                                    −
                                    
                                       
                                          P
                                       
                                       
                                          1
                                       
                                    
                                    )
                                 
                                 ,
                              
                           
                         where 
                           0
                           ≤
                           s
                           ,
                           t
                           ≤
                           1
                        , and 
                           
                              
                                 
                                    
                                       n
                                    
                                    
                                       ˆ
                                    
                                 
                              
                              
                                 p
                              
                           
                         is the projection of surface normal 
                           
                              
                                 n
                              
                              
                                 ˆ
                              
                           
                         in a plane perpendicular to tool axis 
                           
                              
                                 
                                    
                                       t
                                    
                                    
                                       ˆ
                                    
                                 
                              
                              
                                 l
                              
                           
                        , 
                           
                              
                                 
                                    
                                       
                                          
                                             n
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                    
                                       p
                                    
                                 
                                 =
                                 
                                    
                                       n
                                    
                                    
                                       ˆ
                                    
                                 
                                 −
                                 
                                    
                                       t
                                    
                                    
                                       l
                                    
                                 
                                 
                                    (
                                    
                                       
                                          n
                                       
                                       
                                          ˆ
                                       
                                    
                                    ⋅
                                    
                                       
                                          t
                                       
                                       
                                          l
                                       
                                    
                                    )
                                 
                                 /
                                 
                                    |
                                    
                                       
                                          n
                                       
                                       
                                          ˆ
                                       
                                    
                                    −
                                    
                                       
                                          t
                                       
                                       
                                          l
                                       
                                    
                                    
                                       (
                                       
                                          
                                             n
                                          
                                          
                                             ˆ
                                          
                                       
                                       ⋅
                                       
                                          
                                             t
                                          
                                          
                                             l
                                          
                                       
                                       )
                                    
                                    |
                                 
                                 .
                              
                           
                         The above simultaneous equations can be solved for 
                           s
                        , 
                           t
                         and 
                           h
                        . If the value of 
                           s
                         and 
                           t
                         lie between 0 and 1 and 
                           0
                           ≤
                           s
                           +
                           t
                           ≤
                           1
                        , then it is a valid solution for the point of contact with 
                           △
                           
                              
                                 P
                              
                              
                                 1
                              
                           
                           
                              
                                 P
                              
                              
                                 2
                              
                           
                           
                              
                                 P
                              
                              
                                 3
                              
                           
                        . In addition to the tool center location 
                           
                              
                                 T
                              
                              
                                 c
                              
                           
                         and first point of contact 
                           P
                        , the center of pseudo-insert 
                           
                              
                                 O
                              
                              
                                 1
                              
                           
                         can be computed: 
                           
                              
                                 
                                    
                                       O
                                    
                                    
                                       1
                                    
                                 
                                 =
                                 P
                                 +
                                 
                                    
                                       R
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       n
                                    
                                    
                                       ˆ
                                    
                                 
                                 .
                              
                           
                        
                     

The contact points between the descending tool and the three edges of the facet are determined one edge at a time. To determine the contact point between the edge 
                           
                              (
                              
                                 
                                    P
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    P
                                 
                                 
                                    2
                                 
                              
                              )
                           
                         and the descending tool, a cylindrical envelope is imagined around the edge. The cylindrical envelope defined by 
                           C
                           y
                           
                              
                                 l
                              
                              
                                 1
                              
                           
                         will pass through the center of pseudo-insert located at 
                           
                              
                                 O
                              
                              
                                 1
                              
                           
                         (Fig. 6
                        ): 
                           
                              
                                 C
                                 y
                                 
                                    
                                       l
                                    
                                    
                                       1
                                    
                                 
                                 =
                                 P
                                 +
                                 
                                    
                                       R
                                    
                                    
                                       i
                                    
                                 
                                 
                                    (
                                    
                                       
                                          u
                                       
                                       →
                                    
                                    cos
                                    α
                                    +
                                    
                                       
                                          v
                                       
                                       →
                                    
                                    sin
                                    α
                                    )
                                 
                              
                           
                         where 
                           
                              (
                              
                                 
                                    u
                                 
                                 →
                              
                              ,
                              
                                 
                                    v
                                 
                                 →
                              
                              ,
                              
                                 
                                    w
                                 
                                 →
                              
                              )
                           
                         are unit direction normals of a local coordinate frame at 
                           
                              
                                 P
                              
                              
                                 1
                              
                           
                         given by 
                           
                              
                                 
                                    
                                       
                                          w
                                       
                                       →
                                    
                                    =
                                    
                                       (
                                       
                                          
                                             P
                                          
                                          
                                             2
                                          
                                       
                                       −
                                       
                                          
                                             P
                                          
                                          
                                             1
                                          
                                       
                                       )
                                    
                                    /
                                    
                                       |
                                       
                                          
                                             P
                                          
                                          
                                             2
                                          
                                       
                                       −
                                       
                                          
                                             P
                                          
                                          
                                             1
                                          
                                       
                                       |
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          u
                                       
                                       →
                                    
                                    =
                                    
                                       (
                                       
                                          
                                             
                                                
                                                   t
                                                
                                                →
                                             
                                          
                                          
                                             l
                                          
                                       
                                       ×
                                       
                                          
                                             w
                                          
                                          →
                                       
                                       )
                                    
                                    /
                                    
                                       |
                                       
                                          
                                             
                                                
                                                   t
                                                
                                                →
                                             
                                          
                                          
                                             l
                                          
                                       
                                       ×
                                       
                                          
                                             w
                                          
                                          →
                                       
                                       |
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          v
                                       
                                       →
                                    
                                    =
                                    
                                       (
                                       
                                          
                                             w
                                          
                                          →
                                       
                                       ×
                                       
                                          
                                             u
                                          
                                          →
                                       
                                       )
                                    
                                    /
                                    
                                       |
                                       
                                          
                                             w
                                          
                                          →
                                       
                                       ×
                                       
                                          
                                             u
                                          
                                          →
                                       
                                       |
                                    
                                    ,
                                 
                              
                           
                         where 
                           P
                         is on the edge through vertices 
                           
                              (
                              
                                 
                                    P
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    P
                                 
                                 
                                    2
                                 
                              
                              )
                           
                         given by 
                           
                              
                                 P
                                 =
                                 
                                    
                                       P
                                    
                                    
                                       1
                                    
                                 
                                 +
                                 s
                                 
                                    (
                                    
                                       
                                          P
                                       
                                       
                                          2
                                       
                                    
                                    −
                                    
                                       
                                          P
                                       
                                       
                                          1
                                       
                                    
                                    )
                                 
                                 ,
                              
                           
                         for 
                           0
                           ≤
                           s
                           ≤
                           1
                        .
                           1
                        
                        
                           1
                           If the edge 
                                 
                                    
                                       
                                          
                                             P
                                          
                                          
                                             1
                                          
                                       
                                       
                                          
                                             P
                                          
                                          
                                             2
                                          
                                       
                                    
                                    ¯
                                 
                               is parallel to tool axis direction 
                                 
                                    
                                       
                                          
                                             t
                                          
                                          →
                                       
                                    
                                    
                                       l
                                    
                                 
                              , then we skip this edge test, and detect any tangencies in the vertex tests.
                         The center of torus representing the tool 
                           
                              
                                 T
                              
                              
                                 c
                              
                           
                         can be written in two forms: 
                           
                              
                                 (3)
                                 
                                    
                                       
                                          T
                                       
                                       
                                          c
                                       
                                    
                                    =
                                    T
                                    +
                                    h
                                    
                                       
                                          
                                             
                                                t
                                             
                                             →
                                          
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              
                                 (4)
                                 
                                    
                                       
                                          T
                                       
                                       
                                          c
                                       
                                    
                                    =
                                    P
                                    +
                                    
                                       
                                          R
                                       
                                       
                                          i
                                       
                                    
                                    
                                       
                                          n
                                       
                                       
                                          ˆ
                                       
                                    
                                    +
                                    
                                       
                                          R
                                       
                                       
                                          O
                                       
                                    
                                    
                                       
                                          
                                             
                                                n
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          p
                                       
                                    
                                    .
                                 
                              
                           
                         The above simultaneous equation can be solved for 
                           s
                        , 
                           α
                         and 
                           h
                        . If value of 
                           s
                         lies between 0 and 1, then the contact point lies within the edge. From these parameters the tool center location 
                           
                              
                                 T
                              
                              
                                 c
                              
                           
                        , the point of contact 
                           P
                         and the center of pseudo-insert 
                           
                              
                                 O
                              
                              
                                 1
                              
                           
                         can be determined for an edge.

The contact points (if any) are determined for each edge of 
                           △
                           
                              
                                 P
                              
                              
                                 1
                              
                           
                           
                              
                                 P
                              
                              
                                 2
                              
                           
                           
                              
                                 P
                              
                              
                                 3
                              
                           
                         independently. Any number of edges may result in valid contact points. The highest of the valid contact points is selected as the edge contact point.

Note that in our implementation, if the tool drops on a horizontal edge, we do not rotate the tool since we effectively already have two points of contact. Further, since such an edge typically lies between two faces (on our tool path), not rotating on such an edge reduces the machine motions as we transition between faces.

The contact points between the descending tool and the vertices of the facet 
                           
                              (
                              
                                 
                                    P
                                 
                                 
                                    0
                                 
                              
                              ,
                              
                                 
                                    P
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    P
                                 
                                 
                                    2
                                 
                              
                              )
                           
                         are determined as follows. As the tool descends onto a vertex 
                           P
                        , there are three possibilities depending on the shortest distance between the vertex and the axis of descent: 
                           
                              
                                 
                                    |
                                    
                                       
                                          
                                             
                                                t
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          l
                                       
                                    
                                    
                                       (
                                       
                                          
                                             
                                                
                                                   P
                                                
                                                →
                                             
                                          
                                          
                                             t
                                          
                                       
                                       ⋅
                                       
                                          
                                             
                                                
                                                   t
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                          
                                             l
                                          
                                       
                                       )
                                    
                                    −
                                    
                                       
                                          
                                             
                                                P
                                             
                                             →
                                          
                                       
                                       
                                          t
                                       
                                    
                                    |
                                 
                                 ,
                              
                           
                         where 
                           
                              
                                 
                                    
                                       P
                                    
                                    →
                                 
                              
                              
                                 t
                              
                           
                           =
                           P
                           −
                           T
                        . 
                           Case 1:
                           
                              
                                 
                                    
                                       
                                          R
                                       
                                       
                                          i
                                       
                                    
                                    +
                                    
                                       
                                          R
                                       
                                       
                                          O
                                       
                                    
                                    ≤
                                    
                                       |
                                       
                                          
                                             
                                                
                                                   t
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                          
                                             l
                                          
                                       
                                       
                                          (
                                          
                                             
                                                
                                                   
                                                      P
                                                   
                                                   →
                                                
                                             
                                             
                                                t
                                             
                                          
                                          ⋅
                                          
                                             
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      ˆ
                                                   
                                                
                                             
                                             
                                                l
                                             
                                          
                                          )
                                       
                                       −
                                       
                                          
                                             
                                                
                                                   P
                                                
                                                →
                                             
                                          
                                          
                                             t
                                          
                                       
                                       |
                                    
                                 : in this case, the descending tool will not touch 
                                    P
                                 .


                                 
                                    0
                                    ≤
                                    
                                       |
                                       
                                          
                                             
                                                
                                                   t
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                          
                                             l
                                          
                                       
                                       
                                          (
                                          
                                             
                                                
                                                   
                                                      P
                                                   
                                                   →
                                                
                                             
                                             
                                                t
                                             
                                          
                                          ⋅
                                          
                                             
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      ˆ
                                                   
                                                
                                             
                                             
                                                l
                                             
                                          
                                          )
                                       
                                       −
                                       
                                          
                                             
                                                
                                                   P
                                                
                                                →
                                             
                                          
                                          
                                             t
                                          
                                       
                                       |
                                    
                                    ≤
                                    
                                       
                                          R
                                       
                                       
                                          O
                                       
                                    
                                 : in this case 
                                    P
                                  lies under the flat region of the radiused end mill and will not touch the cutting edge of pseudo-insert. For simplicity, we do not incline the tool at such positions.


                                 
                                    
                                       
                                          R
                                       
                                       
                                          O
                                       
                                    
                                    ≤
                                    
                                       |
                                       
                                          
                                             
                                                
                                                   t
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                          
                                             l
                                          
                                       
                                       
                                          (
                                          
                                             
                                                
                                                   
                                                      P
                                                   
                                                   →
                                                
                                             
                                             
                                                t
                                             
                                          
                                          ⋅
                                          
                                             
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      ˆ
                                                   
                                                
                                             
                                             
                                                l
                                             
                                          
                                          )
                                       
                                       −
                                       
                                          
                                             
                                                
                                                   P
                                                
                                                →
                                             
                                          
                                          
                                             t
                                          
                                       
                                       |
                                    
                                    ≤
                                    
                                       
                                          R
                                       
                                       
                                          i
                                       
                                    
                                    +
                                    
                                       
                                          R
                                       
                                       
                                          O
                                       
                                    
                                 : in this case the vertex will touch the cutting edge on the pseudo-insert. To determine the tool location as it descends onto a vertex 
                                    P
                                  along 
                                    
                                       
                                          t
                                       
                                       
                                          l
                                       
                                    
                                  at tool path foot print 
                                    T
                                  (Fig. 7
                                 ), the following simultaneous equations must be solved.
                                    
                                       
                                          (5)
                                          
                                             
                                                
                                                   T
                                                
                                                
                                                   c
                                                
                                             
                                             =
                                             T
                                             +
                                             h
                                             
                                                
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         ˆ
                                                      
                                                   
                                                
                                                
                                                   l
                                                
                                             
                                          
                                       
                                       
                                          (6)
                                          
                                             
                                                
                                                   T
                                                
                                                
                                                   c
                                                
                                             
                                             =
                                             P
                                             +
                                             
                                                
                                                   R
                                                
                                                
                                                   i
                                                
                                             
                                             
                                                
                                                   n
                                                
                                                
                                                   ˆ
                                                
                                             
                                             +
                                             
                                                
                                                   R
                                                
                                                
                                                   O
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         n
                                                      
                                                      
                                                         ˆ
                                                      
                                                   
                                                
                                                
                                                   p
                                                
                                             
                                             .
                                          
                                       
                                    
                                  Combining, we have 
                                    
                                       
                                          T
                                          +
                                          h
                                          
                                             
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      ˆ
                                                   
                                                
                                             
                                             
                                                l
                                             
                                          
                                          −
                                          P
                                          −
                                          
                                             
                                                R
                                             
                                             
                                                i
                                             
                                          
                                          
                                             
                                                n
                                             
                                             
                                                ˆ
                                             
                                          
                                          −
                                          
                                             
                                                R
                                             
                                             
                                                O
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      ˆ
                                                   
                                                
                                             
                                             
                                                p
                                             
                                          
                                          =
                                          0
                                          ,
                                       
                                    
                                  where 
                                    
                                       
                                          n
                                       
                                       
                                          ˆ
                                       
                                    
                                    =
                                    
                                       
                                          
                                             
                                                n
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          p
                                       
                                    
                                    cos
                                    α
                                    +
                                    
                                       
                                          
                                             
                                                t
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          l
                                       
                                    
                                    sin
                                    α
                                  and 
                                    sin
                                    α
                                  and 
                                    cos
                                    α
                                  terms are 
                                    
                                       
                                          
                                             sin
                                             α
                                             =
                                             
                                                (
                                                
                                                   
                                                      T
                                                   
                                                   
                                                      c
                                                   
                                                
                                                −
                                                P
                                                )
                                             
                                             ⋅
                                             
                                                
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         ˆ
                                                      
                                                   
                                                
                                                
                                                   l
                                                
                                             
                                             /
                                             
                                                
                                                   R
                                                
                                                
                                                   i
                                                
                                             
                                          
                                       
                                       
                                          
                                             cos
                                             α
                                             =
                                             
                                                
                                                   1
                                                   −
                                                   
                                                      
                                                         
                                                            (
                                                            sin
                                                            α
                                                            )
                                                         
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                             .
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                n
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          p
                                       
                                    
                                  is the direction vector passing through 
                                    P
                                  and perpendicular to tool axis 
                                    
                                       
                                          t
                                       
                                       
                                          l
                                       
                                    
                                  and is given by 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      ˆ
                                                   
                                                
                                             
                                             
                                                p
                                             
                                          
                                          =
                                          
                                             [
                                             
                                                
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         ˆ
                                                      
                                                   
                                                
                                                
                                                   l
                                                
                                             
                                             
                                                (
                                                
                                                   
                                                      
                                                         
                                                            P
                                                         
                                                         →
                                                      
                                                   
                                                   
                                                      t
                                                   
                                                
                                                ⋅
                                                
                                                   
                                                      
                                                         
                                                            t
                                                         
                                                         
                                                            ˆ
                                                         
                                                      
                                                   
                                                   
                                                      l
                                                   
                                                
                                                )
                                             
                                             −
                                             
                                                
                                                   
                                                      
                                                         P
                                                      
                                                      
                                                         ˆ
                                                      
                                                   
                                                
                                                
                                                   t
                                                
                                             
                                             ]
                                          
                                          /
                                          
                                             |
                                             
                                                
                                                   
                                                      
                                                         t
                                                      
                                                      
                                                         ˆ
                                                      
                                                   
                                                
                                                
                                                   l
                                                
                                             
                                             
                                                (
                                                
                                                   
                                                      
                                                         
                                                            P
                                                         
                                                         →
                                                      
                                                   
                                                   
                                                      t
                                                   
                                                
                                                ⋅
                                                
                                                   
                                                      
                                                         
                                                            t
                                                         
                                                         
                                                            ˆ
                                                         
                                                      
                                                   
                                                   
                                                      l
                                                   
                                                
                                                )
                                             
                                             −
                                             
                                                
                                                   
                                                      
                                                         P
                                                      
                                                      
                                                         ˆ
                                                      
                                                   
                                                
                                                
                                                   t
                                                
                                             
                                             |
                                          
                                          .
                                       
                                    
                                  The above simultaneous equation can be solved for 
                                    α
                                  and 
                                    h
                                 . Knowing these parameters the tool center location 
                                    
                                       
                                          T
                                       
                                       
                                          c
                                       
                                    
                                  and the center of pseudo-insert 
                                    
                                       
                                          O
                                       
                                       
                                          1
                                       
                                    
                                  is 
                                    
                                       
                                          
                                             
                                                O
                                             
                                             
                                                1
                                             
                                          
                                          =
                                          P
                                          +
                                          
                                             
                                                R
                                             
                                             
                                                i
                                             
                                          
                                          
                                             
                                                n
                                             
                                             
                                                ˆ
                                             
                                          
                                          .
                                       
                                    
                                 
                              

Any, all, or none of the vertices of facet 
                           
                              (
                              
                                 
                                    P
                                 
                                 
                                    0
                                 
                              
                              ,
                              
                                 
                                    P
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    P
                                 
                                 
                                    2
                                 
                              
                              )
                           
                         may result in valid contact points. The highest of the valid contact points is selected.

In the second stage the tool is tilted about the pseudo-insert axis. As the tool rotates, its point of contact with each facet is determined. The point of contact with the smallest rotation determines the location and orientation of the tool.


                        Fig. 8
                         illustrates the computation of the second point of contact 
                           S
                        , between the rotating tool and the inside of 
                           △
                           
                              
                                 S
                              
                              
                                 1
                              
                           
                           
                              
                                 S
                              
                              
                                 2
                              
                           
                           
                              
                                 S
                              
                              
                                 3
                              
                           
                        . The second point of contact 
                           S
                         lies on a pseudo-insert with center 
                           
                              
                                 O
                              
                              
                                 2
                              
                           
                        . Using the following two equations for 
                           
                              
                                 O
                              
                              
                                 2
                              
                           
                         allows us to find 
                           S
                        : 
                           
                              
                                 (7)
                                 
                                    
                                       
                                          O
                                       
                                       
                                          2
                                       
                                    
                                    =
                                    S
                                    +
                                    
                                       
                                          R
                                       
                                       
                                          i
                                       
                                    
                                    
                                       
                                          
                                             
                                                n
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          2
                                       
                                    
                                 
                              
                              
                                 (8)
                                 
                                    
                                       
                                          O
                                       
                                       
                                          2
                                       
                                    
                                    =
                                    C
                                    i
                                    
                                       
                                          r
                                       
                                       
                                          1
                                       
                                    
                                    +
                                    
                                       
                                          R
                                       
                                       
                                          O
                                       
                                    
                                    
                                       (
                                       
                                          
                                             
                                                
                                                   u
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                          
                                             2
                                          
                                       
                                       cos
                                       ϕ
                                       +
                                       
                                          
                                             
                                                
                                                   v
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                          
                                             2
                                          
                                       
                                       sin
                                       ϕ
                                       )
                                    
                                 
                              
                           
                         where 
                           
                              
                                 S
                                 =
                                 
                                    
                                       S
                                    
                                    
                                       1
                                    
                                 
                                 +
                                 
                                    
                                       s
                                    
                                    
                                       ′
                                    
                                 
                                 
                                    (
                                    
                                       
                                          S
                                       
                                       
                                          2
                                       
                                    
                                    −
                                    
                                       
                                          S
                                       
                                       
                                          1
                                       
                                    
                                    )
                                 
                                 +
                                 
                                    
                                       t
                                    
                                    
                                       ′
                                    
                                 
                                 
                                    (
                                    
                                       
                                          S
                                       
                                       
                                          3
                                       
                                    
                                    −
                                    
                                       
                                          S
                                       
                                       
                                          1
                                       
                                    
                                    )
                                 
                                 ,
                              
                           
                         for 
                           0
                           ≤
                           
                              
                                 s
                              
                              
                                 ′
                              
                           
                           ,
                           
                              
                                 t
                              
                              
                                 ′
                              
                           
                           ≤
                           1
                        . 
                           
                              
                                 
                                    
                                       n
                                    
                                    
                                       ˆ
                                    
                                 
                              
                              
                                 2
                              
                           
                         is the surface normal for 
                           △
                           
                              
                                 S
                              
                              
                                 1
                              
                           
                           
                              
                                 S
                              
                              
                                 2
                              
                           
                           
                              
                                 S
                              
                              
                                 3
                              
                           
                        : 
                           
                              
                                 
                                    
                                       
                                          
                                             n
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                                 =
                                 
                                    [
                                    
                                       (
                                       
                                          
                                             S
                                          
                                          
                                             2
                                          
                                       
                                       −
                                       
                                          
                                             S
                                          
                                          
                                             1
                                          
                                       
                                       )
                                    
                                    ×
                                    
                                       (
                                       
                                          
                                             S
                                          
                                          
                                             3
                                          
                                       
                                       −
                                       
                                          
                                             S
                                          
                                          
                                             1
                                          
                                       
                                       )
                                    
                                    ]
                                 
                                 /
                                 
                                    |
                                    
                                       (
                                       
                                          
                                             S
                                          
                                          
                                             2
                                          
                                       
                                       −
                                       
                                          
                                             S
                                          
                                          
                                             1
                                          
                                       
                                       )
                                    
                                    ×
                                    
                                       (
                                       
                                          
                                             S
                                          
                                          
                                             3
                                          
                                       
                                       −
                                       
                                          
                                             S
                                          
                                          
                                             1
                                          
                                       
                                       )
                                    
                                    |
                                 
                                 ,
                              
                           
                         and 
                           C
                           i
                           
                              
                                 r
                              
                              
                                 1
                              
                           
                         is the trajectory of the tool center 
                           
                              
                                 T
                              
                              
                                 c
                              
                           
                         as the tool is rotated as shown in Figs. 7 and 9
                        : 
                           
                              (9)
                              
                                 C
                                 i
                                 
                                    
                                       r
                                    
                                    
                                       1
                                    
                                 
                                 =
                                 
                                    
                                       O
                                    
                                    
                                       1
                                    
                                 
                                 +
                                 
                                    
                                       R
                                    
                                    
                                       O
                                    
                                 
                                 
                                    (
                                    
                                       
                                          
                                             
                                                v
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          1
                                       
                                    
                                    cos
                                    θ
                                    +
                                    
                                       
                                          
                                             
                                                w
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          1
                                       
                                    
                                    sin
                                    θ
                                    )
                                 
                                 .
                              
                           
                        
                        
                           
                              (
                              
                                 
                                    
                                       
                                          u
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    2
                                 
                              
                              ,
                              
                                 
                                    
                                       
                                          v
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    2
                                 
                              
                              ,
                              
                                 
                                    
                                       
                                          w
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    2
                                 
                              
                              )
                           
                         is a local right-handed coordinate system defined at 
                           
                              
                                 O
                              
                              
                                 2
                              
                           
                         shown in Figs. 7 and 9 given by 
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                u
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          2
                                       
                                    
                                    =
                                    
                                       
                                          
                                             
                                                u
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          1
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          
                                             
                                                v
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          2
                                       
                                    
                                    =
                                    
                                       
                                          
                                             
                                                v
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          1
                                       
                                    
                                    cos
                                    θ
                                    +
                                    
                                       
                                          
                                             
                                                w
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          1
                                       
                                    
                                    sin
                                    θ
                                 
                              
                              
                                 
                                    
                                       
                                          
                                             
                                                w
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          2
                                       
                                    
                                    =
                                    
                                       (
                                       
                                          
                                             
                                                
                                                   u
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                          
                                             2
                                          
                                       
                                       ×
                                       
                                          
                                             
                                                
                                                   v
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                          
                                             2
                                          
                                       
                                       )
                                    
                                    /
                                    
                                       |
                                       
                                          
                                             
                                                
                                                   u
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                          
                                             2
                                          
                                       
                                       ×
                                       
                                          
                                             
                                                
                                                   v
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                          
                                             2
                                          
                                       
                                       |
                                    
                                    .
                                 
                              
                           
                         Also the set of direction normals 
                           
                              (
                              
                                 
                                    
                                       
                                          u
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    
                                       
                                          v
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    
                                       
                                          w
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    1
                                 
                              
                              )
                           
                         define a local right-handed coordinate system at the center of pseudo-insert 
                           
                              
                                 O
                              
                              
                                 1
                              
                           
                        , as shown in Figs. 7 and 9. The three directions normal are given as 
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                w
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          1
                                       
                                    
                                    =
                                    
                                       
                                          
                                             
                                                t
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          l
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          
                                             
                                                u
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          1
                                       
                                    
                                    =
                                    
                                       (
                                       
                                          
                                             n
                                          
                                          
                                             ˆ
                                          
                                       
                                       ×
                                       
                                          
                                             
                                                
                                                   t
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                          
                                             l
                                          
                                       
                                       )
                                    
                                    /
                                    
                                       |
                                       
                                          
                                             n
                                          
                                          
                                             ˆ
                                          
                                       
                                       ×
                                       
                                          
                                             
                                                
                                                   t
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                          
                                             l
                                          
                                       
                                       |
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          
                                             
                                                v
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          1
                                       
                                    
                                    =
                                    
                                       (
                                       
                                          
                                             
                                                
                                                   w
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                          
                                             1
                                          
                                       
                                       ×
                                       
                                          
                                             
                                                
                                                   u
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                          
                                             1
                                          
                                       
                                       )
                                    
                                    /
                                    
                                       |
                                       
                                          
                                             
                                                
                                                   w
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                          
                                             1
                                          
                                       
                                       ×
                                       
                                          
                                             
                                                
                                                   u
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                          
                                             1
                                          
                                       
                                       |
                                    
                                    =
                                    
                                       
                                          
                                             
                                                n
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          p
                                       
                                    
                                    .
                                 
                              
                           
                         In addition to the above equations the surface normal at the second point of contact must be normal to the tool surface and perpendicular to the major circle of the torus. This condition is given by
                           
                              (10)
                              
                                 
                                    (
                                    
                                       
                                          
                                             
                                                v
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          2
                                       
                                    
                                    cos
                                    ϕ
                                    −
                                    
                                       
                                          
                                             
                                                u
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          2
                                       
                                    
                                    sin
                                    ϕ
                                    )
                                 
                                 ⋅
                                 
                                    
                                       
                                          
                                             n
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                                 =
                                 0
                                 .
                              
                           
                        
                     

The non-linear simultaneous equations (7), (8) and (10) can be solved for four variables, namely two angles 
                           θ
                         and 
                           ϕ
                        , and two scalars 
                           
                              
                                 s
                              
                              
                                 ′
                              
                           
                         and 
                           
                              
                                 t
                              
                              
                                 ′
                              
                           
                        . If 
                           
                              
                                 s
                              
                              
                                 ′
                              
                           
                         and 
                           
                              
                                 t
                              
                              
                                 ′
                              
                           
                         lie between 0 and 1 and 
                           0
                           ≤
                           
                              
                                 s
                              
                              
                                 ′
                              
                           
                           +
                           
                              
                                 t
                              
                              
                                 ′
                              
                           
                           ≤
                           1
                         then the solution represents a valid second point of contact.

In this step the contact points between the rotating tool and the three edges of the facet are determined. Zero, one, two or three of edges may result in potential contact points. The smallest of the tool axis rotations for the potential contact point on edges of the triangle is selected.

The edge 
                           
                              (
                              
                                 
                                    S
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    S
                                 
                                 
                                    2
                                 
                              
                              )
                           
                         and the rotating tool will be tangent at a point 
                           S
                         when 
                           
                              (11)
                              
                                 
                                    
                                       O
                                    
                                    
                                       2
                                    
                                 
                                 =
                                 
                                    
                                       T
                                    
                                    
                                       c
                                    
                                    
                                       ′
                                    
                                 
                                 +
                                 
                                    
                                       R
                                    
                                    
                                       O
                                    
                                 
                                 
                                    (
                                    
                                       
                                          
                                             
                                                u
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          2
                                       
                                    
                                    cos
                                    ϕ
                                    +
                                    
                                       
                                          
                                             
                                                v
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          2
                                       
                                    
                                    sin
                                    ϕ
                                    )
                                 
                                 =
                                 
                                    
                                       C
                                       y
                                       l
                                    
                                    
                                       2
                                    
                                 
                                 =
                                 S
                                 +
                                 
                                    
                                       R
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       
                                          
                                             n
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                              
                           
                         where 
                           S
                         is the second point of contact between the toroidal tool and a new edge 
                           
                              (
                              
                                 
                                    S
                                 
                                 
                                    1
                                 
                                 
                                    ′
                                 
                              
                              ,
                              
                                 
                                    S
                                 
                                 
                                    2
                                 
                                 
                                    ′
                                 
                              
                              )
                           
                        . (Under certain circumstances the second point of contact can be found on the same edge on which first point of contact has been obtained.) The vector 
                           S
                         can be defined in terms of a scalar 
                           
                              
                                 s
                              
                              
                                 ′
                              
                           
                         as 
                           
                              
                                 S
                                 =
                                 
                                    
                                       S
                                    
                                    
                                       1
                                    
                                    
                                       ′
                                    
                                 
                                 +
                                 
                                    
                                       s
                                    
                                    
                                       ′
                                    
                                 
                                 
                                    (
                                    
                                       
                                          S
                                       
                                       
                                          2
                                       
                                       
                                          ′
                                       
                                    
                                    −
                                    
                                       
                                          S
                                       
                                       
                                          1
                                       
                                       
                                          ′
                                       
                                    
                                    )
                                 
                                 ,
                              
                           
                         where 
                           0
                           ≤
                           
                              
                                 s
                              
                              
                                 ′
                              
                           
                           ≤
                           1
                        . And the set of direction normals 
                           
                              (
                              
                                 
                                    
                                       
                                          u
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    2
                                 
                              
                              ,
                              
                                 
                                    
                                       
                                          v
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    2
                                 
                              
                              ,
                              
                                 
                                    
                                       
                                          w
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    2
                                 
                              
                              )
                           
                         and the vector 
                           
                              
                                 T
                              
                              
                                 c
                              
                              
                                 ′
                              
                           
                         represent similar entities as derived in the previous steps from direction normals 
                           
                              (
                              
                                 
                                    
                                       
                                          u
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    
                                       
                                          v
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    
                                       
                                          w
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    1
                                 
                              
                              )
                           
                         defined at 
                           
                              
                                 O
                              
                              
                                 1
                              
                           
                         and are shown in Fig. 9. The direction normal 
                           
                              
                                 
                                    
                                       n
                                    
                                    
                                       ˆ
                                    
                                 
                              
                              
                                 2
                              
                           
                         through 
                           S
                         helps define an imaginary cylinder 
                           C
                           y
                           
                              
                                 l
                              
                              
                                 2
                              
                           
                         of radius 
                           
                              
                                 R
                              
                              
                                 i
                              
                           
                         through edge 
                           
                              
                                 S
                              
                              
                                 2
                              
                              
                                 ′
                              
                           
                           −
                           
                              
                                 S
                              
                              
                                 1
                              
                              
                                 ′
                              
                           
                         and is given by 
                           
                              
                                 
                                    
                                       
                                          
                                             n
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             u
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                    
                                       3
                                    
                                 
                                 cos
                                 β
                                 +
                                 
                                    
                                       
                                          
                                             v
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                    
                                       3
                                    
                                 
                                 sin
                                 β
                              
                           
                         where a local coordinate system 
                           
                              (
                              
                                 
                                    
                                       
                                          u
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    3
                                 
                              
                              ,
                              
                                 
                                    
                                       
                                          v
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    3
                                 
                              
                              ,
                              
                                 
                                    
                                       
                                          w
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    3
                                 
                              
                              )
                           
                         at 
                           S
                         as shown in Fig. 9 is given as 
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                w
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          3
                                       
                                    
                                    =
                                    
                                       (
                                       
                                          
                                             S
                                          
                                          
                                             2
                                          
                                          
                                             ′
                                          
                                       
                                       −
                                       
                                          
                                             S
                                          
                                          
                                             1
                                          
                                          
                                             ′
                                          
                                       
                                       )
                                    
                                    /
                                    
                                       |
                                       
                                          
                                             S
                                          
                                          
                                             2
                                          
                                          
                                             ′
                                          
                                       
                                       −
                                       
                                          
                                             S
                                          
                                          
                                             1
                                          
                                          
                                             ′
                                          
                                       
                                       |
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          
                                             
                                                u
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          3
                                       
                                    
                                    =
                                    
                                       (
                                       
                                          
                                             
                                                
                                                   t
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                          
                                             l
                                          
                                          
                                             ′
                                          
                                       
                                       ×
                                       
                                          
                                             
                                                
                                                   w
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                          
                                             3
                                          
                                       
                                       )
                                    
                                    /
                                    
                                       |
                                       
                                          
                                             
                                                
                                                   t
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                          
                                             l
                                          
                                          
                                             ′
                                          
                                       
                                       ×
                                       
                                          
                                             
                                                
                                                   w
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                          
                                             3
                                          
                                       
                                       |
                                    
                                 
                              
                              
                                 
                                    
                                       
                                          
                                             
                                                v
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          3
                                       
                                    
                                    =
                                    
                                       (
                                       
                                          
                                             
                                                
                                                   w
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                          
                                             3
                                          
                                       
                                       ×
                                       
                                          
                                             
                                                
                                                   u
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                          
                                             3
                                          
                                       
                                       )
                                    
                                    /
                                    
                                       |
                                       
                                          
                                             
                                                
                                                   w
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                          
                                             3
                                          
                                       
                                       ×
                                       
                                          
                                             
                                                
                                                   u
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                          
                                             3
                                          
                                       
                                       |
                                    
                                    ,
                                 
                              
                           
                         where 
                           
                              
                                 
                                    
                                       t
                                    
                                    
                                       ˆ
                                    
                                 
                              
                              
                                 l
                              
                              
                                 ′
                              
                           
                         represents the rotated tool axis about 
                           
                              
                                 
                                    
                                       u
                                    
                                    
                                       ˆ
                                    
                                 
                              
                              
                                 1
                              
                           
                        , given by 
                           
                              
                                 
                                    
                                       
                                          
                                             t
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                    
                                       l
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             v
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                    
                                       1
                                    
                                 
                                 sin
                                 θ
                                 −
                                 
                                    
                                       
                                          
                                             w
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                    
                                       1
                                    
                                 
                                 cos
                                 θ
                                 .
                              
                           
                         Eq. (11) ensures that the point 
                           S
                         on the edge 
                           
                              
                                 S
                              
                              
                                 2
                              
                              
                                 ′
                              
                           
                           −
                           
                              
                                 S
                              
                              
                                 1
                              
                              
                                 ′
                              
                           
                         is 
                           
                              
                                 R
                              
                              
                                 i
                              
                           
                         away from the center of the torus at 
                           
                              
                                 O
                              
                              
                                 2
                              
                           
                        , but it does not ensure tangency of vector 
                           
                              
                                 
                                    
                                       n
                                    
                                    
                                       ˆ
                                    
                                 
                              
                              
                                 2
                              
                           
                         to circle 
                           C
                           i
                           
                              
                                 r
                              
                              
                                 2
                              
                           
                         through 
                           
                              
                                 T
                              
                              
                                 c
                              
                              
                                 ′
                              
                           
                         at 
                           
                              
                                 O
                              
                              
                                 2
                              
                           
                        . To ensure this tangency the normal 
                           
                              
                                 
                                    
                                       n
                                    
                                    
                                       ˆ
                                    
                                 
                              
                              
                                 2
                              
                           
                         at 
                           S
                         must be perpendicular to tangent to circle 
                           C
                           i
                           
                              
                                 r
                              
                              
                                 2
                              
                           
                         through 
                           
                              
                                 T
                              
                              
                                 c
                              
                              
                                 ′
                              
                           
                         at 
                           
                              
                                 O
                              
                              
                                 2
                              
                           
                        . The perpendicularity of direction normal 
                           
                              
                                 
                                    
                                       n
                                    
                                    
                                       ˆ
                                    
                                 
                              
                              
                                 2
                              
                           
                         to tangent to 
                           C
                           i
                           
                              
                                 r
                              
                              
                                 2
                              
                           
                           =
                           
                              (
                              
                                 
                                    
                                       
                                          v
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    2
                                 
                              
                              cos
                              ϕ
                              −
                              
                                 
                                    
                                       
                                          u
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    2
                                 
                              
                              sin
                              ϕ
                              )
                           
                         is ensured by 
                           
                              (12)
                              
                                 
                                    (
                                    
                                       
                                          
                                             
                                                v
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          2
                                       
                                    
                                    cos
                                    ϕ
                                    −
                                    
                                       
                                          
                                             
                                                u
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          2
                                       
                                    
                                    sin
                                    ϕ
                                    )
                                 
                                 ⋅
                                 
                                    
                                       
                                          
                                             n
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                                 =
                                 0
                                 .
                              
                           
                        
                     

Eqs. (11) and (12) can be solved for angles 
                           θ
                        , 
                           ϕ
                        , 
                           β
                         and scalar 
                           
                              
                                 s
                              
                              
                                 ′
                              
                           
                        . If 
                           
                              
                                 s
                              
                              
                                 ′
                              
                           
                         lies between 0 and 1, then the contact point lies within the edge and it is a valid solution; otherwise the solution is discarded. For all valid solutions from the edges of facet, the solution that offers minimum value of tool axis rotation 
                           θ
                         is accepted as the valid solution for tool path location and orientation.

In this stage the contact position of the rotating tool and the vertices of 
                           △
                           
                              
                                 S
                              
                              
                                 1
                              
                           
                           
                              
                                 S
                              
                              
                                 2
                              
                           
                           
                              
                                 S
                              
                              
                                 3
                              
                           
                         are computed. Any of the three vertices may have valid contact with rotated toroidal tool. Out of all touching vertices, the one with the smallest angle of tool rotation 
                           θ
                         is selected.

As the tool rotates by an angle 
                           θ
                         about the axis of the pseudo-insert at the first point of contact 
                           
                              
                                 
                                    
                                       u
                                    
                                    
                                       ˆ
                                    
                                 
                              
                              
                                 1
                              
                           
                         onto a vertex 
                           S
                        , the new orientation of the tool axis (as shown in Fig. 10
                        ) is given by 
                           
                              
                                 
                                    
                                       
                                          
                                             t
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                    
                                       l
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 
                                    
                                       
                                          
                                             v
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                    
                                       1
                                    
                                 
                                 sin
                                 θ
                                 −
                                 
                                    
                                       
                                          
                                             w
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                    
                                       1
                                    
                                 
                                 cos
                                 θ
                                 .
                              
                           
                         There are three possibilities depending on the distance of 
                           S
                         from the projection of rotated tool center 
                           
                              
                                 T
                              
                              
                                 c
                              
                              
                                 ′
                              
                           
                         on a plane containing bottom of toroidal tool, which is given by 
                           
                              
                                 
                                    |
                                    
                                       
                                          T
                                       
                                       
                                          c
                                       
                                       
                                          ′
                                       
                                    
                                    −
                                    
                                       
                                          
                                             
                                                t
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          l
                                       
                                       
                                          ′
                                       
                                    
                                    
                                       
                                          R
                                       
                                       
                                          i
                                       
                                    
                                    −
                                    S
                                    |
                                 
                              
                           
                         where 
                           
                              
                                 T
                              
                              
                                 c
                              
                              
                                 ′
                              
                           
                         can be found with Eq. (9). 
                           Case 1:
                           
                              
                                 
                                    
                                       (
                                       
                                          
                                             R
                                          
                                          
                                             i
                                          
                                       
                                       +
                                       
                                          
                                             R
                                          
                                          
                                             O
                                          
                                       
                                       )
                                    
                                    ≤
                                    
                                       |
                                       
                                          (
                                          
                                             
                                                T
                                             
                                             
                                                c
                                             
                                             
                                                ′
                                             
                                          
                                          −
                                          
                                             
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      ˆ
                                                   
                                                
                                             
                                             
                                                l
                                             
                                             
                                                ′
                                             
                                          
                                          
                                             
                                                R
                                             
                                             
                                                i
                                             
                                          
                                          )
                                       
                                       −
                                       S
                                       |
                                    
                                 : in this case the vertex will not touch the rotated tool.


                                 
                                    0
                                    ≤
                                    
                                       |
                                       
                                          (
                                          
                                             
                                                T
                                             
                                             
                                                c
                                             
                                             
                                                ′
                                             
                                          
                                          −
                                          
                                             
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      ˆ
                                                   
                                                
                                             
                                             
                                                l
                                             
                                             
                                                ′
                                             
                                          
                                          
                                             
                                                R
                                             
                                             
                                                i
                                             
                                          
                                          )
                                       
                                       −
                                       S
                                       |
                                    
                                    ≤
                                    
                                       
                                          R
                                       
                                       
                                          O
                                       
                                    
                                 : in this case 
                                    S
                                  lies under the flat region of rotated radiused end mill and following equation can be solved to find out the angle of rotation 
                                    θ
                                  such that the vertex 
                                    S
                                  lies in the plane containing the bottom of rotated tool:
                                    
                                       
                                          
                                             (
                                             
                                                (
                                                
                                                   
                                                      T
                                                   
                                                   
                                                      c
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                −
                                                
                                                   
                                                      
                                                         
                                                            t
                                                         
                                                         
                                                            ˆ
                                                         
                                                      
                                                   
                                                   
                                                      l
                                                   
                                                   
                                                      ′
                                                   
                                                
                                                
                                                   
                                                      R
                                                   
                                                   
                                                      i
                                                   
                                                
                                                )
                                             
                                             −
                                             S
                                             )
                                          
                                          ⋅
                                          
                                             
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      ˆ
                                                   
                                                
                                             
                                             
                                                l
                                             
                                             
                                                ′
                                             
                                          
                                          =
                                          0
                                          .
                                       
                                    
                                 
                              


                                 
                                    
                                       
                                          R
                                       
                                       
                                          O
                                       
                                    
                                    ≤
                                    
                                       |
                                       
                                          (
                                          
                                             
                                                T
                                             
                                             
                                                c
                                             
                                             
                                                ′
                                             
                                          
                                          −
                                          
                                             
                                                
                                                   
                                                      t
                                                   
                                                   
                                                      ˆ
                                                   
                                                
                                             
                                             
                                                l
                                             
                                             
                                                ′
                                             
                                          
                                          
                                             
                                                R
                                             
                                             
                                                i
                                             
                                          
                                          )
                                       
                                       −
                                       S
                                       |
                                    
                                    ≤
                                    
                                       
                                          R
                                       
                                       
                                          i
                                       
                                    
                                    +
                                    
                                       
                                          R
                                       
                                       
                                          O
                                       
                                    
                                 : in this case the vertex will touch the cutting edge on the pseudo-insert of rotated tool when 
                                    
                                       
                                          (13)
                                          
                                             
                                                
                                                   O
                                                
                                                
                                                   2
                                                
                                             
                                             =
                                             
                                                
                                                   T
                                                
                                                
                                                   c
                                                
                                                
                                                   ′
                                                
                                             
                                             +
                                             
                                                
                                                   R
                                                
                                                
                                                   O
                                                
                                             
                                             
                                                (
                                                
                                                   
                                                      
                                                         
                                                            u
                                                         
                                                         
                                                            ˆ
                                                         
                                                      
                                                   
                                                   
                                                      2
                                                   
                                                
                                                cos
                                                ϕ
                                                +
                                                
                                                   
                                                      
                                                         
                                                            v
                                                         
                                                         
                                                            ˆ
                                                         
                                                      
                                                   
                                                   
                                                      2
                                                   
                                                
                                                sin
                                                ϕ
                                                )
                                             
                                          
                                       
                                       
                                          (14)
                                          
                                             
                                                
                                                   O
                                                
                                                
                                                   2
                                                
                                             
                                             =
                                             S
                                             +
                                             
                                                
                                                   R
                                                
                                                
                                                   i
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         n
                                                      
                                                      
                                                         ˆ
                                                      
                                                   
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                    
                                  where 
                                    
                                       
                                          
                                             
                                                n
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          2
                                       
                                    
                                  is the direction normal from vertex 
                                    S
                                  pointing towards circle 
                                    C
                                    i
                                    
                                       
                                          r
                                       
                                       
                                          2
                                       
                                    
                                 .

Eqs. (13) and (14) have five variable parameters: 
                           θ
                           ,
                           ϕ
                           ,
                           β
                           ,
                           
                              
                                 s
                              
                              
                                 ′
                              
                           
                           ,
                           
                              
                                 t
                              
                              
                                 ′
                              
                           
                        . Thus two additional equations are required to solve for the five variable parameters. Eq. (14) ensures that vertex 
                           S
                         on the STL surface is 
                           
                              
                                 R
                              
                              
                                 i
                              
                           
                         away from the center of the torus, but it does not ensure that direction normal 
                           
                              
                                 
                                    
                                       n
                                    
                                    
                                       ˆ
                                    
                                 
                              
                              
                                 2
                              
                           
                         is perpendicular to the tangent to 
                           C
                           i
                           
                              
                                 r
                              
                              
                                 2
                              
                           
                         at 
                           
                              
                                 O
                              
                              
                                 2
                              
                           
                        . The tangent to circle 
                           C
                           i
                           
                              
                                 r
                              
                              
                                 2
                              
                           
                         at 
                           
                              
                                 O
                              
                              
                                 2
                              
                           
                         is given by 
                           
                              
                                 
                                    
                                       v
                                    
                                    
                                       ˆ
                                    
                                 
                              
                              
                                 2
                              
                           
                           cos
                           ϕ
                           −
                           
                              
                                 
                                    
                                       u
                                    
                                    
                                       ˆ
                                    
                                 
                              
                              
                                 2
                              
                           
                           sin
                           ϕ
                        , and the perpendicularity of direction normal 
                           
                              
                                 
                                    
                                       n
                                    
                                    
                                       ˆ
                                    
                                 
                              
                              
                                 2
                              
                           
                         to tangent to circle 
                           C
                           i
                           
                              
                                 r
                              
                              
                                 2
                              
                           
                         at 
                           
                              
                                 O
                              
                              
                                 2
                              
                           
                         is ensured by 
                           
                              (15)
                              
                                 
                                    (
                                    
                                       
                                          
                                             
                                                v
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          2
                                       
                                    
                                    cos
                                    ϕ
                                    −
                                    
                                       
                                          
                                             
                                                u
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          2
                                       
                                    
                                    sin
                                    ϕ
                                    )
                                 
                                 ⋅
                                 
                                    
                                       
                                          
                                             n
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                    
                                       2
                                    
                                 
                                 =
                                 0
                                 .
                              
                           
                         Also the vector 
                           
                              
                                 T
                              
                              
                                 c
                              
                              
                                 ′
                              
                           
                           −
                           
                              
                                 O
                              
                              
                                 2
                              
                           
                         has to be normal to rotated tool axis 
                           
                              
                                 
                                    
                                       t
                                    
                                    
                                       ˆ
                                    
                                 
                              
                              
                                 l
                              
                              
                                 ′
                              
                           
                        . Thus another equation can be written as 
                           
                              
                                 (16)
                                 
                                    
                                       (
                                       
                                          
                                             T
                                          
                                          
                                             c
                                          
                                          
                                             ′
                                          
                                       
                                       −
                                       
                                          
                                             O
                                          
                                          
                                             2
                                          
                                       
                                       )
                                    
                                    ⋅
                                    
                                       
                                          
                                             
                                                t
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          l
                                       
                                       
                                          ′
                                       
                                    
                                    =
                                    0
                                 
                              
                              
                                 (17)
                                 
                                    ⇒
                                    
                                       (
                                       
                                          
                                             T
                                          
                                          
                                             c
                                          
                                          
                                             ′
                                          
                                       
                                       −
                                       S
                                       +
                                       
                                          
                                             R
                                          
                                          
                                             i
                                          
                                       
                                       
                                          
                                             
                                                
                                                   n
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                          
                                             2
                                          
                                       
                                       )
                                    
                                    ⋅
                                    
                                       
                                          
                                             
                                                t
                                             
                                             
                                                ˆ
                                             
                                          
                                       
                                       
                                          l
                                       
                                       
                                          ′
                                       
                                    
                                    =
                                    0
                                    .
                                 
                              
                           
                         The non-linear simultaneous equations Eqs. (13)–(15) and (17) can be solved for five variables 
                           θ
                           ,
                           ϕ
                           ,
                           β
                           ,
                           
                              
                                 s
                              
                              
                                 ′
                              
                           
                           ,
                           
                              
                                 t
                              
                              
                                 ′
                              
                           
                         to find the five axis tool position for all three vertices of triangular face under consideration. For all valid solutions the solution with the minimum value of 
                           θ
                         is taken as the final solution for tool path location and orientation.

If the tool is dropped on a boundary element triangle, potentially the tool will be rotated off the edge of the surface. However, in an industrial implementation, machine kinematics will limit the rotation of the tool. Further, if we construct the footprint to lie inside the shadow of the surface, then we can treat boundary element triangles as any other triangle in the STL file and not as special cases.

The algorithm presented in Sections  3–5 requires the solution of linear and non-linear simultaneous equations. To test the concept, we implemented the algorithm in the MAPLE symbolic algebra environment. MAPLE offers a programming and plotting environment, which was used to test the algorithm.

An industrial STL surface will have thousands of triangles or more. However, for our algorithm, the tool will be in contact with at most two triangles at any time. While there are computational issues associated with larger numbers of triangles (since each triangle in the tool shadow has to be tested to find the first point of contact and tested again to find the second point of contact), the basic operation of the algorithm can be illustrated with a small number of triangles.

Two adjacent triangles seemed inadequate to test issues related to dropping the tool on edges and vertices, nor would two triangles be sufficient to test finding the second point of contact when rotating the tool. Instead, as a proof of concept, the algorithm was tested on a four triangle pyramid and a four triangle inverted pyramid. This was sufficient to test our algorithm as the tool moved over faces, edges and a vertex.

Both pyramidal parts were 100 mm×100 mm in size, with a depth/rise of approximately 20 mm. The first part was the rectangular pyramid shown in Fig. 11
                     (a). This part was selected to show that the algorithm works on convex parts and can handle edges and vertices. A plot of the tool path with a zigzag tool path footprint is also shown in Figs. 11(a) and 12
                     (a). Note that the footprint is inside the shadow of the pyramid, avoiding issues with boundary element triangles.

In Fig. 12, the tool is represented by torus and shows every tenth position of the tool (torus); when seen from the bottom in this figure, the tool outline indicates that there is no gouging of the part. We also machined the part on a DMG 80P 5-axis machine with a rotary tilt table. The tool dimensions are 
                        
                           
                              R
                           
                           
                              i
                           
                        
                        =
                        6
                        
                        
                           mm
                        
                      and 
                        
                           
                              R
                           
                           
                              o
                           
                        
                        =
                        6.5
                        
                        
                           mm
                        
                     . The feed forward step was 0.5 mm and the side step was 10 mm. The machined part is shown in Fig. 15(a). The machined part matched the simulation closely. It had sharp edges and the scallops between adjacent passes were negligible. Note the excess material near the tip; to remove this excess material would require extra passes.

The second part was an inverted (concave) rectangular pyramid and is shown in Fig. 11(b). This part was selected to show that the algorithm works on concave parts and can handle multiple triangles. A plot of the tool path is shown in Fig. 13
                     . In the plot the tool is represented by toroid or toroi. The plot shows every tenth position of the tool (torus). In this figure the tool is shown crossing one of the part edges. When seen from the bottom the tool outline is observable without any gouging of the part. We also machine this part on a DMG 80P 5-axis machine with a rotary tilt table with the same tool and same step sizes as the pyramid. The machined part is shown in Fig. 15(b). The machined part matched the simulation closely. The tool crossed the edge without gouging, but left un-machined material near the edges as expected.

To better illustrate the tool path, we show in Fig. 14
                     (a), (b) a portion of the tool path where the tool starts on the surface of one triangle and transitions across the common edge to a second triangle.

When machining the pyramid, the edges were sharp with no gouging and the vertex crossed without gouging. As the tool crosses the edge it was expected to roll along the edge from one facet to the next. This is shown in Fig. 14(a).

For crossing an edge of the inverted pyramid, the algorithm resulted in a tool inclination that aligned the tool axis to the facet normal as was expected. As the tool moves towards the edge the second contact point moves from one triangular face into the neighboring face. As the tool crosses an edge it was anticipated that the second point of contact would make the tool stand-up into a vertical position and then as the tool moves further into the second facet, it would start inclining towards the normal of the second face. The tool behaved as anticipated. This can be seen from the simulation results in Fig. 14(b).

Near the bottom of the inverted pyramid the tool has the potential of touching any of the four faces of the pyramid during its dropping phase and during its tilting phase. The algorithm processed this section successfully.

@&#CONCLUSIONS@&#

The drop and tilt method presented in this work can be used to position the tool on a triangulated surface with two points of contact using a radiused end milled tool for 5-axis machining. The method can handle multiple triangles, edges and vertices successfully, and the computed tool positions are gouge free. However, note that while a radiused end mill is a generalization of a ball-nose tool, in the case of a ball-nose tool our method will find only a single point of contact, since rotating around the pseudo-insert of a ball-nose tool (a sphere) does not change what is machined.

Previous multipoint machining methods  [13] investigated cusp height. The observation from this earlier work is that the cusp profile for multipoint machining is W-shaped, which differs from the U-shaped cusp profile of 3-axis machining. Between the two contact points, the cusp height is small enough for most engineering applications, but the cusp rises sharply beyond the contact points. The impact this cusp shape is that a larger side step can be used while still meeting engineering tolerance requirements. While we have not investigated the cusp height for our method, we expect that it will be similar to that of this earlier work on multipoint machining.

Xu et al.  [4] noted that drastic changes in tool orientation from point to point may increase machining time in certain cases. These changes in orientations manifest in the tool path planning phase. Tool path planning is not the focus of our work and further research is required to integrate our tool positioning method with a tool path planning algorithm to avoid these sharp motions.

Our method rotates around the pseudo-insert. Alternate rotations are possible, but the optimal rotation likely depends on the particular goals of the machinist, such as minimizing cusp height, maximizing step forward, reducing cusp deviation. Optimizing for various goals is topic of future study.

Finally, our method is based on solving linear/non-linear simultaneous equations. While these equations can readily be solved in Maple, the solution time is long and severely restricts the number of triangles that can be used. The STL file for an industrial part will have thousands or more triangles, and our Maple implementation would require hours to generated a tool path for such triangle set, an unacceptable amount of time in an industrial setting. Thus, stand-alone software using robust solvers are needed to make our method practical for industrial uses. A simple method for solving these equations is an open question.

@&#REFERENCES@&#

