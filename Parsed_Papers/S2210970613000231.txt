@&#MAIN-TITLE@&#A MIP-based timetable rescheduling formulation and algorithm minimizing further inconvenience to passengers

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           A timetable recovery MIP model minimizing inconvenience to passengers is proposed.


                        
                        
                           
                           Train operation and passenger’s behavior are expressed by inequalities.


                        
                        
                           
                           Several countermeasures against a disruption are implemented.


                        
                        
                           
                           Inconvenience consists of travel by a train, a wait for a train, a train transfer.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Timetable rescheduling

Mixed Integer Programming

Passenger’s behavior

Connection

Shortest path

@&#ABSTRACT@&#


               
               
                  This paper presents a timetable rescheduling algorithm based on Mixed Integer Programming (MIP) formulation when train traffic is disrupted. We minimize further inconvenience to passengers instead of consecutive delays caused by the disruption, since loss of time and satisfaction of the passengers are considered implicitly and insufficiently in the latter optimization. We presume that inconvenience of traveling by train consists of the traveling time on board, the waiting time at platforms and the number of transfers. Hence, the objective function is calculated on the positive difference between the inconvenience which each passenger suffers on his/her route in a rescheduled timetable and that in a planned timetable. The inconvenience-minimized rescheduling is often achieved at the cost of further train delays. Some trains dwell longer at a station to wait for extra passengers to come or to keep a connection, for instance. In the MIP model, train operation, each passenger’s behavior and the amount inconvenience are simultaneously expressed by a system of integer linear inequalities. As countermeasures against the disruption, changes of train types and rolling stock operation schedules at termini as well as changes of departing order of trains and assignment of a track to trains in stations are performed. We also consider capacities of a line between adjacent stations as well as those of a track in stations. We have conducted numerical experiments using actual data and have obtained better rescheduled timetables in terms of customer satisfaction within practical time in proper solution space.
               
            

set of train directions

opposite direction of 
                           
                              b
                              ∈
                              B
                           
                        
                     

set of trains

set of trains traveling in 
                           
                              b
                              ∈
                              B
                           
                        
                     

set of ordered pair of distinct trains traveling in 
                           
                              b
                              ∈
                              B
                           
                        
                     

set of candidate successor trains of 
                           
                              r
                              ∈
                              R
                           
                        
                     

set of stations

starting station of trains traveling in 
                           
                              b
                              ∈
                              B
                           
                        
                     

terminus of trains traveling in 
                           
                              b
                              ∈
                              B
                           
                        
                     

station next to 
                           
                              s
                              ∈
                              S
                           
                         in 
                           
                              b
                              ∈
                              B
                           
                        
                     

set of O–D pair of stations in 
                           
                              b
                              ∈
                              B
                           
                        
                     

set of stations at which passengers to 
                           
                              d
                              ∈
                              S
                           
                         in 
                           
                              b
                              ∈
                              B
                           
                         can transfer

station next to 
                           
                              s
                              ∈
                              S
                           
                         in 
                           
                              b
                              ∈
                              B
                           
                         at which passengers can transfer

set of tracks at 
                           
                              s
                              ∈
                              S
                           
                         which trains traveling in 
                           
                              b
                              ∈
                              B
                           
                         can pass through or stop at

set of train types

set of train types which stop at 
                           
                              s
                              ∈
                              S
                           
                        
                     

set of train types which passengers can take at s to reach d where 
                           
                              (
                              s
                              ,
                              d
                              )
                              ∈
                              
                                 
                                    S
                                 
                                 
                                    b
                                    <
                                 
                                 
                                    2
                                 
                              
                           
                        
                     

priority relation between two train types

set of discrete time periods

set of two pairs 
                           
                              (
                              o
                              ,
                              
                                 
                                    d
                                 
                                 
                                    1
                                 
                              
                              )
                              ,
                              (
                              o
                              ,
                              
                                 
                                    d
                                 
                                 
                                    2
                                 
                              
                              )
                              ∈
                              
                                 
                                    S
                                 
                                 
                                    b
                                    <
                                 
                                 
                                    2
                                 
                              
                           
                         with 
                           
                              
                                 
                                    d
                                 
                                 
                                    1
                                 
                              
                              ≠
                              
                                 
                                    d
                                 
                                 
                                    2
                                 
                              
                           
                         whose behavior is same when they appear at same time

arrival/departure time of 
                           
                              r
                              ∈
                              R
                           
                         at 
                           
                              s
                              ∈
                              S
                           
                         in planned timetable

amount of inconvenience to passengers between 
                           
                              (
                              o
                              ,
                              d
                              )
                              ∈
                              
                                 
                                    S
                                 
                                 
                                    b
                                    <
                                 
                                 
                                    2
                                 
                              
                           
                         appearing at 
                           
                              t
                              ∈
                              T
                           
                         in planned timetable

arrival/departure time of 
                           
                              r
                              ∈
                              R
                           
                         at 
                           
                              s
                              ∈
                              S
                           
                         in certain feasible rescheduled timetable

minimum interval required between arrivals and departures

arbitrary large number concerning headway/inconvenience

maximum number of trains traveling in 
                           
                              b
                              ∈
                              B
                           
                         allowed to exist on line between 
                           
                              (
                              s
                              ,
                              Next
                              (
                              b
                              ,
                              s
                              )
                              )
                           
                        
                     

number of passengers between 
                           
                              (
                              o
                              ,
                              d
                              )
                              ∈
                              
                                 
                                    S
                                 
                                 
                                    b
                                    <
                                 
                                 
                                    2
                                 
                              
                           
                         appearing at 
                           
                              t
                              ∈
                              T
                           
                        
                     

inconvenience of waiting for 1min at platform

inconvenience of one train transfer

flexibility in timetable to be rescheduled

arrival/departure time of 
                           
                              r
                              ∈
                              R
                           
                         at 
                           
                              s
                              ∈
                              S
                           
                        
                     

0–1 if or not type of 
                           
                              r
                              ∈
                              R
                           
                         is 
                           
                              e
                              ∈
                              E
                           
                        
                     

0–1 if or not 
                           
                              r
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    b
                                 
                              
                           
                         passes through or stops at 
                           
                              k
                              ∈
                              
                                 
                                    K
                                 
                                 
                                    b
                                    ,
                                    s
                                 
                              
                           
                        
                     

0–1 if or not successor of 
                           
                              
                                 
                                    r
                                 
                                 
                                    1
                                 
                              
                              ∈
                              R
                           
                         is 
                           
                              
                                 
                                    r
                                 
                                 
                                    2
                                 
                              
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    Suc
                                    (
                                    
                                       
                                          r
                                       
                                       
                                          1
                                       
                                    
                                    )
                                 
                              
                           
                        
                     

0–1 if or not 
                           
                              
                                 
                                    r
                                 
                                 
                                    1
                                 
                              
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    b
                                 
                              
                           
                         departs from 
                           
                              s
                              ∈
                              S
                              ⧹
                              {
                              Term
                              (
                              b
                              )
                           
                        } earlier than 
                           
                              
                                 
                                    r
                                 
                                 
                                    2
                                 
                              
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    b
                                 
                              
                              ⧹
                              {
                              
                                 
                                    r
                                 
                                 
                                    1
                                 
                              
                              }
                           
                        
                     

0–1 if or not 
                           
                              
                                 
                                    r
                                 
                                 
                                    1
                                 
                              
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    b
                                 
                              
                           
                         arrives at Term(b) earlier than 
                           
                              
                                 
                                    r
                                 
                                 
                                    2
                                 
                              
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    Opp
                                 
                              
                              (
                              b
                              )
                           
                         departs from

0–1 if or not 
                           
                              
                                 
                                    r
                                 
                                 
                                    2
                                 
                              
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    Opp
                                    (
                                    b
                                    )
                                 
                              
                           
                         departs from Term(b) earlier than 
                           
                              
                                 
                                    r
                                 
                                 
                                    1
                                 
                              
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    b
                                 
                              
                           
                         arrives at

0–1 if or not 
                           
                              
                                 
                                    N
                                 
                                 
                                    b
                                    ,
                                    s
                                 
                              
                              -
                              1
                           
                         trains depart from s after 
                           
                              
                                 
                                    r
                                 
                                 
                                    1
                                 
                              
                           
                         and before 
                           
                              
                                 
                                    r
                                 
                                 
                                    2
                                 
                              
                           
                         does

0–1 if or not passengers between 
                           
                              (
                              o
                              ,
                              d
                              )
                              ∈
                              
                                 
                                    S
                                 
                                 
                                    b
                                    <
                                 
                                 
                                    2
                                 
                              
                           
                         appearing at 
                           
                              t
                              ∈
                              T
                           
                         take 
                           
                              r
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    b
                                 
                              
                           
                        
                     

0–1 if or not passengers to 
                           
                              d
                              ∈
                              S
                           
                         at 
                           
                              s
                              ∈
                              
                                 
                                    S
                                 
                                 
                                    Tra
                                    (
                                    b
                                    ,
                                    d
                                    )
                                 
                              
                           
                         transfer from 
                           
                              
                                 
                                    r
                                 
                                 
                                    1
                                 
                              
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    b
                                 
                              
                           
                         to 
                           
                              
                                 
                                    r
                                 
                                 
                                    2
                                 
                              
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    b
                                 
                              
                           
                        
                     

amount of inconvenience to passengers to d when they take 
                           
                              r
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    b
                                 
                              
                           
                         at s where 
                           
                              (
                              s
                              ,
                              d
                              )
                              ∈
                              
                                 
                                    S
                                 
                                 
                                    b
                                    <
                                 
                                 
                                    2
                                 
                              
                           
                        
                     

increased amount of inconvenience to passengers between 
                           
                              (
                              o
                              ,
                              d
                              )
                              ∈
                              
                                 
                                    S
                                 
                                 
                                    b
                                    <
                                 
                                 
                                    2
                                 
                              
                           
                         appearing at 
                           
                              t
                              ∈
                              T
                           
                         taking 
                           
                              r
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    b
                                 
                              
                           
                        
                     

@&#INTRODUCTION@&#

In Japan, railways play quite an important role in public transportation. The total number of passengers carried by the railways per year reaches as much as 22 billion and the total running distance of trains per day is approximately 3.3 million kilometers. In fact, trains are operated every several minutes in big cities to transport a massive amount of commuters. The trains are known to be very punctual; nevertheless, train operation is occasionally disrupted by accidents, natural disasters, malfunctions of facilities, etc., and a lot of passengers are more or less affected. When the trains are delayed by these disruptions, a series of changes is made to a timetable to prevent the delay from further propagating. This task is called timetable rescheduling (sometimes we just call “rescheduling”).

The major part of the timetable rescheduling is currently carried out by human experts called train dispatchers and computers aid them by showing a prediction about future train operation. Although a comprehensive and intelligent support system, whose core is an algorithm to provide a good timetable rescheduling plan, has been longed for, it is a challenging task to develop a practical algorithm on account of the following reasons (refer to (Institute of Electrical Engineers of Japan, 2010)):
                        
                           •
                           The timetable rescheduling is a complicated combinatorial optimization problem since there are a lot of methods to change train schedules.

The problem size is large for busy railway lines.

We need a fast algorithm to solve the problem in real time.

We have to reduce dissatisfaction of the passengers based on their present locations and a forecast of their behavior, which is difficult since there exist a lot of passengers whose origins and destinations are different.

We believe that the last issue is of crucial importance. A major rescheduling objective in the literature has been the total amount of delays. This does not suffice particularly in busy lines since:
                        
                           •
                           If we cancel trains, delays of the canceled trains will obviously disappear and the total amount of delays will decrease. On the other hand, it is quite probable that some passengers have to wait for a period of time at several stations until the next train comes and congestion of the train as well as the stations will increase very much. Hence, trains must not be canceled if there exist a lot of passengers.

Urban railway lines transport a massive amount of passengers. In these lines, it is sometimes more important to keep an interval between two train departures constant than to reduce delays. Otherwise, a certain train becomes too congested and the congestion brings more delays.

In this paper, we formulate the timetable rescheduling problem as a Mixed Integer Programming (MIP) problem (refer to Williams (2013) for MIP and its applications) and introduce a timetable rescheduling algorithm which outputs a rescheduling plan minimizing further inconvenience to the passengers caused by the disruption. In the MIP model, each passenger’s behavior and the amount of inconvenience which he/she suffers on his/her route as well as train operation are simultaneously expressed by a system of integer linear inequalities. We adopt several countermeasures against the disruption which train dispatchers in Japan actually perform. We also take into account capacities of a line between adjacent stations as well as those of a track in stations. Each passenger is assumed to take a train and transfer so that the inconvenience to him/her will be minimized, depending on the rescheduled train operation.

MIP provides, unlike most metaheuristics, an exact optimal solution by improving lower and upper bounds of an objective function. On the other hand, it is considered to be time-consuming when a problem size or solution space is large. In the timetable rescheduling problem, the solution space is a range of time at which the occurrence of events such as rescheduled train arrivals/departures is allowed. We observe and discuss a tradeoff between the quality of a passenger-oriented timetable and computation time or train punctuality by numerical experiments using actual data.

The rest of the paper is organized as follows. In Section 2, we describe the timetable rescheduling problem together with related work. We introduce aims and assumptions of this study in Section 3. In Section 4, we formulate the problem as MIP and propose the passenger-oriented rescheduling algorithm in detail. We present numerical results based on arbitrary and actual data in Section 5. Section 6 concludes the paper and presents our view of future work.

Given information on railway facilities such as a track layout of a line and stations, physical, resource and operational constraints, a planned timetable, passenger demand and a disrupted situation (e.g., when and where the disruption has occurred), a timetable rescheduling problem is to find a feasible rescheduled timetable satisfying the constraints after applying a series of countermeasures against the disruption. Train dispatchers in Japan perform: a change of arriving/departing order of trains, a change of assignment of a track to trains in stations, a change of train types, adjustment of an interval between trains, a change of rolling stock operation schedules, (partial) cancellation of trains, etc. (also refer to (Institute of Electrical Engineers of Japan, 2010)).


                        Fig. 1
                         illustrates the change of departing order of trains. In railway lines which connect a suburban area and a downtown area, express trains are operated to offer a fast transportation service for passengers who live distant from a downtown area. In order to give a good service to customers of small stations where express trains do not stop, railway companies usually offer a timetable which is called “coupling” between express and local trains. The change of departing order works effectively for such a timetable when there occurs a delay. Fig. 1 depicts a situation where Express train (the bold gray line) is scheduled to overtake Local train (the thin black lines) at Station C originally. Suppose that Express is delayed at Station D (the bold black line), then the departing order of these trains at Station C should be changed and Local should depart prior to the Express. Otherwise Local has to wait for a long time.

The delayed Express departs earlier than Local at Station B in Fig. 1. When the both trains are scheduled to pass through or dwell at the same track at station B originally, the change of assignment of a track to Local is performed so that Express can overtake it.

The change of train types intends to make an express train stop at a station where it does not usually stop. If there are a lot of passengers waiting at the station, this countermeasure is very effective to reduce their dissatisfaction.


                        Fig. 2
                         is an example of the adjustment of intervals between trains. If the intervals become too large on account of a disruption, there might occur two types of problems. One is that waiting time of passengers becomes too long. The other is that, in urban railway lines, a delayed train becomes very congested since more passengers than usual are waiting for it. In order to avoid these problems, preceding trains are intentionally delayed; in other words, dispatchers try to equalize the intervals between pairs of adjacent trains by giving extra dwell time to the preceding trains. In Fig. 2, the fourth train is delayed at Station D and the dwell time of the second and the third train are prolonged at Stations B and C, respectively (the bold black lines).


                        Fig. 3
                         is an example of the change of rolling stock operation schedules. At Station A, the first arriving train is scheduled to enter a rolling stock depot adjacent to Station A (the thin triangle) and the second train is due to turn back and be operated as the third train in the opposite direction (the thin lines). Even if the second train is delayed, the third train can depart Station A without a delay by making the first train turn back and be operated as the third train, and instead the second train enter the depot (the bold lines and triangle).

Although we show rather simple examples in Figs. 1–3, we note that these countermeasures are combined and applied to a lot of trains in real time, which makes the timetable rescheduling problem very difficult.

@&#LITERATURE REVIEW@&#

There have been a lot of studies on the timetable rescheduling problem (refer to (Törnquist et al., 2006; Jespersen-Groth et al., 2009)). D’Ariano et al. (2007, 2008, 2009) and Corman et al. (2010) have introduced and extended a real-time traffic management system called ROMA (Railway traffic Optimization by Means of Alternative graphs), in which metaheuristics-based algorithms are applied. D’Ariano et al. (2008) have introduced flexibility in arrival and departure times of trains in a planned timetable and have rescheduled the trains by absorbing minor delays and changing order of the trains in the alternative graph model. Corman et al. (2011) have sequentially rescheduled trains with different classes of priority. The rescheduling optimization for each train class is based on the algorithm by D’Ariano et al. (2007). Törnquist (2007) and Törnquist Krasemann (2012) have also adopted heuristics to prevent train delays from further propagating. These algorithms do not explicitly deal with dissatisfaction of passengers.

On the other hand, Tomii et al. (2005) have proposed an algorithm based on Program Evaluation and Review Technique (PERT) formulation to reduce the dissatisfaction. In their paper, various kinds of situations where passengers might complain are sorted out a priori. These situations are considered to be constraints and the problem is regarded as a kind of constraint satisfaction problem. They have proposed an algorithm based on metaheuristics. Note that they do not have the number of passengers getting on each train explicitly. Kanai et al. (2011) have combined passenger flow simulation and the PERT formulation, counting the number of passengers on each train. Kliewer and Suhl (2011) have applied and evaluated several dispatching strategies by simulation to minimize the weighted sum of traveling and waiting times of passengers. Dollevoet et al. (2013) have developed three heuristics to minimize traveling time of passengers. Corman et al. (2012) have considered a bi-objective problem which minimizes train delays and missed transfer connections of passengers. They have developed heuristics to approximate the Pareto front of the objective values. Corman and D’Ariano (2012) have applied ROMA to emergency cyclic timetables which include canceled and rerouted trains defined in advance to cope with severe disturbances. Several emergency timetable scenarios are rescheduled and evaluated in relation to frequency of train services, the weighted sum of traveling and waiting times of passengers and cycle time as well as basic delay indicators. In light and heavy disruption cases, Corman et al. (2013) have rescheduled regular and shuttle timetables. They have assessed the rescheduled timetables in relation to the average total delay, the average consecutive delays and the weighted sum of traveling and waiting times. Krumke et al. (2011) have discussed extra dwell time of a single train at one or two stations to minimize extra traveling time of passengers or money refunded due to a large delay. They have introduced online algorithms and have analyzed their competitive ratios.

One of the drawbacks of (meta)heuristics is that it is usually difficult to obtain an optimal solution or to know how close the obtained solution is to the optimal solution. Meanwhile, MIP provides an exact optimal solution by improving lower and upper bounds of an objective function. On the other hand, it is considered to be time-consuming when a problem size or solution space is large. Törnquist and Persson (2007) have proposed MIP formulation to manage disturbed traffic conditions by means of train reordering and rerouting. Gély et al. (2006), Khosravi et al. (2012) and Pellegrini et al. (2012) have also introduced MIP approaches to minimize train delays. Walker et al. (2005) have rescheduled simultaneously a timetable and driver duties. Related to MIP, Rodriguez (2007) has proposed a constraint programming model. In these papers, the dissatisfaction of passengers is not included in the objective functions either.


                        Schöbel (2001) has preceded the above authors by introducing a MIP model with a different objective function, and Schöbel (2006) as well as Heilporn et al. (2008) has extended it. They minimize the sum of all delays over all passengers on rather strong assumptions. For instance, the timetable is cyclic, the passengers take a fixed route and they wait for the next train which arrives after one cycle time when a connection is missed. The next train is assumed to be operated on time. Schöbel (2009) and Dollevoet et al. (2011) have considered a limited capacity of tracks into account. Schachtebeck and Schöbel (2010) have added a decision problem of reordering of trains to the previous models while Dollevoet et al. (2012) have allowed rerouting of passengers, respectively. Ginkel and Schöbel (2007) have introduced a bi-objective MIP problem which minimizes train delays and missed transfer connections of passengers, and have enumerated all Pareto efficient solutions.

Order of trains affects passenger’s behavior since this may change the train which arrives at his/her destination first. Chigusa et al. (2012) have introduced MIP formulation taking this issue into account. They minimize extra traveling time of passengers. In their model, departing order of express and local trains as well as assignment of a track to trains in stations can be changed and the passengers change trains so that they can reach their destination earlier. The timetable and the track layout presented in their paper is too simple (e.g., only trains traveling in one direction are considered) and the problem size is too small. The passengers are assumed to change trains at most once.

We propose a MIP-based rescheduling algorithm which minimizes further inconvenience to passengers caused by a disruption. More precisely, the objective function is calculated on the positive difference between the inconvenience which each passenger suffers on his/her route in a rescheduled timetable and that in a planned timetable. We presume that inconvenience of traveling by train consists of the traveling time on board, the waiting time at platforms and the number of transfers. Hence, the objective function is an extension of that in the previous MIP models. Our model admits the reordering of trains by Schachtebeck and Schöbel (2010) and the rerouting of passengers by Dollevoet et al. (2012) at the same time, which is also introduced by Chigusa et al. (2012). We let events in the train operation be arrivals or departures of trains. The train operation constraints cover all the nine types of minimum intervals required between the events considered in the PERT formulation by Tomii et al. (2005), including a capacity of a line between adjacent stations, whereas Chigusa et al. (2012) discuss only a part of the interval constraints. Moreover, we count the number of passengers getting on each train explicitly as opposed to Tomii et al. (2005). As countermeasures against the disruption, we apply the change of departing order of trains and the change of assignment of a track to trains in stations, which are also introduced by Chigusa et al. (2012). Train types and rolling stock operation schedules are also changed, which are considered in some of the delay-minimization MIP models and not in the previous passenger-oriented MIP ones. A suitable interval between trains is expected to be achieved as a result of the optimization.

In the rescheduling problem, the solution space is a range of time at which the occurrence of the train arrival and departure events is allowed. We introduce a parameter to determine the range so that the MIP problem is tractable. The parameter also affects the intervals between the trains. We first solve a simple delay minimization problem and then optimize the timetable in terms of the inconvenience based on the delay-minimized timetable and the parameter value. The solution space for the inconvenience minimization problem is determined on-line depending on the solution for the delay minimization problem, whereas D’Ariano et al. (2008) give the time windows of arrival and departure times of trains in an off-line timetable design phase. We observe a tradeoff between the quality of a passenger-oriented timetable and computation time or train punctuality.

We summarize below some assumptions made in this paper:
                        
                           •
                           Timetable: we assume a timetable which involves express and local trains. It is not limited to be cyclic. Furthermore, an express train in a planned timetable can be operated as a local one and vice versa.

Track layout: we assume a track layout as shown in Fig. 4
                              . This kind of track layout is typically found in urban areas of Japan. The trains run toward one direction on each track. Note that this track layout is a double track and not a double single track, which we do not have in Japan. The trains can turn back at the left-end and the right-end stations (termini). Some of the stations have only two tracks while the others have more than two tracks, and the express trains can overtake the local trains there.

Passenger’s behavior: we assume that a passenger takes a route which makes inconvenience to him/her be minimized, depending on a rescheduled train operation. In this paper, we define a route as a choice of trains. We allow him/her to transfer even twice or more. We consider that inconvenience of traveling by train in the undisrupted and the rescheduled timetables is given by
                                 
                                    
                                       (traveling time on board)
                                       +
                                       α
                                       ×
                                       (waiting time at platforms)
                                       +
                                       β
                                       ×
                                       (the number of transfers)
                                       
                                       (in minutes).
                                    
                                 
                              
                           

This formula is the same as the one proposed by The Ministry of Land, Infrastructure, Transport and Tourism (2012) except that a term on train congestion which he/she experiences is omitted, and is commonly used by civil engineers in Japan. If we set 
                        
                           α
                           =
                           1
                           ,
                           β
                           =
                           0
                        
                     , then we have overall traveling time, which is the criterion of the model by Chigusa et al. (2012). The Ministry of Land, Infrastructure, Transport and Tourism (2012) recommends 
                        
                           α
                           =
                           2
                           ,
                           β
                           =
                           10
                        
                     .

We first introduce sets and their elements commonly used in our MIP formulation (they are summarized along with variables in Appendix.) Let B be a set of train directions (e.g., 
                           
                              B
                              ≔
                              {
                              Westbound
                              ,
                              Eastbound
                              }
                           
                         in Fig. 4), and for each direction 
                           
                              b
                              ∈
                              B
                           
                         its opposite direction 
                           
                              Opp
                              (
                              b
                              )
                           
                         is defined (e.g., 
                           
                              Opp
                              (
                              Westbound
                              )
                              =
                              Eastbound
                           
                        ). A set of trains is denoted by R and 
                           
                              
                                 
                                    R
                                 
                                 
                                    b
                                 
                              
                              ⊆
                              R
                           
                         is a set of trains traveling in direction b. An ordered pair 
                           
                              
                                 
                                    R
                                 
                                 
                                    b
                                    ≠
                                 
                                 
                                    2
                                 
                              
                           
                         means 
                           
                              
                                 
                                    R
                                 
                                 
                                    b
                                    ≠
                                 
                                 
                                    2
                                 
                              
                              ≔
                              {
                              (
                              
                                 
                                    r
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    r
                                 
                                 
                                    2
                                 
                              
                              )
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    b
                                 
                                 
                                    2
                                 
                              
                              
                              ∣
                              
                              
                                 
                                    r
                                 
                                 
                                    1
                                 
                              
                              ≠
                              
                                 
                                    r
                                 
                                 
                                    2
                                 
                              
                              }
                           
                        , i.e., ordered two distinct trains in direction b. Each train 
                           
                              r
                              ∈
                              R
                           
                         which will arrive at its terminus station may turn back and be operated as another train which has not departed its starting station at the time when we try to reschedule the timetable. We call it a successor train of r and 
                           
                              
                                 
                                    R
                                 
                                 
                                    Suc
                                    (
                                    r
                                    )
                                 
                              
                           
                         a set of candidate successor trains.

A set of stations is defined as S. Starting and terminus stations of trains traveling in direction 
                           
                              b
                              ∈
                              B
                           
                         are expressed by 
                           
                              Start
                              (
                              b
                              )
                           
                         and 
                           
                              Term
                              (
                              b
                              )
                           
                        , respectively. An element 
                           
                              Next
                              (
                              b
                              ,
                              s
                              )
                           
                         of S means a station next to 
                           
                              s
                              ∈
                              S
                           
                         in direction 
                           
                              b
                              ∈
                              B
                           
                        . Let 
                           
                              
                                 
                                    S
                                 
                                 
                                    b
                                    <
                                 
                                 
                                    2
                                 
                              
                           
                         be a set of Origin–Destination pair (O–D pair) of stations in direction b. For passengers who get on a train traveling in direction b and whose destination station is 
                           
                              d
                              ∈
                              S
                           
                        , there is an opportunity for a train transfer at some intermediate stations. We denote a set of such stations by 
                           
                              
                                 
                                    S
                                 
                                 
                                    Tra
                                    (
                                    b
                                    ,
                                    d
                                    )
                                 
                              
                              ⊆
                              S
                           
                        . After a train in direction b leaves station s, there may be a next opportunity for a transfer at a certain station. We name the station 
                           
                              TraNext
                              (
                              b
                              ,
                              s
                              )
                           
                        . Trains in direction b can pass through or stop at some tracks in station s, and they are denoted by 
                           
                              
                                 
                                    K
                                 
                                 
                                    b
                                    ,
                                    s
                                 
                              
                           
                        . We introduce set F to consider passengers between 
                           
                              (
                              o
                              ,
                              
                                 
                                    d
                                 
                                 
                                    1
                                 
                              
                              )
                           
                         and those between 
                           
                              (
                              o
                              ,
                              
                                 
                                    d
                                 
                                 
                                    2
                                 
                              
                              )
                           
                         who appear at the same time. When their behavior at o is the same regardless of 
                           
                              
                                 
                                    d
                                 
                                 
                                    1
                                 
                              
                              ≠
                              
                                 
                                    d
                                 
                                 
                                    2
                                 
                              
                           
                         (e.g., only local trains stop at o), we let 
                           
                              (
                              o
                              ,
                              
                                 
                                    d
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    d
                                 
                                 
                                    2
                                 
                              
                              )
                              ∈
                              F
                           
                        .

Let E be a set of train types (e.g., 
                           
                              E
                              ≔
                              {
                              Express
                              ,
                              Local
                              }
                           
                        ). For station 
                           
                              s
                              ∈
                              S
                              ,
                              
                                 
                                    E
                                 
                                 
                                    s
                                 
                              
                              ⊆
                              E
                           
                         is a set of train types which stop at s. Passengers whose destination station is d and who are now at s (where 
                           
                              (
                              s
                              ,
                              d
                              )
                              ∈
                              
                                 
                                    S
                                 
                                 
                                    b
                                    <
                                 
                                 
                                    2
                                 
                              
                           
                         in direction 
                           
                              b
                              ∈
                              B
                           
                        ) will take a train of some types to reach d. The train stops at d or it does not stop but they can get off at d if they transfer to a suitable train at an intermediate station. A set of such train types are defined as 
                           
                              
                                 
                                    E
                                 
                                 
                                    s
                                    ,
                                    d
                                 
                              
                              ⊆
                              E
                           
                        . For two train types 
                           
                              
                                 
                                    e
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    e
                                 
                                 
                                    2
                                 
                              
                              ∈
                              E
                           
                         (there is a case with 
                           
                              
                                 
                                    e
                                 
                                 
                                    1
                                 
                              
                              =
                              
                                 
                                    e
                                 
                                 
                                    2
                                 
                              
                           
                        ), we say 
                           
                              
                                 
                                    e
                                 
                                 
                                    1
                                 
                              
                              
                                 
                                    ≿
                                 
                                 
                                    E
                                 
                              
                              
                                 
                                    e
                                 
                                 
                                    2
                                 
                              
                           
                         if 
                           
                              
                                 
                                    e
                                 
                                 
                                    1
                                 
                              
                           
                         has a higher priority than or the same priority as 
                           
                              
                                 
                                    e
                                 
                                 
                                    2
                                 
                              
                           
                        . For instance, 
                           
                              Express
                              
                                 
                                    ≿
                                 
                                 
                                    E
                                 
                              
                              Express
                              ,
                              Express
                              
                                 
                                    ≿
                                 
                                 
                                    E
                                 
                              
                              Local
                           
                         and 
                           
                              Local
                              
                                 
                                    ≿
                                 
                                 
                                    E
                                 
                              
                              Local
                           
                         hold in general. We denote a set of discrete time periods by T.

Next we introduce several constants. Let 
                           
                              
                                 
                                    A
                                 
                                 
                                    r
                                 
                                 
                                    s
                                 
                              
                           
                         and 
                           
                              
                                 
                                    D
                                 
                                 
                                    r
                                 
                                 
                                    s
                                 
                              
                           
                         be arrival and departure times of train 
                           
                              r
                              ∈
                              R
                           
                         at station 
                           
                              s
                              ∈
                              S
                           
                         in a planned timetable. In the timetable, we discuss O–D pair 
                           
                              (
                              o
                              ,
                              d
                              )
                              ∈
                              
                                 
                                    S
                                 
                                 
                                    b
                                    <
                                 
                                 
                                    2
                                 
                              
                           
                         in direction 
                           
                              b
                              ∈
                              B
                           
                         at time 
                           
                              t
                              ∈
                              T
                           
                        , i.e., passengers who appear at station o at time t and travel to station d. We define 
                           
                              
                                 
                                    A
                                 
                                 
                                    t
                                 
                                 
                                    o
                                    ,
                                    d
                                 
                              
                           
                         as the amount of inconvenience which they suffer on their route. Assume here that the train operation is disrupted, and that a feasible rescheduled timetable is given by a certain timetable rescheduling method (e.g., a timetable without applying any countermeasure, a delay-minimized timetable, etc.). We denote arrival and departure times of train r at station s in such a timetable by 
                           
                              
                                 
                                    
                                       
                                          A
                                       
                                       
                                          ^
                                       
                                    
                                 
                                 
                                    r
                                 
                                 
                                    s
                                 
                              
                              ,
                              
                                 
                                    
                                       
                                          D
                                       
                                       
                                          ^
                                       
                                    
                                 
                                 
                                    r
                                 
                                 
                                    s
                                 
                              
                           
                        . A Minimum interval required between train arrivals and departures is described as 
                           
                              
                                 
                                    I
                                 
                                 
                                    ∗
                                 
                                 
                                    ∗
                                    ,
                                    ∗
                                 
                              
                           
                         depending on the corresponding event. Let 
                           
                              
                                 
                                    M
                                 
                                 
                                    H
                                 
                              
                              ,
                              
                                 
                                    M
                                 
                                 
                                    I
                                 
                              
                           
                         be different arbitrary large numbers concerning headway and inconvenience, respectively. We define 
                           
                              
                                 
                                    N
                                 
                                 
                                    b
                                    ,
                                    s
                                 
                              
                           
                         as the maximum number of trains traveling in 
                           
                              b
                              ∈
                              B
                           
                         which are allowed to exist on the line between s and 
                           
                              Next
                              (
                              b
                              ,
                              s
                              )
                           
                        . The number of passengers traveling from station o to station d and appearing at the origin station at time t is denoted by 
                           
                              
                                 
                                    P
                                 
                                 
                                    t
                                 
                                 
                                    o
                                    ,
                                    d
                                 
                              
                           
                        . Whether it can be done in real time or not, passenger O–D data are electrically available in big cities in Japan since there are automatic ticket gates at every station. When a disruption is small and the delay information has not been announced to (potential) passengers, we can assume that the O–D data 
                           
                              
                                 
                                    P
                                 
                                 
                                    t
                                 
                                 
                                    o
                                    ,
                                    d
                                 
                              
                           
                         in the situation are not so different from that on a normal day. When a disruption is large, we have to mix the data of a normal day, the real-time data and a forecast of the future appearance of potential passengers which will be affected by the disruption.

As is explained in Section 3, the parameter 
                           
                              α
                           
                         is the amount of inconvenience of waiting for 1min at a platform and 
                           
                              β
                           
                         is that of one train transfer. We introduce some flexibility in a timetable to be rescheduled and 
                           
                              
                                 
                                    I
                                 
                                 
                                    Flex
                                 
                              
                           
                         indicates the nonnegative parameter for it.

We describe variables and integer linear constraints to express feasible train operation. Let 
                           
                              
                                 
                                    a
                                 
                                 
                                    r
                                 
                                 
                                    s
                                 
                              
                           
                         and 
                           
                              
                                 
                                    d
                                 
                                 
                                    r
                                 
                                 
                                    s
                                 
                              
                           
                         be continuous variables indicating arrival and departure time of train 
                           
                              r
                              ∈
                              R
                           
                         at station 
                           
                              s
                              ∈
                              S
                           
                        , respectively. For the implementation of the countermeasures against a disruption, we give binary variables concerning a train type, a train route, rolling stock circulation at termini, order of trains and a capacity. For each train 
                           
                              r
                              ∈
                              R
                           
                         and type 
                           
                              e
                              ∈
                              E
                           
                        , we define
                           
                              
                                 
                                    
                                       ℓ
                                    
                                    
                                       r
                                       ,
                                       e
                                    
                                 
                                 ≔
                                 
                                    
                                       
                                          
                                             
                                                
                                                   1
                                                
                                                
                                                   if the type of
                                                   r
                                                   is
                                                   e
                                                   ,
                                                
                                             
                                             
                                                
                                                   0
                                                
                                                
                                                   otherwise
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

For each direction 
                           
                              b
                              ∈
                              B
                           
                        , train 
                           
                              r
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    b
                                 
                              
                           
                         in the direction, station 
                           
                              s
                              ∈
                              S
                           
                         and track 
                           
                              k
                              ∈
                              
                                 
                                    K
                                 
                                 
                                    b
                                    ,
                                    s
                                 
                              
                           
                         in the station which the train can pass through or stop at, we set
                           
                              
                                 
                                    
                                       u
                                    
                                    
                                       r
                                    
                                    
                                       k
                                    
                                 
                                 ≔
                                 
                                    
                                       
                                          
                                             
                                                
                                                   1
                                                
                                                
                                                   if
                                                   r
                                                   passes through or stops at
                                                   k
                                                   ,
                                                
                                             
                                             
                                                
                                                   0
                                                
                                                
                                                   otherwise
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

For each train 
                           
                              
                                 
                                    r
                                 
                                 
                                    1
                                 
                              
                              ∈
                              R
                           
                         and its candidate successor train 
                           
                              
                                 
                                    r
                                 
                                 
                                    2
                                 
                              
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    Suc
                                    (
                                    
                                       
                                          r
                                       
                                       
                                          1
                                       
                                    
                                    )
                                 
                              
                           
                        , we let
                           
                              
                                 
                                    
                                       g
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 ≔
                                 
                                    
                                       
                                          
                                             
                                                
                                                   1
                                                
                                                
                                                   if
                                                   
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   
                                                   is a successor of
                                                   
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   ,
                                                
                                             
                                             
                                                
                                                   0
                                                
                                                
                                                   otherwise
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

For each direction 
                           
                              b
                              ∈
                              B
                           
                        , ordered pair of distinct trains 
                           
                              (
                              
                                 
                                    r
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    r
                                 
                                 
                                    2
                                 
                              
                              )
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    b
                                    ≠
                                 
                                 
                                    2
                                 
                              
                           
                         in the direction and station 
                           
                              s
                              ∈
                              S
                              ⧹
                              {
                              Term
                              (
                              b
                              )
                              }
                           
                         other than the terminus, we define
                           
                              
                                 
                                    
                                       x
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                    
                                    
                                       s
                                    
                                 
                                 ≔
                                 
                                    
                                       
                                          
                                             
                                                
                                                   1
                                                
                                                
                                                   if
                                                   
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   
                                                   departs from
                                                   s
                                                   earlier than
                                                   
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   
                                                   does
                                                   ,
                                                
                                             
                                             
                                                
                                                   0
                                                
                                                
                                                   otherwise
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Similarly, for each direction 
                           
                              b
                              ∈
                              B
                           
                        , train 
                           
                              
                                 
                                    r
                                 
                                 
                                    1
                                 
                              
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    b
                                 
                              
                           
                         in the direction, its terminus 
                           
                              Term
                              (
                              b
                              )
                           
                         and train 
                           
                              
                                 
                                    r
                                 
                                 
                                    2
                                 
                              
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    Opp
                                    (
                                    b
                                    )
                                 
                              
                           
                         in the opposite direction,
                           
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                
                                                   x
                                                
                                                
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                                
                                                   Term
                                                   (
                                                   b
                                                   )
                                                
                                             
                                             ≔
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               1
                                                            
                                                            
                                                               if
                                                               
                                                               
                                                                  
                                                                     r
                                                                  
                                                                  
                                                                     1
                                                                  
                                                               
                                                               
                                                               arrives at
                                                               s
                                                               earlier than
                                                               
                                                               
                                                                  
                                                                     r
                                                                  
                                                                  
                                                                     2
                                                                  
                                                               
                                                               
                                                               departs from,
                                                            
                                                         
                                                         
                                                            
                                                               0
                                                            
                                                            
                                                               otherwise
                                                               ,
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                                
                                                   x
                                                
                                                
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                
                                                
                                                   Term
                                                   (
                                                   b
                                                   )
                                                
                                             
                                             ≔
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               1
                                                            
                                                            
                                                               if
                                                               
                                                               
                                                                  
                                                                     r
                                                                  
                                                                  
                                                                     2
                                                                  
                                                               
                                                               
                                                               departs from
                                                               s
                                                               earlier than
                                                               
                                                               
                                                                  
                                                                     r
                                                                  
                                                                  
                                                                     1
                                                                  
                                                               
                                                               
                                                               
                                                               arrives at,
                                                            
                                                         
                                                         
                                                            
                                                               0
                                                            
                                                            
                                                               otherwise
                                                               .
                                                            
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

For each direction 
                           
                              b
                              ∈
                              B
                           
                        , ordered pair of distinct trains 
                           
                              (
                              
                                 
                                    r
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    r
                                 
                                 
                                    2
                                 
                              
                              )
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    b
                                    ≠
                                 
                                 
                                    2
                                 
                              
                           
                         in the direction and station 
                           
                              s
                              ∈
                              S
                              ⧹
                              {
                              Term
                              (
                              b
                              )
                              }
                           
                         other than the terminus, we let
                           
                              
                                 
                                    
                                       n
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                    
                                    
                                       s
                                    
                                 
                                 ≔
                                 
                                    
                                       
                                          
                                             
                                                
                                                   1
                                                
                                                
                                                   if
                                                   
                                                   
                                                      
                                                         N
                                                      
                                                      
                                                         b
                                                         ,
                                                         s
                                                      
                                                   
                                                   -
                                                   1
                                                   
                                                   or more trains depart from
                                                   s
                                                
                                             
                                             
                                                
                                                
                                                   
                                                   after
                                                   
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   
                                                   and before
                                                   
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   
                                                   does
                                                   ,
                                                
                                             
                                             
                                                
                                                   0
                                                
                                                
                                                   otherwise
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

We then give train operation constraints for each single train. One among the train type set members is selected:
                           
                              (1)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          e
                                          ∈
                                          E
                                       
                                    
                                 
                                 
                                    
                                       ℓ
                                    
                                    
                                       r
                                       ,
                                       e
                                    
                                 
                                 =
                                 1
                                 
                                 ∀
                                 r
                                 ∈
                                 R
                                 .
                              
                           
                        
                     

A train passes through or stops at one track in a station:
                           
                              (2)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          k
                                          ∈
                                          
                                             
                                                K
                                             
                                             
                                                b
                                                ,
                                                s
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       u
                                    
                                    
                                       r
                                    
                                    
                                       k
                                    
                                 
                                 =
                                 1
                                 
                                 ∀
                                 b
                                 ∈
                                 B
                                 
                                 ∀
                                 r
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       b
                                    
                                 
                                 
                                 ∀
                                 s
                                 ∈
                                 S
                                 .
                              
                           
                        
                     

Each train may turn back and be operated as another one train. When a train is a candidate successor of several trains, exactly one predecessor is determined. They are expressed by
                           
                              (3)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          
                                             
                                                r
                                             
                                             
                                                2
                                             
                                          
                                       
                                    
                                 
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       Suc
                                    
                                 
                                 (
                                 
                                    
                                       r
                                    
                                    
                                       1
                                    
                                 
                                 )
                                 
                                    
                                       g
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 ⩽
                                 1
                                 
                                 ∀
                                 
                                    
                                       r
                                    
                                    
                                       1
                                    
                                 
                                 ∈
                                 R
                                 ,
                              
                           
                        
                        
                           
                              (4)
                              
                                 
                                    ∑
                                    
                                       
                                          r
                                          
                                             1
                                          
                                       
                                       ∈
                                       {
                                       r
                                       ∈
                                       R
                                       
                                       ∣
                                       
                                       
                                          r
                                          
                                             2
                                          
                                       
                                       ∈
                                       
                                          R
                                          
                                             Suc
                                             (
                                             r
                                             )
                                             }
                                          
                                       
                                    
                                 
                                 
                                    g
                                    
                                       
                                          r
                                          1
                                       
                                       ,
                                       
                                          r
                                          2
                                       
                                    
                                 
                                 =
                                 1
                                 
                                 
                                 ∀
                                 
                                    r
                                    
                                       2
                                    
                                 
                                 ∈
                                 R
                                 
                                 
                                 such that
                                 {
                                 r
                                 ∈
                                 R
                                 
                                 ∣
                                 
                                 
                                    r
                                    
                                       2
                                    
                                 
                                 ∈
                                 
                                    R
                                    
                                       Suc
                                       (
                                       r
                                       )
                                    
                                 
                                 }
                                 ≠
                                 ∅
                                 .
                              
                           
                        
                     

If 
                           
                              
                                 
                                    g
                                 
                                 
                                    
                                       
                                          r
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    
                                       
                                          r
                                       
                                       
                                          2
                                       
                                    
                                 
                              
                              =
                              1
                           
                         holds, i.e., the successor of train 
                           
                              
                                 
                                    r
                                 
                                 
                                    1
                                 
                              
                           
                         is 
                           
                              
                                 
                                    r
                                 
                                 
                                    2
                                 
                              
                           
                        , then they occupy the same track at the terminus (otherwise there is no such restriction):
                           
                              (5)
                              
                                 -
                                 (
                                 1
                                 -
                                 
                                    
                                       g
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 )
                                 ⩽
                                 
                                    
                                       u
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                    
                                    
                                       k
                                    
                                 
                                 -
                                 
                                    
                                       u
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                    
                                    
                                       k
                                    
                                 
                                 ⩽
                                 1
                                 -
                                 
                                    
                                       g
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 
                                 ∀
                                 b
                                 ∈
                                 B
                                 
                                 ∀
                                 
                                    
                                       r
                                    
                                    
                                       1
                                    
                                 
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       b
                                    
                                 
                                 
                                 ∀
                                 
                                    
                                       r
                                    
                                    
                                       2
                                    
                                 
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       Suc
                                       (
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                       )
                                    
                                 
                                 
                                 ∀
                                 k
                                 ∈
                                 
                                    
                                       K
                                    
                                    
                                       b
                                       ,
                                       Term
                                       (
                                       b
                                       )
                                    
                                 
                                 .
                              
                           
                        
                     

The trains do not arrive at or depart from the stations earlier than they do in the planned timetable. Additionally, we impose the constraint that they do not arrive or depart later than specified time either, on account of train punctuality and intractability of large MIP problems in terms of solution space. There is a tradeoff between flexibility in a rescheduled timetable and the punctuality or the solution space. We let the time be the sum of the arrival or departure time in a certain feasible rescheduled timetable and the flexibility parameter 
                           
                              
                                 
                                    I
                                 
                                 
                                    Flex
                                 
                              
                           
                        : 
                           
                              (6)
                              
                                 
                                    
                                       A
                                    
                                    
                                       r
                                    
                                    
                                       s
                                    
                                 
                                 ⩽
                                 
                                    
                                       a
                                    
                                    
                                       r
                                    
                                    
                                       s
                                    
                                 
                                 ⩽
                                 
                                    
                                       
                                          
                                             A
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       r
                                    
                                    
                                       s
                                    
                                 
                                 +
                                 
                                    
                                       I
                                    
                                    
                                       Flex
                                    
                                 
                                 
                                 ∀
                                 b
                                 ∈
                                 B
                                 
                                 ∀
                                 r
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       b
                                    
                                 
                                 
                                 ∀
                                 s
                                 ∈
                                 S
                                 ⧹
                                 {
                                 Start
                                 (
                                 b
                                 )
                                 }
                                 ,
                              
                           
                        
                        
                           
                              (7)
                              
                                 
                                    
                                       D
                                    
                                    
                                       r
                                    
                                    
                                       s
                                    
                                 
                                 ⩽
                                 
                                    
                                       d
                                    
                                    
                                       r
                                    
                                    
                                       s
                                    
                                 
                                 ⩽
                                 
                                    
                                       
                                          
                                             D
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       r
                                    
                                    
                                       s
                                    
                                 
                                 +
                                 
                                    
                                       I
                                    
                                    
                                       Flex
                                    
                                 
                                 
                                 ∀
                                 b
                                 ∈
                                 B
                                 
                                 ∀
                                 r
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       b
                                    
                                 
                                 
                                 ∀
                                 s
                                 ∈
                                 S
                                 ⧹
                                 {
                                 Term
                                 (
                                 b
                                 )
                                 }
                                 .
                              
                           
                        
                     

Minimum running time 
                           
                              
                                 
                                    I
                                 
                                 
                                    e
                                 
                                 
                                    b
                                    ,
                                    s
                                 
                              
                           
                         of train r traveling in direction 
                           
                              b
                              ∈
                              B
                           
                         between two stations (
                           
                              s
                              ,
                              Next
                              (
                              b
                              ,
                              s
                              )
                           
                        ) depends on its train type e. The constraints can be aggregated from the Eq. (1), and is expressed by
                           
                              (8)
                              
                                 
                                    
                                       a
                                    
                                    
                                       r
                                    
                                    
                                       Next
                                       (
                                       b
                                       ,
                                       s
                                       )
                                    
                                 
                                 -
                                 
                                    
                                       d
                                    
                                    
                                       r
                                    
                                    
                                       s
                                    
                                 
                                 ⩾
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          e
                                          ∈
                                          E
                                       
                                    
                                 
                                 
                                    
                                       I
                                    
                                    
                                       e
                                    
                                    
                                       b
                                       ,
                                       s
                                    
                                 
                                 
                                    
                                       ℓ
                                    
                                    
                                       r
                                       ,
                                       e
                                    
                                 
                                 
                                 ∀
                                 b
                                 ∈
                                 B
                                 
                                 ∀
                                 r
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       b
                                    
                                 
                                 
                                 ∀
                                 s
                                 ∈
                                 S
                                 ⧹
                                 {
                                 Term
                                 (
                                 b
                                 )
                                 }
                                 .
                              
                           
                        
                     

Minimum dwell time 
                           
                              
                                 
                                    I
                                 
                                 
                                    s
                                 
                              
                           
                         at station s is required if a train stops there. If it passes, then the arrival and departure times are equivalent. According to the techniques shown by Williams (2013), we linearize the constraints by introducing the large constant 
                           
                              
                                 
                                    M
                                 
                                 
                                    H
                                 
                              
                           
                        : 
                           
                              (9)
                              
                                 
                                    
                                       
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   e
                                                   ∈
                                                   
                                                      
                                                         E
                                                      
                                                      
                                                         s
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                ℓ
                                             
                                             
                                                r
                                                ,
                                                e
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       I
                                    
                                    
                                       s
                                    
                                 
                                 ⩽
                                 
                                    
                                       d
                                    
                                    
                                       r
                                    
                                    
                                       s
                                    
                                 
                                 -
                                 
                                    
                                       a
                                    
                                    
                                       r
                                    
                                    
                                       s
                                    
                                 
                                 ⩽
                                 
                                    
                                       M
                                    
                                    
                                       H
                                    
                                 
                                 
                                    
                                       
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   e
                                                   ∈
                                                   
                                                      
                                                         E
                                                      
                                                      
                                                         s
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                ℓ
                                             
                                             
                                                r
                                                ,
                                                e
                                             
                                          
                                       
                                    
                                 
                                 
                                 ∀
                                 r
                                 ∈
                                 R
                                 
                                 ∀
                                 s
                                 ∈
                                 S
                                 .
                              
                           
                        
                     

Turn back time 
                           
                              
                                 
                                    I
                                 
                                 
                                    Suc
                                 
                                 
                                    Term
                                    (
                                    b
                                    )
                                 
                              
                           
                         from 
                           
                              
                                 
                                    r
                                 
                                 
                                    1
                                 
                              
                           
                         to 
                           
                              
                                 
                                    r
                                 
                                 
                                    2
                                 
                              
                           
                         at terminus 
                           
                              Term
                              (
                              b
                              )
                           
                         is given by
                           
                              (10)
                              
                                 
                                    
                                       d
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                    
                                    
                                       Term
                                       (
                                       b
                                       )
                                    
                                 
                                 -
                                 
                                    
                                       a
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                    
                                    
                                       Term
                                       (
                                       b
                                       )
                                    
                                 
                                 ⩾
                                 
                                    
                                       I
                                    
                                    
                                       Suc
                                    
                                    
                                       Term
                                       (
                                       b
                                       )
                                    
                                 
                                 -
                                 
                                    
                                       M
                                    
                                    
                                       H
                                    
                                 
                                 (
                                 1
                                 -
                                 
                                    
                                       g
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 )
                                 
                                 ∀
                                 b
                                 ∈
                                 B
                                 
                                 ∀
                                 
                                    
                                       r
                                    
                                    
                                       1
                                    
                                 
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       b
                                    
                                 
                                 
                                 ∀
                                 
                                    
                                       r
                                    
                                    
                                       2
                                    
                                 
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       Suc
                                       (
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                       )
                                    
                                 
                                 .
                              
                           
                        
                     

We let arrival and departure times of a train at its terminus be equivalent to those of its successor train:
                           
                              (11)
                              
                                 -
                                 
                                    
                                       M
                                    
                                    
                                       H
                                    
                                 
                                 (
                                 1
                                 -
                                 
                                    
                                       g
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 )
                                 ⩽
                                 
                                    
                                       a
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                    
                                    
                                       Term
                                       (
                                       b
                                       )
                                    
                                 
                                 -
                                 
                                    
                                       a
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                    
                                    
                                       Term
                                       (
                                       b
                                       )
                                    
                                 
                                 ⩽
                                 
                                    
                                       M
                                    
                                    
                                       H
                                    
                                 
                                 (
                                 1
                                 -
                                 
                                    
                                       g
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 )
                                 
                                 ∀
                                 b
                                 ∈
                                 B
                                 
                                 ∀
                                 
                                    
                                       r
                                    
                                    
                                       1
                                    
                                 
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       b
                                    
                                 
                                 
                                 ∀
                                 
                                    
                                       r
                                    
                                    
                                       2
                                    
                                 
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       Suc
                                       (
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                       )
                                    
                                 
                                 ,
                              
                           
                        
                        
                           
                              (12)
                              
                                 -
                                 
                                    
                                       M
                                    
                                    
                                       H
                                    
                                 
                                 (
                                 1
                                 -
                                 
                                    
                                       g
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 )
                                 ⩽
                                 
                                    
                                       d
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                    
                                    
                                       Term
                                       (
                                       b
                                       )
                                    
                                 
                                 -
                                 
                                    
                                       d
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                    
                                    
                                       Term
                                       (
                                       b
                                       )
                                    
                                 
                                 ⩽
                                 
                                    
                                       M
                                    
                                    
                                       H
                                    
                                 
                                 (
                                 1
                                 -
                                 
                                    
                                       g
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 )
                                 
                                 ∀
                                 b
                                 ∈
                                 B
                                 
                                 ∀
                                 
                                    
                                       r
                                    
                                    
                                       1
                                    
                                 
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       b
                                    
                                 
                                 
                                 ∀
                                 
                                    
                                       r
                                    
                                    
                                       2
                                    
                                 
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       Suc
                                       (
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                       )
                                    
                                 
                                 .
                              
                           
                        
                     

We present operation constraints between two trains. Exactly one of two trains 
                           
                              
                                 
                                    r
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    r
                                 
                                 
                                    2
                                 
                              
                           
                         in direction b departs earlier at the stations other than terminus 
                           
                              Term
                              (
                              b
                              )
                           
                        . At the terminus, a train arrives earlier than another train departs or vice versa:
                           
                              (13)
                              
                                 
                                    
                                       x
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                    
                                    
                                       s
                                    
                                 
                                 +
                                 
                                    
                                       x
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                    
                                    
                                       s
                                    
                                 
                                 =
                                 1
                                 
                                 ∀
                                 b
                                 ∈
                                 B
                                 
                                 ∀
                                 (
                                 
                                    
                                       r
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       r
                                    
                                    
                                       2
                                    
                                 
                                 )
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       b
                                       ≠
                                    
                                    
                                       2
                                    
                                 
                                 
                                 ∀
                                 s
                                 ∈
                                 S
                                 ⧹
                                 {
                                 Term
                                 (
                                 b
                                 )
                                 }
                                 ,
                              
                           
                        
                        
                           
                              (14)
                              
                                 
                                    
                                       x
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                    
                                    
                                       Term
                                       (
                                       b
                                       )
                                    
                                 
                                 +
                                 
                                    
                                       x
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                    
                                    
                                       Term
                                       (
                                       b
                                       )
                                    
                                 
                                 =
                                 1
                                 
                                 ∀
                                 b
                                 ∈
                                 B
                                 
                                 ∀
                                 
                                    
                                       r
                                    
                                    
                                       1
                                    
                                 
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       b
                                    
                                 
                                 
                                 ∀
                                 
                                    
                                       r
                                    
                                    
                                       2
                                    
                                 
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       Opp
                                       (
                                       b
                                       )
                                    
                                 
                                 .
                              
                           
                        
                     

Assume here that the priority of type 
                           
                              
                                 
                                    e
                                 
                                 
                                    1
                                 
                              
                           
                         of 
                           
                              
                                 
                                    r
                                 
                                 
                                    1
                                 
                              
                           
                         is higher than or the same as that of 
                           
                              
                                 
                                    e
                                 
                                 
                                    2
                                 
                              
                           
                         of 
                           
                              
                                 
                                    r
                                 
                                 
                                    2
                                 
                              
                           
                        . If 
                           
                              
                                 
                                    r
                                 
                                 
                                    1
                                 
                              
                           
                         departs earlier than 
                           
                              
                                 
                                    r
                                 
                                 
                                    2
                                 
                              
                           
                         from station s, then their departing order is maintained at the next stations:
                           
                              (15)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                
                                                   x
                                                
                                                
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                                
                                                   Next
                                                   (
                                                   b
                                                   ,
                                                   s
                                                   )
                                                
                                             
                                             ⩾
                                             
                                                
                                                   x
                                                
                                                
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                                
                                                   s
                                                
                                             
                                             -
                                             (
                                             2
                                             -
                                             
                                                
                                                   ℓ
                                                
                                                
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         e
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                
                                             
                                             -
                                             
                                                
                                                   ℓ
                                                
                                                
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         e
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                             )
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             ∀
                                             b
                                             ∈
                                             B
                                             
                                             ∀
                                             (
                                             
                                                
                                                   r
                                                
                                                
                                                   1
                                                
                                             
                                             ,
                                             
                                                
                                                   r
                                                
                                                
                                                   2
                                                
                                             
                                             )
                                             ∈
                                             
                                                
                                                   R
                                                
                                                
                                                   b
                                                   ≠
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             ∀
                                             s
                                             ∈
                                             S
                                             ⧹
                                             {
                                             Term
                                             (
                                             b
                                             )
                                             }
                                             
                                             such that
                                             
                                             Next
                                             (
                                             b
                                             ,
                                             s
                                             )
                                             ≠
                                             Term
                                             (
                                             b
                                             )
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             ∀
                                             (
                                             
                                                
                                                   e
                                                
                                                
                                                   1
                                                
                                             
                                             ,
                                             
                                                
                                                   e
                                                
                                                
                                                   2
                                                
                                             
                                             )
                                             ∈
                                             
                                                
                                                   E
                                                
                                                
                                                   2
                                                
                                             
                                             
                                             such that
                                             
                                             
                                                
                                                   e
                                                
                                                
                                                   1
                                                
                                             
                                             
                                                
                                                   ≿
                                                
                                                
                                                   E
                                                
                                             
                                             
                                                
                                                   e
                                                
                                                
                                                   2
                                                
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        
                     

If 
                           
                              
                                 
                                    r
                                 
                                 
                                    2
                                 
                              
                           
                         is a successor of 
                           
                              
                                 
                                    r
                                 
                                 
                                    1
                                 
                              
                           
                        , then 
                           
                              
                                 
                                    r
                                 
                                 
                                    1
                                 
                              
                           
                         arrives earlier than 
                           
                              
                                 
                                    r
                                 
                                 
                                    2
                                 
                              
                           
                         departs:
                           
                              (16)
                              
                                 
                                    
                                       g
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 ⩽
                                 
                                    
                                       x
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                    
                                    
                                       Term
                                       (
                                       b
                                       )
                                    
                                 
                                 
                                 ∀
                                 b
                                 ∈
                                 B
                                 
                                 ∀
                                 
                                    
                                       r
                                    
                                    
                                       1
                                    
                                 
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       b
                                    
                                 
                                 
                                 ∀
                                 
                                    
                                       r
                                    
                                    
                                       2
                                    
                                 
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       Suc
                                       (
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                       )
                                    
                                 
                                 .
                              
                           
                        
                     

For any two departures of trains 
                           
                              
                                 
                                    r
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    r
                                 
                                 
                                    2
                                 
                              
                           
                         in direction b from station s, the number of trains which succeed 
                           
                              
                                 
                                    r
                                 
                                 
                                    2
                                 
                              
                           
                         subtracting from the number of trains which succeed 
                           
                              
                                 
                                    r
                                 
                                 
                                    1
                                 
                              
                           
                         is equal to one added to the number of other trains which depart after 
                           
                              
                                 
                                    r
                                 
                                 
                                    1
                                 
                              
                           
                         and before 
                           
                              
                                 
                                    r
                                 
                                 
                                    2
                                 
                              
                           
                         does. If it is 
                           
                              
                                 
                                    N
                                 
                                 
                                    b
                                    ,
                                    s
                                 
                              
                           
                         or more, then we make the corresponding binary variable 
                           
                              
                                 
                                    n
                                 
                                 
                                    
                                       
                                          r
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    
                                       
                                          r
                                       
                                       
                                          2
                                       
                                    
                                 
                                 
                                    s
                                 
                              
                           
                         one by the following inequality. When 
                           
                              
                                 
                                    n
                                 
                                 
                                    
                                       
                                          r
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    
                                       
                                          r
                                       
                                       
                                          2
                                       
                                    
                                 
                                 
                                    s
                                 
                              
                              =
                              1
                           
                        , the number of trains which exist on the line between 
                           
                              (
                              s
                              ,
                              Next
                              (
                              b
                              ,
                              s
                              )
                              )
                           
                         at the same time is restricted and 
                           
                              
                                 
                                    r
                                 
                                 
                                    2
                                 
                              
                           
                         can enter the line after the front train 
                           
                              
                                 
                                    r
                                 
                                 
                                    1
                                 
                              
                           
                         leaves there by constraint (24) introduced later. Without the following constraint and the constraint (24), all the trains can be present on the same line simultaneously:
                           
                              (17)
                              
                                 
                                    
                                       n
                                    
                                    
                                       
                                          
                                             r
                                             
                                                1
                                             
                                          
                                          ,
                                          
                                             r
                                             
                                                2
                                             
                                          
                                       
                                    
                                    
                                       s
                                    
                                 
                                 ⩾
                                 
                                    
                                       
                                          ∑
                                          
                                             r
                                             ∈
                                             
                                                R
                                                
                                                   b
                                                
                                             
                                             ⧹
                                             {
                                             
                                                r
                                                1
                                             
                                             }
                                          
                                       
                                       
                                          
                                             x
                                          
                                          
                                             
                                                
                                                   r
                                                   1
                                                
                                                ,
                                                r
                                             
                                          
                                          
                                             s
                                          
                                       
                                       -
                                       
                                          ∑
                                          
                                             r
                                             ∈
                                             
                                                R
                                                b
                                             
                                             ⧹
                                             {
                                             
                                                r
                                                2
                                             
                                             }
                                          
                                       
                                       
                                          
                                             x
                                          
                                          
                                             
                                                r
                                                2
                                             
                                             ,
                                             r
                                          
                                          
                                             s
                                          
                                       
                                       -
                                       
                                          N
                                          
                                             b
                                             ,
                                             s
                                          
                                       
                                       +
                                       1
                                    
                                 
                                 /
                                 (
                                 ∣
                                 
                                    R
                                    
                                       b
                                    
                                 
                                 ∣
                                 -
                                 1
                                 )
                                 
                                 
                                 ∀
                                 b
                                 ∈
                                 B
                                 
                                 ∀
                                 (
                                 
                                    r
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    r
                                    
                                       2
                                    
                                 
                                 )
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       b
                                       ≠
                                    
                                    
                                       2
                                    
                                 
                                 
                                 ∀
                                 s
                                 ∈
                                 S
                                 ⧹
                                 {
                                 Term
                                 (
                                 b
                                 )
                                 }
                                 .
                              
                           
                        
                     

Minimum headway between arrivals of trains (
                           
                              
                                 
                                    I
                                 
                                 
                                    AA
                                 
                                 
                                    Next
                                    (
                                    b
                                    ,
                                    s
                                    )
                                 
                              
                           
                        ) and departures of them (
                           
                              
                                 
                                    I
                                 
                                 
                                    DD
                                 
                                 
                                    s
                                 
                              
                           
                        ) are expressed by:
                           
                              (18)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                
                                                   a
                                                
                                                
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                                
                                                   Next
                                                   (
                                                   b
                                                   ,
                                                   s
                                                   )
                                                
                                             
                                             -
                                             
                                                
                                                   a
                                                
                                                
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                
                                                
                                                   Next
                                                   (
                                                   b
                                                   ,
                                                   s
                                                   )
                                                
                                             
                                             ⩾
                                             
                                                
                                                   I
                                                
                                                
                                                   AA
                                                
                                                
                                                   Next
                                                   (
                                                   b
                                                   ,
                                                   s
                                                   )
                                                
                                             
                                             -
                                             
                                                
                                                   M
                                                
                                                
                                                   H
                                                
                                             
                                             (
                                             1
                                             -
                                             
                                                
                                                   x
                                                
                                                
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                                
                                                   s
                                                
                                             
                                             )
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                             
                                             ∀
                                             b
                                             ∈
                                             B
                                             
                                             ∀
                                             (
                                             
                                                
                                                   r
                                                
                                                
                                                   1
                                                
                                             
                                             ,
                                             
                                                
                                                   r
                                                
                                                
                                                   2
                                                
                                             
                                             )
                                             ∈
                                             
                                                
                                                   R
                                                
                                                
                                                   b
                                                   ≠
                                                
                                                
                                                   2
                                                
                                             
                                             
                                             ∀
                                             s
                                             ∈
                                             S
                                             ⧹
                                             {
                                             Term
                                             (
                                             b
                                             )
                                             }
                                             ,
                                          
                                       
                                    
                                 
                              
                           
                        
                        
                           
                              (19)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                
                                                   d
                                                
                                                
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                                
                                                   s
                                                
                                             
                                             -
                                             
                                                
                                                   d
                                                
                                                
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                
                                                
                                                   s
                                                
                                             
                                             ⩾
                                             
                                                
                                                   I
                                                
                                                
                                                   DD
                                                
                                                
                                                   s
                                                
                                             
                                             -
                                             
                                                
                                                   M
                                                
                                                
                                                   H
                                                
                                             
                                             (
                                             1
                                             -
                                             
                                                
                                                   x
                                                
                                                
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                                
                                                   s
                                                
                                             
                                             )
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                             
                                             ∀
                                             b
                                             ∈
                                             B
                                             
                                             ∀
                                             (
                                             
                                                
                                                   r
                                                
                                                
                                                   1
                                                
                                             
                                             ,
                                             
                                                
                                                   r
                                                
                                                
                                                   2
                                                
                                             
                                             )
                                             ∈
                                             
                                                
                                                   R
                                                
                                                
                                                   b
                                                   ≠
                                                
                                                
                                                   2
                                                
                                             
                                             
                                             ∀
                                             s
                                             ∈
                                             S
                                             ⧹
                                             {
                                             Term
                                             (
                                             b
                                             )
                                             }
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        
                     

If arriving and departing trains try to occupy the same track at station 
                           
                              
                                 
                                    s
                                 
                                 
                                    ¯
                                 
                              
                           
                        , then minimum headway 
                           
                              
                                 
                                    I
                                 
                                 
                                    AD
                                 
                                 
                                    
                                       
                                          s
                                       
                                       
                                          ¯
                                       
                                    
                                 
                              
                           
                         is required. Two forms of constraints are necessary corresponding to the cases where 
                           
                              
                                 
                                    s
                                 
                                 
                                    ¯
                                 
                              
                           
                         is a starting station or not:
                           
                              (20)
                              
                                 
                                    
                                       a
                                    
                                    
                                       
                                          r
                                          
                                             2
                                          
                                       
                                    
                                    
                                       Start
                                       (
                                       b
                                       )
                                    
                                 
                                 -
                                 
                                    
                                       d
                                    
                                    
                                       
                                          r
                                          
                                             1
                                          
                                       
                                    
                                    
                                       Start
                                       (
                                       b
                                       )
                                    
                                 
                                 ⩾
                                 
                                    
                                       I
                                    
                                    
                                       AD
                                    
                                    
                                       Start
                                       (
                                       b
                                       )
                                    
                                 
                                 -
                                 
                                    M
                                    
                                       H
                                    
                                 
                                 (
                                 3
                                 -
                                 
                                    
                                       x
                                    
                                    
                                       
                                          r
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          r
                                          
                                             2
                                          
                                       
                                    
                                    
                                       Start
                                       (
                                       b
                                       )
                                    
                                 
                                 -
                                 
                                    
                                       u
                                    
                                    
                                       
                                          r
                                          
                                             1
                                          
                                       
                                    
                                    
                                       k
                                    
                                 
                                 -
                                 
                                    
                                       u
                                    
                                    
                                       
                                          r
                                          
                                             2
                                          
                                       
                                    
                                    
                                       k
                                    
                                 
                                 )
                                 
                                 
                                 
                                 
                                 
                                 ∀
                                 b
                                 ∈
                                 B
                                 
                                 ∀
                                 (
                                 
                                    r
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    r
                                    
                                       2
                                    
                                 
                                 )
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       b
                                       ≠
                                    
                                    
                                       2
                                    
                                 
                                 
                                 ∀
                                 k
                                 ∈
                                 
                                    
                                       K
                                    
                                    
                                       b
                                       ,
                                       Start
                                       (
                                       b
                                       )
                                    
                                 
                                 ,
                              
                           
                        
                        
                           
                              (21)
                              
                                 
                                    
                                       a
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                    
                                    
                                       Next
                                       (
                                       b
                                       ,
                                       s
                                       )
                                    
                                 
                                 -
                                 
                                    
                                       d
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                    
                                    
                                       Next
                                       (
                                       b
                                       ,
                                       s
                                       )
                                    
                                 
                                 ⩾
                                 
                                    
                                       I
                                    
                                    
                                       AD
                                    
                                    
                                       Next
                                       (
                                       b
                                       ,
                                       s
                                       )
                                    
                                 
                                 -
                                 
                                    
                                       M
                                    
                                    
                                       H
                                    
                                 
                                 (
                                 3
                                 -
                                 
                                    
                                       x
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                    
                                    
                                       s
                                    
                                 
                                 -
                                 
                                    
                                       u
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                    
                                    
                                       k
                                    
                                 
                                 -
                                 
                                    
                                       u
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                    
                                    
                                       k
                                    
                                 
                                 )
                                 ∀
                                 b
                                 ∈
                                 B
                                 
                                 ∀
                                 (
                                 
                                    
                                       r
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       r
                                    
                                    
                                       2
                                    
                                 
                                 )
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       b
                                       ≠
                                    
                                    
                                       2
                                    
                                 
                                 
                                 ∀
                                 s
                                 ∈
                                 S
                                 ⧹
                                 {
                                 Term
                                 (
                                 b
                                 )
                                 }
                                 
                                 ∀
                                 k
                                 ∈
                                 
                                    
                                       K
                                    
                                    
                                       b
                                       ,
                                       Next
                                       (
                                       b
                                       ,
                                       s
                                       )
                                    
                                 
                                 .
                              
                           
                        
                     

At the crossing near terminus Term(
                        b
                        ), minimum headway 
                           
                              
                                 
                                    I
                                 
                                 
                                    AD
                                 
                                 
                                    Term
                                    (
                                    b
                                    )
                                 
                              
                           
                         or 
                           
                              
                                 
                                    I
                                 
                                 
                                    DA
                                 
                                 
                                    Term
                                    (
                                    b
                                    )
                                 
                              
                           
                         between two trains traveling in different directions is required:
                           
                              (22)
                              
                                 
                                    
                                       a
                                    
                                    
                                       
                                          r
                                          1
                                       
                                    
                                    
                                       Term
                                       (
                                       b
                                       )
                                    
                                 
                                 -
                                 
                                    
                                       d
                                    
                                    
                                       
                                          r
                                          2
                                       
                                    
                                    
                                       Term
                                       (
                                       b
                                       )
                                    
                                 
                                 ⩾
                                 
                                    
                                       I
                                    
                                    
                                       AD
                                    
                                    
                                       Term
                                       (
                                       b
                                       )
                                    
                                 
                                 -
                                 
                                    M
                                    
                                       H
                                    
                                 
                                 (
                                 1
                                 -
                                 
                                    
                                       x
                                    
                                    
                                       
                                          
                                             r
                                             2
                                          
                                          ,
                                          
                                             r
                                             1
                                          
                                       
                                    
                                    
                                       Term
                                       (
                                       b
                                       )
                                    
                                 
                                 )
                                 
                                 
                                 
                                 
                                 
                                 ∀
                                 b
                                 ∈
                                 B
                                 
                                 ∀
                                 
                                    r
                                    1
                                 
                                 ∈
                                 
                                    R
                                    b
                                 
                                 
                                 ∀
                                 
                                    r
                                    2
                                 
                                 ∈
                                 
                                    R
                                    
                                       Opp
                                       (
                                       b
                                       )
                                    
                                 
                                 ,
                              
                           
                        
                        
                           
                              (23)
                              
                                 
                                    
                                       d
                                    
                                    
                                       
                                          r
                                          2
                                       
                                    
                                    
                                       Term
                                       (
                                       b
                                       )
                                    
                                 
                                 -
                                 
                                    
                                       a
                                    
                                    
                                       
                                          r
                                          1
                                       
                                    
                                    
                                       Term
                                       (
                                       b
                                       )
                                    
                                 
                                 ⩾
                                 
                                    
                                       I
                                    
                                    
                                       DA
                                    
                                    
                                       Term
                                       (
                                       b
                                       )
                                    
                                 
                                 -
                                 
                                    M
                                    
                                       H
                                    
                                 
                                 (
                                 1
                                 -
                                 
                                    
                                       x
                                    
                                    
                                       
                                          
                                             r
                                             1
                                          
                                          ,
                                          
                                             r
                                             2
                                          
                                       
                                    
                                    
                                       Term
                                       (
                                       b
                                       )
                                    
                                 
                                 )
                                 
                                 
                                 
                                 
                                 
                                 ∀
                                 b
                                 ∈
                                 B
                                 
                                 ∀
                                 
                                    r
                                    1
                                 
                                 ∈
                                 
                                    R
                                    b
                                 
                                 
                                 ∀
                                 
                                    r
                                    2
                                 
                                 ∈
                                 
                                    R
                                    
                                       Opp
                                       (
                                       b
                                       )
                                    
                                 
                                 .
                              
                           
                        
                     

If there are 
                           
                              
                                 
                                    N
                                 
                                 
                                    b
                                    ,
                                    s
                                 
                              
                           
                         trains on the line between 
                           
                              (
                              s
                              ,
                              Next
                              (
                              b
                              ,
                              s
                              )
                              )
                           
                         whose front is 
                           
                              
                                 
                                    r
                                 
                                 
                                    1
                                 
                              
                           
                        , then 
                           
                              
                                 
                                    r
                                 
                                 
                                    2
                                 
                              
                           
                         can leave s after 
                           
                              
                                 
                                    r
                                 
                                 
                                    1
                                 
                              
                           
                         arrives at 
                           
                              Next
                              (
                              b
                              ,
                              s
                              )
                           
                         and minimum headway 
                           
                              
                                 
                                    I
                                 
                                 
                                    DA
                                 
                                 
                                    b
                                    ,
                                    s
                                 
                              
                           
                         elapses:
                           
                              (24)
                              
                                 
                                    
                                       d
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                    
                                    
                                       s
                                    
                                 
                                 -
                                 
                                    
                                       a
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                    
                                    
                                       Next
                                       (
                                       b
                                       ,
                                       s
                                       )
                                    
                                 
                                 ⩾
                                 
                                    
                                       I
                                    
                                    
                                       DA
                                    
                                    
                                       b
                                       ,
                                       s
                                    
                                 
                                 -
                                 
                                    
                                       M
                                    
                                    
                                       H
                                    
                                 
                                 (
                                 1
                                 -
                                 
                                    
                                       n
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                    
                                    
                                       s
                                    
                                 
                                 )
                                 ∀
                                 b
                                 ∈
                                 B
                                 
                                 ∀
                                 (
                                 
                                    
                                       r
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       r
                                    
                                    
                                       2
                                    
                                 
                                 )
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       b
                                       ≠
                                    
                                    
                                       2
                                    
                                 
                                 
                                 ∀
                                 s
                                 ∈
                                 S
                                 ⧹
                                 {
                                 Term
                                 (
                                 b
                                 )
                                 }
                                 .
                              
                           
                        
                     

We introduce two kinds of 0-1 variables to express passenger’s behavior, and two continuous variable concerning inconvenience to them. For each direction 
                           
                              b
                              ∈
                              B
                           
                        , O–D pair of stations 
                           
                              (
                              o
                              ,
                              d
                              )
                              ∈
                              
                                 
                                    S
                                 
                                 
                                    b
                                    <
                                 
                                 
                                    2
                                 
                              
                           
                        , time 
                           
                              t
                              ∈
                              T
                           
                         and train 
                           
                              r
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    b
                                 
                              
                           
                        , we define
                           
                              
                                 
                                    
                                       z
                                    
                                    
                                       t
                                       ,
                                       r
                                    
                                    
                                       o
                                       ,
                                       d
                                    
                                 
                                 ≔
                                 
                                    
                                       
                                          
                                             
                                                
                                                   1
                                                
                                                
                                                   if passengers from
                                                   o
                                                   to
                                                   d
                                                   appearing at
                                                   t
                                                   take
                                                   r
                                                   ,
                                                
                                             
                                             
                                                
                                                   0
                                                
                                                
                                                   otherwise
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Similarly, for each direction 
                           
                              b
                              ∈
                              B
                           
                        , destination 
                           
                              d
                              ∈
                              S
                           
                        , intermediate station 
                           
                              s
                              ∈
                              
                                 
                                    S
                                 
                                 
                                    Tra
                                    (
                                    b
                                    ,
                                    d
                                    )
                                 
                              
                           
                         and pair of trains 
                           
                              (
                              
                                 
                                    r
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    r
                                 
                                 
                                    2
                                 
                              
                              )
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    b
                                 
                                 
                                    2
                                 
                              
                           
                         in the direction,
                           
                              
                                 
                                    
                                       z
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                    
                                    
                                       s
                                       ,
                                       d
                                    
                                 
                                 ≔
                                 
                                    
                                       
                                          
                                             
                                                
                                                   1
                                                
                                                
                                                   if passengers to
                                                   d
                                                   transfer from
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   to
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   at
                                                   s
                                                   ,
                                                
                                             
                                             
                                                
                                                   0
                                                
                                                
                                                   otherwise
                                                   .
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        
                     

Note that there is a case with 
                           
                              
                                 
                                    r
                                 
                                 
                                    1
                                 
                              
                              =
                              
                                 
                                    r
                                 
                                 
                                    2
                                 
                              
                           
                        , i.e., they do not transfer. For each direction 
                           
                              b
                              ∈
                              B
                           
                        , O–D pair of stations 
                           
                              (
                              s
                              ,
                              d
                              )
                              ∈
                              
                                 
                                    S
                                 
                                 
                                    b
                                    <
                                 
                                 
                                    2
                                 
                              
                           
                         and train 
                           
                              r
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    b
                                 
                              
                           
                        , let 
                           
                              
                                 
                                    τ
                                 
                                 
                                    r
                                 
                                 
                                    s
                                    ,
                                    d
                                 
                              
                           
                         be the amount of inconvenience to the passengers who take r at station s to go to their destination d without waiting for the train at the platform. We also introduce a variable indicating the increased amount of inconvenience which the passengers suffer in an optimal rescheduled timetable, i.e., the positive difference between the amount of inconvenience in the rescheduled timetable and that in the planned timetable. Note that we regard the value as zero if the former is smaller than the latter. For each direction 
                           
                              b
                              ∈
                              B
                           
                        , O–D pair 
                           
                              (
                              o
                              ,
                              d
                              )
                              ∈
                              
                                 
                                    S
                                 
                                 
                                    b
                                    <
                                 
                                 
                                    2
                                 
                              
                           
                        , time 
                           
                              t
                              ∈
                              T
                           
                         and train 
                           
                              r
                              ∈
                              
                                 
                                    R
                                 
                                 
                                    b
                                 
                              
                           
                        , we denote by 
                           
                              
                                 
                                    y
                                 
                                 
                                    t
                                    ,
                                    r
                                 
                                 
                                    o
                                    ,
                                    d
                                 
                              
                           
                         the increased amount of inconvenience to passengers who appear at station o and at time t, go to their destination d and take train r at o.

We then describe passenger behavior constraints at his/her origin station. Firstly, only one train is selected:
                           
                              (25)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          r
                                          ∈
                                          
                                             
                                                R
                                             
                                             
                                                b
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       z
                                    
                                    
                                       t
                                       ,
                                       r
                                    
                                    
                                       o
                                       ,
                                       d
                                    
                                 
                                 =
                                 1
                                 
                                 ∀
                                 b
                                 ∈
                                 B
                                 
                                 ∀
                                 (
                                 o
                                 ,
                                 d
                                 )
                                 ∈
                                 
                                    
                                       S
                                    
                                    
                                       b
                                       <
                                    
                                    
                                       2
                                    
                                 
                                 
                                 ∀
                                 t
                                 ∈
                                 T
                                 .
                              
                           
                        
                     

The following inequality indicates 
                           
                              
                                 
                                    d
                                 
                                 
                                    r
                                 
                                 
                                    o
                                 
                              
                              <
                              t
                              ⇒
                              
                                 
                                    z
                                 
                                 
                                    t
                                    ,
                                    r
                                 
                                 
                                    o
                                    ,
                                    d
                                 
                              
                              =
                              0
                           
                        , i.e., the passengers cannot get on any train which departs from the origin station before they appear there:
                           
                              (26)
                              
                                 
                                    
                                       z
                                    
                                    
                                       t
                                       ,
                                       r
                                    
                                    
                                       o
                                       ,
                                       d
                                    
                                 
                                 ⩽
                                 
                                    
                                       d
                                    
                                    
                                       r
                                    
                                    
                                       o
                                    
                                 
                                 /
                                 t
                                 
                                 ∀
                                 b
                                 ∈
                                 B
                                 
                                 ∀
                                 (
                                 o
                                 ,
                                 d
                                 )
                                 ∈
                                 
                                    
                                       S
                                    
                                    
                                       b
                                       <
                                    
                                    
                                       2
                                    
                                 
                                 
                                 ∀
                                 t
                                 ∈
                                 T
                                 
                                 ∀
                                 r
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       b
                                    
                                 
                                 .
                              
                           
                        ¶If a train passes through their origin station, or they cannot get off at their destination station by taking the train and even transferring to any other train at an intermediate station, then the value 
                           
                              
                                 
                                    z
                                 
                                 
                                    t
                                    ,
                                    r
                                 
                                 
                                    o
                                    ,
                                    d
                                 
                              
                           
                         must be zero:
                           
                              (27)
                              
                                 
                                    
                                       z
                                    
                                    
                                       t
                                       ,
                                       r
                                    
                                    
                                       o
                                       ,
                                       d
                                    
                                 
                                 ⩽
                                 1
                                 -
                                 
                                    
                                       ℓ
                                    
                                    
                                       r
                                       ,
                                       e
                                    
                                 
                                 
                                 ∀
                                 b
                                 ∈
                                 B
                                 
                                 ∀
                                 (
                                 o
                                 ,
                                 d
                                 )
                                 ∈
                                 
                                    
                                       S
                                    
                                    
                                       b
                                       <
                                    
                                    
                                       2
                                    
                                 
                                 
                                 ∀
                                 t
                                 ∈
                                 T
                                 
                                 ∀
                                 r
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       b
                                    
                                 
                                 
                                 ∀
                                 e
                                 ∈
                                 E
                                 ⧹
                                 
                                    
                                       E
                                    
                                    
                                       o
                                       ,
                                       d
                                    
                                 
                                 .
                              
                           
                        
                     

At the intermediate stations, there are transfer constraints which are similar to (25)–(27)), where 
                           
                              
                                 
                                    I
                                 
                                 
                                    Tra
                                 
                              
                           
                         is time required for the passengers to transfer:
                           
                              (28)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          
                                             
                                                r
                                             
                                             
                                                2
                                             
                                          
                                          ∈
                                          
                                             
                                                R
                                             
                                             
                                                b
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       z
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                    
                                    
                                       s
                                       ,
                                       d
                                    
                                 
                                 =
                                 1
                                 
                                 ∀
                                 b
                                 ∈
                                 B
                                 
                                 ∀
                                 d
                                 ∈
                                 S
                                 
                                 ∀
                                 s
                                 ∈
                                 
                                    
                                       S
                                    
                                    
                                       Tra
                                       (
                                       b
                                       ,
                                       d
                                       )
                                    
                                 
                                 
                                 ∀
                                 
                                    
                                       r
                                    
                                    
                                       1
                                    
                                 
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       b
                                    
                                 
                                 ,
                              
                           
                        
                        
                           
                              (29)
                              
                                 
                                    
                                       d
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                    
                                    
                                       s
                                    
                                 
                                 -
                                 
                                    
                                       a
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                    
                                    
                                       s
                                    
                                 
                                 ⩾
                                 
                                    
                                       I
                                    
                                    
                                       Tra
                                    
                                 
                                 -
                                 
                                    
                                       M
                                    
                                    
                                       H
                                    
                                 
                                 (
                                 1
                                 -
                                 
                                    
                                       z
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                    
                                    
                                       s
                                       ,
                                       d
                                    
                                 
                                 )
                                 
                                 ∀
                                 b
                                 ∈
                                 B
                                 
                                 ∀
                                 d
                                 ∈
                                 S
                                 
                                 ∀
                                 s
                                 ∈
                                 
                                    
                                       S
                                    
                                    
                                       Tra
                                       (
                                       b
                                       ,
                                       d
                                       )
                                    
                                 
                                 
                                 ∀
                                 (
                                 
                                    
                                       r
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       r
                                    
                                    
                                       2
                                    
                                 
                                 )
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       b
                                       ≠
                                    
                                    
                                       2
                                    
                                 
                                 ,
                              
                           
                        
                        
                           
                              (30)
                              
                                 
                                    
                                       z
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                    
                                    
                                       s
                                       ,
                                       d
                                    
                                 
                                 ⩽
                                 1
                                 -
                                 
                                    
                                       ℓ
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                       ,
                                       e
                                    
                                 
                                 
                                 ∀
                                 b
                                 ∈
                                 B
                                 
                                 ∀
                                 d
                                 ∈
                                 S
                                 
                                 ∀
                                 s
                                 ∈
                                 
                                    
                                       S
                                    
                                    
                                       Tra
                                       (
                                       b
                                       ,
                                       d
                                       )
                                    
                                 
                                 
                                 ∀
                                 (
                                 
                                    
                                       r
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       r
                                    
                                    
                                       2
                                    
                                 
                                 )
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       b
                                    
                                    
                                       2
                                    
                                 
                                 
                                 ∀
                                 e
                                 ∈
                                 E
                                 ⧹
                                 
                                    
                                       E
                                    
                                    
                                       s
                                       ,
                                       d
                                    
                                 
                                 .
                              
                           
                        
                     

The amount of inconvenience 
                           
                              
                                 
                                    τ
                                 
                                 
                                    r
                                 
                                 
                                    s
                                    ,
                                    d
                                 
                              
                           
                         is uniquely determined when there is no opportunity for a transfer on the way from station s to station d. It is simply the traveling time on board:
                           
                              (31)
                              
                                 
                                    
                                       τ
                                    
                                    
                                       r
                                    
                                    
                                       s
                                       ,
                                       d
                                    
                                 
                                 =
                                 
                                    
                                       a
                                    
                                    
                                       r
                                    
                                    
                                       d
                                    
                                 
                                 -
                                 
                                    
                                       d
                                    
                                    
                                       r
                                    
                                    
                                       s
                                    
                                 
                                 ∀
                                 b
                                 ∈
                                 B
                                 
                                 ∀
                                 (
                                 s
                                 ,
                                 d
                                 )
                                 ∈
                                 
                                    
                                       S
                                    
                                    
                                       b
                                       <
                                    
                                    
                                       2
                                    
                                 
                                 such that
                                 
                                 TraNext
                                 (
                                 b
                                 ,
                                 s
                                 )
                                 ∉
                                 
                                    
                                       S
                                    
                                    
                                       Tra
                                       (
                                       b
                                       ,
                                       d
                                       )
                                    
                                 
                                 
                                 ∀
                                 r
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       b
                                    
                                 
                                 .
                              
                           
                        
                     

At intermediate station 
                           
                              TraNext
                              (
                              b
                              ,
                              s
                              )
                           
                         where a train transfer is possible on the way from s to d, the amount of inconvenience to the passengers may or may not be decreased by changing trains. First consider a case where the passengers are still on the same train r. Then, 
                           
                              
                                 
                                    τ
                                 
                                 
                                    r
                                 
                                 
                                    s
                                    ,
                                    d
                                 
                              
                           
                         consists of, the time they spend on board between the departure from s and the departure from 
                           
                              TraNext
                              (
                              b
                              ,
                              s
                              )
                           
                        , and the amount of inconvenience 
                           
                              
                                 
                                    τ
                                 
                                 
                                    r
                                 
                                 
                                    TraNext
                                    (
                                    b
                                    ,
                                    s
                                    )
                                    ,
                                    d
                                 
                              
                           
                         from 
                           
                              TraNext
                              (
                              b
                              ,
                              s
                              )
                           
                         to d. We model the constraint by introducing the large constant 
                           
                              
                                 
                                    M
                                 
                                 
                                    I
                                 
                              
                           
                        :
                           
                              (32)
                              
                                 
                                    
                                       τ
                                    
                                    
                                       r
                                    
                                    
                                       s
                                       ,
                                       d
                                    
                                 
                                 ⩾
                                 
                                    
                                       a
                                    
                                    
                                       r
                                    
                                    
                                       TraNext
                                       (
                                       b
                                       ,
                                       s
                                       )
                                    
                                 
                                 -
                                 
                                    
                                       d
                                    
                                    
                                       r
                                    
                                    
                                       s
                                    
                                 
                                 +
                                 (
                                 
                                    
                                       d
                                    
                                    
                                       r
                                    
                                    
                                       TraNext
                                       (
                                       b
                                       ,
                                       s
                                       )
                                    
                                 
                                 -
                                 
                                    
                                       a
                                    
                                    
                                       r
                                    
                                    
                                       TraNext
                                       (
                                       b
                                       ,
                                       s
                                       )
                                    
                                 
                                 )
                                 +
                                 
                                    
                                       τ
                                    
                                    
                                       r
                                    
                                    
                                       TraNext
                                       (
                                       b
                                       ,
                                       s
                                       )
                                       ,
                                       d
                                    
                                 
                                 -
                                 
                                    
                                       M
                                    
                                    
                                       I
                                    
                                 
                                 (
                                 1
                                 -
                                 
                                    
                                       z
                                    
                                    
                                       r
                                       ,
                                       r
                                    
                                    
                                       TraNext
                                       (
                                       b
                                       ,
                                       s
                                       )
                                       ,
                                       d
                                    
                                 
                                 )
                                 ∀
                                 b
                                 ∈
                                 B
                                 
                                 ∀
                                 (
                                 s
                                 ,
                                 d
                                 )
                                 ∈
                                 
                                    
                                       S
                                    
                                    
                                       b
                                       <
                                    
                                    
                                       2
                                    
                                 
                                 such that
                                 
                                 TraNext
                                 (
                                 b
                                 ,
                                 s
                                 )
                                 ∈
                                 
                                    
                                       S
                                    
                                    
                                       Tra
                                       (
                                       b
                                       ,
                                       d
                                       )
                                    
                                 
                                 
                                 ∀
                                 r
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       b
                                    
                                 
                                 .
                              
                           
                        
                     

Next suppose that the passengers transfer from 
                           
                              
                                 
                                    r
                                 
                                 
                                    1
                                 
                              
                           
                         to 
                           
                              
                                 
                                    r
                                 
                                 
                                    2
                                 
                              
                           
                        . Then the waiting time multiplied by 
                           
                              α
                           
                         instead of the dwell time and the train transfer penalty 
                           
                              β
                           
                         are imposed:
                           
                              (33)
                              
                                 
                                    
                                       τ
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                    
                                    
                                       s
                                       ,
                                       d
                                    
                                 
                                 ⩾
                                 
                                    
                                       a
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                    
                                    
                                       TraNext
                                       (
                                       b
                                       ,
                                       s
                                       )
                                    
                                 
                                 -
                                 
                                    
                                       d
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                    
                                    
                                       s
                                    
                                 
                                 +
                                 α
                                 ×
                                 (
                                 
                                    
                                       d
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                    
                                    
                                       TraNext
                                       (
                                       b
                                       ,
                                       s
                                       )
                                    
                                 
                                 -
                                 
                                    
                                       a
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                    
                                    
                                       TraNext
                                       (
                                       b
                                       ,
                                       s
                                       )
                                    
                                 
                                 )
                                 +
                                 β
                                 +
                                 
                                    
                                       τ
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                    
                                    
                                       TraNext
                                       (
                                       b
                                       ,
                                       s
                                       )
                                       ,
                                       d
                                    
                                 
                                 -
                                 
                                    
                                       M
                                    
                                    
                                       I
                                    
                                 
                                 (
                                 1
                                 -
                                 
                                    
                                       z
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                    
                                    
                                       TraNext
                                       (
                                       b
                                       ,
                                       s
                                       )
                                       ,
                                       d
                                    
                                 
                                 )
                                 
                                 ∀
                                 b
                                 ∈
                                 B
                                 
                                 ∀
                                 (
                                 s
                                 ,
                                 d
                                 )
                                 ∈
                                 
                                    
                                       S
                                    
                                    
                                       b
                                       <
                                    
                                    
                                       2
                                    
                                 
                                 such that
                                 TraNext
                                 (
                                 b
                                 ,
                                 s
                                 )
                                 ∈
                                 
                                    
                                       S
                                    
                                    
                                       Tra
                                       (
                                       b
                                       ,
                                       d
                                       )
                                    
                                 
                                 
                                 ∀
                                 (
                                 
                                    
                                       r
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       r
                                    
                                    
                                       2
                                    
                                 
                                 )
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       b
                                       ≠
                                    
                                    
                                       2
                                    
                                 
                                 .
                              
                           
                        
                     

Finally we calculate the increased amount of inconvenience to passengers 
                           
                              
                                 
                                    y
                                 
                                 
                                    t
                                    ,
                                    r
                                 
                                 
                                    o
                                    ,
                                    d
                                 
                              
                           
                        . It is given by 
                           
                              
                                 
                                    y
                                 
                                 
                                    t
                                    ,
                                    r
                                 
                                 
                                    o
                                    ,
                                    d
                                 
                              
                              =
                              
                                 
                                    z
                                 
                                 
                                    t
                                    ,
                                    r
                                 
                                 
                                    o
                                    ,
                                    d
                                 
                              
                              ×
                              max
                              {
                              α
                              ×
                              (
                              
                                 
                                    d
                                 
                                 
                                    r
                                 
                                 
                                    o
                                 
                              
                              -
                              t
                              )
                              +
                              
                                 
                                    τ
                                 
                                 
                                    r
                                 
                                 
                                    o
                                    ,
                                    d
                                 
                              
                              -
                              
                                 
                                    A
                                 
                                 
                                    t
                                 
                                 
                                    o
                                    ,
                                    d
                                 
                              
                              ,
                              0
                              }
                           
                        . We first assume that 
                           
                              
                                 
                                    z
                                 
                                 
                                    t
                                    ,
                                    r
                                 
                                 
                                    o
                                    ,
                                    d
                                 
                              
                              =
                              1
                           
                        , i.e., the passengers who appear at the origin station o at the time t take the train r to go to their destination d. The term 
                           
                              α
                              ×
                              (
                              
                                 
                                    d
                                 
                                 
                                    r
                                 
                                 
                                    o
                                 
                              
                              -
                              t
                              )
                           
                         is the inconvenience of waiting for r and 
                           
                              
                                 
                                    τ
                                 
                                 
                                    r
                                 
                                 
                                    o
                                    ,
                                    d
                                 
                              
                           
                         is the inconvenience which they suffer after taking r. We subtract the amount of inconvenience in the planned timetable from the sum of these two terms, i.e., the total amount of inconvenience in the disrupted situation. When its value is negative, we regard the ‘increased’ amount of inconvenience as zero. We next consider the case where 
                           
                              
                                 
                                    z
                                 
                                 
                                    t
                                    ,
                                    r
                                 
                                 
                                    o
                                    ,
                                    d
                                 
                              
                              =
                              0
                           
                        , which indicates that they do not take r at their origin station. Then the inconvenience by taking this train is zero. This complicated equation is linearized in the following way:
                           
                              (34)
                              
                                 
                                    
                                       y
                                    
                                    
                                       t
                                       ,
                                       r
                                    
                                    
                                       o
                                       ,
                                       d
                                    
                                 
                                 ⩾
                                 α
                                 ×
                                 (
                                 
                                    
                                       d
                                    
                                    
                                       r
                                    
                                    
                                       o
                                    
                                 
                                 -
                                 t
                                 )
                                 +
                                 
                                    
                                       τ
                                    
                                    
                                       r
                                    
                                    
                                       o
                                       ,
                                       d
                                    
                                 
                                 -
                                 
                                    
                                       A
                                    
                                    
                                       t
                                    
                                    
                                       o
                                       ,
                                       d
                                    
                                 
                                 -
                                 
                                    
                                       M
                                    
                                    
                                       I
                                    
                                 
                                 (
                                 1
                                 -
                                 
                                    
                                       z
                                    
                                    
                                       t
                                       ,
                                       r
                                    
                                    
                                       o
                                       ,
                                       d
                                    
                                 
                                 )
                                 
                                 ∀
                                 b
                                 ∈
                                 B
                                 
                                 ∀
                                 (
                                 o
                                 ,
                                 d
                                 )
                                 ∈
                                 
                                    
                                       S
                                    
                                    
                                       b
                                       <
                                    
                                    
                                       2
                                    
                                 
                                 
                                 ∀
                                 t
                                 ∈
                                 T
                                 
                                 ∀
                                 r
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       b
                                    
                                 
                                 ,
                              
                           
                        
                        
                           
                              (35)
                              
                                 
                                    
                                       y
                                    
                                    
                                       t
                                       ,
                                       r
                                    
                                    
                                       o
                                       ,
                                       d
                                    
                                 
                                 ⩾
                                 0
                                 
                                 
                                 
                                 
                                 
                                 ∀
                                 b
                                 ∈
                                 B
                                 
                                 ∀
                                 (
                                 o
                                 ,
                                 d
                                 )
                                 ∈
                                 
                                    
                                       S
                                    
                                    
                                       b
                                       <
                                    
                                    
                                       2
                                    
                                 
                                 
                                 ∀
                                 t
                                 ∈
                                 T
                                 
                                 ∀
                                 r
                                 ∈
                                 
                                    R
                                    
                                       b
                                    
                                 
                                 .
                              
                           
                        
                     

We add several constraints to obtain an optimal solution for 
                           
                              (
                              IMP
                              )
                           
                         in a short time. Although these constraints are redundant, i.e., the feasible regions of the MIP problems are equivalent with or without them, those of the LP relaxation problems may be different. The constraints presented in this subsection are expected to give a tighter lower bound of 
                           
                              (
                              IMP
                              )
                           
                         in the branch-and-cut process in general MIP algorithms.

Let the type of two trains 
                           
                              
                                 
                                    r
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    r
                                 
                                 
                                    2
                                 
                              
                           
                         be the same and 
                           
                              t
                              ⩽
                              
                                 
                                    D
                                 
                                 
                                    
                                       
                                          r
                                       
                                       
                                          1
                                       
                                    
                                 
                                 
                                    o
                                 
                              
                           
                         holds, i.e., passengers appearing at t do not miss 
                           
                              
                                 
                                    r
                                 
                                 
                                    1
                                 
                              
                           
                         from 
                           
                              
                                 
                                    D
                                 
                                 
                                    
                                       
                                          r
                                       
                                       
                                          1
                                       
                                    
                                 
                                 
                                    o
                                 
                              
                              ⩽
                              
                                 
                                    d
                                 
                                 
                                    
                                       
                                          r
                                       
                                       
                                          1
                                       
                                    
                                 
                                 
                                    o
                                 
                              
                           
                         in the inequality (7). If 
                           
                              
                                 
                                    x
                                 
                                 
                                    
                                       
                                          r
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    
                                       
                                          r
                                       
                                       
                                          2
                                       
                                    
                                 
                                 
                                    o
                                 
                              
                              =
                              1
                           
                         then 
                           
                              
                                 
                                    r
                                 
                                 
                                    1
                                 
                              
                           
                         also departs earlier than 
                           
                              
                                 
                                    r
                                 
                                 
                                    2
                                 
                              
                           
                         from the stations afterwards from the inequality (15). Therefore they do not take 
                           
                              
                                 
                                    r
                                 
                                 
                                    2
                                 
                              
                           
                        :
                           
                              (36)
                              
                                 
                                    
                                       z
                                    
                                    
                                       t
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                    
                                    
                                       o
                                       ,
                                       d
                                    
                                 
                                 ⩽
                                 3
                                 -
                                 
                                    
                                       x
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                    
                                    
                                       o
                                    
                                 
                                 -
                                 
                                    
                                       ℓ
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       e
                                    
                                 
                                 -
                                 
                                    
                                       ℓ
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                       ,
                                       e
                                    
                                 
                                 
                                 ∀
                                 b
                                 ∈
                                 B
                                 
                                 ∀
                                 (
                                 o
                                 ,
                                 d
                                 )
                                 ∈
                                 
                                    
                                       S
                                    
                                    
                                       b
                                       <
                                    
                                    
                                       2
                                    
                                 
                                 
                                 ∀
                                 t
                                 ∈
                                 T
                                 
                                 ∀
                                 (
                                 
                                    
                                       r
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       r
                                    
                                    
                                       2
                                    
                                 
                                 )
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       b
                                       ≠
                                    
                                    
                                       2
                                    
                                 
                                 such that
                                 
                                 t
                                 ⩽
                                 
                                    
                                       D
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                    
                                    
                                       o
                                    
                                 
                                 
                                 ∀
                                 e
                                 ∈
                                 
                                    
                                       E
                                    
                                    
                                       o
                                    
                                 
                                 .
                              
                           
                        
                     

We next consider a case where the passengers can travel between 
                           
                              (
                              o
                              ,
                              d
                              )
                           
                         by getting on single train 
                           
                              
                                 
                                    r
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    r
                                 
                                 
                                    2
                                 
                              
                           
                         stops at o and 
                           
                              
                                 
                                    r
                                 
                                 
                                    1
                                 
                              
                           
                         arrives at d earlier than 
                           
                              
                                 
                                    r
                                 
                                 
                                    2
                                 
                              
                           
                        . When 
                           
                              α
                              =
                              1
                           
                        , i.e., the inconvenience they suffer on their route consists of their traveling time and a transfer 
                           1
                           Additional inequalities for 
                                 
                                    α
                                    >
                                    1
                                 
                               are proposed and the computation time of 
                                 
                                    (
                                    IMP
                                    )
                                 
                               with or without them is analyzed by Tamura et al. (Unpublished results).
                        
                        
                           1
                        , taking 
                           
                              
                                 
                                    r
                                 
                                 
                                    1
                                 
                              
                           
                         is a better choice; the traveling time by taking 
                           
                              
                                 
                                    r
                                 
                                 
                                    1
                                 
                              
                           
                         is shorter than that by taking 
                           
                              
                                 
                                    r
                                 
                                 
                                    2
                                 
                              
                           
                         and 
                           
                              
                                 
                                    r
                                 
                                 
                                    1
                                 
                              
                           
                         stops at o and d. Hence, they do not take 
                           
                              
                                 
                                    r
                                 
                                 
                                    2
                                 
                              
                           
                         at o. This situation is modeled as follows:
                           
                              (37)
                              
                                 
                                    
                                       
                                       
                                          
                                             
                                                
                                                   z
                                                
                                                
                                                   t
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                                
                                                   o
                                                   ,
                                                   d
                                                
                                             
                                             ⩽
                                             3
                                             -
                                             
                                                
                                                   x
                                                
                                                
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         s
                                                      
                                                      
                                                         ¯
                                                      
                                                   
                                                
                                             
                                             -
                                             
                                                
                                                   ℓ
                                                
                                                
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         e
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                
                                             
                                             -
                                             
                                                
                                                   ℓ
                                                
                                                
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         e
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                             
                                             ∀
                                             b
                                             ∈
                                             B
                                             
                                             ∀
                                             (
                                             o
                                             ,
                                             d
                                             )
                                             ∈
                                             
                                                
                                                   S
                                                
                                                
                                                   b
                                                   <
                                                
                                                
                                                   2
                                                
                                             
                                             
                                             
                                                
                                                   s
                                                
                                                
                                                   ¯
                                                
                                             
                                             ∈
                                             S
                                             
                                             such that
                                             
                                             Next
                                             (
                                             b
                                             ,
                                             
                                                
                                                   s
                                                
                                                
                                                   ¯
                                                
                                             
                                             )
                                             =
                                             d
                                             
                                             ∀
                                             t
                                             ∈
                                             T
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             ∀
                                             (
                                             
                                                
                                                   r
                                                
                                                
                                                   1
                                                
                                             
                                             ,
                                             
                                                
                                                   r
                                                
                                                
                                                   2
                                                
                                             
                                             )
                                             ∈
                                             
                                                
                                                   R
                                                
                                                
                                                   b
                                                   ≠
                                                
                                                
                                                   2
                                                
                                             
                                             such that
                                             
                                             t
                                             ⩽
                                             
                                                
                                                   D
                                                
                                                
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                
                                                
                                                   o
                                                
                                             
                                             
                                             ∀
                                             
                                                
                                                   e
                                                
                                                
                                                   1
                                                
                                             
                                             ∈
                                             
                                                
                                                   E
                                                
                                                
                                                   o
                                                
                                             
                                             ∩
                                             
                                                
                                                   E
                                                
                                                
                                                   d
                                                
                                             
                                             
                                             
                                                
                                                   e
                                                
                                                
                                                   2
                                                
                                             
                                             ∈
                                             
                                                
                                                   E
                                                
                                                
                                                   o
                                                
                                             
                                             such that
                                             
                                             
                                                
                                                   e
                                                
                                                
                                                   1
                                                
                                             
                                             ≠
                                             
                                                
                                                   e
                                                
                                                
                                                   2
                                                
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        
                     

The passengers do not transfer to a train of the same type:
                           
                              (38)
                              
                                 
                                    
                                       z
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                    
                                    
                                       s
                                       ,
                                       d
                                    
                                 
                                 ⩽
                                 2
                                 -
                                 
                                    
                                       ℓ
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       e
                                    
                                 
                                 -
                                 
                                    
                                       ℓ
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                       ,
                                       e
                                    
                                 
                                 
                                 ∀
                                 b
                                 ∈
                                 B
                                 
                                 ∀
                                 d
                                 ∈
                                 S
                                 
                                 ∀
                                 s
                                 ∈
                                 
                                    
                                       S
                                    
                                    
                                       Tra
                                       (
                                       b
                                       ,
                                       d
                                       )
                                    
                                 
                                 
                                 ∀
                                 (
                                 
                                    
                                       r
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       r
                                    
                                    
                                       2
                                    
                                 
                                 )
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       b
                                       ≠
                                    
                                    
                                       2
                                    
                                 
                                 
                                 ∀
                                 e
                                 ∈
                                 E
                                 .
                              
                           
                        
                     

If the passengers transfer from 
                           
                              
                                 
                                    r
                                 
                                 
                                    1
                                 
                              
                           
                         to another train, then it must be done at only one station:
                           
                              (39)
                              
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          s
                                          ∈
                                          
                                             
                                                S
                                             
                                             
                                                Tra
                                                (
                                                b
                                                ,
                                                d
                                                )
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          ∑
                                       
                                       
                                          
                                             
                                                r
                                             
                                             
                                                2
                                             
                                          
                                          ∈
                                          
                                             
                                                R
                                             
                                             
                                                b
                                             
                                          
                                          ⧹
                                          {
                                          
                                             
                                                r
                                             
                                             
                                                1
                                             
                                          
                                          }
                                       
                                    
                                 
                                 
                                    
                                       z
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                    
                                    
                                       s
                                       ,
                                       d
                                    
                                 
                                 ⩽
                                 1
                                 
                                 ∀
                                 b
                                 ∈
                                 B
                                 
                                 ∀
                                 d
                                 ∈
                                 S
                                 
                                 ∀
                                 
                                    
                                       r
                                    
                                    
                                       1
                                    
                                 
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       b
                                    
                                 
                                 .
                              
                           
                        
                     

Let 
                           
                              
                                 
                                    r
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    r
                                 
                                 
                                    2
                                 
                              
                           
                         stop at d and 
                           
                              
                                 
                                    r
                                 
                                 
                                    1
                                 
                              
                           
                         arrives at d earlier. Then the sum of the waiting time of 
                           
                              
                                 
                                    r
                                 
                                 
                                    2
                                 
                              
                           
                         after getting off 
                           
                              
                                 
                                    r
                                 
                                 
                                    1
                                 
                              
                           
                         for the transfer and the traveling time on board by 
                           
                              
                                 
                                    r
                                 
                                 
                                    2
                                 
                              
                           
                         is longer than the traveling time on board by 
                           
                              
                                 
                                    r
                                 
                                 
                                    1
                                 
                              
                           
                        . When 
                           
                              α
                              ⩾
                              1
                           
                        , any passenger do not transfer to 
                           
                              
                                 
                                    r
                                 
                                 
                                    2
                                 
                              
                           
                         since it brings more inconvenience. This is expressed as follows:
                           
                              (40)
                              
                                 
                                    
                                       z
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                    
                                    
                                       s
                                       ,
                                       d
                                    
                                 
                                 ⩽
                                 3
                                 -
                                 
                                    
                                       x
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                    
                                    
                                       
                                          
                                             s
                                          
                                          
                                             ¯
                                          
                                       
                                    
                                 
                                 -
                                 
                                    
                                       ℓ
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          
                                             e
                                          
                                          
                                             1
                                          
                                       
                                    
                                 
                                 -
                                 
                                    
                                       ℓ
                                    
                                    
                                       
                                          
                                             r
                                          
                                          
                                             2
                                          
                                       
                                       ,
                                       
                                          
                                             e
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 
                                 ∀
                                 b
                                 ∈
                                 B
                                 
                                 ∀
                                 d
                                 ∈
                                 S
                                 
                                 ∀
                                 s
                                 ∈
                                 
                                    
                                       S
                                    
                                    
                                       Tra
                                       (
                                       b
                                       ,
                                       d
                                       )
                                    
                                 
                                 
                                 
                                    
                                       s
                                    
                                    
                                       ¯
                                    
                                 
                                 ∈
                                 S
                                 
                                 such that
                                 
                                 Next
                                 (
                                 b
                                 ,
                                 
                                    
                                       s
                                    
                                    
                                       ¯
                                    
                                 
                                 )
                                 =
                                 d
                                 ∀
                                 (
                                 
                                    
                                       r
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       r
                                    
                                    
                                       2
                                    
                                 
                                 )
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       b
                                       ≠
                                    
                                    
                                       2
                                    
                                 
                                 
                                 ∀
                                 
                                    
                                       e
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       e
                                    
                                    
                                       2
                                    
                                 
                                 ∈
                                 
                                    
                                       E
                                    
                                    
                                       d
                                    
                                 
                                 .
                              
                           
                        
                     

Consider passengers between 
                           
                              (
                              o
                              ,
                              
                                 
                                    d
                                 
                                 
                                    1
                                 
                              
                              )
                           
                         and those between 
                           
                              (
                              o
                              ,
                              
                                 
                                    d
                                 
                                 
                                    2
                                 
                              
                              )
                           
                         who appear at the same time. When 
                           
                              (
                              o
                              ,
                              
                                 
                                    d
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    d
                                 
                                 
                                    2
                                 
                              
                              )
                              ∈
                              F
                           
                         holds, i.e., their behavior at o is the same, two such O–D pairs can be aggregated as follows:
                           
                              (41)
                              
                                 
                                    
                                       z
                                    
                                    
                                       t
                                       ,
                                       r
                                    
                                    
                                       o
                                       ,
                                       
                                          
                                             d
                                          
                                          
                                             1
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       z
                                    
                                    
                                       t
                                       ,
                                       r
                                    
                                    
                                       o
                                       ,
                                       
                                          
                                             d
                                          
                                          
                                             2
                                          
                                       
                                    
                                 
                                 
                                 ∀
                                 b
                                 ∈
                                 B
                                 
                                 ∀
                                 (
                                 o
                                 ,
                                 
                                    
                                       d
                                    
                                    
                                       1
                                    
                                 
                                 )
                                 ,
                                 (
                                 o
                                 ,
                                 
                                    
                                       d
                                    
                                    
                                       2
                                    
                                 
                                 )
                                 ∈
                                 
                                    
                                       S
                                    
                                    
                                       b
                                       <
                                    
                                    
                                       2
                                    
                                 
                                 such that
                                 
                                 
                                    
                                       d
                                    
                                    
                                       1
                                    
                                 
                                 ≠
                                 
                                    
                                       d
                                    
                                    
                                       2
                                    
                                 
                                 and
                                 (
                                 o
                                 ,
                                 
                                    
                                       d
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       d
                                    
                                    
                                       2
                                    
                                 
                                 )
                                 ∈
                                 F
                                 
                                 ∀
                                 t
                                 ∈
                                 T
                                 
                                 ∀
                                 r
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       b
                                    
                                 
                                 .
                              
                           
                        
                     

Similarly at the intermediate stations, we have
                           
                              (42)
                              
                                 
                                    
                                       z
                                    
                                    
                                       
                                          r
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          r
                                          
                                             2
                                          
                                       
                                    
                                    
                                       s
                                       ,
                                       
                                          d
                                          
                                             1
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       z
                                    
                                    
                                       
                                          r
                                          
                                             1
                                          
                                       
                                       ,
                                       
                                          r
                                          
                                             2
                                          
                                       
                                    
                                    
                                       s
                                       ,
                                       
                                          d
                                          
                                             2
                                          
                                       
                                    
                                 
                                 
                                 
                                 ∀
                                 b
                                 ∈
                                 B
                                 
                                 ∀
                                 (
                                 s
                                 ,
                                 
                                    d
                                    
                                       1
                                    
                                 
                                 )
                                 ,
                                 (
                                 s
                                 ,
                                 
                                    d
                                    
                                       2
                                    
                                 
                                 )
                                 ∈
                                 
                                    
                                       S
                                    
                                    
                                       b
                                       <
                                    
                                    
                                       2
                                    
                                 
                                 
                                 
                                 such that
                                 
                                 
                                    d
                                    
                                       1
                                    
                                 
                                 ≠
                                 
                                    d
                                    
                                       2
                                    
                                 
                                 and
                                 (
                                 s
                                 ,
                                 
                                    d
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    d
                                    
                                       2
                                    
                                 
                                 )
                                 ∈
                                 F
                                 
                                 ∀
                                 (
                                 
                                    r
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    r
                                    
                                       2
                                    
                                 
                                 )
                                 ∈
                                 
                                    
                                       R
                                    
                                    
                                       b
                                    
                                    
                                       2
                                    
                                 
                                 .
                              
                           
                        
                     

We consider two objective functions in our timetable rescheduling; the one simply minimizes the total amount of arrival delays and ignores the passenger behavior model. We call the MIP problem as the arrival Delay Minimization Problem 
                           
                              (
                              DMP
                              )
                           
                         and the formulation is as follows:
                           
                              
                                 
                                    
                                       
                                       
                                          
                                             minimize
                                             
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      b
                                                      ∈
                                                      B
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      r
                                                      ∈
                                                      
                                                         
                                                            R
                                                         
                                                         
                                                            b
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      s
                                                      ∈
                                                      S
                                                      ⧹
                                                      {
                                                      Start
                                                      (
                                                      b
                                                      )
                                                      }
                                                   
                                                
                                             
                                             (
                                             
                                                
                                                   a
                                                
                                                
                                                   r
                                                
                                                
                                                   s
                                                
                                             
                                             -
                                             
                                                
                                                   A
                                                
                                                
                                                   r
                                                
                                                
                                                   s
                                                
                                             
                                             )
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             subject to
                                             
                                             
                                                (1)–(24)
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                             
                                                
                                                   ℓ
                                                
                                                
                                                   r
                                                   ,
                                                   e
                                                
                                             
                                             ,
                                             
                                                
                                                   u
                                                
                                                
                                                   r
                                                
                                                
                                                   s
                                                   ,
                                                   k
                                                
                                             
                                             ,
                                             
                                                
                                                   g
                                                
                                                
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                             ,
                                             
                                                
                                                   x
                                                
                                                
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                                
                                                   s
                                                
                                             
                                             ,
                                             
                                                
                                                   n
                                                
                                                
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                                
                                                   s
                                                
                                             
                                             ∈
                                             {
                                             0
                                             ,
                                             1
                                             }
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        
                     

The minute is a unit of the objective value of 
                           
                              (
                              DMP
                              )
                           
                         and its lower bound is zero from the inequality (6).

The other is minimizing the sum of increased amount of inconvenience over all the passengers and it is what we think is of crucial importance. We name it the passenger Inconvenience Minimization Problem 
                           
                              (
                              IMP
                              )
                           
                         and present the formulation below:
                           
                              
                                 
                                    
                                       
                                       
                                          
                                             minimize
                                             
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      b
                                                      ∈
                                                      B
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      (
                                                      o
                                                      ,
                                                      d
                                                      )
                                                      ∈
                                                      
                                                         
                                                            S
                                                         
                                                         
                                                            b
                                                            <
                                                         
                                                         
                                                            2
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      ∑
                                                   
                                                   
                                                      t
                                                      ∈
                                                      T
                                                   
                                                
                                             
                                             
                                                
                                                   P
                                                
                                                
                                                   t
                                                
                                                
                                                   o
                                                   ,
                                                   d
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               ∑
                                                            
                                                            
                                                               r
                                                               ∈
                                                               
                                                                  
                                                                     R
                                                                  
                                                                  
                                                                     b
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            y
                                                         
                                                         
                                                            t
                                                            ,
                                                            r
                                                         
                                                         
                                                            o
                                                            ,
                                                            d
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             subject to
                                             
                                             
                                             
                                                (1)–(42),
                                          
                                       
                                    
                                    
                                       
                                       
                                          
                                             
                                             
                                                
                                                   ℓ
                                                
                                                
                                                   r
                                                   ,
                                                   e
                                                
                                             
                                             ,
                                             
                                                
                                                   u
                                                
                                                
                                                   r
                                                
                                                
                                                   s
                                                   ,
                                                   k
                                                
                                             
                                             ,
                                             
                                                
                                                   g
                                                
                                                
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                             
                                             ,
                                             
                                                
                                                   x
                                                
                                                
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                                
                                                   s
                                                
                                             
                                             ,
                                             
                                                
                                                   n
                                                
                                                
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                                
                                                   s
                                                
                                             
                                             ,
                                             
                                                
                                                   z
                                                
                                                
                                                   t
                                                   ,
                                                   r
                                                
                                                
                                                   o
                                                   ,
                                                   d
                                                
                                             
                                             ,
                                             
                                                
                                                   z
                                                
                                                
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         1
                                                      
                                                   
                                                   ,
                                                   
                                                      
                                                         r
                                                      
                                                      
                                                         2
                                                      
                                                   
                                                
                                                
                                                   s
                                                   ,
                                                   d
                                                
                                             
                                             ∈
                                             {
                                             0
                                             ,
                                             1
                                             }
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        
                     

The amount of inconvenience times the number of passengers is a unit of the objective value of 
                           
                              (
                              IMP
                              )
                           
                         and its lower bound of is also zero from the inequality (35).

The overall algorithm minimizing further inconvenience to passengers caused by a disruption is as follows:
                           
                              
                                 Step 1:
                              
                              (Passenger Inconvenience Calculation in Planned Timetable)

Construct time-space graph from planned timetable and T.

Set amount of inconvenience on each arc.

For each 
                                    
                                       b
                                       ∈
                                       B
                                       ,
                                       (
                                       o
                                       ,
                                       d
                                       )
                                       ∈
                                       
                                          
                                             S
                                          
                                          
                                             b
                                             <
                                          
                                          
                                             2
                                          
                                       
                                       ,
                                       t
                                       ∈
                                       T
                                    
                                 ,

Find shortest path of passengers from o to d appearing at t.

Set shortest path length on 
                                    
                                       
                                          
                                             A
                                          
                                          
                                             t
                                          
                                          
                                             o
                                             ,
                                             d
                                          
                                       
                                    
                                 .

(Arrival Delay Minimization)

Input initial delay information.

For each 
                                    
                                       r
                                       ∈
                                       R
                                       ,
                                       s
                                       ∈
                                       S
                                    
                                 , set 
                                    
                                       
                                          
                                             
                                                
                                                   A
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             r
                                          
                                          
                                             s
                                          
                                       
                                       ,
                                       
                                          
                                             
                                                
                                                   D
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             r
                                          
                                          
                                             s
                                          
                                       
                                       ≔
                                       ∞
                                    
                                 .

Calculate 
                                    
                                       
                                          
                                             M
                                          
                                          
                                             H
                                          
                                       
                                    
                                 .

Solve 
                                    
                                       (
                                       DMP
                                       )
                                    
                                 .

(Passenger Inconvenience Minimization)

For each 
                                    
                                       r
                                       ∈
                                       R
                                       ,
                                       s
                                       ∈
                                       S
                                    
                                 , set 
                                    
                                       
                                          
                                             
                                                
                                                   A
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             r
                                          
                                          
                                             s
                                          
                                       
                                       ≔
                                       
                                          
                                             a
                                          
                                          
                                             r
                                          
                                          
                                             s
                                          
                                       
                                       ,
                                       
                                          
                                             
                                                
                                                   D
                                                
                                                
                                                   ^
                                                
                                             
                                          
                                          
                                             r
                                          
                                          
                                             s
                                          
                                       
                                       ≔
                                       
                                          
                                             d
                                          
                                          
                                             r
                                          
                                          
                                             s
                                          
                                       
                                    
                                  in solution for 
                                    
                                       (
                                       DMP
                                       )
                                    
                                 .

Give 
                                    
                                       
                                          
                                             I
                                          
                                          
                                             Flex
                                          
                                       
                                    
                                 .

Update 
                                    
                                       
                                          
                                             M
                                          
                                          
                                             H
                                          
                                       
                                    
                                 .

Calculate 
                                    
                                       
                                          
                                             M
                                          
                                          
                                             I
                                          
                                       
                                    
                                 .

Solve 
                                    
                                       (
                                       IMP
                                       )
                                    
                                 .

At Step 1, we calculate the amount of inconvenience to passengers in the planned timetable before there occurs a delay, since our objective is to minimize the positive difference between the inconvenience in a rescheduled timetable and that in the planned timetable. Namely, we compute 
                           
                              
                                 
                                    A
                                 
                                 
                                    t
                                 
                                 
                                    o
                                    ,
                                    d
                                 
                              
                           
                         for each passenger between the stations 
                           
                              (
                              o
                              ,
                              d
                              )
                           
                         appearing at the time t. Since the passengers are assumed to take a train and transfer so that the inconvenience to them will be minimized, we model the problem of routing them as a network flow problem and apply a shortest path algorithm. Firstly, we construct a widely used train time-space graph (Kanai et al. (2011) call it a passenger behavior network) from the planned train diagram and the set of time periods T. The nodes consists of the arrival/departure events of the trains at each station, and triplet 
                           
                              (
                              o
                              ,
                              d
                              ,
                              t
                              )
                              ∈
                              
                                 
                                    S
                                 
                                 
                                    b
                                    <
                                 
                                 
                                    2
                                 
                              
                              ×
                              T
                           
                         for each direction 
                           
                              b
                              ∈
                              B
                           
                        . This means the appearance of passengers at the station o at the time t whose destination is d. The directed arcs are drawn between nodes when the passengers can move between them directly. Specifically, (i) an appearance node of passengers to a train departure node from the same station, (ii) a train departure node to the train arrival node at the next station, (iii) a train arrival node to the train departure node at the same station, (iv) a train arrival node to a different train departure node at the same station. The arc (i) indicates a wait for the departure of the corresponding train, the arc (ii) travel by the train between the adjacent stations, the arc (iii) a wait on board at the station, and the arc (iv) a transfer between the two trains and a wait for the departure of the latter train. Secondly, we impose on each arc the amount of inconvenience caused by the corresponding activity. The waiting time multiplied by 
                           
                              α
                           
                         is imposed on (i), the traveling time on (ii), the dwell time on (iii), (iv) the transfer penalty 
                           
                              β
                           
                         and the waiting time multiplied by 
                           
                              α
                           
                        . Lastly, we find a shortest path from each appearance node 
                           
                              (
                              o
                              ,
                              d
                              ,
                              t
                              )
                           
                         to any train arrival node at d. We apply Dijkstra’s algorithm for instance and have the shortest path length, which is 
                           
                              
                                 
                                    A
                                 
                                 
                                    t
                                 
                                 
                                    o
                                    ,
                                    d
                                 
                              
                           
                        .

When there occurs an initial delay, we first input the information to obtain a different rescheduled timetable at Step 2. The delay is associated with the corresponding train arrival or departure event. At this step, we do not yet solve the passenger-oriented optimization problem, since we do not know the right-hand side values 
                           
                              
                                 
                                    
                                       
                                          A
                                       
                                       
                                          ^
                                       
                                    
                                 
                                 
                                    r
                                 
                                 
                                    s
                                 
                              
                           
                         and 
                           
                              
                                 
                                    
                                       
                                          D
                                       
                                       
                                          ^
                                       
                                    
                                 
                                 
                                    r
                                 
                                 
                                    s
                                 
                              
                           
                         of the inequalities (6) and (7). Recall that we have to balance the solution quality with the computation time or the punctuality, and that we need a feasible rescheduled timetable as a reference point for that reason. The solution for 
                           
                              (
                              DMP
                              )
                           
                         can be utilized. We temporarily let 
                           
                              
                                 
                                    
                                       
                                          A
                                       
                                       
                                          ^
                                       
                                    
                                 
                                 
                                    r
                                 
                                 
                                    s
                                 
                              
                              ,
                              
                                 
                                    
                                       
                                          D
                                       
                                       
                                          ^
                                       
                                    
                                 
                                 
                                    r
                                 
                                 
                                    s
                                 
                              
                              ≔
                              ∞
                           
                         to ignore the right-hand sides of (6) and (7). We then decide a proper value of the large constant 
                           
                              
                                 
                                    M
                                 
                                 
                                    H
                                 
                              
                           
                         concerning headway which is in the constraints (9)–(12) and (18)–(22), (24) so that we can solve 
                           
                              (
                              DMP
                              )
                           
                        . These constraints are of the form
                           
                              
                                 (time of Event 1)
                                 -
                                 (time of Event 2)
                                 ⩾
                                 (
                                 0
                                 
                                 or
                                 
                                 
                                    
                                       I
                                    
                                    
                                       ∗
                                    
                                    
                                       ∗
                                       ,
                                       ∗
                                    
                                 
                                 )
                                 -
                                 
                                    
                                       M
                                    
                                    
                                       H
                                    
                                 
                                 ×
                                 (
                                 0
                                 ,
                                 1
                                 ,
                                 2
                                 
                                 or
                                 
                                 3
                                 )
                                 .
                              
                           
                        Although Schachtebeck and Schöbel (2010) give a tight lower bound of 
                           
                              
                                 
                                    M
                                 
                                 
                                    H
                                 
                              
                           
                        , we take a rough approach. Overall, the constant satisfies
                           
                              
                                 
                                    
                                       M
                                    
                                    
                                       H
                                    
                                 
                                 ⩾
                                 
                                    max
                                 
                                 {
                                 
                                    
                                       I
                                    
                                    
                                       ∗
                                    
                                    
                                       ∗
                                       ,
                                       ∗
                                    
                                 
                                 }
                                 -
                                 
                                    min
                                 
                                 {
                                 
                                    
                                       a
                                    
                                    
                                       r
                                    
                                    
                                       s
                                    
                                 
                                 ,
                                 
                                    
                                       d
                                    
                                    
                                       r
                                    
                                    
                                       s
                                    
                                 
                                 }
                                 +
                                 
                                    max
                                 
                                 {
                                 
                                    
                                       a
                                    
                                    
                                       r
                                    
                                    
                                       s
                                    
                                 
                                 ,
                                 
                                    
                                       d
                                    
                                    
                                       r
                                    
                                    
                                       s
                                    
                                 
                                 }
                                 .
                              
                           
                        
                     

Since a timetable in which all the trains are delayed for the amount of an initial delay is feasible, we let
                           
                              
                                 
                                    
                                       M
                                    
                                    
                                       H
                                    
                                 
                                 ≔
                                 
                                    max
                                 
                                 {
                                 
                                    
                                       I
                                    
                                    
                                       ∗
                                    
                                    
                                       ∗
                                       ,
                                       ∗
                                    
                                 
                                 }
                                 -
                                 
                                    min
                                 
                                 {
                                 
                                    
                                       A
                                    
                                    
                                       r
                                    
                                    
                                       s
                                    
                                 
                                 ,
                                 
                                    
                                       D
                                    
                                    
                                       r
                                    
                                    
                                       s
                                    
                                 
                                 }
                                 +
                                 (
                                 
                                    max
                                 
                                 {
                                 
                                    
                                       A
                                    
                                    
                                       r
                                    
                                    
                                       s
                                    
                                 
                                 ,
                                 
                                    
                                       D
                                    
                                    
                                       r
                                    
                                    
                                       s
                                    
                                 
                                 }
                                 +
                                 (amount of initial delay)
                                 )
                                 .
                              
                           
                        
                     

Finally we solve 
                           
                              (
                              DMP
                              )
                           
                         and obtain a feasible rescheduled timetable as a reference point.

At Step 3, we improve the rescheduled timetable in terms of passenger satisfaction. Firstly, we let 
                           
                              
                                 
                                    
                                       
                                          A
                                       
                                       
                                          ^
                                       
                                    
                                 
                                 
                                    r
                                 
                                 
                                    s
                                 
                              
                              ,
                              
                                 
                                    
                                       
                                          D
                                       
                                       
                                          ^
                                       
                                    
                                 
                                 
                                    r
                                 
                                 
                                    s
                                 
                              
                           
                         be the rescheduled arrival/departure times 
                           
                              
                                 
                                    a
                                 
                                 
                                    r
                                 
                                 
                                    s
                                 
                              
                              ,
                              
                                 
                                    d
                                 
                                 
                                    r
                                 
                                 
                                    s
                                 
                              
                           
                         in the optimal solution for 
                           
                              (
                              DMP
                              )
                           
                        , respectively. We next introduce the parameter 
                           
                              
                                 
                                    I
                                 
                                 
                                    Flex
                                 
                              
                           
                         to widen the solution space for the passenger-oriented optimization. The right-hand sides of (6) and (7) in 
                           
                              (
                              IMP
                              )
                           
                         are now decided, and we could make 
                           
                              
                                 
                                    M
                                 
                                 
                                    H
                                 
                              
                           
                         smaller. We update
                           
                              
                                 
                                    
                                       M
                                    
                                    
                                       H
                                    
                                 
                                 ≔
                                 
                                    min
                                 
                                 {
                                 
                                    
                                       M
                                    
                                    
                                       H
                                    
                                 
                                 ,
                                 
                                 
                                    max
                                 
                                 {
                                 
                                    
                                       I
                                    
                                    
                                       ∗
                                    
                                    
                                       ∗
                                       ,
                                       ∗
                                    
                                 
                                 }
                                 -
                                 
                                    min
                                 
                                 {
                                 
                                    
                                       A
                                    
                                    
                                       r
                                    
                                    
                                       s
                                    
                                 
                                 ,
                                 
                                    
                                       D
                                    
                                    
                                       r
                                    
                                    
                                       s
                                    
                                 
                                 }
                                 +
                                 
                                    max
                                 
                                 {
                                 
                                    
                                       
                                          
                                             A
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       r
                                    
                                    
                                       s
                                    
                                 
                                 ,
                                 
                                    
                                       
                                          
                                             D
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       r
                                    
                                    
                                       s
                                    
                                 
                                 }
                                 +
                                 
                                    
                                       I
                                    
                                    
                                       Flex
                                    
                                 
                                 }
                                 .
                              
                           
                        
                     

On the other hand, a proper value of the arbitrary large number 
                           
                              
                                 
                                    M
                                 
                                 
                                    I
                                 
                              
                           
                         concerning inconvenience is still unknown. The constraints (32)–(34), involving 
                           
                              
                                 
                                    M
                                 
                                 
                                    I
                                 
                              
                           
                         are of the form
                           
                              
                                 
                                    
                                       M
                                    
                                    
                                       I
                                    
                                 
                                 ⩾
                                 (amount of inconvenience on (partial) Route 1)
                                 -
                                 (amount of inconvenience on (partial) Route 2).
                              
                           
                        
                     

Consider here a route of a passenger on which his/her inconvenience will be maximized. When the waiting parameter value 
                           
                              α
                           
                         is bigger than one, the inconvenience will increase by waiting a train as long as possible. When 
                           
                              α
                              <
                              1
                           
                        , he/she will suffer more inconvenience by traveling on board as long as possible. The inconvenience to him/her will increase further if he/she transfers at every possible station and the transfer penalty 
                           
                              β
                           
                         is imposed. According to these observations, we decide the value of the arbitrary large number as follows:
                           
                              
                                 
                                    
                                       M
                                    
                                    
                                       I
                                    
                                 
                                 ≔
                                 
                                    max
                                 
                                 {
                                 α
                                 ,
                                 1
                                 }
                                 ×
                                 (
                                 
                                    max
                                 
                                 {
                                 
                                    
                                       
                                          
                                             A
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       r
                                    
                                    
                                       s
                                    
                                 
                                 ,
                                 
                                    
                                       
                                          
                                             D
                                          
                                          
                                             ^
                                          
                                       
                                    
                                    
                                       r
                                    
                                    
                                       s
                                    
                                 
                                 }
                                 +
                                 
                                    
                                       I
                                    
                                    
                                       Flex
                                    
                                 
                                 -
                                 
                                    min
                                 
                                 {
                                 
                                    
                                       A
                                    
                                    
                                       r
                                    
                                    
                                       s
                                    
                                 
                                 ,
                                 
                                    
                                       D
                                    
                                    
                                       r
                                    
                                    
                                       s
                                    
                                 
                                 }
                                 )
                                 +
                                 β
                                 ×
                                 ∣
                                 
                                    max
                                 
                                 {
                                 
                                    
                                       S
                                    
                                    
                                       Tra
                                       (
                                       b
                                       ,
                                       d
                                       )
                                    
                                 
                                 }
                                 ∣
                                 .
                              
                           
                        
                     

We finally solve 
                           
                              (
                              IMP
                              )
                           
                         and obtain a desired rescheduled timetable.

We implement our rescheduling algorithm and assess its effectiveness for two disruption cases; an arbitrary created timetable (case No. 1) and a weekend timetable of Chuo Line in Tokyo (case No. 2). Chuo Line has high frequency of train arrivals and departures which involve multiple types of trains in Japan, on which two express trains and five local trains are operated per 30min on average. The combinations of the inconvenience parameters 
                           
                              (
                              α
                              ,
                              β
                              )
                           
                         are 
                           
                              (
                              1
                              ,
                              1
                              )
                           
                         and 
                           
                              (
                              2
                              ,
                              10
                              )
                           
                         according to The Ministry of Land, Infrastructure, Transport and Tourism (2012). We solve 
                           
                              (
                              IMP
                              )
                           
                         as well as 
                           
                              (
                              DMP
                              )
                           
                         and compare solutions with each other for various values of the timetable flexibility parameter 
                           
                              
                                 
                                    I
                                 
                                 
                                    Flex
                                 
                              
                           
                        . The total inconvenience to passengers are decreased as 
                           
                              
                                 
                                    I
                                 
                                 
                                    Flex
                                 
                              
                           
                         gets bigger since the solution space is enlarged. On the other hand, the total amount of delays may be increased; some trains may dwell longer at a station to wait for extra passengers to come, for instance. The larger solution space also requires more computation time. The MIP problems are solved by Gurobi Optimizer 5.5.0 on a 64-bit Windows 7 PC having a Core i7-3930K CPU and 16GB RAM. We stop the MIP solver when it does not terminate in 1800s and output an incumbent solution.

Case No. 1 has five stations, ten westbound trains and eight Eastbound trains as displayed in the diagram of the planned timetable in Fig. 5
                        . The vertical dashed line is depicted for every 10min. The timetable is cyclic in which its cycle time is 20min. The bold and thin lines indicate express and local trains, respectively. The express trains stop at Stations A, C and E. These trains can overtake the local ones at any intermediate station though they do only at Station C in the planned timetable. Some of the trains turn back at the termini (e.g., Train 12 does at Station A and is next operated as Train 6). We deal with 569 different triplet 
                           
                              (
                              o
                              ,
                              d
                              ,
                              t
                              )
                           
                         in the timetable, i.e., a group of passengers who appear at station o at time t and travel to station d. Each passenger appears at his/her origin station 0–3min before the departure of a train which he/she plans to take. To this planned timetable, we input a delay of 30min on the departure of Train 2 from station A, and then solve 
                           
                              (
                              DMP
                              )
                           
                         and 
                           
                              (
                              IMP
                              )
                           
                        . We observe the solution for 
                           
                              (
                              DMP
                              )
                           
                         and how it is improved in terms of the inconvenience when each arrival/departure event is allowed to be further delayed for a maximum of one cycle time. We therefore take the positive diagram flexibility parameter values 
                           
                              
                                 
                                    I
                                 
                                 
                                    Flex
                                 
                              
                              =
                              5
                              ,
                              10
                              ,
                              15
                              ,
                              20
                           
                         (in minutes).


                        Fig. 5 also illustrates the optimal solutions for 
                           
                              (
                              DMP
                              )
                           
                         and 
                           
                              (
                              IMP
                              )
                           
                         with 
                           
                              (
                              α
                              ,
                              β
                              )
                              =
                              (
                              1
                              ,
                              1
                              )
                              ,
                              
                                 
                                    I
                                 
                                 
                                    Flex
                                 
                              
                              =
                              5
                              ,
                              10
                              ,
                              15
                              ,
                              20
                           
                        . In 
                           
                              (
                              DMP
                              )
                           
                        , Trains 3 and 4 run on the planned time by changing the tracks at which they dwell in Station A though Train 2 occupies one track for over 30min (the dashed diagonal lines indicate the planned timetable). Train 1 instead of the delayed Train 2 is next operated as Train 14 to reduce the propagation of the delay. Train 13 dwells longer and is overtaken at Station B since the delay does not affect its successor Train 9. The delay of Train 8 is decreased since its predecessor Train 14 overtakes Train 9. The most noticeable result is that Train 15 departs from its starting station later than Train 16 and that it is operated as an express train. The departure of Train 15 at Station E is much delayed since its predecessor is not Train 1 but Train 3, and the delay is recovered at Station B. This solution causes a long interval between the operation of two local Trains 13 and 17. Meanwhile in the solution for 
                           
                              (
                              IMP
                              )
                           
                         with 
                           
                              
                                 
                                    I
                                 
                                 
                                    Flex
                                 
                              
                              =
                              5
                           
                         (we have the same solution when 
                           
                              
                                 
                                    I
                                 
                                 
                                    Flex
                                 
                              
                              =
                              10
                           
                        ), the type of Train 15 is local to reduce the inconvenience to the passengers from Station E to Stations B and D. Note that Train 10 is slightly delayed and that the connection between Trains 9 and 10 is kept by delaying the departure of Train 9 from Station C. The delay of Train 10 is propagated by Train 16 and that of Train 16 is relevant to Train 15. These are observed on account of the flexibility parameter being still small; the departure time of local Train 15 from Station B must be within 5 or 10min delay from the solution for 
                           
                              (
                              DMP
                              )
                           
                        , which is equivalent to the planned departure time, and it causes its early departure from Station E. This propagation is resolved when we set 
                           
                              
                                 
                                    I
                                 
                                 
                                    Flex
                                 
                              
                              =
                              15
                           
                        . Train 15 is intentionally delayed for over 10min and Train 16 is operated on time. In the rescheduled timetable when 
                           
                              
                                 
                                    I
                                 
                                 
                                    Flex
                                 
                              
                              =
                              20
                           
                        , which is equal to the cycle time, Train 2 is virtually operated as Train 6 in the planned timetable. Similarly, other express Trains 6,8,14 and 16 are intentionally delayed for about 20min. Trains 10 and 18 are operated as the local trains. We have this result since the arbitrary created planned timetable is optimal with respect to the minimization of the inconvenience to the passengers in an undisrupted situation and the flexibility parameter is large enough for the trains to be delayed for one cycle time.

We show the solutions for 
                           
                              (
                              IMP
                              )
                           
                         when we set 
                           
                              (
                              α
                              ,
                              β
                              )
                              =
                              (
                              2
                              ,
                              10
                              )
                           
                         in Fig. 6
                        . We have the same solution for 
                           
                              
                                 
                                    I
                                 
                                 
                                    Flex
                                 
                              
                              =
                              5
                              ,
                              10
                           
                        . In this solution, Train 8 overtakes Train 7 at Station D while the change of the departure order is observed at Station C when 
                           
                              (
                              α
                              ,
                              β
                              )
                              =
                              (
                              1
                              ,
                              1
                              )
                           
                        . The passengers who are taking Train 7 and is going to Station E do not transfer to Train 8 at Station C since the waiting and transfer penalties are heavier. Hence the local train is prioritized at Station C. Although the train is overtaken at Station D in the end, its arrival time at Station E is 103, 1min earlier than that for 
                           
                              (
                              α
                              ,
                              β
                              )
                              =
                              (
                              1
                              ,
                              1
                              )
                           
                        , to carry the passengers who do not transfer at Station C earlier. Note that the algorithm does not stop in 1800s for 
                           
                              
                                 
                                    I
                                 
                                 
                                    Flex
                                 
                              
                              =
                              15
                              ,
                              20
                           
                         and the corresponding diagrams in Fig. 6 are incumbent solutions. When 
                           
                              
                                 
                                    I
                                 
                                 
                                    Flex
                                 
                              
                              =
                              15
                           
                        , we have a similar result to that for 
                           
                              (
                              α
                              ,
                              β
                              )
                              =
                              (
                              1
                              ,
                              1
                              )
                           
                        , except that Train 8 overtakes Train 7 at Station D. The incumbent solution for 
                           
                              
                                 
                                    I
                                 
                                 
                                    Flex
                                 
                              
                              =
                              20
                           
                         is the same as that when 
                           
                              (
                              α
                              ,
                              β
                              )
                              =
                              (
                              1
                              ,
                              1
                              )
                           
                         since the arbitrary created planned timetable is optimized for the distribution of the appearance of passengers.

In case No. 2 we deal with the actual timetable and the O–D data of Chuo Line. Fig. 7
                         shows the train operation between Tokyo and Tachikawa Stations, a part of the whole line, for 50min for each train direction in the daytime on the weekend. The bold lines indicate express trains called Special Rapid Trains and the thin lines are Rapid Trains. Special Rapid Trains can overtake the other trains at Mitaka and Kokubunji Stations. We have omitted several minor stations which do not affect the order of the trains. The behavior of 2108 different group of passengers 
                           
                              (
                              o
                              ,
                              d
                              ,
                              t
                              )
                           
                         are considered in this timetable. We input a delay of 15min on the departure of Train 102 from Higashi-Koganei Station. We set 
                           
                              
                                 
                                    I
                                 
                                 
                                    Flex
                                 
                              
                              =
                              1
                              ,
                              …
                              ,
                              5
                           
                         (in minutes).

The optimal solutions for 
                           
                              (
                              DMP
                              )
                           
                         and 
                           
                              (
                              IMP
                              )
                           
                         with 
                           
                              (
                              α
                              ,
                              β
                              )
                              =
                              (
                              1
                              ,
                              1
                              )
                              ,
                              
                                 
                                    I
                                 
                                 
                                    Flex
                                 
                              
                              =
                              2
                              ,
                              3
                              ,
                              5
                           
                         are also depicted in Fig. 7. The delay of Train 102 causes the consecutive delays of five Trains 104, 106, 204, 108 and 206 traveling in the same direction and four of their successor Trains 107, 203, 109 and 111. In the optimal solution for 
                           
                              (
                              DMP
                              )
                           
                        , Rapid Train 104 is not overtaken by Special Rapid Train 204 at Mitaka, although the latter has higher priority. The delay of Train 107, the successor of Train 104, is recovered by operating it as Special Rapid Train. We solve 
                           
                              (
                              IMP
                              )
                           
                         with 
                           
                              
                                 
                                    I
                                 
                                 
                                    Flex
                                 
                              
                              =
                              1
                           
                         and have the same departing order as that in the solution for 
                           
                              (
                              DMP
                              )
                           
                        . Several of the arrival and departure times of the trains are changed. For 
                           
                              
                                 
                                    I
                                 
                                 
                                    Flex
                                 
                              
                              =
                              2
                           
                         and 
                           
                              
                                 
                                    I
                                 
                                 
                                    Flex
                                 
                              
                              =
                              3
                           
                         (we have the same solution for the both parameter values), Train 204 overtakes Train 104. The departures of Trains 201, 103 and 105 from Tokyo are slightly delayed and the interval between the departures of Trains 105 and 203 is still over 10min due to the small parameter value. We have a similar result for 
                           
                              
                                 
                                    I
                                 
                                 
                                    Flex
                                 
                              
                              =
                              4
                           
                        . We observe proper departure intervals when we set 
                           
                              
                                 
                                    I
                                 
                                 
                                    Flex
                                 
                              
                              =
                              5
                           
                        . On the other hand, there are still two successive Special Rapid Trains departing from Tokyo. The departure time of Train 107 from Tokyo is the same in the optimal solutions for 
                           
                              (
                              DMP
                              )
                           
                         and 
                           
                              (
                              IMP
                              )
                           
                         with 
                           
                              
                                 
                                    I
                                 
                                 
                                    Flex
                                 
                              
                              =
                              5
                           
                        . It cannot be earlier due to the congested traffic around the crossing at the station. In the solution for 
                           
                              (
                              DMP
                              )
                           
                        , the Special Rapid Train runs from Tokyo to Higashi-Koganei in 28min. When any Rapid Train runs between the stations as fast as it can, it will take 34min at a minimum due to the minimum running time between each pair of stations and the minimum dwell time at every station. If Train 107 is operated as Rapid Train, the difference of the departure time from Higashi-Koganei will be 6min or more. This exceeds the value of 
                           
                              
                                 
                                    I
                                 
                                 
                                    Flex
                                 
                              
                           
                         and hence the train cannot be Rapid Train.

The optimal solutions of 
                           
                              (
                              IMP
                              )
                           
                         when we set 
                           
                              (
                              α
                              ,
                              β
                              )
                              =
                              (
                              2
                              ,
                              10
                              )
                           
                         are displayed in Fig. 8
                        . The diagram for 
                           
                              
                                 
                                    I
                                 
                                 
                                    Flex
                                 
                              
                              =
                              1
                           
                         is almost the same result as 
                           
                              (
                              DMP
                              )
                           
                        . The difference is that Train 105 is slightly delayed. When 
                           
                              
                                 
                                    I
                                 
                                 
                                    Flex
                                 
                              
                              =
                              2
                              ,
                              …
                              ,
                              5
                           
                        , the solutions are equivalent. The diagram is not so different from that for 
                           
                              
                                 
                                    I
                                 
                                 
                                    Flex
                                 
                              
                              =
                              1
                           
                        . Train 105 is delayed for one more minute between Nakano and Kokubunji to equalize the intervals among Train 103, Train 105 and the succeeding trains. It is, however, limited due to the arrival headway between Train 105 and Train 203 at Kokubunji. Train 204 does not overtake Train 104 at Mitaka, which is a different result from the solution when 
                           
                              (
                              α
                              ,
                              β
                              )
                              =
                              (
                              1
                              ,
                              1
                              )
                           
                         and 
                           
                              
                                 
                                    I
                                 
                                 
                                    Flex
                                 
                              
                              =
                              2
                           
                        . If the passengers who is taking Train 104 transfer to Train 204 at the station, they will reach Nakano, Shinjuku or Tokyo in at most 2min earlier. This is smaller than the value of 
                           
                              β
                              =
                              10
                           
                        .


                        Table 1
                         shows the objective function values of 
                           
                              (
                              DMP
                              )
                           
                         and 
                           
                              (
                              IMP
                              )
                           
                         as well as the MIP gap defined by 
                           
                              ((objective value)-(lower bound))
                              /
                              (lower bound)
                              ×
                              100
                           
                         and the computation time for each timetable case, MIP formulation, combination of the inconvenience parameter values, flexibility parameter value and pair of the large numbers in the formulation. We denote by “found” the elapsed time until the final incumbent solution is found, and by “proved” the time until the solution is proved to be optimal and then the algorithm stops. Note that the computation time of 
                           
                              (
                              IMP
                              )
                           
                         displayed in the table does not include that of 
                           
                              (
                              DMP
                              )
                           
                        , although the delay-minimized solutions are needed as a part of the inputs of 
                           
                              (
                              IMP
                              )
                           
                        .

As for the objective values, we see the tradeoff between the delay minimization and the inconvenience minimization on the whole. We have a better solution in terms of the inconvenience as we have more flexibility in a rescheduled timetable at the cost of further train delays. This is not true for the cases with 
                           
                              
                                 
                                    I
                                 
                                 
                                    Flex
                                 
                              
                              =
                              15
                           
                         in case No. 1, regardless of the values of the inconvenience parameters. The both objective values of the solutions are smaller than those of 
                           
                              (
                              IMP
                              )
                           
                         with 
                           
                              
                                 
                                    I
                                 
                                 
                                    Flex
                                 
                              
                              =
                              10
                           
                        . As displayed in Figs. 5 and 6, one train (Train 15) can be intentionally delayed to maintain the punctuality of the relevant trains (Trains 9, 10 and 16) in the larger solution space, and the delays are decreased in total. When the optimal order of trains in terms the inconvenience is different from that in the delay-minimized timetable, there are more chances of its reordering as we have more flexibility in arrival and departure times of the trains. Although the trains in the solutions with 
                           
                              
                                 
                                    I
                                 
                                 
                                    Flex
                                 
                              
                              =
                              20
                           
                         in case No. 1 seem to be heavily delayed in terms of the sum of train arrival delays, most of the passengers would see that the train which they take is punctual. The small objective values of 
                           
                              (
                              IMP
                              )
                           
                         for 
                           
                              (
                              α
                              ,
                              β
                              )
                              =
                              (
                              1
                              ,
                              1
                              )
                           
                         and 
                           
                              (
                              2
                              ,
                              10
                              )
                           
                         supports this. The total increased amount of inconvenience consists mainly of that to the passengers taking initially delayed Train 2 or its successor Train 14 in the planned timetable.

We next discuss the computation time required to solve the instances. In the both disruption cases, a feasible rescheduled timetable as a reference point is obtained immediately, i.e., 
                           
                              (
                              DMP
                              )
                           
                         is solved to optimality in a short time. The tradeoff between the inconvenience minimization and the computation time is observed in Table 1. The computation time of 
                           
                              (
                              IMP
                              )
                           
                         grows dramatically when the flexibility parameter value exceeds a certain threshold for each case and pair of the inconvenience parameters. For case No. 1 with 
                           
                              (
                              α
                              ,
                              β
                              )
                              =
                              (
                              2
                              ,
                              10
                              )
                              ,
                              
                                 
                                    I
                                 
                                 
                                    Flex
                                 
                              
                              =
                              15
                           
                         and 20, the optimal solutions are not obtained within the time limit we have introduced. Although the optimality gaps are large, the other instances tell us that a large part of the whole computation is spent on confirming the optimality of the solution. We have 
                           
                              
                                 
                                    z
                                 
                                 
                                    t
                                    ,
                                    r
                                 
                                 
                                    o
                                    ,
                                    d
                                 
                              
                           
                         for different 
                           
                              (
                              o
                              ,
                              d
                              ,
                              t
                              ,
                              r
                              )
                              ∈
                              
                                 
                                    S
                                 
                                 
                                    b
                                    <
                                 
                                 
                                    2
                                 
                              
                              ×
                              T
                              ×
                              
                                 
                                    R
                                 
                                 
                                    b
                                 
                              
                           
                         and the lower bounds obtained by the LP relaxation problems are weak from the inequalities (26), (34) and (35) as well as the objective function. In case No. 1 with the bigger inconvenience parameters, the large number 
                           
                              
                                 
                                    M
                                 
                                 
                                    I
                                 
                              
                           
                         also worsen the bounds. On the other hand, this is not observed in case No. 2 with the same set of the parameter values. Without the additional redundant constraints (36)–(38), (), (4), (5), (), (41) and (42), the proof of optimality in solving 
                           
                              (
                              IMP
                              )
                           
                         is intractable even when 
                           
                              
                                 
                                    I
                                 
                                 
                                    Flex
                                 
                              
                              =
                              5
                           
                         in case No. 1, since the constraints fix most of 
                           
                              
                                 
                                    z
                                 
                                 
                                    t
                                    ,
                                    r
                                 
                                 
                                    o
                                    ,
                                    d
                                 
                              
                           
                         when 
                           
                              
                                 
                                    ℓ
                                 
                                 
                                    r
                                    ,
                                    e
                                 
                              
                           
                         and 
                           
                              
                                 
                                    x
                                 
                                 
                                    
                                       
                                          r
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    
                                       
                                          r
                                       
                                       
                                          2
                                       
                                    
                                 
                                 
                                    s
                                 
                              
                           
                         take binary values in the branch-and-cut process.

We also assess the computation time depending on the amount of an initial delay. The required time for solving 
                           
                              (
                              DMP
                              )
                           
                         and 
                           
                              (
                              IMP
                              )
                           
                         for case No. 2 with 
                           
                              (
                              α
                              ,
                              β
                              )
                              =
                              (
                              1
                              ,
                              1
                              )
                           
                         with delays of 15, 20 or 25min are described in Table 2
                        . The last Train 113 runs on time even in the case of the delay of 25min, and therefore the values of 
                           
                              
                                 
                                    M
                                 
                                 
                                    H
                                 
                              
                              ,
                              
                                 
                                    M
                                 
                                 
                                    I
                                 
                              
                           
                         for 
                           
                              (
                              IMP
                              )
                           
                         are the same. Although 
                           
                              (
                              IMP
                              )
                           
                         itself for 
                           
                              
                                 
                                    I
                                 
                                 
                                    Flex
                                 
                              
                              =
                              1
                              ,
                              …
                              3
                           
                         is solved in real time, we should note that the solution space has been narrowed by solving 
                           
                              (
                              DMP
                              )
                           
                         in advance. The computation time required to solve 
                           
                              (
                              DMP
                              )
                           
                         grows dramatically as the amount of initial delays increases, and the overall rescheduling procedure also does. The inconvenience minimization does not terminate in 1800s when the amount of delay is 20 or 25min and 
                           
                              
                                 
                                    I
                                 
                                 
                                    Flex
                                 
                              
                              ⩾
                              4
                           
                        . The last incumbent solutions are obtained within 900s. The optimality gaps are small, a contrast to those for case No. 1 with 
                           
                              (
                              α
                              ,
                              β
                              )
                              =
                              (
                              2
                              ,
                              10
                              )
                           
                         in Table 1.

To summarize, small and proper values of the parameters are desired to balance passenger-oriented and real-time rescheduling in our rescheduling algorithm. The inconvenience-minimized timetable is obtained at the cost of the delay-minimization on the whole, though the algorithm does not necessarily provide a Pareto efficient point of the two objective values. When a disruption is large, it becomes harder to solve even 
                           
                              (
                              DMP
                              )
                           
                        . If another good feasible rescheduled timetable as a reference point is available in a short time of computation, then we can more or less improve it by applying 
                           
                              (
                              IMP
                              )
                           
                         within the rest of time which we can tackle the rescheduling.

@&#CONCLUSIONS@&#

In this paper we have proposed the MIP-based timetable rescheduling algorithm during the disruption which minimizes the sum of the positive difference between the inconvenience which each passenger suffers on his/her route in a rescheduled timetable and that in a planned timetable. Inconvenience of traveling by train has been defined as the weighted sum of the traveling time on board, the waiting time at platforms and the number of transfers. We have simultaneously modeled the train operation, each passenger’s behavior and the amount of inconvenience as the system of integer linear inequalities. We have realized the change of departing order of trains, the change of assignment of a track to trains in stations, the change of train types and the change of rolling stock operation schedules at termini as the countermeasures against the disruption. In the train operation constraints which include the problem of train capacities, we have covered all the types of minimum intervals required between the arrival and departure events considered in the previous PERT formulation. Each passenger has been assumed to take a train and transfer so that the inconvenience to him/her would be minimized, depending on the rescheduled train operation. We have first solved the arrival delay minimization problem and then optimized the timetable in terms of the inconvenience based on the delay-minimized timetable and the timetable flexibility parameter. Numerical experiments with both the arbitrary and the real data have indicated the tradeoff between the inconvenience minimization and the delay minimization or the computation time. We have obtained better rescheduled timetables in terms of customer satisfaction within practical time in the proper solution space.

Our future study aims to incorporate congestion of trains into the MIP model. It is one of the factors which form inconvenience to the passengers and sometimes brings another delay in Japan particularly when a lot of passengers rush into a train. We also need to reduce the overall computation time without restricting the solution space. Novel valid inequalities, including cutting planes, will improve the lower bound of the passenger-oriented objective function. When we extend the optimization on a single line to that on a large complex network, an optimal solution will not be obtained in real time. A (meta)heuristics-based algorithm will be a practical approach for such an instance. Even though we believe that the inconvenience-minimization should be prioritized to the delay-minimization, the latter can be an important criterion particularly when the precise passenger O–D data are not available. Hence we also have to conduct a deeper analysis of the tradeoff between the two indices.

@&#ACKNOWLEDGMENTS@&#

The authors thank two anonymous reviewers for their valuable comments on the earlier version of this paper. The third author is partly supported by the Ministry of Education, Science, Sports and Culture, Grant-in-Aid for Scientific Research (C) 24510199.

@&#REFERENCES@&#

