@&#MAIN-TITLE@&#Direct diffeomorphic reparameterization for correspondence optimization in statistical shape modeling

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           We propose an approach for optimizing shape correspondence across a population.


                        
                        
                           
                           B-splines are used for shape representation and reparameterization.


                        
                        
                           
                           The quality measure of the statistical shape model is the description length.


                        
                        
                           
                           An adjoint method for deriving analytical sensitivity is developed.


                        
                        
                           
                           The approach improves shape correspondence in a group-wise manner.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Statistical shape model

Shape correspondence

Direct reparameterization

Adjoint method

@&#ABSTRACT@&#


               
               
                  In this paper, we propose an efficient optimization approach for obtaining shape correspondence across a group of objects for statistical shape modeling. With each shape represented in a B-spline based parametric form, the correspondence across the shape population is cast as an issue of seeking a reparameterization for each shape so that a quality measure of the resulting shape correspondence across the group is optimized. The quality measure is the description length of the covariance matrix of the shape population, with landmarks sampled on each shape. The movement of landmarks on each B-spline shape is controlled by the reparameterization of the B-spline shape. The reparameterization itself is also represented with B-splines and B-spline coefficients are used as optimization parameters. We have developed formulations for ensuring the bijectivity of the reparameterization. A gradient-based optimization approach is developed, including techniques such as constraint aggregation and adjoint sensitivity for efficient, direct diffeomorphic reparameterization of landmarks to improve the group-wise shape correspondence. Numerical experiments on both synthetic and real 2D and 3D data sets demonstrate the efficiency and effectiveness of the proposed approach.
               
            

@&#INTRODUCTION@&#

A statistical shape model (SSM) provides a compact characterization of the shape variability in a set of shapes. It was initially used as a tool for facilitating automatic image segmentation  [1,2]. It has since seen many other applications including facial recognition  [3], computer animation  [4], medical diagnosis  [5,6], patient-specific modeling  [7–10] and human body modeling  [11], to name but a few. Finding correspondence across all shape instances is a fundamental task in building SSM. Manual identification of landmarks is effective under some circumstances but in general is not a reliable strategy since it tends to be subjective, time-consuming, error prone, and difficult to be applied in large scale data sets  [12]. Consequently, methods for automatically identifying the shape correspondence have been a major research focus in the field.

The automatic identification of the shape correspondence across a set of objects can be achieved by manipulating correspondence either in the object space or in the parameter space. Thus far, one of the most common approaches to achieving shape correspondence is through deforming in the object space a template shape to each shape instance in the training set, and the found pairwise correspondences are then propagated through the common template reference to form the group-wise correspondence. Group-wise registration has also been developed  [13]. In such a deformation based correspondence manipulation approach, the deformed landmarks may not actually lie on the object shape before the optimization convergence is achieved. Further, the deformation usually reduces to a problem where a “similarity” measure between the template and each shape instance is minimized and some regularization constraints are satisfied. Typically such a measure is related to geometric descriptors such as spatial distance and shape feature, and the optimization is essentially a rigid or non-rigid registration problem  [14–17]. However, these geometric descriptors and the regularization constraints are not necessarily a good basis for correspondence.

An alternative is to manipulate the correspondence through reparameterizing the shapes in the parameter space. For example, in  [18], objects of spherical topology are mapped to a sphere and correspondence is manipulated through concatenations of symmetric theta transformations on the spherical map. Reparameterization of shapes in the parameter space thus allows convenient manipulation of correspondence of surface points by simply changing point parameters. Reparameterized points always lie on the object shape during the optimization process. As such, the reparameterization lends itself to a more principled approach for establishing correspondence: optimizing the quality of the resulting statistical models. During the past few years, SSM quality measures have evolved from the model covariance trace  [19], to the model covariance determinant  [20], and finally to the Description Length (DL)  [18,21,22] and its simplification  [23] or variants  [24]. This information theoretic objective function of description length has shown to be an effective measure  [21] for the population-based correspondence optimization.

Although the population-based approach to shape correspondence does not require the pre-selection of a template and tends to provide a more faithful characterization of the variability pattern, this approach is still far from being widely used to build SSMs due to its low efficiency in identifying optimal correspondence across the shape population. In the minimum description length based group-wise correspondence optimization approach originated in  [21], the group-wise shape correspondence search consists of successive small-scale optimizations, each of which uses only a few optimization variables to relocate landmarks in a local region of each shape instance. In each optimization, only landmarks in local regions are moved. This necessitates a huge number of successive optimizations to manipulate all the landmarks, thus leading to inefficiency. Some researchers use analytical gradient formula whenever possible to speed up the gradient evaluation  [25,26]. However, in these implementations, the landmark positions in the training set shapes are non-differentiable with respect to optimization variables, the gradients are thus only partially analytical. In  [27], spline representation of 2D shapes is proposed so a full analytical gradient of reparameterization can be derived.

In our proposed approach, we cast shape correspondence as an issue of seeking optimal reparameterization 
                        
                           D
                        
                        
                           (
                           
                              u
                           
                           )
                        
                      of the parametric field 
                        
                           u
                        
                      of each shape so that a quality measure 
                        f
                      of the resulting shape correspondence across a group of objects is optimized. The reparameterization is applied to the parametric domain of parameterized curves or surfaces. Our SSM is based on the point-distribution model  [28]. In our approach, each landmark point 
                        
                           S
                        
                        
                           (
                           
                              u
                           
                           )
                        
                      in a given shape is changed to 
                        
                           S
                        
                        
                           (
                           
                              D
                           
                           
                              (
                              
                                 u
                              
                              )
                           
                           )
                        
                      in order to improve correspondence via the reparameterization 
                        
                           D
                        
                        
                           (
                           
                              u
                           
                           )
                        
                     . Our approach thus requires the parameterization of each shape, that is, every point 
                        
                           x
                        
                      of the shape in the physical space is mapped to a point 
                        
                           u
                        
                      in the parametric domain. In our implementation, we choose the B-spline representation 
                        
                           S
                        
                        
                           (
                           
                              u
                           
                           )
                        
                      of each shape instance, which can be reconstructed from triangular mesh representation of 3D objects. The parametric domain then undergoes a reparameterization represented via another tensor-product B-spline 
                        
                           D
                        
                        
                           (
                           
                              u
                           
                           )
                        
                      with B-spline coefficients 
                        
                           b
                        
                      as the optimization parameters. We choose the description length as the objective function of the shape correspondence.


                     Fig. 1
                      illustrates the proposed idea. A group of hand contours are shown in Fig. 1(a). Each shape is represented with B-splines, and Fig. 1(b) shows such a B-spline representation for one shape with control points and knots. Initially landmarks are uniformly sampled over the parameter domain of the B-spline shape 
                        
                           S
                        
                        
                           (
                           u
                           )
                        
                      as shown in Fig. 1(c). To change the landmark positions, reparameterization 
                        
                           D
                        
                        
                           (
                           u
                           )
                        
                      is applied to the parameter domain of each B-spline shape. This reparameterization is also represented with B-splines as shown in Fig. 1(d) where each red point represents a B-spline coefficient for the reparameterization. The landmarks are redistributed as shown in Fig. 1(e) after the reparameterization. The landmark redistribution can be seen from the four highlighted landmarks, where 
                        a
                        ,
                        b
                        ,
                        c
                        ,
                        d
                      moved to 
                        A
                        ,
                        B
                        ,
                        C
                        ,
                        D
                      respectively over the other side of the finger tips.

The salient feature of this approach is as follows: 
                        
                           •
                           
                              Diffeomorphic through B-splines. Existing technique  [18] for reparameterization concatenates a series of simple homeomorphic mappings. One optimization run with this reparameterization technique leads to the deformation of a local parametric region and it cannot provide any information on the search direction for subsequent local deformations in other regions. Therefore it requires the concatenation of a large number of simple mappings and causes severe inefficiency (see Section  5.1). Instead of concatenation of many local mappings, we propose the use of single B-spline function to directly represent the diffeomorphic reparameterization 
                                 
                                    D
                                 
                                 
                                    (
                                    
                                       u
                                    
                                    )
                                 
                               for the parameterization 
                                 
                                    u
                                 
                               of each shape instance 
                                 
                                    S
                                 
                                 
                                    (
                                    
                                       u
                                    
                                    )
                                 
                              . The injectivity for the reparameterization is guaranteed by enforcing the Jacobian positivity constraint.


                              Full differentiability of the objective function 
                              
                                 f
                               
                              (i.e. description length) with respect to reparameterization variables 
                              
                                 
                                    b
                                 
                              . The objective function 
                                 f
                               (i.e. description length) is a function of landmark positions. The landmark positions in each shape are differentiable with respect to reparameterization parameters 
                                 
                                    b
                                 
                               due to the parametric representation 
                                 
                                    S
                                 
                                 
                                    (
                                    
                                       u
                                    
                                    )
                                 
                               of each shape and diffeomorphic reparameterization 
                                 
                                    D
                                 
                                 
                                    (
                                    
                                       u
                                    
                                    )
                                 
                              . This ensures that the description length is fully differentiable with respect to the reparameterization variables 
                                 
                                    b
                                 
                              .


                              Constraint aggregation. The B-spline based diffeomorphic reparameterization leads to a large number of constraints on Jacobians for ensuring the mapping is bijective. In order to facilitate fast convergence in gradient-based optimization, a constraint aggregation technique is used where the large number of constraints are aggregated into one or a few constraints.


                              Adjoint method for computing sensitivity. The adjoint approach is used to compute the sensitivity of the objective function with respect to reparameterization parameters 
                                 
                                    b
                                 
                              , which is more efficient than direct differentiation of the objective function 
                                 f
                              . In computing the sensitivity of the description length w.r.t. optimization variables 
                                 
                                    b
                                 
                              , eigenvalues of the covariance matrix and their derivatives are needed. Since each eigenanalysis is expensive, the adjoint method is thus especially efficient for computing the sensitivity in this kind of optimization problems that have larger number of optimization variables and fewer functions (after constraint aggregation). In this adjoint method, the derivatives of a function w.r.t. a large number of optimization variables only involves one eigenanalysis of the covariance matrix. On the other hand, in the direct differentiation method, the number of eigenanalysis is the same as the number of optimization variables.

The remainder of this paper is organized as follows. Section  2 reviews the basic computing procedures in statistical shape modeling and the role of diffeomorphic reparameterization in SSM. Section  3 details our proposed approach on direct diffeomorphic reparameterization for shape correspondence. Section  4 presents the developed optimization techniques with experimental results in Section  5. This paper is concluded in Section  6.

In this section, we review the basic computing procedures in statistical shape modeling and the role of diffeomorphic reparameterization in SSM.

Statistical Shape Model was initially called Point Distribution Model (PDM)  [28], and it requires each shape instance in the training set be represented by a set of points, known as the landmarks   [19]. Regardless of the geometric form of the training set, landmarks are constrained to be on the boundary of a shape instance, and they form a point-based representation that approximates the original shape  [29]. The statistical modeling framework requires that the same number of landmarks sampled on all shapes across the training set.

Suppose a training set 
                        
                           {
                           
                              
                                 T
                              
                              
                                 i
                              
                           
                           }
                        
                        
                        
                           (
                           i
                           =
                           1
                           ,
                           2
                           ,
                           …
                           ,
                           
                              
                                 n
                              
                              
                                 S
                              
                           
                           )
                        
                      comprises 
                        
                           
                              n
                           
                           
                              S
                           
                        
                      shape instances and each is represented by 
                        
                           
                              n
                           
                           
                              P
                           
                        
                      landmarks. The 
                        j
                     -th landmark of the 
                        i
                     -th instance is 
                        
                           
                              
                                 x
                              
                           
                           
                              i
                           
                           
                              
                                 (
                                 j
                                 )
                              
                           
                        
                        =
                        
                           
                              
                                 [
                                 
                                    
                                       x
                                    
                                    
                                       
                                          (
                                          j
                                          )
                                       
                                    
                                 
                                 ,
                                 
                                    
                                       y
                                    
                                    
                                       
                                          (
                                          j
                                          )
                                       
                                    
                                 
                                 ,
                                 
                                    
                                       z
                                    
                                    
                                       
                                          (
                                          j
                                          )
                                       
                                    
                                 
                                 ]
                              
                           
                           
                              i
                           
                           
                              T
                           
                        
                        ∈
                        
                           
                              R
                           
                           
                              3
                           
                        
                     . Owing to the correspondence assumption of landmarks, all the 
                        
                           
                              n
                           
                           
                              S
                           
                        
                      landmarks 
                        
                           {
                           
                              
                                 
                                    x
                                 
                              
                              
                                 i
                              
                              
                                 
                                    (
                                    j
                                    )
                                 
                              
                           
                           }
                        
                        
                        
                           (
                           i
                           =
                           1
                           ,
                           2
                           ,
                           …
                           ,
                           
                              
                                 n
                              
                              
                                 S
                              
                           
                           )
                        
                      with label 
                        j
                      should correspond across all instances. The landmark representation of each instance is usually written into a concatenation of 
                        
                           
                              n
                           
                           
                              P
                           
                        
                      landmarks ordered by labels as a shape vector expression: 
                        
                           
                              
                                 
                                    
                                       x
                                    
                                 
                                 
                                    i
                                 
                              
                              ≐
                              
                                 
                                    
                                       [
                                       
                                          
                                             x
                                          
                                          
                                             i
                                          
                                          
                                             
                                                (
                                                1
                                                )
                                             
                                          
                                       
                                       ,
                                       
                                          
                                             y
                                          
                                          
                                             i
                                          
                                          
                                             
                                                (
                                                1
                                                )
                                             
                                          
                                       
                                       ,
                                       
                                          
                                             z
                                          
                                          
                                             i
                                          
                                          
                                             
                                                (
                                                1
                                                )
                                             
                                          
                                       
                                       ,
                                       
                                          
                                             x
                                          
                                          
                                             i
                                          
                                          
                                             
                                                (
                                                2
                                                )
                                             
                                          
                                       
                                       ,
                                       
                                          
                                             y
                                          
                                          
                                             i
                                          
                                          
                                             
                                                (
                                                2
                                                )
                                             
                                          
                                       
                                       ,
                                       
                                          
                                             z
                                          
                                          
                                             i
                                          
                                          
                                             
                                                (
                                                2
                                                )
                                             
                                          
                                       
                                       ,
                                       …
                                       ,
                                       
                                          
                                             x
                                          
                                          
                                             i
                                          
                                          
                                             
                                                (
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      P
                                                   
                                                
                                                )
                                             
                                          
                                       
                                       ,
                                       
                                          
                                             y
                                          
                                          
                                             i
                                          
                                          
                                             
                                                (
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      P
                                                   
                                                
                                                )
                                             
                                          
                                       
                                       ,
                                       
                                          
                                             z
                                          
                                          
                                             i
                                          
                                          
                                             
                                                (
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      P
                                                   
                                                
                                                )
                                             
                                          
                                       
                                       ]
                                    
                                 
                                 
                                    T
                                 
                              
                              .
                           
                        
                      All the 
                        
                           
                              n
                           
                           
                              S
                           
                        
                      shape vectors 
                        
                           {
                           
                              
                                 
                                    x
                                 
                              
                              
                                 i
                              
                           
                           }
                        
                      could be concatenated into a 
                        3
                        
                           
                              n
                           
                           
                              P
                           
                        
                        ×
                        
                           
                              n
                           
                           
                              S
                           
                        
                      shape vector matrix: 
                        
                           (1)
                           
                              
                                 
                                    
                                       X
                                    
                                 
                                 
                                    S
                                 
                              
                              ≐
                              
                                 [
                                 
                                    
                                       
                                          x
                                       
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       
                                          x
                                       
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    
                                       
                                          x
                                       
                                    
                                    
                                       
                                          
                                             n
                                          
                                          
                                             S
                                          
                                       
                                    
                                 
                                 ]
                              
                              .
                           
                        
                     
                  

In order to align a group of shapes stored in 
                        
                           
                              
                                 X
                              
                           
                           
                              S
                           
                        
                     , the Generalized Procrustes Analysis (GPA)  [30] operation is conducted, denoted by an alignment operator as below 
                        
                           (2)
                           
                              
                                 
                                    
                                       X
                                    
                                 
                                 
                                    A
                                 
                              
                              =
                              A
                              
                                 (
                                 
                                    
                                       
                                          X
                                       
                                    
                                    
                                       S
                                    
                                 
                                 )
                              
                              .
                           
                        
                      More specifically, the GPA of group-wise alignment is done by iteratively performing the pair-wise Procrustes Analysis (PA) between each shape and the mean. The PA brings a shape vector 
                        
                           x
                        
                      to a fixed shape vector 
                        
                           y
                        
                      by similarity transformation 
                        
                           
                              
                                 
                                    min
                                 
                                 
                                    
                                       t
                                    
                                    ,
                                    s
                                    ,
                                    
                                       R
                                    
                                 
                              
                              
                                 
                                    
                                       ‖
                                       
                                          y
                                       
                                       −
                                       s
                                       
                                          R
                                       
                                       
                                          (
                                          
                                             x
                                          
                                          −
                                          
                                             t
                                          
                                          )
                                       
                                       ‖
                                    
                                 
                                 
                                    2
                                 
                              
                              ≐
                              
                                 
                                    ∑
                                 
                                 
                                    j
                                    =
                                    1
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          P
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       ‖
                                       
                                          
                                             
                                                y
                                             
                                          
                                          
                                             
                                                (
                                                j
                                                )
                                             
                                          
                                       
                                       −
                                       s
                                       
                                          R
                                       
                                       
                                          (
                                          
                                             
                                                
                                                   x
                                                
                                             
                                             
                                                
                                                   (
                                                   j
                                                   )
                                                
                                             
                                          
                                          −
                                          
                                             t
                                          
                                          )
                                       
                                       ‖
                                    
                                 
                                 
                                    2
                                 
                              
                           
                        
                      where shape irrelevant factors including translation 
                        
                           t
                        
                     , scaling 
                        s
                      and rotation 
                        
                           R
                        
                      are removed. For more details in the iterative procedure, refer to Algorithm 2.1 in  [31].

If the training shapes are continuous and the 
                        i
                     -th shape is parameterized by the mapping 
                        
                           
                              
                                 S
                              
                           
                           
                              
                                 i
                              
                           
                        
                        
                           (
                           
                              u
                           
                           )
                        
                     , the continuous representation of the covariance matrix expressed in the 
                        
                           (
                           μ
                           ,
                           ν
                           )
                        
                     -th entry is 
                        
                           (3)
                           
                              
                                 
                                    
                                       E
                                    
                                 
                                 
                                    μ
                                    ν
                                 
                              
                              =
                              
                                 
                                    1
                                 
                                 
                                    
                                       (
                                       
                                          
                                             n
                                          
                                          
                                             S
                                          
                                       
                                       −
                                       1
                                       )
                                    
                                    A
                                 
                              
                              ∫
                              
                                 [
                                 
                                    
                                       
                                          S
                                       
                                    
                                    
                                       μ
                                    
                                 
                                 
                                    (
                                    
                                       u
                                    
                                    )
                                 
                                 −
                                 
                                    
                                       
                                          S
                                       
                                    
                                    
                                       ̄
                                    
                                 
                                 
                                    (
                                    
                                       u
                                    
                                    )
                                 
                                 ]
                              
                              ⋅
                              
                                 [
                                 
                                    
                                       
                                          S
                                       
                                    
                                    
                                       ν
                                    
                                 
                                 
                                    (
                                    
                                       u
                                    
                                    )
                                 
                                 −
                                 
                                    
                                       
                                          S
                                       
                                    
                                    
                                       ̄
                                    
                                 
                                 
                                    (
                                    
                                       u
                                    
                                    )
                                 
                                 ]
                              
                              
                                 d
                              
                              A
                              
                                 (
                                 
                                    u
                                 
                                 )
                              
                              ,
                           
                        
                      where 
                        
                           S
                        
                        
                           (
                           ⋅
                           )
                        
                      is the vector-valued function that defines the continuous representation of the 
                        i
                     -th shape by mapping the parameter space to the physical space. 
                        
                           
                              
                                 S
                              
                           
                           
                              ̄
                           
                        
                        
                           (
                           
                              u
                           
                           )
                        
                      is the mean shape defined as follows: 
                        
                           
                              
                                 
                                    
                                       S
                                    
                                 
                                 
                                    ̄
                                 
                              
                              
                                 (
                                 
                                    u
                                 
                                 )
                              
                              ≐
                              
                                 
                                    1
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          S
                                       
                                    
                                 
                              
                              
                                 
                                    ∑
                                 
                                 
                                    i
                                    =
                                    1
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          S
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       S
                                    
                                 
                                 
                                    i
                                 
                              
                              
                                 (
                                 
                                    u
                                 
                                 )
                              
                              .
                           
                        
                     
                     
                        A
                      is the surface area of the mean shape. For numerical implementation, the continuous covariance matrix is obtained via discretization through a set of discrete landmarks as 
                        
                           (4)
                           
                              
                                 
                                    
                                       E
                                    
                                 
                                 
                                    μ
                                    ν
                                 
                              
                              =
                              
                                 
                                    1
                                 
                                 
                                    
                                       (
                                       
                                          
                                             n
                                          
                                          
                                             S
                                          
                                       
                                       −
                                       1
                                       )
                                    
                                    
                                       
                                          n
                                       
                                       
                                          P
                                       
                                    
                                 
                              
                              
                                 
                                    ∑
                                 
                                 
                                    i
                                    =
                                    1
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          S
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       (
                                       
                                          
                                             
                                                x
                                             
                                          
                                          
                                             i
                                          
                                       
                                       −
                                       
                                          
                                             
                                                x
                                             
                                          
                                          
                                             ̄
                                          
                                       
                                       )
                                    
                                 
                                 
                                    μ
                                 
                              
                              
                                 
                                    
                                       (
                                       
                                          
                                             
                                                x
                                             
                                          
                                          
                                             i
                                          
                                       
                                       −
                                       
                                          
                                             
                                                x
                                             
                                          
                                          
                                             ̄
                                          
                                       
                                       )
                                    
                                 
                                 
                                    ν
                                 
                              
                           
                        
                      where on each shape the 
                        i
                     -th landmark 
                        
                           
                              
                                 x
                              
                           
                           
                              i
                           
                        
                      could be obtained as sampling at the 
                        i
                     -th parameter point 
                        
                           
                              
                                 u
                              
                           
                           
                              i
                           
                        
                     : i.e.  
                        
                           
                              
                                 x
                              
                           
                           
                              i
                           
                        
                        =
                        
                           S
                        
                        
                           (
                           
                              
                                 
                                    u
                                 
                              
                              
                                 i
                              
                           
                           )
                        
                     .

This could be written simply in a matrix form  [21]
                     
                        
                           (5)
                           
                              
                                 E
                              
                              =
                              
                                 
                                    1
                                 
                                 
                                    
                                       (
                                       
                                          
                                             n
                                          
                                          
                                             S
                                          
                                       
                                       −
                                       1
                                       )
                                    
                                    
                                       
                                          n
                                       
                                       
                                          P
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       X
                                    
                                 
                                 
                                    c
                                 
                                 
                                    T
                                 
                              
                              
                                 
                                    
                                       X
                                    
                                 
                                 
                                    c
                                 
                              
                              ,
                           
                        
                      where 
                        
                           
                              
                                 X
                              
                           
                           
                              c
                           
                        
                      is defined by 
                        
                           (6)
                           
                              
                                 
                                    
                                       X
                                    
                                 
                                 
                                    c
                                 
                              
                              ≐
                              
                                 [
                                 
                                    
                                       
                                          x
                                       
                                    
                                    
                                       1
                                    
                                    
                                       A
                                    
                                 
                                 −
                                 
                                    
                                       
                                          x
                                       
                                    
                                    
                                       ̄
                                    
                                 
                                 ,
                                 
                                    
                                       
                                          x
                                       
                                    
                                    
                                       2
                                    
                                    
                                       A
                                    
                                 
                                 −
                                 
                                    
                                       
                                          x
                                       
                                    
                                    
                                       ̄
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    
                                       
                                          x
                                       
                                    
                                    
                                       
                                          
                                             n
                                          
                                          
                                             S
                                          
                                       
                                    
                                    
                                       A
                                    
                                 
                                 −
                                 
                                    
                                       
                                          x
                                       
                                    
                                    
                                       ̄
                                    
                                 
                                 ]
                              
                              ,
                           
                        
                      and 
                        
                           
                              
                                 x
                              
                           
                           
                              i
                           
                           
                              A
                           
                        
                      is the 
                        i
                     -th shape vector after alignment operation 
                        A
                     , i.e. the component of 
                        
                           
                              
                                 X
                              
                           
                           
                              A
                           
                        
                      in (2); the mean shape vector of SSM is 
                        
                           (7)
                           
                              
                                 
                                    
                                       x
                                    
                                 
                                 
                                    ̄
                                 
                              
                              =
                              
                                 
                                    1
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          S
                                       
                                    
                                 
                              
                              
                                 
                                    ∑
                                 
                                 
                                    i
                                    =
                                    1
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          S
                                       
                                    
                                 
                              
                              
                                 
                                    
                                       x
                                    
                                 
                                 
                                    i
                                 
                                 
                                    A
                                 
                              
                              .
                           
                        
                     
                  

The Principal Component Analysis (PCA)  [32] is then conducted to extract the principal modes of shape variability via the eigenvalue decomposition of the covariance matrix 
                        
                           (8)
                           
                              
                                 E
                              
                              
                                 
                                    
                                       v
                                    
                                 
                                 
                                    m
                                 
                              
                              =
                              
                                 
                                    λ
                                 
                                 
                                    m
                                 
                              
                              
                                 
                                    
                                       v
                                    
                                 
                                 
                                    m
                                 
                              
                              
                              
                                 (
                                 m
                                 =
                                 1
                                 ,
                                 2
                                 ,
                                 …
                                 ,
                                 
                                    
                                       n
                                    
                                    
                                       S
                                    
                                 
                                 −
                                 1
                                 )
                              
                              ,
                           
                        
                      where 
                        
                           
                              
                                 v
                              
                           
                           
                              m
                           
                        
                      is the 
                        m
                     -th eigenvector and 
                        
                           
                              λ
                           
                           
                              m
                           
                        
                      the corresponding eigenvalue.

The mean shape 
                        
                           
                              
                                 x
                              
                           
                           
                              ̄
                           
                        
                     , modes 
                        
                           {
                           
                              
                                 
                                    v
                                 
                              
                              
                                 m
                              
                           
                           }
                        
                      and variances 
                        
                           {
                           
                              
                                 λ
                              
                              
                                 m
                              
                           
                           }
                        
                      ​constitute the statistical shape model. This statistical model is a much more compact representation of the shape variability pattern of the implied shape class than the original training set. What is more, it makes possible to represent any valid instance 
                        
                           x
                        
                      belonging to the shape class by a linear approximation using only the first 
                        
                           
                              m
                           
                           
                              ˜
                           
                        
                        
                        
                           (
                           
                              
                                 m
                              
                              
                                 ˜
                              
                           
                           ≤
                           
                              
                                 n
                              
                              
                                 S
                              
                           
                           −
                           1
                           )
                        
                      modes 
                        
                           (9)
                           
                              
                                 x
                              
                              ≈
                              
                                 
                                    
                                       x
                                    
                                 
                                 
                                    ̄
                                 
                              
                              +
                              
                                 
                                    ∑
                                 
                                 
                                    m
                                    =
                                    1
                                 
                                 
                                    
                                       
                                          m
                                       
                                       
                                          ˜
                                       
                                    
                                 
                              
                              
                                 
                                    β
                                 
                                 
                                    m
                                 
                              
                              
                                 
                                    
                                       v
                                    
                                 
                                 
                                    m
                                 
                              
                              ,
                           
                        
                      where the 
                        m
                     -th mode parameter is found by projection 
                        
                           (10)
                           
                              
                                 
                                    β
                                 
                                 
                                    m
                                 
                              
                              =
                              
                                 
                                    
                                       (
                                       
                                          x
                                       
                                       −
                                       
                                          
                                             
                                                x
                                             
                                          
                                          
                                             ̄
                                          
                                       
                                       )
                                    
                                 
                                 
                                    T
                                 
                              
                              
                                 
                                    
                                       v
                                    
                                 
                                 
                                    m
                                 
                              
                              .
                           
                        
                      The quality of the linear approximation has a great influence on the utility of the statistical model in subsequent applications, and it is evidently decided by the quality of the SSM, which is directly tied to the quality of the groupwise correspondence.

The PCA step defined by (5) and (8) is compactly written as 
                        
                           (11)
                           
                              
                                 λ
                              
                              =
                              C
                              
                                 (
                                 
                                    
                                       
                                          X
                                       
                                    
                                    
                                       A
                                    
                                 
                                 )
                              
                              .
                           
                        
                      The objective function of Description Length was originally derived by Davies in  [21] and elaborated in  [29]. A simplified version presented in  [23] defined as below is used in our correspondence optimization: 
                        
                           (12)
                           
                              f
                              ≐
                              
                                 
                                    ∑
                                 
                                 
                                    m
                                    =
                                    1
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          S
                                       
                                    
                                    −
                                    1
                                 
                              
                              
                                 
                                    L
                                 
                                 
                                    m
                                 
                              
                              ,
                           
                        
                      where each mode’s contribution is 
                        
                           
                              
                                 
                                    L
                                 
                                 
                                    m
                                 
                              
                              =
                              
                                 {
                                 
                                    
                                       
                                          1
                                          +
                                          log
                                          
                                             (
                                             
                                                
                                                   λ
                                                
                                                
                                                   m
                                                
                                             
                                             /
                                             
                                                
                                                   λ
                                                
                                                
                                                   
                                                      cut
                                                   
                                                
                                             
                                             )
                                          
                                       
                                       
                                          
                                             
                                                λ
                                             
                                             
                                                m
                                             
                                          
                                          ≥
                                          
                                             
                                                λ
                                             
                                             
                                                
                                                   cut
                                                
                                             
                                          
                                          ,
                                       
                                    
                                    
                                       
                                          
                                             
                                                λ
                                             
                                             
                                                m
                                             
                                          
                                          /
                                          
                                             
                                                λ
                                             
                                             
                                                
                                                   cut
                                                
                                             
                                          
                                       
                                       
                                          otherwise .
                                       
                                    
                                 
                              
                           
                        
                      The threshold 
                        
                           
                              λ
                           
                           
                              
                                 cut
                              
                           
                        
                      is determined by landmark resolution and shape scale 
                        
                           (13)
                           
                              
                                 
                                    λ
                                 
                                 
                                    
                                       cut
                                    
                                 
                              
                              =
                              
                                 
                                    2
                                    
                                    
                                       
                                          l
                                       
                                       
                                          
                                             min
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          r
                                       
                                       
                                          
                                             max
                                          
                                       
                                    
                                 
                              
                              ,
                           
                        
                      where 
                        
                           
                              l
                           
                           
                              
                                 min
                              
                           
                        
                      is the smallest edge length in the landmark-based representation and 
                        
                           
                              r
                           
                           
                              
                                 max
                              
                           
                        
                      is the radius of largest circumscribing sphere over training set shapes.

In this section, we present how B-splines can be used for representing reparameterization of parametric curves and surfaces and be used for manipulating shape correspondence. We show how such single direct reparameterization function differs from concatenations of multitude of simple mappings into one reparameterization function. We then show constraints for ensuring the B-spline based reparameterization is diffeomorphic.

Since our correspondence manipulation is based on reparameterization of parametric curves and surfaces, the training shapes must be in the form of parametric curves or surfaces. In this paper, we choose to use B-splines to represent the shapes. A B-spline curve of degree 
                        d
                      is defined by 
                        
                           
                              
                                 S
                              
                              
                                 (
                                 u
                                 )
                              
                              =
                              
                                 
                                    ∑
                                 
                                 
                                    k
                                    =
                                    0
                                 
                                 
                                    n
                                 
                              
                              
                                 
                                    B
                                 
                                 
                                    k
                                    ,
                                    d
                                 
                              
                              
                                 
                                    
                                       P
                                    
                                 
                                 
                                    k
                                 
                              
                              
                              0
                              ≤
                              u
                              ≤
                              1
                              ;
                           
                        
                      where 
                        
                           
                              B
                           
                           
                              k
                              ,
                              d
                           
                        
                      is the B-spline basis function  [33] of degree 
                        d
                      associated with the 
                        k
                     -th control points 
                        
                           
                              
                                 P
                              
                           
                           
                              k
                           
                        
                      recursively defined on a non-decreasing knot vector 
                        Ξ
                        =
                        
                           {
                           
                              
                                 
                                    
                                       ξ
                                    
                                    
                                       ̄
                                    
                                 
                              
                              
                                 0
                              
                           
                           ,
                           
                           
                              
                                 
                                    
                                       ξ
                                    
                                    
                                       ̄
                                    
                                 
                              
                              
                                 1
                              
                           
                           ,
                           …
                           ,
                           
                              
                                 
                                    
                                       ξ
                                    
                                    
                                       ̄
                                    
                                 
                              
                              
                                 n
                                 +
                                 d
                                 +
                                 1
                              
                           
                           }
                        
                      as 
                        
                           (14)
                           
                              
                                 
                                    
                                       B
                                    
                                    
                                       k
                                       ,
                                       d
                                    
                                 
                                 
                                    (
                                    u
                                    )
                                 
                                 =
                                 
                                    
                                       
                                          (
                                          u
                                          −
                                          
                                             
                                                
                                                   
                                                      ξ
                                                   
                                                   
                                                      ̄
                                                   
                                                
                                             
                                             
                                                i
                                             
                                          
                                          )
                                       
                                       
                                          
                                             B
                                          
                                          
                                             k
                                             ,
                                             d
                                             −
                                             1
                                          
                                       
                                       
                                          (
                                          u
                                          )
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   ξ
                                                
                                                
                                                   ̄
                                                
                                             
                                          
                                          
                                             k
                                             +
                                             d
                                          
                                       
                                       −
                                       
                                          
                                             
                                                
                                                   ξ
                                                
                                                
                                                   ̄
                                                
                                             
                                          
                                          
                                             k
                                          
                                       
                                    
                                 
                                 +
                                 
                                    
                                       
                                          (
                                          
                                             
                                                
                                                   
                                                      ξ
                                                   
                                                   
                                                      ̄
                                                   
                                                
                                             
                                             
                                                k
                                                +
                                                d
                                                +
                                                1
                                             
                                          
                                          −
                                          u
                                          )
                                       
                                       
                                          
                                             B
                                          
                                          
                                             k
                                             +
                                             1
                                             ,
                                             d
                                             −
                                             1
                                          
                                       
                                       
                                          (
                                          u
                                          )
                                       
                                    
                                    
                                       
                                          
                                             
                                                
                                                   ξ
                                                
                                                
                                                   ̄
                                                
                                             
                                          
                                          
                                             k
                                             +
                                             d
                                             +
                                             1
                                          
                                       
                                       −
                                       
                                          
                                             
                                                
                                                   ξ
                                                
                                                
                                                   ̄
                                                
                                             
                                          
                                          
                                             k
                                             +
                                             1
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                           
                              
                                 
                                    
                                       B
                                    
                                    
                                       k
                                       ,
                                       0
                                    
                                 
                                 
                                    (
                                    u
                                    )
                                 
                                 =
                                 
                                    {
                                    
                                       
                                          
                                             1
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         ξ
                                                      
                                                      
                                                         ̄
                                                      
                                                   
                                                
                                                
                                                   k
                                                
                                             
                                             ≤
                                             u
                                             ≤
                                             
                                                
                                                   
                                                      
                                                         ξ
                                                      
                                                      
                                                         ̄
                                                      
                                                   
                                                
                                                
                                                   k
                                                   +
                                                   1
                                                
                                             
                                             ,
                                          
                                       
                                       
                                          
                                             0
                                          
                                          
                                             otherwise .
                                          
                                       
                                    
                                 
                              
                           
                        
                      A B-spline surface of degree 
                        d
                      and 
                        e
                      is defined by 
                        
                           
                              
                                 S
                              
                              
                                 (
                                 u
                                 ,
                                 v
                                 )
                              
                              =
                              
                                 
                                    ∑
                                 
                                 
                                    k
                                    =
                                    0
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          u
                                       
                                    
                                 
                              
                              
                                 
                                    ∑
                                 
                                 
                                    l
                                    =
                                    0
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          v
                                       
                                    
                                 
                              
                              
                                 
                                    B
                                 
                                 
                                    k
                                    ,
                                    d
                                 
                              
                              
                                 
                                    B
                                 
                                 
                                    l
                                    ,
                                    e
                                 
                              
                              
                                 
                                    
                                       P
                                    
                                 
                                 
                                    k
                                    ,
                                    l
                                 
                              
                              
                              0
                              ≤
                              u
                              ≤
                              1
                              ,
                              
                              0
                              ≤
                              v
                              ≤
                              1
                              ;
                           
                        
                      where 
                        
                           
                              B
                           
                           
                              k
                              ,
                              d
                           
                        
                      and 
                        
                           
                              B
                           
                           
                              l
                              ,
                              e
                           
                        
                      following the basis definition in (14) is associated with the 
                        
                           (
                           k
                           ,
                           l
                           )
                        
                     -th control point 
                        
                           
                              
                                 P
                              
                           
                           
                              k
                              ,
                              l
                           
                        
                     , and the knot vectors along the two parametric directions are 
                        Ξ
                        =
                        
                           {
                           
                              
                                 
                                    
                                       ξ
                                    
                                    
                                       ̄
                                    
                                 
                              
                              
                                 0
                              
                           
                           ,
                           
                           
                              
                                 
                                    
                                       ξ
                                    
                                    
                                       ̄
                                    
                                 
                              
                              
                                 1
                              
                           
                           ,
                           …
                           ,
                           
                              
                                 
                                    
                                       ξ
                                    
                                    
                                       ̄
                                    
                                 
                              
                              
                                 
                                    
                                       n
                                    
                                    
                                       u
                                    
                                 
                                 +
                                 d
                                 +
                                 1
                              
                           
                           }
                        
                      and 
                        
                           H
                        
                        =
                        
                           {
                           
                              
                                 
                                    
                                       η
                                    
                                    
                                       ̄
                                    
                                 
                              
                              
                                 0
                              
                           
                           ,
                           
                              
                                 
                                    
                                       η
                                    
                                    
                                       ̄
                                    
                                 
                              
                              
                                 1
                              
                           
                           ,
                           …
                           ,
                           
                              
                                 
                                    
                                       η
                                    
                                    
                                       ̄
                                    
                                 
                              
                              
                                 
                                    
                                       n
                                    
                                    
                                       v
                                    
                                 
                                 +
                                 e
                                 +
                                 1
                              
                           
                           }
                        
                     .

We show below how B-splines can also be used for representing the reparameterization of parametric curves and surfaces.


                           Fig. 2
                            shows the reparameterization of a 2D curve where points sampled on 
                              u
                            have been moved to 
                              D
                              
                                 (
                                 u
                                 )
                              
                           . Such a reparameterization function 
                              D
                              
                                 (
                                 u
                                 )
                              
                            can be represented with the concatenation of simple mappings. For example, the reparameterization function 
                              D
                              
                                 (
                                 u
                                 )
                              
                            shown in Fig. 2 is represented in Fig. 3
                           (a) with 4 Cauchy kernels (centered at 
                              
                                 
                                    
                                       c
                                    
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    
                                       c
                                    
                                 
                                 
                                    2
                                 
                              
                              ,
                              
                                 
                                    
                                       c
                                    
                                 
                                 
                                    3
                                 
                              
                              ,
                              
                                 
                                    
                                       c
                                    
                                 
                                 
                                    4
                                 
                              
                           ) which are sequentially superimposed and integrated into 
                              D
                              
                                 (
                                 u
                                 )
                              
                            as proposed by  [29]; see Appendix I for details regarding Cauchy kernel and its concatenation.

In this paper, we propose to directly represent 
                              D
                              
                                 (
                                 u
                                 )
                              
                            as a single B-spline function as shown in Fig. 3(b) where empty circles represent B-spline coefficients 
                              
                                 {
                                 
                                    
                                       b
                                    
                                    
                                       i
                                    
                                 
                                 }
                              
                           . The reparameterization function 
                              D
                              
                                 (
                                 u
                                 )
                              
                            for a parametric curve can be represented by a B-spline with 
                              
                                 
                                    n
                                 
                                 
                                    b
                                 
                              
                            coefficients
                              
                                 (15)
                                 
                                    D
                                    
                                       (
                                       u
                                       )
                                    
                                    =
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          0
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                b
                                             
                                          
                                          −
                                          1
                                       
                                    
                                    
                                       
                                          B
                                       
                                       
                                          i
                                          ,
                                          p
                                       
                                    
                                    
                                       (
                                       u
                                       )
                                    
                                    
                                       
                                          b
                                       
                                       
                                          i
                                       
                                    
                                    ,
                                    
                                    0
                                    ≤
                                    u
                                    ≤
                                    1
                                    ;
                                 
                              
                            where 
                              
                                 
                                    B
                                 
                                 
                                    i
                                    ,
                                    p
                                 
                              
                            is the B-spline basis function  [33] of degree 
                              p
                            associated with the 
                              i
                           -th B-spline coefficient 
                              
                                 
                                    b
                                 
                                 
                                    i
                                 
                              
                           , and it is recursively defined on a non-decreasing knot vector 
                              
                                 U
                              
                              =
                              
                                 {
                                 
                                    
                                       
                                          
                                             u
                                          
                                          
                                             ̄
                                          
                                       
                                    
                                    
                                       0
                                    
                                 
                                 ,
                                 
                                 
                                    
                                       
                                          
                                             u
                                          
                                          
                                             ̄
                                          
                                       
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    
                                       
                                          
                                             u
                                          
                                          
                                             ̄
                                          
                                       
                                    
                                    
                                       n
                                       +
                                       p
                                       +
                                       1
                                    
                                 
                                 }
                              
                           .

We assume that the starting and ending points of all curves are already in correspondence. With this assumption, the boundary of the parameter domain (two ends at 
                              u
                              =
                              0
                              ,
                              1
                           ) is fixed even with the reparameterization function. Therefore, we use a clamped knot vector (i.e. repeating the first 
                              
                                 (
                                 p
                                 +
                                 1
                                 )
                              
                            and last 
                              
                                 (
                                 p
                                 +
                                 1
                                 )
                              
                            knots) and 
                              
                                 
                                    b
                                 
                                 
                                    0
                                 
                              
                              =
                              0
                           , 
                              
                                 
                                    b
                                 
                                 
                                    n
                                 
                              
                              =
                              1
                            for representing the reparameterization so that 
                              D
                              
                                 (
                                 0
                                 )
                              
                              =
                              0
                            and 
                              D
                              
                                 (
                                 1
                                 )
                              
                              =
                              1
                           .

A reparameterization of a 3D surface is illustrated in Fig. 4
                           , where cubes and spheres respectively represent two sampled points before and after the reparameterization. Since a 3D surface 
                              
                                 S
                              
                              
                                 (
                                 
                                    u
                                 
                                 )
                              
                              =
                              
                                 [
                                 x
                                 
                                    (
                                    
                                       u
                                    
                                    )
                                 
                                 ,
                                 y
                                 
                                    (
                                    
                                       u
                                    
                                    )
                                 
                                 ,
                                 z
                                 
                                    (
                                    
                                       u
                                    
                                    )
                                 
                                 ]
                              
                            is mapped to a 2D parametric domain, i.e. 
                              
                                 u
                              
                              =
                              
                                 (
                                 u
                                 ,
                                 v
                                 )
                              
                           , the reparameterization 
                              
                                 D
                              
                              
                                 (
                                 
                                    u
                                 
                                 )
                              
                            for 3D surfaces 
                              
                                 S
                              
                              
                                 (
                                 
                                    u
                                 
                                 )
                              
                            ​has two components in 
                              u
                            and 
                              v
                            directions 
                              
                                 D
                              
                              
                                 (
                                 
                                    u
                                 
                                 )
                              
                              =
                              
                                 [
                                 
                                    
                                       D
                                    
                                    
                                       u
                                    
                                 
                                 
                                    (
                                    u
                                    ,
                                    v
                                    )
                                 
                                 ,
                                 
                                    
                                       D
                                    
                                    
                                       v
                                    
                                 
                                 
                                    (
                                    u
                                    ,
                                    v
                                    )
                                 
                                 ]
                              
                           . This reparameterization function could also be visualized by a vector field in Fig. 4(c), and its parametric grid is shown in Fig. 4(d).

Such a reparameterization field can be represented by the concatenation of simple mappings. For example, two Clamped Plate Spline (CPS) warps  [29] are applied sequentially in the parameter domain shown in Fig. 5
                           (a) and (b). These two CPS warps are with centers 
                              
                                 
                                    
                                       c
                                    
                                 
                                 
                                    1
                                 
                              
                            and 
                              
                                 
                                    
                                       c
                                    
                                 
                                 
                                    2
                                 
                              
                            and red dotted circles as the CPS range. See Appendix II for details on CPS warps.

Instead of using concatenation of simple mappings, we propose the use of single B-spline functions to directly represent the reparameterization of 
                              u
                            and 
                              v
                            ​components of the parametric domain, as shown in Fig. 5(c) where 
                              8
                              ×
                              8
                            B-spline coefficients 
                              
                                 
                                    b
                                 
                                 
                                    i
                                 
                              
                            (red circles) are used to represent the reparameterization field 
                              
                                 D
                              
                              
                                 (
                                 
                                    u
                                 
                                 )
                              
                           . In general, the reparameterization 
                              
                                 D
                              
                              
                                 (
                                 
                                    u
                                 
                                 )
                              
                              =
                              
                                 [
                                 
                                    
                                       D
                                    
                                    
                                       u
                                    
                                 
                                 
                                    (
                                    u
                                    ,
                                    v
                                    )
                                 
                                 ,
                                 
                                    
                                       D
                                    
                                    
                                       v
                                    
                                 
                                 
                                    (
                                    u
                                    ,
                                    v
                                    )
                                 
                                 ]
                              
                            in the square planar parameter domain is defined as 
                              
                                 (16)
                                 
                                    
                                       
                                          
                                             D
                                          
                                          
                                             u
                                          
                                       
                                       
                                          (
                                          u
                                          ,
                                          v
                                          )
                                       
                                       =
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                             =
                                             0
                                          
                                          
                                             
                                                
                                                   n
                                                
                                                
                                                   b
                                                   1
                                                
                                             
                                             −
                                             1
                                          
                                       
                                       
                                          
                                             ∑
                                          
                                          
                                             j
                                             =
                                             0
                                          
                                          
                                             
                                                
                                                   n
                                                
                                                
                                                   b
                                                   2
                                                
                                             
                                             −
                                             1
                                          
                                       
                                       
                                          
                                             B
                                          
                                          
                                             i
                                             ,
                                             p
                                          
                                       
                                       
                                          (
                                          u
                                          )
                                       
                                       
                                          
                                             B
                                          
                                          
                                             j
                                             ,
                                             q
                                          
                                       
                                       
                                          (
                                          v
                                          )
                                       
                                       
                                          
                                             b
                                          
                                          
                                             i
                                             ,
                                             j
                                          
                                          
                                             u
                                          
                                       
                                       ,
                                    
                                 
                                 
                                    
                                       
                                          
                                             D
                                          
                                          
                                             v
                                          
                                       
                                       
                                          (
                                          u
                                          ,
                                          v
                                          )
                                       
                                       =
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                             =
                                             0
                                          
                                          
                                             
                                                
                                                   n
                                                
                                                
                                                   b
                                                   1
                                                
                                             
                                             −
                                             1
                                          
                                       
                                       
                                          
                                             ∑
                                          
                                          
                                             j
                                             =
                                             0
                                          
                                          
                                             
                                                
                                                   n
                                                
                                                
                                                   b
                                                   2
                                                
                                             
                                             −
                                             1
                                          
                                       
                                       
                                          
                                             B
                                          
                                          
                                             i
                                             ,
                                             p
                                          
                                       
                                       
                                          (
                                          u
                                          )
                                       
                                       
                                          
                                             B
                                          
                                          
                                             j
                                             ,
                                             q
                                          
                                       
                                       
                                          (
                                          v
                                          )
                                       
                                       
                                          
                                             b
                                          
                                          
                                             i
                                             ,
                                             j
                                          
                                          
                                             v
                                          
                                       
                                       ,
                                    
                                 
                                 
                                    
                                       0
                                       ≤
                                       u
                                       ,
                                       
                                       v
                                       ≤
                                       1
                                       ;
                                    
                                 
                              
                            where 
                              
                                 
                                    B
                                 
                                 
                                    i
                                    ,
                                    p
                                 
                              
                            and 
                              
                                 
                                    B
                                 
                                 
                                    j
                                    ,
                                    q
                                 
                              
                            are the B-spline basis functions (14) of degree 
                              p
                            and 
                              q
                            associated with the 
                              
                                 (
                                 i
                                 ,
                                 j
                                 )
                              
                           -th B-spline coefficient 2-tuple 
                              
                                 
                                    
                                       b
                                    
                                 
                                 
                                    i
                                    ,
                                    j
                                 
                              
                              =
                              
                                 (
                                 
                                    
                                       b
                                    
                                    
                                       i
                                       ,
                                       j
                                    
                                    
                                       u
                                    
                                 
                                 ,
                                 
                                    
                                       b
                                    
                                    
                                       i
                                       ,
                                       j
                                    
                                    
                                       v
                                    
                                 
                                 )
                              
                           ; the coefficient number along the 
                              u
                           - and 
                              v
                           -direction are 
                              
                                 
                                    n
                                 
                                 
                                    b
                                    1
                                 
                              
                            and 
                              
                                 
                                    n
                                 
                                 
                                    b
                                    2
                                 
                              
                            respectively. They are respectively defined on two sets of non-decreasing knot vectors 
                              
                                 
                                    
                                       U
                                    
                                 
                                 
                                    1
                                 
                              
                            and 
                              
                                 
                                    
                                       U
                                    
                                 
                                 
                                    2
                                 
                              
                           .

The four boundaries of all the shapes are assumed to be in correspondence already. With this assumption, the four boundaries of the square parametric domain are fixed during reparameterization, i.e.
                              
                                 (17)
                                 
                                    
                                       
                                          
                                             D
                                          
                                          
                                             u
                                          
                                       
                                       
                                          (
                                          0
                                          ,
                                          v
                                          )
                                       
                                       =
                                       0
                                       ,
                                       
                                       
                                          
                                             D
                                          
                                          
                                             u
                                          
                                       
                                       
                                          (
                                          1
                                          ,
                                          v
                                          )
                                       
                                       =
                                       1
                                       ,
                                    
                                 
                                 
                                    
                                       
                                          
                                             D
                                          
                                          
                                             v
                                          
                                       
                                       
                                          (
                                          u
                                          ,
                                          0
                                          )
                                       
                                       =
                                       0
                                       ,
                                       
                                       
                                          
                                             D
                                          
                                          
                                             v
                                          
                                       
                                       
                                          (
                                          u
                                          ,
                                          1
                                          )
                                       
                                       =
                                       1
                                       .
                                    
                                 
                              
                           
                        

Therefore, the two knot vectors are chosen to be of clamped type and the B-spline coefficients at the four boundaries are either 0 or 1.

Setting 
                              
                                 d
                              
                              D
                              
                                 (
                                 u
                                 )
                              
                              /
                              
                                 d
                              
                              u
                              >
                              0
                            in (15) gives the bijectivity constraint for diffeomorphic reparameterization of curves for correspondence manipulation. Since 
                              D
                              
                                 (
                                 u
                                 )
                              
                            is a degree-
                              p
                            B-spline function, its derivative is a degree-
                              
                                 (
                                 p
                                 −
                                 1
                                 )
                              
                            B-spline function with 
                              
                                 
                                    b
                                 
                                 
                                    i
                                    +
                                    1
                                 
                              
                              −
                              
                                 
                                    b
                                 
                                 
                                    i
                                 
                              
                            as B-spline coefficients  [34], we thus have the following explicit constraint for ensuring diffeomorphic reparameterization of curves
                              
                                 (18)
                                 
                                    
                                       
                                          b
                                       
                                       
                                          i
                                       
                                    
                                    −
                                    
                                       
                                          b
                                       
                                       
                                          i
                                          +
                                          1
                                       
                                    
                                    <
                                    0
                                    ,
                                    
                                    i
                                    =
                                    0
                                    ,
                                    1
                                    ,
                                    …
                                    ,
                                    
                                       
                                          n
                                       
                                       
                                          b
                                       
                                    
                                    −
                                    2
                                    .
                                 
                              
                           
                        

The bijectivity of reparameterization can be guaranteed by the positivity of Jacobian throughout the parameter domain, i.e.  
                              
                                 (19)
                                 
                                    J
                                    
                                       (
                                       
                                          D
                                       
                                       
                                          (
                                          
                                             u
                                          
                                          )
                                       
                                       )
                                    
                                    =
                                    
                                       |
                                       
                                          
                                             
                                                
                                                   
                                                      ∂
                                                      
                                                         
                                                            D
                                                         
                                                         
                                                            u
                                                         
                                                      
                                                      
                                                         (
                                                         u
                                                         ,
                                                         v
                                                         )
                                                      
                                                   
                                                   
                                                      ∂
                                                      u
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      ∂
                                                      
                                                         
                                                            D
                                                         
                                                         
                                                            u
                                                         
                                                      
                                                      
                                                         (
                                                         u
                                                         ,
                                                         v
                                                         )
                                                      
                                                   
                                                   
                                                      ∂
                                                      v
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      ∂
                                                      
                                                         
                                                            D
                                                         
                                                         
                                                            v
                                                         
                                                      
                                                      
                                                         (
                                                         u
                                                         ,
                                                         v
                                                         )
                                                      
                                                   
                                                   
                                                      ∂
                                                      u
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      ∂
                                                      
                                                         
                                                            D
                                                         
                                                         
                                                            v
                                                         
                                                      
                                                      
                                                         (
                                                         u
                                                         ,
                                                         v
                                                         )
                                                      
                                                   
                                                   
                                                      ∂
                                                      v
                                                   
                                                
                                             
                                          
                                       
                                       |
                                    
                                    >
                                    0
                                    ,
                                    
                                    ∀
                                    
                                       (
                                       u
                                       ,
                                       v
                                       )
                                    
                                    ∈
                                    
                                       [
                                       0
                                       ,
                                       1
                                       ]
                                    
                                    .
                                 
                              
                           
                        

Assuming there are 
                              
                                 
                                    n
                                 
                                 
                                    b
                                    1
                                 
                              
                              ×
                              
                                 
                                    n
                                 
                                 
                                    b
                                    2
                                 
                              
                            B-spline coefficient tuples 
                              
                                 
                                    
                                       b
                                    
                                 
                                 
                                    
                                       i
                                    
                                    ,
                                    
                                       j
                                    
                                 
                              
                            for representing the reparameterization in (16). Due to the boundary constraint (17), there are only 
                              
                                 (
                                 
                                    
                                       n
                                    
                                    
                                       b
                                       1
                                    
                                 
                                 −
                                 2
                                 )
                              
                              ×
                              
                                 (
                                 
                                    
                                       n
                                    
                                    
                                       b
                                       2
                                    
                                 
                                 −
                                 2
                                 )
                              
                            interior coefficients 
                              
                                 
                                    
                                       b
                                    
                                 
                                 
                                    i
                                    ,
                                    j
                                 
                              
                            that can be used to manipulate correspondence for each shape. Consequently, there are 
                              2
                              ×
                              
                                 (
                                 
                                    
                                       n
                                    
                                    
                                       S
                                    
                                 
                                 −
                                 1
                                 )
                              
                              ×
                              
                                 (
                                 
                                    
                                       n
                                    
                                    
                                       b
                                       1
                                    
                                 
                                 −
                                 2
                                 )
                              
                              ×
                              
                                 (
                                 
                                    
                                       n
                                    
                                    
                                       b
                                       2
                                    
                                 
                                 −
                                 2
                                 )
                              
                            optimization variables for 
                              
                                 
                                    n
                                 
                                 
                                    S
                                 
                              
                            shapes. To ensure the reparameterization 
                              
                                 D
                              
                              
                                 (
                                 
                                    u
                                 
                                 )
                              
                            is diffeomorphic, the bijectivity condition (19) that prevents the self-intersection of the parametric field can be cast as constraints on the reparameterization parameters, i.e. interior B-spline coefficient tuples 
                              
                                 
                                    
                                       b
                                    
                                 
                                 
                                    i
                                    ,
                                    j
                                 
                              
                           .


                           Diffeomorphism via constraints in the B-spline form of Jacobian. We give below a sufficient condition for ensuring the Jacobian field 
                              J
                              
                                 (
                                 
                                    u
                                 
                                 )
                              
                           
                           (19) is positive so that the reparameterization 
                              
                                 D
                              
                              
                                 (
                                 
                                    u
                                 
                                 )
                              
                            is diffeomorphic. The scalar Jacobian field 
                              J
                              
                                 (
                                 
                                    u
                                 
                                 )
                              
                            defined in (19) for the B-spline based reparameterization (16) consists of derivatives of B-splines (piecewise polynomials) and thus remains piecewise polynomials. Therefore, 
                              J
                              
                                 (
                                 
                                    u
                                 
                                 )
                              
                            itself can be cast in the B-spline form as described in  [35,36]. More specifically, the Jacobian 
                              J
                              
                                 (
                                 
                                    u
                                 
                                 )
                              
                            can be expressed as 
                              
                                 (20)
                                 
                                    
                                       J
                                       
                                          (
                                          u
                                          ,
                                          v
                                          )
                                       
                                       =
                                       det
                                       
                                          [
                                          
                                             
                                                ∂
                                                
                                                   D
                                                
                                                
                                                   (
                                                   u
                                                   ,
                                                   v
                                                   )
                                                
                                             
                                             
                                                ∂
                                                u
                                             
                                          
                                          
                                             
                                                ∂
                                                
                                                   D
                                                
                                                
                                                   (
                                                   u
                                                   ,
                                                   v
                                                   )
                                                
                                             
                                             
                                                ∂
                                                u
                                             
                                          
                                          ]
                                       
                                       ,
                                    
                                 
                                 
                                    
                                       
                                          
                                             ∂
                                             
                                                D
                                             
                                             
                                                (
                                                u
                                                ,
                                                v
                                                )
                                             
                                          
                                          
                                             ∂
                                             u
                                          
                                       
                                       =
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                             =
                                             0
                                          
                                          
                                             
                                                
                                                   n
                                                
                                                
                                                   b
                                                   1
                                                
                                             
                                             −
                                             2
                                          
                                       
                                       
                                          
                                             ∑
                                          
                                          
                                             j
                                             =
                                             0
                                          
                                          
                                             
                                                
                                                   n
                                                
                                                
                                                   b
                                                   2
                                                
                                             
                                             −
                                             1
                                          
                                       
                                       
                                          
                                             B
                                          
                                          
                                             i
                                             ,
                                             p
                                             −
                                             1
                                          
                                       
                                       
                                          (
                                          u
                                          )
                                       
                                       
                                          
                                             B
                                          
                                          
                                             j
                                             ,
                                             q
                                          
                                       
                                       
                                          (
                                          v
                                          )
                                       
                                       
                                          
                                             γ
                                          
                                          
                                             i
                                          
                                       
                                       
                                          (
                                          
                                             
                                                
                                                   b
                                                
                                             
                                             
                                                i
                                                +
                                                1
                                                ,
                                                j
                                             
                                          
                                          −
                                          
                                             
                                                
                                                   b
                                                
                                             
                                             
                                                i
                                                ,
                                                j
                                             
                                          
                                          )
                                       
                                       ,
                                    
                                 
                                 
                                    
                                       
                                          
                                             ∂
                                             
                                                D
                                             
                                             
                                                (
                                                u
                                                ,
                                                v
                                                )
                                             
                                          
                                          
                                             ∂
                                             v
                                          
                                       
                                       =
                                       
                                          
                                             ∑
                                          
                                          
                                             k
                                             =
                                             0
                                          
                                          
                                             
                                                
                                                   n
                                                
                                                
                                                   b
                                                   1
                                                
                                             
                                             −
                                             1
                                          
                                       
                                       
                                          
                                             ∑
                                          
                                          
                                             l
                                             =
                                             0
                                          
                                          
                                             
                                                
                                                   n
                                                
                                                
                                                   b
                                                   2
                                                
                                             
                                             −
                                             2
                                          
                                       
                                       
                                          
                                             B
                                          
                                          
                                             k
                                             ,
                                             p
                                          
                                       
                                       
                                          (
                                          u
                                          )
                                       
                                       
                                          
                                             B
                                          
                                          
                                             l
                                             ,
                                             q
                                             −
                                             1
                                          
                                       
                                       
                                          (
                                          v
                                          )
                                       
                                       
                                          
                                             η
                                          
                                          
                                             l
                                          
                                       
                                       
                                          (
                                          
                                             
                                                
                                                   b
                                                
                                             
                                             
                                                k
                                                ,
                                                l
                                                +
                                                1
                                             
                                          
                                          −
                                          
                                             
                                                
                                                   b
                                                
                                             
                                             
                                                k
                                                ,
                                                l
                                             
                                          
                                          )
                                       
                                       ,
                                    
                                 
                              
                            where: 
                              
                                 
                                    γ
                                 
                                 
                                    i
                                 
                              
                              =
                              
                                 
                                    p
                                 
                                 
                                    
                                       
                                          
                                             
                                                u
                                             
                                             
                                                ̄
                                             
                                          
                                       
                                       
                                          p
                                          +
                                          i
                                          +
                                          1
                                       
                                    
                                    −
                                    
                                       
                                          
                                             
                                                u
                                             
                                             
                                                ̄
                                             
                                          
                                       
                                       
                                          i
                                          +
                                          1
                                       
                                    
                                 
                              
                              ;
                              
                                 
                                    η
                                 
                                 
                                    l
                                 
                              
                              =
                              
                                 
                                    q
                                 
                                 
                                    
                                       
                                          v
                                       
                                       
                                          q
                                          +
                                          l
                                          +
                                          1
                                       
                                    
                                    −
                                    
                                       
                                          v
                                       
                                       
                                          l
                                          +
                                          1
                                       
                                    
                                 
                              
                           . Using the notation 
                              
                                 Δ
                              
                              
                                 
                                    
                                       b
                                    
                                 
                                 
                                    i
                                    ,
                                    j
                                 
                                 
                                    u
                                 
                              
                              =
                              
                                 (
                                 
                                    
                                       
                                          b
                                       
                                    
                                    
                                       i
                                       +
                                       1
                                       ,
                                       j
                                    
                                 
                                 −
                                 
                                    
                                       
                                          b
                                       
                                    
                                    
                                       i
                                       ,
                                       j
                                    
                                 
                                 )
                              
                            and 
                              
                                 Δ
                              
                              
                                 
                                    
                                       b
                                    
                                 
                                 
                                    k
                                    ,
                                    l
                                 
                                 
                                    v
                                 
                              
                              =
                              
                                 (
                                 
                                    
                                       
                                          b
                                       
                                    
                                    
                                       k
                                       ,
                                       l
                                       +
                                       1
                                    
                                 
                                 −
                                 
                                    
                                       
                                          b
                                       
                                    
                                    
                                       k
                                       ,
                                       l
                                    
                                 
                                 )
                              
                            and noticing that the product of two B-splines is a higher-degree B-spline  [37], the Jacobian could be written as the following B-spline form 
                              
                                 (21)
                                 
                                    
                                       J
                                       
                                          (
                                          
                                             u
                                          
                                          )
                                       
                                       =
                                       J
                                       
                                          (
                                          u
                                          ,
                                          v
                                          )
                                       
                                       =
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                             =
                                             0
                                          
                                          
                                             
                                                
                                                   n
                                                
                                                
                                                   b
                                                   1
                                                
                                             
                                             −
                                             2
                                          
                                       
                                       
                                          
                                             ∑
                                          
                                          
                                             j
                                             =
                                             0
                                          
                                          
                                             
                                                
                                                   n
                                                
                                                
                                                   b
                                                   1
                                                
                                             
                                             −
                                             1
                                          
                                       
                                       
                                          
                                             ∑
                                          
                                          
                                             k
                                             =
                                             0
                                          
                                          
                                             
                                                
                                                   n
                                                
                                                
                                                   b
                                                   1
                                                
                                             
                                             −
                                             1
                                          
                                       
                                       
                                          
                                             ∑
                                          
                                          
                                             l
                                             =
                                             0
                                          
                                          
                                             
                                                
                                                   n
                                                
                                                
                                                   b
                                                   2
                                                
                                             
                                             −
                                             2
                                          
                                       
                                       
                                          
                                             B
                                          
                                          
                                             i
                                             ,
                                             p
                                             −
                                             1
                                          
                                       
                                       
                                          (
                                          u
                                          )
                                       
                                       
                                          
                                             B
                                          
                                          
                                             j
                                             ,
                                             q
                                          
                                       
                                       
                                          (
                                          v
                                          )
                                       
                                    
                                 
                                 
                                    
                                       
                                          
                                             B
                                          
                                          
                                             k
                                             ,
                                             p
                                          
                                       
                                       
                                          (
                                          u
                                          )
                                       
                                       
                                          
                                             B
                                          
                                          
                                             l
                                             ,
                                             q
                                             −
                                             1
                                          
                                       
                                       
                                          (
                                          v
                                          )
                                       
                                       
                                          
                                             γ
                                          
                                          
                                             s
                                          
                                       
                                       
                                          
                                             η
                                          
                                          
                                             l
                                          
                                       
                                       det
                                       
                                          [
                                          
                                             Δ
                                          
                                          
                                             
                                                
                                                   b
                                                
                                             
                                             
                                                i
                                                ,
                                                j
                                             
                                             
                                                u
                                             
                                          
                                          
                                          
                                             Δ
                                          
                                          
                                             
                                                
                                                   b
                                                
                                             
                                             
                                                k
                                                ,
                                                l
                                             
                                             
                                                v
                                             
                                          
                                          ]
                                       
                                       =
                                       
                                          
                                             ∑
                                          
                                          
                                             s
                                             =
                                             0
                                          
                                          
                                             2
                                             
                                                
                                                   n
                                                
                                                
                                                   b
                                                   1
                                                
                                             
                                             −
                                             3
                                          
                                       
                                       
                                          
                                             ∑
                                          
                                          
                                             t
                                             =
                                             0
                                          
                                          
                                             2
                                             
                                                
                                                   n
                                                
                                                
                                                   b
                                                   2
                                                
                                             
                                             −
                                             3
                                          
                                       
                                       
                                          
                                             B
                                          
                                          
                                             s
                                             ,
                                             2
                                             p
                                             −
                                             1
                                          
                                       
                                       
                                          (
                                          u
                                          )
                                       
                                       
                                          
                                             B
                                          
                                          
                                             t
                                             ,
                                             2
                                             q
                                             −
                                             1
                                          
                                       
                                       
                                          (
                                          v
                                          )
                                       
                                       
                                          
                                             J
                                          
                                          
                                             s
                                             ,
                                             t
                                          
                                          
                                             B
                                             S
                                             P
                                          
                                       
                                       
                                          (
                                          
                                             {
                                             
                                                b
                                             
                                             }
                                          
                                          )
                                       
                                       ,
                                    
                                 
                              
                            where 
                              
                                 
                                    J
                                 
                                 
                                    s
                                    ,
                                    t
                                 
                                 
                                    B
                                    S
                                    P
                                 
                              
                            is the B-spline coefficient of the B-spline form of the Jacobian 
                              J
                              
                                 (
                                 
                                    u
                                 
                                 )
                              
                            for the reparameterization 
                              
                                 D
                              
                              
                                 (
                                 
                                    u
                                 
                                 )
                              
                            in (16); each 
                              
                                 
                                    J
                                 
                                 
                                    s
                                    ,
                                    t
                                 
                                 
                                    B
                                    S
                                    P
                                 
                              
                            is a function of 
                              
                                 {
                                 
                                    b
                                 
                                 }
                              
                           . The above B-spline form of Jacobian leads to the following sufficient condition for ensuring the reparameterization 
                              
                                 D
                              
                              
                                 (
                                 
                                    u
                                 
                                 )
                              
                            is diffeomorphic. Due to the non-negativeness of B-spline basis functions, 
                              J
                              
                                 (
                                 
                                    u
                                 
                                 )
                              
                              >
                              0
                            when every B-spline coefficient in (21) is positive, i.e.  
                              
                                 (22)
                                 
                                    
                                       
                                          
                                             J
                                          
                                          
                                             s
                                             ,
                                             t
                                          
                                          
                                             B
                                             S
                                             P
                                          
                                       
                                       
                                          (
                                          
                                             {
                                             
                                                b
                                             
                                             }
                                          
                                          )
                                       
                                       >
                                       0
                                       ,
                                    
                                 
                                 
                                    
                                       s
                                       =
                                       0
                                       ,
                                       1
                                       ,
                                       …
                                       ,
                                       
                                          
                                             n
                                          
                                          
                                             J
                                             1
                                          
                                       
                                       −
                                       1
                                       ;
                                       
                                       t
                                       =
                                       0
                                       ,
                                       1
                                       ,
                                       …
                                       ,
                                       
                                          
                                             n
                                          
                                          
                                             J
                                             2
                                          
                                       
                                       −
                                       1
                                       ,
                                    
                                 
                              
                            where 
                              
                                 
                                    n
                                 
                                 
                                    J
                                    1
                                 
                              
                              =
                              2
                              
                                 
                                    n
                                 
                                 
                                    b
                                    1
                                 
                              
                              −
                              2
                            and 
                              
                                 
                                    n
                                 
                                 
                                    J
                                    2
                                 
                              
                              =
                              2
                              
                                 
                                    n
                                 
                                 
                                    b
                                    2
                                 
                              
                              −
                              2
                            are the number of B-spline coefficients of the B-spline form of Jacobian along the 
                              u
                           - and 
                              v
                           -direction; thus there are total 
                              
                                 
                                    n
                                 
                                 
                                    J
                                 
                              
                              =
                              
                                 
                                    n
                                 
                                 
                                    J
                                    1
                                 
                              
                              
                                 
                                    n
                                 
                                 
                                    J
                                    2
                                 
                              
                              =
                              4
                              
                                 (
                                 
                                    
                                       n
                                    
                                    
                                       b
                                       1
                                    
                                 
                                 −
                                 1
                                 )
                              
                              
                                 (
                                 
                                    
                                       n
                                    
                                    
                                       b
                                       2
                                    
                                 
                                 −
                                 1
                                 )
                              
                            positivity constraints.

The above condition is a sufficient, but not necessary condition. In order to make the condition less conservative, one can extract Bézier patches out of the B-spline representation and obtain more tighter bound of the Jacobian based on Bézier coefficients, as suggested in  [35,36]. Such Bézier extraction involves the following intermediate steps: 
                              
                                 1.
                                 Decompose B-spline of control coefficients 
                                       
                                          {
                                          
                                             b
                                          
                                          }
                                       
                                     into Bézier patches (each patch with control coefficients 
                                       
                                          {
                                          
                                             
                                                
                                                   b
                                                
                                             
                                             
                                                ˜
                                             
                                          
                                          }
                                       
                                    ) by knot insertion algorithms elaborated in  [34].

Find the Bézier representation of the Jacobian of the Bézier patches as directed in  [38].

Repose the Jacobian representation of Bézier patches to form the Jacobian B-spline of 
                                       
                                          
                                             C
                                          
                                          
                                             0
                                          
                                       
                                     inter-patch continuity with control coefficients 
                                       
                                          {
                                          
                                             
                                                J
                                             
                                             
                                                s
                                                ,
                                                t
                                             
                                             
                                                B
                                                E
                                                Z
                                             
                                          
                                          }
                                       
                                    .


                           Jacobian constraints on landmarks. A simple alternative to the above rigorous diffeomorphic conditions is to enforce Jacobian positivity at a finite set of parameter points that correspond to landmarks. The evaluated Jacobian values are all functions of the B-spline coefficients 
                              
                                 {
                                 
                                    b
                                 
                                 }
                              
                            computed by (20). The parameter points chosen are usually those associated with the parametric locations of the landmarks. Suppose there are 
                              
                                 
                                    n
                                 
                                 
                                    J
                                    1
                                 
                              
                              =
                              
                                 
                                    n
                                 
                                 
                                    P
                                    1
                                 
                              
                            and 
                              
                                 
                                    n
                                 
                                 
                                    J
                                    2
                                 
                              
                              =
                              
                                 
                                    n
                                 
                                 
                                    P
                                    2
                                 
                              
                            landmarks along the 
                              u
                           - and 
                              v
                           -direction respectively, and the 
                              
                                 (
                                 s
                                 ,
                                 t
                                 )
                              
                           -th parameter point in 
                              
                                 
                                    
                                       u
                                    
                                 
                                 
                                    s
                                    ,
                                    t
                                 
                              
                           . The constraints can be formulated as 
                              
                                 (24)
                                 
                                    
                                       
                                          
                                             J
                                          
                                          
                                             s
                                             ,
                                             t
                                          
                                          
                                             B
                                          
                                       
                                       =
                                       J
                                       
                                          (
                                          
                                             
                                                
                                                   u
                                                
                                             
                                             
                                                s
                                                ,
                                                t
                                             
                                          
                                          ,
                                          
                                             {
                                             
                                                b
                                             
                                             }
                                          
                                          )
                                       
                                       =
                                       det
                                       
                                          [
                                          
                                             
                                                ∂
                                                
                                                   D
                                                
                                                
                                                   (
                                                   
                                                      
                                                         
                                                            u
                                                         
                                                      
                                                      
                                                         s
                                                         ,
                                                         t
                                                      
                                                   
                                                   )
                                                
                                             
                                             
                                                ∂
                                                u
                                             
                                          
                                          
                                          
                                             
                                                ∂
                                                
                                                   D
                                                
                                                
                                                   (
                                                   
                                                      
                                                         
                                                            u
                                                         
                                                      
                                                      
                                                         s
                                                         ,
                                                         t
                                                      
                                                   
                                                   )
                                                
                                             
                                             
                                                ∂
                                                u
                                             
                                          
                                          ]
                                       
                                       >
                                       0
                                    
                                 
                                 
                                    
                                       s
                                       =
                                       1
                                       ,
                                       …
                                       ,
                                       
                                          
                                             n
                                          
                                          
                                             J
                                             1
                                          
                                       
                                       ;
                                       
                                       t
                                       =
                                       1
                                       ,
                                       …
                                       ,
                                       
                                          
                                             n
                                          
                                          
                                             J
                                             2
                                          
                                       
                                       ,
                                    
                                 
                              
                            where 
                              
                                 
                                    n
                                 
                                 
                                    J
                                    1
                                 
                              
                            and 
                              
                                 
                                    n
                                 
                                 
                                    J
                                    2
                                 
                              
                            are the number of sampled Jacobians along the 
                              u
                           - and 
                              v
                           -direction, in this case equaling the landmark number along each direction; thus there are totally 
                              
                                 
                                    n
                                 
                                 
                                    J
                                 
                              
                              =
                              
                                 
                                    n
                                 
                                 
                                    J
                                    1
                                 
                              
                              
                                 
                                    n
                                 
                                 
                                    J
                                    2
                                 
                              
                              =
                              
                                 
                                    n
                                 
                                 
                                    P
                                    1
                                 
                              
                              
                                 
                                    n
                                 
                                 
                                    P
                                    2
                                 
                              
                            positivity constraints. Although the Jacobian between two landmarks with positive Jacobians is not necessarily positive in theory, we find that in all examples reported in this paper Jacobians are all positive in between with the sufficient landmark resolution chosen. This alternative gives better efficiency than enforcing the constraints in the B-spline form of Jacobian, as shown in Section  5.

It should be noted that the proposed B-spline based reparameterization is based on Free Form Deformation(FFD)  [39]. FFD based techniques have been used extensively, for example, in matching CT/MRI images (image registration) in a multitude of medical imaging applications  [40–43]. The differences in our approach are the following: it is the parametric domain, rather than physical surfaces, that is deformed; our formulation for enforcing diffeomorphic is different; our approach for enforcing the constraints via aggregation shown in next section is also different. It should be noted that splines have been used in landmark matching, e.g. in  [44,45] where the deformation is driven by energy minimizing cost function with various kernels and the diffeomorphism is guaranteed by the flow solutions to ODE. It should also be noted that diffeomorphisms illustrated in for example Fig. 2(b) are akin to fingerprints observed in  [46]. There are also alternative for diffeomorphic reparameterization for curves as reported in  [47–49].

With the above B-spline representation of reparameterization functions 
                           
                              D
                           
                           
                              (
                              
                                 u
                              
                              )
                           
                         and the diffeomorphic conditions, we thus have the following optimization formulation for using B-spline based reparameterization for manipulating shape correspondence: 
                           
                              
                                 (25a)
                                 
                                    
                                       
                                          min
                                       
                                       
                                          
                                             b
                                          
                                       
                                    
                                    f
                                    
                                       (
                                       
                                          b
                                       
                                       )
                                    
                                    =
                                    
                                       
                                          ∑
                                       
                                       
                                          
                                             
                                                λ
                                             
                                             
                                                i
                                             
                                          
                                          ≥
                                          
                                             
                                                λ
                                             
                                             
                                                
                                                   cut
                                                
                                             
                                          
                                       
                                    
                                    
                                       [
                                       1
                                       +
                                       log
                                       
                                          
                                             
                                                
                                                   λ
                                                
                                                
                                                   k
                                                
                                             
                                             
                                                (
                                                
                                                   b
                                                
                                                )
                                             
                                          
                                          
                                             
                                                
                                                   λ
                                                
                                                
                                                   
                                                      cut
                                                   
                                                
                                             
                                          
                                       
                                       ]
                                    
                                    +
                                    
                                       
                                          ∑
                                       
                                       
                                          
                                             
                                                λ
                                             
                                             
                                                k
                                             
                                          
                                          <
                                          
                                             
                                                λ
                                             
                                             
                                                
                                                   cut
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                λ
                                             
                                             
                                                k
                                             
                                          
                                          
                                             (
                                             
                                                b
                                             
                                             )
                                          
                                       
                                       
                                          
                                             
                                                λ
                                             
                                             
                                                
                                                   cut
                                                
                                             
                                          
                                       
                                    
                                 
                              
                              
                                 (25b)
                                 
                                    s.t.
                                    
                                       [
                                       
                                          
                                             
                                                C
                                             
                                          
                                          
                                             T
                                          
                                       
                                       
                                          (
                                          
                                             b
                                          
                                          )
                                       
                                       
                                          C
                                       
                                       
                                          (
                                          
                                             b
                                          
                                          )
                                       
                                       ]
                                    
                                    
                                    
                                       
                                          
                                             v
                                          
                                       
                                       
                                          k
                                       
                                    
                                    
                                       (
                                       
                                          b
                                       
                                       )
                                    
                                    =
                                    
                                       
                                          λ
                                       
                                       
                                          i
                                       
                                    
                                    
                                       (
                                       
                                          b
                                       
                                       )
                                    
                                    
                                       
                                          
                                             v
                                          
                                       
                                       
                                          k
                                       
                                    
                                    
                                       (
                                       
                                          b
                                       
                                       )
                                    
                                 
                              
                              
                                 (25c)
                                 
                                    
                                       
                                          
                                             v
                                          
                                       
                                       
                                          k
                                       
                                       
                                          T
                                       
                                    
                                    
                                       (
                                       
                                          b
                                       
                                       )
                                    
                                    
                                       
                                          
                                             v
                                          
                                       
                                       
                                          k
                                       
                                    
                                    
                                       (
                                       
                                          b
                                       
                                       )
                                    
                                    =
                                    1
                                    ,
                                    
                                    k
                                    =
                                    1
                                    ,
                                    …
                                    ,
                                    
                                       
                                          n
                                       
                                       
                                          S
                                       
                                    
                                 
                              
                              
                                 (25d)
                                 
                                    
                                       
                                          g
                                       
                                       
                                          l
                                       
                                    
                                    
                                       (
                                       
                                          b
                                       
                                       )
                                    
                                    <
                                    0
                                    ,
                                    
                                    l
                                    =
                                    1
                                    ,
                                    …
                                    ,
                                    
                                       
                                          n
                                       
                                       
                                          G
                                       
                                    
                                    .
                                 
                              
                           
                         In this formulation, 
                           
                              b
                           
                         is the set of optimization variables and represents the collection of interior B-spline coefficient tuples 
                           
                              b
                           
                         for 
                           
                              
                                 n
                              
                              
                                 s
                              
                           
                           −
                           1
                         shapes, where one shape from the training set is selected as a reference. The objective function 
                           f
                           
                              (
                              
                                 b
                              
                              )
                           
                         is the simplified description length, which is a function of eigenvalues computed from (25b) and (25c). The matrix 
                           
                              C
                           
                         is related to the covariance matrix 
                           
                              E
                           
                         by 
                           
                              E
                           
                           =
                           
                              
                                 
                                    C
                                 
                              
                              
                                 T
                              
                           
                           
                              C
                           
                         with 
                           
                              
                                 
                                    C
                                 
                                 =
                                 
                                    
                                       
                                          
                                             
                                                X
                                             
                                          
                                          
                                             c
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                (
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      S
                                                   
                                                
                                                −
                                                1
                                                )
                                             
                                             
                                                
                                                   n
                                                
                                                
                                                   P
                                                
                                             
                                          
                                       
                                    
                                 
                                 .
                              
                           
                         The constraint (25d) represents the diffeomorphic conditions, i.e.  (18) for curves and (23), (24) for surfaces, each of which is a function of optimization variables 
                           
                              b
                           
                        .

The optimization formulation given in (25) leads to a large-scale optimization problem. For SSM of 3D surfaces, there are 
                           2
                           ×
                           
                              (
                              
                                 
                                    n
                                 
                                 
                                    S
                                 
                              
                              −
                              1
                              )
                           
                           ×
                           
                              (
                              
                                 
                                    n
                                 
                                 
                                    b
                                    1
                                 
                              
                              −
                              2
                              )
                           
                           ×
                           
                              (
                              
                                 
                                    n
                                 
                                 
                                    b
                                    2
                                 
                              
                              −
                              2
                              )
                           
                         B-spline coefficients as optimization variables with 
                           
                              
                                 n
                              
                              
                                 G
                              
                           
                         constraints based on (23), (24), which will be detained in Section  4.3.1.

In order to efficiently obtain optimized shape correspondence, we have developed a gradient-based optimization approach. We have derived analytical gradient of the cost function (25a) with respect to optimization variables 
                           
                              b
                           
                         with both direct differentiation and the adjoint sensitivity method. We have also developed a technique to approximate the constraints and to aggregate the large number of Jacobian constraints into one constraint in order to speed up the convergence.

Analytical gradient provides an efficient and accurate mean to obtain gradient for optimization. It is especially important in large-scale optimization problems where the finite difference based approach for computing gradient would be inefficient. It turns out the analytical gradient can be derived for all the differentiable intermediate steps since all steps in our formulation, including reparameterization, sampling, alignment, PCA and DL computation are differentiable, the gradient product gives the analytical objective gradient due to the chain rule as follows: 
                           
                              (26)
                              
                                 
                                    
                                       
                                          d
                                       
                                       f
                                    
                                    
                                       
                                          d
                                       
                                       
                                          
                                             b
                                          
                                          
                                             r
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       ∂
                                       f
                                    
                                    
                                       ∂
                                       
                                          
                                             λ
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                                 
                                    
                                       ∑
                                    
                                    
                                       j
                                    
                                 
                                 
                                    
                                       ∂
                                       
                                          
                                             λ
                                          
                                          
                                             i
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             x
                                          
                                          
                                             j
                                          
                                          
                                             A
                                          
                                       
                                    
                                 
                                 
                                    
                                       ∑
                                    
                                    
                                       k
                                    
                                 
                                 
                                    
                                       ∂
                                       
                                          
                                             x
                                          
                                          
                                             j
                                          
                                          
                                             A
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             x
                                          
                                          
                                             k
                                          
                                          
                                             S
                                          
                                       
                                    
                                 
                                 
                                    
                                       ∑
                                    
                                    
                                       l
                                    
                                 
                                 
                                    
                                       ∂
                                       
                                          
                                             x
                                          
                                          
                                             k
                                          
                                          
                                             S
                                          
                                       
                                    
                                    
                                       ∂
                                       
                                          D
                                       
                                       
                                          (
                                          
                                             
                                                
                                                   u
                                                
                                             
                                             
                                                l
                                             
                                          
                                          )
                                       
                                    
                                 
                                 
                                    
                                       ∑
                                    
                                    
                                       r
                                    
                                 
                                 
                                    
                                       ∂
                                       
                                          D
                                       
                                       
                                          (
                                          
                                             
                                                
                                                   u
                                                
                                             
                                             
                                                l
                                             
                                          
                                          )
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             b
                                          
                                          
                                             r
                                          
                                       
                                    
                                 
                              
                           
                         where 
                           
                              D
                           
                           
                              (
                              
                                 
                                    
                                       u
                                    
                                 
                                 
                                    l
                                 
                              
                              )
                           
                         is the 
                           l
                        -th reparameterized landmark point in the parameter domain, 
                           
                              
                                 x
                              
                              
                                 k
                              
                              
                                 S
                              
                           
                         is the 
                           k
                        -th landmark in the physical domain and 
                           
                              
                                 x
                              
                              
                                 j
                              
                              
                                 A
                              
                           
                         is the 
                           j
                        -th aligned landmark. Among them the 
                           
                              
                                 ∂
                                 f
                              
                              
                                 ∂
                                 
                                    
                                       λ
                                    
                                    
                                       i
                                    
                                 
                              
                           
                        , 
                           
                              
                                 ∂
                                 
                                    
                                       λ
                                    
                                    
                                       i
                                    
                                 
                              
                              
                                 ∂
                                 
                                    
                                       x
                                    
                                    
                                       j
                                    
                                    
                                       A
                                    
                                 
                              
                           
                         and 
                           
                              
                                 ∂
                                 
                                    
                                       x
                                    
                                    
                                       j
                                    
                                    
                                       A
                                    
                                 
                              
                              
                                 ∂
                                 
                                    
                                       x
                                    
                                    
                                       k
                                    
                                    
                                       S
                                    
                                 
                              
                           
                         are inherently differentiable, and 
                           
                              
                                 ∂
                                 
                                    D
                                 
                                 
                                    (
                                    
                                       
                                          
                                             u
                                          
                                       
                                       
                                          l
                                       
                                    
                                    )
                                 
                              
                              
                                 ∂
                                 
                                    
                                       b
                                    
                                    
                                       r
                                    
                                 
                              
                           
                         is also differentiable as long as a differentiable reparameterization technique such as (15) and (16) is used. The analytical gradient 
                           
                              
                                 ∂
                                 
                                    
                                       x
                                    
                                    
                                       k
                                    
                                    
                                       S
                                    
                                 
                              
                              
                                 ∂
                                 
                                    D
                                 
                                 
                                    (
                                    
                                       
                                          
                                             u
                                          
                                       
                                       
                                          l
                                       
                                    
                                    )
                                 
                              
                           
                         requires the differentiability of the geometric representation of training set shapes. In this paper, we use the quadratic B-spline of 
                           
                              
                                 C
                              
                              
                                 1
                              
                           
                         smoothness to represent the shapes in the training set. Therefore, full analytical gradients can be derived.

The total sensitivity from (25a) is just 
                           
                              (27)
                              
                                 
                                    
                                       
                                          d
                                       
                                       
                                       f
                                       
                                          (
                                          
                                             b
                                          
                                          )
                                       
                                    
                                    
                                       
                                          d
                                       
                                       
                                       
                                          
                                             b
                                          
                                          
                                             r
                                          
                                       
                                    
                                 
                                 =
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                    
                                 
                                 
                                    
                                       ∂
                                       f
                                       
                                          [
                                          
                                             b
                                          
                                          ,
                                          
                                             λ
                                          
                                          
                                             (
                                             
                                                b
                                             
                                             )
                                          
                                          ]
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             λ
                                          
                                          
                                             i
                                          
                                       
                                    
                                 
                                 
                                    
                                       ∂
                                       
                                          
                                             λ
                                          
                                          
                                             i
                                          
                                       
                                       
                                          (
                                          
                                             b
                                          
                                          )
                                       
                                    
                                    
                                       ∂
                                       
                                          
                                             b
                                          
                                          
                                             r
                                          
                                       
                                    
                                 
                              
                           
                         where 
                           r
                           =
                           1
                           ,
                           …
                           ,
                           
                              
                                 n
                              
                              
                                 D
                              
                           
                        ; the optimization variable number 
                           
                              
                                 n
                              
                              
                                 D
                              
                           
                           =
                           
                              (
                              
                                 
                                    n
                                 
                                 
                                    b
                                 
                              
                              −
                              2
                              )
                           
                           
                              (
                              
                                 
                                    n
                                 
                                 
                                    S
                                 
                              
                              −
                              1
                              )
                           
                         for curves and 
                           
                              
                                 n
                              
                              
                                 D
                              
                           
                           =
                           2
                           
                              (
                              
                                 
                                    n
                                 
                                 
                                    b
                                    1
                                 
                              
                              −
                              2
                              )
                           
                           
                              (
                              
                                 
                                    n
                                 
                                 
                                    b
                                    2
                                 
                              
                              −
                              2
                              )
                           
                           
                              (
                              
                                 
                                    n
                                 
                                 
                                    S
                                 
                              
                              −
                              1
                              )
                           
                         for surfaces.

Under the state equation formulation in (25), we can obtain the objective sensitivity in (27) with either the direct method or the adjoint method, giving rise to the direct sensitivity and adjoint sensitivity. The adjoint sensitivity is significantly faster than the direct sensitivity. We provide the derivations for both to highlight the characteristics of the adjoint method.

The direct sensitivity computes the gradient of the cost function by directly differentiating the cost function (25a). That is, 
                              
                                 (28)
                                 
                                    
                                       
                                          ∂
                                          
                                          f
                                          
                                             (
                                             
                                                b
                                             
                                             )
                                          
                                       
                                       
                                          ∂
                                          
                                          
                                             
                                                b
                                             
                                             
                                                r
                                             
                                          
                                       
                                    
                                    =
                                    
                                       
                                          ∑
                                       
                                       
                                          m
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                S
                                             
                                          
                                       
                                    
                                    
                                       
                                          ∂
                                          f
                                       
                                       
                                          ∂
                                          
                                             
                                                λ
                                             
                                             
                                                m
                                             
                                          
                                       
                                    
                                    
                                       
                                          ∂
                                          
                                             
                                                λ
                                             
                                             
                                                m
                                             
                                          
                                       
                                       
                                          ∂
                                          
                                             
                                                b
                                             
                                             
                                                r
                                             
                                          
                                       
                                    
                                    .
                                 
                              
                            The term 
                              ∂
                              
                                 
                                    λ
                                 
                                 
                                    m
                                 
                              
                              /
                              ∂
                              
                                 
                                    b
                                 
                                 
                                    r
                                 
                              
                              
                              
                                 (
                                 m
                                 =
                                 1
                                 ,
                                 …
                                 ,
                                 
                                    
                                       n
                                    
                                    
                                       S
                                    
                                 
                                 )
                              
                            is obtained by differentiating Eqs. (25b) and (25c) with respect to 
                              
                                 
                                    b
                                 
                                 
                                    r
                                 
                              
                           , which leads to the following resulting linear system 
                              
                                 (29)
                                 
                                    
                                       [
                                       
                                          
                                             
                                             
                                                0
                                             
                                             
                                                
                                                   
                                                      
                                                         v
                                                      
                                                   
                                                   
                                                      m
                                                   
                                                   
                                                      T
                                                   
                                                
                                             
                                          
                                          
                                             
                                             
                                                
                                                   
                                                      
                                                         v
                                                      
                                                   
                                                   
                                                      m
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      λ
                                                   
                                                   
                                                      m
                                                   
                                                
                                                
                                                   
                                                      
                                                         I
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            n
                                                         
                                                         
                                                            S
                                                         
                                                      
                                                   
                                                
                                                −
                                                
                                                   
                                                      
                                                         C
                                                      
                                                   
                                                   
                                                      T
                                                   
                                                
                                                
                                                   C
                                                
                                             
                                          
                                       
                                       ]
                                    
                                    
                                       [
                                       
                                          
                                             
                                                
                                                   
                                                      ∂
                                                      
                                                         
                                                            λ
                                                         
                                                         
                                                            m
                                                         
                                                      
                                                   
                                                   
                                                      ∂
                                                      
                                                         
                                                            b
                                                         
                                                         
                                                            r
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      ∂
                                                      
                                                         
                                                            
                                                               v
                                                            
                                                         
                                                         
                                                            m
                                                         
                                                      
                                                   
                                                   
                                                      ∂
                                                      
                                                         
                                                            b
                                                         
                                                         
                                                            r
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       ]
                                    
                                    =
                                    
                                       [
                                       
                                          
                                             
                                                0
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      ∂
                                                      
                                                         (
                                                         
                                                            
                                                               
                                                                  C
                                                               
                                                            
                                                            
                                                               T
                                                            
                                                         
                                                         
                                                            C
                                                         
                                                         )
                                                      
                                                   
                                                   
                                                      ∂
                                                      
                                                         
                                                            b
                                                         
                                                         
                                                            r
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         v
                                                      
                                                   
                                                   
                                                      m
                                                   
                                                
                                             
                                          
                                       
                                       ]
                                    
                                    .
                                 
                              
                            The linear equation system can be solved to obtain 
                              ∂
                              
                                 
                                    λ
                                 
                                 
                                    m
                                 
                              
                              /
                              ∂
                              
                                 
                                    b
                                 
                                 
                                    r
                                 
                              
                            and 
                              ∂
                              
                                 
                                    
                                       v
                                    
                                 
                                 
                                    m
                                 
                              
                              /
                              ∂
                              
                                 
                                    b
                                 
                                 
                                    r
                                 
                              
                           . Plugging 
                              ∂
                              
                                 
                                    λ
                                 
                                 
                                    m
                                 
                              
                              /
                              ∂
                              
                                 
                                    b
                                 
                                 
                                    r
                                 
                              
                            into (28) yields the desired gradient.

In order to avoid the direct computation of 
                              ∂
                              
                                 
                                    λ
                                 
                                 
                                    m
                                 
                              
                              /
                              ∂
                              
                                 
                                    b
                                 
                                 
                                    r
                                 
                              
                            and 
                              ∂
                              
                                 
                                    
                                       v
                                    
                                 
                                 
                                    m
                                 
                              
                              /
                              ∂
                              
                                 
                                    b
                                 
                                 
                                    r
                                 
                              
                           , we introduce a Lagrangian quantity by augmenting the objective function (25a) with 
                              2
                              
                                 
                                    n
                                 
                                 
                                    S
                                 
                              
                            sets of constraints (25b) and (25c) as 
                              
                                 (30)
                                 
                                    L
                                    =
                                    f
                                    
                                       (
                                       
                                          λ
                                       
                                       )
                                    
                                    +
                                    
                                       
                                          ∑
                                       
                                       
                                          m
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                S
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             μ
                                          
                                       
                                       
                                          m
                                       
                                       
                                          T
                                       
                                    
                                    
                                       (
                                       
                                          
                                             
                                                C
                                             
                                          
                                          
                                             T
                                          
                                       
                                       
                                          C
                                       
                                       
                                       
                                          
                                             
                                                v
                                             
                                          
                                          
                                             m
                                          
                                       
                                       −
                                       
                                          
                                             λ
                                          
                                          
                                             m
                                          
                                       
                                       
                                          
                                             
                                                v
                                             
                                          
                                          
                                             m
                                          
                                       
                                       )
                                    
                                    +
                                    
                                       
                                          ∑
                                       
                                       
                                          m
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                S
                                             
                                          
                                       
                                    
                                    
                                       
                                          ν
                                       
                                       
                                          m
                                       
                                    
                                    
                                       (
                                       
                                          
                                             
                                                v
                                             
                                          
                                          
                                             m
                                          
                                          
                                             T
                                          
                                       
                                       
                                          
                                             
                                                v
                                             
                                          
                                          
                                             m
                                          
                                       
                                       −
                                       1
                                       )
                                    
                                 
                              
                            where adjoint variables 
                              
                                 
                                    
                                       μ
                                    
                                 
                                 
                                    m
                                 
                              
                            and 
                              
                                 
                                    ν
                                 
                                 
                                    m
                                 
                              
                              
                              
                                 (
                                 m
                                 =
                                 1
                                 ,
                                 …
                                 ,
                                 
                                    
                                       n
                                    
                                    
                                       S
                                    
                                 
                                 )
                              
                            are the Lagrange multipliers.

Differentiation of (30) w.r.t. 
                              
                                 
                                    b
                                 
                                 
                                    r
                                 
                              
                            gives 
                              
                                 
                                    
                                       
                                          ∂
                                          
                                          f
                                       
                                       
                                          ∂
                                          
                                          
                                             
                                                b
                                             
                                             
                                                r
                                             
                                          
                                       
                                    
                                    =
                                    
                                       
                                          ∂
                                          
                                          L
                                       
                                       
                                          ∂
                                          
                                          
                                             
                                                b
                                             
                                             
                                                r
                                             
                                          
                                       
                                    
                                    =
                                    
                                       
                                          ∑
                                       
                                       
                                          m
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                S
                                             
                                          
                                       
                                    
                                    
                                       
                                          ∂
                                          f
                                       
                                       
                                          ∂
                                          
                                             
                                                λ
                                             
                                             
                                                m
                                             
                                          
                                       
                                    
                                    
                                       
                                          ∂
                                          
                                             
                                                λ
                                             
                                             
                                                m
                                             
                                          
                                       
                                       
                                          ∂
                                          
                                             
                                                b
                                             
                                             
                                                r
                                             
                                          
                                       
                                    
                                    +
                                    
                                       
                                          ∑
                                       
                                       
                                          m
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                S
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             μ
                                          
                                       
                                       
                                          m
                                       
                                       
                                          T
                                       
                                    
                                    
                                       (
                                       
                                          
                                             ∂
                                             
                                                (
                                                
                                                   
                                                      
                                                         C
                                                      
                                                   
                                                   
                                                      T
                                                   
                                                
                                                
                                                   C
                                                
                                                )
                                             
                                          
                                          
                                             ∂
                                             
                                                
                                                   b
                                                
                                                
                                                   r
                                                
                                             
                                          
                                       
                                       −
                                       
                                          
                                             ∂
                                             
                                                
                                                   λ
                                                
                                                
                                                   m
                                                
                                             
                                          
                                          
                                             ∂
                                             
                                                
                                                   b
                                                
                                                
                                                   r
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                I
                                             
                                          
                                          
                                             
                                                
                                                   n
                                                
                                                
                                                   S
                                                
                                             
                                          
                                       
                                       )
                                    
                                    +
                                    
                                       
                                          ∑
                                       
                                       
                                          m
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                S
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             μ
                                          
                                       
                                       
                                          m
                                       
                                       
                                          T
                                       
                                    
                                    
                                       (
                                       
                                          
                                             
                                                C
                                             
                                          
                                          
                                             T
                                          
                                       
                                       
                                          C
                                       
                                       
                                       −
                                       
                                          
                                             λ
                                          
                                          
                                             m
                                          
                                       
                                       
                                          
                                             
                                                I
                                             
                                          
                                          
                                             
                                                
                                                   n
                                                
                                                
                                                   S
                                                
                                             
                                          
                                       
                                       )
                                    
                                    
                                       
                                          ∂
                                          
                                             
                                                
                                                   v
                                                
                                             
                                             
                                                m
                                             
                                          
                                       
                                       
                                          ∂
                                          
                                             
                                                b
                                             
                                             
                                                r
                                             
                                          
                                       
                                    
                                    +
                                    
                                       
                                          ∑
                                       
                                       
                                          m
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                S
                                             
                                          
                                       
                                    
                                    2
                                    
                                       
                                          ν
                                       
                                       
                                          m
                                       
                                    
                                    
                                       
                                          
                                             v
                                          
                                       
                                       
                                          m
                                       
                                       
                                          T
                                       
                                    
                                    
                                       
                                          ∂
                                          
                                             
                                                
                                                   v
                                                
                                             
                                             
                                                m
                                             
                                          
                                       
                                       
                                          ∂
                                          
                                             
                                                b
                                             
                                             
                                                r
                                             
                                          
                                       
                                    
                                    ,
                                 
                              
                            which could be simplified to 
                              
                                 (31)
                                 
                                    
                                       
                                          ∂
                                          
                                          f
                                       
                                       
                                          ∂
                                          
                                          
                                             
                                                b
                                             
                                             
                                                r
                                             
                                          
                                       
                                    
                                    =
                                    
                                       
                                          ∑
                                       
                                       
                                          m
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                S
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             μ
                                          
                                       
                                       
                                          m
                                       
                                       
                                          T
                                       
                                    
                                    
                                       
                                          ∂
                                          
                                             (
                                             
                                                
                                                   
                                                      C
                                                   
                                                
                                                
                                                   T
                                                
                                             
                                             
                                                C
                                             
                                             )
                                          
                                       
                                       
                                          ∂
                                          
                                             
                                                b
                                             
                                             
                                                r
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             v
                                          
                                       
                                       
                                          m
                                       
                                    
                                    +
                                    
                                       
                                          ∑
                                       
                                       
                                          m
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                S
                                             
                                          
                                       
                                    
                                    
                                       (
                                       
                                          
                                             ∂
                                             f
                                          
                                          
                                             ∂
                                             
                                                
                                                   λ
                                                
                                                
                                                   m
                                                
                                             
                                          
                                       
                                       −
                                       
                                          
                                             
                                                μ
                                             
                                          
                                          
                                             m
                                          
                                          
                                             T
                                          
                                       
                                       
                                          
                                             
                                                v
                                             
                                          
                                          
                                             m
                                          
                                       
                                       )
                                    
                                    
                                       
                                          ∂
                                          
                                             
                                                λ
                                             
                                             
                                                m
                                             
                                          
                                       
                                       
                                          ∂
                                          
                                             
                                                b
                                             
                                             
                                                r
                                             
                                          
                                       
                                    
                                    +
                                    
                                       
                                          ∑
                                       
                                       
                                          m
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                S
                                             
                                          
                                       
                                    
                                    
                                       [
                                       
                                          
                                             
                                                μ
                                             
                                          
                                          
                                             m
                                          
                                          
                                             T
                                          
                                       
                                       
                                          (
                                          
                                             
                                                
                                                   C
                                                
                                             
                                             
                                                T
                                             
                                          
                                          
                                             C
                                          
                                          −
                                          
                                             
                                                λ
                                             
                                             
                                                m
                                             
                                          
                                          
                                             
                                                
                                                   I
                                                
                                             
                                             
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      S
                                                   
                                                
                                             
                                          
                                          )
                                       
                                       +
                                       2
                                       
                                          
                                             ν
                                          
                                          
                                             m
                                          
                                       
                                       
                                          
                                             
                                                v
                                             
                                          
                                          
                                             m
                                          
                                          
                                             T
                                          
                                       
                                       ]
                                    
                                    
                                       
                                          ∂
                                          
                                             
                                                
                                                   v
                                                
                                             
                                             
                                                m
                                             
                                          
                                       
                                       
                                          ∂
                                          
                                             
                                                b
                                             
                                             
                                                r
                                             
                                          
                                       
                                    
                                    .
                                 
                              
                            The key idea of the adjoint method is to circumvent the direct computation of the sensitivity of the state variables 
                              λ
                            with respect to optimization variables 
                              
                                 b
                              
                           . A more general discussion on the adjoint method is available in  [50–52]. Specifically in this situation, in order to bypass the direct calculation of 
                              
                                 
                                    ∂
                                    
                                       
                                          λ
                                       
                                       
                                          m
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          b
                                       
                                       
                                          r
                                       
                                    
                                 
                              
                            and 
                              
                                 
                                    ∂
                                    
                                       
                                          
                                             v
                                          
                                       
                                       
                                          m
                                       
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          b
                                       
                                       
                                          r
                                       
                                    
                                 
                              
                            in (31), their coefficients in (31) are set to zero. This is possible since the arbitrariness of adjoint variables 
                              
                                 
                                    
                                       μ
                                    
                                 
                                 
                                    m
                                 
                              
                            and 
                              
                                 
                                    ν
                                 
                                 
                                    m
                                 
                              
                           . This therefore leads to the linear adjoint equations below for solving these adjoint variables 
                              
                                 (32)
                                 
                                    
                                       {
                                       
                                          
                                             
                                                
                                                   
                                                      ∂
                                                      f
                                                   
                                                   
                                                      ∂
                                                      
                                                         
                                                            λ
                                                         
                                                         
                                                            m
                                                         
                                                      
                                                   
                                                
                                                −
                                                
                                                   
                                                      
                                                         μ
                                                      
                                                   
                                                   
                                                      m
                                                   
                                                   
                                                      T
                                                   
                                                
                                                
                                                   
                                                      
                                                         v
                                                      
                                                   
                                                   
                                                      m
                                                   
                                                
                                                =
                                                0
                                                ,
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         μ
                                                      
                                                   
                                                   
                                                      m
                                                   
                                                   
                                                      T
                                                   
                                                
                                                
                                                   (
                                                   
                                                      
                                                         
                                                            C
                                                         
                                                      
                                                      
                                                         T
                                                      
                                                   
                                                   
                                                      C
                                                   
                                                   −
                                                   
                                                      
                                                         λ
                                                      
                                                      
                                                         m
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            I
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               n
                                                            
                                                            
                                                               S
                                                            
                                                         
                                                      
                                                   
                                                   )
                                                
                                                +
                                                2
                                                
                                                   
                                                      ν
                                                   
                                                   
                                                      m
                                                   
                                                
                                                
                                                   
                                                      
                                                         v
                                                      
                                                   
                                                   
                                                      m
                                                   
                                                   
                                                      T
                                                   
                                                
                                                =
                                                
                                                   0
                                                
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                            The above equation can be rearranged into the following linear system 
                              
                                 (33)
                                 
                                    
                                       [
                                       
                                          
                                             
                                             
                                                
                                                   
                                                      
                                                         v
                                                      
                                                   
                                                   
                                                      m
                                                   
                                                   
                                                      T
                                                   
                                                
                                             
                                             
                                                0
                                             
                                          
                                          
                                             
                                             
                                                
                                                   
                                                      
                                                         C
                                                      
                                                   
                                                   
                                                      T
                                                   
                                                
                                                
                                                   C
                                                
                                                −
                                                
                                                   
                                                      λ
                                                   
                                                   
                                                      m
                                                   
                                                
                                                
                                                   
                                                      
                                                         I
                                                      
                                                   
                                                   
                                                      
                                                         
                                                            n
                                                         
                                                         
                                                            S
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                                2
                                                
                                                   
                                                      
                                                         v
                                                      
                                                   
                                                   
                                                      m
                                                   
                                                
                                             
                                          
                                       
                                       ]
                                    
                                    
                                       [
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         μ
                                                      
                                                   
                                                   
                                                      m
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      ν
                                                   
                                                   
                                                      m
                                                   
                                                
                                             
                                          
                                       
                                       ]
                                    
                                    =
                                    
                                       [
                                       
                                          
                                             
                                                
                                                   
                                                      ∂
                                                      f
                                                   
                                                   
                                                      ∂
                                                      
                                                         
                                                            λ
                                                         
                                                         
                                                            m
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   0
                                                
                                             
                                          
                                       
                                       ]
                                    
                                 
                              
                            from which the adjoint variables 
                              
                                 
                                    
                                       μ
                                    
                                 
                                 
                                    m
                                 
                              
                            and 
                              
                                 
                                    ν
                                 
                                 
                                    m
                                 
                              
                            can be solved. The sensitivity in (31) can then be obtained through the following simplified expression 
                              
                                 (34)
                                 
                                    
                                       
                                          ∂
                                          
                                          f
                                       
                                       
                                          ∂
                                          
                                          
                                             
                                                b
                                             
                                             
                                                r
                                             
                                          
                                       
                                    
                                    =
                                    
                                       
                                          ∑
                                       
                                       
                                          m
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                S
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             μ
                                          
                                       
                                       
                                          m
                                       
                                       
                                          T
                                       
                                    
                                    
                                       
                                          ∂
                                          
                                             (
                                             
                                                
                                                   
                                                      C
                                                   
                                                
                                                
                                                   T
                                                
                                             
                                             
                                                C
                                             
                                             )
                                          
                                       
                                       
                                          ∂
                                          
                                             
                                                b
                                             
                                             
                                                r
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             v
                                          
                                       
                                       
                                          m
                                       
                                    
                                    .
                                 
                              
                           
                        

It is worth noting that, with the direct method, the linear system (29) is solved for each optimization variable 
                              
                                 
                                    b
                                 
                                 
                                    r
                                 
                              
                              ,
                              
                              r
                              =
                              1
                            to 
                              
                                 
                                    n
                                 
                                 
                                    D
                                 
                              
                           , and every eigenvalue 
                              
                                 
                                    λ
                                 
                                 
                                    m
                                 
                              
                           . On the other hand, with the adjoint method, the linear system (33) is solved just once for every eigenvalue 
                              
                                 
                                    λ
                                 
                                 
                                    m
                                 
                              
                           . Numerical examples in Section  5.2 are presented to demonstrate the accuracy and efficiency of the adjoint sensitivity.

Based on the description in Section  3.2.2, we consider the two options: (a) Jacobian B-spline (via Bézier implementation) (23); and (b) sampled Jacobian (24). In either situation, the large quantity of original 
                              
                                 
                                    n
                                 
                                 
                                    J
                                 
                              
                            constraints is rather undesirable for the optimization with already many optimization variables. For the purpose of reducing the number of constraints while not sacrificing the differentiability of constraint functions, the constraint aggregation [53,54] technique is employed here. The Kreisselmeier–Steinhauser (KS) function  [55] is used here and we choose to aggregate all the 
                              
                                 
                                    n
                                 
                                 
                                    J
                                 
                              
                            ​Jacobian constraints for each shape into one single constraint to be applied as the optimization constraints in (25d), yielding totally 
                              
                                 
                                    n
                                 
                                 
                                    G
                                 
                              
                              =
                              
                                 
                                    n
                                 
                                 
                                    S
                                 
                              
                              −
                              1
                            constraints for 
                              
                                 
                                    n
                                 
                                 
                                    S
                                 
                              
                              −
                              1
                            shapes as
                              
                                 (35)
                                 
                                    
                                       
                                          g
                                       
                                       
                                          l
                                       
                                    
                                    
                                       (
                                       
                                          b
                                       
                                       )
                                    
                                    =
                                    
                                       
                                          1
                                       
                                       
                                          K
                                       
                                    
                                    ln
                                    
                                       [
                                       
                                          
                                             ∑
                                          
                                          
                                             z
                                             =
                                             1
                                          
                                          
                                             
                                                
                                                   n
                                                
                                                
                                                   J
                                                
                                             
                                          
                                       
                                       
                                          
                                             e
                                          
                                          
                                             −
                                             K
                                             
                                                
                                                   J
                                                
                                                
                                                   z
                                                
                                             
                                             
                                                (
                                                
                                                   
                                                      
                                                         {
                                                         
                                                            b
                                                         
                                                         }
                                                      
                                                   
                                                   
                                                      l
                                                   
                                                
                                                )
                                             
                                          
                                       
                                       ]
                                    
                                    <
                                    0
                                    ,
                                    
                                    l
                                    ∈
                                    1
                                    ,
                                    .
                                    .
                                    ,
                                    
                                       
                                          n
                                       
                                       
                                          S
                                       
                                    
                                    ;
                                    
                                    l
                                    ≠
                                    
                                       
                                          i
                                       
                                       
                                          
                                             R
                                          
                                       
                                    
                                 
                              
                            where 
                              
                                 
                                    J
                                 
                                 
                                    z
                                 
                              
                            is original Jacobian positivity, being either 
                              
                                 
                                    J
                                 
                                 
                                    s
                                    ,
                                    t
                                 
                                 
                                    A
                                 
                              
                            in (23) for the Jacobian B-spline constraint or 
                              
                                 
                                    J
                                 
                                 
                                    s
                                    ,
                                    t
                                 
                                 
                                    B
                                 
                              
                            in (24) for the direct sampled Jacobian constraint; the linearly ordered index is obtained by 
                              z
                              =
                              s
                              +
                              
                                 (
                                 t
                                 −
                                 1
                                 )
                              
                              
                                 
                                    n
                                 
                                 
                                    J
                                    1
                                 
                              
                           . 
                              
                                 
                                    i
                                 
                                 
                                    
                                       R
                                    
                                 
                              
                            is the reference shape index whose parameter domain is not reparameterized and landmarks are fixed. 
                              
                                 
                                    
                                       {
                                       
                                          b
                                       
                                       }
                                    
                                 
                                 
                                    l
                                 
                              
                            are just the reparameterization B-spline control coefficients for the 
                              l
                           -th shape. Parameter 
                              K
                            is a control parameter here chosen to be 
                              K
                              =
                              15
                           .

It could be shown that this new constraint is more conservative than the original constraints. We have found that the two options of Jacobian positivity constraints differ only slightly as long as the landmark resolution of the direct sampled Jacobian constraint option is sufficiently large.

For a gradient based optimization approach, both the gradient of the cost function and the constraints with respect to optimization variables are needed. The gradients of the objective function have been discussed in great detail in the previous section. The analytical gradients of the inequality constraints based on (35) can also be derived. The gradient of 
                              l
                           -th inequality constraint w.r.t. the 
                              r
                           -th optimization variable 
                              
                                 
                                    b
                                 
                                 
                                    r
                                 
                              
                            is 
                              
                                 (36)
                                 
                                    
                                       
                                          ∂
                                          
                                             
                                                g
                                             
                                             
                                                l
                                             
                                          
                                       
                                       
                                          ∂
                                          
                                             
                                                b
                                             
                                             
                                                r
                                             
                                          
                                       
                                    
                                    =
                                    −
                                    
                                       
                                          1
                                       
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                z
                                                =
                                                1
                                             
                                             
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      J
                                                   
                                                
                                             
                                          
                                          
                                             
                                                e
                                             
                                             
                                                −
                                                K
                                                
                                                   
                                                      J
                                                   
                                                   
                                                      z
                                                   
                                                
                                                
                                                   (
                                                   
                                                      
                                                         
                                                            {
                                                            
                                                               b
                                                            
                                                            }
                                                         
                                                      
                                                      
                                                         l
                                                      
                                                   
                                                   )
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          ∑
                                       
                                       
                                          z
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                J
                                             
                                          
                                       
                                    
                                    
                                       
                                          e
                                       
                                       
                                          −
                                          K
                                          
                                             
                                                J
                                             
                                             
                                                z
                                             
                                          
                                          
                                             (
                                             
                                                
                                                   
                                                      {
                                                      
                                                         b
                                                      
                                                      }
                                                   
                                                
                                                
                                                   l
                                                
                                             
                                             )
                                          
                                       
                                    
                                    
                                       
                                          ∂
                                          
                                             
                                                J
                                             
                                             
                                                z
                                             
                                          
                                          
                                             (
                                             
                                                
                                                   
                                                      {
                                                      
                                                         b
                                                      
                                                      }
                                                   
                                                
                                                
                                                   l
                                                
                                             
                                             )
                                          
                                       
                                       
                                          ∂
                                          
                                             
                                                b
                                             
                                             
                                                r
                                             
                                          
                                       
                                    
                                 
                              
                            where the Jacobian gradient 
                              
                                 
                                    ∂
                                    
                                       
                                          J
                                       
                                       
                                          z
                                       
                                    
                                    
                                       (
                                       
                                          
                                             
                                                {
                                                
                                                   b
                                                
                                                }
                                             
                                          
                                          
                                             l
                                          
                                       
                                       )
                                    
                                 
                                 
                                    ∂
                                    
                                       
                                          b
                                       
                                       
                                          r
                                       
                                    
                                 
                              
                            when 
                              
                                 
                                    J
                                 
                                 
                                    s
                                    ,
                                    t
                                 
                                 
                                    A
                                 
                              
                            and 
                              
                                 
                                    J
                                 
                                 
                                    s
                                    ,
                                    t
                                 
                                 
                                    B
                                 
                              
                            can be evaluated easily from (23) and (24).

@&#EXPERIMENTAL RESULTS@&#

In this section, we present the numerical results of the proposed correspondence optimization approach. Experimental results on both synthetic and real 2D and 3D data sets are described. The use of synthetic data is to check the correctness of the results since the shape variation pattern is known. The synthetic data set is the “plane-bump” (3D) shapes. The use of real data sets, including 40 hands (2D) and 34 distal femur bones (3D), is to show the practicality of the proposed approach. An earlier version of the proposed approach has been used in optimizing correspondence among 6 aortic shapes  [56].

The optimizer is Sequential Quadratic Programming routine in the MATLAB optimization toolbox. The stopping criterion for the optimizer is chosen as the relative change of objective function, i.e.  
                        
                           
                              
                                 
                                    f
                                 
                                 
                                    
                                       (
                                       k
                                       )
                                    
                                 
                              
                              −
                              
                                 
                                    f
                                 
                                 
                                    
                                       (
                                       k
                                       −
                                       1
                                       )
                                    
                                 
                              
                           
                           
                              
                                 
                                    f
                                 
                                 
                                    
                                       (
                                       0
                                       )
                                    
                                 
                              
                           
                        
                        <
                        1
                        
                           
                              0
                           
                           
                              −
                              6
                           
                        
                     ; it is used both in the concatenation of simple mappings and direct reparameterization schemes. The allowed number of iterations in concatenation of simple mappings based correspondence optimization is set to be 
                        
                           
                              N
                           
                           
                              
                                 OPT
                              
                           
                        
                        =
                        
                           
                              10
                           
                           
                              6
                           
                        
                      in 2D case and 
                        
                           
                              N
                           
                           
                              
                                 OPT
                              
                           
                        
                        =
                        
                           
                              10
                           
                           
                              5
                           
                        
                      in 3D case. Other optimization parameters specific to each problem will be explained later.

The points 
                        
                           S
                        
                        
                           (
                           
                              
                                 
                                    u
                                 
                              
                              
                                 i
                              
                              
                                 k
                              
                           
                           )
                        
                      used for computing the variation in (4) are uniformly sampled in the parametric domain. The selection of reference shape 
                        
                           
                              
                                 S
                              
                           
                           
                              R
                           
                        
                      has no noticeable influence on the correspondence result as demonstrated in results below. In order to obtain a unique solution, one reference shape instance is chosen out the 
                        
                           
                              n
                           
                           
                              S
                           
                        
                      shapes, so that the optimization’s goal is to find 
                        
                           
                              n
                           
                           
                              S
                           
                        
                        −
                        1
                      reparameterization functions for the remaining shapes that minimize the objective function.

We test the correspondence with a synthetic plane-bump surface example: the surface is a bivariate Gaussian distribution function with surface point 
                           
                              (
                              x
                              ,
                              y
                              ,
                              z
                              )
                           
                         defined by 
                           
                              (37)
                              
                                 z
                                 =
                                 h
                                 
                                    
                                       e
                                    
                                    
                                       −
                                       
                                          
                                             
                                                
                                                   
                                                      (
                                                      x
                                                      −
                                                      μ
                                                      )
                                                   
                                                
                                                
                                                   2
                                                
                                             
                                          
                                          
                                             2
                                             
                                                
                                                   σ
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                    
                                 
                                 
                                    
                                       e
                                    
                                    
                                       −
                                       
                                          
                                             
                                                
                                                   
                                                      (
                                                      y
                                                      −
                                                      ν
                                                      )
                                                   
                                                
                                                
                                                   2
                                                
                                             
                                          
                                          
                                             2
                                             
                                                
                                                   ϕ
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                         where 
                           
                              (
                              μ
                              ,
                              ν
                              )
                           
                         is the mean and 
                           σ
                           =
                           ϕ
                         are the standard deviation along 
                           x
                         and 
                           y
                         direction; 
                           h
                         is the peak height. Restricting the distribution function to a square domain 
                           
                              [
                              0
                              ,
                              L
                              ]
                           
                           ×
                           
                              [
                              0
                              ,
                              L
                              ]
                           
                         that includes the mean point 
                           
                              (
                              μ
                              ,
                              ν
                              )
                           
                         gives the plane-bump geometry shown in Fig. 6
                        (a). Such a plane-bump shape can be approximated by a B-spline surface and Fig. 6(b) shows the shape represented by a bi-quadratic B-spline with 
                           11
                           ×
                           11
                         control points that fits the underlying Gaussian distribution surface. If 
                           ν
                           =
                           
                              
                                 L
                              
                              
                                 2
                              
                           
                         and 
                           R
                         are both locked and only the horizontal position along the 
                           x
                        -axis is allowed to move, then a training set of several synthetic plane-bump instances each of which is represented by B-splines are generated. The true shape variation pattern is obviously the translational motion along the 
                           x
                        -axis. Four shapes are generated as seen in Fig. 6(c), and their mean positions 
                           
                              
                                 μ
                              
                              
                                 1
                              
                           
                           ,
                           
                              
                                 μ
                              
                              
                                 2
                              
                           
                           ,
                           
                              
                                 μ
                              
                              
                                 3
                              
                           
                           ,
                           
                              
                                 μ
                              
                              
                                 4
                              
                           
                         are uniformly spaced. Each of the four plane-bump B-spline instances inherently implies a parameterization. During the generation of parameterization, attention is needed to introduce as little parameterization distortion as possible so as to greatly reduce the chance of under-sampling in later procedure. Fig. 6(b) shows the parameterization with fairly low distortion as indicated by its knot curves for Shape 1; the other three instances are similarly parameterized.

Due to the different bump locations along the 
                              x
                           -axis, the bumps for four shapes correspond to different areas in the parameter domain. This difference becomes very clear when we pick the same point in the parameter domain and compare their associated points in the physical domain for all the instances. Without loss of generality, we pick five parameter points: 
                              
                                 
                                    
                                       u
                                    
                                 
                                 
                                    A
                                 
                              
                              =
                              
                                 (
                                 0.45
                                 ,
                                 0.5
                                 )
                              
                              ,
                              
                                 
                                    
                                       u
                                    
                                 
                                 
                                    B
                                 
                              
                              =
                              
                                 (
                                 0.17
                                 ,
                                 0.5
                                 )
                              
                              ,
                              
                                 
                                    
                                       u
                                    
                                 
                                 
                                    C
                                 
                              
                              =
                              
                                 (
                                 0.73
                                 ,
                                 0.5
                                 )
                              
                              ,
                              
                                 
                                    
                                       u
                                    
                                 
                                 
                                    D
                                 
                              
                              =
                              
                                 (
                                 0.45
                                 ,
                                 0.22
                                 )
                              
                              ,
                              
                                 
                                    
                                       u
                                    
                                 
                                 
                                    E
                                 
                              
                              =
                              
                                 (
                                 0.45
                                 ,
                                 0.78
                                 )
                              
                           , associated with the five feature points on the bump of Shape 2 as shown in Fig. 10(a). Sampled at this common parameter point set, the physical points on the four shapes are different; the five points on Shape 4 are taken as an example in Fig. 10(b). The five feature points on Shape 2 denote the bump peak and four bump base quadrant points; they cover a square region in the parameter domain.

In the subsequent correspondence optimization, Shape 2 is chosen as the reference shape whose landmarks are kept fixed. The desired reparameterization functions for the other three shapes should be one that roughly translate the square region of Shape 2 to those on other shapes. Fig. 7
                           (a) gives a rough visualization of the parametric grid under the desired reparameterization function for Shape 4, i.e. the translational motion of square region from the left side (near Shape 2’s bump area) toward the right side (near Shape 4’s bump area).

It is possible to obtain the optimal correspondence through two reparameterization methods: concatenation of CPSs  [29] and B-splines. There are 
                              51
                              ×
                              51
                            landmark points (
                              
                                 
                                    n
                                 
                                 
                                    P
                                 
                              
                              =
                              2601
                           ) uniformly sampled in each shape; Shape 2 is chosen as the reference shape. After 
                              
                                 
                                    N
                                 
                                 
                                    
                                       OPT
                                    
                                 
                              
                              =
                              
                                 
                                    10
                                 
                                 
                                    5
                                 
                              
                            iterations of CPS warps, the deformed landmark grid (originally a regular 
                              51
                              ×
                              51
                            grid) under the optimized reparameterization function 
                              
                                 
                                    
                                       D
                                    
                                 
                                 
                                    4
                                 
                              
                              
                                 (
                                 
                                    u
                                 
                                 )
                              
                            in Fig. 7(b) approaches the desired trend shifting rightward along the 
                              x
                           -axis very similar to Fig. 7(a). The reparameterization functions for Shapes 2 and 3 are not shown but also exhibit similar trends.


                           Optimized reparameterization function. The desired optimization obtained by the CPS concatenation reparameterization can also be achieved via the B-spline reparameterization approach. Fig. 8
                           (d) shows the deformed landmark grid (originally a regular 
                              51
                              ×
                              51
                            grid) with 12×12 B-spline coefficients, which demonstrates similar motion in Fig. 7(b). The deformed landmark grid and control coefficients grid at different resolutions of 
                              4
                              ×
                              4
                           , 
                              8
                              ×
                              8
                            and 
                              12
                              ×
                              12
                            overlapped by the Jacobian color field are plotted in Fig. 8(a–c) respectively. The color plot indicates the Jacobian field on a fixed scale over 
                              
                                 [
                                 0
                                 ,
                                 2
                                 ]
                              
                           ; a color closer to red has a larger amount of stretch, whereas being closer to blue means a larger amount of compression.


                           Time cost comparison. The time cost of entire correspondence optimization at the three reparameterization B-spline resolutions, in comparison to that of the CPS concatenation reparameterization, is shown as the convergence curve of DL history w.r.t. to iteration/optimization number in Fig. 9
                           (a) and w.r.t. elapsed time in Fig. 9(b). It can be seen that in order to reduce the DL objective function to the same level around 45, the direct reparameterization by B-spline with 
                              12
                              ×
                              12
                            coefficients takes 668 iterations and 
                              3.4
                              ×
                              
                                 
                                    10
                                 
                                 
                                    3
                                 
                              
                              
                              
                                 s
                              
                           ; it is about one order of magnitude faster than the concatenation of CPS approach which takes 
                              5
                              ×
                              
                                 
                                    10
                                 
                                 
                                    4
                                 
                              
                            iterations and 
                              3
                              ×
                              
                                 
                                    10
                                 
                                 
                                    4
                                 
                              
                              
                              
                                 s
                              
                           .


                           Correspondence improvement after optimization. Fig. 10
                            demonstrates the significant correspondence improvement with optimization. Before optimization, the five points on Shape 4 shown in Fig. 10(b) corresponding to the five feature points fixed on the reference Shape 2 in Fig. 10(a) indicate a poor initial correspondence (Point A signifies bump peak on Shape 2, but it lies almost at left bump bottom on Shape 4). After optimization with 
                              
                                 
                                    n
                                 
                                 
                                    b
                                 
                              
                              =
                              12
                              ×
                              12
                            reparameterization B-spline control coefficients, the five corresponding feature points on Shape 4 are brought very close to the expected feature locations as shown in Fig. 10(c).


                           Constraint history and diffeomorphic conditions. Fig. 11
                            shows the aggregated constraints of directly sampled Jacobians during the optimization iterations with different B-spline coefficients of 
                              4
                              ×
                              4
                           , 
                              8
                              ×
                              8
                           , 
                              12
                              ×
                              12
                            and 
                              16
                              ×
                              16
                           . At the coarse representation (
                              
                                 
                                    n
                                 
                                 
                                    b
                                 
                              
                              =
                              4
                              ×
                              4
                           ), the 3 aggregated constraints for shapes 2, 3 and 4 are not active throughout the optimization process as shown in Fig. 11(a) where all constraint values are negative. As the B-spline resolution for reparameterization increases to 8×8, 12×12 and 16×16, some of the aggregated Jacobian become active (i.e. positive) as shown in Fig. 11(b–d). In the end, these violated constraints all converge to non-positive values, ensuring the diffeomorphism of the reparameterization.

In order to clearly demonstrate how the aggregated Jacobian constraints can guarantee a diffeomorphic reparameterization, we further increase the reparameterization B-spline resolution to 16×16. At resolution of 
                              12
                              ×
                              12
                            B-spline coefficients as shown in Fig. 8(c), although the aggregated Jacobian violates the constraint but the original Jacobian is still positive and no self-intersection exists. As the resolution further increases to 16×16, the aggregated constraint is more severely violated and finally the original Jacobian drops below zero and self-intersection takes place. The aggregated constraints history for the three non-reference shapes are shown in Fig. 11(d). We picked two particular iterations on the constraint history curve of Shape 4; one is where the aggregated constraint is most severely violated shown in square yellow marker called “Violated”, and the other is the ending iteration with active constraint shown in red circle marker called “resolved”.

The iteration with “violated” constraint is associated with the Jacobian field in Fig. 12
                           (a) with the aggregated constraint 
                              
                                 
                                    J
                                 
                                 
                                    
                                       aggrg
                                    
                                 
                              
                              =
                              0.33
                            and the minimum Jacobian values at landmarks are 
                              
                                 
                                    J
                                 
                                 
                                    
                                       min
                                    
                                 
                                 
                                    
                                       raw
                                    
                                 
                              
                              =
                              −
                              0.25
                            indicating a self-intersection at the vicinity of 
                              
                                 u
                              
                              =
                              
                                 (
                                 0.2
                                 ,
                                 0.5
                                 )
                              
                            enclosed by the dotted square. After the optimization iterations, the Jacobian of the reparameterization from the final iteration is shown in Fig. 12(b), and stops at an active aggregated constraint 
                              
                                 
                                    J
                                 
                                 
                                    
                                       aggrg
                                    
                                 
                              
                              =
                              4.019
                              ×
                              1
                              
                                 
                                    0
                                 
                                 
                                    −
                                    12
                                 
                              
                           , and the minimum Jacobian values for all 51×51 landmarks is 
                              
                                 
                                    J
                                 
                                 
                                    
                                       min
                                    
                                 
                                 
                                    
                                       raw
                                    
                                 
                              
                              =
                              0.27
                           . Fig. 12(c) and (d) shows the zoom-in around 
                              
                                 u
                              
                              =
                              
                                 (
                                 0.2
                                 ,
                                 0.5
                                 )
                              
                            of Fig. 12(a) and (b) where there is initially self-intersection and it has since been untangled. This illustrates that when the aggregated Jacobian constraint becomes inactive, the resulting reparameterization is diffeomorphic.


                           Jacobian constraint comparison: Jacobian B-splines and sampled Jacobians. In addition to using the aggregated sampled Jacobians 
                              
                                 
                                    J
                                 
                                 
                                    B
                                 
                              
                            in (24) as optimization constraint 
                              
                                 {
                                 
                                    
                                       g
                                    
                                    
                                       l
                                    
                                 
                                 
                                    (
                                    
                                       b
                                    
                                    )
                                 
                                 }
                              
                            via (35), the aggregated Jacobian B-spline option with 
                              
                                 
                                    J
                                 
                                 
                                    A
                                 
                              
                            as defined in (23) is also implemented for comparison. The time cost history between the two constraint options are shown in Fig. 13
                           , where slightly better computational efficiency with 
                              
                                 
                                    J
                                 
                                 
                                    A
                                 
                              
                            is observed.

In lightly of the ease of implementation using 
                              
                                 
                                    J
                                 
                                 
                                    B
                                 
                              
                            and the small difference in the optimization results, the sampled Jacobian positivity constraint option is adopted for all the 3D experiments in this paper.

Section  4.2 introduces the analytical gradient formula in the form of direct and adjoint sensitivities. Now we use the 3D plane-bump example presented above to demonstrate the accuracy, correctness and efficiency of computing analytical gradient by the adjoint method.

Within the context of the 3D plane-bump example in Section  5.1, the objective function’s analytical gradient 
                              
                                 
                                    
                                       d
                                    
                                    
                                    f
                                    
                                       (
                                       
                                          b
                                       
                                       )
                                    
                                 
                                 
                                    
                                       d
                                    
                                    
                                    
                                       
                                          b
                                       
                                       
                                          r
                                       
                                    
                                 
                              
                            can be compared with its numerical approximation in terms of accuracy and time cost. The analytical equation refers to the direct sensitivity in (28), (29) and the adjoint sensitivity in (33), (34). The numerical approximation uses the finite difference method 
                              
                                 
                                    
                                       
                                          
                                             d
                                          
                                          
                                          f
                                          
                                             (
                                             
                                                b
                                             
                                             )
                                          
                                       
                                       
                                          
                                             d
                                          
                                          
                                          
                                             
                                                b
                                             
                                             
                                                r
                                             
                                          
                                       
                                    
                                    ≈
                                    
                                       
                                          f
                                          
                                             (
                                             
                                                b
                                             
                                             +
                                             h
                                             
                                                
                                                   
                                                      e
                                                   
                                                
                                                
                                                   r
                                                
                                             
                                             )
                                          
                                          −
                                          f
                                          
                                             (
                                             
                                                b
                                             
                                             )
                                          
                                       
                                       
                                          h
                                       
                                    
                                 
                              
                            where the 
                              
                                 
                                    n
                                 
                                 
                                    b
                                 
                              
                              ×
                              1
                            unit vector 
                              
                                 
                                    
                                       e
                                    
                                 
                                 
                                    r
                                 
                              
                              =
                              
                                 
                                    
                                       [
                                       0
                                       ,
                                       …
                                       ,
                                       0
                                       ,
                                       1
                                       ,
                                       0
                                       ,
                                       …
                                       ,
                                       0
                                       ]
                                    
                                 
                                 
                                    T
                                 
                              
                            has “1” is in the 
                              r
                           -th row, and the small step length is 
                              h
                              =
                              1
                              
                                 
                                    0
                                 
                                 
                                    −
                                    6
                                 
                              
                           .


                           Table 1
                            compares the gradients between direct and adjoint sensitivity along with the numerical approximation. The landmark resolution is 
                              
                                 
                                    n
                                 
                                 
                                    P
                                 
                              
                              =
                              51
                              ×
                              51
                           , and reparameterization B-spline resolution is 
                              
                                 
                                    n
                                 
                                 
                                    b
                                 
                              
                              =
                              4
                              ×
                              4
                            as shown in Fig. 14
                           (a). There are total 
                              
                                 
                                    n
                                 
                                 
                                    D
                                 
                              
                              =
                              24
                            optimization variables for the three non-reference shapes, thus the gradient of the cost function has 24 elements. The table shows 8 gradient values out of 24 for all three gradient evaluation options. It can be that the two analytical sensitivities are very close to each other (consistent through the 9th digit), and numerical approximation gives slightly off result (consistent only till the 3rd digit).


                           Table 2
                            shows the time cost comparison between analytical and numerical gradient computations. The landmark resolution is 
                              
                                 
                                    n
                                 
                                 
                                    P
                                 
                              
                              =
                              51
                              ×
                              51
                           . The reparameterization B-spline coefficients’ resolution is
                              
                                 
                                    n
                                 
                                 
                                    b
                                 
                              
                              =
                              4
                              ×
                              4
                              
                                 
                                    n
                                 
                                 
                                    b
                                 
                              
                              =
                              8
                              ×
                              8
                           , 
                              
                                 
                                    n
                                 
                                 
                                    b
                                 
                              
                              =
                              12
                              ×
                              12
                            and 
                              
                                 
                                    n
                                 
                                 
                                    b
                                 
                              
                              =
                              16
                              ×
                              16
                           . It can be seen that the adjoint approach is the fastest, the direct one is slightly slower and numerical approximation is the slowest; the computational efficiency advantage is more noticeable as more B-spline coefficients (i.e. more optimization variables) are used for reparameterization.

Besides finite difference based numerical approximation of the gradient, one can also compare analytical gradient with the approximated direction derivatives. Fig. 14(a) shows the 4 coefficient points 
                              
                                 (
                                 
                                    
                                       b
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       b
                                    
                                    
                                       2
                                    
                                 
                                 )
                              
                              ,
                              
                                 (
                                 
                                    
                                       b
                                    
                                    
                                       3
                                    
                                 
                                 ,
                                 
                                    
                                       b
                                    
                                    
                                       4
                                    
                                 
                                 )
                              
                              ,
                              
                                 (
                                 
                                    
                                       b
                                    
                                    
                                       5
                                    
                                 
                                 ,
                                 
                                    
                                       b
                                    
                                    
                                       6
                                    
                                 
                                 )
                              
                              ,
                              
                                 (
                                 
                                    
                                       b
                                    
                                    
                                       7
                                    
                                 
                                 ,
                                 
                                    
                                       b
                                    
                                    
                                       8
                                    
                                 
                                 )
                              
                            associated with Shape 1. These 4 points along with the remaining 8 for the other two shapes are randomly placed in the parameter domain for testing purpose. We compute the directional derivative of the 1st coefficient point 
                              
                                 (
                                 
                                    
                                       b
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       b
                                    
                                    
                                       2
                                    
                                 
                                 )
                              
                            of Shape 1. We subdivide the full 360° range into 
                              
                                 
                                    n
                                 
                                 
                                    V
                                 
                              
                            angle intervals. The directional derivative at 
                              
                                 p
                              
                            along direction 
                              
                                 
                                    
                                       v
                                    
                                 
                                 
                                    i
                                 
                              
                            is approximated by finite difference as 
                              
                                 
                                    ∇
                                 
                                 
                                    
                                       
                                          
                                             v
                                          
                                       
                                       
                                          i
                                       
                                    
                                 
                              
                              f
                              
                                 (
                                 
                                    p
                                 
                                 )
                              
                              ≈
                              
                                 
                                    f
                                    
                                       (
                                       
                                          p
                                       
                                       +
                                       h
                                       
                                          
                                             
                                                v
                                             
                                          
                                          
                                             i
                                          
                                       
                                       )
                                    
                                    −
                                    f
                                    
                                       (
                                       
                                          p
                                       
                                       )
                                    
                                 
                                 
                                    h
                                 
                              
                           . When the full circle is equally subdivided into 
                              
                                 
                                    n
                                 
                                 
                                    V
                                 
                              
                              =
                              25
                            directions as shown in Fig. 14(b), the directional derivatives are plotted in arrows pointing in their respective directions. The directional derivative with the largest magnitude is identified as the numerical gradient, which is fairly close to the analytical gradient computed by adjoint formula shown in solid green. Table 3
                            compares the analytical gradient with the maximum directional derivatives computed for different number of angle intervals. The row of 
                              
                                 
                                    n
                                 
                                 
                                    V
                                 
                              
                              =
                              25
                            corresponds to the scenario in Fig. 14(b). It can be seen that the numerical results tend toward the analytical gradient as number of angle intervals increases.

The key advantage of the adjoint method for computing the sensitivity over the direct sensitivity lies in the efficiency gain when there are a large number of optimization variables. This is because, as shown in Section  4.2, the number of the linear system (29) solved in the direct sensitivity is proportional to the number of optimization variables and the number of eigenvalues. The number of linear system (33) solved in the adjoint sensitivity is proportional to the number of eigenvalues.

The number of optimization variables in optimizing shape correspondence depends on both the number of reparameterization coefficients per shape and the number of shapes used for building the SSM. Fig. 15
                           (a) shows the influence of the number of reparameterization (B-spline) coefficients 
                              
                                 
                                    n
                                 
                                 
                                    b
                                 
                              
                            on computation time when using direct and adjoint formulas. Here the landmark resolution is fixed at 
                              
                                 
                                    n
                                 
                                 
                                    P
                                 
                              
                              =
                              51
                              ×
                              51
                              =
                              2601
                            for 3D plane-bump, and shape number is fixed at 
                              
                                 
                                    n
                                 
                                 
                                    S
                                 
                              
                              =
                              4
                           . It can be observed that the computational time cost for the adjoint sensitivity barely increases as the reparameterization coefficients increase while the cost for the direct sensitivity increases significantly. Fig. 15(b) shows the influence of shape population size (shape number) 
                              
                                 
                                    n
                                 
                                 
                                    S
                                 
                              
                            on computation time when using direct and adjoint formulas. Here the reparameterization B-spline resolution is fixed at 
                              
                                 
                                    n
                                 
                                 
                                    b
                                 
                              
                              =
                              12
                              ×
                              12
                              =
                              144
                           , and the landmark resolution is fixed at 
                              
                                 
                                    n
                                 
                                 
                                    P
                                 
                              
                              =
                              51
                              ×
                              51
                              =
                              2601
                           . It can be observed that the adjoint formula is insensitive to the shape number and makes it very efficient for computing the correspondence sensitivity for a large shape population. In light of such significant efficiency advantage, the adjoint sensitivity is the method used in the subsequent numerical examples for correspondence optimization.

We test our correspondence optimization on a real data set from 40 raw images  [57]. One example image is shown in Fig. 16
                           (a). A quadratic B-spline is fit to each raw image of the hand contours and the control points and knots of a B-spline curve are shown in Fig. 16(b). The number of control points vary from 50 to 63 and generally different from one to another due to the slightly different shapes in different images. All the 40 B-spline represented hands are superimposed in Fig. 16(c). Since the generalized Procrustes Analysis involves iterative procedure and drastically slows down the entire correspondence optimization if it is included, the shape alignment is performed only once before the actual optimization. This practice further improves the computation efficiency and is observed to have little influence on the result compared to including alignment during every optimization iteration. The one-time alignment result is shown in Fig. 16(d).


                           Optimized reparameterization function and correspondence improvement. The reparameterization function is parameterized with 12 B-spline coefficients. The landmark resolution is 
                              
                                 
                                    n
                                 
                                 
                                    P
                                 
                              
                              =
                              151
                            and landmarks are sampled uniformly in the parameter domain before optimization. Shape 1 is selected as the reference shape. For brevity, only Shape 21 is picked out of the remaining 39 shapes to show the correspondence change before and after optimization.

The initial reparameterization function for optimization is the identity function. To obtain the desired reparameterization function for comparison, the original, manually marked 56 raw feature points accompanying the data set in  [57] are used to determine those parameters of the detailed feature points of all instances. The 56 features points are plotted on one raw image and the corresponding B-spline curve in Fig. 16(e) and (f), and they include the finger tips, gaps and knuckle points. Comparing the 56 corresponding parameters of all the 40 instances lead to the 39 desired reparameterization functions. The initial, desired, and optimized reparameterization functions of Shape 21 are then plotted in Fig. 17
                           (a). It can be seen that although the desired function is only a manual approximation under the guide of basic hand anatomy knowledge, the optimized correspondence matches with it very well. All the other 38 shapes exhibit this similar results although not shown here.

Out of the 56 original feature points from the images, we plot 11 key feature points for a more clear demonstration of correspondence improvement due to the optimization. The 11 feature points located at finger tips and valleys on the reference Shape 1 is shown in Fig. 17(b). Before optimization the corresponding points on Shape 21 that have the same parameters as those on Shape 1 are situated at the positions displayed in Fig. 17(c), where most feature points are far away from the finger tips/valleys where they are expected to be. After optimization, they are brought to the locations in good correspondence to the feature points on Shape 1 as shown in Fig. 17(d).


                           Statistical modes improvement. Figs. 18 and 19
                           
                            respectively show the first two modes of variations from the statistical models with and without correspondence optimization. It can be seen that the shape variation without the optimization is highly improbable: the middle and index fingers are all out of proportion in length and width. The first mode of the statistical model before correspondence optimization is only 31.48% of the total variation. The shape variation from the optimized correspondence looks realistic. The first mode of the statistical model with correspondence optimization is 50.24% of the total variation. Such differences in shape variations from the models are a direct consequence of the optimized correspondence from Fig. 17(c) to Fig. 17(d) as compared to Fig. 17(b).


                           SSM evaluation measure improvement. To further compare the quality improvement of the statistical model before and after optimization, the three quantitative measures of SSM proposed in  [29] are computed. Fig. 20
                            compares the generalization ability, specificity and compactness error  [29] before and after correspondence optimization.

The quantitative measure of the generalization ability is achieved by the leave-one-out procedure, where one shape is chosen to compare with its reconstructed shape by the statistical model built from the remaining 
                              
                                 
                                    n
                                 
                                 
                                    S
                                 
                              
                              −
                              1
                            shapes. More specifically, the reconstructed shape 
                              
                                 
                                    
                                       
                                          
                                             x
                                          
                                       
                                       
                                          ̃
                                       
                                    
                                 
                                 
                                    i
                                 
                              
                            for the 
                              i
                           -th shape 
                              
                                 
                                    
                                       x
                                    
                                 
                                 
                                    i
                                 
                              
                            can be obtained using (9). Varying the number of modes 
                              
                                 
                                    n
                                 
                                 
                                    m
                                 
                              
                            for the linear approximation, the leave-one-out generalization measure of SSM is given by 
                              
                                 (38)
                                 
                                    
                                       
                                          E
                                       
                                       
                                          G
                                       
                                    
                                    
                                       (
                                       
                                          
                                             n
                                          
                                          
                                             m
                                          
                                       
                                       )
                                    
                                    =
                                    
                                       
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                S
                                             
                                          
                                       
                                    
                                    
                                       
                                          ∑
                                       
                                       
                                          i
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                S
                                             
                                          
                                       
                                    
                                    
                                       ‖
                                       
                                          
                                             
                                                x
                                             
                                          
                                          
                                             i
                                          
                                       
                                       −
                                       
                                          
                                             
                                                
                                                   
                                                      x
                                                   
                                                
                                                
                                                   ̃
                                                
                                             
                                          
                                          
                                             i
                                          
                                       
                                       ‖
                                    
                                    .
                                 
                              
                            The standard error of generalization measure is defined by 
                              
                                 (39)
                                 
                                    
                                       
                                          σ
                                       
                                       
                                          G
                                       
                                    
                                    
                                       (
                                       
                                          
                                             n
                                          
                                          
                                             m
                                          
                                       
                                       )
                                    
                                    =
                                    
                                       
                                          σ
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      S
                                                   
                                                
                                                −
                                                1
                                             
                                          
                                       
                                    
                                 
                              
                            where 
                              σ
                            is the sample standard deviation of 
                              
                                 
                                    E
                                 
                                 
                                    G
                                 
                              
                              
                                 (
                                 
                                    
                                       n
                                    
                                    
                                       m
                                    
                                 
                                 )
                              
                           .

A third useful quantitative measure is the compactness error defined by 
                              
                                 (40)
                                 
                                    
                                       
                                          E
                                       
                                       
                                          C
                                       
                                    
                                    
                                       (
                                       
                                          
                                             n
                                          
                                          
                                             m
                                          
                                       
                                       )
                                    
                                    =
                                    
                                       
                                          ∑
                                       
                                       
                                          m
                                          =
                                          1
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                m
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             
                                                2
                                             
                                             
                                                
                                                   
                                                      n
                                                   
                                                   
                                                      S
                                                   
                                                
                                             
                                          
                                       
                                    
                                    
                                       
                                          λ
                                       
                                       
                                          m
                                       
                                    
                                    .
                                 
                              
                           
                        

It can be seen that the optimized statistical model’s quality has significantly improved in that the optimized correspondence with SSM leads to smaller error than that of the initial correspondence for all three measures.


                           Time cost comparison. The time efficiency between the concatenation of Cauchy kernels and B-spline based reparameterization at coefficient resolution of 
                              
                                 
                                    n
                                 
                                 
                                    b
                                 
                              
                              =
                              4
                              ,
                              12
                              ,
                              20
                            are compared in Fig. 21
                           , where the DL history is plotted with respect to both optimization/iteration number and time cost in seconds. In order for DL to reach the level of 620, Cauchy kernel concatenation takes 
                              
                                 
                                    10
                                 
                                 
                                    5
                                 
                              
                            iterations and 
                              1.6
                              ×
                              
                                 
                                    10
                                 
                                 
                                    5
                                 
                              
                              
                              
                                 s
                              
                           , and direct reparameterization with B-spline at resolution 
                              
                                 
                                    n
                                 
                                 
                                    b
                                 
                              
                              =
                              12
                            only needs 502 iterations and 
                              1.3
                              ×
                              
                                 
                                    10
                                 
                                 
                                    3
                                 
                              
                              
                              
                                 s
                              
                           . Therefore the B-spline based direct reparameterization is around 100 times more efficient than the concatenation of Cauchy kernels based reparameterization.

The second real data set is a group of 34 human femoral bones. In this study, we focus on the shape variation of the distal femur portion, which is separated from the whole femur with a manual planar cut for each shape instance. Fig. 22
                           (a) shows the distal femur shape instance of Shape 1 as an example. For our pre-processing of the mesh models into the B-spline surfaces, we obtain the mesh parameterization with a method proposed in  [58] that map an open mesh into a rectangle domain. To enhance the mesh parameterization and to avoid unevenness of the triangles in the parametric domain, a stretch measure suggested in  [59] is then minimized and the obtained mesh parameterization is shown in Fig. 22(b).

The 4 corners denoted by 
                              A
                              ,
                              B
                              ,
                              C
                              ,
                              D
                            for each mesh are manually chosen and considered to be in good correspondence across the training set, so that only the interior correspondence needs to be optimized. With the parameterization of each mesh vertex, a bi-quadratic B-spline surface of 30×30 control points is then fit on each shape. The resulting B-spline representation of the mesh shown in Fig. 22(a) is now shown in Fig. 22(c) and (d). This B-spline represented shape provides a differentiable shape representation for correspondence manipulation. Similar to the hand example, a one-time alignment is performed only once before the correspondence optimization. It is done by aligning the triangle meshes with the Iterative Closest Point algorithm.

In the optimization, Shape 1 is selected as reference. Totally 51×51 landmarks are sampled uniformly in the parametric domain of each shape. When the reparameterization B-spline coefficients resolution is chosen to be a 
                              8
                              ×
                              8
                            grid, the objective DL history is shown in Fig. 23
                           (a), and the deformed parameterization grid under the optimized reparameterization function for Shape 34 is visualized in Fig. 23(b). The quantitative evaluation of the optimized SSM in generalization, specificity error and compactness are also performed and sizable improvements similar to Fig. 20 are observed.


                           Fig. 24
                            shows the time cost comparison between concatenations of Clamped Plate Spline warps (optimization stopped till the 
                              
                                 
                                    10
                                 
                                 
                                    4
                                 
                              
                           -th iteration) vs. direct B-spline based reparameterization (B-spline coefficients grid from 
                              4
                              ×
                              4
                            to 
                              9
                              ×
                              9
                           ) for correspondence optimization for this femur data set. It can be seen that the direct approach with 
                              6
                              ×
                              6
                            reaches the same level of DL around 585 at approximately two orders of magnitude more efficient rate. With the further increase of the resolution (i.e. the number of B-spline coefficients) of the B-spline reparameterization functions, the DL can be reduced further than that of concatenation of CPSs, although the computational efficiency advantage becomes gradually less noticeable.

@&#CONCLUSION@&#

This paper introduces a novel reparameterization based method for population-based correspondence optimization for statistical shape modeling. Each shape instance is represented as a differentiable B-spline surface. The reparameterization of each surface is also represented via B-splines. The diffeomorphic reparameterization is cast as constraints on the B-spline coefficients. This resulting large-scale optimization is then solved via a gradient based approach. To facilitate the convergence, full analytical gradients of the cost function (i.e. description length) with respect to manipulation parameters (i.e. B-spline coefficients) have been derived. The adjoint approach for computing the gradient has found to be especially efficient.

This B-spline based direct diffeomorphic reparameterization is found to be effective on a set of both synthetic and real data sets. It typically achieves more than one orders of magnitude speed gain than concatenation of simple mapping based reparameterization methods such as Cauchy kernels and CPS warps for correspondence optimization.

In this paper, B-splines are used for both shape representation 
                        
                           S
                        
                        
                           (
                           
                              u
                           
                           )
                        
                      and reparameterization 
                        
                           D
                        
                        
                           (
                           
                              u
                           
                           )
                        
                      as in 
                        
                           S
                        
                        
                           (
                           
                              D
                           
                           
                              (
                              
                                 u
                              
                              )
                           
                           )
                        
                     . Such a combination makes it possible to directly use reparameterization variables to control the movement of landmarks on the surface shapes in a differentiable manner. Such differentiability makes it possible to develop the efficient gradient based approach for optimizing correspondence across a large shape population. However, B-spline based shape representation is limited to rectangular-like shapes. Alternative parameterization techniques that are applicable to shapes of complex topology are of interest for future research.

@&#ACKNOWLEDGMENTS@&#

The authors acknowledge the financial support of AFOSR grant FA9550-12-1-0206 and NSF grants #0900597 and #1030347. We are also thankful for the data sources: (1) Active Appearance Models group at Technical University of Denmark for hand data; (2) Dr. Alejandro A. Espinoza Orías at Rush University Medical Center for the femoral bone data.

@&#REFERENCES@&#

