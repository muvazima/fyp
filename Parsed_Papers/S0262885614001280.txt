@&#MAIN-TITLE@&#Partial least squares-based human upper body orientation estimation with combined detection and tracking

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           We propose a method for estimating the human upper body orientation.


                        
                        
                           
                           Our algorithm uses partial least squares-based gradient and texture feature models.


                        
                        
                           
                           Integration with an UKF-based movement prediction increases the performance.


                        
                        
                           
                           Comparison with the state-of-the-art shows the benefit of our algorithm.


                        
                        
                           
                           Experiment results using image, video, and camera are provided.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Human upper body orientation

Partial least squares

Multi-level HOG-LBP

Random Forest classifier

UKF tracker

@&#ABSTRACT@&#


               
               
                  This paper deals with the problem of estimating the human upper body orientation. We propose a framework which integrates estimation of the human upper body orientation and the human movements. Our human orientation estimator utilizes a novel approach which hierarchically employs partial least squares-based models of the gradient and texture features, coupled with the random forest classifier. The movement predictions are done by projecting detected persons into 3D coordinates and running an Unscented Kalman Filter-based tracker. The body orientation results are then fused with the movement predictions to build a more robust estimation of the human upper body orientation. We carry out comprehensive experiments and provide comparison results to show the advantages of our system over the other existing methods.
               
            

@&#INTRODUCTION@&#

Human body orientation estimation is one of challenging yet useful tasks for the mobile robot and surveillance applications. The human body orientation can tell us how people interact with each other in the surveillance scenes. For example, we may predict that a group of persons facing each other for a long time are having conversation, or other social semantic predictions such as waiting for the bus together.

From the mobile robots point of view, the human body orientation can assist the robot to get a better prediction for avoiding a person when doing navigation tasks. It also helps the robot to make a social interaction with the human in outdoor navigation, such as approaching a person and asking the way. Here the robot certainly needs the estimation of human orientation for facing the person.

Several works try to accomplish the human body orientation problem. Andriluka et al. [3] use banks of viewpoint specific part based detectors and linear Support Vector Machine (SVM) for estimating the whole body orientation. Another recent work is done by Weinrich et al. [4] which performs the human upper body orientation estimation using Histogram of Oriented Gradient (HOG) features and SVM Tree. A work by Baltieri et al. [21] employ a Mixture of Approximated Wrapped Gaussian (MoAWG) weighted by the detector outputs for increasing the correct estimation rates. The above researchers do not consider how the person movements will affect the overall estimation results.

One notable work by Chen et al. [5] uses multi-level HOG features and sparse representation for classifying the human pose. They also employ a soft-coupling technique between the whole body orientation and its velocity using the particle filter framework.

To solve the problems we have mentioned above, here we propose a system for detecting and estimating the human upper body orientation, as well as its motion. We prefer to use the upper body part rather than the whole body for gaining the robustness under occlusion; the full body is often partially occluded by small objects such as chair, table, bicycle, and so on.

Our main contribution resides in the use of the partial least squares (PLS)-based model of gradient and texture features for estimating the human upper body orientation. Here, our PLS model is a modification of the one used in [16] which has been successfully applied for human detection. We also provide an Unscented Kalman Filter (UKF) framework integrating the human movement prediction and the orientation estimation for improving the estimation results.

We organize the paper as follows. First we describe the detection and estimation of human upper body orientation using partial least squares models in Section 2. Section 3 explains the integration of the orientation estimation results and the tracking. We then provide the comparison of several methods and the result of extensive experiments in Section 4. Lastly, we conclude our work and give some possible future works.

Our system is built in a hierarchical manner. First we detect and create bounding boxes around the human upper body using a fast detector. These detection results are then fed to the orientation estimator part. We divide the orientation into eight quantization (see Fig. 1
                        ). Results from the detector and the orientation estimator are used as the observation inputs for the tracker. Fig. 2
                         explains our framework on the human upper body orientation estimation as described above.

Our system is composed of the image-based orientation estimation and the tracking system (see Fig. 2). The influence between the systems is one-directional. That is, the orientation estimation system runs independently, and its results are used by the tracking system for increasing the robustness of its pose and motion estimation. This also implies that the orientation estimation system can be applied to still images.

Histogram of Oriented Gradients (HOG) [1] is one of state-of-the-art descriptor for the whole body person detection. However, the original HOG algorithm is slow and unsuitable for the real time applications. Here we exploit the extended work of HOG by [12], which employs Adaboost for selecting features and cascade rejection for speeding up the detection time. Instead of using the whole human body, we prefer to exploit the upper body part for gaining the robustness under occlusion, as we will show in Section 4.2. The detection results (bounding boxes of the human upper body) are then used as the input for the orientation estimator part.

The other works (e.g. [4] and [5]) solely depend on the gradient features, which capture the body shape. For the human upper body orientation case, we make an assumption that using only the body shape is not enough, for example, there is no big difference between the shape of the body facing front and back. Therefore, we propose a combination of the gradient-based and texture-based features which grab the shape and the texture cues. Here we expect the textured part of the body such as the face will be captured. We then apply the modified partial least squares (PLS) models for enhancing the important cues of the human orientation.

For capturing the human upper body shape, we use a multi-level HOG descriptor [1]. The gradient magnitude for each upper body image sample is first computed using 1-D mask [−1 0 1] on each x and y direction. Every sample is divided into 3×4, 6×8, and 12×16 blocks, where each block consists of four cells. The gradient orientation is then quantized into nine bins. Overall we have 252 blocks and 9072 dimensional feature vectors of HOG descriptor.

We use Local Binary Pattern (LBP), adopting the work of [2], to make a texture descriptor. We calculate image textures using LBP8,1 operator for each pixel
                              
                                 (1)
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      I
                                                      LBP
                                                   
                                                   c
                                                
                                             
                                             =
                                             
                                                
                                                   ∑
                                                   
                                                      p
                                                      =
                                                      0
                                                   
                                                   7
                                                
                                                
                                                   
                                                      2
                                                      p
                                                   
                                                   ς
                                                   
                                                      
                                                         
                                                            I
                                                            p
                                                         
                                                         −
                                                         
                                                            I
                                                            c
                                                         
                                                      
                                                   
                                                   ,
                                                
                                             
                                          
                                          
                                             ς
                                             
                                                a
                                             
                                             =
                                             
                                                
                                                   
                                                      
                                                         1
                                                      
                                                      
                                                         for
                                                         
                                                         a
                                                         ≥
                                                         0
                                                      
                                                   
                                                   
                                                      
                                                         0
                                                      
                                                      
                                                         otherwise
                                                         ,
                                                      
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           where I
                           
                              c
                            is the center pixel from which we calculate the LBP value I
                           LBPc
                            and p is eight-surrounding pixels of I
                           
                              c
                           . We then divide the LBP images into multiple blocks similar to the HOG features above. For each block, we make a histogram containing 59 labels based on uniform patterns.
                              1
                           
                           
                              1
                              According to the original paper [2], the uniform patterns contain at most two bit transitions from 0 to 1 and vice versa. For an 8-bit data, there are 58 uniform patterns, and the other patterns which have more than two bit transitions are grouped into one label, so we have the total 59 labels.
                            This procedure gives us 14,868 dimensional feature vectors in total.

Partial least squares (PLS) is a statistical method used for obtaining relations between sets of observed variables through the estimation of a low dimensional latent space which maximizes the separation between samples with different characteristics []. The PLS builds new predictor variables called latent variables, as combinations of a matrix 
                              X
                            of the descriptor variables (features) and a vector 
                              y
                            of the response variables (class labels).

Let us consider a problem with γ samples, 
                              X
                           
                           ⊂ℝ
                              δ
                            be an δ-dimensional space representing the feature vectors and y
                           ⊂ℝ denote a 1-dimensional space of the class labels. The PLS then decomposes the (γ
                           ×
                           δ) matrix of zero mean variables 
                              X
                            and the vector of zero mean variables y into
                              
                                 (2)
                                 
                                    
                                       
                                          
                                             X
                                             =
                                             T
                                             
                                                P
                                                T
                                             
                                             +
                                             E
                                             ,
                                          
                                       
                                       
                                          
                                             y
                                             =
                                             U
                                             
                                                q
                                                T
                                             
                                             +
                                             r
                                             ,
                                          
                                       
                                    
                                 
                              
                           where 
                              T
                            and 
                              U
                            represent (γ
                           ×
                           s) matrices of s extracted latent vectors, the (δ
                           ×
                           s) matrix 
                              P
                            and the (1×
                           s) vector 
                              q
                            are the loadings, and the (γ
                           ×
                           δ) matrix 
                              E
                            and the (γ
                           ×1) vector 
                              r
                            are the residuals.

Here we implement the nonlinear iterative partial least squares (NIPALS) algorithm [17] to find a set of projection vectors (weight vectors) 
                              W
                           
                           ={
                              w
                           
                           1,
                           
                              w
                           
                           2,…,
                           
                              w
                           
                           
                              s
                           }such that
                              
                                 (3)
                                 
                                    
                                       
                                          
                                             cov
                                             
                                                
                                                   t
                                                   i
                                                
                                                
                                                   u
                                                   i
                                                
                                             
                                          
                                       
                                       2
                                    
                                    =
                                    
                                       max
                                       
                                          |
                                          
                                             w
                                             i
                                          
                                          |
                                          =
                                          1
                                       
                                    
                                    
                                       
                                          
                                             cov
                                             
                                                
                                                   X
                                                   
                                                      w
                                                      i
                                                   
                                                   ,
                                                   y
                                                
                                             
                                          
                                       
                                       2
                                    
                                    ,
                                 
                              
                           where 
                              t
                              i
                            is the i-th column of matrix 
                              T
                           , 
                              u
                              i
                            is the i-th column of matrix 
                              U
                           , and cov(
                              t
                           
                           
                              i
                           ,
                           
                              u
                           
                           
                              i
                           ) is the sample covariance between latent vectors 
                              t
                              i
                            and 
                              u
                              i
                           . The process of constructing projection vectors 
                              W
                            is shown in Algorithm 1.
                              Algorithm 1
                              PLS/NIPALS algorithm
                                    
                                       
                                    
                                 
                              

Here we introduce our PLS-based feature models, Block Importance Feature Model of PLS (BIFM-PLS). We also provide another simple PLS model called Combined Feature Model of PLS (CFM-PLS) for comparison purpose.

The Combined Feature Model of PLS (CFM-PLS) is created by concatenating all of HOG–LBP features into one vector, and simply run the PLS algorithm on it with specified number of the latent vectors. As the result, the CFM-PLS produces a reduced set of features by projecting the feature vectors 
                              f
                           
                           ⊂
                           
                              X
                            onto the weight vectors,
                              
                                 (4)
                                 
                                    
                                       x
                                       ⌣
                                    
                                    =
                                    Wf
                                    .
                                 
                              
                           
                        

This result is then used as the input for the classifier. Fig. 3
                            explains the procedure of building CFM-PLS.

The CFM-PLS method, which resembles an ordinary PLS technique, is only used for comparison purposes, and from now we focus on the BIFM-PLS method.

The Block Importance Feature Model of PLS (BIFM-PLS) is built by an idea that not all of blocks or features have a high contribution to the classification. Here we want to examine the contribution of each block and discard the one which has low importance. Unlike the CFM-PLS which highly reduces the feature space, the BIFM-PLS is intended to retain some details about the features to be fed up to the classifier.

We adopt and extend the method of [16] for picking out the representative blocks. For creating BIFM-PLS, we employ the feature selection called Variable Importance on Projection (VIP) (see [16] and [18]). The VIP gives a score for each feature representing its predictive power in the PLS model. The VIP of the i-th feature 
                              f
                            is given by
                              
                                 (5)
                                 
                                    VI
                                    
                                       P
                                       i
                                    
                                    
                                       f
                                    
                                    =
                                    
                                       
                                          
                                             κ
                                             
                                                
                                                   ∑
                                                   
                                                      j
                                                      −
                                                      1
                                                   
                                                   p
                                                
                                                
                                             
                                             
                                             
                                                b
                                                j
                                                2
                                             
                                             
                                                w
                                                ij
                                                2
                                             
                                          
                                          
                                             
                                                
                                                   ∑
                                                   
                                                      j
                                                      =
                                                      1
                                                   
                                                   p
                                                
                                                
                                             
                                             
                                             
                                                b
                                                j
                                                2
                                             
                                          
                                       
                                    
                                    ,
                                 
                              
                           where κ is the number of features, 
                              w
                           
                           
                              ij
                            denotes the i-th element of vector 
                              w
                           
                           
                              j
                           , and b
                           
                              j
                            represents the regression weight for the j-th latent variable, b
                           
                              j
                           
                           =
                           
                              u
                           
                           
                              j
                           
                           
                              T
                           
                           
                              t
                           
                           
                              j
                           .

We then extend the definition of VIP by introducing block importance score (BIS). The BIS ranks the predictive power of each block in the PLS model. The BIS on a multi-level blocks exhibits a “hierarchical” modeling, which first tries to find the important blocks from the multi-level/multi-size blocks and retrieve more detail information from the blocks which have better importance score. Algorithm 2 and Fig. 4
                            show the procedure of creating the BIFM-PLS model.

The BIFM-PLS algorithm consists of two important stages: building the block importance and projecting the features on the important block. Let n be the number of blocks for each HOG and LBP features, m be the total number of concatenated HOG-LBP features in one block, 
                              f
                           
                           
                              i
                            denotes the feature sets at the i-th block, and 
                              f
                           
                           
                              i,j
                            represents the j-th feature at the i-th block with i
                           ={1,…,
                           n} and j
                           ={1,…,
                           m}.

In the first stage, we extract a PLS model, take first p
                           1 latent variables for each block, and concatenate them to build a model 
                              f
                           
                           
                              first
                           , as follows
                              
                                 (6)
                                 
                                    
                                       f
                                       i
                                       first
                                    
                                    =
                                    PLS
                                    
                                       
                                          f
                                          i
                                       
                                       
                                          p
                                          1
                                       
                                    
                                    ,
                                 
                              
                           where PLS(
                              f
                           
                           
                              i
                           ,
                           p
                           1) is a function for extracting p
                           1 elements from 
                              f
                           
                           
                              i
                           . Here 
                              f
                           
                           
                              i
                           
                           
                              first
                            has element 
                              
                                 f
                                 
                                    i
                                    ,
                                    
                                       j
                                       1
                                    
                                 
                                 first
                              
                            where j
                           1
                           ={1,…,
                           p
                           1}.

We assume that a small number of p
                           1 are enough to see the contribution of each block to the orientation estimation, since the PLS considers the response variables (i.e. class labels). To see the importance of each block, we compute the VIP scores using Eq. (5) and get the block importance score (BIS) as
                              
                                 (7)
                                 
                                    
                                       
                                          BIS
                                          i
                                       
                                    
                                    =
                                    
                                       1
                                       
                                          p
                                          1
                                       
                                    
                                    
                                       
                                          ∑
                                          
                                             
                                                j
                                                1
                                             
                                             =
                                             1
                                          
                                          
                                             p
                                             1
                                          
                                       
                                       
                                    
                                    
                                    VIP
                                    
                                       
                                          f
                                          
                                             i
                                             ,
                                             
                                                j
                                                1
                                             
                                          
                                          first
                                       
                                    
                                    ,
                                    i
                                    =
                                    1
                                    ,
                                    …
                                    ,
                                    n
                                    .
                                 
                              
                           
                        

The top part of Fig. 4 shows the processes explained by Eqs. (6) and (7) above.

In the second stage, we build the BIFM feature vectors by calculating and concatenating the first p
                           2 latent variables on the important blocks, similar to Eq. (6)
                           
                              
                                 (8)
                                 
                              
                           
                        

The blocks which have BIS under the threshold 
                              
                           , which mean less important blocks, are then discarded. These procedures are illustrated by the bottom part of Fig. 4.

Here we use p
                           2
                           >
                           p
                           1, to get more detail information on each important block. We will examine the proper value of p
                           1 and p
                           2 in the experimental section (Section 4.4).
                              Algorithm 2
                              BIFM-PLS algorithm
                                    
                                       
                                    
                                 
                              

One of the notable classifier which works well on the multi-class data is Random Forest, introduced by Breiman [8]. It is an ensemble learning method which combines the prediction of many decision trees using a majority vote mechanism. The Random Forest is devoted for its accuracy on the large dataset and multi-class learning. These advantages make us choose the Random Forest for training our eight-orientation classification problem with a large set of features.

Our Random Forest is constructed by multiple trees T
                        ={T
                        1,
                        T
                        2,…,
                        T
                        
                           N
                        }, where N is number of trees. Let 
                           
                              
                                 
                                    
                                       d
                                       i
                                    
                                    ∈
                                    D
                                 
                              
                              
                                 i
                                 =
                                 1
                                 …
                                 K
                              
                           
                         denote K training sets and 
                           
                              
                                 
                                    
                                       c
                                       i
                                    
                                    ∈
                                    C
                                 
                              
                              
                                 i
                                 =
                                 1
                                 …
                                 K
                              
                           
                         be its corresponding labels or classes (in our case, we have eight classes, 
                           C
                           =
                           
                              
                                 C
                                 1
                              
                              
                                 C
                                 2
                              
                              …
                              
                                 C
                                 8
                              
                           
                        ), where 
                           D
                           ⊂
                           
                              ℝ
                              M
                           
                         is the feature space. In the training phase, the Random Forest learns the classification function 
                           T
                           :
                           D
                           →
                           C
                        . Details of the Random Forest algorithm can be discovered at the original paper [8].We use a linear split function [19]
                        
                           
                              (9)
                              
                                 Φ
                                 
                                    f
                                 
                                 =
                                 
                                    q
                                    T
                                 
                                 f
                                 +
                                 z
                                 ,
                              
                           
                        where q is a vector which has the same dimensions as the feature vector 
                           f
                         and 
                           z
                         is a random number. The recursive training is run until the stopping criteria are reached, i.e. the maximum depth is met or no further information gain can be drawn.

In the testing phase, for a test case d, the Random Forest provides the posterior probability of each class as
                           
                              (10)
                              
                                 p
                                 
                                    
                                       c
                                       |
                                       d
                                    
                                 
                                 =
                                 
                                    1
                                    N
                                 
                                 
                                    
                                       ∑
                                       
                                          i
                                          =
                                          1
                                       
                                       N
                                    
                                    
                                 
                                 
                                 
                                    p
                                    i
                                 
                                 
                                    
                                       c
                                       |
                                       d
                                    
                                 
                                 ,
                              
                           
                        where
                           
                              (11)
                              
                                 
                                    p
                                    i
                                 
                                 
                                    
                                       c
                                       |
                                       d
                                    
                                 
                                 =
                                 
                                    
                                       Λ
                                       
                                          i
                                          ,
                                          c
                                       
                                    
                                    
                                       
                                          
                                             ∑
                                             
                                                j
                                                =
                                                
                                                   c
                                                   1
                                                
                                             
                                             
                                                c
                                                8
                                             
                                          
                                          
                                       
                                       
                                       
                                          Λ
                                          
                                             i
                                             ,
                                             j
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                        
                        p
                        
                           i
                        (c|d) is the probability estimation of class 
                           c
                           ∈
                           C
                         given by the i
                        
                           th
                         tree, and Λ
                        
                           i,c
                         is the number of leaves in the i
                        
                           th
                         tree which votes for class c. The overall multi-class decision function of the forest is then defined as
                           
                              (12)
                              
                                 C
                                 
                                    d
                                 
                                 =
                                 arg
                                 
                                    max
                                    
                                       c
                                       ∈
                                       C
                                    
                                 
                                 p
                                 
                                    
                                       c
                                       |
                                       d
                                    
                                 
                                 .
                              
                           
                        
                     

In the normal situation, the possibility that the person body orientation will be the same with its movements increases along with its speed. Based on this observation, our orientation estimation system is built using an assumption that the human body orientation is aligned with the direction of the human movements. In this case, we utilize both the result of the orientation detections and that of human movement estimation. On the opposite, we only rely on the orientation information from detections when the human movements are slow or even in a static condition.

To handle those matters, we predict the movement of persons in the world coordinate. We then use the UKF framework to combine the orientation estimation from the detection results and the movement predictions. The idea of coupling the detection result and the person movement is also used by [5], but at least three (3) things distinct our works from the [5]; the baseline (upper body vs whole body), features (HOG–LBP–PLS vs Sparse-HOG), and the framework (UKF vs particle filter).

We derive movement of the persons from the change of their positions. We follow the work of [9] and [10] for projecting the position of each detected person from the 2D image coordinate to the 3D world coordinate. Let us consider a pinhole camera model, with the following parameters: focal length f
                        
                           c
                        , camera height y
                        
                           c
                        , horizontal center point μ
                        
                           c
                        , and horizon position ν
                        0. According to [10], the projection to the world coordinate is given by
                           
                              (13)
                              
                                 
                                    W
                                    d
                                 
                                 =
                                 
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      y
                                                      c
                                                   
                                                   
                                                      
                                                         
                                                            μ
                                                            d
                                                         
                                                         −
                                                         
                                                            μ
                                                            c
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      ν
                                                      d
                                                   
                                                   −
                                                   
                                                      ν
                                                      0
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      f
                                                      c
                                                   
                                                   
                                                      y
                                                      c
                                                   
                                                
                                                
                                                   
                                                      ν
                                                      d
                                                   
                                                   −
                                                   
                                                      ν
                                                      0
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      h
                                                      d
                                                   
                                                   
                                                      y
                                                      c
                                                   
                                                
                                                
                                                   
                                                      ν
                                                      d
                                                   
                                                   −
                                                   
                                                      ν
                                                      0
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                        where (μ
                        
                           d
                        ,
                        ν
                        
                           d
                        ) is the bottom center point of the extended bounding box,
                           2
                        
                        
                           2
                           The extended bounding box is calculated by scaling the height of the bounding box to that of the human body, so that the bottom center is on the ground plane.
                         andh
                        
                           d
                         is the height of each detected person d in the 2D image. Vector W
                        
                           d
                        
                        =[x
                        
                           d
                        
                        
                           world
                        ,
                        y
                        
                           d
                        
                        
                           world
                        ,
                        h
                        
                           d
                        
                        
                           world
                        ]
                           T
                         denotes the position (x
                        
                           d
                        
                        
                           world
                        ,
                        y
                        
                           d
                        
                        
                           world
                        ) in the real world relative to the camera position and the height h
                        
                           d
                        
                        
                           world
                         of the detected person d in the image.

The horizon position v
                        0 is obtained by collecting line segments in the image using Hough line detector and running RANSAC to evaluate all segments and get the intersection. This horizon estimation is done off-line
                           3
                        
                        
                           3
                           To keep the speed of algorithm, we compute and use the horizon estimate as a constant. We assume the camera tilt is small (or in other words, the ground plane where the robot runs is flat).
                         and we use it as a pre-calibrated value for the on-line tracking. For each frame, we send the position (x
                        
                           d
                        
                        
                           world
                        ,
                        y
                        
                           d
                        
                        
                           world
                        ) to the tracker for getting the movement estimation in the real world.

Our state model is decomposed from the person position (x
                           
                              k
                           ,
                           y
                           
                              k
                           ), its derivative (
                              
                                 
                                    
                                       x
                                       ˙
                                    
                                    k
                                 
                              
                              ,
                              
                                 
                                    
                                       y
                                       ˙
                                    
                                    k
                                 
                              
                           ), and the orientation components (φ
                           
                              k
                           
                           
                              M
                           ,
                           φ
                           
                              k
                           
                           
                              D
                           ,
                           θ
                           
                              k
                           ) where φ
                           
                              k
                           
                           
                              M
                            and φ
                           
                              k
                           
                           
                              D
                            respectively denote the person orientation due to the movement and the detection estimation and θ
                           
                              k
                            denotes the final orientation of the person after considering the movement and the detection result, as stated by following tuple, 
                              F
                              
                                 X
                              
                              =
                              
                                 
                                    x
                                    k
                                 
                                 
                                    y
                                    k
                                 
                                 
                                    
                                       
                                          x
                                          ˙
                                       
                                       k
                                    
                                 
                                 
                                    
                                       
                                          y
                                          ˙
                                       
                                       k
                                    
                                 
                                 
                                    φ
                                    k
                                    M
                                 
                                 
                                    φ
                                    k
                                    D
                                 
                                 
                                    θ
                                    k
                                 
                              
                           . A constant velocity model is used for representing the person position and its derivative, as follows
                              
                                 (14)
                                 
                                    
                                       
                                          
                                             
                                                
                                                   x
                                                   k
                                                
                                             
                                             
                                                =
                                                
                                                   x
                                                   
                                                      k
                                                      −
                                                      1
                                                   
                                                
                                                +
                                                
                                                   
                                                      
                                                         x
                                                         ˙
                                                      
                                                      
                                                         k
                                                         −
                                                         1
                                                      
                                                   
                                                
                                                δt
                                                +
                                                
                                                   ϵ
                                                   x
                                                
                                                ,
                                             
                                          
                                          
                                             
                                                
                                                   y
                                                   k
                                                
                                             
                                             
                                                =
                                                
                                                   y
                                                   
                                                      k
                                                      −
                                                      1
                                                   
                                                
                                                +
                                                
                                                   
                                                      
                                                         y
                                                         ˙
                                                      
                                                      
                                                         k
                                                         −
                                                         1
                                                      
                                                   
                                                
                                                δt
                                                +
                                                
                                                   ϵ
                                                   y
                                                
                                                ,
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         x
                                                         ˙
                                                      
                                                      k
                                                   
                                                
                                             
                                             
                                                =
                                                
                                                   
                                                      
                                                         x
                                                         ˙
                                                      
                                                      
                                                         k
                                                         −
                                                         1
                                                      
                                                   
                                                
                                                +
                                                
                                                   ϵ
                                                   
                                                      x
                                                      ˙
                                                   
                                                
                                                ,
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         y
                                                         ˙
                                                      
                                                      k
                                                   
                                                
                                             
                                             
                                                =
                                                
                                                   
                                                      
                                                         y
                                                         ˙
                                                      
                                                      
                                                         k
                                                         −
                                                         1
                                                      
                                                   
                                                
                                                +
                                                
                                                   ϵ
                                                   
                                                      y
                                                      ˙
                                                   
                                                
                                                ,
                                             
                                          
                                       
                                    
                                 
                              
                           where 
                              
                                 
                                    ϵ
                                    x
                                 
                                 
                                    ϵ
                                    y
                                 
                                 
                                    ϵ
                                    
                                       x
                                       ˙
                                    
                                 
                                 
                                    ϵ
                                    
                                       y
                                       ˙
                                    
                                 
                              
                            are the gaussian noises for each component, and δ
                           
                              t
                            is the time sampling.

The orientation components of 
                              F
                              
                                 X
                              
                            are then described as
                              
                                 (15)
                                 
                                    
                                       
                                          
                                             
                                                
                                                   φ
                                                   k
                                                   M
                                                
                                             
                                             
                                                =
                                                arctan
                                                
                                                   
                                                      
                                                         
                                                            
                                                               y
                                                               ˙
                                                            
                                                            
                                                               k
                                                               −
                                                               1
                                                            
                                                         
                                                      
                                                      
                                                         
                                                            
                                                               x
                                                               ˙
                                                            
                                                            
                                                               k
                                                               −
                                                               1
                                                            
                                                         
                                                      
                                                   
                                                
                                                +
                                                
                                                   ϵ
                                                   
                                                      φ
                                                      M
                                                   
                                                
                                                
                                                   
                                                      υ
                                                      
                                                         k
                                                         −
                                                         1
                                                      
                                                   
                                                
                                                ,
                                             
                                          
                                          
                                             
                                                
                                                   φ
                                                   k
                                                   D
                                                
                                             
                                             
                                                =
                                                
                                                   φ
                                                   
                                                      k
                                                      −
                                                      1
                                                   
                                                   D
                                                
                                                +
                                                
                                                   ϵ
                                                   
                                                      φ
                                                      D
                                                   
                                                
                                                ,
                                             
                                          
                                          
                                             
                                                
                                                   θ
                                                   k
                                                
                                             
                                             
                                                =
                                                
                                                   φ
                                                   
                                                      k
                                                      −
                                                      1
                                                   
                                                   D
                                                
                                                +
                                                
                                                   
                                                      ω
                                                      
                                                         
                                                            1
                                                            −
                                                            
                                                               e
                                                               
                                                                  −
                                                                  
                                                                     υ
                                                                     
                                                                        k
                                                                        −
                                                                        1
                                                                     
                                                                  
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      1
                                                      +
                                                      
                                                         e
                                                         
                                                            −
                                                            
                                                               υ
                                                               
                                                                  k
                                                                  −
                                                                  1
                                                               
                                                            
                                                         
                                                      
                                                   
                                                
                                                
                                                   
                                                      
                                                         φ
                                                         
                                                            k
                                                            −
                                                            1
                                                         
                                                         M
                                                      
                                                      −
                                                      
                                                         φ
                                                         
                                                            k
                                                            −
                                                            1
                                                         
                                                         D
                                                      
                                                   
                                                
                                                +
                                                
                                                   ϵ
                                                   θ
                                                
                                                ,
                                             
                                          
                                       
                                    
                                 
                              
                           where 
                              
                                 
                                    ϵ
                                    
                                       φ
                                       D
                                    
                                 
                                 
                                    ϵ
                                    θ
                                 
                              
                            are the gaussian noises and ω is a constant.

The noise function 
                              
                                 ϵ
                                 
                                    φ
                                    M
                                 
                              
                              
                                 
                                    υ
                                    
                                       k
                                       −
                                       1
                                    
                                 
                              
                            in the first line of Eq. (15) is defined as
                              
                                 (16)
                                 
                                    
                                       
                                          
                                             
                                                ϵ
                                                
                                                   φ
                                                   M
                                                
                                             
                                             
                                                
                                                   υ
                                                   
                                                      k
                                                      −
                                                      1
                                                   
                                                
                                             
                                             =
                                             N
                                             
                                                
                                                   0
                                                   ,
                                                   g
                                                   
                                                      
                                                         υ
                                                         
                                                            k
                                                            −
                                                            1
                                                         
                                                      
                                                   
                                                
                                             
                                             ,
                                          
                                       
                                       
                                          
                                             g
                                             
                                                
                                                   υ
                                                   
                                                      k
                                                      −
                                                      1
                                                   
                                                
                                             
                                             =
                                             
                                                σ
                                                υ
                                             
                                             ex
                                             
                                                p
                                                
                                                   −
                                                   
                                                      υ
                                                      
                                                         k
                                                         −
                                                         1
                                                      
                                                   
                                                
                                             
                                             ,
                                          
                                       
                                       
                                          
                                             
                                                υ
                                                
                                                   k
                                                   −
                                                   1
                                                
                                             
                                             =
                                             
                                                
                                                   
                                                      
                                                         
                                                            x
                                                            ˙
                                                         
                                                         
                                                            k
                                                            −
                                                            1
                                                         
                                                         2
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         
                                                            y
                                                            ˙
                                                         
                                                         
                                                            k
                                                            −
                                                            1
                                                         
                                                         2
                                                      
                                                   
                                                
                                             
                                             ,
                                          
                                       
                                    
                                 
                              
                           where υ
                           
                              k
                              −1 is the magnitude of the person movement, and σ
                           
                              υ
                            is a constant. Using Eq. (16), the noise function 
                              
                                 ϵ
                                 
                                    φ
                                    M
                                 
                              
                              
                                 
                                    υ
                                    
                                       k
                                       −
                                       1
                                    
                                 
                              
                            can be read as a zero-mean gaussian of which the variance varies w.r.t the person movement υ.

Eq. (15) suggests the influence of the person movement to the orientation estimation. This equation, together with Eq. (16), tells us that when the velocity of a person is small enough (υ
                           
                              k
                              −1
                           ≈0), the uncertainty of the movement orientation becomes large (see 
                              
                                 ϵ
                                 
                                    φ
                                    M
                                 
                              
                              
                                 
                                    υ
                                    
                                       k
                                       −
                                       1
                                    
                                 
                              
                           ), and the orientation estimation will mainly depend on φ
                           
                              k
                           
                           
                              D
                            (which is updated using the orientation detection result in the observation model (see Eq. (17))). On the contrary, when the velocity is large then the movement orientation becomes more reliable and the orientation estimation depends on both detection and the person movement.

Here the constant ω has a duty for controlling the influence of the detection and the person movement to the overall orientation. The value of ω is later investigated in the experimental section (Section 4.5).

We then use the observation model for the person position in the world coordinate (derived from Eq. (13)) and for the person orientation from the result of Section 2, as follows
                              
                                 (17)
                                 
                                    H
                                    
                                       X
                                    
                                    =
                                    
                                       
                                          
                                             
                                                
                                                   μ
                                                   k
                                                
                                             
                                             
                                                =
                                                
                                                   
                                                      
                                                         x
                                                         k
                                                      
                                                      
                                                         
                                                            
                                                               
                                                                  
                                                                     f
                                                                     c
                                                                  
                                                                  
                                                                     y
                                                                     c
                                                                  
                                                               
                                                               
                                                                  y
                                                                  k
                                                               
                                                            
                                                         
                                                      
                                                   
                                                   
                                                      y
                                                      c
                                                   
                                                
                                                +
                                                
                                                   μ
                                                   c
                                                
                                                +
                                                
                                                   ϵ
                                                   μ
                                                
                                             
                                          
                                          
                                             
                                                
                                                   ν
                                                   k
                                                
                                             
                                             
                                                =
                                                
                                                   
                                                      
                                                         f
                                                         c
                                                      
                                                      
                                                         y
                                                         c
                                                      
                                                   
                                                   
                                                      y
                                                      k
                                                   
                                                
                                                +
                                                
                                                   ν
                                                   0
                                                
                                                +
                                                
                                                   ϵ
                                                   ν
                                                
                                             
                                          
                                          
                                             
                                                
                                                   h
                                                   k
                                                
                                             
                                             
                                                =
                                                
                                                   
                                                      
                                                         
                                                            
                                                               
                                                                  f
                                                                  c
                                                               
                                                               
                                                                  y
                                                                  c
                                                               
                                                            
                                                            
                                                               y
                                                               k
                                                            
                                                         
                                                      
                                                      
                                                         h
                                                         d
                                                      
                                                   
                                                   
                                                      y
                                                      c
                                                   
                                                
                                                +
                                                
                                                   ϵ
                                                   h
                                                
                                             
                                          
                                          
                                             
                                                
                                                   C
                                                   k
                                                
                                             
                                             
                                                =
                                                f
                                                
                                                   
                                                      C
                                                      
                                                         d
                                                      
                                                      ,
                                                      
                                                         φ
                                                         k
                                                         D
                                                      
                                                   
                                                
                                                +
                                                
                                                   ϵ
                                                   c
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           where (x
                           
                              k
                           ,
                           y
                           
                              k
                           ) denote the person position, (f
                           
                              c
                           ,
                           y
                           
                              c
                           ,
                           μ
                           
                              c
                           ,
                           ν
                           0) are the camera parameters (focal length f
                           
                              c
                           , camera height y
                           
                              c
                           , horizontal center point μ
                           
                              c
                           , and horizon position ν
                           0), and {ϵ
                              μ
                           ,ϵ
                              ν
                           ,ϵ
                              h
                           ,ϵ
                              c
                           } are the gaussian noises for each observation component. μ
                           
                              k
                           ,
                           ν
                           
                              k
                           , and h
                           
                              k
                            have the same definition with μ
                           
                              d
                           ,
                           ν
                           
                              d
                           , and h
                           
                              d
                            in Section 3.1. The function f(C(d),
                           φ
                           
                              k
                           
                           
                              D
                           ) maps the result of the multi-class decision function C(d) (Eq. (12)) into their equivalent angle of the orientation φ
                           
                              k
                           
                           
                              D
                           .

For choosing the tracker, we consider our hardware limitation and the system nonlinearities. Several well-known filters can be adopted for handling the nonlinearities, such as Extended Kalman Filter (EKF), Unscented Kalman Filter (UKF), and particle filter. Here we choose UKF because we want to avoid the resource costs of the particle filter (used by [5]) and the calculus of the Jacobian matrices used in the EKF.

The UKF [20] employs the unscented transform, a deterministic sampling technique, to take a minimal set of sample points called sigma points around the mean. Consider the current state with the mean 
                              
                                 x
                                 ^
                              
                            and its covariance P
                              x
                           . We build a set of 2L+1 sigma points matrix 
                              X
                           , as follows
                              
                                 (18)
                                 
                                    
                                       
                                          
                                             
                                                X
                                                0
                                             
                                             =
                                             
                                                x
                                                ^
                                             
                                          
                                       
                                       
                                          
                                             
                                                X
                                                
                                                   i
                                                   ,
                                                   k
                                                   −
                                                   1
                                                
                                             
                                             =
                                             
                                                x
                                                ^
                                             
                                             +
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               L
                                                               +
                                                               λ
                                                            
                                                         
                                                         
                                                            P
                                                            x
                                                         
                                                      
                                                   
                                                
                                                i
                                             
                                             ,
                                             i
                                             =
                                             
                                                1
                                                …
                                                L
                                             
                                          
                                       
                                       
                                          
                                             
                                                X
                                                
                                                   i
                                                   ,
                                                   k
                                                   −
                                                   1
                                                
                                             
                                             =
                                             
                                                x
                                                ^
                                             
                                             −
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               L
                                                               +
                                                               λ
                                                            
                                                         
                                                         
                                                            P
                                                            x
                                                         
                                                      
                                                   
                                                
                                                
                                                   i
                                                   −
                                                   L
                                                
                                             
                                             ,
                                             i
                                             =
                                             
                                                
                                                   L
                                                   +
                                                   1
                                                   ,
                                                   …
                                                   ,
                                                   2
                                                   L
                                                
                                             
                                          
                                       
                                       
                                          
                                             λ
                                             =
                                             
                                                α
                                                2
                                             
                                             
                                                
                                                   L
                                                   +
                                                   κ
                                                
                                             
                                             −
                                             L
                                             ,
                                          
                                       
                                    
                                 
                              
                           where L is the dimension of the augmented state, α and κ are constants for controlling the spread of the sigma points.

We then define W
                           (m) and W
                           (c) as the weight for the mean and covariance respectively, given by
                              
                                 (19)
                                 
                                    
                                       
                                          
                                             
                                                W
                                                0
                                                
                                                   m
                                                
                                             
                                             =
                                             
                                                λ
                                                
                                                   
                                                      L
                                                      +
                                                      λ
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                W
                                                0
                                                
                                                   c
                                                
                                             
                                             =
                                             
                                                λ
                                                
                                                   
                                                      L
                                                      +
                                                      λ
                                                   
                                                
                                             
                                             +
                                             
                                                
                                                   1
                                                   −
                                                   
                                                      α
                                                      2
                                                   
                                                   +
                                                   β
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                W
                                                i
                                                
                                                   m
                                                
                                             
                                             =
                                             
                                                W
                                                i
                                                
                                                   c
                                                
                                             
                                             =
                                             
                                                1
                                                
                                                   2
                                                   
                                                      
                                                         L
                                                         +
                                                         λ
                                                      
                                                   
                                                
                                             
                                             ,
                                             i
                                             =
                                             
                                                
                                                   1
                                                   ,
                                                   …
                                                   ,
                                                   2
                                                   L
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           where β integrates prior knowledge of the distribution of 
                              
                                 x
                                 ^
                              
                           . We use the default value, α
                           =10−3,
                           β
                           =2, and κ
                           =0.

We compute mean and covariance of the prior estimation (
                              
                                 X
                                 
                                    k
                                    |
                                    k
                                    −
                                    1
                                 
                              
                            and P
                           
                              k
                           
                           −) using the state model 
                              F
                              
                                 X
                              
                            in Eqs. (14) and (15), and the sigma points above as follows
                              
                                 (20)
                                 
                                    
                                       
                                          
                                             
                                                X
                                                
                                                   i
                                                   ,
                                                   k
                                                   |
                                                   k
                                                   −
                                                   1
                                                
                                             
                                             =
                                             F
                                             
                                                
                                                   X
                                                   
                                                      i
                                                      ,
                                                      k
                                                      −
                                                      1
                                                   
                                                
                                             
                                             ,
                                             i
                                             =
                                             
                                                
                                                   1
                                                   ,
                                                   …
                                                   ,
                                                   2
                                                   L
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   
                                                      x
                                                      ^
                                                   
                                                   k
                                                   −
                                                
                                             
                                             =
                                             
                                                
                                                   ∑
                                                   
                                                      i
                                                      =
                                                      0
                                                   
                                                   
                                                      2
                                                      L
                                                   
                                                
                                                
                                             
                                             
                                             
                                                W
                                                i
                                                
                                                   m
                                                
                                             
                                             
                                                X
                                                
                                                   i
                                                   ,
                                                   k
                                                   |
                                                   k
                                                   −
                                                   1
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                P
                                                k
                                                −
                                             
                                             =
                                             
                                                
                                                   ∑
                                                   
                                                      i
                                                      =
                                                      0
                                                   
                                                   
                                                      2
                                                      L
                                                   
                                                
                                                
                                             
                                             
                                             
                                                W
                                                i
                                                
                                                   c
                                                
                                             
                                             
                                                
                                                   
                                                      X
                                                      
                                                         i
                                                         ,
                                                         k
                                                         |
                                                         k
                                                         −
                                                         1
                                                      
                                                   
                                                   −
                                                   
                                                      
                                                         
                                                            x
                                                            ^
                                                         
                                                         k
                                                         −
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         X
                                                         
                                                            i
                                                            ,
                                                            k
                                                            |
                                                            k
                                                            −
                                                            1
                                                         
                                                      
                                                      −
                                                      
                                                         
                                                            
                                                               x
                                                               ^
                                                            
                                                            k
                                                            −
                                                         
                                                      
                                                   
                                                
                                                T
                                             
                                             +
                                             Q
                                          
                                       
                                    
                                 
                              
                           where Q is the covariance of the process noises.

In the measurement update phase, we project the sigma points through the observation function 
                              H
                           (X)
                              
                                 (21)
                                 
                                    
                                       
                                          
                                             
                                             
                                                Z
                                                
                                                   i
                                                   ,
                                                   k
                                                   |
                                                   k
                                                   −
                                                   1
                                                
                                             
                                             
                                             =
                                             H
                                             
                                                
                                                   X
                                                   
                                                      i
                                                      ,
                                                      k
                                                      |
                                                      k
                                                      −
                                                      1
                                                   
                                                
                                             
                                             ,
                                             i
                                             =
                                             
                                                
                                                   1
                                                   ,
                                                   …
                                                   ,
                                                   2
                                                   L
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                             
                                                
                                                   
                                                      z
                                                      ^
                                                   
                                                   k
                                                   −
                                                
                                             
                                             
                                             =
                                             
                                                
                                                   ∑
                                                   
                                                      i
                                                      =
                                                      0
                                                   
                                                   
                                                      2
                                                      L
                                                   
                                                
                                                
                                             
                                             
                                             
                                                W
                                                i
                                                
                                                   m
                                                
                                             
                                             
                                                Z
                                                
                                                   i
                                                   ,
                                                   k
                                                   |
                                                   k
                                                   −
                                                   1
                                                
                                             
                                             ,
                                          
                                       
                                       
                                          
                                             
                                             
                                                P
                                                
                                                   
                                                      z
                                                      k
                                                   
                                                   
                                                      z
                                                      k
                                                   
                                                
                                             
                                             
                                             =
                                             
                                                
                                                   ∑
                                                   
                                                      i
                                                      =
                                                      0
                                                   
                                                   
                                                      2
                                                      L
                                                   
                                                
                                                
                                             
                                             
                                             
                                                W
                                                i
                                                
                                                   c
                                                
                                             
                                             
                                                
                                                   
                                                      Z
                                                      
                                                         i
                                                         ,
                                                         k
                                                         |
                                                         k
                                                         −
                                                         1
                                                      
                                                   
                                                   −
                                                   
                                                      
                                                         
                                                            z
                                                            ^
                                                         
                                                         k
                                                         −
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         Z
                                                         
                                                            i
                                                            ,
                                                            k
                                                            |
                                                            k
                                                            −
                                                            1
                                                         
                                                      
                                                      −
                                                      
                                                         
                                                            
                                                               z
                                                               ^
                                                            
                                                            k
                                                            −
                                                         
                                                      
                                                   
                                                
                                                T
                                             
                                             +
                                             R
                                             ,
                                          
                                       
                                    
                                 
                              
                           where 
                              
                                 
                                    
                                       z
                                       ^
                                    
                                    k
                                    −
                                 
                              
                            denotes the predicted measurement, 
                              
                                 P
                                 
                                    
                                       z
                                       k
                                    
                                    
                                       z
                                       k
                                    
                                 
                              
                            is its covariance, and R is the covariance of the observation noises. The state measurement cross-covariance 
                              
                                 P
                                 
                                    
                                       x
                                       k
                                    
                                    
                                       z
                                       k
                                    
                                 
                              
                           and the Kalman gain K are computed as
                              
                                 (22)
                                 
                                    
                                       
                                          
                                             
                                             
                                                P
                                                
                                                   
                                                      x
                                                      k
                                                   
                                                   
                                                      z
                                                      k
                                                   
                                                
                                             
                                             
                                             =
                                             
                                                
                                                   ∑
                                                   
                                                      i
                                                      =
                                                      0
                                                   
                                                   
                                                      2
                                                      L
                                                   
                                                
                                                
                                             
                                             
                                             
                                                W
                                                i
                                                
                                                   c
                                                
                                             
                                             
                                                
                                                   
                                                      X
                                                      
                                                         i
                                                         ,
                                                         k
                                                         |
                                                         k
                                                         −
                                                         1
                                                      
                                                   
                                                   −
                                                   
                                                      
                                                         
                                                            x
                                                            ^
                                                         
                                                         k
                                                         −
                                                      
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         Ζ
                                                         
                                                            i
                                                            ,
                                                            k
                                                            |
                                                            k
                                                            −
                                                            1
                                                         
                                                      
                                                      −
                                                      
                                                         
                                                            
                                                               z
                                                               ^
                                                            
                                                            k
                                                            −
                                                         
                                                      
                                                   
                                                
                                                T
                                             
                                             ,
                                          
                                       
                                       
                                          
                                             
                                             K
                                             
                                             =
                                             
                                                P
                                                
                                                   
                                                      x
                                                      k
                                                   
                                                   
                                                      z
                                                      k
                                                   
                                                
                                             
                                             
                                                P
                                                
                                                   
                                                      z
                                                      k
                                                   
                                                   
                                                      z
                                                      k
                                                   
                                                
                                                
                                                   −
                                                   1
                                                
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        

The mean and covariance of the posterior estimation are then calculated as
                              
                                 (23)
                                 
                                    
                                       
                                          
                                             
                                             
                                                
                                                   
                                                      x
                                                      ^
                                                   
                                                   k
                                                
                                             
                                             
                                             =
                                             
                                                
                                                   
                                                      x
                                                      ^
                                                   
                                                   k
                                                   −
                                                
                                             
                                             +
                                             K
                                             
                                                
                                                   
                                                      z
                                                      k
                                                   
                                                   −
                                                   
                                                      
                                                         
                                                            z
                                                            ^
                                                         
                                                         k
                                                         −
                                                      
                                                   
                                                
                                             
                                             ,
                                          
                                       
                                       
                                          
                                             
                                             
                                                P
                                                k
                                             
                                             
                                             =
                                             
                                                P
                                                k
                                                −
                                             
                                             −
                                             K
                                             
                                                P
                                                
                                                   
                                                      z
                                                      k
                                                   
                                                   
                                                      z
                                                      k
                                                   
                                                
                                             
                                             
                                                K
                                                T
                                             
                                             .
                                          
                                       
                                    
                                 
                              
                           
                        

We also give to the tracker, the color histogram information H
                           
                              tr
                            retrieved from the lower third of the bounding box, from which we expect to get clothing features.
                              4
                           
                           
                              4
                              In the upper body bounding box, the lower third part usually contains the human shoulder and body. We can expect that the cloth color can be retrieved from this region and does not change much during the tracking process.
                            In the implementation using a moving robot (see Section 4.7), the camera movement is currently compensated by using the odometry of the robot. The use of Kanade–Lucas–Tomasi (KLT) features tracker [10] or the visual odometry [11] for compensating the camera movement are further investigated in the future.

We treat each detection of the human upper body as an observation, to be associated with the trackers. For every observation, we use the position and histogram information for calculating the relative distance to each tracker Δ
                           
                              ob,tr
                           , given by
                              
                                 (24)
                                 
                                    
                                       Δ
                                       
                                          ob
                                          ,
                                          tr
                                       
                                       P
                                    
                                    
                                    =
                                    
                                       
                                          e
                                          
                                             −
                                             
                                                
                                                   1
                                                   2
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               μ
                                                               ¯
                                                            
                                                            ob
                                                         
                                                      
                                                      −
                                                      
                                                         
                                                            
                                                               μ
                                                               ¯
                                                            
                                                            tr
                                                         
                                                      
                                                   
                                                
                                                T
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            
                                                               ∑
                                                               ob
                                                            
                                                            
                                                         
                                                         +
                                                         
                                                            
                                                               ∑
                                                               tr
                                                            
                                                            
                                                         
                                                         
                                                      
                                                   
                                                   
                                                      −
                                                      1
                                                   
                                                
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            μ
                                                            ¯
                                                         
                                                         ob
                                                      
                                                   
                                                   −
                                                   
                                                      
                                                         
                                                            μ
                                                            ¯
                                                         
                                                         tr
                                                      
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             2
                                             ϕ
                                             |
                                             
                                                
                                                   
                                                      
                                                         ∑
                                                         ob
                                                      
                                                      
                                                   
                                                   +
                                                   
                                                      
                                                         ∑
                                                         tr
                                                      
                                                      
                                                   
                                                
                                             
                                             
                                             |
                                          
                                       
                                    
                                 
                              
                           
                           
                              
                                 (25)
                                 
                                    
                                       Δ
                                       
                                          ob
                                          ,
                                          tr
                                       
                                       H
                                    
                                    
                                    =
                                    
                                       
                                          
                                             
                                                ∑
                                                I
                                             
                                             
                                          
                                          
                                          
                                             
                                                
                                                   H
                                                   ob
                                                
                                                
                                                   I
                                                
                                                −
                                                
                                                   
                                                      
                                                         H
                                                         ¯
                                                      
                                                      ob
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   H
                                                   tr
                                                
                                                
                                                   I
                                                
                                                −
                                                
                                                   
                                                      
                                                         H
                                                         ¯
                                                      
                                                      tr
                                                   
                                                
                                             
                                          
                                       
                                       
                                          
                                             
                                                
                                                   ∑
                                                   I
                                                
                                                
                                             
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            H
                                                            ob
                                                         
                                                         
                                                            I
                                                         
                                                         −
                                                         
                                                            
                                                               
                                                                  H
                                                                  ¯
                                                               
                                                               ob
                                                            
                                                         
                                                      
                                                   
                                                   2
                                                
                                             
                                             
                                                
                                                   ∑
                                                   I
                                                
                                                
                                             
                                             
                                             
                                                
                                                   
                                                      
                                                         
                                                            H
                                                            tr
                                                         
                                                         
                                                            I
                                                         
                                                         −
                                                         
                                                            
                                                               
                                                                  H
                                                                  ¯
                                                               
                                                               tr
                                                            
                                                         
                                                      
                                                   
                                                   2
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                           
                              
                                 (26)
                                 
                                    
                                       Δ
                                       
                                          ob
                                          ,
                                          tr
                                       
                                    
                                    
                                    =
                                    η
                                    
                                       Δ
                                       
                                          ob
                                          ,
                                          tr
                                       
                                       P
                                    
                                    +
                                    ς
                                    
                                       Δ
                                       
                                          ob
                                          ,
                                          tr
                                       
                                       H
                                    
                                 
                              
                           where Δ
                           
                              ob,tr
                           
                           
                              P
                            is the gaussian correlation between mean and covariance of the observed position 
                              
                                 
                                    
                                       
                                          
                                             μ
                                             ¯
                                          
                                          ob
                                       
                                    
                                    ,
                                    
                                       
                                          ∑
                                          ob
                                       
                                       
                                    
                                    
                                 
                              
                            and the tracker position 
                              
                                 
                                    
                                       
                                          
                                             μ
                                             ¯
                                          
                                          tr
                                       
                                    
                                    ,
                                    
                                       
                                          ∑
                                          tr
                                       
                                       
                                    
                                    
                                 
                              
                           . Δ
                           
                              ob,tr
                           
                           
                              H
                            is the color histogram correlation distance of the observation H
                           
                              ob
                            and the tracker H
                           
                              tr
                           , and η and ς are constants.

Under the nearest neighbor assumption, each observation is assigned to the tracker when the distance Δ
                           
                              ob,tr
                            is below the threshold. A new tracker is born from the observation which has no association, and any track which is not associated with any observation and has a large uncertainty is then deleted.

For reducing the calculation time, we do a hierarchical Region of Interest (ROI)-based tracking (including the orientation estimation) along the frame sequences. First, we search the whole space of the image to obtain initial observations and trackers. The next sequences utilize the position information from the trackers as the ROI. We do the detection around the ROI and in the area where persons may come up to the scene (see Fig. 5
                           ). This technique
                              5
                           
                           
                              5
                              Basically, this heuristic method is enough for our cases. For more general scenarios, we open this problem to the interested reader.
                            considerably reduces the time for detection. Lastly, every 15 frames, we do the whole space search to anticipate the missing detection.

@&#EXPERIMENTS@&#

Size of all images and camera sequences used in our experiments is 640×480. All of experiments were done using C++ implementation on a laptop PC (Core2Duo 2.1GHz, 2GB memory, and Windows 7 OS).

The evaluation of our method starts from explaining the dataset used by our system. We then build an analysis to support the advantages of using our method for the human orientation estimation, by comparing it with several methods. We also evaluate performance of the orientation estimation and tracking integration. Lastly, we implement our system to the real environment using a camera attached on a mobile robot.

First, we create our upper body dataset by cropping the INRIA [1] and Fudan-Penn [6] data into 48×64 pixel images containing the upper-half body of persons. We also add the CALVIN upper body dataset [7] into our dataset, so that we have 4250 positive samples of the human upper body. Around 3000 positive samples are used for training the upper body detector, and the rest is for testing purpose. 2500 negative samples are created from images which do not contain the human upper body, including the bottom part of the human body. From now, we refer it as dataset A.
                           6
                        
                        
                           6
                           This generic naming is for simplicity only, not intended to give a new name to the existing databases.
                        
                     

To do a comprehensive test of the human upper body orientation estimation, we use several datasets for both static and dynamic scenes. For the static scenes, we use TUD-Multiview dataset [3] which is also used by the other state-of-the-art papers ([5,21]). This dataset consists of 1486 images for training, 248 images for validation, and 248 images for testing. The TUD-Multiview dataset is annotated with bounding boxes of full body and eight orientation classes. For our purpose, we change the bounding boxes into the half upper part of the body.

We also use the dataset created for upper body training (dataset A), for the orientation classification purpose. We then separate the training samples of the above dataset into eight classes representing the eight orientation of the human body (see Fig. 1). The testing samples are treated in the same manner with the training samples. This dataset is then called as dataset B.

For the dynamic scenes, we use TUD-Stadtmitte dataset [3] which contains 200 frames of the street scenes with several pedestrians crossing the street with a complex environment and many occlusions, and the camera calibration data.
                           7
                        
                        
                           7
                           Camera calibration data of the TUD-Stadtmitte dataset is provided at http://www.gris.informatik.tu-darmstadt.de/~aandriye/data.html.
                         Here we use the raw video for the TUD-Stadtmitte dataset without annotations.

We then take an indoor video of our laboratory (from here, it is referred as InLab dataset). This video contains 487 frames with the number of persons varies from zero to three persons on each frame, and also the camera calibration data.

We summarize the usage of each dataset, as follows:
                           
                              •
                              
                                 Dataset A is used for training and testing the human upper body detection;


                                 Dataset B is used for evaluating the orientation estimation under various features and classifiers (see Sections 4.3 and 4.4);

TUD-Multiview dataset is used for comparison with the state-of-the-arts (see Section 4.6);

Combination of subset B and TUD-Multiview datasets are then used for training the orientation model to be used in the dynamic scenes, i.e. TUD-Stadtmitte and InLab datasets (see Section 4.5), and the real world application (see Section 4.7).

At the beginning, we want to show the reason for choosing the human upper body over the full body detection in our system. We build the human full body dataset from a subset of the INRIA dataset [1], and for the upper body dataset, we use the dataset A mentioned in Section 4.1. We then create two testing samples; the first samples contain a subset of testing samples of the INRIA which do not contain occluded person, and in the second ones we add several images with persons occluded by the chairs, tables, and furniture in additional to the testing samples of the INRIA. The training of both cases is then performed using Boost-Cascade method, as mentioned in Section 2.2. The ROC of both occluded and non-occluded cases are shown in Fig. 6
                        .

The results show that the human upper body detector works better on the occluded dataset. This result suggests the use of the human upper body detection on the real cases such as an indoor environment with many tables, chairs, and furniture, rather than using the full body model.

First, we conduct experiments to see the influence of the features, the models, and the classifiers to the orientation estimation results by using the dataset B. Following parameters are used for the experiments; we use the multi-level HOG and LBP features explained in the beginning of this paper; for the multi-class SVM classifier [13], we use a standard RBF kernel with gamma set to 4e-4, and regularization parameter is set to 1.0; for the MultiBoost [14], we use “FilterBoost” for the strong learner and “SingleStump” for the base learner; for the Random Forest, the number of trees is set to 100 and the maximum depth of trees is set to 25; the latent vector for CFM-PLS is set to 15, and for the BIFM-PLS, we set p
                        1 to 3 and p
                        2 to 15 (we will discuss these values of the PLS models in the next subsection).


                        Table 1
                         shows the experimental result using the combination of features and classifiers. Based on this table, the combination of multi-level HOG-LBP features, BIFM-PLS model, and Random Forest classifier, is superior against the others. In general, the combination of HOG and LBP features is better than using only HOG features. The RF classifier also gives better impact than using MultiSVM and MultiBoost. The interesting part is that the usage of PLS models yields better result of the orientation estimation than the concatenated features. We will discuss these matters in the next subsection.


                        Fig. 7
                         shows the distribution of the orientation estimation. From this figure, we can conclude that estimating an oblique direction is more difficult than detecting the perpendicular one.

We now discuss about how our PLS models (BIFM-PLS) give a significant contribution to the orientation estimation. We extract the block importance score (BIS) of each LBP and HOG features using the BIFM-PLS algorithm, and draw the weight of the first projection vector.


                        Fig. 8
                         shows the contribution of each features to the orientation estimation. The left figure, which utilizes the HOG features, shows that the areas around the edges of the body have a high importance, and the background tends to have a low importance. It means that the HOG extracts the shape of the body for the orientation estimation. In the right figure, we can see that the high importance area is around the head area and the body, but not for the background and the clothing. Here we can understand that the LBP captures the head features for the orientation estimation, while the clothing and background which vary from one sample to the others are discarded.

Based on Fig. 8, and supported by the results in Table 1, we show the effect of the BIFM-PLS model to the classification. Even the classifier such as the Random Forest is noted to be able to extract the importance of the features (for example, in [22]), here the BIFM-PLS removes the “noisy” areas (such as the various background and clothing) as shown in Fig. 8, and helps the classifier focus to do the classification on the high importance features.

We can also see the advantages of the PLS models as a dimensional reduction algorithm. We use another popular dimensional reduction algorithm, Principal Component Analysis (PCA), as the baseline. Table 2
                         shows the superiority of the PLS models against the PCA. It is understandable because unlike the PCA, the PLS also considers the class labels besides the variance of the samples.

We then discuss about the effect of the constants p
                        1 and p
                        2 used in the BIFM-PLS algorithm, shown in Fig. 9
                        . p
                        1 represents how well a block contributes to the orientation estimation, and p
                        2 examines the contribution of a feature inside a block. By examining Fig. 9, we choose the optimal value for both constants, p
                        1
                        =3 and p
                        2
                        =15. Over those values, we can consider it as the data overfit.

The next experiments are intended for evaluating the performance of the integrated orientation estimation and tracking. Here we use the TUD-Stadtmitte and InLab datasets for the evaluations. We also investigate the influence of choosing various values of ω as mentioned in Eq. (15). The higher value of ω means that the object movement will give a higher influence to the orientation estimation result.


                        Fig. 10
                         shows the performance of our proposed system using the TUD-Stadtmitte dataset. The top sequence shows the orientation detections and tracking results. The bottom sequence shows the person locations and movement predictions in the 3D world coordinate, relative to the position and FOV of the camera.

We then test our framework on InLab dataset, as shown in Fig. 11
                         (please refer to Fig. 10 for figure property explanation). Fig. 11 exhibits the robustness of the multi target tracking and orientation estimation under many occlusions.


                        Fig. 12
                         shows the effect of changing ω value to the overall orientation estimation results. We change the value of ω from 0, which means that the orientation estimation depends only on the detection, to ω
                        =1 which represents a heavy dependency to the object movements.

In the TUD-Stadtmitte dataset, the orientation estimation based on the object movements (ω
                        =1) is relatively high compared to the one based on the detection (ω
                        =0), due to the consistent movement of each person inside the video sequences, which gives a high confidence to the movement estimation. Contrary, the orientation estimation based on the object movement in the InLab dataset is lower because the persons frequently change their direction. Overall, combining both detection and movement estimation tends to make a higher orientation estimation results rather than solely depends on the detection or the movement estimation, and in our cases we choose ω
                        =0.5.

We compare our algorithm to the state-of-the-art papers such as [3,5], and [22] using the TUD-Multiview dataset. Since the state-of-the-art papers use the whole body information for estimating the orientation, we cannot directly use the result of their papers as the comparison. Instead, we need to test their methods using the upper body information. Unfortunately, the authors of those papers do not provide any implementation code.

To overcome the problem above, we re-implement their algorithms based on our understanding to their papers. We then evaluate it using the full body information. We expect that the result will be similar with the one mentioned in their respective paper. The first and second columns of Table 3
                         show the comparison of the original and the re-implemented version of the state-of-the-art papers. We can see that our re-implementation gives a close result to the one mentioned in each paper. Until this stage, our algorithm beats all of Andriluka's and Chen's works and comparable to Baltieri's work, even though they use the full body information. Now we can assume that our re-implementation of the state-of-the-art can be used for further comparison.

We then use the re-implementation of the state-of-the-art for making a fair comparison with our algorithm, i.e. by applying the same upper body dataset which contains less information. Each algorithm is then trained and tested using the upper body version of the TUD-Multiview dataset. The last column of Table 3 shows the result of each algorithm using only the upper body information. The result of each state-of-the-art degrades significantly, as less information is available for obtaining the body orientation. It also shows the importance of using various cues. Other works use only the shape features which decrease the performance when the information becomes less. On the other hand, our algorithm uses the shape and texture features simultaneously to overcome those problems and gains the best performance on the upper body orientation estimation.

In this experiment, we attach a monocular camera on the mobile robot base. The robot is then controlled to move while performing the human upper body orientation estimation and tracking in real-time. The experiment was performed at the university cafeteria, with the total of 190 frames. Fig. 13
                         shows the experimental results using the camera with a moving base. We can achieve the accuracy rate of 0.70 and the frame rate of 5–12Hz, fast enough to be used for an on-line purpose. Once again, it shows the consistency and robustness of our orientation estimation and tracking system.

@&#CONCLUSIONS@&#

We have described a framework of orientation estimation and tracking. Our human upper body orientation classification system, utilizing a partial least squares model-based shape-texture features combined with the random forest, is proved to work better than any existing methods. Its integration with the tracking system boosts up the performance of the orientation estimation even further. Another notable result is that our system works real-time, giving a possibility to be used in the real robot application such as the person tracking.

Future work for our system, besides the implementation on a real robot for specific purposes, is to combine it with other sensors such as laser range finders. By adopting multi-sensory fusion, we expect to build a more robust system for person localization. There are also possibilities for choosing and adding better heuristics in the integration of orientation estimation and tracking, such as a better way for selecting the ROI, so that the system will be applicable for more general scenarios.

Supplementary data to this article can be found online at: doi: 10.1016/j.imavis.2014.08.002.

The following is the Supplementary data to this article.
                        
                           
                              Supplementary Video.
                           
                           
                        
                     
                  

Supplementary data to this article can be found online at http://dx.doi.org/10.1016/j.imavis.2014.08.002.

@&#REFERENCES@&#

