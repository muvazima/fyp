@&#MAIN-TITLE@&#Enhanced disparity estimation in stereo images

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           A two-phase strategy for combining separate cost volumes is described.


                        
                        
                           
                           A mean-shift segmentation-driven approach to handle disparity outliers is utilized.


                        
                        
                           
                           Low-textured area plane fitting is fostered by using disparity histogram analysis.


                        
                        
                           
                           Our method ranks first among published methods in the Middlebury evaluation system.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Stereo vision

Stereo matching

Disparity estimation

Scanline optimization

Outliers handling

@&#ABSTRACT@&#


               
               
                  This paper presents a novel stereo disparity estimation method, which combines three different cost metrics, defined using RGB information, the CENSUS transform, as well as Scale-Invariant Feature Transform coefficients. The selected cost metrics are aggregated based on an adaptive weight approach, in order to calculate their corresponding cost volumes. The resulting cost volumes are then merged into a combined one, following a novel two-phase strategy, which is further refined by exploiting scanline optimization. A mean-shift segmentation-driven approach is exploited to deal with outliers in the disparity maps. Additionally, low-textured areas are handled using disparity histogram analysis, which allows for reliable disparity plane fitting on these areas. Finally, an efficient two-step approach is introduced to refine disparity discontinuities. Experiments performed on the four images of the Middlebury benchmark demonstrate the accuracy of this methodology, which currently ranks first among published methods. Moreover, this algorithm is tested on 27 additional Middlebury stereo pairs for evaluating thoroughly its performance. The extended comparison verifies the efficiency of this work.
               
            

@&#INTRODUCTION@&#

Stereo reconstruction is one of the most active research fields in computer vision [1]. Though mature, the task of estimating dense disparity maps from stereo image pairs is still challenging, since there is still space for improving accuracy and providing new ways of handling uniform areas, depth discontinuities and occlusions. Several approaches have been proposed so far, targeting the improvement of the reconstruction accuracy and/or minimization of the computational cost. Section 1.1 reports on the approaches in this field. Paper's contribution is described in Section 1.2. While, Section 1.3 compares the proposed work to state-of-the-art methods.

The work in [1] presents a complete taxonomy of approaches used for stereo disparity estimation. The categorization of the approaches is based on the following four generic steps, into which most of the stereo algorithms can be decomposed: 1. matching cost computation; 2. cost (support) aggregation; 3. disparity computation/optimization; and 4. disparity refinement. Several metrics have been proposed in the literature for the computation of matching costs between pixels. Prevalent pixel-based cost measures include the absolute difference of image intensity values, gradient-based measures and non-parametric transforms such as spearman, CENSUS and rank [2]. The CENSUS transform has been successfully used for disparity estimation and several modifications of it have been presented [3–5]. Many approaches combine various cost measures in order to boost accuracy. The work in [6] is based on the self-adapting dissimilarity measure, which combines the sum of absolute intensity differences and a gradient based measure. The works in [7–9] exploit a combination of absolute intensity differences, as well as the hamming distance of CENSUS transform coefficients. The matching cost values over all pixels and all disparities form the initial disparity space image (DSI) or the initial cost volume.

In order to reduce matching ambiguity, the pixel-based matching costs are aggregated spatially over support regions in the DSI. The performance evaluations on different cost aggregation approaches [10,11] show that adaptive-weight [12] and segment-support [13] outperform the rest of cost aggregation approaches. More recent cost aggregation methods include successive weighted summation [8] and guided image filter [14,15].

The disparity optimization step includes local, global, cooperative and semi-global methods. Local methods [8,12–14,16,17] put emphasis on matching cost computation and cost aggregation. The final disparity map is computed by applying a simple local winner-take-all (WTA) approach independently for each pixel. Global optimization methods aim at assigning a disparity label to each pixel, so that a global cost function is minimized over the whole image area. Efficient techniques include Graph Cuts [18], Belief Propagation [6] and cooperative optimization [19]. In an additional category of approaches, the energy function is minimized on a subset of points of the stereo pair (semi-global methods), for instance along 1D paths. Such approaches, which decrease the computational complexity compared to global optimization algorithms, involve Dynamic Programming [20] or Scanline Optimization [21] techniques.

The disparity results have to be refined, since they are “polluted” with outliers in occluded areas, depth discontinuities and uniform areas that lack texture. Several stereo algorithms, such as those in [21,22], use segmented regions for reliable outlier handling. The work in [9] uses iterative region voting and proper interpolation to fill outliers.

In this paper, a methodology for accurate dense disparity estimation is proposed. Most significant contributions of this work include the following:
                           
                              •
                              The algorithm acquires a combined cost volume by exploiting three types of cost metrics. The first cost metric combines RGB-CENSUS information, the second one uses only CENSUS information and the third one SIFT (Scale Invariant Feature Transform) information. The cost metrics are aggregated using adaptive weights and their cost volumes are acquired. A reliable two-phase strategy is then followed to merge the individual cost volumes into a combined one.

This approach, to the extent of our knowledge, is the first one that combines efficiently RGB, CENSUS and SIFT information.

This method exploits mean-shift image segmentation in several stages of this approach. In our approach plane fitting is applied just to segments that correspond to large uniform areas and not to all segments. This fact reduces the dependency of our method from the result of the disparity plane fitting, which may be of reduced accuracy for small segment areas, due to the decreased number of contained disparities. Also, a metric is used to verify if planar fitting is successful, since not all large uniform areas can be considered as planar.

Segmentation is also useful in the disparity optimization step. In more detail, the mean-shift segmentation maps of the stereo pair are used to introduce a new criterion for the definition of the smoothness penalty terms that are used in the semi-global scanline optimization method of [21] (previously exploited, among other works, in [9,23–25]). The modified scanline method is employed for the optimization of the combined cost volume.

Moreover, segmentation is exploited for the occlusion handling task, where an efficient strategy that incorporates mean-shift segmentation-based occlusion handling to successfully cope with occluded areas is presented.

Handling of large uniform areas is based on disparity histogram analysis, which removes outlier disparities from large uniform regions, before applying disparity plane fitting in each region using the remaining reliable disparities.

Except for the major contributions, some secondary contributions are the following:
                           
                              •
                              A weighted variant of the original CENSUS transform, which improves the disparity accuracy, is proposed.

Disparity refinement at disparity discontinuities is performed by applying a two-step disparity edges refinement approach. The first step handles disparity errors at depth discontinuities in a coarser level and the second one in a finer level.

This approach, by encompassing the aforementioned contributions, manages to rank 1st among already published methods in the Middlebury Stereo Evaluation benchmark [26] and gives superior results on an additional dataset of 27 stereo pairs.

This method is the first one that combines RGB, CENSUS and SIFT information by utilizing an efficient strategy. There are several works that use RGB and/or CENSUS information, such as [3,4,7–9,25], but they do not exploit the SIFT information, which could probably improve their performance. However, the approaches that use SIFT descriptors, or similar ones (such as SURF-Speeded Up Robust Features [27]), for the case of short-baseline stereo disparity estimation, are limited. For instance, the work in [28] combines mutual information, SIFT descriptor, and segment based plane-fitting to robustly find correspondences for stereo image pairs which undergo radiometric variations. The paper in [29] uses SURF key points for the initial disparity estimation, which is further improved by using graph cuts for disparity plane assignment.

Many methods, such as [6,19,29–31], exploit image segmentation algorithms in order to separate images into segments and then solve the disparity estimation problem by assigning, in various ways, a disparity plane for each estimated segment of the scene. In contrast to this class of approaches, the proposed method applies plane fitting only to large segments that correspond to low-textured areas. Additionally, in order to prevent application of plane fitting to low-textured areas that are not (near) planar, a metric is used to verify if plane fitting is successful.

The disparity histogram analysis, described in this paper, could be used as preprocessing step in algorithms that perform plane fitting using methods that are sensitive to outliers, such as the least square error (LSE) based plane fitting algorithm, which is used in [30,31]. Even plane fitting algorithms that are insensitive to outliers, such as RANSAC (Random Sample Consensus) [32], could be fostered by our outlier filtering technique, since their computational cost would be reduced in case the data to be fitted contains less outliers. Disparity estimation methods that exploit RANSAC plane fitting include [22,29,31].

Many methods, such as [6,9,19], are evaluated using just the four well-known stereo pairs of the Middlebury Stereo Online Evaluation Benchmark and they manage to rank among the top methods. However, there are additional Middlebury stereo pairs that can be used to present a more thorough and complete evaluation. The presented approach, except for the well-known stereo pairs, uses 27 more stereo pairs for assessing the overall performance of this approach.

The rest of this paper is organized as follows. In Section 2, the proposed method is presented in detail. Section 3 provides information on the parameters used, as well as the experimental results, while conclusions are drawn in Section 4.

@&#PROPOSED METHOD@&#

The proposed algorithm is divided into four steps, as visualized in the flowchart of Fig. 1
                     . The values of the parameters defined throughout this section are analyzed in Section 3.

The input stereo image pair is rectified, so that the epipolar lines become horizontal [33]. Therefore, the search of point-correspondences between the two images can be performed along the same horizontal epipolar line. Except for limiting searching area, rectified input makes the application of optimization algorithms simpler, such as the scanline optimization used in this work that uses specific path directions. Additionally, since the resulting rectified images have similar scale and the epipolar lines have the same orientation, it is feasible to define and compare adaptive support areas of the same size and orientation between two rectified images. The rectification process is beyond the scope of this paper. Any efficient existing algorithm, such as the one in [33], can be used for this task.

Low-level image segmentation, which groups pixels into homogeneous regions based on color or texture, is exploited by numerous disparity estimation methods ([6,13,19,34,35]) in various ways, since it assists to acquire disparity results of high accuracy.

In this work, the stereo images are initially segmented into non-overlapping regions using a state of the art mean-shift segmentation software (EDISON software [36]), which relies on color and edge information. Detailed information about the mean-shift segmentation and the EDISON software can be found in [37–39]. The parameters used for the mean-shift segmentation are the segmentation spatial radius h
                           
                              s
                           , which is set to h
                           
                              s
                           
                           =3 and the segmentation feature space radius h
                           
                              r
                           , which is set to h
                           
                              r
                           
                           =3. The selection of these strict values ensures that the segmentation map will be of high reliability, meaning that most likely a segment will not overlap a depth discontinuity, and this fact is verified also in [13,35]. The mean-shift segmentation map for the “Tsukuba” left image (see Fig. 2a) is visualized in Fig. 2b. The pixels that belong to the same mean-shift segment have an individual label and their mean color value is computed. Let the labels image be denoted as Lab(x). The segmentation maps of the left and the right image are computed once and then used in the following algorithmic steps.

This stage considers cost metrics for estimating the similarity between two pixels. In this work, absolute differences (AD) of RGB values, AD of weighted CENSUS coefficients and AD of SIFT coefficients are exploited to define the used cost metrics. This choice is made for the following reasons: i) Exploitation of RGB information gives better results in areas where depth discontinuities exist; ii) CENSUS is able to cope with radiometric changes and noise [9], while iii) the exploitation of SIFT improves the results in textured unconcluded areas, as verified in Section 2.3.2.

In order to define the original CENSUS transform [3], a function ξ, which represents the relationship between the intensity of a pixel x
                           =(x,
                           y)T and a neighbor pixel x
                           n, is used:
                              
                                 (1)
                                 
                                    ξ
                                    
                                       x
                                       
                                          x
                                          n
                                       
                                    
                                    =
                                    
                                       
                                          
                                             
                                                1
                                                ,
                                                if
                                                
                                                I
                                                
                                                   
                                                      x
                                                      n
                                                   
                                                
                                                <
                                                I
                                                
                                                   x
                                                
                                             
                                          
                                          
                                             
                                                0
                                                ,
                                                
                                                otherwise
                                                ,
                                             
                                          
                                       
                                    
                                 
                              
                           where I(x) represents the image intensity of pixel x.

The CENSUS transform for pixel x is computed by comparing its intensity with the intensity of other pixels x
                           n that lie within a square window 
                              N
                              
                                 x
                              
                            around x. The results of these comparisons are then concatenated into a single CENSUS binary vector. Thus, the CENSUS transform of a pixel x is defined as:
                              
                                 (2)
                                 
                                    CENSUS
                                    
                                       x
                                    
                                    =
                                    
                                       
                                          ⊗
                                          
                                             
                                                x
                                                n
                                             
                                             ∈
                                             N
                                             
                                                x
                                             
                                          
                                       
                                    
                                    ξ
                                    
                                       x
                                       
                                          x
                                          n
                                       
                                    
                                    ,
                                 
                              
                           where ⊗ represents the concatenation operation.

This paper proposes a modification of the original CENSUS transform defined as a weighted CENSUS transform. In the proposed transform (see Fig. 3
                           ) the bit string that is generated from the original CENSUS transform for a central pixel x, is multiplied by a weight vector, whose elements correspond to the weights between x and each pixel 
                              
                                 x
                                 n
                              
                              ∈
                              N
                              
                                 x
                              
                           . The weight between the central pixel x (red circle in Fig. 3) and a pixel x
                           n (green circle in Fig. 3) is defined as:
                              
                                 (3)
                                 
                                    μ
                                    
                                       x
                                       
                                          x
                                          n
                                       
                                    
                                    =
                                    1
                                    −
                                    β
                                    ⋅
                                    
                                       Δ
                                       e
                                    
                                    
                                       x
                                       
                                          x
                                          n
                                       
                                    
                                    ,
                                 
                              
                           where Δ
                           
                              e
                           (x;
                           x
                           n) is the Euclidean distance between x and x
                           n and β is a constant parameter. The window size of the weighed CENSUS transform is set experimentally to 5×5. The weight vector gives greater weights for pixels closer to the central pixel, since they are considered as more reliable than those which lie further. Let us denote as CEN(x;c) the weighted CENSUS transform at pixel x for the color band c∈{R,G,B}.

The SIFT coefficients are extracted densely from an image using the SIFT implementation that was used in the work of [40], which deals with visual concept classification. In detail, the parameters used for the SIFT coefficients extraction were selected as: Size of subregions N
                           
                              P
                           
                           =1, Scale of Gaussian Derivatives σ
                           DOG
                           =1, and number of subregions N
                           
                              S
                           
                           =2. These parameters define a SIFT descriptor composed of N
                           
                              S
                           
                           ×
                           N
                           
                              S
                            subregions with subregions' size equal to N
                           
                              P
                           
                           ×
                           N
                           
                              P
                            pixels. The horizontal and vertical responses for SIFT are calculated using a Gaussian derivative filter, while the diagonal responses are calculated using a fast anisotropic Gaussian derivative filter [41], both using a scale of σ
                           DOG. When, a larger support area was used for the extraction of the SIFT descriptor vector (by increasing N
                           
                              P
                            and/or N
                           
                              S
                           ), the foreground fattening effect [1] was becoming more intense in the estimated disparity map. Let us denote SIFT(x;c) as the SIFT descriptor at pixel x for the color band c∈{R,G,B}.

In this section, the way that RGB, weighed CENSUS and SIFT are used to define the similarity between pixels, is described. Given a pixel x on the left image (reference image) I
                           
                              l
                           (x), the corresponding pixel on the right image (target image) I
                           
                              r
                            for a candidate disparity d will be I
                           
                              r
                           (x
                           
                              d
                           ), where x
                           
                              d
                           
                           =
                           x
                           −
                           d and d
                           =(d,0)
                              T
                           , since the input stereo images are rectified and consequently the disparity has only a horizontal component. The individual pixel similarity measures C
                           RGB(x;
                           d), C
                           CENSUS(x;
                           d) and C
                           SIFT(x;
                           d), between x and x
                           
                              d
                           , are given from:
                              
                                 (4)
                                 
                                    
                                       C
                                       
                                          R
                                          G
                                          B
                                       
                                    
                                    
                                       x
                                       d
                                    
                                    =
                                    
                                       
                                          ∑
                                          
                                             c
                                             ∈
                                             
                                                R
                                                G
                                                B
                                             
                                          
                                       
                                       
                                    
                                    
                                       
                                          
                                             I
                                             l
                                          
                                          
                                             x
                                             c
                                          
                                          −
                                          
                                             I
                                             r
                                          
                                          
                                             
                                                x
                                                d
                                             
                                             c
                                          
                                       
                                    
                                    ,
                                 
                              
                           
                           
                              
                                 (5)
                                 
                                    
                                       C
                                       CENSUS
                                    
                                    
                                       x
                                       d
                                    
                                    =
                                    
                                       
                                          ∑
                                          
                                             c
                                             ∈
                                             
                                                R
                                                G
                                                B
                                             
                                          
                                       
                                       
                                    
                                    
                                       
                                          
                                             C
                                             E
                                             
                                                N
                                                l
                                             
                                             
                                                x
                                                c
                                             
                                             −
                                             C
                                             E
                                             
                                                N
                                                r
                                             
                                             
                                                
                                                   x
                                                   d
                                                
                                                c
                                             
                                          
                                       
                                       1
                                    
                                    ,
                                 
                              
                           
                           
                              
                                 (6)
                                 
                                    
                                       C
                                       SIFT
                                    
                                    
                                       x
                                       d
                                    
                                    =
                                    
                                       
                                          ∑
                                          
                                             c
                                             ∈
                                             
                                                R
                                                G
                                                B
                                             
                                          
                                       
                                       
                                    
                                    
                                       
                                          
                                             S
                                             I
                                             F
                                             
                                                T
                                                l
                                             
                                             
                                                x
                                                c
                                             
                                             −
                                             S
                                             I
                                             F
                                             
                                                T
                                                r
                                             
                                             
                                                
                                                   x
                                                   d
                                                
                                                c
                                             
                                          
                                       
                                       1
                                    
                                    .
                                 
                              
                           
                        

Using the aforementioned measures three different matching costs are defined. A RGB-CENSUS combination cost C
                           R−C(x;
                           d) (following the paradigm of algorithms [7–9]), a pure weighted CENSUS-based cost C
                           CEN(x;
                           d) and a SIFT-based cost C
                           S(x;
                           d), which are given from:
                              
                                 (7)
                                 
                                    
                                       C
                                       
                                          R
                                          −
                                          C
                                       
                                    
                                    
                                       x
                                       d
                                    
                                    =
                                    ρ
                                    
                                       
                                          
                                             C
                                             
                                                R
                                                G
                                                B
                                             
                                          
                                          
                                             x
                                             d
                                          
                                          ,
                                          
                                             λ
                                             
                                                R
                                                G
                                                B
                                             
                                          
                                       
                                    
                                    +
                                    ρ
                                    
                                       
                                          
                                             C
                                             CENSUS
                                          
                                          
                                             x
                                             d
                                          
                                          ,
                                          
                                             λ
                                             
                                                C
                                                E
                                                N
                                             
                                          
                                       
                                    
                                    ,
                                 
                              
                           
                           
                              
                                 (8)
                                 
                                    
                                       C
                                       
                                          C
                                          E
                                          N
                                       
                                    
                                    
                                       x
                                       d
                                    
                                    =
                                    ρ
                                    
                                       
                                          
                                             C
                                             CENSUS
                                          
                                          
                                             x
                                             d
                                          
                                          ,
                                          
                                             λ
                                             
                                                C
                                                E
                                                N
                                             
                                          
                                       
                                    
                                    ,
                                 
                              
                           
                           
                              
                                 (9)
                                 
                                    
                                       C
                                       S
                                    
                                    
                                       x
                                       d
                                    
                                    =
                                    ρ
                                    
                                       
                                          
                                             C
                                             SIFT
                                          
                                          
                                             x
                                             d
                                          
                                          ,
                                          
                                             λ
                                             SIFT
                                          
                                       
                                    
                                    ,
                                 
                              
                           where ρ(C
                           
                              y
                           ,
                           λ
                           
                              y
                           )=1−
                           e
                           (−
                              Cy/λy).

The exponential function ρ(C
                           
                              y
                           ,
                           λ
                           
                              y
                           ) has the advantage of mapping the values of a measure in the range of [0, 1]. This allows different types of measures with different ranges to be scaled into the same range and then to be combined. Additionally, this function allows trimming of outlier values of C
                           
                              y
                           , depending on the value of λ
                           
                              y
                           .

In order to reduce matching ambiguity, the pixel-based matching costs C
                           R−C(x;
                           d), C
                           CEN(x;
                           d) and C
                           S(x;
                           d) are aggregated spatially over support regions around each pixel. According to the evaluation studies of [10,11], the adaptive weight approach [12] produces reasonably accurate disparity maps. Thus, this aggregation approach with slight modifications is used in this work.

More specifically, adaptive support-weight based aggregation applies weights to each of the pixels surrounding the pixel of interest. The adaptive-support weights notion is based on the Gestalt principles of similarity and proximity [12]. The similarity principle assumes that the more similar color a surrounding pixel has to the central pixel of interest, the more likely it is to belong to the same surface, while the proximity principle assumes that the closer a surrounding pixel is to the central pixel of interest, the more likely it is to belong to the same surface.

In order to describe the adaptive-support weight notion with mathematic expressions, a pixel of interest x and a neighbor pixel x
                           n are considered. The adaptive weight between x and x
                           n, is given by:
                              
                                 (10)
                                 
                                    w
                                    
                                       x
                                       
                                          x
                                          n
                                       
                                    
                                    =
                                    
                                       e
                                       
                                          
                                             
                                                −
                                                Δ
                                                I
                                                
                                                   x
                                                   
                                                      x
                                                      n
                                                   
                                                
                                             
                                             
                                                γ
                                                c
                                             
                                          
                                       
                                    
                                    ⋅
                                    
                                       e
                                       
                                          
                                             
                                                −
                                                Δ
                                                e
                                                
                                                   x
                                                   
                                                      x
                                                      n
                                                   
                                                
                                             
                                             
                                                γ
                                                e
                                             
                                          
                                       
                                    
                                    ,
                                 
                              
                           where γ
                           
                              e
                            and γ
                           c are constant parameters, Δe(x;
                           x
                           n) is the Euclidean distance between x and x
                           n and ΔI(x;
                           x
                           n) is given by:
                              
                                 (11)
                                 
                                    Δ
                                    I
                                    
                                       x
                                       
                                          x
                                          n
                                       
                                    
                                    =
                                    
                                       
                                          
                                             
                                                ∑
                                                
                                                   c
                                                   ∈
                                                   
                                                      R
                                                      G
                                                      B
                                                   
                                                
                                             
                                             
                                          
                                          |
                                          I
                                          
                                             x
                                             c
                                          
                                          −
                                          I
                                          (
                                          
                                             x
                                             n
                                          
                                          ;
                                          c
                                          
                                             
                                                )
                                                |
                                             
                                             2
                                          
                                       
                                    
                                    .
                                 
                              
                           
                        

Similar to [16], the adaptive weights are computed on the input stereo images after applying a median filter that uses a 2×2 neighborhood in order to alleviate the impact of image noise and subtle non-Lambertian effects.

The adaptive weight approach used in this work has two slight modifications compared to the original work of [12]. Experimental results in [13] proved that the use of the RGB color space for computing color similarity decreases the possibility that pixels belonging to different depths are being aggregated in the same support region. For this reason the RGB color similarity is used, contrary to the CIELAB similarity used in [12]. Additionally, instead of using all pixels in the square support region, only pixels within radius R
                           S from the central pixel are used. In this way, the support region becomes symmetric around the central pixel x of interest.

A weight support mask is generated for a pixel x on the left stereo image, denoted as w
                           
                              l
                           (x;
                           x
                           n). Similarly, a weight support mask is generated for the right stereo image around the corresponding pixel x
                           
                              d
                            and is denoted as w
                           
                              r
                           (x
                           
                              d
                           ;
                           x
                           n
                           
                              d
                           ). Both w
                           
                              l
                           (x;
                           x
                           n) and w
                           
                              r
                           (x
                           
                              d
                           ;
                           x
                           n
                           
                              d
                           ) are taken into consideration to define the aggregated cost V(x;
                           d) between x and x
                           
                              d
                            as:
                              
                                 (12)
                                 
                                    V
                                    
                                       x
                                       d
                                    
                                    =
                                    
                                       
                                          
                                             
                                                ∑
                                                
                                                   
                                                      x
                                                      n
                                                   
                                                   ∈
                                                   
                                                      S
                                                      L
                                                   
                                                   ,
                                                   
                                                      x
                                                      n
                                                      d
                                                   
                                                   ∈
                                                   
                                                      S
                                                      R
                                                   
                                                
                                             
                                             
                                          
                                          
                                             w
                                             l
                                          
                                          
                                             x
                                             
                                                x
                                                n
                                             
                                          
                                          ⋅
                                          
                                             w
                                             r
                                          
                                          
                                             
                                                x
                                                d
                                             
                                             
                                                x
                                                n
                                                d
                                             
                                          
                                          ⋅
                                          C
                                          
                                             
                                                x
                                                n
                                             
                                             d
                                          
                                       
                                       
                                          
                                             
                                                ∑
                                                
                                                   
                                                      x
                                                      n
                                                   
                                                   ∈
                                                   
                                                      S
                                                      L
                                                   
                                                   ,
                                                   
                                                      x
                                                      n
                                                      d
                                                   
                                                   ∈
                                                   
                                                      S
                                                      R
                                                   
                                                
                                             
                                             
                                          
                                          
                                             w
                                             l
                                          
                                          
                                             x
                                             
                                                x
                                                n
                                             
                                          
                                          ⋅
                                          
                                             w
                                             r
                                          
                                          
                                             
                                                x
                                                d
                                             
                                             
                                                x
                                                n
                                                d
                                             
                                          
                                       
                                    
                                    ,
                                 
                              
                           where SL defines the support region around pixel x on the left image and SR is the support region around pixel x
                           
                              d
                           , on the right image, as it is visualized in Fig. 4
                           . If cost C(x;
                           d) is replaced by C
                           R−C(x;
                           d), C
                           CEN(x;
                           d) or C
                           S(x;
                           d), the aggregated cost volumes V
                           R−C(x;
                           d), V
                           CEN(x;
                           d) and V
                           SIFT(x;
                           d) can be estimated, respectively. The schematic representation of a cost volume is depicted in Fig. 5a.

In the beginning of this section, we explain the reasons for using the specified cost metrics C
                           R−C(x;
                           d), C
                           CEN(x;
                           d) and C
                           S(x;
                           d). In this paragraph, we describe the details of combining their corresponding cost volumes V
                           R−C(x;
                           d), V
                           CEN(x;
                           d) and V
                           SIFT(x;
                           d) to produce a combined cost volume.

The proposed approach uses a combination of RGB and CENSUS information via Eq. (7) in order to compute V
                           R−C. However, after extensive experiments, it was deduced that the cost volume V
                           CEN computed using only weighted CENSUS information, could be efficiently exploited to refine V
                           R−C. Additionally, it was noticed that the winner-take-all-estimated disparity map from V
                           SIFT is reliable for unoccluded textured areas. This fact is exploited here to further refine V
                           R−C. The reason for not combining directly the SIFT information with the RGB and CENSUS information (for instance using an equation similar to Eq. (7), with an additional term for SIFT information), is that the ability of the SIFT-based metric to provide accurate disparity estimates at unoccluded textured areas degrades significantly when SIFT is combined directly with other cost metrics, as experimentally verified. In the following, an efficient two-phase strategy for combining V
                           R−C, V
                           CEN and V
                           SIFT is described. This strategy is built upon the aforementioned conclusions regarding V
                           CEN and V
                           SIFT.

During the first phase, V
                              CEN(x;
                              d) is used to refine V
                              R−C(x;
                              d). The Peak Ratio confidence measure, one of the best confidence measures according to [42], is used for this purpose.

Let us consider that we have the curve of cost variation along disparity d for a pixel x from cost volume V(x;
                                 d). This term is depicted visually with green color in the visual representation of a cost volume V(x;
                                 d) in Fig. 5a and an example of cost variation curve is shown in Fig. 5c. Let us define as 
                                    G
                                    
                                       x
                                    
                                    =
                                    
                                       
                                          min
                                          d
                                       
                                    
                                    
                                       
                                          V
                                          
                                             x
                                             d
                                          
                                       
                                    
                                  the global minimum of V(x;
                                 d) and as L(x) the second local minimum of V(x;
                                 d). Then, the peak ratio confidence measure is defined as:
                                    
                                       (13)
                                       
                                          R
                                          
                                             x
                                          
                                          =
                                          
                                             
                                                L
                                                
                                                   x
                                                
                                             
                                             
                                                G
                                                
                                                   x
                                                
                                             
                                          
                                          .
                                       
                                    
                                 
                              

Finally, let
                                    
                                       (14)
                                       
                                          α
                                          
                                             x
                                          
                                          =
                                          arg
                                          
                                          
                                             min
                                             d
                                          
                                          
                                             
                                                V
                                                
                                                   x
                                                   d
                                                
                                             
                                          
                                          ,
                                       
                                    
                                 be the optimum disparity value that gives the global minimum of V(x;
                                 d). The higher R(x), the more confident the global minimum of V(x;
                                 d) is.

Based on this confidence measure, the optimum disparity for a pixel x, as estimated from V
                                 CEN(x;
                                 d), will be propagated to V
                                 R−C(x;
                                 d). The curves of cost variation along disparity for V
                                 R−C(x;
                                 d) and V
                                 CEN(x;
                                 d) are depicted in Fig. 5b and Fig. 5c, respectively.

In more detail, for a pixel x, the confidence 
                                    
                                       R
                                       
                                          R
                                          −
                                          C
                                       
                                    
                                    
                                       x
                                    
                                    =
                                    
                                       
                                          
                                             G
                                             
                                                R
                                                −
                                                C
                                             
                                          
                                          
                                             x
                                          
                                       
                                       
                                          
                                             L
                                             
                                                R
                                                −
                                                C
                                             
                                          
                                          
                                             x
                                          
                                       
                                    
                                  based on V
                                 R−C(x;
                                 d) (Fig. 5b), is estimated. Similarly, the confidence 
                                    
                                       R
                                       
                                          C
                                          E
                                          N
                                       
                                    
                                    
                                       x
                                    
                                    =
                                    
                                       
                                          
                                             G
                                             
                                                C
                                                E
                                                N
                                             
                                          
                                          
                                             x
                                          
                                       
                                       
                                          
                                             L
                                             
                                                C
                                                E
                                                N
                                             
                                          
                                          
                                             x
                                          
                                       
                                    
                                  based on V
                                 CEN(x;
                                 d) (Fig. 5c), is estimated.

In case that R
                                 CEN(x)>
                                 R
                                 R−C(x), at the disparity position α
                                 CEN(x) (position of the global minimum of V
                                 CEN(x;
                                 d)), the corresponding value of V
                                 R−C(x;
                                 α
                                 CEN(x)) is modified according to:
                                    
                                       (15)
                                       
                                          
                                             V
                                             
                                                R
                                                −
                                                C
                                             
                                          
                                          
                                             
                                                x
                                                ;
                                                
                                                   α
                                                   
                                                      C
                                                      E
                                                      N
                                                   
                                                
                                                
                                                   x
                                                
                                             
                                          
                                          ←
                                          
                                             
                                                min
                                                d
                                             
                                          
                                          
                                             
                                                
                                                   V
                                                   
                                                      R
                                                      −
                                                      C
                                                   
                                                
                                                
                                                   x
                                                   d
                                                
                                             
                                          
                                          −
                                          δ
                                       
                                    
                                 with δ
                                 →0+, so that the global minimum of V
                                 R−C(x;
                                 d) to coincide with the one of V
                                 CEN(x;
                                 d). The part of the curve that changes after this step is depicted with green color in Fig. 5b. The case R
                                 CEN(x)>
                                 R
                                 R−C(x) means that the global minimum of V
                                 CEN(x;
                                 d) is more confident than that of V
                                 R−C(x;
                                 d). In this case, information about the disparity that gives this global minimum is propagated to V
                                 R−C(x;
                                 d). After executing the first phase, V
                                 ′
                                 R−C(x;
                                 d) is acquired. The winner-take-all (WTA) of V
                                 ′
                                 R−C(x;
                                 d) gives the disparity map of Fig. 6a.

In a second phase, V
                              SIFT(x;
                              d) is used to refine V
                              ′
                              R−C(x;
                              d). The WTA of V
                              SIFT(x;
                              d) gives the SIFT-based disparity map d
                              SIFT(x) (see Fig. 6b), which provides reliable disparities in textured unoccluded areas where depth does not change. This is evident in Fig. 6b for the disparity of the left “Tsukuba” image.

In order to find the regions in d
                                 SIFT(x) that are reliable, the mean-shift color segmentation map (see Section 2.1.2) is used. If n(S) denotes the number of pixels in a color segment S and n
                                 
                                    f
                                 (S) is the number of pixels that have the most frequent disparity in this segment according to d
                                 SIFT, then 
                                    
                                       P
                                       x
                                    
                                    
                                       S
                                    
                                    =
                                    
                                       
                                          
                                             n
                                             f
                                          
                                          
                                             S
                                          
                                       
                                       
                                          n
                                          
                                             S
                                          
                                       
                                    
                                  is defined. If P
                                 
                                    x
                                 (S)≥90%, then it is assumed that the disparities inside this segment are reliable (since the vast majority of pixels have the same disparity value).

According to the above, reliable disparities in d
                                 SIFT(x) are propagated to V
                                 ′
                                 R−C(x;
                                 d) in the following way: For every pixel x
                                 ∈
                                 S, the disparity estimate d
                                 SIFT(x) is propagated to V
                                 ′
                                 R−C(x;
                                 d) according to:
                                    
                                       (16)
                                       
                                          
                                             V
                                             
                                                R
                                                −
                                                C
                                             
                                             ′
                                          
                                          
                                             
                                                x
                                                ;
                                                
                                                   d
                                                   SIFT
                                                
                                                
                                                   x
                                                
                                             
                                          
                                          ←
                                          
                                             
                                                min
                                                d
                                             
                                          
                                          
                                             
                                                
                                                   V
                                                   
                                                      R
                                                      −
                                                      C
                                                   
                                                   ′
                                                
                                                
                                                   x
                                                   d
                                                
                                             
                                          
                                          −
                                          δ
                                       
                                    
                                 with δ
                                 →0+. After executing this second phase, V
                                 ″
                                 R−C(x;
                                 d) is acquired. Let the WTA-estimated disparity map from V
                                 R−C
                                 ″(x;
                                 d) be d
                                 LR(x). After applying a 3×3 median filter on d
                                 LR(x), in order to remove spurious disparities, the disparity map of Fig. 7a is generated.

Comparing Figs. 6a and 7a, it is evident that d
                                 SIFT(x) can be exploited to efficiently enhance the results in unoccluded textured regions.

Except for the visual demonstration of using the two-phase combination strategy to improve the generated disparity map, an additional numeric evaluation is presented in Section 3.2.2.

The disparity map d
                           LR(x) is acquired considering as reference image the left image of the stereo pair. If the right image is considered as reference, then the disparity map d
                           RL(x) of Fig. 7b is acquired. The disparity maps d
                           LR(x) and d
                           RL(x) are taken into consideration to detect problematic areas, especially outliers in occluded regions and depth discontinuities. A prevalent strategy for detecting outliers is the Left–Right consistency check [24]. In this strategy, the outliers are disparity values that are not consistent between the two maps and therefore, they do not satisfy the relation:
                              
                                 (17)
                                 
                                    
                                       
                                          
                                             d
                                             
                                                L
                                                R
                                             
                                          
                                          
                                             x
                                          
                                          −
                                          
                                             d
                                             
                                                R
                                                L
                                             
                                          
                                          
                                             
                                                x
                                                −
                                                
                                                   d
                                                   
                                                      L
                                                      R
                                                   
                                                
                                                
                                                   x
                                                
                                             
                                          
                                       
                                    
                                    ≤
                                    
                                       T
                                       
                                          L
                                          R
                                       
                                    
                                    .
                                 
                              
                           
                        

At this point of our algorithm, the threshold for outliers detection is set equal to T
                           LR
                           =1. With this value, pixels with difference equal to 1 in the Left–Right consistency check are not considered as outliers. This is plausible, since disparity in stereo images usually varies smoothly along the epipolar lines, in regions without depth discontinuities. Fig. 8a shows the outliers map 
                              
                                 O
                                 1
                                 
                                    
                                       T
                                       
                                          L
                                          R
                                       
                                    
                                    =
                                    1
                                 
                              
                              
                                 x
                              
                            for T
                           LR
                           =1. The blue regions are the outlier regions.

Let XOUT be the set of outlier pixels. Before applying scanline optimization, the cost values in V
                           ″
                           R−C(x;
                           d) that correspond to outlier pixels x
                           ∈XOUT are set to zero. This way, the costs of these pixels do not affect the optimization result.

The optimization of the combined cost volume V
                           R−C
                           ″(x;
                           d) is based on the semi-global, scanline optimization method of [21], which aggregates matching costs in 1D equally from multiple path directions.

This work considers four path directions r, namely left-to-right, right-to-left, up-to-down and down-to-up, which are denoted as r
                           
                              lr
                           
                           =[+1,0]
                              T
                           , r
                           
                              rl
                           
                           =[−1,0]
                              T
                           , r
                           
                              ud
                           
                           =[0,+1]
                              T
                            and r
                           
                              du
                           
                           =[0,−1]
                              T
                           , respectively (see Fig. 8b).

Let L
                           
                              r
                            be a path that is traversed in the direction r
                           ∈{r
                           
                              lr
                           ,
                           r
                           
                              rl
                           ,
                           r
                           
                              ud
                           ,
                           r
                           
                              du
                           }. The path cost L
                           
                              r
                           (x;
                           d) of pixel x at disparity d is computed recursively from:
                              
                                 (18)
                                 
                                    
                                       
                                          
                                             
                                                L
                                                r
                                             
                                             
                                                x
                                                d
                                             
                                             =
                                             
                                                V
                                                
                                                   R
                                                   −
                                                   C
                                                
                                                ″
                                             
                                             
                                                x
                                                d
                                             
                                             +
                                             min
                                             {
                                             
                                                L
                                                r
                                             
                                             
                                                
                                                   x
                                                   −
                                                   r
                                                   ;
                                                   d
                                                
                                             
                                             ,
                                             
                                                L
                                                r
                                             
                                             
                                                
                                                   x
                                                   −
                                                   r
                                                   ;
                                                   d
                                                   ±
                                                   1
                                                
                                             
                                             +
                                             
                                                π
                                                1
                                             
                                             ,
                                          
                                       
                                       
                                          
                                             
                                                
                                                   min
                                                   i
                                                
                                             
                                             
                                                L
                                                r
                                             
                                             
                                                
                                                   x
                                                   −
                                                   r
                                                   ;
                                                   i
                                                
                                             
                                             +
                                             
                                                π
                                                2
                                             
                                             }
                                             −
                                             
                                                
                                                   min
                                                   i
                                                
                                             
                                             
                                                L
                                                r
                                             
                                             
                                                
                                                   x
                                                   −
                                                   r
                                                   ;
                                                   i
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           where i
                           ∈[disparityrange] and x
                           −
                           r denotes the previous pixel along the path direction. π1 and π2 are two smoothness penalty terms (with π1
                           ≤π2) for penalizing disparity changes of neighboring pixels. The works in [9,24] make the assumption that often a depth discontinuity (i.e. disparity change) coincides with an intensity edge.

In our approach, two criteria are used to check depth discontinuity and consequently compute the smoothing terms π1 and π2. The first criterion, as in [24], checks the intensity difference between the current pixel and the previous one along the considered path direction. The intensity difference, on the two images, is defined as:
                              
                                 (19)
                                 
                                    ∇
                                    
                                       x
                                    
                                    =
                                    
                                       
                                          max
                                          
                                             c
                                             ∈
                                             
                                                R
                                                G
                                                B
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             I
                                             l
                                          
                                          
                                             x
                                             c
                                          
                                          −
                                          
                                             I
                                             l
                                          
                                          
                                             
                                                x
                                                −
                                                r
                                                ;
                                                c
                                             
                                          
                                       
                                    
                                 
                              
                           and
                              
                                 (20)
                                 
                                    ∇
                                    
                                       
                                          x
                                          d
                                       
                                    
                                    =
                                    
                                       
                                          max
                                          
                                             c
                                             ∈
                                             
                                                R
                                                G
                                                B
                                             
                                          
                                       
                                    
                                    
                                       
                                          
                                             I
                                             r
                                          
                                          
                                             
                                                x
                                                d
                                             
                                             c
                                          
                                          −
                                          
                                             I
                                             r
                                          
                                          
                                             
                                                
                                                   x
                                                   d
                                                
                                                −
                                                r
                                                ;
                                                c
                                             
                                          
                                       
                                    
                                    .
                                 
                              
                           
                        

The second criterion, proposed in our approach, checks whether the current pixel and the previous one along the considered path direction belong to the same mean-shift segment.
                              
                                 (21)
                                 
                                    
                                       
                                          π
                                          1
                                       
                                       
                                          π
                                          2
                                       
                                    
                                    =
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      Π
                                                      1
                                                   
                                                   
                                                      Π
                                                      2
                                                   
                                                
                                                ,
                                                
                                                if
                                                
                                                
                                                   
                                                      ∇
                                                      
                                                         x
                                                      
                                                      ≤
                                                      
                                                         τ
                                                         so
                                                      
                                                      
                                                      &
                                                      
                                                      ∇
                                                      
                                                         
                                                            x
                                                            d
                                                         
                                                      
                                                      ≤
                                                      
                                                         τ
                                                         so
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         Π
                                                         1
                                                      
                                                      1.5
                                                   
                                                   
                                                      
                                                         Π
                                                         2
                                                      
                                                      1.5
                                                   
                                                
                                                ,
                                                
                                                if
                                                
                                                
                                                   
                                                      
                                                         Lab
                                                         l
                                                      
                                                      
                                                         x
                                                      
                                                      =
                                                      =
                                                      
                                                         Lab
                                                         l
                                                      
                                                      
                                                         
                                                            x
                                                            −
                                                            r
                                                         
                                                      
                                                      
                                                      &
                                                      
                                                      
                                                         Lab
                                                         r
                                                      
                                                      
                                                         
                                                            x
                                                            d
                                                         
                                                      
                                                      =
                                                      =
                                                      
                                                         Lab
                                                         r
                                                      
                                                      
                                                         
                                                            
                                                               x
                                                               d
                                                            
                                                            −
                                                            r
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         Π
                                                         1
                                                      
                                                      4
                                                   
                                                   
                                                      
                                                         Π
                                                         2
                                                      
                                                      4
                                                   
                                                
                                                ,
                                                
                                                if
                                                
                                                
                                                   
                                                      ∇
                                                      
                                                         x
                                                      
                                                      ≤
                                                      
                                                         τ
                                                         so
                                                      
                                                      
                                                      &
                                                      
                                                      ∇
                                                      
                                                         
                                                            x
                                                            d
                                                         
                                                      
                                                      >
                                                      
                                                         τ
                                                         so
                                                      
                                                   
                                                
                                                
                                                or
                                                
                                                   
                                                      
                                                         Lab
                                                         l
                                                      
                                                      
                                                         x
                                                      
                                                      =
                                                      =
                                                      
                                                         Lab
                                                         l
                                                      
                                                      
                                                         
                                                            x
                                                            −
                                                            r
                                                         
                                                      
                                                      
                                                      &
                                                      
                                                      
                                                         Lab
                                                         r
                                                      
                                                      
                                                         
                                                            x
                                                            d
                                                         
                                                      
                                                      ≠
                                                      
                                                         Lab
                                                         r
                                                      
                                                      
                                                         
                                                            
                                                               x
                                                               d
                                                            
                                                            −
                                                            r
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         Π
                                                         1
                                                      
                                                      4
                                                   
                                                   
                                                      
                                                         Π
                                                         2
                                                      
                                                      4
                                                   
                                                
                                                ,
                                                
                                                if
                                                
                                                
                                                   
                                                      ∇
                                                      
                                                         x
                                                      
                                                      >
                                                      
                                                         τ
                                                         so
                                                      
                                                      
                                                      &
                                                      
                                                      ∇
                                                      
                                                         
                                                            x
                                                            d
                                                         
                                                      
                                                      ≤
                                                      
                                                         τ
                                                         so
                                                      
                                                   
                                                
                                                or
                                                
                                                   
                                                      
                                                         Lab
                                                         l
                                                      
                                                      
                                                         x
                                                      
                                                      ≠
                                                      
                                                         Lab
                                                         l
                                                      
                                                      
                                                         
                                                            x
                                                            −
                                                            r
                                                         
                                                      
                                                      
                                                      &
                                                      
                                                      
                                                         Lab
                                                         r
                                                      
                                                      
                                                         
                                                            x
                                                            d
                                                         
                                                      
                                                      =
                                                      =
                                                      
                                                         Lab
                                                         r
                                                      
                                                      
                                                         
                                                            
                                                               x
                                                               d
                                                            
                                                            −
                                                            r
                                                         
                                                      
                                                   
                                                
                                             
                                          
                                          
                                             
                                                
                                                   
                                                      
                                                         Π
                                                         1
                                                      
                                                      10
                                                   
                                                   
                                                      
                                                         Π
                                                         2
                                                      
                                                      10
                                                   
                                                
                                                ,
                                                
                                                otherwise
                                                .
                                             
                                          
                                       
                                    
                                 
                              
                           
                        

Based on these two criteria, π1 and π
                           2 are defined according to Eq. (21), where Π1
                           =0.2, Π2
                           =0.6 are constant parameters, τ
                           so
                           =10 is a threshold for color difference and Lab
                              l
                            and Lab
                              r
                            are the labels images after applying mean-shift segmentation (see Section 2.1.2) to the left and right images, respectively. The denominator for the second condition of Eq. (21), has been slightly increased to 1.5 so as to compensate for segmentation errors.

To sum up, while the approaches in [9,24], employ only intensity based criteria to define π1 and π2, the proposed method introduces an additional criterion based on mean-shift segmentation that assists in enhancing the disparity estimation results, as it is experimentally verified in Section 3.2.4.

After computing the four path costs, the final cost volume V
                           R−C
                           ‴(x;
                           d) is calculated from:
                              
                                 (22)
                                 
                                    
                                       V
                                       
                                          R
                                          −
                                          C
                                       
                                       ‴
                                    
                                    
                                       x
                                       d
                                    
                                    =
                                    
                                       
                                          
                                             
                                                ∑
                                                
                                                   r
                                                   ∈
                                                   
                                                      
                                                         r
                                                         
                                                            l
                                                            r
                                                         
                                                      
                                                      
                                                         r
                                                         
                                                            r
                                                            l
                                                         
                                                      
                                                      
                                                         r
                                                         
                                                            u
                                                            d
                                                         
                                                      
                                                      
                                                         r
                                                         
                                                            d
                                                            u
                                                         
                                                      
                                                   
                                                
                                             
                                             
                                          
                                          
                                             L
                                             r
                                          
                                          
                                             x
                                             d
                                          
                                       
                                       4
                                    
                                    .
                                 
                              
                           
                        

The WTA of V
                           R−C
                           ‴(x;
                           d) gives disparity map d
                           ′
                           LR(x) (see Fig. 9a). If the right image is considered as reference image, then the disparity map d
                           ′
                           RL(x) (see Fig. 9b) is acquired.

The disparity map, after cost volume optimization, contains a large number of outliers in occluded regions, uniform areas and near depth discontinuities. With the algorithmic steps, described through this section, these problematic areas can be handled efficiently in order to get a disparity map of high accuracy. The contribution of each refinement step, in the handling of problematic areas, is described later in Section 3.2.3.

The disparity maps of the left image d
                              ′
                              LR(x) (see Fig. 9a) and the right image d
                              ′
                              RL(x) (see Fig. 9b) are taken into account so as to detect problematic areas. According to Left–Right consistency check:
                                 
                                    (23)
                                    
                                       
                                          
                                             
                                                d
                                                
                                                   L
                                                   R
                                                
                                                ′
                                             
                                             
                                                x
                                             
                                             −
                                             
                                                d
                                                
                                                   R
                                                   L
                                                
                                                ′
                                             
                                             
                                                
                                                   x
                                                   −
                                                   
                                                      d
                                                      
                                                         L
                                                         R
                                                      
                                                      ′
                                                   
                                                   
                                                      x
                                                   
                                                
                                             
                                          
                                       
                                       ≤
                                       
                                          T
                                          
                                             L
                                             R
                                          
                                       
                                       ,
                                    
                                 
                              for T
                              LR
                              =0 and T
                              LR
                              =1 the outliers maps 
                                 
                                    O
                                    2
                                    
                                       
                                          T
                                          
                                             L
                                             R
                                          
                                       
                                       =
                                       0
                                    
                                 
                                 
                                    x
                                 
                               (see Fig. 10a) and 
                                 
                                    O
                                    2
                                    
                                       
                                          T
                                          
                                             L
                                             R
                                          
                                       
                                       =
                                       1
                                    
                                 
                                 
                                    x
                                 
                               (see Fig. 10b) are acquired, respectively.

The detected outliers (due to occlusions) have to be filled with reliable disparities from neighboring areas. Occlusion handling is performed by combining two occlusion handling schemes that are executed independently. The first occlusion scheme is very simple and the second scheme is performed by exploiting the mean-shift color segmentation map.

The basic occlusion handling strategy is performed for the outlier map 
                                 
                                    O
                                    2
                                    
                                       
                                          T
                                          
                                             L
                                             R
                                          
                                       
                                       =
                                       0
                                    
                                 
                                 
                                    x
                                 
                               (see Fig. 10a). In more detail, an outlier pixel x is filled by the disparity of its closest inlier pixel. Practically, the disparity values of x's left nearest inlier pixel x
                              
                                 l
                               and x's right nearest inlier pixel x
                              
                                 r
                               are denoted as d
                              ′
                              LR(x
                              
                                 l
                              ) and d
                              ′
                              LR(x
                              
                                 r
                              ), respectively. Then, the disparity value of min(d
                              ′
                              LR(x
                              
                                 l
                              ),
                              d
                              ′
                              LR(x
                              
                                 r
                              )) is assigned to x. The disparity map, after the basic occlusion handling, is visualized in Fig. 11c.

There is high probability that the candidate “outlier” points for T
                              LR
                              =1, are not actual outliers. Instead, it is probable that there is a slight difference in the disparity estimation between the left and the right disparity maps. The following technique is applied to propagate reliably disparity information from the right disparity map to the left disparity map.

For a pixel ϕ, with T
                              LR(ϕ)=1, the subset of pixels within radius 7 from ϕ, which at the same time belong to the same segment as ϕ, is defined. This subset is used to estimate a reliability metric Rel
                              LR(ϕ), whose value is given by the division of the number of pixels within this subset with T
                              LR
                              =0 towards the total number of pixels in this subset. Correspondingly, for a pixel ψ, which is the correspondence of pixel ϕ in the right image, is computed similarly the metric Rel
                              RL(ψ). The disparity of pixel ψ is propagated to pixel ϕ in case that d
                              ′
                              LR(ϕ)>
                              d
                              ′
                              RL(ψ) and Rel
                              LR(ϕ)<
                              Rel
                              RL(ψ). Pixels ϕ, whose disparity has been propagated from their corresponding ψ pixels and the pixels that correspond to T
                              LR
                              =0 are considered as “unoccluded”. These pixels are used in the application of the mean shift segmentation-based occlusion handling, as follows.

Initially, for each mean-shift segment the ratio of the unoccluded pixels inside this segment over the total number of segment pixels is evaluated. This ratio constitutes a reliability measure for the disparities inside this segment. Such a reliability map is illustrated in Fig. 11a. The warmer the color, the more reliable the disparities inside a segment are. A segment is considered as reliable if the ratio is over T
                              
                                 r
                               (experimentally defined to be 0.3).

For the outlier pixels inside a reliable segment S, a voting scheme that counts votes of the reliable pixels disparities is applied. In more detail, for each outlier pixel x
                                 ∈
                                 S, the inlier pixels that belong to S and lie within Euclidean distance R
                                 S (radius of support region defined in Section 2.3.1) from x are taken into account in order to get the most frequent disparity. This disparity is propagated to x, which is considered as reliable now. This process is repeated for all outliers inside a segment S.

For unreliable segments, the information from reliable neighboring segments is used to define their disparity. Reliable neighboring segments are the reliable segments that have common borders with the unreliable segments. For example, in Fig. 11b the unreliable segment is surrounded by the colored neighboring segments. The reliable neighboring segment that will propagate its prevalent disparity to the unreliable segment is the one that has the most similar color to the unreliable segment. Notice that the mean color of each segment was estimated during the mean-shift segmentation. The color similarity between two segments is defined as the mean Euclidean distance between their mean RGB colors and should be over T
                                 S (experimentally defined to be 25). The disparity map, after handling occluded areas based on the mean-shift segmentation-based approach, is visualized in Fig. 11d. The red areas in Fig. 11d correspond to pixels that have not been handled using the mean-shift segmentation-based handling.

Finally, the occluded areas that have not been handled using the mean-shift based segmentation handling are filled with the disparities that have been estimated through the basic occlusion handling and in this way the combined disparity map of Fig. 11e is acquired.

Disparity edges, which correspond to depth discontinuities, may contain disparity errors [9]. Therefore, a two-step approach is used to refine the disparity information at the edges. The first step detects and handles the disparity edges at a coarser level and the second one at a finer level.

The pixels that belong to a disparity edge are assumed to have a difference greater or equal to 2 with at least one of their 4-adjacent pixels disparity. Otherwise, if the difference is below 2, then the surface varies smoothly and therefore one can assume that there is no depth discontinuity. Fig. 12b shows the disparity edges extracted from the disparity map of Fig. 12a. During the first step, around each pixel of the disparity edge, a circular region of radius 3 is defined. The disparities of the pixels that fall inside the circular region and at the same time belong to the same mean-shift segment, as the pixel of the disparity edge, are used to find the most frequent disparity value. This value is propagated to the edge pixel. The disparity result after the first step is depicted in Fig. 12c.

The second step handles discontinuities at a finer scale. Firstly, canny edge detection (see Fig. 12d) is applied to the disparity result of Fig. 12c. Canny can detect disparity edges at finer scale than the coarse previously-described step (this is evident when comparing Fig. 12b and Fig. 12d). Then a patch of size 3×3 is centered at each edge point and the disparity regions separated by the edge are found. Fig. 12d shows that the edge separates the patch into a yellow and green disparity region. The disparity region that contains the pixel with the greatest color similarity to the edge pixel (the color similarity is found according to the initial reference stereo image) gives its disparity to the considered pixel.

Usually, images contain large uniform areas, where it is difficult to establish accurate pixel correspondences between two images. In order to deal with ambiguous matches in these areas, a new methodology is proposed in this paper.

Initially, large uniform areas on the image are detected. Large uniform areas are considered to be the mean-shift segments that contain over 
                                 2
                                 ⋅
                                 
                                    
                                       R
                                       S
                                    
                                    2
                                 
                               pixels (R
                              S is the radius of the support region as defined in Section 2.3.1). Then, each segment's “inlier” pixels are estimated and used for the uniform areas handling.

Inlier pixels x from d
                              LR(x) (Section 2.3.2), are used for the uniform-areas handling. We determine inlier pixel regions as follows:
                                 
                                    •
                                    The outliers map 
                                          
                                             O
                                             1
                                             
                                                
                                                   T
                                                   
                                                      L
                                                      R
                                                   
                                                
                                                =
                                                1
                                             
                                          
                                          
                                             x
                                          
                                        of Section 2.4.1 (see Fig. 8a), as well as the outliers map 
                                          
                                             O
                                             2
                                             
                                                
                                                   T
                                                   
                                                      L
                                                      R
                                                   
                                                
                                                =
                                                0
                                             
                                          
                                          
                                             x
                                          
                                        of Section 2.5.1 (see Fig. 10a) are considered in order to acquire their union, which defines the overall outliers map OU(x). In OU(x), outlier pixels are those that are outliers in either 
                                          
                                             O
                                             1
                                             
                                                
                                                   T
                                                   
                                                      L
                                                      R
                                                   
                                                
                                                =
                                                1
                                             
                                          
                                          
                                             x
                                          
                                        or 
                                          
                                             O
                                             2
                                             
                                                
                                                   T
                                                   
                                                      L
                                                      R
                                                   
                                                
                                                =
                                                0
                                             
                                          
                                          
                                             x
                                          
                                       . Let XIn be the set of inlier pixels in OU(x).

A visual example is given in the first row of Fig. 13
                              . Fig. 13a shows the overall outliers map that is generated after the union of the outliers maps acquired in Sections 2.4.1 and 2.5.1. The inlier pixels XIn are denoted with red color.

A histogram analysis, based on the inlier pixels' disparities d
                              LR(XIn) is applied in order to acquire a reliable subset of the pixels. For instance, for the mean-shift segment of Fig. 13b (marked with blue color), the histogram of the disparities of the inlier pixels inside this segment is depicted in Fig. 14a.

Theoretically, the disparities of the pixels in a segment S should vary continuously within a disparity range, since they belong to the same continuous surface. Based on this assumption, the employed approach is followed to get the subset of the reliable pixels.

Initially, the histogram of disparities is separated into parts (each part expresses a disparity range), as shown in Fig. 14a. To separate the histogram into parts, bins with a height below a “separation threshold” are ignored, so that they do not affect the separation process. This threshold is selected equal to: 
                                 
                                    
                                       Number
                                       
                                       of
                                       
                                       inlier
                                       
                                       pixels
                                       
                                       in
                                       
                                       S
                                    
                                    
                                       Number
                                       
                                       of
                                       
                                       possible
                                       
                                       disparities
                                    
                                 
                              . The reliable subset of inlier pixels includes the pixels whose disparities belong to the histogram part with the most numerous population (3rd part of Fig. 14a).

Afterwards, the reliable pixels and their disparities (red points in Fig. 15a) are used to fit a planar surface to the segment. The robust method of Principal Components Analysis (PCA) described in [43] is used to estimate the parameters of the plane. The two first principal components define the plane. Let the estimated plane be: dp(x)=
                              p
                              T
                              ⋅
                              x, where p
                              =[p1,p2]T. Then each x
                              ∈
                              S is assigned the disparity dp(x). The new disparity values inside the segment are depicted with blue in Fig. 15a.

A second example of uniform area handling is given considering the Cones stereo pair. In brief, Fig. 13c shows the overall outliers map. For the mean-shift segment of Fig. 13d (marked with blue color), the histogram of the disparities of the inlier pixels inside this segment is depicted in Fig. 14b. The reliable subset of inlier pixels includes the pixels whose disparities belong to the 1st histogram part of Fig. 14b. The reliable pixels and their disparities (red points in Fig. 15b) are used to fit a planar surface to the segment. The new disparity values inside the segment are depicted with blue in Fig. 15b.


                              Fig. 16
                               shows three examples of uniform region handling. In the first and second rows of Fig. 16, the disparity results before and after uniform region handling are visualized, respectively. The first and second columns include the result of handling the blue-colored segments of Fig. 13b and Fig. 13d, respectively. The third column shows an example for the Teddy stereo pair. The examples in the second and third columns show clearly the improvements in the disparity maps after applying the plane fitting process.

However, it is not always valid to assume that large areas with low texture are planar. Additionally, some large areas may have been wrongly segmented, leading to inaccurate plane fitting. Therefore, in this paper a specific metric is adopted, which is used to verify if the planar fitting is successful. This metric is the median of the absolute differences between the initial disparities of the reliable pixels and the disparities of the reliable pixels that are estimated after the plane fitting and is defined as: MED
                              
                                 fit
                               (measured in disparity units). In this paper, the condition MED
                              
                                 fit
                              
                              <0.5 has to be satisfied, in order to consider the planar fitting as successful.

In Fig. 17
                               an example is visualized. Uniform area handling is applied on the Midd1 stereo pair, which belongs to the extended stereo dataset, and contains large low-textured areas. In Fig. 17a the estimated disparity map without applying the uniform areas handling is depicted. It is obvious that disparity estimation is not reliable in low-textured areas. Fig. 17b shows the disparity map after applying uniform areas handling to all low-textured areas. Fig. 17c visualizes with green the low-textured areas with MED
                              
                                 fit
                              
                              <0.5 and with red the low-textured areas with MED
                              
                                 fit
                              
                              ≥0.5. In Fig. 17d the disparity map after applying uniform areas handling only for the green low-textured areas is depicted. The disparity error for the case of all regions and Δd
                              >1 for the Midd1 stereo pair is 40.65%, 14.88% and 9.69% for the disparity maps of Fig. 17a, Fig. 17b and Fig. 17d, respectively. Therefore, this example verifies the efficiency of the uniform areas handling to decrease the disparity estimation error.

A median filter using a 5×5 neighborhood is applied to the disparity result that is generated after executing all the steps of our approach, in order to remove spurious disparities before acquiring the final disparity map.

A non-optimized C++ implementation of the algorithm is used to report on the required computational time. The algorithm was executed on a desktop PC with Core i7-3770 3.40GHZ CPU and 8GB RAM. The total processing time, using as input the four stereo pairs of the Middlebury evaluation benchmark [26], is indicated in Table 1
                        . The measured time is the average of 5 separate runs. Additionally, this table provides the percentage of the total time that is spent for each of algorithm's stages, which include: 1. the matching cost computation stage (M.C.) (Section 2.2), 2. the cost aggregation stage (C.A.) (Section 2.3), 3. the disparity optimization stage (D.O) (Section 2.4) and 4. the disparity refinement stage (D.R.) (Section 2.5). The cost aggregation is the most computational expensive stage (on average 91.84 % of the total processing time). Nevertheless, this stage can be parallelized since cost aggregation can be performed independently for non-overlapping parts of the image.

Concluding, most parts of the algorithm have low computational cost. The step of the algorithm with increased computational cost includes the adaptive support weight cost aggregation. However, this time consuming part can be implemented in Graphics Processing Units (GPUs) as can be verified in [47]. Additionally, there are works, such as [48,49] that propose approximations to derive fast implementations of the original adaptive support weight algorithm [12]. The drawback of these methods is that they sacrifice quality for high computational speed [47].

@&#EXPERIMENTAL RESULTS@&#

In this section the experimental results on multiple datasets are presented. In more detail, the four stereo pairs of the Middlebury online stereo evaluation benchmark [26], except for the evaluation of this method, are used to select a set of optimum parameters and to evaluate the disparity refinement process. Furthermore, this section presents experimental results on 27 additional Middlebury stereo pairs in order to verify the efficiency of the proposed approach.

The parameters used for the experiments are the same for all tested stereo pairs. More specifically, β (defined in Section 2.2.1) is set equal to β
                        =0.3, while the parameters used for the cost functions (see Section 2.2.3) are λ
                        RGB
                        =30, λ
                        CEN
                        =45 and λ
                        SIFT
                        =45. The radius of the support area (see Section 2.3.1) is set equal to R
                        S
                        =19 and the adaptive weight parameters are γ
                        c
                        =8 and γ
                        
                           e
                        
                        =
                        R
                        
                           S
                        . Those values are selected based on experiments that were performed on the Middlebury Online Stereo Evaluation Benchmark.

In the column “Best” of Table 2
                        , the numeric results from the Middlebury Stereo evaluation for the disparity maps extracted using these optimum parameters, are given. The results include the overall performance measure (“Avg. Rank”), the error in non-occluded regions (“Nonocc”), the error in all regions (“All”) and the error near depth discontinuities (“Disc”). In Section 3.2.4 further parameters testing is performed.

The disparity results of the proposed method, for the optimum parameters set, accompanied with the disparity error maps as extracted by the Middlebury evaluation system are visualized in Fig. 18
                           . Errors in non-occluded and occluded regions are marked in black and gray respectively.

The ranking results in Table 3
                            (reference period: November 2014), for error threshold equal to 1, indicate that the proposed method is 3rd out of 161 methods that are included in the Middlebury Stereo Evaluation. However, no information on the 1st [44] and 2nd [45] ranked methods is available, since they are currently under review. Therefore, the proposed method ranks 1st among already published methods. More specifically, the proposed method ranks: 9th for the “Tsukuba” image pair, 3rd for the Venus image pair, 32nd for the Teddy image pair and 5th for the “Cones” image pair.

The 32nd position in the ranking for the Teddy image pair is because of the very slanted surface at the bottom of the image, where the proposed method cannot handle well the very slanted surface. However, it can be deduced from the experimental results that the proposed method outperforms the rest of the published stereo methods, which are evaluated online in the Middlebury stereo evaluation benchmark, in image areas excluding very slanted surfaces.

The improvement in the accuracy of the initial disparity map, which is achieved by using the two-phase combination strategy of Section 2.3.2, is evaluated according to the Middlebury online evaluation system. Table 4
                            depicts the average percent of bad pixels for the disparity maps generated using the four Middlebury image pairs. In specific, this table includes results for non-occluded regions (“Nonocc”), all regions (“All”) and regions near depth discontinuities (“Disc”).

The evaluation results for the disparity map resulting via WTA from V
                           R−C are given in the “Init.” column. The evaluation results for the disparity map resulting via WTA from V
                           R−C′ (which is acquired after applying first combination phase) are given in the “Phase1” column. The average numeric results for the disparity map d
                           LR resulting via WTA from V
                           R−C
                           ″ (which is acquired after applying second combination phase) are given in the “Phase2” column. Obviously, each combination phase assists in improving the accuracy of the generated disparity map.

Additionally, Table 4 includes in the “CENSUS” column the evaluation results for the disparity map resulting via WTA from V
                           CEN and in the “SIFT” column the evaluation results for the disparity map resulting via WTA from V
                           SIFT. Though, the results in “CENSUS” and “SIFT” are worse that the results in “Init.” the efficient exploitation of V
                           CEN and V
                           SIFT in the two-phase combination strategy improves the disparity estimation accuracy.

Furthermore, the Middlebury online benchmark is exploited in order to examine the improvement introduced by the proposed disparity refinement steps. Fig. 19
                            depicts how the average percent of bad pixels decreases after applying sequentially each of the disparity refinement steps, which include occlusion handling, disparity edges refinement and uniform regions handling. Fig. 19 includes results for non-occluded regions (see Fig. 19a), all regions (see Fig. 19b) and regions near depth discontinuities (see Fig. 19c). As it is expected, the occlusion handling decreases the bad pixels percent more than the rest refinement steps, since it handles large outlier areas. Disparity edges refinement and uniform regions handling improve further the accuracy, so that the proposed framework becomes the top ranked published method in the Middlebury stereo evaluation.

As mentioned in Section 3.1, the column “Best” of Table 2 gives the numeric disparity estimation results using optimum parameters. In the rest columns of Table 2, we provide the results in the case that all parameters are kept the same as the optimum ones, except for the parameter in the top of the column. For each parameter a smaller and a larger value than the optimum one are tested. Table 2 verifies that the optimum parameters give the best results.

The last column of Table 2, with the annotation “No criterion”, gives the results of this method for the best set of parameters, with the difference that in this case the new criterion for the definition of the smoothness terms in Eq. (21) is not used. The results prove that without the exploitation of the new criterion the disparity accuracy decreases.

The segmentation maps are exploited in different stages of this method. Therefore, it is important to verify that small variations to the optimum parameters (h
                           
                              s
                           ,
                           h
                           
                              r
                           )=(3,3) that adjust the segmentation result (see Section 2.1.2) do not affect significantly the performance of this method. Table 5
                            exhibits the error results for different values of the spatial radius and space feature radius. The rest of parameters are set to their optimum value.

For all parameter tests, the proposed method ranks in the top five ranking positions though the disparity accuracy decreases. This fact proves that this approach maintains its good disparity estimation accuracy even with changes to the optimum parameters.

Many of methods are evaluated on just the four stereo pairs from the Middlebury online stereo database, which are mentioned in Section 3.2. However, evaluation on limited data is not sufficient to give a clear picture of the overall performance of an algorithm, since the average error rates of the best performing techniques are close to each other. For this reason, except for the four stereo pairs from the Middlebury online stereo evaluation benchmark, evaluation is performed on two additional Middlebury datasets in order to assess more rigorously the performance of the proposed methodology. The 2005 and 2006 datasets, presented in [50], include 27 stereo pairs with their ground truth. The error percentage is measured for both non-occluded and all regions.


                        Table 6
                         shows the results for the percentage of erroneous pixels having 1 or 2 disparity level difference with respect to ground truth. The results regarding the rest of methods in Table 6 are copied from the very recent work of [8]. The column “All” refers to case where all pixels on the disparity map are considered to estimate the percentage of erroneous pixels, while the term “Visible” refers to the case where only the pixels on the disparity map that correspond to unoccluded regions are considered to estimate the percentage of erroneous pixels. In general, the proposed work gives better results for the case of “All” regions than the rest of the methods that are evaluated in [8]. More specifically, for the case of “All” regions and Δd
                        >1, Δd
                        >2 the disparity errors of our approach are 2.02% and 2.7% less than the second best method, respectively. The low error for Δd
                        >2 indicates that the estimated disparity for some pixels is very close to their ground truth disparity and differs just 2 disparity levels.

The disparity maps for the 27 stereo pairs, with their respective disparity error maps for Δd
                        >1, can be found in slides 4–17 of the supplementary material that accompanies this paper.

@&#CONCLUSIONS@&#

In this paper a method that produces very accurate disparity results for stereo image pairs is presented. In order to achieve increased accuracy, the proposed method uses efficiently three cost metrics to acquire a reliable combined cost volume. The optimization of the cost volume is performed using a semi-global matching method, where a new criterion is introduced for the definition of the smoothness penalty terms that improves the disparity results. Outliers handling is performed combining a simple scheme and mean-shift segmentation base occlusion handling. Another innovative aspect of this paper is the way disparities are filtered based on histogram analysis in order to be used in uniform regions handling. The remarkable performance of the proposed method is verified experimentally using the Middlebury evaluation benchmark and an extended stereo dataset. The ideas introduced in this paper could be used or extended by future stereo algorithms in order to boost their accuracy performance.

Future work will focus on improving the disparity estimation for very slanted surfaces. Probably, the employment of a different cost aggregation approach is needed to achieve this objective.

@&#ACKNOWLEDGMENT@&#

This work was supported by the EU funded IP project REVERIE under contract 287723.


                     
                        
                           
                              Results for the extended stereo dataset.
                           
                           
                        
                     
                  

Supplementary data to this article can be found online at http://dx.doi.org/10.1016/j.imavis.2014.12.001.

@&#REFERENCES@&#

