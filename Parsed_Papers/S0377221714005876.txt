@&#MAIN-TITLE@&#Analysis of seat allocation and overbooking decisions with hybrid information

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           We propose a robust revenue management model with hybrid information.


                        
                        
                           
                           We show that nested policies are optimal among all deterministic policies in our model.


                        
                        
                           
                           We apply model-based methods to solve the problem numerically.


                        
                        
                           
                           We conduct numerical experiments to show the benefits of our method.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Revenue management

Competitive analysis

Regret

Cross entropy method

@&#ABSTRACT@&#


               
               
                  We investigate a single-leg airline revenue management problem where an airline has limited demand information and uncensored no-show information. To use such hybrid information for simultaneous overbooking and booking control decisions, we combine expected overbooking cost with revenue. Then we take a robust optimization approach with a regret-based criterion. While the criterion is defined on a myriad of possible demand scenarios, we show that only a small number of them are necessary to compute the objective. We also prove that nested booking control policies are optimal among all deterministic ones. We further develop an effective computational method to find the optimal policy and compare our policy to others proposed in the literature.
               
            

@&#INTRODUCTION@&#

Revenue management (RM), with its initial applications in the airline and hospitality industries, shows how scientific methods can be successfully used to improve decision making. Airlines and hotels sell their (perishable) seat and room inventories, respectively, well in advance of the actual service time while changing the prices of their inventory (or changing the availability to different customer segments/groups). There is a significant body of research in RM that proposes tactics, models, and methods to control these advance bookings in order to maximize revenues. The oldest tactic is overbooking. American Airlines reported in 1990 that the benefit of overbooking to the airline exceeded $225 million (Smith, Leimkuhler, Darrow, & Samuels, 1992). US Airways reported in 2006 that the company would have lost $1 billion of its $11.56 billion revenue if the airline had not overbooked its flights (Bailey, 2007). In the US, more than 595 million passengers were boarded by major airlines and close to 1.5 million were denied boarding voluntarily or involuntarily in 2010 (BTS, 2010). Note that all the no-show and boarding information is recorded by airlines. Airlines use such information to develop statistical methods to predict the no-show rates.

Another critical problem in RM is capacity control, also referred to as fare-class allocation or seat inventory control. We refer the reader to Talluri and Ryzin (2004) and Phillips (2005) for more information on the research models and methods developed in this area. Classical models of seat inventory control rely on several assumptions about demand such as independence and stationarity, and assume knowledge of probability distributions. However, demand forecasting has always been a big challenge, even if there is plenty of historic data. When there is little data, accurate forecast is virtually impossible and one has to rely on expert opinions. Even in industries such as airline and hospitality, where RM has been actively used for decades, inaccuracy in demand forecasting is a persistent problem in spite of readily available data. The need for developing accurate forecasting systems in successful RM implementations, and challenges associated with lack of data or naive forecasts are emphasized by Lahoti (2002) and Lennon (2004). There are many complicating factors that cause inaccurate forecasting, such as non-stationarity of demand over time, unrealistic assumptions on independence, and model selection. An important common reason is that the demand data is censored due to booking and capacity limits. Despite the development of quite a few techniques to uncensor the demand data, forecasting remains a challenge (Queenan, Ferguson, Higbie, & Kapoor, 2007; McGill & Ryzin, 1999; Weatherford & Pölt, 2002). We resort to robust optimization and formulate a model that does not need a probabilistic model on demand. By providing such a model we forgo the underlying probabilistic demand and risk neutrality assumptions of the traditional models, and substantially lower the requirements on demand forecasting, with little sacrifice on revenue performance.

In this paper, we consider the classical single resource problem in RM and provide methods to determine overbooking levels and capacity controls. This paper makes research contributions on modeling, analysis, and computational methods: First, we develop a new practical approach to the combined fare-class allocation and overbooking problem. Our approach is oriented to the case where demand forecasting is challenging and unreliable but accurate probabilistic information is available regarding no-shows. We introduce a hybrid model for optimization under uncertainties to integrate both information. Our model uses a regret criterion for the revenue performance net of the expected overbooking cost associated with no-shows. Second, we investigate structural properties of the hybrid model: We prove that nested booking control policies that are widely used in the RM practice and well studied in the literature, are optimal among all deterministic policies for our hybrid model. Finally, the structural properties of the problem in turn enable us to develop a practical model-based computational procedure to compute the optimal policy for our model, which contributes to the body of knowledge on model-based methods. While earlier work (see Ball & Queyranne, 2006; Lan, Gao, Ball, & Karaesmen, 2008, 2011) produced closed-form solutions for booking control policies, the more complex problem we analyze here leads to a challenging nonlinear stochastic optimization problem. Plainly evaluating the objective function is computationally intensive, as it involves worst-case analysis with a measure of regret that needs to consider a myriad of scenarios in its calculation. Based on the structural properties, we are able to reduce the number of necessary scenarios and develop an effective model-based method to solve the nonlinear optimization problem.

The focus of a model-based method is on models of probability distribution as likelihood of optimality over the entire solution space. Rather than working from one candidate solution to another, model-based methods look for better models in an iterative procedure. The cross-entropy (CE) method (Rubinstein, 1999) is among the earliest varieties of model-based methods. It starts with an initial distribution model, and a systematic approach is employed to improve the model iteratively. At each iteration, a number of sample solutions are first drawn randomly from the current distribution model. Then a small fraction of the random samples with the best objective values are selected to be in the so-called “elite set”. Next the model is improved in such a way so as to increase the likelihood of producing the solutions in the elite set. This whole process can start over again from this newly obtained model for further improvement. Iteration by iteration, the procedure keeps improving the model until a stopping criterion is met. In the ideal case, the series of improved models eventually converge to a degenerate one with all the probability mass collapsing into the optimal solution.

We provide extensive computational experiments to demonstrate the effectiveness of our hybrid model as a stand-alone approach. We also point out that our approach produces overbooking levels that can be used as an input to any existing seat inventory control optimization model that assumes no cancellations. This is of practical importance: In practice, a virtual capacity (also known as pseudo capacity) – physical capacity plus an overbooking pad based on the no-show rate, cost of overbooking and/or service measures – is determined separately, and then used as an input to seat inventory control optimization. Phillips (2005) mentions that this approach has practical advantages in terms of being able to mix-and-match different methods of overbooking and seat inventory control optimization. In addition to other applications of RM, our hybrid approach can potentially be applied to a range of decision problems where there are varying degrees of information accuracy or uncertainty regarding problem parameters (e.g. inventory planning for production systems with random yield where both production quantities and demand are subject to uncertainty).

The rest of the paper is organized as follows. We provide a literature review in Section 2. Section 3 introduces the problem and describes our approach. Optimality of nested policies is discussed in Section 4. In Section 5, we develop a numerical optimization procedure to find the optimal policies in our models and compare our new revenue management policies with existing approaches. We conclude in Section 6.

@&#LITERATURE REVIEW@&#

Earlier research in RM studies overbooking (e.g. Beckmann, 1958; Thompson, 1961) and booking control decisions (e.g. Littlewood, 1972) independently. We refer the reader to Talluri and Ryzin (2004) and the references therein. The focus of our study is on joint optimization of overbooking levels and booking control policies. We provide a brief review of the research here: Shlifer and Vardi (1975) provide the earliest study of overbooking decisions with more than one type of passengers. Coughlan (1999) studies a multi-fare, single-resource model where the fare-class demand assumes a Normal distribution. Dynamic models for decision making are formulated and analyzed by Chatwin (1992, 1999), Rothstein (1971), Subramanian, Stidham, and Lautenbacher (1999), Alstrup, Boas, Madsen, and Vidal (1986), Topaloglu, Birbil, Frenk, and Noyan (2012), Aydin, Birbil, Frenk, and Noyan (2013), assuming a single resource (single leg). Karaesmen and Ryzin (2004) develop an overbooking model with multiple resources that are substitutable. Methods for solving the network revenue management problem with no-shows and/or cancellations are proposed by Kunnumkal, Talluri, and Topaloglu (2012), Kunnumkal and Topaloglu (2011), Erdelyi and Topaloglu (2010).

A common assumption in those research papers is the availability of information on probability distributions or stochastic processes that characterize demand or cancellations/no-shows and the objective is to maximize expected revenues or profits (i.e. the decision maker is assumed to be risk neutral). Recent research in the OR/MS community focuses on robust decision making, with alternative uncertainty models and performance criteria. For instance, Lim, Shanthikumar, and Vahn (2012) use regret as the criterion and Wagner (2010) uses a worst-case approach. We refer the reader to Lim, Shanthikumar, and Max Shen (2006) and the references therein for an introduction to robust optimization. New models have been proposed for the airline RM problem. These models include the regret criterion, robust optimization, risk-aversion, distribution-free approaches or assume no information is available; see Perakis and Roels (2010), Lan et al. (2008), Ball and Queyranne (2006), Ryzin and McGill (2000), Kunnumkal and Topaloglu (2009), Birbil, Frenk, Gromicho, and Zhang (2009), Gao, Ball, and Karaesmen (2010), Barz and Waldmann (2007), Xiong, Xie, and Deng (2011), Feng and Xiao (2008), Gönsch and Hassler (2013), Zhuang and Li (2011).

In this paper, we study joint overbooking and fare-class allocation decisions, assuming limited information on demand and full information on no-show. We use a regret-based criterion which benchmarks the performance of a seller’s policy to that of an ex-post policy that assumes perfect hindsight information. The performance metric is the “expected net revenue” where the revenue is net of expected overbooking penalty. In other words, we utilize a hybrid performance measure. The demand is unknown to the seller at the time of his decision whereas the ex-post policy has hindsight information about demand. Both the seller and the ex-post policy know the probability distribution of no-shows when decisions are made. This approach extends the research of Ball and Queyranne (2006), Lan et al. (2008, 2011), Gao et al. (2010). Different from Lan et al. (2011), which assumes limited/no information regarding both fare-class demand and no-show rate, we assume distributional knowledge of the no shows in this paper. This extends existing research (i) by combining different forms of information and uncertainty to make decisions in revenue management and (ii) by developing a model-based procedure to solve the decision problem. We adapt model-based methods to numerically find the optimal solution to our hybrid model that leads to a nonlinear optimization problem. Model-based methods are shown to exhibit superior performance than other traditional methods for many difficult global optimization problems (see Hu, Fu, & Marcus, 2007; Rubinstein, 1999; Zlochin, Birattari, Meuleau, & Dorigo, 2004). The cross-entropy (CE) method (see Rubinstein, 1999; Rubinstein & Kroese, 2004) is one of the most well-known among them. Section 5 shows how it is used to solve our nonlinear optimization problem.

We have C items available – e.g. seats on an airplane – that are sold at m different fares (prices). Let 
                        
                           
                              
                                 f
                              
                              
                                 i
                              
                           
                        
                      denote the fare for class i. Classes 
                        
                           i
                           =
                           1
                           ,
                           …
                           ,
                           m
                        
                      are indexed with a preference order; details are provided below. Each customer is interested in booking a particular fare class. The seller’s decision is whether to accept or to reject a fare request as booking requests arrive. It involves two distinct aspects: booking control and overbooking. Booking control determines what the seller does to control the sales of its seat inventory, while overbooking is about how many seats to sell above C as customers are known to no-show or cancel their bookings.

We need to consider two types of uncertainty: one for the arrival of booking requests (the demand) and another for the number of no-shows. We assume the airline has accurate probabilistic information about no-shows, as such data is uncensored. On the other hand, limited knowledge of fare-class demand is assumed as estimation of demand distribution is unreliable at disaggregate level (McGill & Ryzin, 1999). Specifically, we assume this limited knowledge comes in the form of the minimum and maximum numbers of booking requests that will arrive in each fare class. We refer the reader to Perakis and Roels (2010) for guidelines on how to set those bounds.

Such limited knowledge only depicts the set of possible demand realizations (also known as the uncertainty set) without any probabilistic information. As neither distribution nor arrival order of the booking requests is known, one may wonder how decisions can be made. One possibility is to use the maximin criterion, but such decisions are known to be quite conservative. The minimax regret criterion introduced by Savage (1951) leads to decisions equidistant from all extreme scenarios (in terms of revenue differences) and is likely to perform well in average revenue. The analysis of a booking policy under this criterion is similar to the competitive analysis of online algorithms (see Albers, 2003), typically used in computer science and scheduling research. We view the seller as making irrevocable decisions to accept/reject the booking requests “on the spot” as a fare request arrives. Thus, the performance of the seller’s booking control policy is “online” performance. By contrast, an ex-post decision is made after all requests have arrived and therefore achieves better performance since more information is available for the decision making. The regret of an online policy is the revenue difference from the optimal ex-post policy.

We consider the single-leg problem in two phases, a “booking phase” and a “service phase.” During the booking phase, requests arrive and are accepted/rejected. This is followed by the “service phase” where some of the accepted requests show up for the flight and some others cancel/no-show. The booking phase is “controlled” by the decisions made. The service phase, on the other hand, is beyond control and the final result is subject to the no-show randomness. This is true for both online and ex-post policies, and the ‘expected net revenue’ (booking revenue net of expected overbooking penalty) is the metric of interest.

We denote by I the input sequence (or input stream); these are the scenarios of booking requests observed by both online and ex-post policies. An input carries information on the number and the arrival sequence of booking requests. We let the vector 
                        
                           q
                           (
                           I
                           )
                        
                      be the profile of an input I, and 
                        
                           
                              
                                 q
                              
                              
                                 i
                              
                           
                           (
                           I
                           )
                        
                      be the 
                        
                           i
                        
                     th component of 
                        
                           q
                           (
                           I
                           )
                        
                     , denoting the number of requests in fare-class i. In our problem, each input stream I satisfies 
                        
                           L
                           ⩽
                           q
                           (
                           I
                           )
                           ⩽
                           U
                        
                     , where 
                        
                           L
                           =
                           (
                           
                              
                                 L
                              
                              
                                 1
                              
                           
                           ,
                           …
                           ,
                           
                              
                                 L
                              
                              
                                 m
                              
                           
                           )
                        
                      and 
                        
                           U
                           =
                           (
                           
                              
                                 U
                              
                              
                                 1
                              
                           
                           ,
                           …
                           ,
                           
                              
                                 U
                              
                              
                                 m
                              
                           
                           )
                        
                      are vectors for the lower and upper bounds of demand for the fare-classes, respectively.

Nested booking limits are commonly analyzed in the RM research and are shown to be optimal under certain conditions (see Talluri & Ryzin, 2004). We initially assume such a policy, whose optimality will be proven later. A policy of this type is determined by specifying a vector of booking limits 
                        
                           
                              
                                 b
                              
                              
                                 i
                              
                           
                        
                     , with 
                        
                           
                              
                                 b
                              
                              
                                 1
                              
                           
                           ⩾
                           
                              
                                 b
                              
                              
                                 2
                              
                           
                           ⩾
                           ⋯
                           ⩾
                           
                              
                                 b
                              
                              
                                 m
                              
                           
                           ⩾
                           0
                        
                     . Under the standard implementation of a nested policy, the booking limit 
                        
                           
                              
                                 b
                              
                              
                                 i
                              
                           
                        
                      is the maximum number of booking requests to be accepted from classes i to m. Similar to Lan et al. (2008) and Lan et al. (2011), we use an additional variable called bucket size, denoted by 
                        
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                        
                      where 
                        
                           
                              
                                 x
                              
                              
                                 m
                              
                           
                           =
                           
                              
                                 b
                              
                              
                                 m
                              
                           
                        
                      and 
                        
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           =
                           
                              
                                 b
                              
                              
                                 i
                              
                           
                           -
                           
                              
                                 b
                              
                              
                                 i
                                 +
                                 1
                              
                           
                        
                      for 
                        
                           i
                           =
                           1
                           ,
                           …
                           ,
                           m
                           -
                           1
                        
                     . The notations 
                        
                           b
                           =
                           (
                           
                              
                                 b
                              
                              
                                 1
                              
                           
                           ,
                           …
                           ,
                           
                              
                                 b
                              
                              
                                 m
                              
                           
                           )
                        
                      and 
                        
                           x
                           =
                           (
                           
                              
                                 x
                              
                              
                                 1
                              
                           
                           ,
                           …
                           ,
                           
                              
                                 x
                              
                              
                                 m
                              
                           
                           )
                        
                      refer to the vectors of the corresponding variables. We assume 
                        
                           0
                           ⩽
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           ⩽
                           
                              
                                 U
                              
                              
                                 i
                              
                           
                        
                      for all 
                        
                           i
                           =
                           1
                           ,
                           …
                           ,
                           m
                        
                      to exclude trivially suboptimal policies from our analysis; there is no reason to allocate more seats to a fare class than its maximal demand.

Let 
                        
                           R
                           (
                           I
                           ,
                           x
                           )
                        
                      be the seller’s (online) expected net revenue when policy x is used to control input I. Let 
                        
                           
                              
                                 R
                              
                              
                                 ∗
                              
                           
                           (
                           I
                           )
                        
                      be the ex-post optimal expected net revenue; the ex-post policy determines how many booking requests of each class to accept after observing all requests in I. Let 
                        
                           Ω
                           (
                           L
                           ,
                           U
                           )
                        
                      be the set of all input I, the profile of which satisfies 
                        
                           L
                           ⩽
                           q
                           (
                           I
                           )
                           ⩽
                           U
                        
                     . The objective of the seller is to choose a policy x to keep the expected net revenue as close as possible to that of the ex-post policy for all input sequence 
                        
                           I
                           ∈
                           Ω
                           (
                           L
                           ,
                           U
                           )
                        
                     . Accordingly, the seller maximizes the competitive ratio (CR):
                        
                           (1)
                           
                              
                                 
                                    
                                       max
                                    
                                    
                                       x
                                       ⩾
                                       0
                                    
                                 
                              
                              
                              CR
                              (
                              x
                              )
                              ,
                              
                              s
                              .
                              t
                              .
                              
                              CR
                              (
                              x
                              )
                              =
                              
                                 
                                    
                                       min
                                    
                                    
                                       I
                                       ∈
                                       Ω
                                       (
                                       L
                                       ,
                                       U
                                       )
                                    
                                 
                              
                              
                                 
                                    Q
                                    +
                                    R
                                    (
                                    I
                                    ;
                                    x
                                    )
                                 
                                 
                                    Q
                                    +
                                    
                                       
                                          R
                                       
                                       
                                          ∗
                                       
                                    
                                    (
                                    I
                                    )
                                 
                              
                              .
                           
                        
                     The competitive ratio 
                        
                           CR
                           (
                           x
                           )
                        
                      is a worst-case measure of the online revenue relative to the ex-post optimal revenue. The constant Q represents the wealth endowment of the seller, which serves as a parameter for the risk attitude. If we take the logarithm of the 
                        
                           CR
                           (
                           x
                           )
                        
                      function in (1) and think of the log of the sum of Q and the revenue as the seller’s utility, then we optimize the worst-case regret in utility. Intuitively, by this log-utility interpretation, if endowed with a larger Q, the seller is less risk-averse. When Q is large enough, the problem degenerates into minimizing the maximum absolute regret (MAR):
                        
                           (2)
                           
                              
                                 
                                    
                                       min
                                    
                                    
                                       x
                                       ⩾
                                       0
                                    
                                 
                              
                              
                              MAR
                              (
                              x
                              )
                              ,
                              
                              s
                              .
                              t
                              .
                              
                              MAR
                              (
                              x
                              )
                              =
                              
                                 
                                    
                                       max
                                    
                                    
                                       I
                                       ∈
                                       Ω
                                       (
                                       L
                                       ,
                                       U
                                       )
                                    
                                 
                              
                              
                                 
                                    R
                                 
                                 
                                    ∗
                                 
                              
                              (
                              I
                              )
                              -
                              R
                              (
                              I
                              ;
                              x
                              )
                              .
                           
                        
                     Note that MAR is a special case of CR and all results for CR also apply to MAR, and we do have some special results for MAR only.

We introduce additional notation to analyze the online policy performance 
                        
                           R
                           (
                           I
                           ;
                           x
                           )
                        
                     . When a policy x is applied to an input stream I, the number of accepted requests in each class is recorded by the elements of a vector 
                        
                           w
                           (
                           I
                           ;
                           x
                           )
                        
                     . We refer to the vector as the booking position. As a shorthand, we drop the input and policy 
                        
                           (
                           I
                           ;
                           x
                           )
                        
                      whenever the context is clear. In that case, simply let 
                        
                           w
                           =
                           (
                           
                              
                                 w
                              
                              
                                 1
                              
                           
                           ,
                           …
                           ,
                           
                              
                                 w
                              
                              
                                 m
                              
                           
                           )
                        
                      be the vector where 
                        
                           
                              
                                 w
                              
                              
                                 i
                              
                           
                        
                      is the number of accepted requests in class i. A nested policy x always keeps the booking position w within the booking limits, that is: 
                        
                           
                              
                                 b
                              
                              
                                 j
                              
                           
                           =
                           
                              
                                 ∑
                              
                              
                                 i
                                 =
                                 j
                              
                              
                                 m
                              
                           
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           ⩾
                           
                              
                                 ∑
                              
                              
                                 i
                                 =
                                 j
                              
                              
                                 m
                              
                           
                           
                              
                                 w
                              
                              
                                 i
                              
                           
                           ,
                           j
                           =
                           1
                           ,
                           …
                           ,
                           m
                        
                     . Given the booking position w, another request in class c is accepted if 
                        
                           
                              
                                 b
                              
                              
                                 j
                              
                           
                           >
                           
                              
                                 ∑
                              
                              
                                 i
                                 =
                                 j
                              
                              
                                 m
                              
                           
                           
                              
                                 w
                              
                              
                                 i
                              
                           
                           ,
                           j
                           =
                           1
                           ,
                           …
                           ,
                           c
                        
                     .

Next we describe no-shows/cancellations and the costs associated with boarding denials. Let 
                        
                           Z
                           (
                           w
                           )
                           =
                           (
                           
                              
                                 Z
                              
                              
                                 1
                              
                           
                           (
                           w
                           )
                           ,
                           …
                           ,
                           
                              
                                 Z
                              
                              
                                 m
                              
                           
                           (
                           w
                           )
                           )
                        
                      be a random vector that denotes the number of show-ups in each fare class given the booking position w, i.e. 
                        
                           
                              
                                 w
                              
                              
                                 i
                              
                           
                           -
                           
                              
                                 Z
                              
                              
                                 i
                              
                           
                           (
                           w
                           )
                        
                      is the number of no-shows/cancelations in class i. The probability distribution of 
                        
                           
                              
                                 Z
                              
                              
                                 i
                              
                           
                           (
                           w
                           )
                        
                      is assumed to be known. Naturally, the distribution has a support 
                        
                           0
                           ⩽
                           
                              
                                 Z
                              
                              
                                 i
                              
                           
                           (
                           w
                           )
                           ⩽
                           
                              
                                 w
                              
                              
                                 i
                              
                           
                        
                      for all i. Let 
                        
                           
                              
                                 (
                                 ·
                                 )
                              
                              
                                 +
                              
                           
                           =
                           max
                           (
                           0
                           ,
                           ·
                           )
                        
                      and 
                        
                           ‖
                           Y
                           ‖
                        
                      is a short-hand notation for the sum of all elements in a vector: 
                        
                           ‖
                           Y
                           ‖
                           =
                           
                              
                                 ∑
                              
                              
                                 ∀
                                 i
                              
                           
                           
                              
                                 Y
                              
                              
                                 i
                              
                           
                        
                     . The number of passengers denied boarding is then simply 
                        
                           
                              
                                 (
                                 ‖
                                 Z
                                 (
                                 w
                                 )
                                 ‖
                                 -
                                 C
                                 )
                              
                              
                                 +
                              
                           
                        
                     . Let 
                        
                           V
                           (
                           n
                           )
                        
                      be the overbooking penalty as a function of the number of passengers denied boarding, denoted by n. As the marginal penalty for denied boarding is usually non-decreasing, we assume 
                        
                           V
                           (
                           ·
                           )
                        
                      to be a convex and non-decreasing function. Let 
                        
                           v
                           (
                           w
                           )
                        
                      denote the expected overbooking penalty associated with booking position 
                        
                           w
                           :
                           v
                           (
                           w
                           )
                           =
                           E
                           [
                           V
                           (
                           
                              
                                 (
                                 ‖
                                 Z
                                 (
                                 w
                                 )
                                 ‖
                                 -
                                 C
                                 )
                              
                              
                                 +
                              
                           
                           )
                           ]
                        
                     . Note that 
                        
                           V
                           (
                           0
                           )
                           =
                           0
                        
                     , thus 
                        
                           v
                           (
                           w
                           )
                           =
                           0
                        
                      if 
                        
                           ‖
                           w
                           ‖
                           ⩽
                           C
                        
                     . It is assumed that 
                        
                           v
                           (
                           w
                           )
                        
                      is component-wise convex and increasing:
                        
                           (3)
                           
                              0
                              ⩽
                              
                                 
                                    Δ
                                 
                                 
                                    i
                                 
                              
                              v
                              (
                              w
                              )
                              ⩽
                              
                                 
                                    Δ
                                 
                                 
                                    i
                                 
                              
                              v
                              (
                              w
                              +
                              
                                 
                                    e
                                 
                                 
                                    i
                                 
                              
                              )
                              ,
                              
                              1
                              ⩽
                              i
                              ⩽
                              m
                              ,
                           
                        
                     where 
                        
                           
                              
                                 Δ
                              
                              
                                 i
                              
                           
                           v
                           (
                           w
                           )
                           =
                           v
                           (
                           w
                           )
                           -
                           v
                           (
                           w
                           -
                           
                              
                                 e
                              
                              
                                 i
                              
                           
                           )
                        
                     , and 
                        
                           
                              
                                 e
                              
                              
                                 i
                              
                           
                        
                      refers to the unit vector with 
                        
                           i
                        
                     th element being 1. That assumption on 
                        
                           v
                           (
                           w
                           )
                        
                      is connected to the convexity of 
                        
                           V
                           (
                           ·
                           )
                        
                      and may be readily derived from the Binomial no-show model that is commonly used in modeling and estimating no-shows in airlines. We further assume that the expected number of show-ups satisfies 
                        
                           E
                           [
                           
                              
                                 Z
                              
                              
                                 i
                              
                           
                           (
                           w
                           )
                           ]
                           =
                           φ
                           
                              
                                 w
                              
                              
                                 i
                              
                           
                        
                      (where 
                        
                           φ
                           ∈
                           [
                           0
                           ,
                           1
                           ]
                        
                      is the common show-up rate for all fare classes). In the case of a Binomial no-show model, each booked request will independently show up with the same probability φ, and we have
                        
                           (4)
                           
                              
                                 
                                    Δ
                                 
                                 
                                    i
                                 
                              
                              v
                              (
                              w
                              )
                              =
                              
                                 
                                    Δ
                                 
                                 
                                    j
                                 
                              
                              v
                              (
                              w
                              )
                              ,
                              
                              ∀
                              i
                              ,
                              j
                              ∈
                              [
                              1
                              ,
                              m
                              ]
                              .
                           
                        
                     
                  

The net revenue 
                        
                           
                              
                                 R
                              
                              
                                 ̆
                              
                           
                           (
                           w
                           )
                        
                      collected from a booking position w for a realization of show-ups 
                        
                           Z
                           (
                           w
                           )
                        
                      is
                        
                           
                              
                                 
                                    R
                                 
                                 
                                    ̆
                                 
                              
                              (
                              w
                              )
                              =
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       =
                                       1
                                    
                                    
                                       m
                                    
                                 
                              
                              
                                 
                                    f
                                 
                                 
                                    i
                                 
                              
                              
                                 
                                    w
                                 
                                 
                                    i
                                 
                              
                              -
                              
                                 
                                    
                                       V
                                       (
                                       
                                          
                                             (
                                             ‖
                                             Z
                                             (
                                             w
                                             )
                                             ‖
                                             -
                                             C
                                             )
                                          
                                          
                                             +
                                          
                                       
                                       )
                                       +
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                i
                                                =
                                                1
                                             
                                             
                                                m
                                             
                                          
                                       
                                       
                                          
                                             β
                                          
                                          
                                             i
                                          
                                       
                                       
                                          
                                             f
                                          
                                          
                                             i
                                          
                                       
                                       (
                                       
                                          
                                             w
                                          
                                          
                                             i
                                          
                                       
                                       -
                                       
                                          
                                             Z
                                          
                                          
                                             i
                                          
                                       
                                       (
                                       w
                                       )
                                       )
                                    
                                 
                              
                              ,
                           
                        
                     where 
                        
                           
                              
                                 β
                              
                              
                                 i
                              
                           
                        
                      is the fraction of the fare refunded for class i in case of cancelations or no-shows. And let 
                        
                           R
                           (
                           w
                           )
                           =
                           E
                           [
                           
                              
                                 R
                              
                              
                                 ̆
                              
                           
                           (
                           w
                           )
                           ]
                        
                      be the expected net revenue, clearly we have 
                        
                           R
                           (
                           I
                           ;
                           x
                           )
                           =
                           R
                           (
                           w
                           (
                           I
                           ;
                           x
                           )
                           )
                        
                     . The expected net revenue 
                        
                           R
                           (
                           w
                           )
                        
                      then becomes
                        
                           (5)
                           
                              
                                 
                                    
                                       
                                          R
                                          (
                                          w
                                          )
                                          
                                       
                                    
                                    
                                       
                                          =
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   i
                                                   =
                                                   1
                                                
                                                
                                                   m
                                                
                                             
                                          
                                          
                                             
                                                f
                                             
                                             
                                                i
                                             
                                          
                                          
                                             
                                                w
                                             
                                             
                                                i
                                             
                                          
                                          -
                                          
                                             
                                                β
                                             
                                             
                                                i
                                             
                                          
                                          
                                             
                                                f
                                             
                                             
                                                i
                                             
                                          
                                          (
                                          
                                             
                                                w
                                             
                                             
                                                i
                                             
                                          
                                          -
                                          E
                                          [
                                          
                                             
                                                Z
                                             
                                             
                                                i
                                             
                                          
                                          (
                                          w
                                          )
                                          ]
                                          )
                                          -
                                          E
                                          [
                                          V
                                          (
                                          
                                             
                                                (
                                                ‖
                                                Z
                                                (
                                                w
                                                )
                                                ‖
                                                -
                                                C
                                                )
                                             
                                             
                                                +
                                             
                                          
                                          )
                                          ]
                                       
                                    
                                 
                                 
                                    
                                    
                                       
                                          =
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   i
                                                   =
                                                   1
                                                
                                                
                                                   m
                                                
                                             
                                          
                                          
                                             
                                                f
                                             
                                             
                                                i
                                             
                                          
                                          (
                                          1
                                          -
                                          
                                             
                                                β
                                             
                                             
                                                i
                                             
                                          
                                          (
                                          1
                                          -
                                          φ
                                          )
                                          )
                                          
                                             
                                                w
                                             
                                             
                                                i
                                             
                                          
                                          -
                                          v
                                          (
                                          w
                                          )
                                          ,
                                       
                                    
                                 
                                 
                                    
                                    
                                       
                                          =
                                          
                                             
                                                
                                                   ∑
                                                
                                                
                                                   i
                                                   =
                                                   1
                                                
                                                
                                                   m
                                                
                                             
                                          
                                          
                                             
                                                f
                                             
                                             
                                                i
                                             
                                             
                                                ′
                                             
                                          
                                          
                                             
                                                w
                                             
                                             
                                                i
                                             
                                          
                                          -
                                          v
                                          (
                                          w
                                          )
                                          ,
                                       
                                    
                                 
                              
                           
                        
                     where 
                        
                           
                              
                                 f
                              
                              
                                 i
                              
                              
                                 ′
                              
                           
                           =
                           
                              
                                 f
                              
                              
                                 i
                              
                           
                           (
                           1
                           -
                           
                              
                                 β
                              
                              
                                 i
                              
                           
                           (
                           1
                           -
                           φ
                           )
                           )
                        
                      for 
                        
                           i
                           =
                           1
                           ,
                           …
                           ,
                           m
                        
                     , is the net fare that considers the effect of no-shows. Note that the classical ordering for nested booking limits (Talluri & Ryzin, 2004) is according to the nominal fares, so 
                        
                           
                              
                                 f
                              
                              
                                 1
                              
                           
                           ⩾
                           
                              
                                 f
                              
                              
                                 2
                              
                           
                           ⩾
                           ⋯
                           ⩾
                           
                              
                                 f
                              
                              
                                 m
                              
                           
                        
                     . In our analysis, the ordering is according to the net fare, that is,
                        
                           (6)
                           
                              
                                 
                                    f
                                 
                                 
                                    1
                                 
                                 
                                    ′
                                 
                              
                              ⩾
                              
                                 
                                    f
                                 
                                 
                                    2
                                 
                                 
                                    ′
                                 
                              
                              ⩾
                              ⋯
                              ⩾
                              
                                 
                                    f
                                 
                                 
                                    m
                                 
                                 
                                    ′
                                 
                              
                              .
                           
                        
                     The ordering by the net fares may be different from the classical ordering, but they can agree with each other for certain values of parameters 
                        
                           
                              
                                 β
                              
                              
                                 i
                              
                           
                        
                     . For instance, it suffices to make 
                        
                           
                              
                                 β
                              
                              
                                 i
                              
                           
                        
                      non-decreasing in i (a flat β for all classes would be an example).

Define the expected net revenue contribution (ENRC) of the last accepted request in class i as 
                        
                           
                              
                                 Δ
                              
                              
                                 i
                              
                           
                           R
                           (
                           w
                           )
                           =
                           R
                           (
                           w
                           )
                           -
                           R
                           (
                           w
                           -
                           
                              
                                 e
                              
                              
                                 i
                              
                           
                           )
                        
                     . By (5) we have
                        
                           (7)
                           
                              
                                 
                                    Δ
                                 
                                 
                                    i
                                 
                              
                              R
                              (
                              w
                              )
                              =
                              
                                 
                                    f
                                 
                                 
                                    i
                                 
                                 
                                    ′
                                 
                              
                              -
                              
                                 
                                    Δ
                                 
                                 
                                    i
                                 
                              
                              v
                              (
                              w
                              )
                              .
                           
                        
                     Apply (7) to (3), and note the ordering by net fares in (6), we immediately have componentwise concavity for 
                        
                           R
                           (
                           w
                           )
                        
                     :
                        
                           (8)
                           
                              
                                 
                                    Δ
                                 
                                 
                                    i
                                 
                              
                              R
                              (
                              w
                              )
                              ⩾
                              
                                 
                                    Δ
                                 
                                 
                                    i
                                 
                              
                              R
                              (
                              w
                              +
                              
                                 
                                    e
                                 
                                 
                                    i
                                 
                              
                              )
                              ,
                              
                              1
                              ⩽
                              i
                              ⩽
                              m
                              .
                           
                        
                     By (4), (6), and (7), we recognize that 
                        
                           
                              
                                 Δ
                              
                              
                                 i
                              
                           
                           R
                           (
                           w
                           )
                           -
                           
                              
                                 Δ
                              
                              
                                 j
                              
                           
                           R
                           (
                           w
                           )
                           =
                           
                              
                                 f
                              
                              
                                 i
                              
                              
                                 ′
                              
                           
                           -
                           
                              
                                 f
                              
                              
                                 j
                              
                              
                                 ′
                              
                           
                        
                     , so
                        
                           (9)
                           
                              
                                 
                                    Δ
                                 
                                 
                                    i
                                 
                              
                              R
                              (
                              w
                              )
                              ⩾
                              
                                 
                                    Δ
                                 
                                 
                                    j
                                 
                              
                              R
                              (
                              w
                              )
                              ,
                              
                              1
                              ⩽
                              i
                              ⩽
                              j
                              ⩽
                              m
                              .
                           
                        
                     Note that (9) can be simplified to 
                        
                           R
                           (
                           w
                           -
                           
                              
                                 e
                              
                              
                                 i
                              
                           
                           )
                           ⩽
                           R
                           (
                           w
                           -
                           
                              
                                 e
                              
                              
                                 j
                              
                           
                           )
                           ,
                           i
                           ⩽
                           j
                        
                     . Let 
                        
                           w
                           =
                           
                              
                                 w
                              
                              
                                 ′
                              
                           
                           +
                           
                              
                                 e
                              
                              
                                 i
                              
                           
                        
                     , we have 
                        
                           R
                           (
                           
                              
                                 w
                              
                              
                                 ′
                              
                           
                           )
                           ⩽
                           R
                           (
                           
                              
                                 w
                              
                              
                                 ′
                              
                           
                           +
                           
                              
                                 e
                              
                              
                                 i
                              
                           
                           -
                           
                              
                                 e
                              
                              
                                 j
                              
                           
                           )
                        
                     , which means that substituting a class j with a class i request generates more revenue. In other words, the ordering of ENRC by fare classes in (9) means that fare class i is preferred to fare class j if 
                        
                           i
                           ⩽
                           j
                        
                     . Generally, for nested policies to work well, we need a consistent fare ordering as given by (9), whether we overbook or not.

Now we turn to the ex-post problem and the ex-post optimal policy. The ex-post problem is formulated as
                        
                           (10)
                           
                              
                                 
                                    R
                                 
                                 
                                    ∗
                                 
                              
                              (
                              I
                              )
                              =
                              
                                 
                                    
                                       max
                                    
                                    
                                       0
                                       ⩽
                                       w
                                       ⩽
                                       q
                                       (
                                       I
                                       )
                                    
                                 
                              
                              R
                              (
                              w
                              )
                              .
                           
                        
                     The ex-post optimal policy produces the optimal booking position 
                        
                           
                              
                                 w
                              
                              
                                 ∗
                              
                           
                           (
                           I
                           )
                        
                     , which is a function of input I, satisfying 
                        
                           
                              
                                 R
                              
                              
                                 ∗
                              
                           
                           (
                           I
                           )
                           =
                           R
                           (
                           
                              
                                 w
                              
                              
                                 ∗
                              
                           
                           (
                           I
                           )
                           )
                        
                     . Based on (8) and (9), problem (10) is solved as follows: accept the requests in I from the highest to the lowest fare class, as long as the ENRC is positive. We have 
                        
                           
                              
                                 R
                              
                              
                                 ∗
                              
                           
                           (
                           I
                           )
                           ⩾
                           0
                        
                      for any I because 
                        
                           w
                           =
                           (
                           0
                           ,
                           …
                           ,
                           0
                           )
                        
                      is always a feasible solution to (10).

In the CR problem (1), of which the MAR problem (2) is a special case, the total number of scenarios in 
                        
                           Ω
                           (
                           L
                           ,
                           U
                           )
                        
                      grows exponentially with m. That is a major challenge for both analysis and numerical computation. We show that only a small subset of selected scenarios is necessary, which dramatically reduces scenarios without affecting the optimal solution. This reduction enables us to not only compute the objective efficiently, but also prove the structure of the optimal policy. Therefore, we focus on two critical issues in our analysis: 1. The worst-case input scenarios involved in the problem. 2. The structure and analytical properties of the optimal policy.

From the seller’s point of view, a scenario 
                           
                              
                                 
                                    I
                                 
                                 
                                    ′
                                 
                              
                           
                         is worse than I with regard to a policy x, if
                           
                              (11)
                              
                                 
                                    
                                       Q
                                       +
                                       R
                                       (
                                       I
                                       ;
                                       x
                                       )
                                    
                                    
                                       Q
                                       +
                                       
                                          
                                             R
                                          
                                          
                                             ∗
                                          
                                       
                                       (
                                       I
                                       )
                                    
                                 
                                 ⩾
                                 
                                    
                                       Q
                                       +
                                       R
                                       (
                                       
                                          
                                             I
                                          
                                          
                                             ′
                                          
                                       
                                       ;
                                       x
                                       )
                                    
                                    
                                       Q
                                       +
                                       
                                          
                                             R
                                          
                                          
                                             ∗
                                          
                                       
                                       (
                                       
                                          
                                             I
                                          
                                          
                                             ′
                                          
                                       
                                       )
                                    
                                 
                                 .
                              
                           
                        Moreover, a set of scenarios 
                           
                              
                                 
                                    Ω
                                 
                                 
                                    ′
                                 
                              
                           
                         is worse than another set Ω, if for any 
                           
                              I
                              ∈
                              Ω
                           
                         and any policy x, there exists a 
                           
                              
                                 
                                    I
                                 
                                 
                                    ′
                                 
                              
                              ∈
                              
                                 
                                    Ω
                                 
                                 
                                    ′
                                 
                              
                           
                         that is worse than I with regard to x. Clearly, a set is worse than its subset, so if 
                           
                              
                                 
                                    Ω
                                 
                                 
                                    ′
                                 
                              
                              ⊂
                              Ω
                              (
                              L
                              ,
                              U
                              )
                           
                         is worse than 
                           
                              Ω
                              (
                              L
                              ,
                              U
                              )
                           
                        , then it can replace 
                           
                              Ω
                              (
                              L
                              ,
                              U
                              )
                           
                         in (1) to produce an equivalent problem as the objective function must be identical. In this case we say that 
                           
                              
                                 
                                    Ω
                                 
                                 
                                    ′
                                 
                              
                           
                         is a sufficient subset of 
                           
                              Ω
                              (
                              L
                              ,
                              U
                              )
                           
                        . As both the “worse than” and “subset of” relationships are transitive, the “sufficient” relationship as a combination of both is also transitive. That is, if another subset 
                           
                              Ω
                              ”
                              ⊂
                              
                                 
                                    Ω
                                 
                                 
                                    ′
                                 
                              
                           
                         is worse than 
                           
                              
                                 
                                    Ω
                                 
                                 
                                    ′
                                 
                              
                           
                        , then 
                           
                              Ω
                              ”
                           
                         is also a sufficient subset of 
                           
                              Ω
                              (
                              L
                              ,
                              U
                              )
                           
                        . Therefore once a scenario is excluded from a sufficient subset, it can be safely ignored.

In our analysis, input streams that are low before high (LBH) are very important. In a LBH input stream, booking requests for a lower fare arrives before those for a higher fare. It has been discovered in previous studies (Lan et al., 2008, 2011) that LBH input streams always produce the lowest online revenue, which remains valid in this study.
                           Proposition 1
                           
                              Among all input sequences with the same profile, the LBH sequence generates the lowest expected net revenue for a nested policy.
                           

Let 
                                 
                                    
                                       
                                          q
                                       
                                       
                                          ˇ
                                       
                                    
                                 
                               be the transformation that arranges the requests in profile q in the LBH order; so 
                                 
                                    
                                       
                                          q
                                       
                                       
                                          ˇ
                                       
                                    
                                    (
                                    I
                                    )
                                 
                               is a LBH input that has the same profile as I. In Lan et al. (2008) it is shown that when I is transformed to 
                                 
                                    
                                       
                                          q
                                       
                                       
                                          ˇ
                                       
                                    
                                    (
                                    I
                                    )
                                 
                              , a nested policy x ends up substituting some higher-fare requests in 
                                 
                                    w
                                    (
                                    I
                                    ;
                                    x
                                    )
                                 
                               with some lower-fare requests that were formerly rejected. That observation remains valid here, and by (9) we may conclude that 
                                 
                                    R
                                    (
                                    I
                                    ;
                                    x
                                    )
                                    ⩾
                                    R
                                    (
                                    
                                       
                                          q
                                       
                                       
                                          ˇ
                                       
                                    
                                    (
                                    I
                                    )
                                    ;
                                    x
                                    )
                                 
                              . □

Let 
                           
                              
                                 
                                    Ω
                                 
                                 
                                    ˇ
                                 
                              
                              =
                              {
                              
                                 
                                    q
                                 
                                 
                                    ˇ
                                 
                              
                              :
                              L
                              ⩽
                              q
                              ⩽
                              U
                              }
                           
                        , Proposition 1 tells that 
                           
                              
                                 
                                    Ω
                                 
                                 
                                    ˇ
                                 
                              
                           
                         is a sufficient subset, since ex-post revenues are not affected at all by rearranging the arrival order of requests. Note that any LBH input is totally determined by its profile, so we focus on the profiles from now on. Clearly, there are still too many scenarios in 
                           
                              
                                 
                                    Ω
                                 
                                 
                                    ˇ
                                 
                              
                           
                         and further reduction is necessary. We will define some special profiles and then show that only those profiles are necessary.

Recall that (9) establishes a consistent fare preference among all the classes. Therefore among all input profiles with the same number of k requests in total, there is a special one that has the least preferred fare requests in it, which is called the lean profile of order k. An exact definition is provided with the help of an artificial knapsack problem (12) below.
                           Definition 1
                           The lean profile of order k, denoted as 
                                 
                                    
                                       
                                          q
                                       
                                       
                                          k
                                       
                                    
                                 
                              , is the unique profile that solves
                                 
                                    (12)
                                    
                                       
                                          
                                             
                                                max
                                             
                                             
                                                L
                                                ⩽
                                                q
                                                ⩽
                                                U
                                             
                                          
                                       
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                i
                                                =
                                                1
                                             
                                             
                                                m
                                             
                                          
                                       
                                       
                                          
                                             iq
                                          
                                          
                                             i
                                          
                                       
                                       
                                       s
                                       .
                                       t
                                       .
                                       
                                       
                                          
                                             
                                                ∑
                                             
                                             
                                                i
                                                =
                                                1
                                             
                                             
                                                m
                                             
                                          
                                       
                                       
                                          
                                             q
                                          
                                          
                                             i
                                          
                                       
                                       =
                                       k
                                       .
                                    
                                 
                              
                           

Clearly, for problem (12) to have a feasible solution, k must satisfy 
                           
                              ‖
                              L
                              ‖
                              ⩽
                              k
                              ⩽
                              ‖
                              U
                              ‖
                           
                        . Thus there are exactly 
                           
                              ‖
                              U
                              ‖
                              -
                              ‖
                              L
                              ‖
                              +
                              1
                           
                         lean profiles in total. The lean profiles can also be defined recursively. With 
                           
                              
                                 
                                    q
                                 
                                 
                                    ‖
                                    L
                                    ‖
                                 
                              
                              =
                              L
                           
                        , we have 
                           
                              
                                 
                                    q
                                 
                                 
                                    k
                                 
                              
                              =
                              
                                 
                                    q
                                 
                                 
                                    k
                                    -
                                    1
                                 
                              
                              +
                              
                                 
                                    e
                                 
                                 
                                    η
                                    (
                                    k
                                    )
                                 
                              
                           
                         for 
                           
                              ‖
                              L
                              ‖
                              <
                              k
                              ⩽
                              ‖
                              U
                              ‖
                           
                        , where 
                           
                              η
                              (
                              k
                              )
                              =
                              max
                              {
                              j
                              :
                              
                                 
                                    q
                                 
                                 
                                    j
                                 
                                 
                                    k
                                    -
                                    1
                                 
                              
                              <
                              
                                 
                                    U
                                 
                                 
                                    j
                                 
                              
                              }
                           
                        . Note that 
                           
                              η
                              (
                              k
                              )
                           
                         is the class number for the lowest fare request that can be added to 
                           
                              
                                 
                                    q
                                 
                                 
                                    k
                                    -
                                    1
                                 
                              
                           
                         without exceeding the upper bounds. Another equivalent way to define 
                           
                              η
                              (
                              k
                              )
                           
                         is 
                           
                              η
                              (
                              k
                              )
                              =
                              min
                              {
                              j
                              :
                              
                                 
                                    q
                                 
                                 
                                    j
                                 
                                 
                                    k
                                 
                              
                              >
                              
                                 
                                    L
                                 
                                 
                                    j
                                 
                              
                              }
                           
                        .

We show in Appendix A that for any input I and policy x, there is a LBH input 
                           
                              
                                 
                                    I
                                 
                                 
                                    ′
                                 
                              
                           
                         with a lean profile to satisfy (11). This result is based on the following observation: substituting a higher-fare request with a lower-fare request may reduce not only the expected online revenue, but also the competitive ratio. Keep doing that and we will eventually end up with a lean profile, at which point further substitution is no longer possible. Thus we have the following major scenario reduction result:
                           Theorem 1
                           
                              The set of all LBH inputs with a lean profile is a sufficient subset.
                           

We would like to point out that the analysis under the MAR criterion can be taken one step further: It is possible to reduce the number of scenarios in a sufficient subset from 
                           
                              ‖
                              U
                              ‖
                              -
                              ‖
                              L
                              ‖
                              +
                              1
                           
                         to only 
                           
                              m
                              +
                              1
                           
                        . We call it the subset of extreme inputs as they are identical to the extreme inputs in Lan et al. (2008). See the discussion in Appendix C.

So far we have assumed the seller uses nested policies, which is a subset of deterministic online policies. We are yet to show that any deterministic online policy d cannot achieve a better CR or MAR than a nested policy x. A deterministic online policy d always produces the same booking position 
                           
                              w
                              (
                              I
                              ,
                              d
                              )
                           
                         for the same input I. To describe the online booking process, let 
                           
                              w
                              (
                              I
                              ,
                              d
                              ;
                              n
                              )
                           
                         denote the partial booking position after processing the first n requests in I using policy d. Initially we have
                           
                              (13)
                              
                                 w
                                 (
                                 I
                                 ,
                                 d
                                 ;
                                 0
                                 )
                                 =
                                 0
                                 .
                              
                           
                        The online policy is not allowed to change decisions already made, so
                           
                              (14)
                              
                                 w
                                 (
                                 I
                                 ,
                                 d
                                 ;
                                 n
                                 -
                                 1
                                 )
                                 ⩽
                                 w
                                 (
                                 I
                                 ,
                                 d
                                 ;
                                 n
                                 )
                                 ⩽
                                 w
                                 (
                                 I
                                 ,
                                 d
                                 ;
                                 n
                                 -
                                 1
                                 )
                                 +
                                 
                                    
                                       e
                                    
                                    
                                       I
                                       (
                                       n
                                       )
                                    
                                 
                                 ,
                              
                           
                        where 
                           
                              I
                              (
                              n
                              )
                           
                         is the fare class of the 
                           
                              n
                           
                        th request in input I and 
                           
                              
                                 
                                    e
                                 
                                 
                                    I
                                    (
                                    n
                                    )
                                 
                              
                           
                         is the corresponding unit vector. Finally, if the first n requests in any two inputs I and J are identical, then the online policy accepts the same number of requests under I and J up to the 
                           
                              n
                           
                        th request:
                           
                              (15)
                              
                                 w
                                 (
                                 I
                                 ,
                                 d
                                 ;
                                 n
                                 )
                                 =
                                 w
                                 (
                                 J
                                 ,
                                 d
                                 ;
                                 n
                                 )
                                 ,
                                 
                                 if
                                 
                                 I
                                 (
                                 i
                                 )
                                 =
                                 J
                                 (
                                 i
                                 )
                                 ,
                                 i
                                 ⩽
                                 n
                                 .
                              
                           
                        
                     

Considering the lean profile 
                           
                              
                                 
                                    q
                                 
                                 
                                    k
                                 
                              
                           
                        , if 
                           
                              
                                 
                                    q
                                 
                                 
                                    i
                                 
                                 
                                    k
                                 
                              
                              =
                              
                                 
                                    U
                                 
                                 
                                    i
                                 
                              
                           
                        , for any 
                           
                              
                                 
                                    k
                                 
                                 
                                    ′
                                 
                              
                              ⩾
                              k
                           
                         we also have 
                           
                              
                                 
                                    q
                                 
                                 
                                    i
                                 
                                 
                                    
                                       
                                          k
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                              =
                              
                                 
                                    U
                                 
                                 
                                    i
                                 
                              
                           
                        . Let 
                           
                              h
                              (
                              k
                              )
                              =
                              min
                              {
                              i
                              :
                              
                                 
                                    q
                                 
                                 
                                    i
                                 
                                 
                                    k
                                 
                              
                              =
                              
                                 
                                    U
                                 
                                 
                                    j
                                 
                              
                              }
                           
                        , then the first 
                           
                              n
                              =
                              
                                 
                                    ∑
                                 
                                 
                                    i
                                    ⩾
                                    h
                                    (
                                    k
                                    )
                                 
                              
                              
                                 
                                    U
                                 
                                 
                                    i
                                 
                              
                           
                         requests are identical for the lean input streams 
                           
                              
                                 
                                    
                                       
                                          q
                                       
                                       
                                          ˇ
                                       
                                    
                                 
                                 
                                    k
                                 
                              
                           
                         and 
                           
                              
                                 
                                    
                                       
                                          q
                                       
                                       
                                          ˇ
                                       
                                    
                                 
                                 
                                    
                                       
                                          k
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                           
                        . Thus by equation (15), there must be 
                           
                              w
                              (
                              
                                 
                                    
                                       
                                          q
                                       
                                       
                                          ˇ
                                       
                                    
                                 
                                 
                                    k
                                 
                              
                              ,
                              d
                              ;
                              n
                              )
                              =
                              w
                              (
                              
                                 
                                    
                                       
                                          q
                                       
                                       
                                          ˇ
                                       
                                    
                                 
                                 
                                    
                                       
                                          k
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                              ,
                              d
                              ;
                              n
                              )
                           
                        . For fare requests after the 
                           
                              n
                           
                        th, they cannot belong to class i, for 
                           
                              i
                              ⩾
                              h
                              (
                              k
                              )
                           
                        , so 
                           
                              
                                 
                                    w
                                 
                                 
                                    i
                                 
                              
                              (
                              
                                 
                                    
                                       
                                          q
                                       
                                       
                                          ˇ
                                       
                                    
                                 
                                 
                                    k
                                 
                              
                              ,
                              d
                              )
                              =
                              
                                 
                                    w
                                 
                                 
                                    i
                                 
                              
                              (
                              
                                 
                                    
                                       
                                          q
                                       
                                       
                                          ˇ
                                       
                                    
                                 
                                 
                                    
                                       
                                          k
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                              ,
                              d
                              )
                              ,
                              i
                              ⩾
                              h
                              (
                              k
                              )
                           
                        . Specially, for the last lean profile 
                           
                              
                                 
                                    
                                       
                                          q
                                       
                                       
                                          ˇ
                                       
                                    
                                 
                                 
                                    ‖
                                    U
                                    ‖
                                 
                              
                           
                        ,
                           
                              (16)
                              
                                 
                                    
                                       w
                                    
                                    
                                       k
                                       ,
                                       i
                                    
                                    
                                       d
                                    
                                 
                                 =
                                 
                                    
                                       w
                                    
                                    
                                       ‖
                                       U
                                       ‖
                                       ,
                                       i
                                    
                                    
                                       d
                                    
                                 
                                 ,
                                 
                                 ∀
                                 i
                                 ⩾
                                 h
                                 (
                                 k
                                 )
                                 ,
                              
                           
                        where 
                           
                              
                                 
                                    w
                                 
                                 
                                    k
                                 
                                 
                                    d
                                 
                              
                              =
                              w
                              (
                              
                                 
                                    
                                       
                                          q
                                       
                                       
                                          ˇ
                                       
                                    
                                 
                                 
                                    k
                                 
                              
                              ,
                              d
                              )
                           
                         is a vector of booking positions of policy d on the 
                           
                              k
                           
                        th lean input. Combining all those vectors together yields a matrix of 
                           
                              
                                 
                                    (
                                    
                                       
                                          w
                                       
                                       
                                          d
                                       
                                    
                                    )
                                 
                                 
                                    k
                                    ,
                                    i
                                 
                              
                           
                         with 
                           
                              k
                              ∈
                              {
                              ‖
                              L
                              ‖
                              ,
                              …
                              ,
                              ‖
                              U
                              ‖
                              }
                              ,
                              i
                              ∈
                              {
                              1
                              ,
                              …
                              ,
                              m
                              }
                           
                        . By working with this matrix, the relationship between nesting and other deterministic policies is established. This result is formally stated in the next theorem. The proof is in Appendix B.
                           Theorem 2
                           
                              An optimal deterministic policy can be found among nested policies, and there is an optimal nested policy 
                              
                                 
                                    
                                       
                                          x
                                       
                                       
                                          ∗
                                       
                                    
                                 
                               
                              such that (i) 
                              
                                 
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                       
                                          ∗
                                       
                                    
                                    >
                                    0
                                 
                               
                              implies 
                              
                                 
                                    
                                       
                                          x
                                       
                                       
                                          j
                                       
                                       
                                          ∗
                                       
                                    
                                    ⩾
                                    
                                       
                                          L
                                       
                                       
                                          j
                                       
                                    
                                    ,
                                    j
                                    <
                                    i
                                 
                              
                              , and (ii) 
                              
                                 
                                    R
                                    (
                                    
                                       
                                          w
                                       
                                       
                                          k
                                       
                                       
                                          
                                             
                                                x
                                             
                                             
                                                ∗
                                             
                                          
                                       
                                    
                                    )
                                 
                               
                              increases in k.
                           

This result shows that nested policies are optimal among all deterministic policies. Furthermore, the optimal nested policy has some special structural properties related to the lean profiles. Our proof focuses on the booking positions of a deterministic policy d when applied to the lean inputs. We show that the booking positions can be altered through an iterative procedure (resulting in a series of deterministic policies) where the worst case regret (CR or MAR) keeps improving. In the end we show that the final deterministic policy obtained is in fact a nested policy, which proves the optimality of nested policy. Meanwhile, we also note that the final policy satisfies conditions (i) and (ii) in Theorem 2.

We design an effective optimization procedure and provide a set of computational experiments to (1) quantify the performance of our method, and (2) to compare it to other well-known methods. We use the common random number technique in simulation to ensure that all considered methods are given the same set of input sequences and no-show realizations. For one problem instance, we simulate a set of 10,000 realizations as common input to all methods. Then the average revenue, and the 5th and 95th percentiles of revenue of all methods are compared. For better comparisons, the 95% confidence intervals are also shown on the figures as error bars.

We consider a total of five methods: (i) HCR/OSA obtains the policy from the new model in this paper with CR as the objective; (ii) HAR/OSA differs from HCR/OSA simply by using MAR as the model objective; (iii) EMSR/NV finds the virtual capacity using a newsvendor-type model, and allocates capacity by EMSR-b; (iv) EMSR/SL determines the virtual capacity using a target type-I service level of 0.1%, and seat allocation by EMSR-b; (v) DP/LBH simultaneously finds virtual capacity and protection levels by dynamic programming, assuming LBH arrivals with demand and no-show distributions. The DP/LBH gives the upper bound on the expected revenue for our experiments, and the EMSR/NV is widely adopted in practice and serves as the typical revenue expected in industry, while the EMSR/SL is more conservative and serves as a practical guide for acceptable level of revenue. For details on EMSR/NV, EMSR/SL and DP/LBH, see Talluri and Ryzin (2004) and Phillips (2005).

For all the three numerical experiments, we create a series of instances by changing some aspect of a base problem instance, which has these parameters:
                        
                           
                              
                                 
                                    
                                    
                                       
                                          C
                                          =
                                          125
                                          ,
                                          
                                          β
                                          =
                                          0.1
                                          ,
                                          
                                          V
                                          =
                                          $
                                          2500
                                          ,
                                          
                                          Q
                                          =
                                          0
                                          ,
                                          
                                          f
                                          =
                                          (
                                          1050
                                          ,
                                          647
                                          ,
                                          350
                                          )
                                          ,
                                       
                                    
                                 
                                 
                                    
                                    
                                       
                                          p
                                          =
                                          0.1
                                          ,
                                          
                                          μ
                                          =
                                          (
                                          39.5
                                          ,
                                          95.0
                                          ,
                                          47.5
                                          )
                                          ,
                                          
                                          σ
                                          =
                                          (
                                          14.1
                                          ,
                                          31.2
                                          ,
                                          13.0
                                          )
                                          .
                                       
                                    
                                 
                              
                           
                        
                     Note that demand in fare class i is normally distributed with 
                        
                           
                              
                                 μ
                              
                              
                                 i
                              
                           
                        
                      as mean and 
                        
                           
                              
                                 σ
                              
                              
                                 i
                              
                           
                        
                      as standard deviation. The overbooking penalty function is 
                        
                           V
                           (
                           y
                           )
                           =
                           $
                           2500
                           
                              
                                 [
                                 y
                                 -
                                 125
                                 ]
                              
                              
                                 +
                              
                           
                        
                     , and each passenger will independently become a no-show with probability 
                        
                           p
                           =
                           0.1
                        
                     . Those parameters are chosen to give a demand factor of 1.46. We let the middle fare have the highest demand. The standard deviation is about a third of the mean, same as the example without no-shows in Talluri and Ryzin (2004) (pp. 48–50). For HCR/OSA and HAR/OSA, the demand bounds 
                        
                           L
                           ,
                           U
                        
                      can be derived according to the guidelines given by Perakis and Roels (2010): Set the lower and upper bounds (L and U) around the 25th and 75th percentiles rather than the endpoints of the distribution, or simply choose 
                        
                           μ
                           ±
                           σ
                        
                      as the bounds in the case of normal distributions. In our simulations, the probabilistic models (EMSR, DP) use the correct demand distribution to determine the optimal policy, and our model only uses the bounds (percentiles) of the demand distribution.

We use the CE method for the continuous version of the problem (1), where the discrete expected service denial cost function 
                           
                              V
                              (
                              ·
                              )
                           
                         is extended by linear interpolation: 
                           
                              
                                 
                                    V
                                 
                                 
                                    ∼
                                 
                              
                              (
                              y
                              )
                              =
                              (
                              1
                              +
                              ⌊
                              y
                              ⌋
                              -
                              y
                              )
                              V
                              (
                              ⌊
                              y
                              ⌋
                              )
                              +
                              (
                              y
                              -
                              ⌊
                              y
                              ⌋
                              )
                              V
                              (
                              1
                              +
                              ⌊
                              y
                              ⌋
                              )
                           
                        . Even though 
                           
                              
                                 
                                    V
                                 
                                 
                                    ∼
                                 
                              
                              (
                              y
                              )
                           
                         is convex, the continualized CR and MAR problem is not, which model-based methods can still handle. Each random variable 
                           
                              
                                 
                                    x
                                 
                                 
                                    i
                                 
                              
                           
                         is independently drawn from a Normal distribution truncated below zero to omit negative values, which forms the underlying distribution model. The covariances are zero, so there are only 
                           
                              2
                              m
                           
                         parameters in the distribution model: a mean 
                           
                              
                                 
                                    μ
                                 
                                 
                                    i
                                 
                              
                           
                         and a standard deviation 
                           
                              
                                 
                                    σ
                                 
                                 
                                    i
                                 
                              
                           
                         for each 
                           
                              
                                 
                                    x
                                 
                                 
                                    i
                                 
                              
                           
                        . The objective function of a sample policy x is easily computed as the scenarios have been greatly reduced (
                           
                              m
                              +
                              1
                           
                         for MAR and 
                           
                              ‖
                              U
                              -
                              L
                              ‖
                              +
                              1
                           
                         for CR). Let N be the number of random sample policies, only the best 
                           
                              ρ
                              N
                           
                         of them are selected into the elite set to update the model (ρ is the fraction of policies selected into the elite set). This whole process is repeated until the maximum number of iterations T is reached, which is chosen big enough for the algorithm to converge. In our experiments, the parameters are 
                           
                              N
                              =
                              3000
                              ,
                              T
                              =
                              50
                           
                        , and 
                           
                              ρ
                              =
                              10
                              %
                           
                        , which are close to what is commonly used in the literature. An outline of the procedure is as follows:
                           
                              1.
                              Set iteration count 
                                    
                                       t
                                       ←
                                       0
                                    
                                 , and 
                                    
                                       
                                          
                                             μ
                                          
                                          
                                             i
                                          
                                          
                                             (
                                             0
                                             )
                                          
                                       
                                       ←
                                       
                                          
                                             σ
                                          
                                          
                                             i
                                          
                                          
                                             (
                                             0
                                             )
                                          
                                       
                                       ←
                                       
                                          
                                             U
                                          
                                          
                                             i
                                          
                                       
                                       /
                                       2
                                    
                                  for 
                                    
                                       i
                                       =
                                       1
                                       ,
                                       …
                                       ,
                                       m
                                    
                                 .

Generate N random samples from the model with 
                                    
                                       
                                          
                                             μ
                                          
                                          
                                             (
                                             t
                                             )
                                          
                                       
                                       ,
                                       
                                          
                                             σ
                                          
                                          
                                             (
                                             t
                                             )
                                          
                                       
                                    
                                 .

Evaluate the policies and select the best 
                                    
                                       ρ
                                       N
                                    
                                  into the elite set.

Keep track of the best policy found so far.

Compute the MLE from the elite set to update the model with 
                                    
                                       
                                          
                                             μ
                                          
                                          
                                             (
                                             t
                                             +
                                             1
                                             )
                                          
                                       
                                       ,
                                       
                                          
                                             σ
                                          
                                          
                                             (
                                             t
                                             +
                                             1
                                             )
                                          
                                       
                                    
                                 .


                                 
                                    
                                       t
                                       ←
                                       t
                                       +
                                       1
                                    
                                 , if 
                                    
                                       t
                                       =
                                       T
                                    
                                  then STOP, else GOTO step 2.

We run the procedure on the base instance several times and have found that it converges very fast to the same solution. Typically after 30 iterations the model becomes stable, the mean 
                           
                              
                                 
                                    μ
                                 
                                 
                                    (
                                    t
                                    )
                                 
                              
                           
                         converges to the best solution, while the standard deviation 
                           
                              
                                 
                                    σ
                                 
                                 
                                    (
                                    t
                                    )
                                 
                              
                           
                         converges to zero: 
                           
                              
                                 
                                    max
                                 
                                 
                                    i
                                 
                              
                              
                                 
                                    σ
                                 
                                 
                                    i
                                 
                                 
                                    (
                                    20
                                    )
                                 
                              
                              <
                              0.0001
                           
                         for all test runs. The runtime for this instance is 1.92s for 50 iterations on a 2.26GHz CPU.

The fare structure is altered by changing the fare values. Specifically, the base instance is altered as follows: the ratio of 
                           
                              
                                 
                                    f
                                 
                                 
                                    2
                                 
                              
                              /
                              
                                 
                                    f
                                 
                                 
                                    1
                                 
                              
                           
                         varies from 0.3 to 0.7, while the ratio 
                           
                              
                                 
                                    f
                                 
                                 
                                    3
                                 
                              
                              /
                              
                                 
                                    f
                                 
                                 
                                    2
                                 
                              
                           
                         is kept constant. Fig. 1
                         has the plots for this setup, and Table 1
                         reports the data for the average net revenue. It shows that the robust methods consistently give revenues higher than EMSR/SL, and very close to DP/LBH and EMSR/NV. Thus, our robust methods bear the advantage of worst regret guarantee, without sacrificing the average revenue. Also note that the robust methods appear to have more stable revenues, as seen from the standard deviation and the percentile plots. We see in the next experiment that this is not always the case.

The demand factor is the ratio of expected total demand to the seat capacity, which is important for the performance of revenue management policies. Instead of scaling the demand, this experiment alters the capacity of the base instance from 110 to 190, varying the demand factor from 0.99 to 1.71. Note that decisions are easier and performance differentials across policies are small when load factors are too low or too high. Fig. 2
                         presents the results for this configuration, and Table 2
                         has the data for the average net revenue. The robust methods again perform well in terms of the average revenue, and are always better than EMSR/SL. It is interesting to look at the plot of standard deviation. The robust methods have lower standard deviations when the capacity is less than 150, and higher when it is more than 150. It seems that the robust methods respond to the demand factor in a different way from the others: We note that the standard deviation of the robust methods increases evenly while the standard deviations of the other methods are stable when the capacity is between 130 and 170. This experiment shows an important property of our methods: the risk in revenue grows proportionally with expected revenue. We think it is because our regret-based methods provide solutions equidistant from all extreme, worst-case scenarios. We comment that our methods can further control risk via the choice of the demand bounds L and U, with a trade-off between risk and revenue.

The demand volatility is another important aspect that affects the performance of revenue management policies. In this experiment, we employ a simple mechanism to produce a series of problem instances from the base instance: the standard deviation is scaled by a control parameter 
                           
                              g
                              :
                              
                                 
                                    σ
                                 
                                 
                                    ′
                                 
                              
                              =
                              g
                              σ
                           
                        . Fig. 3
                         displays the results. The revenue of the robust methods is a little below that of DP/LBH and EMSR/NV and remains better than that of EMSR/SL. The standard deviation plot shows that the robust methods generally stay low. As demand volatility increases, the revenue of the robust methods decreases slightly faster than the other methods. And the 95th percentile decreases much faster than the other methods. Therefore the robust methods tend to be more conservative as the volatility increases. That is consistent with our observation in the previous experiment, since increased volatility causes lower expected revenues.

@&#CONCLUSION@&#

We extend the classical single resource problem in RM to include hybrid information. Our model makes simultaneous overbooking and inventory control decisions from the perspective of minimizing the worst case regret. Unlike other regret-based models, we consider the expected net revenue using the probabilistic information on no-shows, which results in a nonlinear problem and is vastly more challenging in both analysis and computation. By reducing the number of scenarios and studying the optimal policy structure, we find that the nested booking policy, widely used in practice and well studied in the literature, is again the optimal control structure in this new setting.

Our theoretical analysis greatly reduces the computational complexity and we solve our nonlinear model using a practical model-based procedure. This procedure requires only the evaluation of nested policies, which has been greatly simplified by scenario reduction. This procedure also shows how model-based methods can be applied to RM problems. We conduct extensive computational experiments to compare our methods to other well known methods. The experiments demonstrate that the hybrid methods are robust and effective, even though they only uses lower and upper bound information.

Our research can be further extended. We have assumed a uniform no-show rate across all fare classes. Future research may consider to relax this restriction, but additional assumptions might be needed to preserve the optimal policy structure. Another possible direction is to assume uncertainties in the demand distribution parameters. Admittedly, such a model would be even more difficult, nevertheless it could be interesting to practitioners. Incorporating choice behavior into our model remains a challenging direction to explore in the future.

@&#ACKNOWLEDGMENT@&#

The first two authors acknowledge the support of NSF under Grant No. DMI0,540,312. The first author also acknowledges the financial aid from Project 71,072,050 supported by National Natural Science Foundation of China (NSFC).

We prove the theorem by showing a series of results. Lan et al. (2008) classify all input streams into 
                        
                           m
                           +
                           1
                        
                      subsets (categories) given an arbitrary nested policy. The classification is straightforward: an input stream belongs to category 
                        
                           c
                           +
                           1
                        
                      if, after applying the nested policy to the whole stream, fare class-c is the lowest fare class that is still open (i.e. can still accept additional requests in this class). One interesting property is that all permutations of an input stream belong to the same category, therefore it is also a valid classification of all profiles. Note that if an input stream with profile q belongs to the 
                        
                           c
                           +
                           
                              
                                 1
                              
                              
                                 st
                              
                           
                        
                      category according to nested policy x, then we have 
                        
                           
                              
                                 w
                              
                              
                                 j
                              
                           
                           =
                           
                              
                                 q
                              
                              
                                 j
                              
                           
                           ,
                           j
                           =
                           1
                           ,
                           …
                           ,
                           c
                        
                      (by reason of no rejection for those classes), and 
                        
                           
                              
                                 ∑
                              
                              
                                 i
                                 =
                                 j
                              
                              
                                 m
                              
                           
                           
                              
                                 w
                              
                              
                                 i
                              
                           
                           <
                           
                              
                                 ∑
                              
                              
                                 i
                                 =
                                 j
                              
                              
                                 m
                              
                           
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                        
                     , for 
                        
                           j
                           =
                           1
                           ,
                           …
                           ,
                           c
                        
                      (since class c is still open). Also note that 
                        
                           
                              
                                 ∑
                              
                              
                                 i
                                 =
                                 c
                                 +
                                 1
                              
                              
                                 m
                              
                           
                           
                              
                                 w
                              
                              
                                 i
                              
                           
                           =
                           
                              
                                 b
                              
                              
                                 c
                                 +
                                 1
                              
                           
                        
                      since class 
                        
                           c
                           +
                           1
                        
                      is closed, we derive at this set of inequalities:
                        
                           (A.1)
                           
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       =
                                       j
                                    
                                    
                                       c
                                    
                                 
                              
                              
                                 
                                    q
                                 
                                 
                                    i
                                 
                              
                              <
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       =
                                       j
                                    
                                    
                                       c
                                    
                                 
                              
                              
                                 
                                    x
                                 
                                 
                                    i
                                 
                              
                              ,
                              
                              j
                              =
                              1
                              ,
                              …
                              ,
                              c
                              ,
                           
                        
                     which is particularly useful for the discussions that follow. Note that when 
                        
                           j
                           =
                           c
                        
                      we obtain 
                        
                           
                              
                                 q
                              
                              
                                 c
                              
                           
                           <
                           
                              
                                 x
                              
                              
                                 c
                              
                           
                        
                     . We simply refer to the LBH input 
                        
                           
                              
                                 
                                    
                                       q
                                    
                                    
                                       ˇ
                                    
                                 
                              
                              
                                 k
                              
                           
                        
                      with lean profile 
                        
                           
                              
                                 q
                              
                              
                                 k
                              
                           
                        
                      as the lean input of order k. To prove Theorem 1, we show that for any nested policy x and any input stream I, there is a k such that 
                        
                           
                              
                                 I
                              
                              
                                 ′
                              
                           
                           =
                           
                              
                                 
                                    
                                       q
                                    
                                    
                                       ˇ
                                    
                                 
                              
                              
                                 k
                              
                           
                        
                      satisfies (11). We note a useful sufficient condition for (11), leaving the proof to the reader:
                        
                           (A.2)
                           
                              R
                              (
                              I
                              ;
                              x
                              )
                              -
                              R
                              (
                              
                                 
                                    I
                                 
                                 
                                    ′
                                 
                              
                              ;
                              x
                              )
                              ⩾
                              0
                              ,
                              
                              R
                              (
                              I
                              ;
                              x
                              )
                              -
                              R
                              (
                              
                                 
                                    I
                                 
                                 
                                    ′
                                 
                              
                              ;
                              x
                              )
                              ⩾
                              
                                 
                                    R
                                 
                                 
                                    ∗
                                 
                              
                              (
                              I
                              )
                              -
                              
                                 
                                    R
                                 
                                 
                                    ∗
                                 
                              
                              (
                              
                                 
                                    I
                                 
                                 
                                    ′
                                 
                              
                              )
                              .
                           
                        
                     We develop a formal proof of Theorem 1 along this direction as follows.
                        Proof
                        We only need to consider LBH streams 
                              
                                 
                                    
                                       q
                                    
                                    
                                       ˇ
                                    
                                 
                                 ∈
                                 
                                    
                                       Ω
                                    
                                    
                                       ˇ
                                    
                                 
                              
                           . Let x denote the nested policy, which divides all input sequences into its associated categories. Let 
                              
                                 
                                    
                                       q
                                    
                                    
                                       ˇ
                                    
                                 
                              
                            belongs to category 
                              
                                 c
                                 +
                                 1
                              
                            (with regard to x). We assume 
                              
                                 
                                    
                                       q
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 
                                    
                                       U
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 i
                                 >
                                 c
                              
                           , otherwise we can construct a LBH input in the same category that is worse than 
                              
                                 
                                    
                                       q
                                    
                                    
                                       ˇ
                                    
                                 
                              
                            with regard to x by appending 
                              
                                 
                                    
                                       U
                                    
                                    
                                       i
                                    
                                 
                                 -
                                 
                                    
                                       q
                                    
                                    
                                       i
                                    
                                 
                              
                            requests in each fare class i (
                              
                                 i
                                 >
                                 c
                              
                           ). Appending those additional requests will not change the online revenue, as all these requests will be rejected by x. Then by Proposition 1 we can rearrange it to a LBH input without increasing the online revenue. On the other hand, the ex-post revenue will not decrease, therefore we have constructed a worse input satisfying 
                              
                                 
                                    
                                       q
                                    
                                    
                                       i
                                    
                                 
                                 =
                                 
                                    
                                       U
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 i
                                 >
                                 c
                              
                           . If q is already one of the lean profiles, we stop; otherwise we will make gradual adjustments that will lead to a lean profile.

If q is not a lean profile, then there is a 
                              
                                 k
                                 <
                                 c
                              
                            such that 
                              
                                 
                                    
                                       q
                                    
                                    
                                       k
                                    
                                 
                                 >
                                 
                                    
                                       L
                                    
                                    
                                       k
                                    
                                 
                              
                           . Construct a new profile 
                              
                                 
                                    
                                       q
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 q
                                 +
                                 
                                    
                                       e
                                    
                                    
                                       c
                                    
                                 
                                 -
                                 
                                    
                                       e
                                    
                                    
                                       k
                                    
                                 
                              
                           . As the LBH stream 
                              
                                 
                                    
                                       q
                                    
                                    
                                       ˇ
                                    
                                 
                              
                            belongs to category 
                              
                                 c
                                 +
                                 1
                              
                           , Then from (A.1) we have 
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       =
                                       j
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       q
                                    
                                    
                                       i
                                    
                                    
                                       ′
                                    
                                 
                                 ⩽
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       =
                                       j
                                    
                                    
                                       c
                                    
                                 
                                 
                                    
                                       x
                                    
                                    
                                       i
                                    
                                 
                                 ,
                                 j
                                 ⩽
                                 c
                              
                           , which means with profile 
                              
                                 
                                    
                                       q
                                    
                                    
                                       ′
                                    
                                 
                              
                            none of the requests in fare classes 
                              
                                 j
                                 =
                                 1
                                 ,
                                 …
                                 ,
                                 c
                              
                            will be rejected by x, exactly the same as what happens with q. So we have 
                              
                                 w
                                 (
                                 
                                    
                                       
                                          
                                             q
                                          
                                          
                                             ˇ
                                          
                                       
                                    
                                    
                                       ′
                                    
                                 
                                 ;
                                 x
                                 )
                                 =
                                 w
                                 (
                                 
                                    
                                       q
                                    
                                    
                                       ˇ
                                    
                                 
                                 ;
                                 x
                                 )
                                 +
                                 
                                    
                                       e
                                    
                                    
                                       c
                                    
                                 
                                 -
                                 
                                    
                                       e
                                    
                                    
                                       k
                                    
                                 
                              
                            and by reason of (3) we further have 
                              
                                 R
                                 (
                                 
                                    
                                       q
                                    
                                    
                                       ˇ
                                    
                                 
                                 ;
                                 x
                                 )
                                 -
                                 R
                                 (
                                 
                                    
                                       
                                          
                                             q
                                          
                                          
                                             ˇ
                                          
                                       
                                    
                                    
                                       ′
                                    
                                 
                                 ;
                                 x
                                 )
                                 ⩾
                                 
                                    
                                       f
                                    
                                    
                                       k
                                    
                                    
                                       ′
                                    
                                 
                                 -
                                 
                                    
                                       f
                                    
                                    
                                       c
                                    
                                    
                                       ′
                                    
                                 
                              
                           . Next, consider the ex-post optimal revenue. With the ex-post optimal solution 
                              
                                 
                                    
                                       w
                                    
                                    
                                       ∗
                                    
                                 
                                 (
                                 
                                    
                                       q
                                    
                                    
                                       ˇ
                                    
                                 
                                 )
                                 ⩽
                                 q
                              
                           , let 
                              
                                 
                                    
                                       w
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 
                                    
                                       w
                                    
                                    
                                       ∗
                                    
                                 
                                 (
                                 
                                    
                                       q
                                    
                                    
                                       ˇ
                                    
                                 
                                 )
                                 +
                                 
                                    
                                       e
                                    
                                    
                                       c
                                    
                                 
                                 -
                                 
                                    
                                       e
                                    
                                    
                                       k
                                    
                                 
                                 ⩽
                                 q
                                 +
                                 
                                    
                                       e
                                    
                                    
                                       c
                                    
                                 
                                 -
                                 
                                    
                                       e
                                    
                                    
                                       k
                                    
                                 
                                 =
                                 
                                    
                                       q
                                    
                                    
                                       ′
                                    
                                 
                              
                           . As 
                              
                                 
                                    
                                       q
                                    
                                    
                                       ′
                                    
                                 
                                 =
                                 q
                                 +
                                 
                                    
                                       e
                                    
                                    
                                       c
                                    
                                 
                                 -
                                 
                                    
                                       e
                                    
                                    
                                       k
                                    
                                 
                              
                           , if 
                              
                                 
                                    
                                       w
                                    
                                    
                                       ′
                                    
                                 
                                 ⩾
                                 0
                              
                            then 
                              
                                 
                                    
                                       w
                                    
                                    
                                       ′
                                    
                                 
                              
                            is a feasible solution to (10) with 
                              
                                 I
                                 =
                                 
                                    
                                       
                                          
                                             q
                                          
                                          
                                             ˇ
                                          
                                       
                                    
                                    
                                       ′
                                    
                                 
                              
                           . So we have a lower bound when 
                              
                                 
                                    
                                       w
                                    
                                    
                                       ′
                                    
                                 
                                 ⩾
                                 0
                              
                           : 
                              
                                 
                                    
                                       R
                                    
                                    
                                       ∗
                                    
                                 
                                 (
                                 
                                    
                                       
                                          
                                             q
                                          
                                          
                                             ˇ
                                          
                                       
                                    
                                    
                                       ′
                                    
                                 
                                 )
                                 ⩾
                                 R
                                 (
                                 
                                    
                                       w
                                    
                                    
                                       ′
                                    
                                 
                                 )
                              
                           . Therefore 
                              
                                 
                                    
                                       R
                                    
                                    
                                       ∗
                                    
                                 
                                 (
                                 
                                    
                                       q
                                    
                                    
                                       ˇ
                                    
                                 
                                 )
                                 -
                                 R
                                 (
                                 
                                    
                                       w
                                    
                                    
                                       ′
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       f
                                    
                                    
                                       k
                                    
                                    
                                       ′
                                    
                                 
                                 -
                                 
                                    
                                       f
                                    
                                    
                                       c
                                    
                                    
                                       ′
                                    
                                 
                              
                            as 
                              
                                 v
                                 (
                                 
                                    
                                       w
                                    
                                    
                                       ′
                                    
                                 
                                 +
                                 
                                    
                                       e
                                    
                                    
                                       k
                                    
                                 
                                 )
                                 -
                                 v
                                 (
                                 
                                    
                                       w
                                    
                                    
                                       ′
                                    
                                 
                                 )
                                 =
                                 v
                                 (
                                 
                                    
                                       w
                                    
                                    
                                       ∗
                                    
                                 
                                 (
                                 
                                    
                                       q
                                    
                                    
                                       ˇ
                                    
                                 
                                 )
                                 +
                                 
                                    
                                       e
                                    
                                    
                                       c
                                    
                                 
                                 )
                                 -
                                 v
                                 (
                                 
                                    
                                       w
                                    
                                    
                                       ∗
                                    
                                 
                                 (
                                 
                                    
                                       q
                                    
                                    
                                       ˇ
                                    
                                 
                                 )
                                 )
                              
                            from (4), by noting 
                              
                                 
                                    
                                       w
                                    
                                    
                                       ′
                                    
                                 
                                 +
                                 
                                    
                                       e
                                    
                                    
                                       k
                                    
                                 
                                 =
                                 
                                    
                                       w
                                    
                                    
                                       ∗
                                    
                                 
                                 (
                                 
                                    
                                       q
                                    
                                    
                                       ˇ
                                    
                                 
                                 )
                                 +
                                 
                                    
                                       e
                                    
                                    
                                       c
                                    
                                 
                              
                           . And we obtain the following:
                              
                                 (A.3)
                                 
                                    
                                       
                                          R
                                       
                                       
                                          ∗
                                       
                                    
                                    (
                                    
                                       
                                          q
                                       
                                       
                                          ˇ
                                       
                                    
                                    )
                                    -
                                    
                                       
                                          R
                                       
                                       
                                          ∗
                                       
                                    
                                    (
                                    
                                       
                                          
                                             
                                                q
                                             
                                             
                                                ˇ
                                             
                                          
                                       
                                       
                                          ′
                                       
                                    
                                    )
                                    ⩽
                                    
                                       
                                          f
                                       
                                       
                                          k
                                       
                                       
                                          ′
                                       
                                    
                                    -
                                    
                                       
                                          f
                                       
                                       
                                          c
                                       
                                       
                                          ′
                                       
                                    
                                    .
                                 
                              
                           If 
                              
                                 
                                    
                                       w
                                    
                                    
                                       ′
                                    
                                 
                                 ⩾
                                 0
                              
                            does not hold, then 
                              
                                 
                                    
                                       w
                                    
                                    
                                       ∗
                                    
                                 
                                 (
                                 
                                    
                                       q
                                    
                                    
                                       ˇ
                                    
                                 
                                 )
                              
                            is feasible to (10) with 
                              
                                 I
                                 =
                                 
                                    
                                       
                                          
                                             q
                                          
                                          
                                             ˇ
                                          
                                       
                                    
                                    
                                       ′
                                    
                                 
                              
                           , and thus 
                              
                                 
                                    
                                       R
                                    
                                    
                                       ∗
                                    
                                 
                                 (
                                 
                                    
                                       q
                                    
                                    
                                       ′
                                    
                                 
                                 )
                                 ⩾
                                 
                                    
                                       R
                                    
                                    
                                       ∗
                                    
                                 
                                 (
                                 q
                                 )
                              
                           , and (A.3) is still valid as 
                              
                                 
                                    
                                       f
                                    
                                    
                                       k
                                    
                                    
                                       ′
                                    
                                 
                                 -
                                 
                                    
                                       f
                                    
                                    
                                       c
                                    
                                    
                                       ′
                                    
                                 
                                 ⩾
                                 0
                              
                           . So we have
                              
                                 
                                    R
                                    (
                                    
                                       
                                          q
                                       
                                       
                                          ˇ
                                       
                                    
                                    ;
                                    x
                                    )
                                    -
                                    R
                                    (
                                    
                                       
                                          
                                             
                                                q
                                             
                                             
                                                ˇ
                                             
                                          
                                       
                                       
                                          ′
                                       
                                    
                                    ;
                                    x
                                    )
                                    ⩾
                                    
                                       
                                          f
                                       
                                       
                                          k
                                       
                                       
                                          ′
                                       
                                    
                                    -
                                    
                                       
                                          f
                                       
                                       
                                          c
                                       
                                       
                                          ′
                                       
                                    
                                    ⩾
                                    
                                       
                                          R
                                       
                                       
                                          ∗
                                       
                                    
                                    (
                                    
                                       
                                          q
                                       
                                       
                                          ˇ
                                       
                                    
                                    )
                                    -
                                    
                                       
                                          R
                                       
                                       
                                          ∗
                                       
                                    
                                    (
                                    
                                       
                                          
                                             
                                                q
                                             
                                             
                                                ˇ
                                             
                                          
                                       
                                       
                                          ′
                                       
                                    
                                    )
                                    ,
                                 
                              
                           thus 
                              
                                 
                                    
                                       
                                          
                                             q
                                          
                                          
                                             ˇ
                                          
                                       
                                    
                                    
                                       ′
                                    
                                 
                              
                            is worse than 
                              
                                 
                                    
                                       q
                                    
                                    
                                       ˇ
                                    
                                 
                              
                            by (A.2).

Let 
                              
                                 
                                    
                                       q
                                    
                                    
                                       (
                                       0
                                       )
                                    
                                 
                                 =
                                 q
                              
                           , and if 
                              
                                 
                                    
                                       q
                                    
                                    
                                       (
                                       j
                                       )
                                    
                                 
                                 ,
                                 j
                                 ⩾
                                 0
                              
                            is not a lean profile, we can recursively construct 
                              
                                 
                                    
                                       q
                                    
                                    
                                       (
                                       j
                                       +
                                       1
                                       )
                                    
                                 
                              
                            from 
                              
                                 
                                    
                                       q
                                    
                                    
                                       (
                                       j
                                       )
                                    
                                 
                              
                            employing the same process as above, forming a series of profiles, with each profile worse than the ones before it. Let 
                              
                                 
                                    
                                       q
                                    
                                    
                                       (
                                       j
                                       )
                                    
                                 
                              
                            belongs to category 
                              
                                 
                                    
                                       c
                                    
                                    
                                       j
                                    
                                 
                                 +
                                 1
                              
                           , the sum 
                              
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       =
                                       1
                                    
                                    
                                       
                                          
                                             c
                                          
                                          
                                             j
                                          
                                       
                                       -
                                       1
                                    
                                 
                                 (
                                 
                                    
                                       q
                                    
                                    
                                       i
                                    
                                    
                                       (
                                       j
                                       )
                                    
                                 
                                 -
                                 
                                    
                                       L
                                    
                                    
                                       i
                                    
                                 
                                 )
                              
                            decreases by at least one as j increases by one. Clearly, the process ends in a finite number of iterations until the sum is zero, i.e., until a lean profile is found.□

We prove the theorem in multiple steps. Before studying the properties of 
                        
                           
                              
                                 w
                              
                              
                                 k
                                 ,
                                 η
                                 (
                                 k
                                 )
                              
                              
                                 d
                              
                           
                        
                     , we take a closer look at the lean profiles. For a given 
                        
                           η
                           ∈
                           [
                           0
                           ,
                           m
                           ]
                        
                     , let 
                        
                           k
                           (
                           η
                           )
                           =
                           
                              
                                 ∑
                              
                              
                                 i
                                 =
                                 1
                              
                              
                                 η
                              
                           
                           
                              
                                 L
                              
                              
                                 i
                              
                           
                           +
                           
                              
                                 ∑
                              
                              
                                 i
                                 =
                                 η
                                 +
                                 1
                              
                              
                                 m
                              
                           
                           
                              
                                 U
                              
                              
                                 i
                              
                           
                        
                     . Adding more class-η requests to 
                        
                           
                              
                                 q
                              
                              
                                 k
                                 (
                                 η
                                 )
                              
                           
                        
                      one by one before reaching the upper bound 
                        
                           
                              
                                 U
                              
                              
                                 η
                              
                           
                        
                      will produce all the intermediate lean profiles between 
                        
                           
                              
                                 q
                              
                              
                                 k
                                 (
                                 η
                                 )
                              
                           
                        
                      and 
                        
                           
                              
                                 q
                              
                              
                                 k
                                 (
                                 η
                                 -
                                 1
                                 )
                              
                           
                        
                     , with 
                        
                           
                              
                                 q
                              
                              
                                 k
                                 (
                                 η
                                 -
                                 1
                                 )
                              
                           
                        
                      being produced upon reaching 
                        
                           
                              
                                 U
                              
                              
                                 η
                              
                           
                        
                     . Let 
                        
                           
                              
                                 K
                              
                              
                                 η
                              
                           
                        
                      denote the set of k defined as 
                        
                           
                              
                                 K
                              
                              
                                 η
                              
                           
                           =
                           {
                           k
                           :
                           η
                           (
                           k
                           )
                           =
                           η
                           }
                        
                      and we readily have 
                        
                           
                              
                                 K
                              
                              
                                 η
                              
                           
                           =
                           {
                           k
                           ∈
                           Z
                           :
                           k
                           (
                           η
                           )
                           <
                           k
                           ⩽
                           k
                           (
                           η
                           -
                           1
                           )
                           }
                        
                      from that observation. Let k start from 
                        
                           k
                           (
                           η
                           )
                        
                      and gradually increases to 
                        
                           k
                           (
                           η
                           -
                           1
                           )
                        
                     , consider the 
                        
                           η
                        
                     th component in the booking positions 
                        
                           
                              
                                 w
                              
                              
                                 k
                                 η
                              
                              
                                 d
                              
                           
                        
                     . Clearly we shall have 
                        
                           
                              
                                 w
                              
                              
                                 k
                                 ,
                                 η
                              
                              
                                 d
                              
                           
                           ⩽
                           
                              
                                 q
                              
                              
                                 η
                              
                              
                                 k
                              
                           
                        
                      by reason of (13)–(15). And 
                        
                           
                              
                                 w
                              
                              
                                 k
                                 ,
                                 η
                              
                              
                                 d
                              
                           
                        
                      shall gradually increase until reaching 
                        
                           
                              
                                 w
                              
                              
                                 k
                                 (
                                 η
                                 -
                                 1
                                 )
                                 ,
                                 η
                              
                              
                                 d
                              
                           
                           =
                           
                              
                                 w
                              
                              
                                 ‖
                                 U
                                 ‖
                                 ,
                                 η
                              
                              
                                 d
                              
                           
                        
                     . So for each 
                        
                           s
                           ∈
                           [
                           
                              
                                 w
                              
                              
                                 k
                                 (
                                 η
                                 )
                                 ,
                                 η
                              
                              
                                 d
                              
                           
                           ,
                           
                              
                                 w
                              
                              
                                 k
                                 (
                                 η
                                 -
                                 1
                                 )
                                 ,
                                 η
                              
                              
                                 d
                              
                           
                           ]
                        
                     , there is at least one 
                        
                           
                              
                                 k
                              
                              
                                 ′
                              
                           
                           ∈
                           [
                           k
                           (
                           η
                           )
                           ,
                           k
                           (
                           η
                           -
                           1
                           )
                           ]
                        
                      such that 
                        
                           
                              
                                 w
                              
                              
                                 
                                    
                                       k
                                    
                                    
                                       ′
                                    
                                 
                                 ,
                                 η
                              
                              
                                 d
                              
                           
                           =
                           s
                        
                     , therefore we can define a mapping 
                        
                           
                              
                                 k
                              
                              
                                 η
                              
                              
                                 d
                              
                           
                           (
                           s
                           )
                           =
                           max
                           {
                           
                              
                                 k
                              
                              
                                 ′
                              
                           
                           ∈
                           [
                           k
                           (
                           η
                           )
                           ,
                           k
                           (
                           η
                           -
                           1
                           )
                           ]
                           :
                           
                              
                                 w
                              
                              
                                 
                                    
                                       k
                                    
                                    
                                       ′
                                    
                                 
                                 ,
                                 η
                              
                              
                                 d
                              
                           
                           =
                           s
                           }
                        
                     . For a given policy d and η, define a row substitution operation on matrix 
                        
                           
                              
                                 w
                              
                              
                                 d
                              
                           
                        
                      (with other rows unchanged):
                        
                           (B.1)
                           
                              
                                 
                                    w
                                 
                                 
                                    k
                                 
                                 
                                    
                                       
                                          d
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                              =
                              
                                 
                                    w
                                 
                                 
                                    
                                       
                                          k
                                       
                                       
                                          η
                                       
                                       
                                          d
                                       
                                    
                                    (
                                    
                                       min
                                    
                                    (
                                    
                                       
                                          q
                                       
                                       
                                          η
                                       
                                       
                                          k
                                       
                                    
                                    ,
                                    
                                       
                                          w
                                       
                                       
                                          ‖
                                          U
                                          ‖
                                          η
                                       
                                       
                                          d
                                       
                                    
                                    )
                                    )
                                 
                                 
                                    d
                                 
                              
                              ,
                              
                              k
                              ∈
                              [
                              k
                              (
                              η
                              )
                              :
                              k
                              (
                              η
                              -
                              1
                              )
                              ]
                              .
                           
                        
                     After the substitution, we have 
                        
                           
                              
                                 w
                              
                              
                                 k
                                 ,
                                 η
                              
                              
                                 
                                    
                                       d
                                    
                                    
                                       ′
                                    
                                 
                              
                           
                           =
                           min
                           (
                           
                              
                                 q
                              
                              
                                 η
                              
                              
                                 k
                              
                           
                           ,
                           
                              
                                 w
                              
                              
                                 ‖
                                 U
                                 ‖
                                 ,
                                 η
                              
                              
                                 d
                              
                           
                           )
                        
                     , which shows that 
                        
                           
                              
                                 d
                              
                              
                                 ′
                              
                           
                        
                      behaves like a nested policy and 
                        
                           
                              
                                 w
                              
                              
                                 k
                                 ,
                                 η
                              
                              
                                 
                                    
                                       d
                                    
                                    
                                       ′
                                    
                                 
                              
                           
                        
                      is a valid booking position matrix for a deterministic online policy. We show that the obtained policy 
                        
                           
                              
                                 d
                              
                              
                                 ′
                              
                           
                        
                      has better regret (CR or MAR) than d. We note that the operation substitutes row 
                        
                           
                              
                                 k
                              
                              
                                 ′
                              
                           
                           =
                           
                              
                                 k
                              
                              
                                 η
                              
                              
                                 d
                              
                           
                           (
                           min
                           (
                           
                              
                                 q
                              
                              
                                 η
                              
                              
                                 k
                              
                           
                           ,
                           
                              
                                 w
                              
                              
                                 ‖
                                 U
                                 ‖
                                 ,
                                 η
                              
                              
                                 d
                              
                           
                           )
                           )
                        
                      for row k. Since 
                        
                           
                              
                                 w
                              
                              
                                 k
                                 ,
                                 η
                              
                              
                                 d
                              
                           
                           ⩽
                           min
                           (
                           
                              
                                 q
                              
                              
                                 η
                              
                              
                                 k
                              
                           
                           ,
                           
                              
                                 w
                              
                              
                                 ‖
                                 U
                                 ‖
                                 ,
                                 η
                              
                              
                                 d
                              
                           
                           )
                           =
                           
                              
                                 w
                              
                              
                                 
                                    
                                       k
                                    
                                    
                                       ′
                                    
                                 
                                 ,
                                 η
                              
                              
                                 d
                              
                           
                        
                     , and 
                        
                           
                              
                                 k
                              
                              
                                 ′
                              
                           
                        
                      is the largest number that satisfies 
                        
                           
                              
                                 w
                              
                              
                                 
                                    
                                       k
                                    
                                    
                                       ′
                                    
                                 
                                 ,
                                 η
                              
                              
                                 d
                              
                           
                           =
                           min
                           (
                           
                              
                                 q
                              
                              
                                 η
                              
                              
                                 k
                              
                           
                           ,
                           
                              
                                 w
                              
                              
                                 ‖
                                 U
                                 ‖
                                 ,
                                 η
                              
                              
                                 d
                              
                           
                           )
                        
                     , we clearly have 
                        
                           
                              
                                 k
                              
                              
                                 ′
                              
                           
                           ⩾
                           k
                        
                     . Therefore, after the substitution, the online revenue for row k in 
                        
                           
                              
                                 d
                              
                              
                                 ′
                              
                           
                        
                      is the same as that for row 
                        
                           
                              
                                 k
                              
                              
                                 ′
                              
                           
                        
                      in d, while row 
                        
                           
                              
                                 k
                              
                              
                                 ′
                              
                           
                        
                      has a higher ex-post revenue than row k. So the regret in row k for 
                        
                           
                              
                                 d
                              
                              
                                 ′
                              
                           
                        
                      is better than that in row 
                        
                           
                              
                                 k
                              
                              
                                 ′
                              
                           
                        
                      for d, thus the worst case regret for 
                        
                           
                              
                                 d
                              
                              
                                 ′
                              
                           
                        
                      is better than for d. This operation shall be applied iteratively as follows. It is first applied for 
                        
                           η
                           =
                           1
                        
                      on the initial policy 
                        
                           d
                           (
                           0
                           )
                        
                     , resulting in policy 
                        
                           d
                           (
                           1
                           )
                        
                     , then for 
                        
                           η
                           =
                           2
                        
                      on the resultant policy 
                        
                           d
                           (
                           1
                           )
                        
                     , and so on, until 
                        
                           η
                           =
                           m
                        
                     , producing 
                        
                           d
                           (
                           m
                           )
                        
                     , which is clearly better than 
                        
                           d
                           (
                           0
                           )
                        
                     . At the end of this iterative process the policy 
                        
                           d
                           (
                           m
                           )
                        
                      is called a regulated policy. Applying the same operations on a regulated policy does not change it (i.e. it is a fixed point).

This particular order of operations gives a very unique structure to a regulated policy. This is formally stated below.
                        Lemma 1
                        
                           For any 
                           
                              
                                 η
                                 ∈
                                 [
                                 1
                                 ,
                                 m
                                 ]
                              
                           
                           , a regulated policy d satisfies 
                           
                              
                                 
                                    
                                       w
                                    
                                    
                                       k
                                    
                                    
                                       d
                                    
                                 
                                 =
                                 
                                    
                                       w
                                    
                                    
                                       k
                                       (
                                       η
                                       -
                                       1
                                       )
                                    
                                    
                                       d
                                    
                                 
                                 ,
                                 ∀
                                 k
                                 :
                                 
                                    
                                       k
                                    
                                    
                                       ˆ
                                    
                                 
                                 <
                                 k
                                 ⩽
                                 k
                                 (
                                 η
                                 -
                                 1
                                 )
                              
                           
                           , where 
                           
                              
                                 
                                    
                                       k
                                    
                                    
                                       ˆ
                                    
                                 
                                 =
                                 max
                                 {
                                 k
                                 ⩽
                                 k
                                 (
                                 η
                                 -
                                 1
                                 )
                                 :
                                 
                                    
                                       w
                                    
                                    
                                       ‖
                                       U
                                       ‖
                                       ,
                                       η
                                       (
                                       k
                                       )
                                    
                                    
                                       d
                                    
                                 
                                 >
                                 
                                    
                                       q
                                    
                                    
                                       η
                                       (
                                       k
                                       )
                                    
                                    
                                       k
                                    
                                 
                                 }
                              
                            
                           if it exists, or 
                           
                              
                                 
                                    
                                       k
                                    
                                    
                                       ˆ
                                    
                                 
                                 =
                                 ‖
                                 L
                                 ‖
                                 -
                                 1
                              
                           
                           .
                        

We consider the first case with 
                              
                                 
                                    
                                       w
                                    
                                    
                                       ‖
                                       U
                                       ‖
                                       ,
                                       η
                                    
                                    
                                       d
                                    
                                 
                                 >
                                 
                                    
                                       L
                                    
                                    
                                       η
                                    
                                 
                              
                           . We must have 
                              
                                 
                                    
                                       k
                                    
                                    
                                       ˆ
                                    
                                 
                                 ⩾
                                 k
                                 (
                                 η
                                 )
                              
                           , as 
                              
                                 
                                    
                                       q
                                    
                                    
                                       η
                                    
                                    
                                       k
                                       (
                                       η
                                       )
                                    
                                 
                                 =
                                 
                                    
                                       L
                                    
                                    
                                       η
                                    
                                 
                              
                           . Thus 
                              
                                 ∀
                                 k
                                 :
                                 
                                    
                                       k
                                    
                                    
                                       ˆ
                                    
                                 
                                 <
                                 k
                                 ⩽
                                 k
                                 (
                                 η
                                 -
                                 1
                                 )
                              
                            we have 
                              
                                 η
                                 (
                                 k
                                 )
                                 =
                                 η
                              
                            and 
                              
                                 
                                    
                                       w
                                    
                                    
                                       ‖
                                       U
                                       ‖
                                       ,
                                       η
                                    
                                    
                                       d
                                    
                                 
                                 ⩽
                                 
                                    
                                       q
                                    
                                    
                                       η
                                    
                                    
                                       k
                                    
                                 
                              
                           . So in iteration η of applying the regulating operations, we have 
                              
                                 
                                    
                                       k
                                    
                                    
                                       η
                                    
                                    
                                       d
                                    
                                 
                                 (
                                 min
                                 (
                                 
                                    
                                       q
                                    
                                    
                                       η
                                    
                                    
                                       k
                                    
                                 
                                 ,
                                 
                                    
                                       w
                                    
                                    
                                       ‖
                                       U
                                       ‖
                                       ,
                                       η
                                    
                                    
                                       d
                                    
                                 
                                 )
                                 )
                                 =
                                 k
                                 (
                                 η
                                 -
                                 1
                                 )
                              
                           , which agrees with the Lemma in question.

Now we consider the second case 
                              
                                 
                                    
                                       w
                                    
                                    
                                       ‖
                                       U
                                       ‖
                                       ,
                                       η
                                    
                                    
                                       d
                                    
                                 
                                 ⩽
                                 
                                    
                                       L
                                    
                                    
                                       η
                                    
                                 
                              
                           . As 
                              
                                 
                                    
                                       L
                                    
                                    
                                       η
                                    
                                 
                                 ⩽
                                 
                                    
                                       q
                                    
                                    
                                       η
                                    
                                    
                                       k
                                    
                                 
                                 ,
                                 ∀
                                 k
                                 ∈
                                 [
                                 k
                                 (
                                 η
                                 )
                                 ,
                                 k
                                 (
                                 η
                                 -
                                 1
                                 )
                                 ]
                              
                           , we have 
                              
                                 min
                                 (
                                 
                                    
                                       q
                                    
                                    
                                       η
                                    
                                    
                                       k
                                    
                                 
                                 ,
                                 
                                    
                                       w
                                    
                                    
                                       ‖
                                       U
                                       ‖
                                       ,
                                       η
                                    
                                    
                                       d
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       w
                                    
                                    
                                       ‖
                                       U
                                       ‖
                                       ,
                                       η
                                    
                                    
                                       d
                                    
                                 
                                 ,
                                 ∀
                                 k
                                 ∈
                                 [
                                 k
                                 (
                                 η
                                 )
                                 ,
                                 k
                                 (
                                 η
                                 -
                                 1
                                 )
                                 ]
                              
                           . So row 
                              
                                 
                                    
                                       w
                                    
                                    
                                       k
                                       (
                                       η
                                       -
                                       1
                                       )
                                    
                                    
                                       d
                                    
                                 
                              
                            is copied to all the other rows in iteration η, including row 
                              
                                 
                                    
                                       w
                                    
                                    
                                       k
                                       (
                                       η
                                       )
                                    
                                    
                                       d
                                    
                                 
                              
                           , and note that 
                              
                                 
                                    
                                       w
                                    
                                    
                                       ‖
                                       U
                                       ‖
                                       ,
                                       η
                                       (
                                       k
                                       )
                                    
                                    
                                       d
                                    
                                 
                                 ⩽
                                 
                                    
                                       q
                                    
                                    
                                       η
                                    
                                    
                                       k
                                    
                                 
                                 (
                                 k
                                 )
                                 ,
                                 ∀
                                 k
                                 :
                                 k
                                 (
                                 η
                                 )
                                 ⩽
                                 k
                                 ⩽
                                 k
                                 (
                                 η
                                 -
                                 1
                                 )
                              
                           . And this monotonic copying of row 
                              
                                 
                                    
                                       w
                                    
                                    
                                       k
                                       (
                                       η
                                       -
                                       1
                                       )
                                    
                                    
                                       d
                                    
                                 
                              
                            continues in all the subsequent iterations until 
                              
                                 
                                    
                                       w
                                    
                                    
                                       ‖
                                       U
                                       ‖
                                       ,
                                       
                                          
                                             η
                                          
                                          
                                             ′
                                          
                                       
                                    
                                    
                                       d
                                    
                                 
                                 >
                                 
                                    
                                       L
                                    
                                    
                                       
                                          
                                             η
                                          
                                          
                                             ′
                                          
                                       
                                    
                                 
                              
                            for some 
                              
                                 
                                    
                                       η
                                    
                                    
                                       ′
                                    
                                 
                              
                           , which brings us to the first case. So the monotonic copying behavior stops as soon as 
                              
                                 
                                    
                                       w
                                    
                                    
                                       ‖
                                       U
                                       ‖
                                       ,
                                       η
                                       (
                                       k
                                       )
                                    
                                    
                                       d
                                    
                                 
                                 >
                                 
                                    
                                       q
                                    
                                    
                                       η
                                       (
                                       k
                                       )
                                    
                                    
                                       k
                                    
                                 
                              
                            becomes true as k gradually decreases from 
                              
                                 k
                                 (
                                 η
                                 -
                                 1
                                 )
                              
                           .□

A policy d is lower bound aware (LBA) if d is regulated and 
                              
                                 
                                    
                                       w
                                    
                                    
                                       ‖
                                       U
                                       ‖
                                       ,
                                       i
                                    
                                    
                                       d
                                    
                                 
                                 >
                                 0
                              
                            implies 
                              
                                 
                                    
                                       w
                                    
                                    
                                       ‖
                                       U
                                       ‖
                                       ,
                                       j
                                    
                                    
                                       d
                                    
                                 
                                 ⩾
                                 
                                    
                                       L
                                    
                                    
                                       j
                                    
                                 
                                 ,
                                 ∀
                                 j
                                 <
                                 i
                              
                           .

Given a regulated policy that is not LBA, we show how to gradually modify it to become a LBA without worsening the regret. Let 
                        
                           u
                           (
                           d
                           )
                           =
                           max
                           {
                           i
                           :
                           
                              
                                 w
                              
                              
                                 ‖
                                 U
                                 ‖
                                 ,
                                 i
                              
                              
                                 d
                              
                           
                           >
                           0
                           }
                        
                      (note 
                        
                           k
                           (
                           0
                           )
                           =
                           ‖
                           U
                           ‖
                        
                     ), if d is not LBA then there is a 
                        
                           j
                           <
                           u
                           (
                           d
                           )
                        
                      such that 
                        
                           
                              
                                 w
                              
                              
                                 ‖
                                 U
                                 ‖
                                 ,
                                 j
                              
                              
                                 d
                              
                           
                           <
                           
                              
                                 L
                              
                              
                                 j
                              
                           
                        
                     . Let 
                        
                           
                              
                                 η
                              
                              
                                 ˆ
                              
                           
                           =
                           max
                           {
                           i
                           <
                           u
                           (
                           d
                           )
                           :
                           
                              
                                 w
                              
                              
                                 ‖
                                 U
                                 ‖
                                 ,
                                 i
                              
                              
                                 d
                              
                           
                           <
                           
                              
                                 L
                              
                              
                                 i
                              
                           
                           }
                        
                      and 
                        
                           
                              
                                 η
                              
                              
                                 ¯
                              
                           
                           =
                           min
                           {
                           i
                           >
                           
                              
                                 η
                              
                              
                                 ˆ
                              
                           
                           :
                           
                              
                                 w
                              
                              
                                 ‖
                                 U
                                 ‖
                                 ,
                                 i
                              
                              
                                 d
                              
                           
                           >
                           
                              
                                 L
                              
                              
                                 i
                              
                           
                           or
                           i
                           =
                           u
                           (
                           d
                           )
                           }
                        
                     . Note that for all i such that 
                        
                           
                              
                                 η
                              
                              
                                 ˆ
                              
                           
                           <
                           i
                           <
                           
                              
                                 η
                              
                              
                                 ¯
                              
                           
                        
                      we must have 
                        
                           
                              
                                 w
                              
                              
                                 ‖
                                 U
                                 ‖
                                 ,
                                 i
                              
                              
                                 d
                              
                           
                           =
                           
                              
                                 L
                              
                              
                                 i
                              
                           
                        
                      by reason of the way we found 
                        
                           
                              
                                 η
                              
                              
                                 ˆ
                              
                           
                        
                      and 
                        
                           
                              
                                 η
                              
                              
                                 ¯
                              
                           
                        
                     . Because of the monotonic copying behavior, we note that 
                        
                           
                              
                                 w
                              
                              
                                 k
                                 (
                                 
                                    
                                       η
                                    
                                    
                                       ˆ
                                    
                                 
                                 -
                                 1
                                 )
                              
                              
                                 d
                              
                           
                        
                      should have been copied to all rows from row 
                        
                           k
                           (
                           
                              
                                 η
                              
                              
                                 ˆ
                              
                           
                           -
                           1
                           )
                        
                      down to row 
                        
                           
                              
                                 k
                              
                              
                                 ˆ
                              
                           
                        
                     , as given in Lemma 1. Now we make adjustments to 
                        
                           
                              
                                 w
                              
                              
                                 d
                              
                           
                        
                      to obtain another deterministic policy 
                        
                           
                              
                                 d
                              
                              
                                 ′
                              
                           
                        
                     , such that
                        
                           
                              
                                 
                                    w
                                 
                                 
                                    ‖
                                    U
                                    ‖
                                 
                                 
                                    
                                       
                                          d
                                       
                                       
                                          ′
                                       
                                    
                                 
                              
                              =
                              
                                 
                                    w
                                 
                                 
                                    ‖
                                    U
                                    ‖
                                 
                                 
                                    d
                                 
                              
                              +
                              
                                 
                                    e
                                 
                                 
                                    
                                       
                                          η
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                              
                              -
                              
                                 
                                    e
                                 
                                 
                                    
                                       
                                          η
                                       
                                       
                                          ¯
                                       
                                    
                                 
                              
                              .
                           
                        
                     Considering (16), we see that for all 
                        
                           k
                           :
                           ‖
                           U
                           ‖
                           ⩾
                           k
                           ⩾
                           k
                           (
                           
                              
                                 η
                              
                              
                                 ˆ
                              
                           
                           -
                           1
                           )
                        
                     , we must have 
                        
                           
                              
                                 w
                              
                              
                                 k
                              
                              
                                 
                                    
                                       d
                                    
                                    
                                       ′
                                    
                                 
                              
                           
                           =
                           
                              
                                 w
                              
                              
                                 k
                              
                              
                                 d
                              
                           
                           +
                           
                              
                                 e
                              
                              
                                 
                                    
                                       η
                                    
                                    
                                       ˆ
                                    
                                 
                              
                           
                           -
                           
                              
                                 e
                              
                              
                                 
                                    
                                       η
                                    
                                    
                                       ¯
                                    
                                 
                              
                           
                        
                     . And by Lemma 1, for 
                        
                           k
                           :
                           k
                           (
                           
                              
                                 η
                              
                              
                                 ˆ
                              
                           
                           -
                           1
                           )
                           ⩾
                           k
                           ⩾
                           
                              
                                 k
                              
                              
                                 ˆ
                              
                           
                        
                      we still have 
                        
                           
                              
                                 w
                              
                              
                                 k
                              
                              
                                 
                                    
                                       d
                                    
                                    
                                       ′
                                    
                                 
                              
                           
                           =
                           
                              
                                 w
                              
                              
                                 k
                              
                              
                                 d
                              
                           
                           +
                           
                              
                                 e
                              
                              
                                 
                                    
                                       η
                                    
                                    
                                       ˆ
                                    
                                 
                              
                           
                           -
                           
                              
                                 e
                              
                              
                                 
                                    
                                       η
                                    
                                    
                                       ¯
                                    
                                 
                              
                           
                        
                     . As for 
                        
                           k
                           <
                           
                              
                                 k
                              
                              
                                 ˆ
                              
                           
                        
                     , we simply let 
                        
                           
                              
                                 w
                              
                              
                                 k
                              
                              
                                 
                                    
                                       d
                                    
                                    
                                       ′
                                    
                                 
                              
                           
                           =
                           
                              
                                 w
                              
                              
                                 k
                              
                              
                                 d
                              
                           
                        
                     , completing our definition of 
                        
                           
                              
                                 w
                              
                              
                                 
                                    
                                       d
                                    
                                    
                                       ′
                                    
                                 
                              
                           
                        
                     . We leave it to the reader to verify that 
                        
                           
                              
                                 w
                              
                              
                                 
                                    
                                       d
                                    
                                    
                                       ′
                                    
                                 
                              
                           
                        
                      indeed gives an online deterministic policy 
                        
                           
                              
                                 d
                              
                              
                                 ′
                              
                           
                        
                     . Note that all the changed rows substituted a higher-fare request for a lower-fare one, so the online revenue increases and the modified policy 
                        
                           
                              
                                 d
                              
                              
                                 ′
                              
                           
                        
                      cannot be worse. We may need to apply the regulating operations on 
                        
                           
                              
                                 d
                              
                              
                                 ′
                              
                           
                        
                     , which of course will never change row 
                        
                           
                              
                                 w
                              
                              
                                 ‖
                                 U
                                 ‖
                              
                              
                                 
                                    
                                       d
                                    
                                    
                                       ′
                                    
                                 
                              
                           
                        
                     . Such modifications can be repeated for a finite number of times until a LBA policy is obtained, and we conclude with this proposition:
                        Proposition 2
                        
                           Any deterministic online policy is improved by a LBA one.
                        

Note that a nested policy x is a deterministic online policy, and clearly we have 
                        
                           
                              
                                 w
                              
                              
                                 ‖
                                 U
                                 ‖
                                 ,
                                 i
                              
                              
                                 x
                              
                           
                           =
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                        
                      for all 
                        
                           i
                           ∈
                           [
                           1
                           :
                           m
                           ]
                        
                     . The discussion for Proposition 2 also applies to nested policies, and we have
                        Corollary 1
                        
                           Any nested policy is improved by a LBA one.
                        

So far we only know that 
                        
                           
                              
                                 w
                              
                              
                                 k
                                 ,
                                 i
                              
                              
                                 d
                              
                           
                           ⩽
                           
                              
                                 L
                              
                              
                                 i
                              
                           
                        
                      for 
                        
                           i
                           <
                           η
                           (
                           k
                           )
                        
                      by (13) and (14). We need to know more about 
                        
                           
                              
                                 w
                              
                              
                                 k
                                 ,
                                 i
                              
                              
                                 d
                              
                           
                        
                      to prove the optimality of nested policies. We further consider policies that would never accept a request unless the additional expected denial cost is less than its expected revenue when 
                        
                           v
                           (
                           ·
                           )
                        
                      is component-wise convex. We first define light loaded policies:
                        Definition 3
                        A policy d is light loaded if it is LBA and 
                              
                                 
                                    
                                       Δ
                                    
                                    
                                       η
                                    
                                 
                                 v
                                 (
                                 
                                    
                                       w
                                    
                                    
                                       ̃
                                    
                                 
                                 (
                                 η
                                 )
                                 )
                                 <
                                 
                                    
                                       f
                                    
                                    
                                       η
                                    
                                    
                                       ′
                                    
                                 
                              
                            for 
                              
                                 η
                                 ⩽
                                 u
                                 (
                                 d
                                 )
                              
                           , where
                              
                                 
                                    
                                       
                                          w
                                       
                                       
                                          ̃
                                       
                                    
                                    
                                       
                                          (
                                          η
                                          )
                                       
                                       
                                          i
                                       
                                    
                                    =
                                    
                                       
                                          
                                             
                                                
                                                   
                                                      
                                                         
                                                            w
                                                         
                                                         
                                                            ‖
                                                            U
                                                            ‖
                                                            i
                                                         
                                                         
                                                            d
                                                         
                                                      
                                                   
                                                   
                                                      if
                                                      
                                                      i
                                                      ⩾
                                                      η
                                                      ;
                                                   
                                                
                                                
                                                   
                                                      
                                                         
                                                            L
                                                         
                                                         
                                                            i
                                                         
                                                      
                                                   
                                                   
                                                      if
                                                      
                                                      i
                                                      <
                                                      η
                                                      .
                                                   
                                                
                                             
                                          
                                       
                                    
                                 
                              
                           
                        

If a LBA policy d is not light loaded, let 
                        
                           
                              
                                 η
                              
                              
                                 ¯
                              
                           
                           =
                           max
                           {
                           η
                           ⩽
                           u
                           (
                           d
                           )
                           :
                           
                              
                                 Δ
                              
                              
                                 η
                              
                           
                           v
                           (
                           
                              
                                 w
                              
                              
                                 ̃
                              
                           
                           (
                           η
                           )
                           )
                           ⩾
                           
                              
                                 f
                              
                              
                                 η
                              
                              
                                 ′
                              
                           
                           }
                        
                     . If 
                        
                           
                              
                                 η
                              
                              
                                 ¯
                              
                           
                           <
                           u
                           (
                           d
                           )
                        
                      and 
                        
                           
                              
                                 w
                              
                              
                                 ‖
                                 U
                                 ‖
                                 
                                    
                                       η
                                    
                                    
                                       ¯
                                    
                                 
                              
                              
                                 d
                              
                           
                           =
                           
                              
                                 L
                              
                              
                                 
                                    
                                       η
                                    
                                    
                                       ¯
                                    
                                 
                              
                           
                        
                      then 
                        
                           
                              
                                 η
                              
                              
                                 ¯
                              
                           
                           +
                           1
                           ⩽
                           u
                           (
                           d
                           )
                        
                      and 
                        
                           
                              
                                 w
                              
                              
                                 ̃
                              
                           
                           (
                           
                              
                                 η
                              
                              
                                 ¯
                              
                           
                           )
                           =
                           
                              
                                 w
                              
                              
                                 ̃
                              
                           
                           (
                           η
                           +
                           1
                           )
                        
                     . And we further have 
                        
                           
                              
                                 Δ
                              
                              
                                 η
                                 +
                                 1
                              
                           
                           v
                           (
                           
                              
                                 w
                              
                              
                                 ̃
                              
                           
                           (
                           η
                           +
                           1
                           )
                           )
                           ⩾
                           
                              
                                 Δ
                              
                              
                                 η
                              
                           
                           v
                           (
                           
                              
                                 w
                              
                              
                                 ̃
                              
                           
                           (
                           η
                           )
                           )
                           ⩾
                           
                              
                                 f
                              
                              
                                 η
                              
                              
                                 ′
                              
                           
                           ⩾
                           
                              
                                 f
                              
                              
                                 η
                                 +
                                 1
                              
                              
                                 ′
                              
                           
                           }
                        
                     , which contradicts the definition of 
                        
                           
                              
                                 η
                              
                              
                                 ¯
                              
                           
                        
                     . So we have either 
                        
                           
                              
                                 w
                              
                              
                                 ‖
                                 U
                                 ‖
                                 
                                    
                                       η
                                    
                                    
                                       ¯
                                    
                                 
                              
                              
                                 d
                              
                           
                           >
                           
                              
                                 L
                              
                              
                                 
                                    
                                       η
                                    
                                    
                                       ¯
                                    
                                 
                              
                           
                        
                     , or 
                        
                           
                              
                                 η
                              
                              
                                 ¯
                              
                           
                           =
                           u
                           (
                           d
                           )
                        
                     , but not both. In either case we may reduce 
                        
                           
                              
                                 w
                              
                              
                                 k
                                 
                                    
                                       η
                                    
                                    
                                       ¯
                                    
                                 
                              
                              
                                 d
                              
                           
                        
                      by one for all 
                        
                           k
                           ∈
                           [
                           
                              
                                 k
                              
                              
                                 ˆ
                              
                           
                           :
                           ‖
                           U
                           ‖
                           ]
                        
                     , where 
                        
                           
                              
                                 k
                              
                              
                                 ˆ
                              
                           
                        
                      is the same as defined in Lemma 1. This reduction is compensated by increasing another component 
                        
                           
                              
                                 η
                              
                              
                                 ˆ
                              
                           
                           =
                           min
                           {
                           η
                           <
                           
                              
                                 η
                              
                              
                                 ¯
                              
                           
                           :
                           
                              
                                 w
                              
                              
                                 k
                                 η
                              
                              
                                 d
                              
                           
                           <
                           
                              
                                 L
                              
                              
                                 i
                              
                           
                           }
                        
                      by one in the same rows when such an 
                        
                           
                              
                                 η
                              
                              
                                 ˆ
                              
                           
                        
                      exists. With the compensation in 
                        
                           
                              
                                 η
                              
                              
                                 ˆ
                              
                           
                        
                     , clearly that row improves in the expected revenue by 
                        
                           
                              
                                 f
                              
                              
                                 η
                              
                              
                                 ′
                              
                           
                           -
                           
                              
                                 f
                              
                              
                                 
                                    
                                       η
                                    
                                    
                                       ¯
                                    
                                 
                              
                              
                                 ′
                              
                           
                           >
                           0
                        
                     , as the total expected penalty cost remains unchanged by (4). Without the compensation the total number of accepted requests in that row is at least 
                        
                           ‖
                           
                              
                                 w
                              
                              
                                 ̃
                              
                           
                           (
                           
                              
                                 η
                              
                              
                                 ¯
                              
                           
                           )
                           ‖
                        
                      before the reduction. As 
                        
                           v
                           (
                           ·
                           )
                        
                      is component-wise convex, the expected penalty cost is reduced by at least 
                        
                           
                              
                                 Δ
                              
                              
                                 
                                    
                                       η
                                    
                                    
                                       ¯
                                    
                                 
                              
                           
                           v
                           (
                           
                              
                                 w
                              
                              
                                 ̃
                              
                           
                           (
                           
                              
                                 η
                              
                              
                                 ¯
                              
                           
                           )
                           )
                        
                      due to the reduction in 
                        
                           
                              
                                 w
                              
                              
                                 k
                                 
                                    
                                       η
                                    
                                    
                                       ¯
                                    
                                 
                              
                              
                                 d
                              
                           
                        
                     . Therefore the net change in the expected revenue is 
                        
                           
                              
                                 Δ
                              
                              
                                 
                                    
                                       η
                                    
                                    
                                       ¯
                                    
                                 
                              
                           
                           v
                           (
                           
                              
                                 w
                              
                              
                                 ̃
                              
                           
                           (
                           
                              
                                 η
                              
                              
                                 ¯
                              
                           
                           )
                           )
                           -
                           
                              
                                 f
                              
                              
                                 
                                    
                                       η
                                    
                                    
                                       ¯
                                    
                                 
                              
                              
                                 ′
                              
                           
                           ⩾
                           0
                        
                     . So this adjustment results in a new policy 
                        
                           
                              
                                 d
                              
                              
                                 ′
                              
                           
                        
                      that improves the original policy d, and 
                        
                           
                              
                                 d
                              
                              
                                 ′
                              
                           
                        
                      (after possible regulation) is still LBA. This adjustment procedure can be repeated for a finite number of times until 
                        
                           
                              
                                 d
                              
                              
                                 ′
                              
                           
                        
                      becomes light loaded. As the same procedure can be carried out on nested policies as well, we conclude with a proposition and a corollary:
                        Proposition 3
                        
                           Any deterministic online policy is improved by a light loaded one if 
                           
                              
                                 v
                                 (
                                 ·
                                 )
                              
                            
                           is convex.
                        


                           Any nested policy is dominated by a light loaded one.
                        

For a light loaded deterministic online policy d, if 
                        
                           
                              
                                 w
                              
                              
                                 k
                                 η
                              
                              
                                 d
                              
                           
                           <
                           
                              
                                 L
                              
                              
                                 η
                              
                           
                        
                      and 
                        
                           η
                           <
                           η
                           (
                           k
                           )
                           ⩽
                           u
                           (
                           d
                           )
                        
                     , increasing 
                        
                           
                              
                                 w
                              
                              
                                 k
                                 η
                              
                              
                                 d
                              
                           
                        
                      by one always improves the expected revenue by at least 
                        
                           
                              
                                 f
                              
                              
                                 η
                              
                              
                                 ′
                              
                           
                           -
                           
                              
                                 Δ
                              
                              
                                 η
                              
                           
                           v
                           (
                           
                              
                                 
                                    
                                       w
                                    
                                    
                                       ̃
                                    
                                 
                              
                              
                                 ‖
                                 U
                                 ‖
                              
                              
                                 d
                              
                           
                           (
                           η
                           (
                           k
                           )
                           )
                           )
                        
                     , as 
                        
                           
                              
                                 
                                    
                                       w
                                    
                                    
                                       ̃
                                    
                                 
                              
                              
                                 ‖
                                 U
                                 ‖
                              
                              
                                 d
                              
                           
                           (
                           η
                           (
                           k
                           )
                           )
                           >
                           
                              
                                 w
                              
                              
                                 k
                              
                              
                                 d
                              
                           
                        
                     . Therefore we can set all such 
                        
                           
                              
                                 w
                              
                              
                                 k
                                 η
                              
                              
                                 d
                              
                           
                        
                      to 
                        
                           
                              
                                 L
                              
                              
                                 η
                              
                           
                        
                      and we end up with a booking profile matrix that conforms to a nested policy x defined as 
                        
                           x
                           =
                           
                              
                                 w
                              
                              
                                 ‖
                                 U
                                 ‖
                              
                              
                                 d
                              
                           
                        
                     . This proves the optimality of nested policies. By the definition of a light loaded policy, we note that 
                        
                           R
                           (
                           
                              
                                 w
                              
                              
                                 k
                              
                              
                                 x
                              
                           
                           )
                        
                      never decreases in k for a light loaded nested policy x, which completes our proof of Theorem 2.

The analysis so far applies to both the CR and the MAR problem, but the results in this section applies only to the MAR problem. We show that we can further eliminate some of the lean inputs, leaving only 
                        
                           m
                           +
                           1
                        
                      (m is the number of fare classes) of them. These inputs have very special profiles, and we call them extreme inputs and extreme profiles.
                        Definition 4
                        Extreme Profile


                        A profile q is called extreme if there exists an 
                              
                                 η
                                 ∈
                                 [
                                 0
                                 ,
                                 m
                                 ]
                              
                           , such that 
                              
                                 
                                    
                                       q
                                    
                                    
                                       j
                                    
                                 
                                 =
                                 
                                    
                                       L
                                    
                                    
                                       j
                                    
                                 
                                 ,
                                 1
                                 ⩽
                                 j
                                 ⩽
                                 η
                              
                           , and 
                              
                                 
                                    
                                       q
                                    
                                    
                                       j
                                    
                                 
                                 =
                                 
                                    
                                       U
                                    
                                    
                                       j
                                    
                                 
                                 ,
                                 m
                                 ⩾
                                 j
                                 >
                                 η
                              
                           .

In fact, we can explicitly identify those extreme profiles among the lean profiles: the extreme profiles are 
                        
                           
                              
                                 q
                              
                              
                                 k
                                 (
                                 η
                                 )
                              
                           
                        
                     . We show that for any lean input there is an extreme input with worse performance.

We look into the incremental change of 
                        
                           R
                           (
                           
                              
                                 
                                    
                                       q
                                    
                                    
                                       ˇ
                                    
                                 
                              
                              
                                 k
                              
                           
                           ;
                           x
                           )
                        
                      in k. Let 
                        
                           Δ
                           
                              
                                 R
                              
                              
                                 k
                              
                              
                                 x
                              
                           
                           =
                           R
                           (
                           
                              
                                 
                                    
                                       q
                                    
                                    
                                       ˇ
                                    
                                 
                              
                              
                                 k
                              
                           
                           ;
                           x
                           )
                           -
                           R
                           (
                           
                              
                                 
                                    
                                       q
                                    
                                    
                                       ˇ
                                    
                                 
                              
                              
                                 k
                                 -
                                 1
                              
                           
                           ;
                           x
                           )
                        
                     . Recall that 
                        
                           η
                           (
                           k
                           )
                        
                      is the class of additional fare requests such that when it is added to 
                        
                           
                              
                                 q
                              
                              
                                 k
                                 -
                                 1
                              
                           
                        
                     , we obtain 
                        
                           
                              
                                 q
                              
                              
                                 k
                              
                           
                        
                     : 
                        
                           
                              
                                 q
                              
                              
                                 k
                              
                           
                           =
                           
                              
                                 q
                              
                              
                                 k
                                 -
                                 1
                              
                           
                           +
                           
                              
                                 e
                              
                              
                                 η
                                 (
                                 k
                                 )
                              
                           
                        
                     . Since x is a nested policy, this additional request of 
                        
                           
                              
                                 e
                              
                              
                                 η
                                 (
                                 k
                                 )
                              
                           
                        
                      is either accepted or rejected, without affecting the decisions on all other requests. If it is accepted, that is, 
                        
                           
                              
                                 w
                              
                              
                                 k
                              
                              
                                 x
                              
                           
                           =
                           
                              
                                 w
                              
                              
                                 k
                                 -
                                 1
                              
                              
                                 x
                              
                           
                           +
                           
                              
                                 e
                              
                              
                                 η
                                 (
                                 k
                                 )
                              
                           
                        
                     , we would expect an increase of 
                        
                           
                              
                                 f
                              
                              
                                 η
                                 (
                                 k
                                 )
                              
                              
                                 ′
                              
                           
                        
                      in revenue, and an increase of 
                        
                           
                              
                                 Δ
                              
                              
                                 η
                                 (
                                 k
                                 )
                              
                           
                           v
                           (
                           
                              
                                 w
                              
                              
                                 k
                              
                              
                                 x
                              
                           
                           )
                        
                      in the expected denial cost. Otherwise, there is no change in the expected revenue. Therefore the net revenue change is
                        
                           (C.1)
                           
                              Δ
                              
                                 
                                    R
                                 
                                 
                                    k
                                 
                                 
                                    x
                                 
                              
                              =
                              1
                              {
                              
                                 
                                    w
                                 
                                 
                                    k
                                 
                                 
                                    x
                                 
                              
                              >
                              
                                 
                                    w
                                 
                                 
                                    k
                                    -
                                    1
                                 
                                 
                                    x
                                 
                              
                              }
                              
                                 
                                    
                                       
                                          
                                             f
                                          
                                          
                                             η
                                             (
                                             k
                                             )
                                          
                                          
                                             ′
                                          
                                       
                                       -
                                       
                                          
                                             Δ
                                          
                                          
                                             η
                                             (
                                             k
                                             )
                                          
                                       
                                       v
                                       (
                                       
                                          
                                             w
                                          
                                          
                                             k
                                          
                                          
                                             x
                                          
                                       
                                       )
                                    
                                 
                              
                              .
                           
                        
                     
                  

We also look at incremental changes in the ex-post optimal revenues. Let 
                        
                           
                              
                                 w
                              
                              
                                 k
                              
                              
                                 ∗
                              
                           
                           =
                           
                              
                                 w
                              
                              
                                 ∗
                              
                           
                           (
                           
                              
                                 
                                    
                                       q
                                    
                                    
                                       ˇ
                                    
                                 
                              
                              
                                 k
                              
                           
                           )
                        
                      and 
                        
                           
                              
                                 s
                              
                              
                                 k
                              
                              
                                 ∗
                              
                           
                           =
                           ‖
                           
                              
                                 w
                              
                              
                                 k
                              
                              
                                 ∗
                              
                           
                           ‖
                        
                     . Let 
                        
                           Δ
                           
                              
                                 R
                              
                              
                                 k
                              
                              
                                 ∗
                              
                           
                           =
                           
                              
                                 R
                              
                              
                                 ∗
                              
                           
                           (
                           
                              
                                 
                                    
                                       q
                                    
                                    
                                       ˇ
                                    
                                 
                              
                              
                                 k
                              
                           
                           )
                           -
                           
                              
                                 R
                              
                              
                                 ∗
                              
                           
                           (
                           
                              
                                 
                                    
                                       q
                                    
                                    
                                       ˇ
                                    
                                 
                              
                              
                                 k
                                 -
                                 1
                              
                           
                           )
                        
                     . We first present the following monotonicity result:
                        Proposition 4
                        
                           For a LBA nested policy x, if 
                           
                              
                                 Δ
                                 
                                    
                                       R
                                    
                                    
                                       k
                                    
                                    
                                       ∗
                                    
                                 
                                 >
                                 Δ
                                 
                                    
                                       R
                                    
                                    
                                       k
                                    
                                    
                                       x
                                    
                                 
                                 >
                                 0
                              
                            
                           then we have 
                           
                              
                                 Δ
                                 
                                    
                                       R
                                    
                                    
                                       k
                                       +
                                       t
                                    
                                    
                                       ∗
                                    
                                 
                                 ⩾
                                 Δ
                                 
                                    
                                       R
                                    
                                    
                                       k
                                       +
                                       t
                                       -
                                       1
                                    
                                    
                                       x
                                    
                                 
                              
                            
                           for all 
                           
                              
                                 t
                                 >
                                 0
                              
                            
                           such that 
                           
                              
                                 η
                                 (
                                 k
                                 +
                                 t
                                 )
                                 =
                                 η
                                 (
                                 k
                                 )
                              
                           
                           .
                        

Clearly if 
                              
                                 Δ
                                 
                                    
                                       R
                                    
                                    
                                       k
                                       +
                                       t
                                       -
                                       1
                                    
                                    
                                       x
                                    
                                 
                                 ⩽
                                 0
                              
                           , the conclusion holds trivially as 
                              
                                 Δ
                                 
                                    
                                       R
                                    
                                    
                                       k
                                       +
                                       t
                                    
                                    
                                       ∗
                                    
                                 
                                 ⩾
                                 0
                              
                            always holds, so we only consider the case of 
                              
                                 Δ
                                 
                                    
                                       R
                                    
                                    
                                       k
                                       +
                                       t
                                       -
                                       1
                                    
                                    
                                       x
                                    
                                 
                                 >
                                 0
                              
                           .

We note that a simple way to find 
                              
                                 
                                    
                                       R
                                    
                                    
                                       ∗
                                    
                                 
                                 (
                                 
                                    
                                       
                                          
                                             q
                                          
                                          
                                             ˇ
                                          
                                       
                                    
                                    
                                       k
                                    
                                 
                                 )
                              
                            is to consider the requests in 
                              
                                 
                                    
                                       
                                          
                                             q
                                          
                                          
                                             ˇ
                                          
                                       
                                    
                                    
                                       k
                                    
                                 
                              
                            backwards. A request (suppose it is in class i) is accepted if and only if its expected revenue 
                              
                                 
                                    
                                       f
                                    
                                    
                                       i
                                    
                                    
                                       ′
                                    
                                 
                              
                            is greater than the additional denial cost caused by accepting it:
                              
                                 (C.2)
                                 
                                    
                                       
                                          f
                                       
                                       
                                          i
                                       
                                       
                                          ′
                                       
                                    
                                    >
                                    
                                       
                                          Δ
                                       
                                       
                                          i
                                       
                                    
                                    v
                                    (
                                    the booking position if accepted
                                    )
                                    .
                                 
                              
                           Let 
                              
                                 
                                    
                                       u
                                    
                                    
                                       ∗
                                    
                                    
                                       k
                                    
                                 
                                 =
                                 max
                                 {
                                 i
                                 :
                                 
                                    
                                       w
                                    
                                    
                                       ∗
                                       i
                                    
                                    
                                       k
                                    
                                 
                                 >
                                 0
                                 }
                              
                            be the class of the last accepted fare request, then we must have 
                              
                                 
                                    
                                       f
                                    
                                    
                                       
                                          
                                             u
                                          
                                          
                                             ∗
                                          
                                          
                                             k
                                          
                                       
                                    
                                    
                                       ′
                                    
                                 
                                 >
                                 Δ
                                 v
                                 (
                                 
                                    
                                       s
                                    
                                    
                                       k
                                    
                                    
                                       ∗
                                    
                                 
                                 )
                              
                           . To find 
                              
                                 Δ
                                 
                                    
                                       R
                                    
                                    
                                       k
                                    
                                    
                                       ∗
                                    
                                 
                              
                           , we consider the revenue impact of the additional class-
                              
                                 η
                                 (
                                 k
                                 )
                              
                            request in 
                              
                                 
                                    
                                       
                                          
                                             q
                                          
                                          
                                             ˇ
                                          
                                       
                                    
                                    
                                       k
                                    
                                 
                              
                            (as compared to 
                              
                                 
                                    
                                       
                                          
                                             q
                                          
                                          
                                             ˇ
                                          
                                       
                                    
                                    
                                       k
                                       -
                                       1
                                    
                                 
                              
                           ). Since 
                              
                                 Δ
                                 
                                    
                                       R
                                    
                                    
                                       k
                                    
                                    
                                       ∗
                                    
                                 
                                 >
                                 0
                              
                           , the additional request must have been accepted (so 
                              
                                 η
                                 (
                                 k
                                 )
                                 ⩽
                                 
                                    
                                       u
                                    
                                    
                                       ∗
                                    
                                    
                                       k
                                    
                                 
                              
                           ), otherwise the ex-post optimal revenue should remain the same.

If 
                              
                                 η
                                 (
                                 k
                                 )
                                 ⩾
                                 
                                    
                                       u
                                    
                                    
                                       ∗
                                    
                                    
                                       k
                                       -
                                       1
                                    
                                 
                              
                           , clearly all the bookings in 
                              
                                 
                                    
                                       w
                                    
                                    
                                       k
                                       -
                                       1
                                    
                                    
                                       ∗
                                    
                                 
                              
                            should remain accepted by reason of (C.2). Therefore we have 
                              
                                 
                                    
                                       w
                                    
                                    
                                       k
                                    
                                    
                                       ∗
                                    
                                 
                                 =
                                 
                                    
                                       w
                                    
                                    
                                       k
                                       -
                                       1
                                    
                                    
                                       ∗
                                    
                                 
                                 +
                                 
                                    
                                       e
                                    
                                    
                                       η
                                       (
                                       k
                                       )
                                    
                                 
                              
                           , and 
                              
                                 Δ
                                 
                                    
                                       R
                                    
                                    
                                       k
                                    
                                    
                                       ∗
                                    
                                 
                                 =
                                 
                                    
                                       f
                                    
                                    
                                       η
                                       (
                                       k
                                       )
                                    
                                    
                                       ′
                                    
                                 
                                 -
                                 
                                    
                                       Δ
                                    
                                    
                                       η
                                       (
                                       k
                                       )
                                    
                                 
                                 v
                                 (
                                 
                                    
                                       w
                                    
                                    
                                       k
                                    
                                    
                                       ∗
                                    
                                 
                                 )
                              
                           . By 
                              
                                 Δ
                                 
                                    
                                       R
                                    
                                    
                                       k
                                    
                                    
                                       x
                                    
                                 
                                 >
                                 0
                              
                            we know from (C.1) that 
                              
                                 
                                    
                                       w
                                    
                                    
                                       k
                                    
                                    
                                       x
                                    
                                 
                                 -
                                 
                                    
                                       w
                                    
                                    
                                       k
                                       -
                                       1
                                    
                                    
                                       x
                                    
                                 
                                 =
                                 
                                    
                                       e
                                    
                                    
                                       η
                                       (
                                       k
                                       )
                                    
                                 
                              
                            and 
                              
                                 Δ
                                 
                                    
                                       R
                                    
                                    
                                       k
                                    
                                    
                                       x
                                    
                                 
                                 =
                                 
                                    
                                       f
                                    
                                    
                                       η
                                       (
                                       k
                                       )
                                    
                                    
                                       ′
                                    
                                 
                                 -
                                 
                                    
                                       Δ
                                    
                                    
                                       η
                                       (
                                       k
                                       )
                                    
                                 
                                 v
                                 (
                                 
                                    
                                       w
                                    
                                    
                                       k
                                    
                                    
                                       x
                                    
                                 
                                 )
                              
                           . Therefore from 
                              
                                 Δ
                                 
                                    
                                       R
                                    
                                    
                                       k
                                    
                                    
                                       ∗
                                    
                                 
                                 >
                                 Δ
                                 
                                    
                                       R
                                    
                                    
                                       k
                                    
                                    
                                       x
                                    
                                 
                              
                            we have
                              
                                 (C.3)
                                 
                                    
                                       
                                          Δ
                                       
                                       
                                          η
                                          (
                                          k
                                          )
                                       
                                    
                                    v
                                    (
                                    
                                       
                                          w
                                       
                                       
                                          k
                                       
                                       
                                          ∗
                                       
                                    
                                    )
                                    <
                                    
                                       
                                          Δ
                                       
                                       
                                          η
                                          (
                                          k
                                          )
                                       
                                    
                                    v
                                    (
                                    
                                       
                                          w
                                       
                                       
                                          k
                                       
                                       
                                          x
                                       
                                    
                                    )
                                    .
                                 
                              
                           If 
                              
                                 η
                                 (
                                 k
                                 )
                                 <
                                 
                                    
                                       u
                                    
                                    
                                       ∗
                                    
                                    
                                       k
                                       -
                                       1
                                    
                                 
                              
                           , the previously accepted class-
                              
                                 
                                    
                                       u
                                    
                                    
                                       ∗
                                    
                                    
                                       k
                                       -
                                       1
                                    
                                 
                              
                            request will be rejected if and only if
                              
                                 (C.4)
                                 
                                    
                                       
                                          f
                                       
                                       
                                          
                                             
                                                u
                                             
                                             
                                                ∗
                                             
                                             
                                                k
                                                -
                                                1
                                             
                                          
                                       
                                       
                                          ′
                                       
                                    
                                    ⩽
                                    
                                       
                                          Δ
                                       
                                       
                                          
                                             
                                                u
                                             
                                             
                                                ∗
                                             
                                             
                                                k
                                                -
                                                1
                                             
                                          
                                       
                                    
                                    v
                                    (
                                    
                                       
                                          w
                                       
                                       
                                          k
                                          -
                                          1
                                       
                                       
                                          ∗
                                       
                                    
                                    +
                                    
                                       
                                          e
                                       
                                       
                                          η
                                          (
                                          k
                                          )
                                       
                                    
                                    )
                                    .
                                 
                              
                           If not rejected, we end up with 
                              
                                 
                                    
                                       w
                                    
                                    
                                       k
                                    
                                    
                                       ∗
                                    
                                 
                                 =
                                 
                                    
                                       w
                                    
                                    
                                       k
                                       -
                                       1
                                    
                                    
                                       ∗
                                    
                                 
                                 +
                                 
                                    
                                       e
                                    
                                    
                                       η
                                       (
                                       k
                                       )
                                    
                                 
                              
                            and 
                              
                                 Δ
                                 
                                    
                                       R
                                    
                                    
                                       k
                                    
                                    
                                       ∗
                                    
                                 
                                 =
                                 
                                    
                                       f
                                    
                                    
                                       η
                                       (
                                       k
                                       )
                                    
                                    
                                       ′
                                    
                                 
                                 -
                                 
                                    
                                       Δ
                                    
                                    
                                       
                                          
                                             e
                                          
                                          
                                             η
                                             (
                                             k
                                             )
                                          
                                       
                                    
                                 
                                 v
                                 (
                                 
                                    
                                       w
                                    
                                    
                                       k
                                    
                                    
                                       ∗
                                    
                                 
                                 )
                              
                           . From 
                              
                                 Δ
                                 
                                    
                                       R
                                    
                                    
                                       k
                                    
                                    
                                       ∗
                                    
                                 
                                 >
                                 Δ
                                 
                                    
                                       R
                                    
                                    
                                       k
                                    
                                    
                                       x
                                    
                                 
                              
                            we again have (C.3). If rejected, we end up with 
                              
                                 
                                    
                                       w
                                    
                                    
                                       k
                                    
                                    
                                       ∗
                                    
                                 
                                 =
                                 
                                    
                                       w
                                    
                                    
                                       k
                                       -
                                       1
                                    
                                    
                                       ∗
                                    
                                 
                                 -
                                 
                                    
                                       e
                                    
                                    
                                       
                                          
                                             u
                                          
                                          
                                             ∗
                                          
                                          
                                             k
                                             -
                                             1
                                          
                                       
                                    
                                 
                                 +
                                 
                                    
                                       e
                                    
                                    
                                       η
                                       (
                                       k
                                       )
                                    
                                 
                              
                            and 
                              
                                 Δ
                                 
                                    
                                       R
                                    
                                    
                                       k
                                    
                                    
                                       ∗
                                    
                                 
                                 =
                                 
                                    
                                       f
                                    
                                    
                                       η
                                       (
                                       k
                                       )
                                    
                                    
                                       ′
                                    
                                 
                                 -
                                 
                                    
                                       f
                                    
                                    
                                       
                                          
                                             u
                                          
                                          
                                             ∗
                                          
                                          
                                             k
                                             -
                                             1
                                          
                                       
                                    
                                    
                                       ′
                                    
                                 
                              
                           . From 
                              
                                 Δ
                                 
                                    
                                       R
                                    
                                    
                                       k
                                    
                                    
                                       ∗
                                    
                                 
                                 >
                                 Δ
                                 
                                    
                                       R
                                    
                                    
                                       k
                                    
                                    
                                       x
                                    
                                 
                              
                            we have 
                              
                                 
                                    
                                       f
                                    
                                    
                                       
                                          
                                             u
                                          
                                          
                                             ∗
                                          
                                          
                                             k
                                             -
                                             1
                                          
                                       
                                    
                                    
                                       ′
                                    
                                 
                                 <
                                 
                                    
                                       Δ
                                    
                                    
                                       η
                                       (
                                       k
                                       )
                                    
                                 
                                 v
                                 (
                                 
                                    
                                       w
                                    
                                    
                                       k
                                    
                                    
                                       x
                                    
                                 
                                 )
                              
                           , meanwhile we have 
                              
                                 
                                    
                                       f
                                    
                                    
                                       
                                          
                                             u
                                          
                                          
                                             ∗
                                          
                                          
                                             k
                                             -
                                             1
                                          
                                       
                                    
                                    
                                       ′
                                    
                                 
                                 >
                                 
                                    
                                       Δ
                                    
                                    
                                       
                                          
                                             u
                                          
                                          
                                             ∗
                                          
                                          
                                             k
                                             -
                                             1
                                          
                                       
                                    
                                 
                                 v
                                 (
                                 
                                    
                                       w
                                    
                                    
                                       k
                                       -
                                       1
                                    
                                    
                                       ∗
                                    
                                 
                                 )
                                 =
                                 
                                    
                                       Δ
                                    
                                    
                                       η
                                       (
                                       k
                                       )
                                    
                                 
                                 v
                                 (
                                 
                                    
                                       w
                                    
                                    
                                       k
                                    
                                    
                                       ∗
                                    
                                 
                                 )
                              
                            by (C.2). So we still have (C.3). Note that rejection means (C.4) so we have
                              
                                 (C.5)
                                 
                                    Δ
                                    
                                       
                                          R
                                       
                                       
                                          k
                                       
                                       
                                          ∗
                                       
                                    
                                    ⩾
                                    
                                       
                                          f
                                       
                                       
                                          η
                                          (
                                          k
                                          )
                                       
                                       
                                          ′
                                       
                                    
                                    -
                                    
                                       
                                          Δ
                                       
                                       
                                          η
                                          (
                                          k
                                          )
                                       
                                    
                                    v
                                    (
                                    
                                       
                                          w
                                       
                                       
                                          k
                                          -
                                          1
                                       
                                       
                                          ∗
                                       
                                    
                                    +
                                    
                                       
                                          e
                                       
                                       
                                          η
                                          (
                                          k
                                          )
                                       
                                    
                                    )
                                    ,
                                 
                              
                           which also holds in all situations as (C.3). The discussion so far reveals another general relationship that likewise holds in all situations
                              
                                 (C.6)
                                 
                                    
                                       
                                          w
                                       
                                       
                                          k
                                       
                                       
                                          ∗
                                       
                                    
                                    ⩽
                                    
                                       
                                          w
                                       
                                       
                                          k
                                          -
                                          1
                                       
                                       
                                          ∗
                                       
                                    
                                    +
                                    
                                       
                                          e
                                       
                                       
                                          η
                                          (
                                          k
                                          )
                                       
                                    
                                    .
                                 
                              
                           As we consider lean profiles with a LBA policy x, the booking profile is found by
                              
                                 (C.7)
                                 
                                    
                                       
                                          w
                                       
                                       
                                          
                                             
                                                k
                                             
                                             
                                                ′
                                             
                                          
                                          i
                                       
                                       
                                          x
                                       
                                    
                                    =
                                    
                                       min
                                    
                                    (
                                    
                                       
                                          q
                                       
                                       
                                          i
                                       
                                       
                                          
                                             
                                                k
                                             
                                             
                                                ′
                                             
                                          
                                       
                                    
                                    ,
                                    
                                       
                                          x
                                       
                                       
                                          i
                                       
                                    
                                    )
                                    ,
                                    
                                    i
                                    =
                                    1
                                    ,
                                    …
                                    ,
                                    m
                                    .
                                 
                              
                           If 
                              
                                 
                                    
                                       q
                                    
                                    
                                       η
                                       (
                                       k
                                       )
                                    
                                    
                                       k
                                       +
                                       t
                                       -
                                       1
                                    
                                 
                                 >
                                 
                                    
                                       x
                                    
                                    
                                       η
                                       (
                                       k
                                       )
                                    
                                 
                              
                           , then from (C.7) we must end up with 
                              
                                 
                                    
                                       w
                                    
                                    
                                       k
                                       +
                                       t
                                       -
                                       1
                                    
                                    
                                       x
                                    
                                 
                                 =
                                 
                                    
                                       w
                                    
                                    
                                       k
                                       +
                                       t
                                       -
                                       2
                                    
                                    
                                       x
                                    
                                 
                              
                           , which leads to the trivial case of 
                              
                                 Δ
                                 
                                    
                                       R
                                    
                                    
                                       k
                                       +
                                       t
                                       -
                                       1
                                    
                                    
                                       x
                                    
                                 
                                 =
                                 0
                              
                           . So we only need to consider 
                              
                                 
                                    
                                       q
                                    
                                    
                                       η
                                       (
                                       k
                                       )
                                    
                                    
                                       k
                                       +
                                       t
                                       -
                                       1
                                    
                                 
                                 ⩽
                                 
                                    
                                       x
                                    
                                    
                                       η
                                       (
                                       k
                                       )
                                    
                                 
                              
                           , which means all requests of class-
                              
                                 η
                                 (
                                 k
                                 )
                              
                            are accepted by x, and we have 
                              
                                 
                                    
                                       w
                                    
                                    
                                       k
                                       +
                                       t
                                       -
                                       1
                                    
                                    
                                       x
                                    
                                 
                                 =
                                 
                                    
                                       w
                                    
                                    
                                       k
                                    
                                    
                                       x
                                    
                                 
                                 +
                                 (
                                 t
                                 -
                                 1
                                 )
                                 
                                    
                                       e
                                    
                                    
                                       η
                                       (
                                       k
                                       )
                                    
                                 
                              
                           . On the other hand, from (C.6) we have 
                              
                                 
                                    
                                       w
                                    
                                    
                                       k
                                       +
                                       t
                                       -
                                       1
                                    
                                    
                                       ∗
                                    
                                 
                                 +
                                 
                                    
                                       e
                                    
                                    
                                       η
                                       (
                                       k
                                       )
                                    
                                 
                                 ⩽
                                 
                                    
                                       w
                                    
                                    
                                       k
                                    
                                    
                                       ∗
                                    
                                 
                                 +
                                 
                                    
                                       te
                                    
                                    
                                       η
                                       (
                                       k
                                       )
                                    
                                 
                              
                           . From (C.3) we have 
                              
                                 
                                    
                                       Δ
                                    
                                    
                                       η
                                       (
                                       k
                                       )
                                    
                                 
                                 v
                                 (
                                 
                                    
                                       w
                                    
                                    
                                       k
                                       +
                                       t
                                       -
                                       1
                                    
                                    
                                       ∗
                                    
                                 
                                 +
                                 
                                    
                                       e
                                    
                                    
                                       η
                                       (
                                       k
                                       )
                                    
                                 
                                 )
                                 ⩽
                                 
                                    
                                       Δ
                                    
                                    
                                       η
                                       (
                                       k
                                       )
                                    
                                 
                                 v
                                 (
                                 
                                    
                                       w
                                    
                                    
                                       k
                                       +
                                       t
                                       -
                                       1
                                    
                                    
                                       x
                                    
                                 
                                 )
                              
                            by convexity of 
                              
                                 v
                                 (
                                 ·
                                 )
                              
                           . Apply (C.5) with 
                              
                                 k
                                 +
                                 t
                              
                            and we have
                              
                                 
                                    Δ
                                    
                                       
                                          R
                                       
                                       
                                          k
                                          +
                                          t
                                       
                                       
                                          ∗
                                       
                                    
                                    ⩾
                                    
                                       
                                          f
                                       
                                       
                                          η
                                          (
                                          k
                                          +
                                          t
                                          )
                                       
                                       
                                          ′
                                       
                                    
                                    -
                                    
                                       
                                          Δ
                                       
                                       
                                          η
                                          (
                                          k
                                          )
                                       
                                    
                                    v
                                    (
                                    
                                       
                                          w
                                       
                                       
                                          k
                                          +
                                          t
                                          -
                                          1
                                       
                                       
                                          ∗
                                       
                                    
                                    +
                                    
                                       
                                          e
                                       
                                       
                                          η
                                          (
                                          k
                                          )
                                       
                                    
                                    )
                                    ⩾
                                    
                                       
                                          f
                                       
                                       
                                          η
                                          (
                                          k
                                          +
                                          t
                                          )
                                       
                                       
                                          ′
                                       
                                    
                                    -
                                    
                                       
                                          Δ
                                       
                                       
                                          η
                                          (
                                          k
                                          )
                                       
                                    
                                    v
                                    (
                                    
                                       
                                          w
                                       
                                       
                                          k
                                          +
                                          t
                                          -
                                          1
                                       
                                       
                                          x
                                       
                                    
                                    )
                                    =
                                    Δ
                                    
                                       
                                          R
                                       
                                       
                                          k
                                          +
                                          t
                                          -
                                          1
                                       
                                       
                                          x
                                       
                                    
                                    .
                                    
                                    □
                                 
                              
                           
                        

This new proposition helps us further reduce the input streams down to the extreme inputs. There is a critical value of 
                        
                           
                              
                                 k
                              
                              
                                 η
                              
                              
                                 x
                              
                           
                           =
                           min
                           {
                           k
                           ∈
                           
                              
                                 K
                              
                              
                                 η
                              
                           
                           :
                           Δ
                           
                              
                                 R
                              
                              
                                 ∗
                              
                              
                                 k
                              
                           
                           -
                           Δ
                           
                              
                                 R
                              
                              
                                 x
                              
                              
                                 k
                              
                           
                           >
                           0
                           }
                        
                     . Proposition 4 implies that for any 
                        
                           k
                           ∈
                           
                              
                                 K
                              
                              
                                 η
                              
                           
                        
                     , if 
                        
                           k
                           ⩾
                           
                              
                                 k
                              
                              
                                 η
                              
                              
                                 x
                              
                           
                        
                      then 
                        
                           Δ
                           
                              
                                 R
                              
                              
                                 k
                              
                              
                                 ∗
                              
                           
                           -
                           Δ
                           
                              
                                 R
                              
                              
                                 k
                              
                              
                                 x
                              
                           
                           ⩾
                           0
                        
                     . Clearly, 
                        
                           Δ
                           
                              
                                 R
                              
                              
                                 k
                              
                              
                                 ∗
                              
                           
                           -
                           Δ
                           
                              
                                 R
                              
                              
                                 k
                              
                              
                                 x
                              
                           
                        
                      is the change in the absolute regret 
                        
                           
                              
                                 R
                              
                              
                                 k
                              
                              
                                 ∗
                              
                           
                           -
                           
                              
                                 R
                              
                              
                                 k
                              
                              
                                 x
                              
                           
                        
                     . Therefore, when k takes the smallest value in 
                        
                           
                              
                                 K
                              
                              
                                 η
                              
                           
                        
                      and gradually increases to the largest, all the lean input streams between the two extreme input streams 
                        
                           
                              
                                 
                                    
                                       q
                                    
                                    
                                       ˇ
                                    
                                 
                              
                              
                                 k
                                 (
                                 η
                                 +
                                 1
                                 )
                              
                           
                        
                      and 
                        
                           
                              
                                 
                                    
                                       q
                                    
                                    
                                       ˇ
                                    
                                 
                              
                              
                                 k
                                 (
                                 η
                                 )
                              
                           
                        
                      are considered. And we have 
                        
                           Δ
                           
                              
                                 R
                              
                              
                                 k
                              
                              
                                 ∗
                              
                           
                           -
                           Δ
                           
                              
                                 R
                              
                              
                                 k
                              
                              
                                 x
                              
                           
                           ⩽
                           0
                           ,
                           k
                           <
                           
                              
                                 k
                              
                              
                                 η
                              
                              
                                 x
                              
                           
                        
                      and 
                        
                           Δ
                           
                              
                                 R
                              
                              
                                 k
                              
                              
                                 ∗
                              
                           
                           -
                           Δ
                           
                              
                                 R
                              
                              
                                 k
                              
                              
                                 x
                              
                           
                           ⩾
                           0
                           ,
                           k
                           ⩾
                           
                              
                                 k
                              
                              
                                 η
                              
                              
                                 x
                              
                           
                        
                     . So the absolute regret might first decrease, but as soon as it starts to increase, it will keep increasing. Therefore the maximal regret can only be found at the two extreme input streams, which leads to this result:
                        Theorem 3
                        
                           Given a LBA nested policy x, any input stream is dominated by an extreme input for the MAR problem.
                        

@&#REFERENCES@&#

