@&#MAIN-TITLE@&#A statistical atlas based approach to automated subject-specific FE modeling

@&#HIGHLIGHTS@&#


               
               
                  
                     
                        
                           
                           A statistical atlas is constructed to account for shape variations.


                        
                        
                           
                           Shape correspondence is obtained through the eigenspace search.


                        
                        
                           
                           Subject-specific FE mesh is obtained from the deformed mesh of the mean shape.


                        
                        
                           
                           The method is automated and is applicable to shapes with large variations.


                        
                     
                  
               
            

@&#KEYPHRASES@&#

Free-form deformation

Morphing

Statistical shape modeling

Finite element modeling

@&#ABSTRACT@&#


               
               
                  Subject-specific modeling is increasingly important in biomechanics simulation. However, how to automatically create high-quality finite element (FE) mesh and how to automatically impose boundary condition are challenging.
                  This paper presents a statistical atlas based approach for automatic meshing of subject-specific shapes. In our approach, shape variations among a shape population are explicitly modeled and the correspondence between a given subject-specific shape and the statistical atlas is sought within the “legal” shape variations. This approach involves three parts: (1) constructing a statistical atlas from a shape population, including the statistical shape model and the FE model of the mean shape; (2) establishing the correspondence between a given subject shape and the atlas; and (3) deforming the atlas to the subject shape based on the shape correspondence. Numerical results on 2D hands, 3D femur bones and 3D aorta demonstrate the effectiveness of the proposed approach.
               
            

@&#INTRODUCTION@&#

Biomechanical simulation often involves finite element (FE) modeling of subject-specific anatomic structures. However, the task of creating FE meshes such as hex mesh for each subject usually requires manual intervention and can be tedious and time consuming. Such lack of automation in FE modeling and its lengthy laborious process pose substantial challenges for applications where FE modeling and analysis need to be done in a short period of time, for example, in clinical setting such as providing surgical guidance during surgery. The ability to automate FE modeling of subject-specific shapes would lead to a population of subject-specific models with applications in surgical planning and implant design. The goal of this paper is to present an approach that can automatically build subject-specific FE models from a given subject-specific shape.

In the literature, a common approach to efficient shape modeling or FE modeling of subject-specific shapes is through template-based deformation. For example, morphing template meshes to subject-specific shapes has been explored in  [1–3]. A mesh morphing approach to conduct statistical models of femurs was studied in  [4]. However, it has not been used to generate subject-specific FE models. Recently, an atlas based geometry pipeline for constructing three-dimensional cubic Hermite finite element meshes from tomographic patient image data and deforming the atlas to a second patient has been studied in  [5].

The above approaches usually contain two steps: (1) registration of the subject shape  [1–4] or image  [5] to the template; (2) FE mesh morphing of the template to the subject with the correspondence obtained in the registration. However, these approaches are unaware of the specificity of the subject shapes and usually need to involve a large number of registration parameters and manual specification of a large number of landmarks to ensure proper correspondence between a given shape and the template shape. For example, in the free-form deformation, as pointed out by  [3], the resolution of the deformation should be approximately the size of the smallest anatomical structures to be registered, so it requires a large number of degrees of freedom (thousands) for the accurate registration of fine structures. This makes the problem complex, inefficient and more importantly, not robust. When a subject shape deviates significantly from the template shape, a simple deformation based approach, without manual specification of correspondence between the template shape and the given shape, would fail to generate proper correspondence between the two shapes. Therefore, the FE mesh and boundary conditions cannot be properly transferred from the template shape to the given shape.

For a certain class of shapes, the shape variations follow some particular patterns, and the deformations within the class are constrained by a limited number of degrees of freedom. Thus, for the FE mesh construction of a specific class of subject shapes, we first learn a prior knowledge of the population through statistical shape modeling  [6] and build a linear space of shapes. Then, instead of applying a “free style deformation” in the registration, the mean shape of the population is deformed in the “shape space” to match the subject-specific shape. In this way the deformation could be parameterized by just a few number of variables and becomes simple and robust. The generic FE mesh is built upon the mean shape of the population.


                     Fig. 1
                      gives an overview of our approach: the input is the subject specific shape, the output is the FE mesh of the subject shape. This mesh construction process is based on the statistical atlas and contains two steps: (1) boundary correspondence identification through shape instantiation and projection; (2) FE mesh morphing by the boundary correspondence.

The statistical atlas contains two parts: the statistical shape model which determines a linear shape space and the FE mesh of the mean shape. The statistical shape model is learned from a population of shapes by principal component analysis, and includes the mean shape 
                        
                           
                              
                                 S
                              
                           
                           
                              ̄
                           
                        
                      of the population and the eigen-modes 
                        
                           {
                           
                              
                                 Ψ
                              
                              
                                 i
                              
                           
                           }
                        
                      that capture the variations of the population. Originated at the mean shape, the eigen-modes together span a linear space of the shapes and any instance in that space can be instantiated by: 
                        
                           
                              
                                 
                                    
                                       S
                                    
                                 
                                 
                                    ˜
                                 
                              
                              =
                              
                                 
                                    
                                       S
                                    
                                 
                                 
                                    ̄
                                 
                              
                              +
                              
                                 
                                    ∑
                                 
                                 
                                    i
                                 
                              
                              
                                 
                                    w
                                 
                                 
                                    i
                                 
                              
                              
                                 
                                    Ψ
                                 
                                 
                                    i
                                 
                              
                              ,
                           
                        
                      where 
                        
                           {
                           
                              
                                 w
                              
                              
                                 i
                              
                           
                           }
                        
                      are the shape parameters.

In the step of correspondence identification, the mean shape is deformed to the subject shape along a path in the shape space by optimizing the shape parameters 
                        
                           {
                           
                              
                                 w
                              
                              
                                 i
                              
                           
                           }
                        
                      and is then projected onto the subject shape to establish the boundary correspondence between the mean shape and the subject shape.

Based on the obtained boundary correspondence, the FE mesh of the mean shape is then morphed to the subject shape through free-form deformation.

The contribution of this paper is a new approach that can automatically, efficiently and robustly produce high quality FE meshes for a given subject-specific shape. To examine the quality of the proposed approach, we use three measures: the distance between the instantiated shape and the given shape, the correlation coefficient of normal vectors between the mean shape and the given shape, and the mesh quality. Numerical examples on 2D hands, 3D femur bones and 3D aorta demonstrate that the proposed approach outperforms the simple deformation based approach.

The remainder of this paper is organized as follows. Section  2 introduces the construction of statistical atlas, Sections  3 and 4 cover the two steps of the proposed approach, Section  5 introduces the three measures for our approach. Numerical results are presented in Section  6. This paper is concluded in Section  7.

The statistical atlas is constructed to incorporate the prior knowledge of a specific class of shapes and provide a generic FE mesh for mesh morphing. The prior knowledge are learned by the statistical shape modeling of a population of training shapes. The generic FE mesh is constructed on the population mean whose overall distance to other instances in the population is minimized.

In this section we briefly introduce the process of statistical atlas construction. A set of training shapes are registered together in a non-rigid fashion through free-form deformation. In order to ensure good correspondence across the shape population, landmarks are specified. A mean shape model and shape variations across a population of shapes are then obtained through generalized Procrustes alignment (GPA)  [7] and principal component analysis of the shape population. The mean shape is then discretized into FE meshes (triangular or hexagonal).

In the following subsections we will use the 40 hand shapes in  [6] as examples to demonstrate our method.

Given the training set of 
                           
                              
                                 n
                              
                              
                                 s
                              
                           
                         number of shapes 
                           S
                           =
                           
                              {
                              
                                 
                                    
                                       S
                                    
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    
                                       S
                                    
                                 
                                 
                                    2
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    
                                       S
                                    
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          s
                                       
                                    
                                 
                              
                              }
                           
                        , in order to correctly calculate the population mean and model the shape variations, correspondences between these shapes must be built. Based on such correspondences, we sample the same number of points on each shape and conduct the statistical shape modeling.

In our work, we use the free-form deformation (FFD) method to establish the correspondences between the training shapes, which had been successfully applied in the shape registrations by  [8–10].

Among the 
                           
                              
                                 n
                              
                              
                                 s
                              
                           
                         number of training shapes, one shape is chosen as the template shape, note it as 
                           
                              
                                 
                                    S
                                 
                              
                              
                                 1
                              
                           
                        . It is deformed to the other shapes 
                           
                              
                                 
                                    S
                                 
                              
                              
                                 k
                              
                           
                           ,
                           
                           k
                           =
                           2
                           ,
                           …
                           ,
                           
                              
                                 n
                              
                              
                                 s
                              
                           
                         in the training set respectively and is then projected onto them to build the correspondences.

The deformation of a shape 
                           
                              S
                           
                           ⊂
                           
                              
                                 R
                              
                              
                                 d
                              
                           
                         in the 
                           d
                         dimensional Euclidean space 
                           d
                           =
                           2
                           ,
                           3
                         is done by the deformation of its underlying domain 
                           Ω
                           ⊂
                           
                              
                                 R
                              
                              
                                 d
                              
                           
                        , here we use the B-spline FFD: 
                           
                              (1)
                              
                                 
                                    f
                                 
                                 
                                    (
                                    
                                       u
                                    
                                    )
                                 
                                 =
                                 
                                    
                                       ∑
                                    
                                    
                                       
                                          i
                                       
                                       ∈
                                       I
                                    
                                 
                                 
                                    
                                       
                                          P
                                       
                                    
                                    
                                       
                                          i
                                       
                                    
                                 
                                 
                                    
                                       B
                                    
                                    
                                       
                                          i
                                       
                                    
                                 
                                 
                                    (
                                    
                                       u
                                    
                                    )
                                 
                                 ,
                                 
                                 
                                    u
                                 
                                 ∈
                                 
                                    
                                       
                                          [
                                          0
                                          ,
                                          1
                                          ]
                                       
                                    
                                    
                                       d
                                    
                                 
                                 ,
                              
                           
                        
                        
                           
                              {
                              
                                 
                                    
                                       P
                                    
                                 
                                 
                                    
                                       i
                                    
                                 
                              
                              :
                              
                                 i
                              
                              ∈
                              I
                              }
                           
                         is the set of control points, 
                           
                              {
                              
                                 
                                    B
                                 
                                 
                                    
                                       i
                                    
                                 
                              
                              :
                              
                                 i
                              
                              ∈
                              I
                              }
                           
                         is the set of B-bases, 
                           
                              u
                           
                         is the parameter value.

As shown by Fig. 2
                        , in this paper, the shapes are represented by discrete points: 
                           
                              
                                 
                                    S
                                 
                              
                              
                                 k
                              
                           
                           =
                           
                              {
                              
                                 
                                    
                                       v
                                    
                                 
                                 
                                    1
                                 
                                 
                                    
                                       (
                                       k
                                       )
                                    
                                 
                              
                              ,
                              
                                 
                                    
                                       v
                                    
                                 
                                 
                                    2
                                 
                                 
                                    
                                       (
                                       k
                                       )
                                    
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    
                                       v
                                    
                                 
                                 
                                    
                                       
                                          N
                                       
                                       
                                          k
                                       
                                    
                                 
                                 
                                    
                                       (
                                       k
                                       )
                                    
                                 
                              
                              }
                           
                           ,
                           k
                           =
                           1
                           ,
                           …
                           ,
                           
                              
                                 n
                              
                              
                                 s
                              
                           
                        . The registration of the template shape 
                           
                              
                                 
                                    S
                                 
                              
                              
                                 1
                              
                           
                         to a target shape (note it as 
                           
                              
                                 
                                    S
                                 
                              
                              
                                 2
                              
                           
                         for simplicity) is done by minimizing: 
                           
                              (2)
                              
                                 
                                    
                                       min
                                    
                                    
                                       
                                          {
                                          
                                             
                                                
                                                   P
                                                
                                             
                                             
                                                
                                                   i
                                                
                                             
                                          
                                          }
                                       
                                    
                                 
                                 
                                    
                                       E
                                    
                                    
                                       
                                          deviation
                                       
                                    
                                 
                                 +
                                 α
                                 
                                    
                                       E
                                    
                                    
                                       
                                          smooth
                                       
                                    
                                 
                                 +
                                 β
                                 
                                    
                                       E
                                    
                                    
                                       
                                          landmarks
                                       
                                    
                                 
                                 .
                              
                           
                         The first term in (2)
                        
                           
                              
                                 
                                    
                                       E
                                    
                                    
                                       
                                          deviation
                                       
                                    
                                 
                                 =
                                 
                                    
                                       ∑
                                    
                                    
                                       j
                                       =
                                       1
                                    
                                    
                                       
                                          
                                             N
                                          
                                          
                                             1
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          ‖
                                          
                                             f
                                          
                                          
                                             (
                                             
                                                
                                                   
                                                      v
                                                   
                                                
                                                
                                                   j
                                                
                                                
                                                   
                                                      (
                                                      1
                                                      )
                                                   
                                                
                                             
                                             )
                                          
                                          −
                                          
                                             
                                                
                                                   v
                                                
                                             
                                             
                                                j
                                             
                                             
                                                
                                                   (
                                                   2
                                                   ,
                                                   c
                                                   )
                                                
                                             
                                          
                                          ‖
                                       
                                    
                                    
                                       2
                                    
                                 
                                 ,
                              
                           
                         is the sum of square of deviations between the deformed template 
                           
                              f
                           
                           
                              (
                              
                                 
                                    
                                       S
                                    
                                 
                                 
                                    1
                                 
                              
                              )
                           
                         and the target 
                           
                              
                                 
                                    S
                                 
                              
                              
                                 2
                              
                           
                        , 
                           
                              f
                           
                         is the deformation field as defined in (1), and 
                           
                              
                                 
                                    v
                                 
                              
                              
                                 j
                              
                              
                                 
                                    (
                                    2
                                    ,
                                    c
                                    )
                                 
                              
                           
                         is the closest point of 
                           
                              
                                 
                                    v
                                 
                              
                              
                                 j
                              
                              
                                 
                                    (
                                    1
                                    )
                                 
                              
                           
                         in 
                           
                              
                                 
                                    S
                                 
                              
                              
                                 2
                              
                           
                        .

The second term in (2)
                        
                           
                              
                                 
                                    
                                       E
                                    
                                    
                                       
                                          smooth
                                       
                                    
                                 
                                 =
                                 
                                    
                                       ∫
                                    
                                    
                                       Ω
                                    
                                 
                                 
                                    
                                       
                                          ‖
                                          
                                             
                                                
                                                   (
                                                   
                                                      
                                                         ∑
                                                      
                                                      
                                                         i
                                                         =
                                                         1
                                                      
                                                      
                                                         d
                                                      
                                                   
                                                   
                                                      
                                                         ∂
                                                      
                                                      
                                                         ∂
                                                         
                                                            
                                                               x
                                                            
                                                            
                                                               i
                                                            
                                                         
                                                      
                                                   
                                                   )
                                                
                                             
                                             
                                                2
                                             
                                          
                                          
                                             f
                                          
                                          ‖
                                       
                                    
                                    
                                       2
                                    
                                 
                                 d
                                 
                                    x
                                 
                                 ,
                              
                           
                         is the smoothing term and penalizes large deformations. The smoothing coefficient 
                           α
                         in (2) is chosen to be large at the initial deformation steps and reduced gradually.

To guide the deformation, we manually assign a set of landmarks to each shape with presumed correspondences. The third term in (2)
                        
                           
                              
                                 
                                    
                                       E
                                    
                                    
                                       
                                          landmarks
                                       
                                    
                                 
                                 =
                                 
                                    
                                       ∑
                                    
                                    
                                       i
                                       =
                                       1
                                    
                                    
                                       l
                                    
                                 
                                 
                                    
                                       
                                          ‖
                                          
                                             f
                                          
                                          
                                             (
                                             
                                                
                                                   
                                                      
                                                         
                                                            v
                                                         
                                                      
                                                      
                                                         ̄
                                                      
                                                   
                                                
                                                
                                                   i
                                                
                                                
                                                   
                                                      (
                                                      1
                                                      )
                                                   
                                                
                                             
                                             )
                                          
                                          −
                                          
                                             
                                                
                                                   
                                                      
                                                         v
                                                      
                                                   
                                                   
                                                      ̄
                                                   
                                                
                                             
                                             
                                                i
                                             
                                             
                                                
                                                   (
                                                   2
                                                   )
                                                
                                             
                                          
                                          ‖
                                       
                                    
                                    
                                       2
                                    
                                 
                                 ,
                              
                           
                         captures the mismatch error of the landmarks.


                        
                           
                              {
                              
                                 (
                                 
                                    
                                       
                                          
                                             
                                                v
                                             
                                          
                                          
                                             ̄
                                          
                                       
                                    
                                    
                                       1
                                    
                                    
                                       
                                          (
                                          1
                                          )
                                       
                                    
                                 
                                 ,
                                 
                                    
                                       
                                          
                                             
                                                v
                                             
                                          
                                          
                                             ̄
                                          
                                       
                                    
                                    
                                       1
                                    
                                    
                                       
                                          (
                                          2
                                          )
                                       
                                    
                                 
                                 )
                              
                              ,
                              …
                              ,
                              
                                 (
                                 
                                    
                                       
                                          
                                             
                                                v
                                             
                                          
                                          
                                             ̄
                                          
                                       
                                    
                                    
                                       l
                                    
                                    
                                       
                                          (
                                          1
                                          )
                                       
                                    
                                 
                                 ,
                                 
                                    
                                       
                                          
                                             
                                                v
                                             
                                          
                                          
                                             ̄
                                          
                                       
                                    
                                    
                                       l
                                    
                                    
                                       
                                          (
                                          2
                                          )
                                       
                                    
                                 
                                 )
                              
                              }
                           
                         are the pair of landmarks on 
                           
                              
                                 
                                    S
                                 
                              
                              
                                 1
                              
                           
                         and 
                           
                              
                                 
                                    S
                                 
                              
                              
                                 2
                              
                           
                        . The landmark weight 
                           β
                         in (2) is decided so that 
                           α
                           
                              
                                 E
                              
                              
                                 
                                    deviation
                                 
                              
                           
                         and 
                           β
                           
                              
                                 E
                              
                              
                                 
                                    landmarks
                                 
                              
                           
                         are in the same order of magnitude.

Formula (2) is a formulation that has been widely used in the pairwise shape registrations  [9–14,8,15], to minimize it we adopt the typical iterative algorithm  [9,8,12] in non-rigid shape registration.

After we have found the desired deformation 
                           
                              f
                           
                        , we project the deformed template 
                           
                              f
                           
                           
                              (
                              
                                 
                                    
                                       S
                                    
                                 
                                 
                                    1
                                 
                              
                              )
                           
                         onto the target 
                           
                              
                                 
                                    S
                                 
                              
                              
                                 2
                              
                           
                         along the vertex normal and establish a point-wise correspondence between 
                           
                              
                                 
                                    S
                                 
                              
                              
                                 1
                              
                           
                         and 
                           
                              
                                 
                                    S
                                 
                              
                              
                                 2
                              
                           
                        . The normal on the vertex is calculated by averaging the normals of its surrounding elements (line segments in 2D and triangle facets in 3D).

Once we have established the point-wise correspondences between the train shapes and the template, we re-sample each shape with the correspondences and obtain
                           
                              
                                 
                                    
                                       S
                                    
                                    
                                       c
                                    
                                 
                                 =
                                 
                                    {
                                    
                                       
                                          
                                             S
                                          
                                       
                                       
                                          1
                                       
                                       
                                          c
                                       
                                    
                                    ,
                                    
                                       
                                          
                                             S
                                          
                                       
                                       
                                          2
                                       
                                       
                                          c
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       
                                          
                                             S
                                          
                                       
                                       
                                          
                                             
                                                n
                                             
                                             
                                                s
                                             
                                          
                                       
                                       
                                          c
                                       
                                    
                                    }
                                 
                                 .
                              
                           
                         The shapes in 
                           
                              
                                 S
                              
                              
                                 c
                              
                           
                         are represented by the same number of points that are in correspondences, on which we conduct the generalized Procrustes analysis  [7] and obtain the mean shape 
                           
                              
                                 
                                    S
                                 
                              
                              
                                 ̄
                              
                           
                         and the set of aligned shapes 
                           
                              
                                 S
                              
                              
                                 a
                              
                           
                           =
                           
                              {
                              
                                 
                                    
                                       S
                                    
                                 
                                 
                                    1
                                 
                                 
                                    a
                                 
                              
                              ,
                              
                                 
                                    
                                       S
                                    
                                 
                                 
                                    2
                                 
                                 
                                    a
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    
                                       S
                                    
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          s
                                       
                                    
                                 
                                 
                                    a
                                 
                              
                              }
                           
                         that had been projected to the tangent space  [6] of the mean shape, where 
                           
                              
                                 
                                    S
                                 
                              
                              
                                 ̄
                              
                           
                           =
                           
                              {
                              
                                 
                                    
                                       
                                          
                                             p
                                          
                                       
                                       ¯
                                    
                                 
                                 
                                    1
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    
                                       
                                          
                                             p
                                          
                                       
                                       ¯
                                    
                                 
                                 
                                    N
                                 
                              
                              }
                           
                        , 
                           
                              
                                 
                                    S
                                 
                              
                              
                                 k
                              
                              
                                 a
                              
                           
                           =
                           
                              {
                              
                                 
                                    
                                       p
                                    
                                 
                                 
                                    1
                                 
                                 
                                    
                                       (
                                       k
                                       )
                                    
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    
                                       p
                                    
                                 
                                 
                                    N
                                 
                                 
                                    
                                       (
                                       k
                                       )
                                    
                                 
                              
                              }
                           
                           ,
                           
                           k
                           =
                           1
                           ,
                           …
                           ,
                           
                              
                                 n
                              
                              
                                 s
                              
                           
                        , 
                           N
                         is the number of sample points, and
                           
                              (3)
                              
                                 
                                    
                                       
                                          S
                                       
                                    
                                    
                                       ̄
                                    
                                 
                                 =
                                 
                                    
                                       1
                                    
                                    
                                       
                                          
                                             n
                                          
                                          
                                             s
                                          
                                       
                                    
                                 
                                 
                                    
                                       ∑
                                    
                                    
                                       k
                                       =
                                       1
                                    
                                    
                                       
                                          
                                             n
                                          
                                          
                                             s
                                          
                                       
                                    
                                 
                                 
                                    
                                       
                                          S
                                       
                                    
                                    
                                       k
                                    
                                    
                                       a
                                    
                                 
                                 .
                              
                           
                        
                     


                        Fig. 3
                         shows the results of the generalized Procrustes analysis of 40 hand shapes.

In the generalized Procrustes analysis, we have aligned all the training shapes to the mean shape and projected them into the tangent space of the mean shape, by doing these we obtain a linear space of shapes. Here, we vectorize each shape by rearranging the coordinates and have: 
                           
                              
                                 
                                    S
                                 
                              
                              
                                 ̄
                              
                           
                           =
                           
                              
                                 
                                    [
                                    
                                       
                                          
                                             
                                                x
                                             
                                             ¯
                                          
                                       
                                       
                                          1
                                          ,
                                          1
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       
                                          
                                             
                                                x
                                             
                                             ¯
                                          
                                       
                                       
                                          1
                                          ,
                                          d
                                       
                                    
                                    ,
                                    
                                       
                                          
                                             
                                                x
                                             
                                             ¯
                                          
                                       
                                       
                                          2
                                          ,
                                          1
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       
                                          
                                             
                                                x
                                             
                                             ¯
                                          
                                       
                                       
                                          N
                                          ,
                                          d
                                       
                                    
                                    ]
                                 
                              
                              
                                 T
                              
                           
                        , and 
                           
                              
                                 
                                    S
                                 
                              
                              
                                 k
                              
                              
                                 a
                              
                           
                           =
                           
                              
                                 
                                    [
                                    
                                       
                                          x
                                       
                                       
                                          1
                                          ,
                                          1
                                       
                                       
                                          
                                             (
                                             k
                                             )
                                          
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       
                                          x
                                       
                                       
                                          1
                                          ,
                                          d
                                       
                                       
                                          
                                             (
                                             k
                                             )
                                          
                                       
                                    
                                    ,
                                    
                                       
                                          x
                                       
                                       
                                          2
                                          ,
                                          1
                                       
                                       
                                          
                                             (
                                             k
                                             )
                                          
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       
                                          x
                                       
                                       
                                          N
                                          ,
                                          d
                                       
                                       
                                          
                                             (
                                             k
                                             )
                                          
                                       
                                    
                                    ]
                                 
                              
                              
                                 T
                              
                           
                           ,
                           k
                           =
                           1
                           ,
                           …
                           ,
                           
                              
                                 n
                              
                              
                                 s
                              
                           
                        .

We can view those vectorized shapes 
                           
                              
                                 
                                    S
                                 
                              
                              
                                 1
                              
                              
                                 g
                              
                           
                           ,
                           
                              
                                 
                                    S
                                 
                              
                              
                                 2
                              
                              
                                 g
                              
                           
                           ,
                           …
                           ,
                           
                              
                                 
                                    S
                                 
                              
                              
                                 
                                    
                                       n
                                    
                                    
                                       s
                                    
                                 
                              
                              
                                 g
                              
                           
                         as points in the 
                           N
                           ×
                           d
                         dimensional space, and center them with respect to the mean shape, by that we obtain the shape variation matrix 
                           Φ
                           =
                           
                              {
                              
                                 
                                    Φ
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    Φ
                                 
                                 
                                    2
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    Φ
                                 
                                 
                                    
                                       
                                          n
                                       
                                       
                                          s
                                       
                                    
                                 
                              
                              }
                           
                        , where 
                           
                              
                                 Φ
                              
                              
                                 k
                              
                           
                           =
                           
                              
                                 
                                    S
                                 
                              
                              
                                 k
                              
                              
                                 a
                              
                           
                           −
                           
                              
                                 
                                    S
                                 
                              
                              
                                 ̄
                              
                           
                           ,
                           k
                           =
                           1
                           ,
                           …
                           ,
                           
                              
                                 n
                              
                              
                                 s
                              
                           
                        . The variations 
                           
                              {
                              
                                 
                                    Φ
                                 
                                 
                                    k
                                 
                              
                              }
                           
                         together span a linear shape space 
                           Θ
                         centered at 
                           
                              
                                 
                                    S
                                 
                              
                              
                                 ̄
                              
                           
                        .

By calculating the eigen-values 
                           
                              
                                 λ
                              
                              
                                 1
                              
                           
                           ,
                           
                              
                                 λ
                              
                              
                                 2
                              
                           
                           ,
                           …
                           ,
                           
                              
                                 λ
                              
                              
                                 
                                    
                                       n
                                    
                                    
                                       s
                                    
                                 
                                 −
                                 1
                              
                           
                         and the corresponding eigen-modes 
                           
                              
                                 Ψ
                              
                              
                                 1
                              
                           
                           ,
                           
                              
                                 Ψ
                              
                              
                                 2
                              
                           
                           ,
                           …
                           ,
                           
                              
                                 Ψ
                              
                              
                                 
                                    
                                       n
                                    
                                    
                                       s
                                    
                                 
                                 −
                                 1
                              
                           
                         of the covariance matrix 
                           Σ
                           =
                           
                              
                                 1
                              
                              
                                 
                                    
                                       n
                                    
                                    
                                       s
                                    
                                 
                                 −
                                 1
                              
                           
                           Ψ
                           
                              
                                 Ψ
                              
                              
                                 T
                              
                           
                        , we obtain a set of orthonormal bases 
                           
                              
                                 Ψ
                              
                              
                                 k
                              
                           
                           ,
                           k
                           =
                           1
                           ,
                           …
                           ,
                           
                              
                                 n
                              
                              
                                 s
                              
                           
                           −
                           1
                         for 
                           Θ
                        , these bases are the principal directions that maximize the shape variations, and 
                           
                              
                                 λ
                              
                              
                                 k
                              
                           
                           ,
                           k
                           =
                           1
                           ,
                           …
                           ,
                           
                              
                                 n
                              
                              
                                 s
                              
                           
                           −
                           1
                         are the variances in these directions ordered from large to small.

Usually a good statistical shape model should have the first several eigen-values to capture a majority of the population variations and in this case the shape variations can be efficiently modeled by the first several eigen-modes. We call the space spanned by the set of eigen-modes 
                           
                              
                                 Ψ
                              
                              
                                 k
                              
                           
                           ,
                           k
                           =
                           1
                           ,
                           …
                           ,
                           m
                           ,
                           m
                           <
                           
                              
                                 n
                              
                              
                                 s
                              
                           
                           −
                           1
                         the eigen-space 
                           Θ
                         of the statistical shape model, which is a subspace of the whole shape space 
                           Θ
                        . We can instantiate new shape instances in 
                           Θ
                         by: 
                           
                              (4)
                              
                                 
                                    
                                       
                                          S
                                       
                                    
                                    
                                       ˜
                                    
                                 
                                 =
                                 
                                    
                                       
                                          S
                                       
                                    
                                    
                                       ̄
                                    
                                 
                                 +
                                 
                                    
                                       ∑
                                    
                                    
                                       k
                                       =
                                       1
                                    
                                    
                                       m
                                    
                                 
                                 
                                    
                                       w
                                    
                                    
                                       k
                                    
                                 
                                 
                                    
                                       Ψ
                                    
                                    
                                       k
                                    
                                 
                                 .
                              
                           
                         Usually, we choose 
                           m
                         by letting 
                           
                              
                                 ∑
                              
                              
                                 i
                                 =
                                 1
                              
                              
                                 m
                              
                           
                           
                              
                                 λ
                              
                              
                                 i
                              
                           
                           /
                           
                              
                                 ∑
                              
                              
                                 i
                              
                              
                                 
                                    
                                       n
                                    
                                    
                                       s
                                    
                                 
                              
                           
                           
                              
                                 λ
                              
                              
                                 i
                              
                           
                           ≥
                           p
                        , where 
                           p
                         is the percentage of variances we want the first 
                           m
                         eigen-modes to capture. For the 40 hands we choose 
                           p
                           =
                           98.5
                           %
                        , which corresponds to the first 11 eigen-modes.

In Fig. 4
                         we show the first three eigen-modes of the hand shapes obtained by the principal component analysis.

In Fig. 5
                         we show the cumulative shape variances. In which the first 8 modes have captured 98.14% of the shape variances and the first 11 modes have captured 99.01% of the shape variances.

After the statistical shape modeling, we obtain the mean shape 
                           
                              
                                 
                                    S
                                 
                              
                              
                                 ̄
                              
                           
                         of the training populations, on which we create a generic FE mesh. This generic FE mesh will be used as a template to create subject-specific FE meshes.


                        Fig. 6
                         shows the quadrilateral mesh of the mean shape of the 40 hands in Section  2.3, the color shows the value of Jacobians, which are all positive.

By the statistical shape modeling, we obtain the mean shape 
                        
                           
                              
                                 S
                              
                           
                           
                              ̄
                           
                        
                      and the eigen-modes 
                        
                           
                              Ψ
                           
                           
                              1
                           
                        
                        ,
                        
                           
                              Ψ
                           
                           
                              2
                           
                        
                        ,
                        …
                        ,
                        
                           
                              Ψ
                           
                           
                              
                                 
                                    n
                                 
                                 
                                    s
                                 
                              
                              −
                              1
                           
                        
                      of the training populations. The eigen-modes capture the shape variations and together span a linear shape space. By choosing the first 
                        m
                      eigen-modes corresponding to the major shape variations as described in 2.3, we obtain the eigen-space 
                        Θ
                     , and an instance in it can be instantiated by 
                        
                           
                              
                                 S
                              
                           
                           
                              ˜
                           
                        
                        =
                        
                           
                              
                                 S
                              
                           
                           
                              ̄
                           
                        
                        +
                        
                           
                              ∑
                           
                           
                              k
                              =
                              1
                           
                           
                              m
                           
                        
                        
                           
                              w
                           
                           
                              k
                           
                        
                        
                           
                              Ψ
                           
                           
                              k
                           
                        
                     , where 
                        
                           w
                        
                        =
                        
                           
                              
                                 [
                                 
                                    
                                       w
                                    
                                    
                                       1
                                    
                                 
                                 ,
                                 
                                    
                                       w
                                    
                                    
                                       2
                                    
                                 
                                 ,
                                 …
                                 ,
                                 
                                    
                                       w
                                    
                                    
                                       m
                                    
                                 
                                 ]
                              
                           
                           
                              T
                           
                        
                      are the shape parameters.

Given a new shape 
                        
                           
                              
                                 S
                              
                           
                           
                              ˆ
                           
                        
                     , we search in the eigen-space to find the optimal shape parameters 
                        
                           w
                        
                      that best synthesize it and obtain the optimal shape instance 
                        
                           
                              
                                 S
                              
                           
                           
                              ˜
                           
                        
                      in 
                        Θ
                      for 
                        
                           
                              
                                 S
                              
                           
                           
                              ˆ
                           
                        
                     . Then we project 
                        
                           
                              
                                 S
                              
                           
                           
                              ˜
                           
                        
                      onto 
                        
                           
                              
                                 S
                              
                           
                           
                              ˆ
                           
                        
                      along the normal so to obtain the finally synthesized shape 
                        
                           
                              
                                 
                                    
                                       S
                                    
                                 
                                 
                                    ˜
                                 
                              
                           
                           
                              P
                           
                        
                     , from which the point-wise correspondences between the given shape and the atlas can be established.

During the eigen-space search, the instantiated shape 
                        
                           
                              
                                 S
                              
                           
                           
                              ˜
                           
                        
                      is in the reference frame of 
                        Θ
                     , while 
                        
                           
                              
                                 S
                              
                           
                           
                              ˆ
                           
                        
                      locates in the image frame or physical frame, depends on how it was obtained, and we note the transformation from the reference frame to the physical frame as 
                        
                           
                              
                                 t
                              
                           
                           
                              R
                              ,
                              T
                              ,
                              s
                           
                        
                      with parameters 
                        R
                        ,
                        T
                        ,
                        s
                     , where 
                        R
                      is the rotation, 
                        T
                      is the translation and 
                        s
                      is the scaling. For a point 
                        
                           p
                        
                     , 
                        
                           
                              
                                 t
                              
                           
                           
                              R
                              ,
                              T
                              ,
                              s
                           
                        
                        
                           (
                           
                              p
                           
                           )
                        
                        =
                        s
                        R
                        
                           p
                        
                        +
                        T
                     . In our later expression, we use 
                        
                           
                              
                                 t
                              
                           
                           
                              R
                              ,
                              T
                              ,
                              s
                           
                        
                        ∘
                        
                        
                           S
                        
                      to denote the transformation of a shape under 
                        
                           
                              
                                 t
                              
                           
                           
                              R
                              ,
                              T
                              ,
                              s
                           
                        
                      point-wisely.

Similar with the free-form deformation, we search for the optimal shape parameters and transformation by minimizing the distances between the new shape 
                        
                           
                              
                                 S
                              
                           
                           
                              ˆ
                           
                        
                      and the instantiated shape 
                        
                           
                              
                                 S
                              
                           
                           
                              ˜
                           
                        
                     follows by a regularization term. We have the total energy function: 
                        
                           (5)
                           
                              
                                 
                                    min
                                 
                                 
                                    R
                                    ,
                                    T
                                    ,
                                    s
                                    ,
                                    
                                       w
                                    
                                 
                              
                              
                              E
                              =
                              
                                 
                                    E
                                 
                                 
                                    d
                                 
                              
                              +
                              γ
                              
                                 
                                    E
                                 
                                 
                                    r
                                 
                              
                              ,
                           
                        
                      where 
                        
                           
                              E
                           
                           
                              d
                           
                        
                      is the distance term and 
                        
                           
                              E
                           
                           
                              r
                           
                        
                      is the regularization term just as 
                        
                           
                              E
                           
                           
                              
                                 smooth
                              
                           
                        
                      in the free-form deformation, and large regularization coefficient 
                        γ
                      will give strong penalizations to large shape parameters 
                        
                           w
                        
                      when compared with the square roots of the eigen-values 
                        
                           
                              σ
                           
                           
                              k
                           
                        
                        =
                        
                           
                              
                                 
                                    λ
                                 
                                 
                                    k
                                 
                              
                           
                        
                        ,
                        k
                        =
                        1
                        ,
                        …
                        ,
                        m
                     . We have
                        
                           (6)
                           
                              
                                 
                                    E
                                 
                                 
                                    d
                                 
                              
                              =
                              
                                 
                                    
                                       ‖
                                       
                                          
                                             
                                                
                                                   
                                                      S
                                                   
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                          
                                             c
                                          
                                       
                                       −
                                       
                                          
                                             
                                                t
                                             
                                          
                                          
                                             R
                                             ,
                                             T
                                             ,
                                             s
                                          
                                       
                                       ∘
                                       
                                          (
                                          
                                             
                                                
                                                   S
                                                
                                             
                                             
                                                ̄
                                             
                                          
                                          +
                                          Ψ
                                          
                                             w
                                          
                                          )
                                       
                                       ‖
                                    
                                 
                                 
                                    2
                                 
                              
                              ,
                           
                        
                      captures the discrepancies between given shape 
                        
                           
                              
                                 S
                              
                           
                           
                              ˆ
                           
                        
                      and the shape instance 
                        
                           
                              
                                 S
                              
                           
                           
                              ˜
                           
                        
                        =
                        
                           
                              
                                 S
                              
                           
                           
                              ̄
                           
                        
                        +
                        Ψ
                        
                           w
                        
                     , where 
                        Ψ
                        =
                        
                           [
                           
                              
                                 Ψ
                              
                              
                                 1
                              
                           
                           ,
                           
                              
                                 Ψ
                              
                              
                                 2
                              
                           
                           ,
                           …
                           ,
                           
                              
                                 Ψ
                              
                              
                                 m
                              
                           
                           ]
                        
                     , and 
                        
                           
                              
                                 
                                    
                                       S
                                    
                                 
                                 
                                    ˆ
                                 
                              
                           
                           
                              c
                           
                        
                      is the re-sampling of 
                        
                           
                              
                                 S
                              
                           
                           
                              ˆ
                           
                        
                      based on the correspondence. We have 
                        
                           (7)
                           
                              
                                 
                                    E
                                 
                                 
                                    r
                                 
                              
                              =
                              
                                 
                                    
                                       w
                                    
                                 
                                 
                                    T
                                 
                              
                              
                                 
                                    Λ
                                 
                                 
                                    −
                                    1
                                 
                              
                              
                                 w
                              
                              ,
                           
                        
                      as the regularization term, where 
                        Λ
                        =
                        diag
                        
                           (
                           
                              
                                 σ
                              
                              
                                 1
                              
                              
                                 2
                              
                           
                           ,
                           …
                           ,
                           
                              
                                 σ
                              
                              
                                 m
                              
                              
                                 2
                              
                           
                           )
                        
                      is the diagonal matrix of the eigen-values.

Similar to the non-rigid registration algorithm in  [8,9,12], we choose large initial regularization coefficient 
                        γ
                      and reduce it gradually. So at the beginning, more global transformations are recovered by 
                        R
                        ,
                        T
                        ,
                        s
                      and as 
                        γ
                      is reduced, major shape variations are recovered by the parameters corresponding to larger eigen-values, and as 
                        γ
                      ​keeps reducing, local fine shape variations are recovered as the parameters corresponding to smaller eigen-values being effective in (5).

The shape instantiation is done through an iterative process as shown in Fig. 7
                     , in which the correspondence and the parameters 
                        
                           w
                        
                        ,
                        R
                        ,
                        T
                        ,
                        s
                      are optimized iteratively.

Starting from the mean shape 
                        
                           
                              
                                 S
                              
                           
                           
                              ̄
                           
                        
                     , we build the correspondence between 
                        
                           
                              
                                 S
                              
                           
                           
                              ̄
                           
                        
                      and the given shape 
                        
                           
                              
                                 S
                              
                           
                           
                              ˆ
                           
                        
                      by searching the closest point. Based on the correspondence, we re-sample 
                        
                           
                              
                                 S
                              
                           
                           
                              ˆ
                           
                        
                      and obtain 
                        
                           
                              
                                 
                                    
                                       S
                                    
                                 
                                 
                                    ˆ
                                 
                              
                           
                           
                              c
                           
                        
                     , with which we search for the optimal shape parameters 
                        
                           w
                        
                      and transformation 
                        R
                        ,
                        T
                        ,
                        s
                      by minimize (5). After that we instantiate a shape instance by 
                        
                           
                              
                                 S
                              
                           
                           
                              ˜
                           
                        
                        =
                        
                           
                              
                                 S
                              
                           
                           
                              ̄
                           
                        
                        +
                        Ψ
                        
                           w
                        
                      and transform it to the frame of 
                        
                           
                              
                                 S
                              
                           
                           
                              ˆ
                           
                        
                      by 
                        
                           
                              
                                 t
                              
                           
                           
                              R
                              ,
                              T
                              ,
                              s
                           
                        
                        ∘
                        
                           
                              
                                 S
                              
                           
                           
                              ˜
                           
                        
                     . Then we update the correspondence with the newly instantiated shape and iterate until convergence.

With known correspondence and the re-sampled points 
                        
                           
                              
                                 
                                    
                                       S
                                    
                                 
                                 
                                    ˆ
                                 
                              
                           
                           
                              c
                           
                        
                     , formula (5) is minimized through iteratively optimizing the shape parameters 
                        
                           w
                        
                      and the transformation 
                        R
                        ,
                        T
                        ,
                        s
                      by applying the Protocol 1 (Matching model points to target points) of the active shape algorithm in  [16], which was originally used for image segmentation in  [16,17]. The only difference is the way we update the shape parameters 
                        
                           w
                        
                     . Due to the regularization term added, by letting 
                        
                           
                              ∂
                              E
                           
                           
                              ∂
                              
                                 w
                              
                           
                        
                        =
                        0
                     , we have 
                        
                           (8)
                           
                              
                                 w
                              
                              =
                              
                                 
                                    
                                       (
                                       I
                                       +
                                       
                                          
                                             γ
                                          
                                          
                                             
                                                
                                                   s
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                       
                                          
                                             Λ
                                          
                                          
                                             −
                                             1
                                          
                                       
                                       )
                                    
                                 
                                 
                                    −
                                    1
                                 
                              
                              
                                 
                                    Ψ
                                 
                                 
                                    T
                                 
                              
                              
                                 (
                                 
                                    
                                       
                                          t
                                       
                                    
                                    
                                       R
                                       ,
                                       T
                                       ,
                                       s
                                    
                                    
                                       −
                                       1
                                    
                                 
                                 ∘
                                 
                                    
                                       
                                          
                                             
                                                S
                                             
                                          
                                          
                                             ˆ
                                          
                                       
                                    
                                    
                                       c
                                    
                                 
                                 −
                                 
                                    
                                       
                                          S
                                       
                                    
                                    ¯
                                 
                                 )
                              
                              ,
                           
                        
                      where 
                        
                           
                              
                                 t
                              
                           
                           
                              R
                              ,
                              T
                              ,
                              s
                           
                           
                              −
                              1
                           
                        
                      is the inverse transformation of 
                        
                           
                              
                                 t
                              
                           
                           
                              R
                              ,
                              T
                              ,
                              s
                           
                        
                     , I is the 
                        m
                        ×
                        m
                      identity matrix. When 
                        γ
                        =
                        0
                     , we have 
                        
                           w
                        
                        =
                        
                           
                              Ψ
                           
                           
                              T
                           
                        
                        
                           (
                           
                              
                                 
                                    t
                                 
                              
                              
                                 R
                                 ,
                                 T
                                 ,
                                 s
                              
                              
                                 −
                                 1
                              
                           
                           ∘
                           
                              
                                 
                                    
                                       
                                          S
                                       
                                    
                                    
                                       ˆ
                                    
                                 
                              
                              
                                 c
                              
                           
                           −
                           
                              
                                 
                                    S
                                 
                              
                              
                                 ̄
                              
                           
                           )
                        
                      as in  [16].

The below Algorithm gives a detailed description of our approach:


                     
                        
                           
                        
                     
                  

The inputs for Algorithm 1 are the mean shape 
                        
                           
                              
                                 S
                              
                           
                           
                              ̄
                           
                        
                     , the eigen-modes 
                        Ψ
                      and the given shape 
                        
                           
                              
                                 S
                              
                           
                           
                              ˆ
                           
                        
                      for synthesis; the output is the finally synthesized shape 
                        
                           
                              
                                 
                                    
                                       S
                                    
                                 
                                 
                                    ˜
                                 
                              
                           
                           
                              P
                           
                        
                     . With the initialization, we start from the mean shape and deform it to the given shape through successive shape instantiations.

In the outer loop, under the current regularization coefficient 
                        γ
                     , we found the optimal correspondence, shape parameters 
                        
                           w
                        
                      and transformations 
                        R
                        ,
                        T
                        ,
                        s
                      for the given shape 
                        
                           
                              
                                 S
                              
                           
                           
                              ˆ
                           
                        
                      which respect to (5). Then we reduce the regularization coefficient 
                        γ
                     , and use the current parameters as the initial input and optimize. If the correspondence does not change any more, we exit the outer loop otherwise we go to 
                        
                           
                              γ
                           
                           
                              n
                           
                        
                     .

In the inner loop, we find the optimal parameters for the current 
                        γ
                      by iteratively optimizing the correspondence and the parameters 
                        
                           w
                        
                        ,
                        R
                        ,
                        T
                        ,
                        s
                     . The convergence criteria for the inner loop is that the change of the shape parameters should be smaller than 
                        ε
                        =
                        1
                        
                           
                              0
                           
                           
                              −
                              6
                           
                        
                     .

Once the correspondence is not changing, we project 
                        
                           
                              
                                 t
                              
                           
                           
                              R
                              ,
                              T
                              ,
                              s
                           
                        
                        ∘
                        
                           
                              
                                 S
                              
                           
                           
                              ˜
                           
                        
                      onto 
                        
                           
                              
                                 S
                              
                           
                           
                              ˆ
                           
                        
                      along the normal and obtain the optimal shape synthesis 
                        
                           
                              
                                 
                                    
                                       S
                                    
                                 
                                 
                                    ˜
                                 
                              
                           
                           
                              P
                           
                        
                      for 
                        
                           
                              
                                 S
                              
                           
                           
                              ˆ
                           
                        
                     , by which we obtain the one-to-one correspondences between the mean shape 
                        
                           
                              
                                 S
                              
                           
                           
                              ̄
                           
                        
                      and the given shape 
                        
                           
                              
                                 S
                              
                           
                           
                              ˆ
                           
                        
                      as a by-product.

In Section  3 we have shown how to automatically register the subject shape 
                        
                           
                              
                                 S
                              
                           
                           
                              ˆ
                           
                        
                      to the mean shape 
                        
                           
                              
                                 S
                              
                           
                           
                              ̄
                           
                        
                      by the shape instantiation and projection. As a by-product, we obtain the transformation 
                        
                           
                              
                                 t
                              
                           
                           
                              R
                              ,
                              T
                              ,
                              s
                           
                        
                      from the reference frame to the frame of 
                        
                           
                              
                                 S
                              
                           
                           
                              ˆ
                           
                        
                     , by its inverse 
                        
                           
                              
                                 t
                              
                           
                           
                              R
                              ,
                              T
                              ,
                              s
                           
                           
                              −
                              1
                           
                        
                      we transform the subject shape 
                        
                           
                              
                                 S
                              
                           
                           
                              ˆ
                           
                        
                      to the reference frame where the mean shape locates. Then with the explicit correspondences between the boundaries of 
                        
                           
                              
                                 S
                              
                           
                           
                              ˆ
                           
                        
                      and 
                        
                           
                              
                                 S
                              
                           
                           
                              ̄
                           
                        
                     , we obtain a smooth deformation field that morphs the mesh of 
                        
                           
                              
                                 S
                              
                           
                           
                              ̄
                           
                        
                      to 
                        
                           
                              
                                 S
                              
                           
                           
                              ˆ
                           
                        
                      by 
                        
                           (9)
                           
                              
                                 
                                    min
                                 
                                 
                                    
                                       {
                                       
                                          
                                             
                                                P
                                             
                                          
                                          
                                             
                                                i
                                             
                                          
                                       
                                       }
                                    
                                 
                              
                              
                                 
                                    ∑
                                 
                                 
                                    j
                                    =
                                    1
                                 
                                 
                                    N
                                 
                              
                              
                                 
                                    
                                       ‖
                                       
                                          f
                                       
                                       
                                          (
                                          
                                             
                                                
                                                   
                                                      
                                                         p
                                                      
                                                   
                                                   ¯
                                                
                                             
                                             
                                                j
                                             
                                          
                                          )
                                       
                                       −
                                       
                                          
                                             
                                                
                                                   
                                                      p
                                                   
                                                
                                                
                                                   ˆ
                                                
                                             
                                          
                                          
                                             j
                                          
                                       
                                       ‖
                                    
                                 
                                 
                                    2
                                 
                              
                              +
                              α
                              
                                 
                                    E
                                 
                                 
                                    
                                       smooth
                                    
                                 
                              
                              ,
                           
                        
                      where 
                        
                           f
                        
                      is the B-spline field defined in (1), 
                        
                           
                              
                                 P
                              
                           
                           
                              
                                 i
                              
                           
                        
                        ,
                        
                           i
                        
                        ∈
                        I
                      are its control points. 
                        
                           
                              
                                 
                                    
                                       p
                                    
                                 
                                 ¯
                              
                           
                           
                              j
                           
                        
                        ,
                        j
                        ∈
                        1
                        ,
                        …
                        ,
                        N
                      is the point on the mean shape 
                        
                           
                              
                                 S
                              
                           
                           
                              ̄
                           
                        
                     , and 
                        
                           
                              
                                 
                                    
                                       p
                                    
                                 
                                 
                                    ˆ
                                 
                              
                           
                           
                              j
                           
                        
                      is its corresponding point on 
                        
                           
                              
                                 S
                              
                           
                           
                              ˆ
                           
                        
                      obtained by the shape instantiation and projection. The smoothing term 
                        
                           
                              E
                           
                           
                              
                                 smooth
                              
                           
                        
                      is the same as in Section  2.1 and 
                        α
                      is the smoothing coefficient. Here since we know the right correspondences, a small 
                        α
                      is enough. e.g., in the pairwise registration by FFD of the 2D hand, we begin with 
                        α
                        =
                        30
                        ,
                        000
                     , here 
                        α
                        =
                        50
                      would be enough.

With the obtained deformation field 
                        
                           f
                        
                     , we morph the FE mesh of 
                        
                           
                              
                                 S
                              
                           
                           
                              ̄
                           
                        
                      to 
                        
                           
                              
                                 S
                              
                           
                           
                              ˆ
                           
                        
                     .

In Fig. 8
                      we show the correspondence obtained by the method of Section  3 and the resulting FE mesh from mesh morphing with the correspondence. The Jacobians in Fig. 8(b) are all positive which means the mesh is valid.

@&#EVALUATION@&#

To examine the quality of the proposed approach, we use three measures: the distance between the instantiated shape and the given shape, and correlation of normal vectors between the mean shape and the given shape, and the Jacobians of the subject-specific mesh obtained.

The distance between the instantiated shape and the given shape is calculated by (6) at the end of the instantiation to evaluate the quality of the shape instantiation. Small distance means that we find an instance in the eigen-space that is very close to the given shape, thus by the projection we can build a reliable correspondence between them. Large distance means either the given shape is far from the eigen-space or the method has failed to instantiate the correct shape instance.

The correlation of the normal vectors at the corresponding points between the mean shape and the given shape is calculated to quantize the quality of the correspondence.

For two random variables 
                           x
                         and 
                           y
                        , their correlation coefficient 
                           
                              (10)
                              
                                 ρ
                                 
                                    (
                                    x
                                    ,
                                    y
                                    )
                                 
                                 =
                                 
                                    
                                       Cov
                                       
                                          (
                                          x
                                          ,
                                          y
                                          )
                                       
                                    
                                    
                                       Cov
                                       
                                          
                                             
                                                (
                                                x
                                                ,
                                                x
                                                )
                                             
                                          
                                          
                                             
                                                
                                                   1
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                       Cov
                                       
                                          
                                             
                                                (
                                                y
                                                ,
                                                y
                                                )
                                             
                                          
                                          
                                             
                                                
                                                   1
                                                
                                                
                                                   2
                                                
                                             
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                         measures the similarity in behavior between 
                           x
                         and 
                           y
                        , here 
                           Cov
                           
                              (
                              x
                              ,
                              y
                              )
                           
                         is the covariance between 
                           x
                         and 
                           y
                        . The square of the correlation coefficient 
                           
                              
                                 ρ
                              
                              
                                 2
                              
                           
                           
                              (
                              x
                              ,
                              y
                              )
                           
                         is the proportion of the total variation in 
                           x
                         that is explained by the variable 
                           y
                         in a simple linear regression model and visa versa  [18].

For a random variable 
                           x
                         and a 
                           d
                         dimension random vector 
                           
                              Y
                           
                        , the multiple correlation coefficient 
                           ϱ
                           
                              (
                              x
                              ,
                              
                                 Y
                              
                              )
                           
                           ∈
                           
                              [
                              0
                              ,
                              1
                              ]
                           
                         between them is defined as  [19]
                        
                           
                              (11)
                              
                                 
                                    
                                       sup
                                    
                                    
                                       
                                          A
                                       
                                    
                                 
                                 
                                 
                                    
                                       ϱ
                                    
                                    
                                       2
                                    
                                 
                                 
                                    (
                                    x
                                    ,
                                    
                                       Y
                                    
                                    )
                                 
                                 =
                                 
                                    
                                       ρ
                                    
                                    
                                       2
                                    
                                 
                                 
                                    (
                                    x
                                    ,
                                    
                                       A
                                    
                                    
                                       Y
                                    
                                    )
                                 
                                 ,
                              
                           
                         where 
                           ρ
                         is defined in (10). It turns out that 
                           
                              A
                           
                           =
                           
                              
                                 Σ
                              
                              
                                 12
                              
                           
                           
                              
                                 Σ
                              
                              
                                 22
                              
                              
                                 −
                                 1
                              
                           
                         is the vector of regression coefficients of 
                           x
                         on 
                           
                              Y
                           
                        , where 
                           
                              
                                 Σ
                              
                              
                                 12
                              
                           
                         is the covariance between 
                           x
                         and 
                           
                              Y
                           
                         whose dimensions are 
                           1
                           ×
                           d
                        , 
                           
                              
                                 Σ
                              
                              
                                 22
                              
                           
                         is the covariance of 
                           
                              Y
                           
                         itself and is a 
                           d
                           ×
                           d
                         matrix. So by (10) and (11) we have  [19]
                        
                           
                              (12)
                              
                                 ϱ
                                 
                                    (
                                    x
                                    ,
                                    
                                       Y
                                    
                                    )
                                 
                                 =
                                 
                                    
                                       
                                          
                                             Σ
                                          
                                          
                                             12
                                          
                                       
                                       
                                          
                                             Σ
                                          
                                          
                                             22
                                          
                                          
                                             −
                                             1
                                          
                                       
                                       
                                          
                                             Σ
                                          
                                          
                                             21
                                          
                                       
                                    
                                 
                                 /
                                 
                                    
                                       
                                          
                                             σ
                                          
                                          
                                             11
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                         where 
                           
                              
                                 σ
                              
                              
                                 11
                              
                           
                         is the variance of 
                           x
                        , 
                           
                              
                                 Σ
                              
                              
                                 21
                              
                           
                           =
                           
                              
                                 Σ
                              
                              
                                 12
                              
                              
                                 T
                              
                           
                        . Similarly, 
                           
                              
                                 ϱ
                              
                              
                                 2
                              
                           
                           
                              (
                              x
                              ,
                              
                                 Y
                              
                              )
                           
                         is the proportion of the variation in 
                           x
                         that is explained by the variables in 
                           
                              Y
                           
                         by linear regression with the regression coefficients 
                           
                              A
                           
                           =
                           
                              
                                 Σ
                              
                              
                                 12
                              
                           
                           
                              
                                 Σ
                              
                              
                                 22
                              
                              
                                 −
                                 1
                              
                           
                        .

For two random vectors 
                           
                              
                                 
                                    X
                                 
                              
                              
                                 
                                    
                                       d
                                    
                                    
                                       1
                                    
                                 
                                 ×
                                 1
                              
                           
                         and 
                           
                              
                                 
                                    Y
                                 
                              
                              
                                 
                                    
                                       d
                                    
                                    
                                       2
                                    
                                 
                                 ×
                                 1
                              
                           
                        , for each individual component 
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                           ,
                           i
                           =
                           1
                           ,
                           …
                           ,
                           
                              
                                 d
                              
                              
                                 1
                              
                           
                         of 
                           
                              X
                           
                        , we calculate its multiple correlation with 
                           
                              Y
                           
                         and obtain 
                           
                              r
                           
                           =
                           
                              
                                 
                                    [
                                    
                                       
                                          ϱ
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    …
                                    ,
                                    
                                       
                                          ϱ
                                       
                                       
                                          
                                             
                                                d
                                             
                                             
                                                1
                                             
                                          
                                       
                                    
                                    ]
                                 
                              
                              
                                 T
                              
                           
                         by (12), while 
                           
                              
                                 ϱ
                              
                              
                                 i
                              
                              
                                 2
                              
                           
                         is the proportion of variation in 
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                         that is explained by 
                           
                              Y
                           
                         by linear regression. Thus the total proportion of variation in 
                           
                              X
                           
                         that is explained by 
                           
                              Y
                           
                         can be calculated by 
                           
                              
                                 ∑
                              
                              
                                 i
                                 =
                                 1
                              
                              
                                 
                                    
                                       d
                                    
                                    
                                       1
                                    
                                 
                              
                           
                           
                              
                                 ϱ
                              
                              
                                 i
                              
                              
                                 2
                              
                           
                           
                              
                                 σ
                              
                              
                                 i
                                 i
                              
                           
                           /
                           
                              
                                 ∑
                              
                              
                                 i
                                 =
                                 1
                              
                              
                                 
                                    
                                       d
                                    
                                    
                                       1
                                    
                                 
                              
                           
                           
                              
                                 σ
                              
                              
                                 i
                                 i
                              
                           
                        , where 
                           
                              
                                 σ
                              
                              
                                 i
                                 i
                              
                           
                         is the variance of 
                           
                              
                                 x
                              
                              
                                 i
                              
                           
                        , and 
                           
                              
                                 ∑
                              
                              
                                 i
                                 =
                                 1
                              
                              
                                 
                                    
                                       d
                                    
                                    
                                       1
                                    
                                 
                              
                           
                           
                              
                                 σ
                              
                              
                                 i
                                 i
                              
                           
                         is the total variation in 
                           
                              X
                           
                        , and 
                           
                              
                                 ∑
                              
                              
                                 i
                                 =
                                 1
                              
                              
                                 
                                    
                                       d
                                    
                                    
                                       1
                                    
                                 
                              
                           
                           
                              
                                 ϱ
                              
                              
                                 i
                              
                              
                                 2
                              
                           
                           
                              
                                 σ
                              
                              
                                 i
                                 i
                              
                           
                         is the variation of 
                           
                              X
                           
                         being explained by 
                           
                              Y
                           
                         by linear regression.

We define 
                           
                              (13)
                              
                                 ϱ
                                 
                                    (
                                    
                                       X
                                    
                                    ,
                                    
                                       Y
                                    
                                    )
                                 
                                 =
                                 
                                    
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                             =
                                             1
                                          
                                          
                                             
                                                
                                                   d
                                                
                                                
                                                   1
                                                
                                             
                                          
                                       
                                       
                                          
                                             ϱ
                                          
                                          
                                             i
                                          
                                          
                                             2
                                          
                                       
                                       
                                          
                                             σ
                                          
                                          
                                             i
                                             i
                                          
                                       
                                       /
                                       
                                          
                                             ∑
                                          
                                          
                                             i
                                             =
                                             1
                                          
                                          
                                             
                                                
                                                   d
                                                
                                                
                                                   1
                                                
                                             
                                          
                                       
                                       
                                          
                                             σ
                                          
                                          
                                             i
                                             i
                                          
                                       
                                    
                                 
                                 ,
                              
                           
                        to be the correlation between 
                           
                              X
                           
                         and 
                           
                              Y
                           
                         and use it to calculate the correlation of normal vectors of two registered shapes. Note that 
                           ϱ
                           
                              (
                              
                                 X
                              
                              ,
                              
                                 Y
                              
                              )
                           
                           ∈
                           
                              [
                              0
                              ,
                              1
                              ]
                           
                        , which achieves 1 if and only if 
                           
                              r
                           
                           =
                           
                              
                                 
                                    [
                                    1
                                    ,
                                    1
                                    ,
                                    …
                                    ,
                                    1
                                    ]
                                 
                              
                              
                                 T
                              
                           
                        , and achieves 0 if and only if 
                           
                              r
                           
                           =
                           
                              
                                 
                                    [
                                    0
                                    ,
                                    0
                                    ,
                                    …
                                    ,
                                    0
                                    ]
                                 
                              
                              
                                 T
                              
                           
                        . Below is the definition of what is a good correspondence when judged by this metric: 
                           Definition
                           We say 
                                 
                                    
                                       c
                                    
                                    
                                       a
                                    
                                 
                                 :
                                 
                                    
                                       
                                          S
                                       
                                    
                                    
                                       1
                                    
                                 
                                 →
                                 
                                    
                                       
                                          S
                                       
                                    
                                    
                                       2
                                    
                                 
                               is a better correspondence than 
                                 
                                    
                                       c
                                    
                                    
                                       b
                                    
                                 
                                 :
                                 
                                    
                                       
                                          S
                                       
                                    
                                    
                                       1
                                    
                                 
                                 →
                                 
                                    
                                       
                                          S
                                       
                                    
                                    
                                       2
                                    
                                 
                               if 
                                 
                                    (14)
                                    
                                       ϱ
                                       
                                          (
                                          
                                             
                                                
                                                   n
                                                
                                             
                                             
                                                1
                                             
                                          
                                          
                                             (
                                             
                                                x
                                             
                                             )
                                          
                                          ,
                                          
                                             
                                                
                                                   n
                                                
                                             
                                             
                                                2
                                             
                                          
                                          
                                             (
                                             
                                                
                                                   c
                                                
                                                
                                                   a
                                                
                                             
                                             
                                                (
                                                
                                                   x
                                                
                                                )
                                             
                                             )
                                          
                                          )
                                       
                                       >
                                       ϱ
                                       
                                          (
                                          
                                             
                                                
                                                   n
                                                
                                             
                                             
                                                1
                                             
                                          
                                          
                                             (
                                             
                                                x
                                             
                                             )
                                          
                                          ,
                                          
                                             
                                                
                                                   n
                                                
                                             
                                             
                                                2
                                             
                                          
                                          
                                             (
                                             
                                                
                                                   c
                                                
                                                
                                                   b
                                                
                                             
                                             
                                                (
                                                
                                                   x
                                                
                                                )
                                             
                                             )
                                          
                                          )
                                       
                                       ,
                                       
                                       
                                          x
                                       
                                       ∈
                                       
                                          
                                             
                                                S
                                             
                                          
                                          
                                             1
                                          
                                       
                                       ,
                                    
                                 
                               where 
                                 
                                    
                                       
                                          n
                                       
                                    
                                    
                                       1
                                    
                                 
                                 
                                    (
                                    
                                       x
                                    
                                    )
                                 
                               is the normal vector at the point 
                                 
                                    x
                                 
                               on 
                                 
                                    
                                       
                                          S
                                       
                                    
                                    
                                       1
                                    
                                 
                              , 
                                 
                                    
                                       
                                          n
                                       
                                    
                                    
                                       2
                                    
                                 
                                 
                                    (
                                    
                                       
                                          c
                                       
                                       
                                          a
                                       
                                    
                                    
                                       (
                                       
                                          x
                                       
                                       )
                                    
                                    )
                                 
                               the normal vector at the corresponding point of 
                                 
                                    x
                                 
                               on 
                                 
                                    
                                       
                                          S
                                       
                                    
                                    
                                       2
                                    
                                 
                              , and 
                                 ϱ
                                 
                                    (
                                    
                                       
                                          
                                             n
                                          
                                       
                                       
                                          1
                                       
                                    
                                    ,
                                    
                                       
                                          
                                             n
                                          
                                       
                                       
                                          2
                                       
                                    
                                    )
                                 
                               is defined in (13). The inequality (14) says that 
                                 
                                    
                                       c
                                    
                                    
                                       a
                                    
                                 
                               is a better correspondence than 
                                 
                                    
                                       c
                                    
                                    
                                       b
                                    
                                 
                               if it gives larger correlation between the normal vectors on 
                                 
                                    
                                       
                                          S
                                       
                                    
                                    
                                       1
                                    
                                 
                               and 
                                 
                                    
                                       
                                          S
                                       
                                    
                                    
                                       2
                                    
                                 
                              .

To check the quality of the morphed mesh for the subject-specific shape, we calculate the Jacobians at the vertices of each element. It can be shown that the Jacobians over a linear Bézier element (which degenerates to a linear Lagrange element) are bounded by the Jacobians at its corners  [20]. So, for the mesh of bi-linear 2D finite elements and tri-linear 3D finite elements, it is sufficient to check the Jacobians at the vertices of each element. For further discussions on the Jacobians of higher order elements, please refer to  [21,22].

In the proposed approach in Sections 2, 3, and 4, we build the statistical atlas from the population of training shapes and use it to aid the automatic construction of the subject-specific FE mesh. Then we evaluate the approach by the metrics proposed in Section  5. Here we show the numerical results of the examples of the 2D hand shapes, 3D femur proximals and 3D aortas.

In this section we apply our method on the subject-specific FE modeling of the 2D hand shapes  [6]. We have 40 hand shapes in total and they are scaled and moved into the 
                           
                              [
                              0
                              ,
                              1
                              ]
                           
                           ×
                           
                              [
                              0
                              ,
                              1
                              ]
                           
                         bounding box. Each shape is represented by 2001 uniformly sampled points.

In the FFD registration, the shape 
                           
                              
                                 
                                    S
                                 
                              
                              
                                 23
                              
                           
                         is chosen as the template shape and has been registered to the other training shapes by FFD. Then we re-sample all the other training shapes by the points on 
                           
                              
                                 
                                    S
                                 
                              
                              
                                 23
                              
                           
                         with the correspondences obtained. The size of the B-spline control grid in this example is 20×20, the smoothing coefficient 
                           α
                         is chosen to be 30000 at the start of the deformation and is halved per 8 iterations until 
                           α
                           <
                           10
                        . We choose the weight of landmarks 
                           β
                           =
                           5
                        .

In Figs. 3 and 4 we show the mean shape and eigen-modes calculated from the training set of all the 40 re-sampled shapes. Here we design a leave-one-out experiment. For 
                           k
                           =
                           1
                           ,
                           …
                           ,
                           40
                        , each time the 
                           k
                        th shape is selected as the subject shape and the remaining 39 shapes are used as the training shapes. The statistical shape model is built from the re-samplings of the 39 training shapes. In this way, the training set will not contain the exact subject shape.

In the shape instantiation, we use the first 11 eigen-modes (captures more than 99% of the variation) to instantiate the new shape. The regularization coefficient 
                           γ
                         is chosen to be 0.3 initially and multiplied by 
                           
                              
                                 1
                              
                              
                                 4
                              
                           
                         each outer iteration in Algorithm 1 until it is less than 0.008. In the FE mesh morphing, we choose the smoothing coefficient 
                           α
                           =
                           50
                        .

The results of shape instantiation and FE mesh construction of shapes 
                           
                              
                                 
                                    S
                                 
                              
                              
                                 1
                              
                           
                           ,
                           
                              
                                 
                                    S
                                 
                              
                              
                                 26
                              
                           
                           ,
                           
                              
                                 
                                    S
                                 
                              
                              
                                 37
                              
                           
                         are shown in Fig. 9
                        . The left column shows the results of shape instantiation and the right column shows the results of FE mesh construction. In the FE mesh construction, the subject shapes were transformed to the reference frame by 
                           
                              
                                 
                                    t
                                 
                              
                              
                                 R
                                 ,
                                 T
                                 ,
                                 s
                              
                              
                                 −
                                 1
                              
                           
                        .

Among the 40 shapes, only the instantiation of the shape 
                           
                              
                                 
                                    S
                                 
                              
                              
                                 38
                              
                           
                         has failed, as shown in Fig. 10
                        (a). As mentioned in  [6], 
                           
                              
                                 
                                    S
                                 
                              
                              
                                 38
                              
                           
                         belongs to one of the two outliers (
                           
                              
                                 
                                    S
                                 
                              
                              
                                 38
                              
                           
                           ,
                           
                              
                                 
                                    S
                                 
                              
                              
                                 40
                              
                           
                        ) in the training set, which means it is much farther from the mean shape than other shapes, and is more likely to be trapped in the local minimum. We say that it is trapped in the local minimum because there does exist an instance 
                           
                              
                                 
                                    
                                       
                                          S
                                       
                                    
                                    
                                       ˜
                                    
                                 
                              
                              
                                 38
                              
                           
                         in the eigen-space built from 
                           
                              
                                 S
                              
                              
                                 
                                    (
                                    38
                                    )
                                 
                              
                           
                           =
                           
                              {
                              
                                 
                                    
                                       S
                                    
                                 
                                 
                                    1
                                 
                                 
                                    c
                                 
                              
                              ,
                              …
                              ,
                              
                                 
                                    
                                       S
                                    
                                 
                                 
                                    37
                                 
                                 
                                    c
                                 
                              
                              ,
                              
                                 
                                    S
                                 
                                 
                                    39
                                 
                                 
                                    c
                                 
                              
                              ,
                              
                                 
                                    S
                                 
                                 
                                    40
                                 
                                 
                                    c
                                 
                              
                              }
                           
                         that is closer to 
                           
                              
                                 
                                    S
                                 
                              
                              
                                 38
                              
                           
                         than the one we found, as shown in 10(b).

The best match of 
                           
                              
                                 
                                    S
                                 
                              
                              
                                 38
                              
                           
                         is obtained by projecting 
                           
                              
                                 
                                    S
                                 
                              
                              
                                 38
                              
                              
                                 c
                              
                           
                         into the eigen-space by 
                           
                              
                                 
                                    
                                       
                                          
                                             
                                                S
                                             
                                          
                                          
                                             ˜
                                          
                                       
                                    
                                    
                                       38
                                    
                                 
                                 =
                                 
                                    
                                       
                                          S
                                       
                                    
                                    
                                       ̄
                                    
                                 
                                 +
                                 Ψ
                                 
                                    
                                       Ψ
                                    
                                    
                                       T
                                    
                                 
                                 
                                    (
                                    
                                       
                                          
                                             S
                                          
                                       
                                       
                                          38
                                       
                                       
                                          c
                                       
                                    
                                    −
                                    
                                       
                                          
                                             S
                                          
                                       
                                       
                                          ̄
                                       
                                    
                                    )
                                 
                                 ,
                              
                           
                         where 
                           
                              
                                 
                                    S
                                 
                              
                              
                                 38
                              
                              
                                 c
                              
                           
                         is the re-sampling of 
                           
                              
                                 
                                    S
                                 
                              
                              
                                 38
                              
                           
                         with the correspondence obtained by FFD with 56 landmarks, 
                           
                              
                                 
                                    S
                                 
                              
                              
                                 ̄
                              
                           
                         is the mean shape of 
                           
                              
                                 S
                              
                              
                                 
                                    (
                                    38
                                    )
                                 
                              
                           
                        .

In all other examples of 3D femur and aorta there are no failure cases because the shapes are similar with each other.


                        Fig. 11
                         shows the distance of the instantiated shape (
                           
                              
                                 E
                              
                              
                                 d
                              
                           
                         in Section  3) to the given shape at each iterations. We could see most of the instantiations succeed in finding an instance close to the given shape except for 
                           
                              
                                 
                                    S
                                 
                              
                              
                                 38
                              
                           
                        , which deviates too much from the mean shape. The running time is from 1.507530 s (
                           
                              
                                 
                                    S
                                 
                              
                              
                                 13
                              
                           
                        , 168 iteration) to 5.910679 s (
                           
                              
                                 
                                    S
                                 
                              
                              
                                 38
                              
                           
                        , 581 iterations) on Matlab with processor: Intel Core i7, 3.50 GHz.

In Fig. 12
                         we plot the correlation coefficients of normals between the template shape and all other registered shapes before and after the free-form deformation, which are in triangles and squares, and the correlation coefficients obtained by the shape instantiation, which is in circle. We could see that the proposed correlation metric has nicely distinguished the registered shapes and unregistered shapes while showing no major differences between the FFD and the shape instantiation, which indicates that the automatic shape registration by eigen-space search without manual intervention gives as good correspondence as the free form deformation method with carefully chosen landmarks. Actually, the 56 landmarks we used in the FFD based registration are the same landmarks used by  [6].

Here we apply our method with the femur bones to demonstrate its success in 3D shape synthesis and FE mesh generation.

We have a set of 29 femur proximals as shown in Fig. 13
                           . These femurs are represented by boundary triangulations and are scaled into the unite bounding box. The number of vertices of each femur varies from 2912 to 3567. We find the correspondences between those shapes by FFD with the chosen landmarks in Fig. 13. Then we re-sample each shape based on the correspondences and conduct the statistical shape modeling.


                           Fig. 14
                            shows the shapes before GPA, after GPA and the mean shape 
                              
                                 
                                    
                                       S
                                    
                                 
                                 
                                    ̄
                                 
                              
                            of the femurs. Fig. 15
                            has shown the first three eigen-modes out of the 28 and Fig. 16
                            shows the cumulative shape variances captured by the increasing number of shape modes from one mode to the whole 28 modes.

After we obtained the statistical shape model, we create finite element mesh for the mean shape as shown in Fig. 17
                           .

With the obtained statistical shape model, we can conduct eigen-space search for a given subject-specific shape. Here we did the same leave-one-out experiment for the femur-proximal as in the 2D hand example. In the experiment we use 15 eigen-modes (captures more than 96% of the variation) to instantiate the new shape.


                           Fig. 18
                            shows one example of shape instantiation and projection. Fig. 18(c) shows the instantiated shape 
                              
                                 
                                    
                                       S
                                    
                                 
                                 
                                    ˜
                                 
                              
                            and Fig. 18(d) shows its projection 
                              
                                 
                                    
                                       
                                          
                                             S
                                          
                                       
                                       
                                          ˜
                                       
                                    
                                 
                                 
                                    P
                                 
                              
                            onto the given shape 
                              
                                 
                                    
                                       S
                                    
                                 
                                 
                                    ˆ
                                 
                              
                           . It is clear that the deviation between the synthesized shape 
                              
                                 
                                    
                                       
                                          
                                             S
                                          
                                       
                                       
                                          ˜
                                       
                                    
                                 
                                 
                                    P
                                 
                              
                            and the given shape 
                              
                                 
                                    
                                       S
                                    
                                 
                                 
                                    ˆ
                                 
                              
                            is random, indicting a good accuracy of the synthesis process.


                           Fig. 19
                            shows the distance of the instantiated shape (
                              
                                 
                                    E
                                 
                                 
                                    d
                                 
                              
                            in Section  3) to the given shape at each iterations. The average edge length of each triangle mesh is around 0.02, and all the instantiations have given an average surface deviation just about half of the average edge length, which shows the success of the instantiation. The average surface deviation is calculated by 
                              
                                 
                                    
                                       
                                          E
                                       
                                       
                                          d
                                       
                                    
                                    /
                                    
                                       
                                          n
                                       
                                       
                                          v
                                       
                                    
                                 
                              
                           , where 
                              
                                 
                                    E
                                 
                                 
                                    d
                                 
                              
                            is the square distance defined in (6) and 
                              
                                 
                                    n
                                 
                                 
                                    v
                                 
                              
                            is the number of vertex. The running time is from 0.939999 s (
                              
                                 
                                    
                                       S
                                    
                                 
                                 
                                    2
                                 
                              
                           , 65 iteration) to 3.337465 s (
                              
                                 
                                    
                                       S
                                    
                                 
                                 
                                    8
                                 
                              
                           , 218 iterations) on Matlab with processor: Intel Core i7, 3.50 GHz.

In Fig. 20
                            we compare the correlation coefficients of normals among the ICP, FFD and SSM based methods. In ICP and FFD, shape 2 is chosen as the template, so the correlation with itself is 1. For SSM based shape synthesis, we conducted a leave-one-out test and thus obtained correlation for 29 shapes. The correlations obtained by SSM synthesized shapes (circle) are slightly better than the correlations obtained by FFD (square) and show obvious improvement than the correlations (triangles) obtained by ICP. This suggests that both FFD and SSM based approaches lead to comparable shape correspondence. However, FFD requires 3 landmark points for guidance during the deformation process.

In Fig. 21
                            we have removed the top of the given shapes 
                              
                                 
                                    
                                       
                                          
                                             S
                                          
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    
                                       
                                          
                                             S
                                          
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    2
                                 
                              
                              ,
                              
                                 
                                    
                                       
                                          
                                             S
                                          
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    3
                                 
                              
                            and repeated the same process as we did in Fig. 18. The results show that our method is very robust even when the shapes are incomplete. In Fig. 22
                            we have compared the shape parameters we obtained from the given complete shapes and the given incomplete shapes by the shape instantiation, the two sets of parameters only have minor differences and are in good accordance with each other. This suggests that the automatic shape instantiation is robust with incomplete data.

As shown in Fig. 23
                           , with the boundary correspondences obtained in the previous section, we morph the FE mesh of the mean shape in Fig. 17 to the given shapes 
                              
                                 
                                    
                                       
                                          
                                             S
                                          
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    
                                       
                                          
                                             S
                                          
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    2
                                 
                              
                              ,
                              
                                 
                                    
                                       
                                          
                                             S
                                          
                                       
                                       
                                          ˆ
                                       
                                    
                                 
                                 
                                    3
                                 
                              
                            and obtain the subject-specific FE meshes, whose Jacobians are non-negative.

Due to the complex structures (two inlets on the main body and three leaflets inside), the mesh generation of aorta is very time consuming and the automatic FE mesh generation for aorta would be very appealing and has important potential practical applications.

We have five aortic models, four of them were used for constructing statistical atlas and one was used as the given target shape for shape synthesis.

As shown in Fig. 24
                           , we have four shapes in the training set. On each shape we have marked 13 landmarks, based on which we conducted the FFD based shape registration. Fig. 25
                            shows the obtained mean shape model and eigen-modes of the statistical shape model.

With the obtained mean shape 
                              
                                 
                                    
                                       S
                                    
                                 
                                 
                                    ̄
                                 
                              
                            and three eigen-modes 
                              
                                 
                                    Ψ
                                 
                                 
                                    1
                                 
                              
                              ,
                              
                                 
                                    Ψ
                                 
                                 
                                    2
                                 
                              
                              ,
                              
                                 
                                    Ψ
                                 
                                 
                                    3
                                 
                              
                           , given a new shape 
                              
                                 
                                    
                                       S
                                    
                                 
                                 
                                    ˆ
                                 
                              
                           , we automatically instantiate it with the shape instances in the eigen-space and find the correspondences between the given shape 
                              
                                 
                                    
                                       S
                                    
                                 
                                 
                                    ˆ
                                 
                              
                            and the mean shape 
                              
                                 
                                    
                                       S
                                    
                                 
                                 
                                    ̄
                                 
                              
                           . In Fig. 26
                            we show the process of shape instantiation and projection.

With the correspondences obtained in the projection step, we automatically morph the hexahedral mesh of the mean shape to the given shape 
                              
                                 
                                    
                                       S
                                    
                                 
                                 
                                    ˆ
                                 
                              
                            (Fig. 26(a)) by the free-form deformation in Section  4. The resulting hexahedral mesh is shown in Fig. 27
                           .

@&#CONCLUSION@&#

This paper presents a statistical atlas based approach for subject-specific FE modeling and involves three parts: (1) constructing a statistical atlas, including the mean shape and eigen-modes of a shape population which span a linear shape space, and the generic FE mesh built on the mean shape; (2) establishing the correspondence between a given subject shape and the atlas by shape instantiation and projection; and (3) deforming the atlas to the subject shape based on the shape correspondence. The approach has been successfully applied in automatic FE modeling of 2D hands, 3D femur bones and 3D aorta.

Numerical examples demonstrate that the statistical atlas based approach allows automatic FE modeling of subject-specific shapes, even when a given subject-specific shape deviates significantly from the mean shape. This is advantageous over the template deformation based approach in that large deviations between the template and the given shape usually require manual specification of shape correspondence for it to work.

One potential limitation of our approach is that the instantiated shape is only a local optimal solution to the optimization formula (5). However, the examples show that in most cases we can find the correct shape instance even when the subject shape deviates significantly from the mean shape.

Our current approach to statistical shape modeling relies on manual specification of landmarks to establish correspondence among the shape population. For automatic correspondence, approaches such as  [23,24] can be used.

Future work would extend this approach to FE modeling from subject-specific medical images such as computed tomography or magnetic resonance images. This would bypass the need for segmentation of these images.

@&#ACKNOWLEDGMENTS@&#

We would like to acknowledge our data sources: (1) Mikkel B. Stegmann at Technical University of Denmark for the hand data; (2) Dr. Alejandro A. Espinoza Oras at Rush University Medical Center for the femoral bone data; (3) Dr. Sun Wei at the Georgia Institute of Technology for the aorta data.

@&#REFERENCES@&#

